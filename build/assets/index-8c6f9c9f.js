function EX(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in t)){const c=Object.getOwnPropertyDescriptor(s,i);c&&Object.defineProperty(t,i,c.get?c:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(i){if(i.ep)return;i.ep=!0;const c=n(i);fetch(i.href,c)}})();var Bi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function P$(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function _X(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function s(){if(this instanceof s){var i=[null];i.push.apply(i,arguments);var c=Function.bind.apply(e,i);return new c}return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var i=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:function(){return t[s]}})}),n}var vm={},yX={get exports(){return vm},set exports(t){vm=t}},b1={},Dr={},vX={get exports(){return Dr},set exports(t){Dr=t}},bn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Km=Symbol.for("react.element"),SX=Symbol.for("react.portal"),TX=Symbol.for("react.fragment"),IX=Symbol.for("react.strict_mode"),CX=Symbol.for("react.profiler"),wX=Symbol.for("react.provider"),RX=Symbol.for("react.context"),bX=Symbol.for("react.forward_ref"),NX=Symbol.for("react.suspense"),AX=Symbol.for("react.memo"),OX=Symbol.for("react.lazy"),eL=Symbol.iterator;function xX(t){return t===null||typeof t!="object"?null:(t=eL&&t[eL]||t["@@iterator"],typeof t=="function"?t:null)}var L$={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M$=Object.assign,$$={};function Mp(t,e,n){this.props=t,this.context=e,this.refs=$$,this.updater=n||L$}Mp.prototype.isReactComponent={};Mp.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Mp.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function F$(){}F$.prototype=Mp.prototype;function uC(t,e,n){this.props=t,this.context=e,this.refs=$$,this.updater=n||L$}var lC=uC.prototype=new F$;lC.constructor=uC;M$(lC,Mp.prototype);lC.isPureReactComponent=!0;var tL=Array.isArray,U$=Object.prototype.hasOwnProperty,dC={current:null},V$={key:!0,ref:!0,__self:!0,__source:!0};function B$(t,e,n){var s,i={},c=null,l=null;if(e!=null)for(s in e.ref!==void 0&&(l=e.ref),e.key!==void 0&&(c=""+e.key),e)U$.call(e,s)&&!V$.hasOwnProperty(s)&&(i[s]=e[s]);var d=arguments.length-2;if(d===1)i.children=n;else if(1<d){for(var p=Array(d),f=0;f<d;f++)p[f]=arguments[f+2];i.children=p}if(t&&t.defaultProps)for(s in d=t.defaultProps,d)i[s]===void 0&&(i[s]=d[s]);return{$$typeof:Km,type:t,key:c,ref:l,props:i,_owner:dC.current}}function kX(t,e){return{$$typeof:Km,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function hC(t){return typeof t=="object"&&t!==null&&t.$$typeof===Km}function DX(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var nL=/\/+/g;function TT(t,e){return typeof t=="object"&&t!==null&&t.key!=null?DX(""+t.key):e.toString(36)}function m0(t,e,n,s,i){var c=typeof t;(c==="undefined"||c==="boolean")&&(t=null);var l=!1;if(t===null)l=!0;else switch(c){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case Km:case SX:l=!0}}if(l)return l=t,i=i(l),t=s===""?"."+TT(l,0):s,tL(i)?(n="",t!=null&&(n=t.replace(nL,"$&/")+"/"),m0(i,e,n,"",function(f){return f})):i!=null&&(hC(i)&&(i=kX(i,n+(!i.key||l&&l.key===i.key?"":(""+i.key).replace(nL,"$&/")+"/")+t)),e.push(i)),1;if(l=0,s=s===""?".":s+":",tL(t))for(var d=0;d<t.length;d++){c=t[d];var p=s+TT(c,d);l+=m0(c,e,n,p,i)}else if(p=xX(t),typeof p=="function")for(t=p.call(t),d=0;!(c=t.next()).done;)c=c.value,p=s+TT(c,d++),l+=m0(c,e,n,p,i);else if(c==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function WE(t,e,n){if(t==null)return t;var s=[],i=0;return m0(t,s,"","",function(c){return e.call(n,c,i++)}),s}function PX(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ko={current:null},g0={transition:null},LX={ReactCurrentDispatcher:Ko,ReactCurrentBatchConfig:g0,ReactCurrentOwner:dC};bn.Children={map:WE,forEach:function(t,e,n){WE(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return WE(t,function(){e++}),e},toArray:function(t){return WE(t,function(e){return e})||[]},only:function(t){if(!hC(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};bn.Component=Mp;bn.Fragment=TX;bn.Profiler=CX;bn.PureComponent=uC;bn.StrictMode=IX;bn.Suspense=NX;bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LX;bn.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=M$({},t.props),i=t.key,c=t.ref,l=t._owner;if(e!=null){if(e.ref!==void 0&&(c=e.ref,l=dC.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var d=t.type.defaultProps;for(p in e)U$.call(e,p)&&!V$.hasOwnProperty(p)&&(s[p]=e[p]===void 0&&d!==void 0?d[p]:e[p])}var p=arguments.length-2;if(p===1)s.children=n;else if(1<p){d=Array(p);for(var f=0;f<p;f++)d[f]=arguments[f+2];s.children=d}return{$$typeof:Km,type:t.type,key:i,ref:c,props:s,_owner:l}};bn.createContext=function(t){return t={$$typeof:RX,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:wX,_context:t},t.Consumer=t};bn.createElement=B$;bn.createFactory=function(t){var e=B$.bind(null,t);return e.type=t,e};bn.createRef=function(){return{current:null}};bn.forwardRef=function(t){return{$$typeof:bX,render:t}};bn.isValidElement=hC;bn.lazy=function(t){return{$$typeof:OX,_payload:{_status:-1,_result:t},_init:PX}};bn.memo=function(t,e){return{$$typeof:AX,type:t,compare:e===void 0?null:e}};bn.startTransition=function(t){var e=g0.transition;g0.transition={};try{t()}finally{g0.transition=e}};bn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};bn.useCallback=function(t,e){return Ko.current.useCallback(t,e)};bn.useContext=function(t){return Ko.current.useContext(t)};bn.useDebugValue=function(){};bn.useDeferredValue=function(t){return Ko.current.useDeferredValue(t)};bn.useEffect=function(t,e){return Ko.current.useEffect(t,e)};bn.useId=function(){return Ko.current.useId()};bn.useImperativeHandle=function(t,e,n){return Ko.current.useImperativeHandle(t,e,n)};bn.useInsertionEffect=function(t,e){return Ko.current.useInsertionEffect(t,e)};bn.useLayoutEffect=function(t,e){return Ko.current.useLayoutEffect(t,e)};bn.useMemo=function(t,e){return Ko.current.useMemo(t,e)};bn.useReducer=function(t,e,n){return Ko.current.useReducer(t,e,n)};bn.useRef=function(t){return Ko.current.useRef(t)};bn.useState=function(t){return Ko.current.useState(t)};bn.useSyncExternalStore=function(t,e,n){return Ko.current.useSyncExternalStore(t,e,n)};bn.useTransition=function(){return Ko.current.useTransition()};bn.version="18.2.0";(function(t){t.exports=bn})(vX);const MX=P$(Dr);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $X=Dr,FX=Symbol.for("react.element"),UX=Symbol.for("react.fragment"),VX=Object.prototype.hasOwnProperty,BX=$X.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jX={key:!0,ref:!0,__self:!0,__source:!0};function j$(t,e,n){var s,i={},c=null,l=null;n!==void 0&&(c=""+n),e.key!==void 0&&(c=""+e.key),e.ref!==void 0&&(l=e.ref);for(s in e)VX.call(e,s)&&!jX.hasOwnProperty(s)&&(i[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)i[s]===void 0&&(i[s]=e[s]);return{$$typeof:FX,type:t,key:c,ref:l,props:i,_owner:BX.current}}b1.Fragment=UX;b1.jsx=j$;b1.jsxs=j$;(function(t){t.exports=b1})(yX);const WX=vm.Fragment,zs=vm.jsx,Ed=vm.jsxs;var EI={},_I={},GX={get exports(){return _I},set exports(t){_I=t}},Gi={},yI={},zX={get exports(){return yI},set exports(t){yI=t}},W$={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(me,Te){var ke=me.length;me.push(Te);e:for(;0<ke;){var Fe=ke-1>>>1,Xe=me[Fe];if(0<i(Xe,Te))me[Fe]=Te,me[ke]=Xe,ke=Fe;else break e}}function n(me){return me.length===0?null:me[0]}function s(me){if(me.length===0)return null;var Te=me[0],ke=me.pop();if(ke!==Te){me[0]=ke;e:for(var Fe=0,Xe=me.length,Ye=Xe>>>1;Fe<Ye;){var tt=2*(Fe+1)-1,et=me[tt],nt=tt+1,gt=me[nt];if(0>i(et,ke))nt<Xe&&0>i(gt,et)?(me[Fe]=gt,me[nt]=ke,Fe=nt):(me[Fe]=et,me[tt]=ke,Fe=tt);else if(nt<Xe&&0>i(gt,ke))me[Fe]=gt,me[nt]=ke,Fe=nt;else break e}}return Te}function i(me,Te){var ke=me.sortIndex-Te.sortIndex;return ke!==0?ke:me.id-Te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;t.unstable_now=function(){return c.now()}}else{var l=Date,d=l.now();t.unstable_now=function(){return l.now()-d}}var p=[],f=[],m=1,_=null,y=3,v=!1,I=!1,b=!1,A=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function L(me){for(var Te=n(f);Te!==null;){if(Te.callback===null)s(f);else if(Te.startTime<=me)s(f),Te.sortIndex=Te.expirationTime,e(p,Te);else break;Te=n(f)}}function $(me){if(b=!1,L(me),!I)if(n(p)!==null)I=!0,Oe(G);else{var Te=n(f);Te!==null&&Me($,Te.startTime-me)}}function G(me,Te){I=!1,b&&(b=!1,R(re),re=-1),v=!0;var ke=y;try{for(L(Te),_=n(p);_!==null&&(!(_.expirationTime>Te)||me&&!Ee());){var Fe=_.callback;if(typeof Fe=="function"){_.callback=null,y=_.priorityLevel;var Xe=Fe(_.expirationTime<=Te);Te=t.unstable_now(),typeof Xe=="function"?_.callback=Xe:_===n(p)&&s(p),L(Te)}else s(p);_=n(p)}if(_!==null)var Ye=!0;else{var tt=n(f);tt!==null&&Me($,tt.startTime-Te),Ye=!1}return Ye}finally{_=null,y=ke,v=!1}}var H=!1,Z=null,re=-1,oe=5,ae=-1;function Ee(){return!(t.unstable_now()-ae<oe)}function Ce(){if(Z!==null){var me=t.unstable_now();ae=me;var Te=!0;try{Te=Z(!0,me)}finally{Te?ye():(H=!1,Z=null)}}else H=!1}var ye;if(typeof O=="function")ye=function(){O(Ce)};else if(typeof MessageChannel<"u"){var we=new MessageChannel,Ae=we.port2;we.port1.onmessage=Ce,ye=function(){Ae.postMessage(null)}}else ye=function(){A(Ce,0)};function Oe(me){Z=me,H||(H=!0,ye())}function Me(me,Te){re=A(function(){me(t.unstable_now())},Te)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(me){me.callback=null},t.unstable_continueExecution=function(){I||v||(I=!0,Oe(G))},t.unstable_forceFrameRate=function(me){0>me||125<me?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):oe=0<me?Math.floor(1e3/me):5},t.unstable_getCurrentPriorityLevel=function(){return y},t.unstable_getFirstCallbackNode=function(){return n(p)},t.unstable_next=function(me){switch(y){case 1:case 2:case 3:var Te=3;break;default:Te=y}var ke=y;y=Te;try{return me()}finally{y=ke}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(me,Te){switch(me){case 1:case 2:case 3:case 4:case 5:break;default:me=3}var ke=y;y=me;try{return Te()}finally{y=ke}},t.unstable_scheduleCallback=function(me,Te,ke){var Fe=t.unstable_now();switch(typeof ke=="object"&&ke!==null?(ke=ke.delay,ke=typeof ke=="number"&&0<ke?Fe+ke:Fe):ke=Fe,me){case 1:var Xe=-1;break;case 2:Xe=250;break;case 5:Xe=1073741823;break;case 4:Xe=1e4;break;default:Xe=5e3}return Xe=ke+Xe,me={id:m++,callback:Te,priorityLevel:me,startTime:ke,expirationTime:Xe,sortIndex:-1},ke>Fe?(me.sortIndex=ke,e(f,me),n(p)===null&&me===n(f)&&(b?(R(re),re=-1):b=!0,Me($,ke-Fe))):(me.sortIndex=Xe,e(p,me),I||v||(I=!0,Oe(G))),me},t.unstable_shouldYield=Ee,t.unstable_wrapCallback=function(me){var Te=y;return function(){var ke=y;y=Te;try{return me.apply(this,arguments)}finally{y=ke}}}})(W$);(function(t){t.exports=W$})(zX);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G$=Dr,Wi=yI;function ot(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var z$=new Set,Sm={};function $d(t,e){gp(t,e),gp(t+"Capture",e)}function gp(t,e){for(Sm[t]=e,t=0;t<e.length;t++)z$.add(e[t])}var Yc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),vI=Object.prototype.hasOwnProperty,HX=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,rL={},sL={};function KX(t){return vI.call(sL,t)?!0:vI.call(rL,t)?!1:HX.test(t)?sL[t]=!0:(rL[t]=!0,!1)}function qX(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function XX(t,e,n,s){if(e===null||typeof e>"u"||qX(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function qo(t,e,n,s,i,c,l){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=c,this.removeEmptyString=l}var uo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){uo[t]=new qo(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];uo[e]=new qo(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){uo[t]=new qo(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){uo[t]=new qo(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){uo[t]=new qo(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){uo[t]=new qo(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){uo[t]=new qo(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){uo[t]=new qo(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){uo[t]=new qo(t,5,!1,t.toLowerCase(),null,!1,!1)});var pC=/[\-:]([a-z])/g;function fC(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(pC,fC);uo[e]=new qo(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(pC,fC);uo[e]=new qo(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(pC,fC);uo[e]=new qo(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){uo[t]=new qo(t,1,!1,t.toLowerCase(),null,!1,!1)});uo.xlinkHref=new qo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){uo[t]=new qo(t,1,!1,t.toLowerCase(),null,!0,!0)});function mC(t,e,n,s){var i=uo.hasOwnProperty(e)?uo[e]:null;(i!==null?i.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(XX(e,n,i,s)&&(n=null),s||i===null?KX(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,s=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var iu=G$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,GE=Symbol.for("react.element"),Hh=Symbol.for("react.portal"),Kh=Symbol.for("react.fragment"),gC=Symbol.for("react.strict_mode"),SI=Symbol.for("react.profiler"),H$=Symbol.for("react.provider"),K$=Symbol.for("react.context"),EC=Symbol.for("react.forward_ref"),TI=Symbol.for("react.suspense"),II=Symbol.for("react.suspense_list"),_C=Symbol.for("react.memo"),Gu=Symbol.for("react.lazy"),q$=Symbol.for("react.offscreen"),oL=Symbol.iterator;function Vf(t){return t===null||typeof t!="object"?null:(t=oL&&t[oL]||t["@@iterator"],typeof t=="function"?t:null)}var Yr=Object.assign,IT;function Jf(t){if(IT===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);IT=e&&e[1]||""}return`
`+IT+t}var CT=!1;function wT(t,e){if(!t||CT)return"";CT=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(f){var s=f}Reflect.construct(t,[],e)}else{try{e.call()}catch(f){s=f}t.call(e.prototype)}else{try{throw Error()}catch(f){s=f}t()}}catch(f){if(f&&s&&typeof f.stack=="string"){for(var i=f.stack.split(`
`),c=s.stack.split(`
`),l=i.length-1,d=c.length-1;1<=l&&0<=d&&i[l]!==c[d];)d--;for(;1<=l&&0<=d;l--,d--)if(i[l]!==c[d]){if(l!==1||d!==1)do if(l--,d--,0>d||i[l]!==c[d]){var p=`
`+i[l].replace(" at new "," at ");return t.displayName&&p.includes("<anonymous>")&&(p=p.replace("<anonymous>",t.displayName)),p}while(1<=l&&0<=d);break}}}finally{CT=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Jf(t):""}function YX(t){switch(t.tag){case 5:return Jf(t.type);case 16:return Jf("Lazy");case 13:return Jf("Suspense");case 19:return Jf("SuspenseList");case 0:case 2:case 15:return t=wT(t.type,!1),t;case 11:return t=wT(t.type.render,!1),t;case 1:return t=wT(t.type,!0),t;default:return""}}function CI(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Kh:return"Fragment";case Hh:return"Portal";case SI:return"Profiler";case gC:return"StrictMode";case TI:return"Suspense";case II:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case K$:return(t.displayName||"Context")+".Consumer";case H$:return(t._context.displayName||"Context")+".Provider";case EC:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case _C:return e=t.displayName||null,e!==null?e:CI(t.type)||"Memo";case Gu:e=t._payload,t=t._init;try{return CI(t(e))}catch{}}return null}function JX(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return CI(e);case 8:return e===gC?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function dl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function X$(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function QX(t){var e=X$(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,c=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(l){s=""+l,c.call(this,l)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(l){s=""+l},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function zE(t){t._valueTracker||(t._valueTracker=QX(t))}function Y$(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=X$(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function D0(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function wI(t,e){var n=e.checked;return Yr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function iL(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=dl(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function J$(t,e){e=e.checked,e!=null&&mC(t,"checked",e,!1)}function RI(t,e){J$(t,e);var n=dl(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?bI(t,e.type,n):e.hasOwnProperty("defaultValue")&&bI(t,e.type,dl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function aL(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function bI(t,e,n){(e!=="number"||D0(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Qf=Array.isArray;function ip(t,e,n,s){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&s&&(t[n].defaultSelected=!0)}else{for(n=""+dl(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,s&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function NI(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ot(91));return Yr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function cL(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ot(92));if(Qf(n)){if(1<n.length)throw Error(ot(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:dl(n)}}function Q$(t,e){var n=dl(e.value),s=dl(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function uL(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Z$(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function AI(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Z$(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var HE,eF=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(HE=HE||document.createElement("div"),HE.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=HE.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Tm(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var cm={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ZX=["Webkit","ms","Moz","O"];Object.keys(cm).forEach(function(t){ZX.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),cm[e]=cm[t]})});function tF(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||cm.hasOwnProperty(t)&&cm[t]?(""+e).trim():e+"px"}function nF(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,i=tF(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,i):t[n]=i}}var eY=Yr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function OI(t,e){if(e){if(eY[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ot(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ot(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ot(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ot(62))}}function xI(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kI=null;function yC(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var DI=null,ap=null,cp=null;function lL(t){if(t=Ym(t)){if(typeof DI!="function")throw Error(ot(280));var e=t.stateNode;e&&(e=k1(e),DI(t.stateNode,t.type,e))}}function rF(t){ap?cp?cp.push(t):cp=[t]:ap=t}function sF(){if(ap){var t=ap,e=cp;if(cp=ap=null,lL(t),e)for(t=0;t<e.length;t++)lL(e[t])}}function oF(t,e){return t(e)}function iF(){}var RT=!1;function aF(t,e,n){if(RT)return t(e,n);RT=!0;try{return oF(t,e,n)}finally{RT=!1,(ap!==null||cp!==null)&&(iF(),sF())}}function Im(t,e){var n=t.stateNode;if(n===null)return null;var s=k1(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ot(231,e,typeof n));return n}var PI=!1;if(Yc)try{var Bf={};Object.defineProperty(Bf,"passive",{get:function(){PI=!0}}),window.addEventListener("test",Bf,Bf),window.removeEventListener("test",Bf,Bf)}catch{PI=!1}function tY(t,e,n,s,i,c,l,d,p){var f=Array.prototype.slice.call(arguments,3);try{e.apply(n,f)}catch(m){this.onError(m)}}var um=!1,P0=null,L0=!1,LI=null,nY={onError:function(t){um=!0,P0=t}};function rY(t,e,n,s,i,c,l,d,p){um=!1,P0=null,tY.apply(nY,arguments)}function sY(t,e,n,s,i,c,l,d,p){if(rY.apply(this,arguments),um){if(um){var f=P0;um=!1,P0=null}else throw Error(ot(198));L0||(L0=!0,LI=f)}}function Fd(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function cF(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function dL(t){if(Fd(t)!==t)throw Error(ot(188))}function oY(t){var e=t.alternate;if(!e){if(e=Fd(t),e===null)throw Error(ot(188));return e!==t?null:t}for(var n=t,s=e;;){var i=n.return;if(i===null)break;var c=i.alternate;if(c===null){if(s=i.return,s!==null){n=s;continue}break}if(i.child===c.child){for(c=i.child;c;){if(c===n)return dL(i),t;if(c===s)return dL(i),e;c=c.sibling}throw Error(ot(188))}if(n.return!==s.return)n=i,s=c;else{for(var l=!1,d=i.child;d;){if(d===n){l=!0,n=i,s=c;break}if(d===s){l=!0,s=i,n=c;break}d=d.sibling}if(!l){for(d=c.child;d;){if(d===n){l=!0,n=c,s=i;break}if(d===s){l=!0,s=c,n=i;break}d=d.sibling}if(!l)throw Error(ot(189))}}if(n.alternate!==s)throw Error(ot(190))}if(n.tag!==3)throw Error(ot(188));return n.stateNode.current===n?t:e}function uF(t){return t=oY(t),t!==null?lF(t):null}function lF(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=lF(t);if(e!==null)return e;t=t.sibling}return null}var dF=Wi.unstable_scheduleCallback,hL=Wi.unstable_cancelCallback,iY=Wi.unstable_shouldYield,aY=Wi.unstable_requestPaint,ds=Wi.unstable_now,cY=Wi.unstable_getCurrentPriorityLevel,vC=Wi.unstable_ImmediatePriority,hF=Wi.unstable_UserBlockingPriority,M0=Wi.unstable_NormalPriority,uY=Wi.unstable_LowPriority,pF=Wi.unstable_IdlePriority,N1=null,gc=null;function lY(t){if(gc&&typeof gc.onCommitFiberRoot=="function")try{gc.onCommitFiberRoot(N1,t,void 0,(t.current.flags&128)===128)}catch{}}var Wa=Math.clz32?Math.clz32:pY,dY=Math.log,hY=Math.LN2;function pY(t){return t>>>=0,t===0?32:31-(dY(t)/hY|0)|0}var KE=64,qE=4194304;function Zf(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function $0(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,i=t.suspendedLanes,c=t.pingedLanes,l=n&268435455;if(l!==0){var d=l&~i;d!==0?s=Zf(d):(c&=l,c!==0&&(s=Zf(c)))}else l=n&~i,l!==0?s=Zf(l):c!==0&&(s=Zf(c));if(s===0)return 0;if(e!==0&&e!==s&&!(e&i)&&(i=s&-s,c=e&-e,i>=c||i===16&&(c&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-Wa(e),i=1<<n,s|=t[n],e&=~i;return s}function fY(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mY(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,i=t.expirationTimes,c=t.pendingLanes;0<c;){var l=31-Wa(c),d=1<<l,p=i[l];p===-1?(!(d&n)||d&s)&&(i[l]=fY(d,e)):p<=e&&(t.expiredLanes|=d),c&=~d}}function MI(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function fF(){var t=KE;return KE<<=1,!(KE&4194240)&&(KE=64),t}function bT(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function qm(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Wa(e),t[e]=n}function gY(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Wa(n),c=1<<i;e[i]=0,s[i]=-1,t[i]=-1,n&=~c}}function SC(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-Wa(n),i=1<<s;i&e|t[s]&e&&(t[s]|=e),n&=~i}}var rr=0;function mF(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var gF,TC,EF,_F,yF,$I=!1,XE=[],Zu=null,el=null,tl=null,Cm=new Map,wm=new Map,Ku=[],EY="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pL(t,e){switch(t){case"focusin":case"focusout":Zu=null;break;case"dragenter":case"dragleave":el=null;break;case"mouseover":case"mouseout":tl=null;break;case"pointerover":case"pointerout":Cm.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":wm.delete(e.pointerId)}}function jf(t,e,n,s,i,c){return t===null||t.nativeEvent!==c?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:c,targetContainers:[i]},e!==null&&(e=Ym(e),e!==null&&TC(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function _Y(t,e,n,s,i){switch(e){case"focusin":return Zu=jf(Zu,t,e,n,s,i),!0;case"dragenter":return el=jf(el,t,e,n,s,i),!0;case"mouseover":return tl=jf(tl,t,e,n,s,i),!0;case"pointerover":var c=i.pointerId;return Cm.set(c,jf(Cm.get(c)||null,t,e,n,s,i)),!0;case"gotpointercapture":return c=i.pointerId,wm.set(c,jf(wm.get(c)||null,t,e,n,s,i)),!0}return!1}function vF(t){var e=ld(t.target);if(e!==null){var n=Fd(e);if(n!==null){if(e=n.tag,e===13){if(e=cF(n),e!==null){t.blockedOn=e,yF(t.priority,function(){EF(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function E0(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=FI(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);kI=s,n.target.dispatchEvent(s),kI=null}else return e=Ym(n),e!==null&&TC(e),t.blockedOn=n,!1;e.shift()}return!0}function fL(t,e,n){E0(t)&&n.delete(e)}function yY(){$I=!1,Zu!==null&&E0(Zu)&&(Zu=null),el!==null&&E0(el)&&(el=null),tl!==null&&E0(tl)&&(tl=null),Cm.forEach(fL),wm.forEach(fL)}function Wf(t,e){t.blockedOn===e&&(t.blockedOn=null,$I||($I=!0,Wi.unstable_scheduleCallback(Wi.unstable_NormalPriority,yY)))}function Rm(t){function e(i){return Wf(i,t)}if(0<XE.length){Wf(XE[0],t);for(var n=1;n<XE.length;n++){var s=XE[n];s.blockedOn===t&&(s.blockedOn=null)}}for(Zu!==null&&Wf(Zu,t),el!==null&&Wf(el,t),tl!==null&&Wf(tl,t),Cm.forEach(e),wm.forEach(e),n=0;n<Ku.length;n++)s=Ku[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<Ku.length&&(n=Ku[0],n.blockedOn===null);)vF(n),n.blockedOn===null&&Ku.shift()}var up=iu.ReactCurrentBatchConfig,F0=!0;function vY(t,e,n,s){var i=rr,c=up.transition;up.transition=null;try{rr=1,IC(t,e,n,s)}finally{rr=i,up.transition=c}}function SY(t,e,n,s){var i=rr,c=up.transition;up.transition=null;try{rr=4,IC(t,e,n,s)}finally{rr=i,up.transition=c}}function IC(t,e,n,s){if(F0){var i=FI(t,e,n,s);if(i===null)$T(t,e,s,U0,n),pL(t,s);else if(_Y(i,t,e,n,s))s.stopPropagation();else if(pL(t,s),e&4&&-1<EY.indexOf(t)){for(;i!==null;){var c=Ym(i);if(c!==null&&gF(c),c=FI(t,e,n,s),c===null&&$T(t,e,s,U0,n),c===i)break;i=c}i!==null&&s.stopPropagation()}else $T(t,e,s,null,n)}}var U0=null;function FI(t,e,n,s){if(U0=null,t=yC(s),t=ld(t),t!==null)if(e=Fd(t),e===null)t=null;else if(n=e.tag,n===13){if(t=cF(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return U0=t,null}function SF(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(cY()){case vC:return 1;case hF:return 4;case M0:case uY:return 16;case pF:return 536870912;default:return 16}default:return 16}}var Xu=null,CC=null,_0=null;function TF(){if(_0)return _0;var t,e=CC,n=e.length,s,i="value"in Xu?Xu.value:Xu.textContent,c=i.length;for(t=0;t<n&&e[t]===i[t];t++);var l=n-t;for(s=1;s<=l&&e[n-s]===i[c-s];s++);return _0=i.slice(t,1<s?1-s:void 0)}function y0(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function YE(){return!0}function mL(){return!1}function zi(t){function e(n,s,i,c,l){this._reactName=n,this._targetInst=i,this.type=s,this.nativeEvent=c,this.target=l,this.currentTarget=null;for(var d in t)t.hasOwnProperty(d)&&(n=t[d],this[d]=n?n(c):c[d]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?YE:mL,this.isPropagationStopped=mL,this}return Yr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=YE)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=YE)},persist:function(){},isPersistent:YE}),e}var $p={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wC=zi($p),Xm=Yr({},$p,{view:0,detail:0}),TY=zi(Xm),NT,AT,Gf,A1=Yr({},Xm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:RC,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Gf&&(Gf&&t.type==="mousemove"?(NT=t.screenX-Gf.screenX,AT=t.screenY-Gf.screenY):AT=NT=0,Gf=t),NT)},movementY:function(t){return"movementY"in t?t.movementY:AT}}),gL=zi(A1),IY=Yr({},A1,{dataTransfer:0}),CY=zi(IY),wY=Yr({},Xm,{relatedTarget:0}),OT=zi(wY),RY=Yr({},$p,{animationName:0,elapsedTime:0,pseudoElement:0}),bY=zi(RY),NY=Yr({},$p,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),AY=zi(NY),OY=Yr({},$p,{data:0}),EL=zi(OY),xY={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kY={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},DY={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function PY(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=DY[t])?!!e[t]:!1}function RC(){return PY}var LY=Yr({},Xm,{key:function(t){if(t.key){var e=xY[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=y0(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?kY[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:RC,charCode:function(t){return t.type==="keypress"?y0(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?y0(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),MY=zi(LY),$Y=Yr({},A1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_L=zi($Y),FY=Yr({},Xm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:RC}),UY=zi(FY),VY=Yr({},$p,{propertyName:0,elapsedTime:0,pseudoElement:0}),BY=zi(VY),jY=Yr({},A1,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),WY=zi(jY),GY=[9,13,27,32],bC=Yc&&"CompositionEvent"in window,lm=null;Yc&&"documentMode"in document&&(lm=document.documentMode);var zY=Yc&&"TextEvent"in window&&!lm,IF=Yc&&(!bC||lm&&8<lm&&11>=lm),yL=String.fromCharCode(32),vL=!1;function CF(t,e){switch(t){case"keyup":return GY.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wF(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var qh=!1;function HY(t,e){switch(t){case"compositionend":return wF(e);case"keypress":return e.which!==32?null:(vL=!0,yL);case"textInput":return t=e.data,t===yL&&vL?null:t;default:return null}}function KY(t,e){if(qh)return t==="compositionend"||!bC&&CF(t,e)?(t=TF(),_0=CC=Xu=null,qh=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return IF&&e.locale!=="ko"?null:e.data;default:return null}}var qY={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function SL(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!qY[t.type]:e==="textarea"}function RF(t,e,n,s){rF(s),e=V0(e,"onChange"),0<e.length&&(n=new wC("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var dm=null,bm=null;function XY(t){$F(t,0)}function O1(t){var e=Jh(t);if(Y$(e))return t}function YY(t,e){if(t==="change")return e}var bF=!1;if(Yc){var xT;if(Yc){var kT="oninput"in document;if(!kT){var TL=document.createElement("div");TL.setAttribute("oninput","return;"),kT=typeof TL.oninput=="function"}xT=kT}else xT=!1;bF=xT&&(!document.documentMode||9<document.documentMode)}function IL(){dm&&(dm.detachEvent("onpropertychange",NF),bm=dm=null)}function NF(t){if(t.propertyName==="value"&&O1(bm)){var e=[];RF(e,bm,t,yC(t)),aF(XY,e)}}function JY(t,e,n){t==="focusin"?(IL(),dm=e,bm=n,dm.attachEvent("onpropertychange",NF)):t==="focusout"&&IL()}function QY(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return O1(bm)}function ZY(t,e){if(t==="click")return O1(e)}function eJ(t,e){if(t==="input"||t==="change")return O1(e)}function tJ(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ha=typeof Object.is=="function"?Object.is:tJ;function Nm(t,e){if(Ha(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var i=n[s];if(!vI.call(e,i)||!Ha(t[i],e[i]))return!1}return!0}function CL(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function wL(t,e){var n=CL(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=CL(n)}}function AF(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?AF(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function OF(){for(var t=window,e=D0();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=D0(t.document)}return e}function NC(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function nJ(t){var e=OF(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&AF(n.ownerDocument.documentElement,n)){if(s!==null&&NC(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,c=Math.min(s.start,i);s=s.end===void 0?c:Math.min(s.end,i),!t.extend&&c>s&&(i=s,s=c,c=i),i=wL(n,c);var l=wL(n,s);i&&l&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==l.node||t.focusOffset!==l.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),c>s?(t.addRange(e),t.extend(l.node,l.offset)):(e.setEnd(l.node,l.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var rJ=Yc&&"documentMode"in document&&11>=document.documentMode,Xh=null,UI=null,hm=null,VI=!1;function RL(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;VI||Xh==null||Xh!==D0(s)||(s=Xh,"selectionStart"in s&&NC(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),hm&&Nm(hm,s)||(hm=s,s=V0(UI,"onSelect"),0<s.length&&(e=new wC("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=Xh)))}function JE(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Yh={animationend:JE("Animation","AnimationEnd"),animationiteration:JE("Animation","AnimationIteration"),animationstart:JE("Animation","AnimationStart"),transitionend:JE("Transition","TransitionEnd")},DT={},xF={};Yc&&(xF=document.createElement("div").style,"AnimationEvent"in window||(delete Yh.animationend.animation,delete Yh.animationiteration.animation,delete Yh.animationstart.animation),"TransitionEvent"in window||delete Yh.transitionend.transition);function x1(t){if(DT[t])return DT[t];if(!Yh[t])return t;var e=Yh[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in xF)return DT[t]=e[n];return t}var kF=x1("animationend"),DF=x1("animationiteration"),PF=x1("animationstart"),LF=x1("transitionend"),MF=new Map,bL="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function El(t,e){MF.set(t,e),$d(e,[t])}for(var PT=0;PT<bL.length;PT++){var LT=bL[PT],sJ=LT.toLowerCase(),oJ=LT[0].toUpperCase()+LT.slice(1);El(sJ,"on"+oJ)}El(kF,"onAnimationEnd");El(DF,"onAnimationIteration");El(PF,"onAnimationStart");El("dblclick","onDoubleClick");El("focusin","onFocus");El("focusout","onBlur");El(LF,"onTransitionEnd");gp("onMouseEnter",["mouseout","mouseover"]);gp("onMouseLeave",["mouseout","mouseover"]);gp("onPointerEnter",["pointerout","pointerover"]);gp("onPointerLeave",["pointerout","pointerover"]);$d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));$d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));$d("onBeforeInput",["compositionend","keypress","textInput","paste"]);$d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));$d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));$d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var em="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),iJ=new Set("cancel close invalid load scroll toggle".split(" ").concat(em));function NL(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,sY(s,e,void 0,t),t.currentTarget=null}function $F(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],i=s.event;s=s.listeners;e:{var c=void 0;if(e)for(var l=s.length-1;0<=l;l--){var d=s[l],p=d.instance,f=d.currentTarget;if(d=d.listener,p!==c&&i.isPropagationStopped())break e;NL(i,d,f),c=p}else for(l=0;l<s.length;l++){if(d=s[l],p=d.instance,f=d.currentTarget,d=d.listener,p!==c&&i.isPropagationStopped())break e;NL(i,d,f),c=p}}}if(L0)throw t=LI,L0=!1,LI=null,t}function kr(t,e){var n=e[zI];n===void 0&&(n=e[zI]=new Set);var s=t+"__bubble";n.has(s)||(FF(e,t,2,!1),n.add(s))}function MT(t,e,n){var s=0;e&&(s|=4),FF(n,t,s,e)}var QE="_reactListening"+Math.random().toString(36).slice(2);function Am(t){if(!t[QE]){t[QE]=!0,z$.forEach(function(n){n!=="selectionchange"&&(iJ.has(n)||MT(n,!1,t),MT(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[QE]||(e[QE]=!0,MT("selectionchange",!1,e))}}function FF(t,e,n,s){switch(SF(e)){case 1:var i=vY;break;case 4:i=SY;break;default:i=IC}n=i.bind(null,e,n,t),i=void 0,!PI||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),s?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function $T(t,e,n,s,i){var c=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var l=s.tag;if(l===3||l===4){var d=s.stateNode.containerInfo;if(d===i||d.nodeType===8&&d.parentNode===i)break;if(l===4)for(l=s.return;l!==null;){var p=l.tag;if((p===3||p===4)&&(p=l.stateNode.containerInfo,p===i||p.nodeType===8&&p.parentNode===i))return;l=l.return}for(;d!==null;){if(l=ld(d),l===null)return;if(p=l.tag,p===5||p===6){s=c=l;continue e}d=d.parentNode}}s=s.return}aF(function(){var f=c,m=yC(n),_=[];e:{var y=MF.get(t);if(y!==void 0){var v=wC,I=t;switch(t){case"keypress":if(y0(n)===0)break e;case"keydown":case"keyup":v=MY;break;case"focusin":I="focus",v=OT;break;case"focusout":I="blur",v=OT;break;case"beforeblur":case"afterblur":v=OT;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":v=gL;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":v=CY;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":v=UY;break;case kF:case DF:case PF:v=bY;break;case LF:v=BY;break;case"scroll":v=TY;break;case"wheel":v=WY;break;case"copy":case"cut":case"paste":v=AY;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":v=_L}var b=(e&4)!==0,A=!b&&t==="scroll",R=b?y!==null?y+"Capture":null:y;b=[];for(var O=f,L;O!==null;){L=O;var $=L.stateNode;if(L.tag===5&&$!==null&&(L=$,R!==null&&($=Im(O,R),$!=null&&b.push(Om(O,$,L)))),A)break;O=O.return}0<b.length&&(y=new v(y,I,null,n,m),_.push({event:y,listeners:b}))}}if(!(e&7)){e:{if(y=t==="mouseover"||t==="pointerover",v=t==="mouseout"||t==="pointerout",y&&n!==kI&&(I=n.relatedTarget||n.fromElement)&&(ld(I)||I[Jc]))break e;if((v||y)&&(y=m.window===m?m:(y=m.ownerDocument)?y.defaultView||y.parentWindow:window,v?(I=n.relatedTarget||n.toElement,v=f,I=I?ld(I):null,I!==null&&(A=Fd(I),I!==A||I.tag!==5&&I.tag!==6)&&(I=null)):(v=null,I=f),v!==I)){if(b=gL,$="onMouseLeave",R="onMouseEnter",O="mouse",(t==="pointerout"||t==="pointerover")&&(b=_L,$="onPointerLeave",R="onPointerEnter",O="pointer"),A=v==null?y:Jh(v),L=I==null?y:Jh(I),y=new b($,O+"leave",v,n,m),y.target=A,y.relatedTarget=L,$=null,ld(m)===f&&(b=new b(R,O+"enter",I,n,m),b.target=L,b.relatedTarget=A,$=b),A=$,v&&I)t:{for(b=v,R=I,O=0,L=b;L;L=Bh(L))O++;for(L=0,$=R;$;$=Bh($))L++;for(;0<O-L;)b=Bh(b),O--;for(;0<L-O;)R=Bh(R),L--;for(;O--;){if(b===R||R!==null&&b===R.alternate)break t;b=Bh(b),R=Bh(R)}b=null}else b=null;v!==null&&AL(_,y,v,b,!1),I!==null&&A!==null&&AL(_,A,I,b,!0)}}e:{if(y=f?Jh(f):window,v=y.nodeName&&y.nodeName.toLowerCase(),v==="select"||v==="input"&&y.type==="file")var G=YY;else if(SL(y))if(bF)G=eJ;else{G=QY;var H=JY}else(v=y.nodeName)&&v.toLowerCase()==="input"&&(y.type==="checkbox"||y.type==="radio")&&(G=ZY);if(G&&(G=G(t,f))){RF(_,G,n,m);break e}H&&H(t,y,f),t==="focusout"&&(H=y._wrapperState)&&H.controlled&&y.type==="number"&&bI(y,"number",y.value)}switch(H=f?Jh(f):window,t){case"focusin":(SL(H)||H.contentEditable==="true")&&(Xh=H,UI=f,hm=null);break;case"focusout":hm=UI=Xh=null;break;case"mousedown":VI=!0;break;case"contextmenu":case"mouseup":case"dragend":VI=!1,RL(_,n,m);break;case"selectionchange":if(rJ)break;case"keydown":case"keyup":RL(_,n,m)}var Z;if(bC)e:{switch(t){case"compositionstart":var re="onCompositionStart";break e;case"compositionend":re="onCompositionEnd";break e;case"compositionupdate":re="onCompositionUpdate";break e}re=void 0}else qh?CF(t,n)&&(re="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(re="onCompositionStart");re&&(IF&&n.locale!=="ko"&&(qh||re!=="onCompositionStart"?re==="onCompositionEnd"&&qh&&(Z=TF()):(Xu=m,CC="value"in Xu?Xu.value:Xu.textContent,qh=!0)),H=V0(f,re),0<H.length&&(re=new EL(re,t,null,n,m),_.push({event:re,listeners:H}),Z?re.data=Z:(Z=wF(n),Z!==null&&(re.data=Z)))),(Z=zY?HY(t,n):KY(t,n))&&(f=V0(f,"onBeforeInput"),0<f.length&&(m=new EL("onBeforeInput","beforeinput",null,n,m),_.push({event:m,listeners:f}),m.data=Z))}$F(_,e)})}function Om(t,e,n){return{instance:t,listener:e,currentTarget:n}}function V0(t,e){for(var n=e+"Capture",s=[];t!==null;){var i=t,c=i.stateNode;i.tag===5&&c!==null&&(i=c,c=Im(t,n),c!=null&&s.unshift(Om(t,c,i)),c=Im(t,e),c!=null&&s.push(Om(t,c,i))),t=t.return}return s}function Bh(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function AL(t,e,n,s,i){for(var c=e._reactName,l=[];n!==null&&n!==s;){var d=n,p=d.alternate,f=d.stateNode;if(p!==null&&p===s)break;d.tag===5&&f!==null&&(d=f,i?(p=Im(n,c),p!=null&&l.unshift(Om(n,p,d))):i||(p=Im(n,c),p!=null&&l.push(Om(n,p,d)))),n=n.return}l.length!==0&&t.push({event:e,listeners:l})}var aJ=/\r\n?/g,cJ=/\u0000|\uFFFD/g;function OL(t){return(typeof t=="string"?t:""+t).replace(aJ,`
`).replace(cJ,"")}function ZE(t,e,n){if(e=OL(e),OL(t)!==e&&n)throw Error(ot(425))}function B0(){}var BI=null,jI=null;function WI(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var GI=typeof setTimeout=="function"?setTimeout:void 0,uJ=typeof clearTimeout=="function"?clearTimeout:void 0,xL=typeof Promise=="function"?Promise:void 0,lJ=typeof queueMicrotask=="function"?queueMicrotask:typeof xL<"u"?function(t){return xL.resolve(null).then(t).catch(dJ)}:GI;function dJ(t){setTimeout(function(){throw t})}function FT(t,e){var n=e,s=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(s===0){t.removeChild(i),Rm(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=i}while(n);Rm(e)}function nl(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function kL(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Fp=Math.random().toString(36).slice(2),fc="__reactFiber$"+Fp,xm="__reactProps$"+Fp,Jc="__reactContainer$"+Fp,zI="__reactEvents$"+Fp,hJ="__reactListeners$"+Fp,pJ="__reactHandles$"+Fp;function ld(t){var e=t[fc];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Jc]||n[fc]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=kL(t);t!==null;){if(n=t[fc])return n;t=kL(t)}return e}t=n,n=t.parentNode}return null}function Ym(t){return t=t[fc]||t[Jc],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Jh(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ot(33))}function k1(t){return t[xm]||null}var HI=[],Qh=-1;function _l(t){return{current:t}}function Pr(t){0>Qh||(t.current=HI[Qh],HI[Qh]=null,Qh--)}function wr(t,e){Qh++,HI[Qh]=t.current,t.current=e}var hl={},Lo=_l(hl),li=_l(!1),Td=hl;function Ep(t,e){var n=t.type.contextTypes;if(!n)return hl;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var i={},c;for(c in n)i[c]=e[c];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function di(t){return t=t.childContextTypes,t!=null}function j0(){Pr(li),Pr(Lo)}function DL(t,e,n){if(Lo.current!==hl)throw Error(ot(168));wr(Lo,e),wr(li,n)}function UF(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var i in s)if(!(i in e))throw Error(ot(108,JX(t)||"Unknown",i));return Yr({},n,s)}function W0(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||hl,Td=Lo.current,wr(Lo,t),wr(li,li.current),!0}function PL(t,e,n){var s=t.stateNode;if(!s)throw Error(ot(169));n?(t=UF(t,e,Td),s.__reactInternalMemoizedMergedChildContext=t,Pr(li),Pr(Lo),wr(Lo,t)):Pr(li),wr(li,n)}var Vc=null,D1=!1,UT=!1;function VF(t){Vc===null?Vc=[t]:Vc.push(t)}function fJ(t){D1=!0,VF(t)}function yl(){if(!UT&&Vc!==null){UT=!0;var t=0,e=rr;try{var n=Vc;for(rr=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}Vc=null,D1=!1}catch(i){throw Vc!==null&&(Vc=Vc.slice(t+1)),dF(vC,yl),i}finally{rr=e,UT=!1}}return null}var Zh=[],ep=0,G0=null,z0=0,la=[],da=0,Id=null,Wc=1,Gc="";function od(t,e){Zh[ep++]=z0,Zh[ep++]=G0,G0=t,z0=e}function BF(t,e,n){la[da++]=Wc,la[da++]=Gc,la[da++]=Id,Id=t;var s=Wc;t=Gc;var i=32-Wa(s)-1;s&=~(1<<i),n+=1;var c=32-Wa(e)+i;if(30<c){var l=i-i%5;c=(s&(1<<l)-1).toString(32),s>>=l,i-=l,Wc=1<<32-Wa(e)+i|n<<i|s,Gc=c+t}else Wc=1<<c|n<<i|s,Gc=t}function AC(t){t.return!==null&&(od(t,1),BF(t,1,0))}function OC(t){for(;t===G0;)G0=Zh[--ep],Zh[ep]=null,z0=Zh[--ep],Zh[ep]=null;for(;t===Id;)Id=la[--da],la[da]=null,Gc=la[--da],la[da]=null,Wc=la[--da],la[da]=null}var ji=null,Ui=null,Vr=!1,Ua=null;function jF(t,e){var n=pa(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function LL(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ji=t,Ui=nl(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ji=t,Ui=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Id!==null?{id:Wc,overflow:Gc}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=pa(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ji=t,Ui=null,!0):!1;default:return!1}}function KI(t){return(t.mode&1)!==0&&(t.flags&128)===0}function qI(t){if(Vr){var e=Ui;if(e){var n=e;if(!LL(t,e)){if(KI(t))throw Error(ot(418));e=nl(n.nextSibling);var s=ji;e&&LL(t,e)?jF(s,n):(t.flags=t.flags&-4097|2,Vr=!1,ji=t)}}else{if(KI(t))throw Error(ot(418));t.flags=t.flags&-4097|2,Vr=!1,ji=t}}}function ML(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ji=t}function e0(t){if(t!==ji)return!1;if(!Vr)return ML(t),Vr=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!WI(t.type,t.memoizedProps)),e&&(e=Ui)){if(KI(t))throw WF(),Error(ot(418));for(;e;)jF(t,e),e=nl(e.nextSibling)}if(ML(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ot(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Ui=nl(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Ui=null}}else Ui=ji?nl(t.stateNode.nextSibling):null;return!0}function WF(){for(var t=Ui;t;)t=nl(t.nextSibling)}function _p(){Ui=ji=null,Vr=!1}function xC(t){Ua===null?Ua=[t]:Ua.push(t)}var mJ=iu.ReactCurrentBatchConfig;function $a(t,e){if(t&&t.defaultProps){e=Yr({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var H0=_l(null),K0=null,tp=null,kC=null;function DC(){kC=tp=K0=null}function PC(t){var e=H0.current;Pr(H0),t._currentValue=e}function XI(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function lp(t,e){K0=t,kC=tp=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(ci=!0),t.firstContext=null)}function va(t){var e=t._currentValue;if(kC!==t)if(t={context:t,memoizedValue:e,next:null},tp===null){if(K0===null)throw Error(ot(308));tp=t,K0.dependencies={lanes:0,firstContext:t}}else tp=tp.next=t;return e}var dd=null;function LC(t){dd===null?dd=[t]:dd.push(t)}function GF(t,e,n,s){var i=e.interleaved;return i===null?(n.next=n,LC(e)):(n.next=i.next,i.next=n),e.interleaved=n,Qc(t,s)}function Qc(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var zu=!1;function MC(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zF(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function qc(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function rl(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,Mn&2){var i=s.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),s.pending=e,Qc(t,n)}return i=s.interleaved,i===null?(e.next=e,LC(s)):(e.next=i.next,i.next=e),s.interleaved=e,Qc(t,n)}function v0(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,SC(t,n)}}function $L(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var i=null,c=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};c===null?i=c=l:c=c.next=l,n=n.next}while(n!==null);c===null?i=c=e:c=c.next=e}else i=c=e;n={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:c,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function q0(t,e,n,s){var i=t.updateQueue;zu=!1;var c=i.firstBaseUpdate,l=i.lastBaseUpdate,d=i.shared.pending;if(d!==null){i.shared.pending=null;var p=d,f=p.next;p.next=null,l===null?c=f:l.next=f,l=p;var m=t.alternate;m!==null&&(m=m.updateQueue,d=m.lastBaseUpdate,d!==l&&(d===null?m.firstBaseUpdate=f:d.next=f,m.lastBaseUpdate=p))}if(c!==null){var _=i.baseState;l=0,m=f=p=null,d=c;do{var y=d.lane,v=d.eventTime;if((s&y)===y){m!==null&&(m=m.next={eventTime:v,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var I=t,b=d;switch(y=e,v=n,b.tag){case 1:if(I=b.payload,typeof I=="function"){_=I.call(v,_,y);break e}_=I;break e;case 3:I.flags=I.flags&-65537|128;case 0:if(I=b.payload,y=typeof I=="function"?I.call(v,_,y):I,y==null)break e;_=Yr({},_,y);break e;case 2:zu=!0}}d.callback!==null&&d.lane!==0&&(t.flags|=64,y=i.effects,y===null?i.effects=[d]:y.push(d))}else v={eventTime:v,lane:y,tag:d.tag,payload:d.payload,callback:d.callback,next:null},m===null?(f=m=v,p=_):m=m.next=v,l|=y;if(d=d.next,d===null){if(d=i.shared.pending,d===null)break;y=d,d=y.next,y.next=null,i.lastBaseUpdate=y,i.shared.pending=null}}while(1);if(m===null&&(p=_),i.baseState=p,i.firstBaseUpdate=f,i.lastBaseUpdate=m,e=i.shared.interleaved,e!==null){i=e;do l|=i.lane,i=i.next;while(i!==e)}else c===null&&(i.shared.lanes=0);wd|=l,t.lanes=l,t.memoizedState=_}}function FL(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],i=s.callback;if(i!==null){if(s.callback=null,s=n,typeof i!="function")throw Error(ot(191,i));i.call(s)}}}var HF=new G$.Component().refs;function YI(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:Yr({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var P1={isMounted:function(t){return(t=t._reactInternals)?Fd(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=zo(),i=ol(t),c=qc(s,i);c.payload=e,n!=null&&(c.callback=n),e=rl(t,c,i),e!==null&&(Ga(e,t,i,s),v0(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=zo(),i=ol(t),c=qc(s,i);c.tag=1,c.payload=e,n!=null&&(c.callback=n),e=rl(t,c,i),e!==null&&(Ga(e,t,i,s),v0(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=zo(),s=ol(t),i=qc(n,s);i.tag=2,e!=null&&(i.callback=e),e=rl(t,i,s),e!==null&&(Ga(e,t,s,n),v0(e,t,s))}};function UL(t,e,n,s,i,c,l){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,c,l):e.prototype&&e.prototype.isPureReactComponent?!Nm(n,s)||!Nm(i,c):!0}function KF(t,e,n){var s=!1,i=hl,c=e.contextType;return typeof c=="object"&&c!==null?c=va(c):(i=di(e)?Td:Lo.current,s=e.contextTypes,c=(s=s!=null)?Ep(t,i):hl),e=new e(n,c),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=P1,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=c),e}function VL(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&P1.enqueueReplaceState(e,e.state,null)}function JI(t,e,n,s){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs=HF,MC(t);var c=e.contextType;typeof c=="object"&&c!==null?i.context=va(c):(c=di(e)?Td:Lo.current,i.context=Ep(t,c)),i.state=t.memoizedState,c=e.getDerivedStateFromProps,typeof c=="function"&&(YI(t,e,c,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&P1.enqueueReplaceState(i,i.state,null),q0(t,n,i,s),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function zf(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ot(309));var s=n.stateNode}if(!s)throw Error(ot(147,t));var i=s,c=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===c?e.ref:(e=function(l){var d=i.refs;d===HF&&(d=i.refs={}),l===null?delete d[c]:d[c]=l},e._stringRef=c,e)}if(typeof t!="string")throw Error(ot(284));if(!n._owner)throw Error(ot(290,t))}return t}function t0(t,e){throw t=Object.prototype.toString.call(e),Error(ot(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function BL(t){var e=t._init;return e(t._payload)}function qF(t){function e(R,O){if(t){var L=R.deletions;L===null?(R.deletions=[O],R.flags|=16):L.push(O)}}function n(R,O){if(!t)return null;for(;O!==null;)e(R,O),O=O.sibling;return null}function s(R,O){for(R=new Map;O!==null;)O.key!==null?R.set(O.key,O):R.set(O.index,O),O=O.sibling;return R}function i(R,O){return R=il(R,O),R.index=0,R.sibling=null,R}function c(R,O,L){return R.index=L,t?(L=R.alternate,L!==null?(L=L.index,L<O?(R.flags|=2,O):L):(R.flags|=2,O)):(R.flags|=1048576,O)}function l(R){return t&&R.alternate===null&&(R.flags|=2),R}function d(R,O,L,$){return O===null||O.tag!==6?(O=HT(L,R.mode,$),O.return=R,O):(O=i(O,L),O.return=R,O)}function p(R,O,L,$){var G=L.type;return G===Kh?m(R,O,L.props.children,$,L.key):O!==null&&(O.elementType===G||typeof G=="object"&&G!==null&&G.$$typeof===Gu&&BL(G)===O.type)?($=i(O,L.props),$.ref=zf(R,O,L),$.return=R,$):($=R0(L.type,L.key,L.props,null,R.mode,$),$.ref=zf(R,O,L),$.return=R,$)}function f(R,O,L,$){return O===null||O.tag!==4||O.stateNode.containerInfo!==L.containerInfo||O.stateNode.implementation!==L.implementation?(O=KT(L,R.mode,$),O.return=R,O):(O=i(O,L.children||[]),O.return=R,O)}function m(R,O,L,$,G){return O===null||O.tag!==7?(O=yd(L,R.mode,$,G),O.return=R,O):(O=i(O,L),O.return=R,O)}function _(R,O,L){if(typeof O=="string"&&O!==""||typeof O=="number")return O=HT(""+O,R.mode,L),O.return=R,O;if(typeof O=="object"&&O!==null){switch(O.$$typeof){case GE:return L=R0(O.type,O.key,O.props,null,R.mode,L),L.ref=zf(R,null,O),L.return=R,L;case Hh:return O=KT(O,R.mode,L),O.return=R,O;case Gu:var $=O._init;return _(R,$(O._payload),L)}if(Qf(O)||Vf(O))return O=yd(O,R.mode,L,null),O.return=R,O;t0(R,O)}return null}function y(R,O,L,$){var G=O!==null?O.key:null;if(typeof L=="string"&&L!==""||typeof L=="number")return G!==null?null:d(R,O,""+L,$);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case GE:return L.key===G?p(R,O,L,$):null;case Hh:return L.key===G?f(R,O,L,$):null;case Gu:return G=L._init,y(R,O,G(L._payload),$)}if(Qf(L)||Vf(L))return G!==null?null:m(R,O,L,$,null);t0(R,L)}return null}function v(R,O,L,$,G){if(typeof $=="string"&&$!==""||typeof $=="number")return R=R.get(L)||null,d(O,R,""+$,G);if(typeof $=="object"&&$!==null){switch($.$$typeof){case GE:return R=R.get($.key===null?L:$.key)||null,p(O,R,$,G);case Hh:return R=R.get($.key===null?L:$.key)||null,f(O,R,$,G);case Gu:var H=$._init;return v(R,O,L,H($._payload),G)}if(Qf($)||Vf($))return R=R.get(L)||null,m(O,R,$,G,null);t0(O,$)}return null}function I(R,O,L,$){for(var G=null,H=null,Z=O,re=O=0,oe=null;Z!==null&&re<L.length;re++){Z.index>re?(oe=Z,Z=null):oe=Z.sibling;var ae=y(R,Z,L[re],$);if(ae===null){Z===null&&(Z=oe);break}t&&Z&&ae.alternate===null&&e(R,Z),O=c(ae,O,re),H===null?G=ae:H.sibling=ae,H=ae,Z=oe}if(re===L.length)return n(R,Z),Vr&&od(R,re),G;if(Z===null){for(;re<L.length;re++)Z=_(R,L[re],$),Z!==null&&(O=c(Z,O,re),H===null?G=Z:H.sibling=Z,H=Z);return Vr&&od(R,re),G}for(Z=s(R,Z);re<L.length;re++)oe=v(Z,R,re,L[re],$),oe!==null&&(t&&oe.alternate!==null&&Z.delete(oe.key===null?re:oe.key),O=c(oe,O,re),H===null?G=oe:H.sibling=oe,H=oe);return t&&Z.forEach(function(Ee){return e(R,Ee)}),Vr&&od(R,re),G}function b(R,O,L,$){var G=Vf(L);if(typeof G!="function")throw Error(ot(150));if(L=G.call(L),L==null)throw Error(ot(151));for(var H=G=null,Z=O,re=O=0,oe=null,ae=L.next();Z!==null&&!ae.done;re++,ae=L.next()){Z.index>re?(oe=Z,Z=null):oe=Z.sibling;var Ee=y(R,Z,ae.value,$);if(Ee===null){Z===null&&(Z=oe);break}t&&Z&&Ee.alternate===null&&e(R,Z),O=c(Ee,O,re),H===null?G=Ee:H.sibling=Ee,H=Ee,Z=oe}if(ae.done)return n(R,Z),Vr&&od(R,re),G;if(Z===null){for(;!ae.done;re++,ae=L.next())ae=_(R,ae.value,$),ae!==null&&(O=c(ae,O,re),H===null?G=ae:H.sibling=ae,H=ae);return Vr&&od(R,re),G}for(Z=s(R,Z);!ae.done;re++,ae=L.next())ae=v(Z,R,re,ae.value,$),ae!==null&&(t&&ae.alternate!==null&&Z.delete(ae.key===null?re:ae.key),O=c(ae,O,re),H===null?G=ae:H.sibling=ae,H=ae);return t&&Z.forEach(function(Ce){return e(R,Ce)}),Vr&&od(R,re),G}function A(R,O,L,$){if(typeof L=="object"&&L!==null&&L.type===Kh&&L.key===null&&(L=L.props.children),typeof L=="object"&&L!==null){switch(L.$$typeof){case GE:e:{for(var G=L.key,H=O;H!==null;){if(H.key===G){if(G=L.type,G===Kh){if(H.tag===7){n(R,H.sibling),O=i(H,L.props.children),O.return=R,R=O;break e}}else if(H.elementType===G||typeof G=="object"&&G!==null&&G.$$typeof===Gu&&BL(G)===H.type){n(R,H.sibling),O=i(H,L.props),O.ref=zf(R,H,L),O.return=R,R=O;break e}n(R,H);break}else e(R,H);H=H.sibling}L.type===Kh?(O=yd(L.props.children,R.mode,$,L.key),O.return=R,R=O):($=R0(L.type,L.key,L.props,null,R.mode,$),$.ref=zf(R,O,L),$.return=R,R=$)}return l(R);case Hh:e:{for(H=L.key;O!==null;){if(O.key===H)if(O.tag===4&&O.stateNode.containerInfo===L.containerInfo&&O.stateNode.implementation===L.implementation){n(R,O.sibling),O=i(O,L.children||[]),O.return=R,R=O;break e}else{n(R,O);break}else e(R,O);O=O.sibling}O=KT(L,R.mode,$),O.return=R,R=O}return l(R);case Gu:return H=L._init,A(R,O,H(L._payload),$)}if(Qf(L))return I(R,O,L,$);if(Vf(L))return b(R,O,L,$);t0(R,L)}return typeof L=="string"&&L!==""||typeof L=="number"?(L=""+L,O!==null&&O.tag===6?(n(R,O.sibling),O=i(O,L),O.return=R,R=O):(n(R,O),O=HT(L,R.mode,$),O.return=R,R=O),l(R)):n(R,O)}return A}var yp=qF(!0),XF=qF(!1),Jm={},Ec=_l(Jm),km=_l(Jm),Dm=_l(Jm);function hd(t){if(t===Jm)throw Error(ot(174));return t}function $C(t,e){switch(wr(Dm,e),wr(km,t),wr(Ec,Jm),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:AI(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=AI(e,t)}Pr(Ec),wr(Ec,e)}function vp(){Pr(Ec),Pr(km),Pr(Dm)}function YF(t){hd(Dm.current);var e=hd(Ec.current),n=AI(e,t.type);e!==n&&(wr(km,t),wr(Ec,n))}function FC(t){km.current===t&&(Pr(Ec),Pr(km))}var Kr=_l(0);function X0(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var VT=[];function UC(){for(var t=0;t<VT.length;t++)VT[t]._workInProgressVersionPrimary=null;VT.length=0}var S0=iu.ReactCurrentDispatcher,BT=iu.ReactCurrentBatchConfig,Cd=0,qr=null,xs=null,Ws=null,Y0=!1,pm=!1,Pm=0,gJ=0;function bo(){throw Error(ot(321))}function VC(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ha(t[n],e[n]))return!1;return!0}function BC(t,e,n,s,i,c){if(Cd=c,qr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,S0.current=t===null||t.memoizedState===null?vJ:SJ,t=n(s,i),pm){c=0;do{if(pm=!1,Pm=0,25<=c)throw Error(ot(301));c+=1,Ws=xs=null,e.updateQueue=null,S0.current=TJ,t=n(s,i)}while(pm)}if(S0.current=J0,e=xs!==null&&xs.next!==null,Cd=0,Ws=xs=qr=null,Y0=!1,e)throw Error(ot(300));return t}function jC(){var t=Pm!==0;return Pm=0,t}function hc(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ws===null?qr.memoizedState=Ws=t:Ws=Ws.next=t,Ws}function Sa(){if(xs===null){var t=qr.alternate;t=t!==null?t.memoizedState:null}else t=xs.next;var e=Ws===null?qr.memoizedState:Ws.next;if(e!==null)Ws=e,xs=t;else{if(t===null)throw Error(ot(310));xs=t,t={memoizedState:xs.memoizedState,baseState:xs.baseState,baseQueue:xs.baseQueue,queue:xs.queue,next:null},Ws===null?qr.memoizedState=Ws=t:Ws=Ws.next=t}return Ws}function Lm(t,e){return typeof e=="function"?e(t):e}function jT(t){var e=Sa(),n=e.queue;if(n===null)throw Error(ot(311));n.lastRenderedReducer=t;var s=xs,i=s.baseQueue,c=n.pending;if(c!==null){if(i!==null){var l=i.next;i.next=c.next,c.next=l}s.baseQueue=i=c,n.pending=null}if(i!==null){c=i.next,s=s.baseState;var d=l=null,p=null,f=c;do{var m=f.lane;if((Cd&m)===m)p!==null&&(p=p.next={lane:0,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null}),s=f.hasEagerState?f.eagerState:t(s,f.action);else{var _={lane:m,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null};p===null?(d=p=_,l=s):p=p.next=_,qr.lanes|=m,wd|=m}f=f.next}while(f!==null&&f!==c);p===null?l=s:p.next=d,Ha(s,e.memoizedState)||(ci=!0),e.memoizedState=s,e.baseState=l,e.baseQueue=p,n.lastRenderedState=s}if(t=n.interleaved,t!==null){i=t;do c=i.lane,qr.lanes|=c,wd|=c,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function WT(t){var e=Sa(),n=e.queue;if(n===null)throw Error(ot(311));n.lastRenderedReducer=t;var s=n.dispatch,i=n.pending,c=e.memoizedState;if(i!==null){n.pending=null;var l=i=i.next;do c=t(c,l.action),l=l.next;while(l!==i);Ha(c,e.memoizedState)||(ci=!0),e.memoizedState=c,e.baseQueue===null&&(e.baseState=c),n.lastRenderedState=c}return[c,s]}function JF(){}function QF(t,e){var n=qr,s=Sa(),i=e(),c=!Ha(s.memoizedState,i);if(c&&(s.memoizedState=i,ci=!0),s=s.queue,WC(tU.bind(null,n,s,t),[t]),s.getSnapshot!==e||c||Ws!==null&&Ws.memoizedState.tag&1){if(n.flags|=2048,Mm(9,eU.bind(null,n,s,i,e),void 0,null),Hs===null)throw Error(ot(349));Cd&30||ZF(n,e,i)}return i}function ZF(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=qr.updateQueue,e===null?(e={lastEffect:null,stores:null},qr.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function eU(t,e,n,s){e.value=n,e.getSnapshot=s,nU(e)&&rU(t)}function tU(t,e,n){return n(function(){nU(e)&&rU(t)})}function nU(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ha(t,n)}catch{return!0}}function rU(t){var e=Qc(t,1);e!==null&&Ga(e,t,1,-1)}function jL(t){var e=hc();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Lm,lastRenderedState:t},e.queue=t,t=t.dispatch=yJ.bind(null,qr,t),[e.memoizedState,t]}function Mm(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=qr.updateQueue,e===null?(e={lastEffect:null,stores:null},qr.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function sU(){return Sa().memoizedState}function T0(t,e,n,s){var i=hc();qr.flags|=t,i.memoizedState=Mm(1|e,n,void 0,s===void 0?null:s)}function L1(t,e,n,s){var i=Sa();s=s===void 0?null:s;var c=void 0;if(xs!==null){var l=xs.memoizedState;if(c=l.destroy,s!==null&&VC(s,l.deps)){i.memoizedState=Mm(e,n,c,s);return}}qr.flags|=t,i.memoizedState=Mm(1|e,n,c,s)}function WL(t,e){return T0(8390656,8,t,e)}function WC(t,e){return L1(2048,8,t,e)}function oU(t,e){return L1(4,2,t,e)}function iU(t,e){return L1(4,4,t,e)}function aU(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function cU(t,e,n){return n=n!=null?n.concat([t]):null,L1(4,4,aU.bind(null,e,t),n)}function GC(){}function uU(t,e){var n=Sa();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&VC(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function lU(t,e){var n=Sa();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&VC(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function dU(t,e,n){return Cd&21?(Ha(n,e)||(n=fF(),qr.lanes|=n,wd|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,ci=!0),t.memoizedState=n)}function EJ(t,e){var n=rr;rr=n!==0&&4>n?n:4,t(!0);var s=BT.transition;BT.transition={};try{t(!1),e()}finally{rr=n,BT.transition=s}}function hU(){return Sa().memoizedState}function _J(t,e,n){var s=ol(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},pU(t))fU(e,n);else if(n=GF(t,e,n,s),n!==null){var i=zo();Ga(n,t,s,i),mU(n,e,s)}}function yJ(t,e,n){var s=ol(t),i={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(pU(t))fU(e,i);else{var c=t.alternate;if(t.lanes===0&&(c===null||c.lanes===0)&&(c=e.lastRenderedReducer,c!==null))try{var l=e.lastRenderedState,d=c(l,n);if(i.hasEagerState=!0,i.eagerState=d,Ha(d,l)){var p=e.interleaved;p===null?(i.next=i,LC(e)):(i.next=p.next,p.next=i),e.interleaved=i;return}}catch{}finally{}n=GF(t,e,i,s),n!==null&&(i=zo(),Ga(n,t,s,i),mU(n,e,s))}}function pU(t){var e=t.alternate;return t===qr||e!==null&&e===qr}function fU(t,e){pm=Y0=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function mU(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,SC(t,n)}}var J0={readContext:va,useCallback:bo,useContext:bo,useEffect:bo,useImperativeHandle:bo,useInsertionEffect:bo,useLayoutEffect:bo,useMemo:bo,useReducer:bo,useRef:bo,useState:bo,useDebugValue:bo,useDeferredValue:bo,useTransition:bo,useMutableSource:bo,useSyncExternalStore:bo,useId:bo,unstable_isNewReconciler:!1},vJ={readContext:va,useCallback:function(t,e){return hc().memoizedState=[t,e===void 0?null:e],t},useContext:va,useEffect:WL,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,T0(4194308,4,aU.bind(null,e,t),n)},useLayoutEffect:function(t,e){return T0(4194308,4,t,e)},useInsertionEffect:function(t,e){return T0(4,2,t,e)},useMemo:function(t,e){var n=hc();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=hc();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=_J.bind(null,qr,t),[s.memoizedState,t]},useRef:function(t){var e=hc();return t={current:t},e.memoizedState=t},useState:jL,useDebugValue:GC,useDeferredValue:function(t){return hc().memoizedState=t},useTransition:function(){var t=jL(!1),e=t[0];return t=EJ.bind(null,t[1]),hc().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=qr,i=hc();if(Vr){if(n===void 0)throw Error(ot(407));n=n()}else{if(n=e(),Hs===null)throw Error(ot(349));Cd&30||ZF(s,e,n)}i.memoizedState=n;var c={value:n,getSnapshot:e};return i.queue=c,WL(tU.bind(null,s,c,t),[t]),s.flags|=2048,Mm(9,eU.bind(null,s,c,n,e),void 0,null),n},useId:function(){var t=hc(),e=Hs.identifierPrefix;if(Vr){var n=Gc,s=Wc;n=(s&~(1<<32-Wa(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=Pm++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=gJ++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},SJ={readContext:va,useCallback:uU,useContext:va,useEffect:WC,useImperativeHandle:cU,useInsertionEffect:oU,useLayoutEffect:iU,useMemo:lU,useReducer:jT,useRef:sU,useState:function(){return jT(Lm)},useDebugValue:GC,useDeferredValue:function(t){var e=Sa();return dU(e,xs.memoizedState,t)},useTransition:function(){var t=jT(Lm)[0],e=Sa().memoizedState;return[t,e]},useMutableSource:JF,useSyncExternalStore:QF,useId:hU,unstable_isNewReconciler:!1},TJ={readContext:va,useCallback:uU,useContext:va,useEffect:WC,useImperativeHandle:cU,useInsertionEffect:oU,useLayoutEffect:iU,useMemo:lU,useReducer:WT,useRef:sU,useState:function(){return WT(Lm)},useDebugValue:GC,useDeferredValue:function(t){var e=Sa();return xs===null?e.memoizedState=t:dU(e,xs.memoizedState,t)},useTransition:function(){var t=WT(Lm)[0],e=Sa().memoizedState;return[t,e]},useMutableSource:JF,useSyncExternalStore:QF,useId:hU,unstable_isNewReconciler:!1};function Sp(t,e){try{var n="",s=e;do n+=YX(s),s=s.return;while(s);var i=n}catch(c){i=`
Error generating stack: `+c.message+`
`+c.stack}return{value:t,source:e,stack:i,digest:null}}function GT(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function QI(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var IJ=typeof WeakMap=="function"?WeakMap:Map;function gU(t,e,n){n=qc(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){Z0||(Z0=!0,c2=s),QI(t,e)},n}function EU(t,e,n){n=qc(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var i=e.value;n.payload=function(){return s(i)},n.callback=function(){QI(t,e)}}var c=t.stateNode;return c!==null&&typeof c.componentDidCatch=="function"&&(n.callback=function(){QI(t,e),typeof s!="function"&&(sl===null?sl=new Set([this]):sl.add(this));var l=e.stack;this.componentDidCatch(e.value,{componentStack:l!==null?l:""})}),n}function GL(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new IJ;var i=new Set;s.set(e,i)}else i=s.get(e),i===void 0&&(i=new Set,s.set(e,i));i.has(n)||(i.add(n),t=$J.bind(null,t,e,n),e.then(t,t))}function zL(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function HL(t,e,n,s,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=qc(-1,1),e.tag=2,rl(n,e,1))),n.lanes|=1),t)}var CJ=iu.ReactCurrentOwner,ci=!1;function Wo(t,e,n,s){e.child=t===null?XF(e,null,n,s):yp(e,t.child,n,s)}function KL(t,e,n,s,i){n=n.render;var c=e.ref;return lp(e,i),s=BC(t,e,n,s,c,i),n=jC(),t!==null&&!ci?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Zc(t,e,i)):(Vr&&n&&AC(e),e.flags|=1,Wo(t,e,s,i),e.child)}function qL(t,e,n,s,i){if(t===null){var c=n.type;return typeof c=="function"&&!QC(c)&&c.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=c,_U(t,e,c,s,i)):(t=R0(n.type,null,s,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(c=t.child,!(t.lanes&i)){var l=c.memoizedProps;if(n=n.compare,n=n!==null?n:Nm,n(l,s)&&t.ref===e.ref)return Zc(t,e,i)}return e.flags|=1,t=il(c,s),t.ref=e.ref,t.return=e,e.child=t}function _U(t,e,n,s,i){if(t!==null){var c=t.memoizedProps;if(Nm(c,s)&&t.ref===e.ref)if(ci=!1,e.pendingProps=s=c,(t.lanes&i)!==0)t.flags&131072&&(ci=!0);else return e.lanes=t.lanes,Zc(t,e,i)}return ZI(t,e,n,s,i)}function yU(t,e,n){var s=e.pendingProps,i=s.children,c=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},wr(rp,$i),$i|=n;else{if(!(n&1073741824))return t=c!==null?c.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,wr(rp,$i),$i|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=c!==null?c.baseLanes:n,wr(rp,$i),$i|=s}else c!==null?(s=c.baseLanes|n,e.memoizedState=null):s=n,wr(rp,$i),$i|=s;return Wo(t,e,i,n),e.child}function vU(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function ZI(t,e,n,s,i){var c=di(n)?Td:Lo.current;return c=Ep(e,c),lp(e,i),n=BC(t,e,n,s,c,i),s=jC(),t!==null&&!ci?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Zc(t,e,i)):(Vr&&s&&AC(e),e.flags|=1,Wo(t,e,n,i),e.child)}function XL(t,e,n,s,i){if(di(n)){var c=!0;W0(e)}else c=!1;if(lp(e,i),e.stateNode===null)I0(t,e),KF(e,n,s),JI(e,n,s,i),s=!0;else if(t===null){var l=e.stateNode,d=e.memoizedProps;l.props=d;var p=l.context,f=n.contextType;typeof f=="object"&&f!==null?f=va(f):(f=di(n)?Td:Lo.current,f=Ep(e,f));var m=n.getDerivedStateFromProps,_=typeof m=="function"||typeof l.getSnapshotBeforeUpdate=="function";_||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(d!==s||p!==f)&&VL(e,l,s,f),zu=!1;var y=e.memoizedState;l.state=y,q0(e,s,l,i),p=e.memoizedState,d!==s||y!==p||li.current||zu?(typeof m=="function"&&(YI(e,n,m,s),p=e.memoizedState),(d=zu||UL(e,n,d,s,y,p,f))?(_||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(e.flags|=4194308)):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=p),l.props=s,l.state=p,l.context=f,s=d):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{l=e.stateNode,zF(t,e),d=e.memoizedProps,f=e.type===e.elementType?d:$a(e.type,d),l.props=f,_=e.pendingProps,y=l.context,p=n.contextType,typeof p=="object"&&p!==null?p=va(p):(p=di(n)?Td:Lo.current,p=Ep(e,p));var v=n.getDerivedStateFromProps;(m=typeof v=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(d!==_||y!==p)&&VL(e,l,s,p),zu=!1,y=e.memoizedState,l.state=y,q0(e,s,l,i);var I=e.memoizedState;d!==_||y!==I||li.current||zu?(typeof v=="function"&&(YI(e,n,v,s),I=e.memoizedState),(f=zu||UL(e,n,f,s,y,I,p)||!1)?(m||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(s,I,p),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(s,I,p)),typeof l.componentDidUpdate=="function"&&(e.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof l.componentDidUpdate!="function"||d===t.memoizedProps&&y===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||d===t.memoizedProps&&y===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=I),l.props=s,l.state=I,l.context=p,s=f):(typeof l.componentDidUpdate!="function"||d===t.memoizedProps&&y===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||d===t.memoizedProps&&y===t.memoizedState||(e.flags|=1024),s=!1)}return e2(t,e,n,s,c,i)}function e2(t,e,n,s,i,c){vU(t,e);var l=(e.flags&128)!==0;if(!s&&!l)return i&&PL(e,n,!1),Zc(t,e,c);s=e.stateNode,CJ.current=e;var d=l&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&l?(e.child=yp(e,t.child,null,c),e.child=yp(e,null,d,c)):Wo(t,e,d,c),e.memoizedState=s.state,i&&PL(e,n,!0),e.child}function SU(t){var e=t.stateNode;e.pendingContext?DL(t,e.pendingContext,e.pendingContext!==e.context):e.context&&DL(t,e.context,!1),$C(t,e.containerInfo)}function YL(t,e,n,s,i){return _p(),xC(i),e.flags|=256,Wo(t,e,n,s),e.child}var t2={dehydrated:null,treeContext:null,retryLane:0};function n2(t){return{baseLanes:t,cachePool:null,transitions:null}}function TU(t,e,n){var s=e.pendingProps,i=Kr.current,c=!1,l=(e.flags&128)!==0,d;if((d=l)||(d=t!==null&&t.memoizedState===null?!1:(i&2)!==0),d?(c=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),wr(Kr,i&1),t===null)return qI(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(l=s.children,t=s.fallback,c?(s=e.mode,c=e.child,l={mode:"hidden",children:l},!(s&1)&&c!==null?(c.childLanes=0,c.pendingProps=l):c=F1(l,s,0,null),t=yd(t,s,n,null),c.return=e,t.return=e,c.sibling=t,e.child=c,e.child.memoizedState=n2(n),e.memoizedState=t2,t):zC(e,l));if(i=t.memoizedState,i!==null&&(d=i.dehydrated,d!==null))return wJ(t,e,l,s,d,i,n);if(c){c=s.fallback,l=e.mode,i=t.child,d=i.sibling;var p={mode:"hidden",children:s.children};return!(l&1)&&e.child!==i?(s=e.child,s.childLanes=0,s.pendingProps=p,e.deletions=null):(s=il(i,p),s.subtreeFlags=i.subtreeFlags&14680064),d!==null?c=il(d,c):(c=yd(c,l,n,null),c.flags|=2),c.return=e,s.return=e,s.sibling=c,e.child=s,s=c,c=e.child,l=t.child.memoizedState,l=l===null?n2(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},c.memoizedState=l,c.childLanes=t.childLanes&~n,e.memoizedState=t2,s}return c=t.child,t=c.sibling,s=il(c,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function zC(t,e){return e=F1({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function n0(t,e,n,s){return s!==null&&xC(s),yp(e,t.child,null,n),t=zC(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function wJ(t,e,n,s,i,c,l){if(n)return e.flags&256?(e.flags&=-257,s=GT(Error(ot(422))),n0(t,e,l,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(c=s.fallback,i=e.mode,s=F1({mode:"visible",children:s.children},i,0,null),c=yd(c,i,l,null),c.flags|=2,s.return=e,c.return=e,s.sibling=c,e.child=s,e.mode&1&&yp(e,t.child,null,l),e.child.memoizedState=n2(l),e.memoizedState=t2,c);if(!(e.mode&1))return n0(t,e,l,null);if(i.data==="$!"){if(s=i.nextSibling&&i.nextSibling.dataset,s)var d=s.dgst;return s=d,c=Error(ot(419)),s=GT(c,s,void 0),n0(t,e,l,s)}if(d=(l&t.childLanes)!==0,ci||d){if(s=Hs,s!==null){switch(l&-l){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(s.suspendedLanes|l)?0:i,i!==0&&i!==c.retryLane&&(c.retryLane=i,Qc(t,i),Ga(s,t,i,-1))}return JC(),s=GT(Error(ot(421))),n0(t,e,l,s)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=FJ.bind(null,t),i._reactRetry=e,null):(t=c.treeContext,Ui=nl(i.nextSibling),ji=e,Vr=!0,Ua=null,t!==null&&(la[da++]=Wc,la[da++]=Gc,la[da++]=Id,Wc=t.id,Gc=t.overflow,Id=e),e=zC(e,s.children),e.flags|=4096,e)}function JL(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),XI(t.return,e,n)}function zT(t,e,n,s,i){var c=t.memoizedState;c===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:i}:(c.isBackwards=e,c.rendering=null,c.renderingStartTime=0,c.last=s,c.tail=n,c.tailMode=i)}function IU(t,e,n){var s=e.pendingProps,i=s.revealOrder,c=s.tail;if(Wo(t,e,s.children,n),s=Kr.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&JL(t,n,e);else if(t.tag===19)JL(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(wr(Kr,s),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&X0(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),zT(e,!1,i,n,c);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&X0(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}zT(e,!0,n,null,c);break;case"together":zT(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function I0(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Zc(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),wd|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ot(153));if(e.child!==null){for(t=e.child,n=il(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=il(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function RJ(t,e,n){switch(e.tag){case 3:SU(e),_p();break;case 5:YF(e);break;case 1:di(e.type)&&W0(e);break;case 4:$C(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,i=e.memoizedProps.value;wr(H0,s._currentValue),s._currentValue=i;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(wr(Kr,Kr.current&1),e.flags|=128,null):n&e.child.childLanes?TU(t,e,n):(wr(Kr,Kr.current&1),t=Zc(t,e,n),t!==null?t.sibling:null);wr(Kr,Kr.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return IU(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),wr(Kr,Kr.current),s)break;return null;case 22:case 23:return e.lanes=0,yU(t,e,n)}return Zc(t,e,n)}var CU,r2,wU,RU;CU=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};r2=function(){};wU=function(t,e,n,s){var i=t.memoizedProps;if(i!==s){t=e.stateNode,hd(Ec.current);var c=null;switch(n){case"input":i=wI(t,i),s=wI(t,s),c=[];break;case"select":i=Yr({},i,{value:void 0}),s=Yr({},s,{value:void 0}),c=[];break;case"textarea":i=NI(t,i),s=NI(t,s),c=[];break;default:typeof i.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=B0)}OI(n,s);var l;n=null;for(f in i)if(!s.hasOwnProperty(f)&&i.hasOwnProperty(f)&&i[f]!=null)if(f==="style"){var d=i[f];for(l in d)d.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else f!=="dangerouslySetInnerHTML"&&f!=="children"&&f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(Sm.hasOwnProperty(f)?c||(c=[]):(c=c||[]).push(f,null));for(f in s){var p=s[f];if(d=i!=null?i[f]:void 0,s.hasOwnProperty(f)&&p!==d&&(p!=null||d!=null))if(f==="style")if(d){for(l in d)!d.hasOwnProperty(l)||p&&p.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in p)p.hasOwnProperty(l)&&d[l]!==p[l]&&(n||(n={}),n[l]=p[l])}else n||(c||(c=[]),c.push(f,n)),n=p;else f==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,d=d?d.__html:void 0,p!=null&&d!==p&&(c=c||[]).push(f,p)):f==="children"?typeof p!="string"&&typeof p!="number"||(c=c||[]).push(f,""+p):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&(Sm.hasOwnProperty(f)?(p!=null&&f==="onScroll"&&kr("scroll",t),c||d===p||(c=[])):(c=c||[]).push(f,p))}n&&(c=c||[]).push("style",n);var f=c;(e.updateQueue=f)&&(e.flags|=4)}};RU=function(t,e,n,s){n!==s&&(e.flags|=4)};function Hf(t,e){if(!Vr)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function No(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,s|=i.subtreeFlags&14680064,s|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function bJ(t,e,n){var s=e.pendingProps;switch(OC(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return No(e),null;case 1:return di(e.type)&&j0(),No(e),null;case 3:return s=e.stateNode,vp(),Pr(li),Pr(Lo),UC(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(e0(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ua!==null&&(d2(Ua),Ua=null))),r2(t,e),No(e),null;case 5:FC(e);var i=hd(Dm.current);if(n=e.type,t!==null&&e.stateNode!=null)wU(t,e,n,s,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(ot(166));return No(e),null}if(t=hd(Ec.current),e0(e)){s=e.stateNode,n=e.type;var c=e.memoizedProps;switch(s[fc]=e,s[xm]=c,t=(e.mode&1)!==0,n){case"dialog":kr("cancel",s),kr("close",s);break;case"iframe":case"object":case"embed":kr("load",s);break;case"video":case"audio":for(i=0;i<em.length;i++)kr(em[i],s);break;case"source":kr("error",s);break;case"img":case"image":case"link":kr("error",s),kr("load",s);break;case"details":kr("toggle",s);break;case"input":iL(s,c),kr("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!c.multiple},kr("invalid",s);break;case"textarea":cL(s,c),kr("invalid",s)}OI(n,c),i=null;for(var l in c)if(c.hasOwnProperty(l)){var d=c[l];l==="children"?typeof d=="string"?s.textContent!==d&&(c.suppressHydrationWarning!==!0&&ZE(s.textContent,d,t),i=["children",d]):typeof d=="number"&&s.textContent!==""+d&&(c.suppressHydrationWarning!==!0&&ZE(s.textContent,d,t),i=["children",""+d]):Sm.hasOwnProperty(l)&&d!=null&&l==="onScroll"&&kr("scroll",s)}switch(n){case"input":zE(s),aL(s,c,!0);break;case"textarea":zE(s),uL(s);break;case"select":case"option":break;default:typeof c.onClick=="function"&&(s.onclick=B0)}s=i,e.updateQueue=s,s!==null&&(e.flags|=4)}else{l=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Z$(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=l.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=l.createElement(n,{is:s.is}):(t=l.createElement(n),n==="select"&&(l=t,s.multiple?l.multiple=!0:s.size&&(l.size=s.size))):t=l.createElementNS(t,n),t[fc]=e,t[xm]=s,CU(t,e,!1,!1),e.stateNode=t;e:{switch(l=xI(n,s),n){case"dialog":kr("cancel",t),kr("close",t),i=s;break;case"iframe":case"object":case"embed":kr("load",t),i=s;break;case"video":case"audio":for(i=0;i<em.length;i++)kr(em[i],t);i=s;break;case"source":kr("error",t),i=s;break;case"img":case"image":case"link":kr("error",t),kr("load",t),i=s;break;case"details":kr("toggle",t),i=s;break;case"input":iL(t,s),i=wI(t,s),kr("invalid",t);break;case"option":i=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},i=Yr({},s,{value:void 0}),kr("invalid",t);break;case"textarea":cL(t,s),i=NI(t,s),kr("invalid",t);break;default:i=s}OI(n,i),d=i;for(c in d)if(d.hasOwnProperty(c)){var p=d[c];c==="style"?nF(t,p):c==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,p!=null&&eF(t,p)):c==="children"?typeof p=="string"?(n!=="textarea"||p!=="")&&Tm(t,p):typeof p=="number"&&Tm(t,""+p):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Sm.hasOwnProperty(c)?p!=null&&c==="onScroll"&&kr("scroll",t):p!=null&&mC(t,c,p,l))}switch(n){case"input":zE(t),aL(t,s,!1);break;case"textarea":zE(t),uL(t);break;case"option":s.value!=null&&t.setAttribute("value",""+dl(s.value));break;case"select":t.multiple=!!s.multiple,c=s.value,c!=null?ip(t,!!s.multiple,c,!1):s.defaultValue!=null&&ip(t,!!s.multiple,s.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=B0)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return No(e),null;case 6:if(t&&e.stateNode!=null)RU(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(ot(166));if(n=hd(Dm.current),hd(Ec.current),e0(e)){if(s=e.stateNode,n=e.memoizedProps,s[fc]=e,(c=s.nodeValue!==n)&&(t=ji,t!==null))switch(t.tag){case 3:ZE(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ZE(s.nodeValue,n,(t.mode&1)!==0)}c&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[fc]=e,e.stateNode=s}return No(e),null;case 13:if(Pr(Kr),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Vr&&Ui!==null&&e.mode&1&&!(e.flags&128))WF(),_p(),e.flags|=98560,c=!1;else if(c=e0(e),s!==null&&s.dehydrated!==null){if(t===null){if(!c)throw Error(ot(318));if(c=e.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(ot(317));c[fc]=e}else _p(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;No(e),c=!1}else Ua!==null&&(d2(Ua),Ua=null),c=!0;if(!c)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||Kr.current&1?Ds===0&&(Ds=3):JC())),e.updateQueue!==null&&(e.flags|=4),No(e),null);case 4:return vp(),r2(t,e),t===null&&Am(e.stateNode.containerInfo),No(e),null;case 10:return PC(e.type._context),No(e),null;case 17:return di(e.type)&&j0(),No(e),null;case 19:if(Pr(Kr),c=e.memoizedState,c===null)return No(e),null;if(s=(e.flags&128)!==0,l=c.rendering,l===null)if(s)Hf(c,!1);else{if(Ds!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(l=X0(t),l!==null){for(e.flags|=128,Hf(c,!1),s=l.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)c=n,t=s,c.flags&=14680066,l=c.alternate,l===null?(c.childLanes=0,c.lanes=t,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=l.childLanes,c.lanes=l.lanes,c.child=l.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=l.memoizedProps,c.memoizedState=l.memoizedState,c.updateQueue=l.updateQueue,c.type=l.type,t=l.dependencies,c.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return wr(Kr,Kr.current&1|2),e.child}t=t.sibling}c.tail!==null&&ds()>Tp&&(e.flags|=128,s=!0,Hf(c,!1),e.lanes=4194304)}else{if(!s)if(t=X0(l),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Hf(c,!0),c.tail===null&&c.tailMode==="hidden"&&!l.alternate&&!Vr)return No(e),null}else 2*ds()-c.renderingStartTime>Tp&&n!==1073741824&&(e.flags|=128,s=!0,Hf(c,!1),e.lanes=4194304);c.isBackwards?(l.sibling=e.child,e.child=l):(n=c.last,n!==null?n.sibling=l:e.child=l,c.last=l)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=ds(),e.sibling=null,n=Kr.current,wr(Kr,s?n&1|2:n&1),e):(No(e),null);case 22:case 23:return YC(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?$i&1073741824&&(No(e),e.subtreeFlags&6&&(e.flags|=8192)):No(e),null;case 24:return null;case 25:return null}throw Error(ot(156,e.tag))}function NJ(t,e){switch(OC(e),e.tag){case 1:return di(e.type)&&j0(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return vp(),Pr(li),Pr(Lo),UC(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return FC(e),null;case 13:if(Pr(Kr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ot(340));_p()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Pr(Kr),null;case 4:return vp(),null;case 10:return PC(e.type._context),null;case 22:case 23:return YC(),null;case 24:return null;default:return null}}var r0=!1,Oo=!1,AJ=typeof WeakSet=="function"?WeakSet:Set,wt=null;function np(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){rs(t,e,s)}else n.current=null}function s2(t,e,n){try{n()}catch(s){rs(t,e,s)}}var QL=!1;function OJ(t,e){if(BI=F0,t=OF(),NC(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var i=s.anchorOffset,c=s.focusNode;s=s.focusOffset;try{n.nodeType,c.nodeType}catch{n=null;break e}var l=0,d=-1,p=-1,f=0,m=0,_=t,y=null;t:for(;;){for(var v;_!==n||i!==0&&_.nodeType!==3||(d=l+i),_!==c||s!==0&&_.nodeType!==3||(p=l+s),_.nodeType===3&&(l+=_.nodeValue.length),(v=_.firstChild)!==null;)y=_,_=v;for(;;){if(_===t)break t;if(y===n&&++f===i&&(d=l),y===c&&++m===s&&(p=l),(v=_.nextSibling)!==null)break;_=y,y=_.parentNode}_=v}n=d===-1||p===-1?null:{start:d,end:p}}else n=null}n=n||{start:0,end:0}}else n=null;for(jI={focusedElem:t,selectionRange:n},F0=!1,wt=e;wt!==null;)if(e=wt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,wt=t;else for(;wt!==null;){e=wt;try{var I=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(I!==null){var b=I.memoizedProps,A=I.memoizedState,R=e.stateNode,O=R.getSnapshotBeforeUpdate(e.elementType===e.type?b:$a(e.type,b),A);R.__reactInternalSnapshotBeforeUpdate=O}break;case 3:var L=e.stateNode.containerInfo;L.nodeType===1?L.textContent="":L.nodeType===9&&L.documentElement&&L.removeChild(L.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ot(163))}}catch($){rs(e,e.return,$)}if(t=e.sibling,t!==null){t.return=e.return,wt=t;break}wt=e.return}return I=QL,QL=!1,I}function fm(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var i=s=s.next;do{if((i.tag&t)===t){var c=i.destroy;i.destroy=void 0,c!==void 0&&s2(e,n,c)}i=i.next}while(i!==s)}}function M1(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function o2(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function bU(t){var e=t.alternate;e!==null&&(t.alternate=null,bU(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[fc],delete e[xm],delete e[zI],delete e[hJ],delete e[pJ])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function NU(t){return t.tag===5||t.tag===3||t.tag===4}function ZL(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||NU(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function i2(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=B0));else if(s!==4&&(t=t.child,t!==null))for(i2(t,e,n),t=t.sibling;t!==null;)i2(t,e,n),t=t.sibling}function a2(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(a2(t,e,n),t=t.sibling;t!==null;)a2(t,e,n),t=t.sibling}var ao=null,Fa=!1;function ju(t,e,n){for(n=n.child;n!==null;)AU(t,e,n),n=n.sibling}function AU(t,e,n){if(gc&&typeof gc.onCommitFiberUnmount=="function")try{gc.onCommitFiberUnmount(N1,n)}catch{}switch(n.tag){case 5:Oo||np(n,e);case 6:var s=ao,i=Fa;ao=null,ju(t,e,n),ao=s,Fa=i,ao!==null&&(Fa?(t=ao,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):ao.removeChild(n.stateNode));break;case 18:ao!==null&&(Fa?(t=ao,n=n.stateNode,t.nodeType===8?FT(t.parentNode,n):t.nodeType===1&&FT(t,n),Rm(t)):FT(ao,n.stateNode));break;case 4:s=ao,i=Fa,ao=n.stateNode.containerInfo,Fa=!0,ju(t,e,n),ao=s,Fa=i;break;case 0:case 11:case 14:case 15:if(!Oo&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){i=s=s.next;do{var c=i,l=c.destroy;c=c.tag,l!==void 0&&(c&2||c&4)&&s2(n,e,l),i=i.next}while(i!==s)}ju(t,e,n);break;case 1:if(!Oo&&(np(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(d){rs(n,e,d)}ju(t,e,n);break;case 21:ju(t,e,n);break;case 22:n.mode&1?(Oo=(s=Oo)||n.memoizedState!==null,ju(t,e,n),Oo=s):ju(t,e,n);break;default:ju(t,e,n)}}function eM(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new AJ),e.forEach(function(s){var i=UJ.bind(null,t,s);n.has(s)||(n.add(s),s.then(i,i))})}}function Ma(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var i=n[s];try{var c=t,l=e,d=l;e:for(;d!==null;){switch(d.tag){case 5:ao=d.stateNode,Fa=!1;break e;case 3:ao=d.stateNode.containerInfo,Fa=!0;break e;case 4:ao=d.stateNode.containerInfo,Fa=!0;break e}d=d.return}if(ao===null)throw Error(ot(160));AU(c,l,i),ao=null,Fa=!1;var p=i.alternate;p!==null&&(p.return=null),i.return=null}catch(f){rs(i,e,f)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)OU(e,t),e=e.sibling}function OU(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ma(e,t),dc(t),s&4){try{fm(3,t,t.return),M1(3,t)}catch(b){rs(t,t.return,b)}try{fm(5,t,t.return)}catch(b){rs(t,t.return,b)}}break;case 1:Ma(e,t),dc(t),s&512&&n!==null&&np(n,n.return);break;case 5:if(Ma(e,t),dc(t),s&512&&n!==null&&np(n,n.return),t.flags&32){var i=t.stateNode;try{Tm(i,"")}catch(b){rs(t,t.return,b)}}if(s&4&&(i=t.stateNode,i!=null)){var c=t.memoizedProps,l=n!==null?n.memoizedProps:c,d=t.type,p=t.updateQueue;if(t.updateQueue=null,p!==null)try{d==="input"&&c.type==="radio"&&c.name!=null&&J$(i,c),xI(d,l);var f=xI(d,c);for(l=0;l<p.length;l+=2){var m=p[l],_=p[l+1];m==="style"?nF(i,_):m==="dangerouslySetInnerHTML"?eF(i,_):m==="children"?Tm(i,_):mC(i,m,_,f)}switch(d){case"input":RI(i,c);break;case"textarea":Q$(i,c);break;case"select":var y=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!c.multiple;var v=c.value;v!=null?ip(i,!!c.multiple,v,!1):y!==!!c.multiple&&(c.defaultValue!=null?ip(i,!!c.multiple,c.defaultValue,!0):ip(i,!!c.multiple,c.multiple?[]:"",!1))}i[xm]=c}catch(b){rs(t,t.return,b)}}break;case 6:if(Ma(e,t),dc(t),s&4){if(t.stateNode===null)throw Error(ot(162));i=t.stateNode,c=t.memoizedProps;try{i.nodeValue=c}catch(b){rs(t,t.return,b)}}break;case 3:if(Ma(e,t),dc(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{Rm(e.containerInfo)}catch(b){rs(t,t.return,b)}break;case 4:Ma(e,t),dc(t);break;case 13:Ma(e,t),dc(t),i=t.child,i.flags&8192&&(c=i.memoizedState!==null,i.stateNode.isHidden=c,!c||i.alternate!==null&&i.alternate.memoizedState!==null||(qC=ds())),s&4&&eM(t);break;case 22:if(m=n!==null&&n.memoizedState!==null,t.mode&1?(Oo=(f=Oo)||m,Ma(e,t),Oo=f):Ma(e,t),dc(t),s&8192){if(f=t.memoizedState!==null,(t.stateNode.isHidden=f)&&!m&&t.mode&1)for(wt=t,m=t.child;m!==null;){for(_=wt=m;wt!==null;){switch(y=wt,v=y.child,y.tag){case 0:case 11:case 14:case 15:fm(4,y,y.return);break;case 1:np(y,y.return);var I=y.stateNode;if(typeof I.componentWillUnmount=="function"){s=y,n=y.return;try{e=s,I.props=e.memoizedProps,I.state=e.memoizedState,I.componentWillUnmount()}catch(b){rs(s,n,b)}}break;case 5:np(y,y.return);break;case 22:if(y.memoizedState!==null){nM(_);continue}}v!==null?(v.return=y,wt=v):nM(_)}m=m.sibling}e:for(m=null,_=t;;){if(_.tag===5){if(m===null){m=_;try{i=_.stateNode,f?(c=i.style,typeof c.setProperty=="function"?c.setProperty("display","none","important"):c.display="none"):(d=_.stateNode,p=_.memoizedProps.style,l=p!=null&&p.hasOwnProperty("display")?p.display:null,d.style.display=tF("display",l))}catch(b){rs(t,t.return,b)}}}else if(_.tag===6){if(m===null)try{_.stateNode.nodeValue=f?"":_.memoizedProps}catch(b){rs(t,t.return,b)}}else if((_.tag!==22&&_.tag!==23||_.memoizedState===null||_===t)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===t)break e;for(;_.sibling===null;){if(_.return===null||_.return===t)break e;m===_&&(m=null),_=_.return}m===_&&(m=null),_.sibling.return=_.return,_=_.sibling}}break;case 19:Ma(e,t),dc(t),s&4&&eM(t);break;case 21:break;default:Ma(e,t),dc(t)}}function dc(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(NU(n)){var s=n;break e}n=n.return}throw Error(ot(160))}switch(s.tag){case 5:var i=s.stateNode;s.flags&32&&(Tm(i,""),s.flags&=-33);var c=ZL(t);a2(t,c,i);break;case 3:case 4:var l=s.stateNode.containerInfo,d=ZL(t);i2(t,d,l);break;default:throw Error(ot(161))}}catch(p){rs(t,t.return,p)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function xJ(t,e,n){wt=t,xU(t)}function xU(t,e,n){for(var s=(t.mode&1)!==0;wt!==null;){var i=wt,c=i.child;if(i.tag===22&&s){var l=i.memoizedState!==null||r0;if(!l){var d=i.alternate,p=d!==null&&d.memoizedState!==null||Oo;d=r0;var f=Oo;if(r0=l,(Oo=p)&&!f)for(wt=i;wt!==null;)l=wt,p=l.child,l.tag===22&&l.memoizedState!==null?rM(i):p!==null?(p.return=l,wt=p):rM(i);for(;c!==null;)wt=c,xU(c),c=c.sibling;wt=i,r0=d,Oo=f}tM(t)}else i.subtreeFlags&8772&&c!==null?(c.return=i,wt=c):tM(t)}}function tM(t){for(;wt!==null;){var e=wt;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Oo||M1(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!Oo)if(n===null)s.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:$a(e.type,n.memoizedProps);s.componentDidUpdate(i,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var c=e.updateQueue;c!==null&&FL(e,c,s);break;case 3:var l=e.updateQueue;if(l!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}FL(e,l,n)}break;case 5:var d=e.stateNode;if(n===null&&e.flags&4){n=d;var p=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":p.autoFocus&&n.focus();break;case"img":p.src&&(n.src=p.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var f=e.alternate;if(f!==null){var m=f.memoizedState;if(m!==null){var _=m.dehydrated;_!==null&&Rm(_)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ot(163))}Oo||e.flags&512&&o2(e)}catch(y){rs(e,e.return,y)}}if(e===t){wt=null;break}if(n=e.sibling,n!==null){n.return=e.return,wt=n;break}wt=e.return}}function nM(t){for(;wt!==null;){var e=wt;if(e===t){wt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,wt=n;break}wt=e.return}}function rM(t){for(;wt!==null;){var e=wt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{M1(4,e)}catch(p){rs(e,n,p)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var i=e.return;try{s.componentDidMount()}catch(p){rs(e,i,p)}}var c=e.return;try{o2(e)}catch(p){rs(e,c,p)}break;case 5:var l=e.return;try{o2(e)}catch(p){rs(e,l,p)}}}catch(p){rs(e,e.return,p)}if(e===t){wt=null;break}var d=e.sibling;if(d!==null){d.return=e.return,wt=d;break}wt=e.return}}var kJ=Math.ceil,Q0=iu.ReactCurrentDispatcher,HC=iu.ReactCurrentOwner,_a=iu.ReactCurrentBatchConfig,Mn=0,Hs=null,Is=null,co=0,$i=0,rp=_l(0),Ds=0,$m=null,wd=0,$1=0,KC=0,mm=null,ii=null,qC=0,Tp=1/0,Uc=null,Z0=!1,c2=null,sl=null,s0=!1,Yu=null,e1=0,gm=0,u2=null,C0=-1,w0=0;function zo(){return Mn&6?ds():C0!==-1?C0:C0=ds()}function ol(t){return t.mode&1?Mn&2&&co!==0?co&-co:mJ.transition!==null?(w0===0&&(w0=fF()),w0):(t=rr,t!==0||(t=window.event,t=t===void 0?16:SF(t.type)),t):1}function Ga(t,e,n,s){if(50<gm)throw gm=0,u2=null,Error(ot(185));qm(t,n,s),(!(Mn&2)||t!==Hs)&&(t===Hs&&(!(Mn&2)&&($1|=n),Ds===4&&qu(t,co)),hi(t,s),n===1&&Mn===0&&!(e.mode&1)&&(Tp=ds()+500,D1&&yl()))}function hi(t,e){var n=t.callbackNode;mY(t,e);var s=$0(t,t===Hs?co:0);if(s===0)n!==null&&hL(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&hL(n),e===1)t.tag===0?fJ(sM.bind(null,t)):VF(sM.bind(null,t)),lJ(function(){!(Mn&6)&&yl()}),n=null;else{switch(mF(s)){case 1:n=vC;break;case 4:n=hF;break;case 16:n=M0;break;case 536870912:n=pF;break;default:n=M0}n=UU(n,kU.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function kU(t,e){if(C0=-1,w0=0,Mn&6)throw Error(ot(327));var n=t.callbackNode;if(dp()&&t.callbackNode!==n)return null;var s=$0(t,t===Hs?co:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=t1(t,s);else{e=s;var i=Mn;Mn|=2;var c=PU();(Hs!==t||co!==e)&&(Uc=null,Tp=ds()+500,_d(t,e));do try{LJ();break}catch(d){DU(t,d)}while(1);DC(),Q0.current=c,Mn=i,Is!==null?e=0:(Hs=null,co=0,e=Ds)}if(e!==0){if(e===2&&(i=MI(t),i!==0&&(s=i,e=l2(t,i))),e===1)throw n=$m,_d(t,0),qu(t,s),hi(t,ds()),n;if(e===6)qu(t,s);else{if(i=t.current.alternate,!(s&30)&&!DJ(i)&&(e=t1(t,s),e===2&&(c=MI(t),c!==0&&(s=c,e=l2(t,c))),e===1))throw n=$m,_d(t,0),qu(t,s),hi(t,ds()),n;switch(t.finishedWork=i,t.finishedLanes=s,e){case 0:case 1:throw Error(ot(345));case 2:id(t,ii,Uc);break;case 3:if(qu(t,s),(s&130023424)===s&&(e=qC+500-ds(),10<e)){if($0(t,0)!==0)break;if(i=t.suspendedLanes,(i&s)!==s){zo(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=GI(id.bind(null,t,ii,Uc),e);break}id(t,ii,Uc);break;case 4:if(qu(t,s),(s&4194240)===s)break;for(e=t.eventTimes,i=-1;0<s;){var l=31-Wa(s);c=1<<l,l=e[l],l>i&&(i=l),s&=~c}if(s=i,s=ds()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*kJ(s/1960))-s,10<s){t.timeoutHandle=GI(id.bind(null,t,ii,Uc),s);break}id(t,ii,Uc);break;case 5:id(t,ii,Uc);break;default:throw Error(ot(329))}}}return hi(t,ds()),t.callbackNode===n?kU.bind(null,t):null}function l2(t,e){var n=mm;return t.current.memoizedState.isDehydrated&&(_d(t,e).flags|=256),t=t1(t,e),t!==2&&(e=ii,ii=n,e!==null&&d2(e)),t}function d2(t){ii===null?ii=t:ii.push.apply(ii,t)}function DJ(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var i=n[s],c=i.getSnapshot;i=i.value;try{if(!Ha(c(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function qu(t,e){for(e&=~KC,e&=~$1,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Wa(e),s=1<<n;t[n]=-1,e&=~s}}function sM(t){if(Mn&6)throw Error(ot(327));dp();var e=$0(t,0);if(!(e&1))return hi(t,ds()),null;var n=t1(t,e);if(t.tag!==0&&n===2){var s=MI(t);s!==0&&(e=s,n=l2(t,s))}if(n===1)throw n=$m,_d(t,0),qu(t,e),hi(t,ds()),n;if(n===6)throw Error(ot(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,id(t,ii,Uc),hi(t,ds()),null}function XC(t,e){var n=Mn;Mn|=1;try{return t(e)}finally{Mn=n,Mn===0&&(Tp=ds()+500,D1&&yl())}}function Rd(t){Yu!==null&&Yu.tag===0&&!(Mn&6)&&dp();var e=Mn;Mn|=1;var n=_a.transition,s=rr;try{if(_a.transition=null,rr=1,t)return t()}finally{rr=s,_a.transition=n,Mn=e,!(Mn&6)&&yl()}}function YC(){$i=rp.current,Pr(rp)}function _d(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,uJ(n)),Is!==null)for(n=Is.return;n!==null;){var s=n;switch(OC(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&j0();break;case 3:vp(),Pr(li),Pr(Lo),UC();break;case 5:FC(s);break;case 4:vp();break;case 13:Pr(Kr);break;case 19:Pr(Kr);break;case 10:PC(s.type._context);break;case 22:case 23:YC()}n=n.return}if(Hs=t,Is=t=il(t.current,null),co=$i=e,Ds=0,$m=null,KC=$1=wd=0,ii=mm=null,dd!==null){for(e=0;e<dd.length;e++)if(n=dd[e],s=n.interleaved,s!==null){n.interleaved=null;var i=s.next,c=n.pending;if(c!==null){var l=c.next;c.next=i,s.next=l}n.pending=s}dd=null}return t}function DU(t,e){do{var n=Is;try{if(DC(),S0.current=J0,Y0){for(var s=qr.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}Y0=!1}if(Cd=0,Ws=xs=qr=null,pm=!1,Pm=0,HC.current=null,n===null||n.return===null){Ds=1,$m=e,Is=null;break}e:{var c=t,l=n.return,d=n,p=e;if(e=co,d.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){var f=p,m=d,_=m.tag;if(!(m.mode&1)&&(_===0||_===11||_===15)){var y=m.alternate;y?(m.updateQueue=y.updateQueue,m.memoizedState=y.memoizedState,m.lanes=y.lanes):(m.updateQueue=null,m.memoizedState=null)}var v=zL(l);if(v!==null){v.flags&=-257,HL(v,l,d,c,e),v.mode&1&&GL(c,f,e),e=v,p=f;var I=e.updateQueue;if(I===null){var b=new Set;b.add(p),e.updateQueue=b}else I.add(p);break e}else{if(!(e&1)){GL(c,f,e),JC();break e}p=Error(ot(426))}}else if(Vr&&d.mode&1){var A=zL(l);if(A!==null){!(A.flags&65536)&&(A.flags|=256),HL(A,l,d,c,e),xC(Sp(p,d));break e}}c=p=Sp(p,d),Ds!==4&&(Ds=2),mm===null?mm=[c]:mm.push(c),c=l;do{switch(c.tag){case 3:c.flags|=65536,e&=-e,c.lanes|=e;var R=gU(c,p,e);$L(c,R);break e;case 1:d=p;var O=c.type,L=c.stateNode;if(!(c.flags&128)&&(typeof O.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(sl===null||!sl.has(L)))){c.flags|=65536,e&=-e,c.lanes|=e;var $=EU(c,d,e);$L(c,$);break e}}c=c.return}while(c!==null)}MU(n)}catch(G){e=G,Is===n&&n!==null&&(Is=n=n.return);continue}break}while(1)}function PU(){var t=Q0.current;return Q0.current=J0,t===null?J0:t}function JC(){(Ds===0||Ds===3||Ds===2)&&(Ds=4),Hs===null||!(wd&268435455)&&!($1&268435455)||qu(Hs,co)}function t1(t,e){var n=Mn;Mn|=2;var s=PU();(Hs!==t||co!==e)&&(Uc=null,_d(t,e));do try{PJ();break}catch(i){DU(t,i)}while(1);if(DC(),Mn=n,Q0.current=s,Is!==null)throw Error(ot(261));return Hs=null,co=0,Ds}function PJ(){for(;Is!==null;)LU(Is)}function LJ(){for(;Is!==null&&!iY();)LU(Is)}function LU(t){var e=FU(t.alternate,t,$i);t.memoizedProps=t.pendingProps,e===null?MU(t):Is=e,HC.current=null}function MU(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=NJ(n,e),n!==null){n.flags&=32767,Is=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ds=6,Is=null;return}}else if(n=bJ(n,e,$i),n!==null){Is=n;return}if(e=e.sibling,e!==null){Is=e;return}Is=e=t}while(e!==null);Ds===0&&(Ds=5)}function id(t,e,n){var s=rr,i=_a.transition;try{_a.transition=null,rr=1,MJ(t,e,n,s)}finally{_a.transition=i,rr=s}return null}function MJ(t,e,n,s){do dp();while(Yu!==null);if(Mn&6)throw Error(ot(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ot(177));t.callbackNode=null,t.callbackPriority=0;var c=n.lanes|n.childLanes;if(gY(t,c),t===Hs&&(Is=Hs=null,co=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||s0||(s0=!0,UU(M0,function(){return dp(),null})),c=(n.flags&15990)!==0,n.subtreeFlags&15990||c){c=_a.transition,_a.transition=null;var l=rr;rr=1;var d=Mn;Mn|=4,HC.current=null,OJ(t,n),OU(n,t),nJ(jI),F0=!!BI,jI=BI=null,t.current=n,xJ(n),aY(),Mn=d,rr=l,_a.transition=c}else t.current=n;if(s0&&(s0=!1,Yu=t,e1=i),c=t.pendingLanes,c===0&&(sl=null),lY(n.stateNode),hi(t,ds()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],s(i.value,{componentStack:i.stack,digest:i.digest});if(Z0)throw Z0=!1,t=c2,c2=null,t;return e1&1&&t.tag!==0&&dp(),c=t.pendingLanes,c&1?t===u2?gm++:(gm=0,u2=t):gm=0,yl(),null}function dp(){if(Yu!==null){var t=mF(e1),e=_a.transition,n=rr;try{if(_a.transition=null,rr=16>t?16:t,Yu===null)var s=!1;else{if(t=Yu,Yu=null,e1=0,Mn&6)throw Error(ot(331));var i=Mn;for(Mn|=4,wt=t.current;wt!==null;){var c=wt,l=c.child;if(wt.flags&16){var d=c.deletions;if(d!==null){for(var p=0;p<d.length;p++){var f=d[p];for(wt=f;wt!==null;){var m=wt;switch(m.tag){case 0:case 11:case 15:fm(8,m,c)}var _=m.child;if(_!==null)_.return=m,wt=_;else for(;wt!==null;){m=wt;var y=m.sibling,v=m.return;if(bU(m),m===f){wt=null;break}if(y!==null){y.return=v,wt=y;break}wt=v}}}var I=c.alternate;if(I!==null){var b=I.child;if(b!==null){I.child=null;do{var A=b.sibling;b.sibling=null,b=A}while(b!==null)}}wt=c}}if(c.subtreeFlags&2064&&l!==null)l.return=c,wt=l;else e:for(;wt!==null;){if(c=wt,c.flags&2048)switch(c.tag){case 0:case 11:case 15:fm(9,c,c.return)}var R=c.sibling;if(R!==null){R.return=c.return,wt=R;break e}wt=c.return}}var O=t.current;for(wt=O;wt!==null;){l=wt;var L=l.child;if(l.subtreeFlags&2064&&L!==null)L.return=l,wt=L;else e:for(l=O;wt!==null;){if(d=wt,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:M1(9,d)}}catch(G){rs(d,d.return,G)}if(d===l){wt=null;break e}var $=d.sibling;if($!==null){$.return=d.return,wt=$;break e}wt=d.return}}if(Mn=i,yl(),gc&&typeof gc.onPostCommitFiberRoot=="function")try{gc.onPostCommitFiberRoot(N1,t)}catch{}s=!0}return s}finally{rr=n,_a.transition=e}}return!1}function oM(t,e,n){e=Sp(n,e),e=gU(t,e,1),t=rl(t,e,1),e=zo(),t!==null&&(qm(t,1,e),hi(t,e))}function rs(t,e,n){if(t.tag===3)oM(t,t,n);else for(;e!==null;){if(e.tag===3){oM(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(sl===null||!sl.has(s))){t=Sp(n,t),t=EU(e,t,1),e=rl(e,t,1),t=zo(),e!==null&&(qm(e,1,t),hi(e,t));break}}e=e.return}}function $J(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=zo(),t.pingedLanes|=t.suspendedLanes&n,Hs===t&&(co&n)===n&&(Ds===4||Ds===3&&(co&130023424)===co&&500>ds()-qC?_d(t,0):KC|=n),hi(t,e)}function $U(t,e){e===0&&(t.mode&1?(e=qE,qE<<=1,!(qE&130023424)&&(qE=4194304)):e=1);var n=zo();t=Qc(t,e),t!==null&&(qm(t,e,n),hi(t,n))}function FJ(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),$U(t,n)}function UJ(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(ot(314))}s!==null&&s.delete(e),$U(t,n)}var FU;FU=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||li.current)ci=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return ci=!1,RJ(t,e,n);ci=!!(t.flags&131072)}else ci=!1,Vr&&e.flags&1048576&&BF(e,z0,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;I0(t,e),t=e.pendingProps;var i=Ep(e,Lo.current);lp(e,n),i=BC(null,e,s,t,i,n);var c=jC();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,di(s)?(c=!0,W0(e)):c=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,MC(e),i.updater=P1,e.stateNode=i,i._reactInternals=e,JI(e,s,t,n),e=e2(null,e,s,!0,c,n)):(e.tag=0,Vr&&c&&AC(e),Wo(null,e,i,n),e=e.child),e;case 16:s=e.elementType;e:{switch(I0(t,e),t=e.pendingProps,i=s._init,s=i(s._payload),e.type=s,i=e.tag=BJ(s),t=$a(s,t),i){case 0:e=ZI(null,e,s,t,n);break e;case 1:e=XL(null,e,s,t,n);break e;case 11:e=KL(null,e,s,t,n);break e;case 14:e=qL(null,e,s,$a(s.type,t),n);break e}throw Error(ot(306,s,""))}return e;case 0:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:$a(s,i),ZI(t,e,s,i,n);case 1:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:$a(s,i),XL(t,e,s,i,n);case 3:e:{if(SU(e),t===null)throw Error(ot(387));s=e.pendingProps,c=e.memoizedState,i=c.element,zF(t,e),q0(e,s,null,n);var l=e.memoizedState;if(s=l.element,c.isDehydrated)if(c={element:s,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},e.updateQueue.baseState=c,e.memoizedState=c,e.flags&256){i=Sp(Error(ot(423)),e),e=YL(t,e,s,n,i);break e}else if(s!==i){i=Sp(Error(ot(424)),e),e=YL(t,e,s,n,i);break e}else for(Ui=nl(e.stateNode.containerInfo.firstChild),ji=e,Vr=!0,Ua=null,n=XF(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(_p(),s===i){e=Zc(t,e,n);break e}Wo(t,e,s,n)}e=e.child}return e;case 5:return YF(e),t===null&&qI(e),s=e.type,i=e.pendingProps,c=t!==null?t.memoizedProps:null,l=i.children,WI(s,i)?l=null:c!==null&&WI(s,c)&&(e.flags|=32),vU(t,e),Wo(t,e,l,n),e.child;case 6:return t===null&&qI(e),null;case 13:return TU(t,e,n);case 4:return $C(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=yp(e,null,s,n):Wo(t,e,s,n),e.child;case 11:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:$a(s,i),KL(t,e,s,i,n);case 7:return Wo(t,e,e.pendingProps,n),e.child;case 8:return Wo(t,e,e.pendingProps.children,n),e.child;case 12:return Wo(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,i=e.pendingProps,c=e.memoizedProps,l=i.value,wr(H0,s._currentValue),s._currentValue=l,c!==null)if(Ha(c.value,l)){if(c.children===i.children&&!li.current){e=Zc(t,e,n);break e}}else for(c=e.child,c!==null&&(c.return=e);c!==null;){var d=c.dependencies;if(d!==null){l=c.child;for(var p=d.firstContext;p!==null;){if(p.context===s){if(c.tag===1){p=qc(-1,n&-n),p.tag=2;var f=c.updateQueue;if(f!==null){f=f.shared;var m=f.pending;m===null?p.next=p:(p.next=m.next,m.next=p),f.pending=p}}c.lanes|=n,p=c.alternate,p!==null&&(p.lanes|=n),XI(c.return,n,e),d.lanes|=n;break}p=p.next}}else if(c.tag===10)l=c.type===e.type?null:c.child;else if(c.tag===18){if(l=c.return,l===null)throw Error(ot(341));l.lanes|=n,d=l.alternate,d!==null&&(d.lanes|=n),XI(l,n,e),l=c.sibling}else l=c.child;if(l!==null)l.return=c;else for(l=c;l!==null;){if(l===e){l=null;break}if(c=l.sibling,c!==null){c.return=l.return,l=c;break}l=l.return}c=l}Wo(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,s=e.pendingProps.children,lp(e,n),i=va(i),s=s(i),e.flags|=1,Wo(t,e,s,n),e.child;case 14:return s=e.type,i=$a(s,e.pendingProps),i=$a(s.type,i),qL(t,e,s,i,n);case 15:return _U(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:$a(s,i),I0(t,e),e.tag=1,di(s)?(t=!0,W0(e)):t=!1,lp(e,n),KF(e,s,i),JI(e,s,i,n),e2(null,e,s,!0,t,n);case 19:return IU(t,e,n);case 22:return yU(t,e,n)}throw Error(ot(156,e.tag))};function UU(t,e){return dF(t,e)}function VJ(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pa(t,e,n,s){return new VJ(t,e,n,s)}function QC(t){return t=t.prototype,!(!t||!t.isReactComponent)}function BJ(t){if(typeof t=="function")return QC(t)?1:0;if(t!=null){if(t=t.$$typeof,t===EC)return 11;if(t===_C)return 14}return 2}function il(t,e){var n=t.alternate;return n===null?(n=pa(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function R0(t,e,n,s,i,c){var l=2;if(s=t,typeof t=="function")QC(t)&&(l=1);else if(typeof t=="string")l=5;else e:switch(t){case Kh:return yd(n.children,i,c,e);case gC:l=8,i|=8;break;case SI:return t=pa(12,n,e,i|2),t.elementType=SI,t.lanes=c,t;case TI:return t=pa(13,n,e,i),t.elementType=TI,t.lanes=c,t;case II:return t=pa(19,n,e,i),t.elementType=II,t.lanes=c,t;case q$:return F1(n,i,c,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case H$:l=10;break e;case K$:l=9;break e;case EC:l=11;break e;case _C:l=14;break e;case Gu:l=16,s=null;break e}throw Error(ot(130,t==null?t:typeof t,""))}return e=pa(l,n,e,i),e.elementType=t,e.type=s,e.lanes=c,e}function yd(t,e,n,s){return t=pa(7,t,s,e),t.lanes=n,t}function F1(t,e,n,s){return t=pa(22,t,s,e),t.elementType=q$,t.lanes=n,t.stateNode={isHidden:!1},t}function HT(t,e,n){return t=pa(6,t,null,e),t.lanes=n,t}function KT(t,e,n){return e=pa(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function jJ(t,e,n,s,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=bT(0),this.expirationTimes=bT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bT(0),this.identifierPrefix=s,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function ZC(t,e,n,s,i,c,l,d,p){return t=new jJ(t,e,n,d,p),e===1?(e=1,c===!0&&(e|=8)):e=0,c=pa(3,null,null,e),t.current=c,c.stateNode=t,c.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},MC(c),t}function WJ(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Hh,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function VU(t){if(!t)return hl;t=t._reactInternals;e:{if(Fd(t)!==t||t.tag!==1)throw Error(ot(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(di(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ot(171))}if(t.tag===1){var n=t.type;if(di(n))return UF(t,n,e)}return e}function BU(t,e,n,s,i,c,l,d,p){return t=ZC(n,s,!0,t,i,c,l,d,p),t.context=VU(null),n=t.current,s=zo(),i=ol(n),c=qc(s,i),c.callback=e??null,rl(n,c,i),t.current.lanes=i,qm(t,i,s),hi(t,s),t}function U1(t,e,n,s){var i=e.current,c=zo(),l=ol(i);return n=VU(n),e.context===null?e.context=n:e.pendingContext=n,e=qc(c,l),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=rl(i,e,l),t!==null&&(Ga(t,i,l,c),v0(t,i,l)),l}function n1(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function iM(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ew(t,e){iM(t,e),(t=t.alternate)&&iM(t,e)}function GJ(){return null}var jU=typeof reportError=="function"?reportError:function(t){console.error(t)};function tw(t){this._internalRoot=t}V1.prototype.render=tw.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ot(409));U1(t,e,null,null)};V1.prototype.unmount=tw.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Rd(function(){U1(null,t,null,null)}),e[Jc]=null}};function V1(t){this._internalRoot=t}V1.prototype.unstable_scheduleHydration=function(t){if(t){var e=_F();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ku.length&&e!==0&&e<Ku[n].priority;n++);Ku.splice(n,0,t),n===0&&vF(t)}};function nw(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function B1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function aM(){}function zJ(t,e,n,s,i){if(i){if(typeof s=="function"){var c=s;s=function(){var f=n1(l);c.call(f)}}var l=BU(e,s,t,0,null,!1,!1,"",aM);return t._reactRootContainer=l,t[Jc]=l.current,Am(t.nodeType===8?t.parentNode:t),Rd(),l}for(;i=t.lastChild;)t.removeChild(i);if(typeof s=="function"){var d=s;s=function(){var f=n1(p);d.call(f)}}var p=ZC(t,0,!1,null,null,!1,!1,"",aM);return t._reactRootContainer=p,t[Jc]=p.current,Am(t.nodeType===8?t.parentNode:t),Rd(function(){U1(e,p,n,s)}),p}function j1(t,e,n,s,i){var c=n._reactRootContainer;if(c){var l=c;if(typeof i=="function"){var d=i;i=function(){var p=n1(l);d.call(p)}}U1(e,l,t,i)}else l=zJ(n,e,t,i,s);return n1(l)}gF=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Zf(e.pendingLanes);n!==0&&(SC(e,n|1),hi(e,ds()),!(Mn&6)&&(Tp=ds()+500,yl()))}break;case 13:Rd(function(){var s=Qc(t,1);if(s!==null){var i=zo();Ga(s,t,1,i)}}),ew(t,1)}};TC=function(t){if(t.tag===13){var e=Qc(t,134217728);if(e!==null){var n=zo();Ga(e,t,134217728,n)}ew(t,134217728)}};EF=function(t){if(t.tag===13){var e=ol(t),n=Qc(t,e);if(n!==null){var s=zo();Ga(n,t,e,s)}ew(t,e)}};_F=function(){return rr};yF=function(t,e){var n=rr;try{return rr=t,e()}finally{rr=n}};DI=function(t,e,n){switch(e){case"input":if(RI(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var i=k1(s);if(!i)throw Error(ot(90));Y$(s),RI(s,i)}}}break;case"textarea":Q$(t,n);break;case"select":e=n.value,e!=null&&ip(t,!!n.multiple,e,!1)}};oF=XC;iF=Rd;var HJ={usingClientEntryPoint:!1,Events:[Ym,Jh,k1,rF,sF,XC]},Kf={findFiberByHostInstance:ld,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},KJ={bundleType:Kf.bundleType,version:Kf.version,rendererPackageName:Kf.rendererPackageName,rendererConfig:Kf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:iu.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=uF(t),t===null?null:t.stateNode},findFiberByHostInstance:Kf.findFiberByHostInstance||GJ,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var o0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!o0.isDisabled&&o0.supportsFiber)try{N1=o0.inject(KJ),gc=o0}catch{}}Gi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=HJ;Gi.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nw(e))throw Error(ot(200));return WJ(t,e,null,n)};Gi.createRoot=function(t,e){if(!nw(t))throw Error(ot(299));var n=!1,s="",i=jU;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=ZC(t,1,!1,null,null,n,!1,s,i),t[Jc]=e.current,Am(t.nodeType===8?t.parentNode:t),new tw(e)};Gi.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ot(188)):(t=Object.keys(t).join(","),Error(ot(268,t)));return t=uF(e),t=t===null?null:t.stateNode,t};Gi.flushSync=function(t){return Rd(t)};Gi.hydrate=function(t,e,n){if(!B1(e))throw Error(ot(200));return j1(null,t,e,!0,n)};Gi.hydrateRoot=function(t,e,n){if(!nw(t))throw Error(ot(405));var s=n!=null&&n.hydratedSources||null,i=!1,c="",l=jU;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),e=BU(e,null,t,1,n??null,i,!1,c,l),t[Jc]=e.current,Am(t),s)for(t=0;t<s.length;t++)n=s[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new V1(e)};Gi.render=function(t,e,n){if(!B1(e))throw Error(ot(200));return j1(null,t,e,!1,n)};Gi.unmountComponentAtNode=function(t){if(!B1(t))throw Error(ot(40));return t._reactRootContainer?(Rd(function(){j1(null,null,t,!1,function(){t._reactRootContainer=null,t[Jc]=null})}),!0):!1};Gi.unstable_batchedUpdates=XC;Gi.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!B1(n))throw Error(ot(200));if(t==null||t._reactInternals===void 0)throw Error(ot(38));return j1(t,e,n,!1,s)};Gi.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}e(),t.exports=Gi})(GX);var cM=_I;EI.createRoot=cM.createRoot,EI.hydrateRoot=cM.hydrateRoot;var h2={},qJ={get exports(){return h2},set exports(t){h2=t}};(function(t,e){(function(n,s){t.exports=s()})(Bi,function(){function n(r,o){return o.forEach(function(a){a&&typeof a!="string"&&!Array.isArray(a)&&Object.keys(a).forEach(function(u){if(u!=="default"&&!(u in r)){var h=Object.getOwnPropertyDescriptor(a,u);Object.defineProperty(r,u,h.get?h:{enumerable:!0,get:function(){return a[u]}})}})}),Object.freeze(r)}var s=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Bi<"u"?Bi:typeof self<"u"?self:{},i=function(r){try{return!!r()}catch{return!0}},c=!i(function(){var r=function(){}.bind();return typeof r!="function"||r.hasOwnProperty("prototype")}),l=c,d=Function.prototype,p=d.bind,f=d.call,m=l&&p.bind(f,f),_=l?function(r){return r&&m(r)}:function(r){return r&&function(){return f.apply(r,arguments)}},y=_({}.isPrototypeOf),v=function(r){return r&&r.Math==Math&&r},I=v(typeof globalThis=="object"&&globalThis)||v(typeof window=="object"&&window)||v(typeof self=="object"&&self)||v(typeof s=="object"&&s)||function(){return this}()||Function("return this")(),b=c,A=Function.prototype,R=A.apply,O=A.call,L=typeof Reflect=="object"&&Reflect.apply||(b?O.bind(R):function(){return O.apply(R,arguments)}),$=function(r){return typeof r=="function"},G={},H=!i(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Z=c,re=Function.prototype.call,oe=Z?re.bind(re):function(){return re.apply(re,arguments)},ae={},Ee={}.propertyIsEnumerable,Ce=Object.getOwnPropertyDescriptor,ye=Ce&&!Ee.call({1:2},1);ae.f=ye?function(r){var o=Ce(this,r);return!!o&&o.enumerable}:Ee;var we,Ae,Oe=function(r,o){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:o}},Me=_,me=Me({}.toString),Te=Me("".slice),ke=function(r){return Te(me(r),8,-1)},Fe=_,Xe=i,Ye=ke,tt=I.Object,et=Fe("".split),nt=Xe(function(){return!tt("z").propertyIsEnumerable(0)})?function(r){return Ye(r)=="String"?et(r,""):tt(r)}:tt,gt=I.TypeError,Ct=function(r){if(r==null)throw gt("Can't call method on "+r);return r},Tt=nt,Lt=Ct,St=function(r){return Tt(Lt(r))},un=$,Kt=function(r){return typeof r=="object"?r!==null:un(r)},sn={},on=sn,Zt=I,xn=$,pn=function(r){return xn(r)?r:void 0},Fn=function(r,o){return arguments.length<2?pn(on[r])||pn(Zt[r]):on[r]&&on[r][o]||Zt[r]&&Zt[r][o]},Pn=Fn("navigator","userAgent")||"",Bn=I,Ar=Pn,fo=Bn.process,ps=Bn.Deno,Qr=fo&&fo.versions||ps&&ps.version,Lr=Qr&&Qr.v8;Lr&&(Ae=(we=Lr.split("."))[0]>0&&we[0]<4?1:+(we[0]+we[1])),!Ae&&Ar&&(!(we=Ar.match(/Edge\/(\d+)/))||we[1]>=74)&&(we=Ar.match(/Chrome\/(\d+)/))&&(Ae=+we[1]);var Wr=Ae,_r=Wr,Uo=i,_i=!!Object.getOwnPropertySymbols&&!Uo(function(){var r=Symbol();return!String(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&_r&&_r<41}),Hi=_i&&!Symbol.sham&&typeof Symbol.iterator=="symbol",du=Fn,wa=$,is=y,yr=Hi,Gr=I.Object,ws=yr?function(r){return typeof r=="symbol"}:function(r){var o=du("Symbol");return wa(o)&&is(o.prototype,Gr(r))},Ic=I.String,Un=function(r){try{return Ic(r)}catch{return"Object"}},Cc=$,bl=Un,Ki=I.TypeError,zr=function(r){if(Cc(r))return r;throw Ki(bl(r)+" is not a function")},ln=zr,hu=function(r,o){var a=r[o];return a==null?void 0:ln(a)},Xa=oe,Ra=$,ba=Kt,qi=I.TypeError,Na={exports:{}},mo=I,Xi=Object.defineProperty,Hd=function(r,o){try{Xi(mo,r,{value:o,configurable:!0,writable:!0})}catch{mo[r]=o}return o},Kd="__core-js_shared__",Zr=I[Kd]||Hd(Kd,{}),yi=Zr;(Na.exports=function(r,o){return yi[r]||(yi[r]=o!==void 0?o:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var qd=Ct,pu=I.Object,vi=function(r){return pu(qd(r))},Ya=vi,Jp=_({}.hasOwnProperty),fs=Object.hasOwn||function(r,o){return Jp(Ya(r),o)},Xd=_,Yd=0,fu=Math.random(),Aa=Xd(1 .toString),Nl=function(r){return"Symbol("+(r===void 0?"":r)+")_"+Aa(++Yd+fu,36)},Qp=I,mu=Na.exports,Al=fs,Ol=Nl,gu=_i,Eu=Hi,Si=mu("wks"),go=Qp.Symbol,Eo=go&&go.for,Zp=Eu?go:go&&go.withoutSetter||Ol,Mr=function(r){if(!Al(Si,r)||!gu&&typeof Si[r]!="string"){var o="Symbol."+r;gu&&Al(go,r)?Si[r]=go[r]:Si[r]=Eu&&Eo?Eo(o):Zp(o)}return Si[r]},Jd=oe,_u=Kt,Js=ws,Qd=hu,Oa=function(r,o){var a,u;if(o==="string"&&Ra(a=r.toString)&&!ba(u=Xa(a,r))||Ra(a=r.valueOf)&&!ba(u=Xa(a,r))||o!=="string"&&Ra(a=r.toString)&&!ba(u=Xa(a,r)))return u;throw qi("Can't convert object to primitive value")},Zd=Mr,xl=I.TypeError,ef=Zd("toPrimitive"),tf=function(r,o){if(!_u(r)||Js(r))return r;var a,u=Qd(r,ef);if(u){if(o===void 0&&(o="default"),a=Jd(u,r,o),!_u(a)||Js(a))return a;throw xl("Can't convert object to primitive value")}return o===void 0&&(o="number"),Oa(r,o)},Ja=ws,wc=function(r){var o=tf(r,"string");return Ja(o)?o:o+""},kl=Kt,Dl=I.document,nf=kl(Dl)&&kl(Dl.createElement),Rc=function(r){return nf?Dl.createElement(r):{}},Pl=Rc,yu=!H&&!i(function(){return Object.defineProperty(Pl("div"),"a",{get:function(){return 7}}).a!=7}),Ll=H,Ml=oe,$l=ae,Fl=Oe,eh=St,th=wc,P=fs,V=yu,W=Object.getOwnPropertyDescriptor;G.f=Ll?W:function(r,o){if(r=eh(r),o=th(o),V)try{return W(r,o)}catch{}if(P(r,o))return Fl(!Ml($l.f,r,o),r[o])};var ue=i,Se=$,Be=/#|\.prototype\./,Re=function(r,o){var a=rt[We(r)];return a==zt||a!=_t&&(Se(o)?ue(o):!!o)},We=Re.normalize=function(r){return String(r).replace(Be,".").toLowerCase()},rt=Re.data={},_t=Re.NATIVE="N",zt=Re.POLYFILL="P",vn=Re,an=zr,Xt=c,Nt=_(_.bind),x=function(r,o){return an(r),o===void 0?r:Xt?Nt(r,o):function(){return r.apply(o,arguments)}},B={},z=H&&i(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),ee=I,ce=Kt,ie=ee.String,le=ee.TypeError,he=function(r){if(ce(r))return r;throw le(ie(r)+" is not an object")},be=H,je=yu,qe=z,st=he,ut=wc,ft=I.TypeError,Bt=Object.defineProperty,tn=Object.getOwnPropertyDescriptor,Gn="enumerable",sr="configurable",Qs="writable";B.f=be?qe?function(r,o,a){if(st(r),o=ut(o),st(a),typeof r=="function"&&o==="prototype"&&"value"in a&&Qs in a&&!a.writable){var u=tn(r,o);u&&u.writable&&(r[o]=a.value,a={configurable:sr in a?a.configurable:u.configurable,enumerable:Gn in a?a.enumerable:u.enumerable,writable:!1})}return Bt(r,o,a)}:Bt:function(r,o,a){if(st(r),o=ut(o),st(a),je)try{return Bt(r,o,a)}catch{}if("get"in a||"set"in a)throw ft("Accessors not supported");return"value"in a&&(r[o]=a.value),r};var Xo=B,_o=Oe,gn=H?function(r,o,a){return Xo.f(r,o,_o(1,a))}:function(r,o,a){return r[o]=a,r},es=I,Qa=L,bc=_,Eg=$,vu=G.f,nh=vn,Za=sn,vB=x,rh=gn,aN=fs,SB=function(r){var o=function(a,u,h){if(this instanceof o){switch(arguments.length){case 0:return new r;case 1:return new r(a);case 2:return new r(a,u)}return new r(a,u,h)}return Qa(r,this,arguments)};return o.prototype=r.prototype,o},Zs=function(r,o){var a,u,h,g,E,S,T,C,w=r.target,N=r.global,M=r.stat,U=r.proto,Y=N?es:M?es[w]:(es[w]||{}).prototype,X=N?Za:Za[w]||rh(Za,w,{})[w],J=X.prototype;for(h in o)a=!nh(N?h:w+(M?".":"#")+h,r.forced)&&Y&&aN(Y,h),E=X[h],a&&(S=r.noTargetGet?(C=vu(Y,h))&&C.value:Y[h]),g=a&&S?S:o[h],a&&typeof E==typeof g||(T=r.bind&&a?vB(g,es):r.wrap&&a?SB(g):U&&Eg(g)?bc(g):g,(r.sham||g&&g.sham||E&&E.sham)&&rh(T,"sham",!0),rh(X,h,T),U&&(aN(Za,u=w+"Prototype")||rh(Za,u,{}),rh(Za[u],h,g),r.real&&J&&!J[h]&&rh(J,h,g)))},TB=Math.ceil,IB=Math.floor,my=function(r){var o=+r;return o!=o||o===0?0:(o>0?IB:TB)(o)},CB=my,wB=Math.min,RB=function(r){return r>0?wB(CB(r),9007199254740991):0},Su=function(r){return RB(r.length)},bB=zr,NB=vi,AB=nt,OB=Su,xB=I.TypeError,cN=function(r){return function(o,a,u,h){bB(a);var g=NB(o),E=AB(g),S=OB(g),T=r?S-1:0,C=r?-1:1;if(u<2)for(;;){if(T in E){h=E[T],T+=C;break}if(T+=C,r?T<0:S<=T)throw xB("Reduce of empty array with no initial value")}for(;r?T>=0:S>T;T+=C)T in E&&(h=a(h,E[T],T,g));return h}},kB={left:cN(!1),right:cN(!0)},DB=i,gy=function(r,o){var a=[][r];return!!a&&DB(function(){a.call(null,o||function(){throw 1},1)})},_g=ke(I.process)=="process",PB=kB.left,uN=Wr,LB=_g;Zs({target:"Array",proto:!0,forced:!gy("reduce")||!LB&&uN>79&&uN<83},{reduce:function(r){var o=arguments.length;return PB(this,r,o,o>1?arguments[1]:void 0)}});var MB=sn,Tu=function(r){return MB[r+"Prototype"]},$B=Tu("Array").reduce,FB=y,UB=$B,Ey=Array.prototype,lN=function(r){var o=r.reduce;return r===Ey||FB(Ey,r)&&o===Ey.reduce?UB:o},Iu=lN;let dN=!0,hN=!0;function yg(r,o,a){const u=r.match(o);return u&&u.length>=a&&parseInt(u[a],10)}function Ul(r,o,a){if(!r.RTCPeerConnection)return;const u=r.RTCPeerConnection.prototype,h=u.addEventListener;u.addEventListener=function(E,S){if(E!==o)return h.apply(this,arguments);const T=C=>{const w=a(C);w&&(S.handleEvent?S.handleEvent(w):S(w))};return this._eventMap=this._eventMap||{},this._eventMap[o]||(this._eventMap[o]=new Map),this._eventMap[o].set(S,T),h.apply(this,[E,T])};const g=u.removeEventListener;u.removeEventListener=function(E,S){if(E!==o||!this._eventMap||!this._eventMap[o])return g.apply(this,arguments);if(!this._eventMap[o].has(S))return g.apply(this,arguments);const T=this._eventMap[o].get(S);return this._eventMap[o].delete(S),this._eventMap[o].size===0&&delete this._eventMap[o],Object.keys(this._eventMap).length===0&&delete this._eventMap,g.apply(this,[E,T])},Object.defineProperty(u,"on"+o,{get(){return this["_on"+o]},set(E){this["_on"+o]&&(this.removeEventListener(o,this["_on"+o]),delete this["_on"+o]),E&&this.addEventListener(o,this["_on"+o]=E)},enumerable:!0,configurable:!0})}function VB(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(dN=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function BB(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(hN=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function pN(){if(typeof window=="object"){if(dN)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function _y(r,o){hN&&console.warn(r+" is deprecated, please use "+o+" instead.")}function jB(r){const o={browser:null,version:null};if(r===void 0||!r.navigator)return o.browser="Not a browser.",o;const{navigator:a}=r;if(a.mozGetUserMedia)o.browser="firefox",o.version=yg(a.userAgent,/Firefox\/(\d+)\./,1);else if(a.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection)o.browser="chrome",o.version=yg(a.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!r.RTCPeerConnection||!a.userAgent.match(/AppleWebKit\/(\d+)\./))return o.browser="Not a supported browser.",o;o.browser="safari",o.version=yg(a.userAgent,/AppleWebKit\/(\d+)\./,1),o.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype}return o}function fN(r){return Object.prototype.toString.call(r)==="[object Object]"}function mN(r){var o;return fN(r)?Iu(o=Object.keys(r)).call(o,function(a,u){const h=fN(r[u]),g=h?mN(r[u]):r[u],E=h&&!Object.keys(g).length;return g===void 0||E?a:Object.assign(a,{[u]:g})},{}):r}function gN(r,o,a){const u=a?"outbound-rtp":"inbound-rtp",h=new Map;if(o===null)return h;const g=[];return r.forEach(E=>{E.type==="track"&&E.trackIdentifier===o.id&&g.push(E)}),g.forEach(E=>{r.forEach(S=>{S.type===u&&S.trackId===E.id&&function T(C,w,N){w&&!N.has(w.id)&&(N.set(w.id,w),Object.keys(w).forEach(M=>{M.endsWith("Id")?T(C,C.get(w[M]),N):M.endsWith("Ids")&&w[M].forEach(U=>{T(C,C.get(U),N)})}))}(r,S,h)})}),h}var WB=Na.exports,GB=Nl,EN=WB("keys"),vg=function(r){return EN[r]||(EN[r]=GB(r))},zB=!i(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),HB=I,KB=fs,qB=$,XB=vi,YB=zB,_N=vg("IE_PROTO"),yy=HB.Object,JB=yy.prototype,vy=YB?yy.getPrototypeOf:function(r){var o=XB(r);if(KB(o,_N))return o[_N];var a=o.constructor;return qB(a)&&o instanceof a?a.prototype:o instanceof yy?JB:null},yN=I,QB=$,ZB=yN.String,e7=yN.TypeError,t7=_,n7=he,r7=function(r){if(typeof r=="object"||QB(r))return r;throw e7("Can't set "+ZB(r)+" as a prototype")},s7=Object.setPrototypeOf||("__proto__"in{}?function(){var r,o=!1,a={};try{(r=t7(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(a,[]),o=a instanceof Array}catch{}return function(u,h){return n7(u),r7(h),o?r(u,h):u.__proto__=h,u}}():void 0),Sg={},o7=my,i7=Math.max,a7=Math.min,Sy=function(r,o){var a=o7(r);return a<0?i7(a+o,0):a7(a,o)},c7=St,u7=Sy,l7=Su,vN=function(r){return function(o,a,u){var h,g=c7(o),E=l7(g),S=u7(u,E);if(r&&a!=a){for(;E>S;)if((h=g[S++])!=h)return!0}else for(;E>S;S++)if((r||S in g)&&g[S]===a)return r||S||0;return!r&&-1}},d7={includes:vN(!0),indexOf:vN(!1)},Tg={},Ty=fs,h7=St,p7=d7.indexOf,f7=Tg,SN=_([].push),TN=function(r,o){var a,u=h7(r),h=0,g=[];for(a in u)!Ty(f7,a)&&Ty(u,a)&&SN(g,a);for(;o.length>h;)Ty(u,a=o[h++])&&(~p7(g,a)||SN(g,a));return g},Iy=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],m7=TN,g7=Iy.concat("length","prototype");Sg.f=Object.getOwnPropertyNames||function(r){return m7(r,g7)};var Cy={};Cy.f=Object.getOwnPropertySymbols;var E7=Fn,_7=Sg,y7=Cy,v7=he,S7=_([].concat),T7=E7("Reflect","ownKeys")||function(r){var o=_7.f(v7(r)),a=y7.f;return a?S7(o,a(r)):o},IN=fs,I7=T7,C7=G,w7=B,wy={},R7=TN,b7=Iy,Ry=Object.keys||function(r){return R7(r,b7)},N7=H,A7=z,O7=B,x7=he,k7=St,D7=Ry;wy.f=N7&&!A7?Object.defineProperties:function(r,o){x7(r);for(var a,u=k7(o),h=D7(o),g=h.length,E=0;g>E;)O7.f(r,a=h[E++],u[a]);return r};var Ig,CN=Fn("document","documentElement"),P7=he,L7=wy,wN=Iy,M7=Tg,$7=CN,F7=Rc,RN=vg("IE_PROTO"),by=function(){},bN=function(r){return"<script>"+r+"<\/script>"},NN=function(r){r.write(bN("")),r.close();var o=r.parentWindow.Object;return r=null,o},Cg=function(){try{Ig=new ActiveXObject("htmlfile")}catch{}var r,o;Cg=typeof document<"u"?document.domain&&Ig?NN(Ig):((o=F7("iframe")).style.display="none",$7.appendChild(o),o.src="javascript:",(r=o.contentWindow.document).open(),r.write(bN("document.F=Object")),r.close(),r.F):NN(Ig);for(var a=wN.length;a--;)delete Cg.prototype[wN[a]];return Cg()};M7[RN]=!0;var wg=Object.create||function(r,o){var a;return r!==null?(by.prototype=P7(r),a=new by,by.prototype=null,a[RN]=r):a=Cg(),o===void 0?a:L7.f(a,o)},U7=_("".replace),V7=String(Error("zxcasd").stack),AN=/\n\s*at [^:]*:[^\n]*/,B7=AN.test(V7),j7=Kt,W7=gn,sh={},G7=sh,z7=Mr("iterator"),H7=Array.prototype,ON={};ON[Mr("toStringTag")]="z";var Ny=String(ON)==="[object z]",K7=I,q7=Ny,X7=$,Rg=ke,Y7=Mr("toStringTag"),J7=K7.Object,Q7=Rg(function(){return arguments}())=="Arguments",Cu=q7?Rg:function(r){var o,a,u;return r===void 0?"Undefined":r===null?"Null":typeof(a=function(h,g){try{return h[g]}catch{}}(o=J7(r),Y7))=="string"?a:Q7?Rg(o):(u=Rg(o))=="Object"&&X7(o.callee)?"Arguments":u},Z7=Cu,xN=hu,e9=sh,t9=Mr("iterator"),kN=function(r){if(r!=null)return xN(r,t9)||xN(r,"@@iterator")||e9[Z7(r)]},n9=oe,r9=zr,s9=he,o9=Un,i9=kN,a9=I.TypeError,c9=oe,DN=he,u9=hu,l9=x,d9=oe,h9=he,p9=Un,f9=function(r){return r!==void 0&&(G7.Array===r||H7[z7]===r)},m9=Su,PN=y,g9=function(r,o){var a=arguments.length<2?i9(r):o;if(r9(a))return s9(n9(a,r));throw a9(o9(r)+" is not iterable")},E9=kN,LN=function(r,o,a){var u,h;DN(r);try{if(!(u=u9(r,"return"))){if(o==="throw")throw a;return a}u=c9(u,r)}catch(g){h=!0,u=g}if(o==="throw")throw a;if(h)throw u;return DN(u),a},_9=I.TypeError,bg=function(r,o){this.stopped=r,this.result=o},MN=bg.prototype,Ng=function(r,o,a){var u,h,g,E,S,T,C,w=a&&a.that,N=!(!a||!a.AS_ENTRIES),M=!(!a||!a.IS_ITERATOR),U=!(!a||!a.INTERRUPTED),Y=l9(o,w),X=function(fe){return u&&LN(u,"normal",fe),new bg(!0,fe)},J=function(fe){return N?(h9(fe),U?Y(fe[0],fe[1],X):Y(fe[0],fe[1])):U?Y(fe,X):Y(fe)};if(M)u=r;else{if(!(h=E9(r)))throw _9(p9(r)+" is not iterable");if(f9(h)){for(g=0,E=m9(r);E>g;g++)if((S=J(r[g]))&&PN(MN,S))return S;return new bg(!1)}u=g9(r,h)}for(T=u.next;!(C=d9(T,u)).done;){try{S=J(C.value)}catch(fe){LN(u,"throw",fe)}if(typeof S=="object"&&S&&PN(MN,S))return S}return new bg(!1)},y9=Cu,v9=I.String,oh=function(r){if(y9(r)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return v9(r)},S9=oh,T9=Oe,I9=!i(function(){var r=Error("a");return!("stack"in r)||(Object.defineProperty(r,"stack",T9(1,7)),r.stack!==7)}),C9=Zs,w9=I,R9=y,b9=vy,Ag=s7,N9=function(r,o,a){for(var u=I7(o),h=w7.f,g=C7.f,E=0;E<u.length;E++){var S=u[E];IN(r,S)||a&&IN(a,S)||h(r,S,g(o,S))}},$N=wg,Og=gn,Ay=Oe,A9=function(r,o){if(B7&&typeof r=="string")for(;o--;)r=U7(r,AN,"");return r},O9=function(r,o){j7(o)&&"cause"in o&&W7(r,"cause",o.cause)},x9=Ng,k9=function(r,o){return r===void 0?arguments.length<2?"":o:S9(r)},D9=I9,P9=Mr("toStringTag"),xg=w9.Error,L9=[].push,rf=function(r,o){var a,u=arguments.length>2?arguments[2]:void 0,h=R9(Oy,this);Ag?a=Ag(new xg,h?b9(this):Oy):(a=h?this:$N(Oy),Og(a,P9,"Error")),o!==void 0&&Og(a,"message",k9(o)),D9&&Og(a,"stack",A9(a.stack,1)),O9(a,u);var g=[];return x9(r,L9,{that:g}),Og(a,"errors",g),a};Ag?Ag(rf,xg):N9(rf,xg,{name:!0});var Oy=rf.prototype=$N(xg.prototype,{constructor:Ay(1,rf),message:Ay(1,""),name:Ay(1,"AggregateError")});C9({global:!0},{AggregateError:rf});var M9=$,xy=Zr,$9=_(Function.toString);M9(xy.inspectSource)||(xy.inspectSource=function(r){return $9(r)});var kg,sf,Dg,ky=xy.inspectSource,F9=$,U9=ky,FN=I.WeakMap,V9=F9(FN)&&/native code/.test(U9(FN)),UN=I,Dy=_,B9=Kt,j9=gn,Py=fs,Ly=Zr,W9=vg,G9=Tg,VN="Object already initialized",My=UN.TypeError,z9=UN.WeakMap;if(V9||Ly.state){var Vl=Ly.state||(Ly.state=new z9),H9=Dy(Vl.get),BN=Dy(Vl.has),K9=Dy(Vl.set);kg=function(r,o){if(BN(Vl,r))throw new My(VN);return o.facade=r,K9(Vl,r,o),o},sf=function(r){return H9(Vl,r)||{}},Dg=function(r){return BN(Vl,r)}}else{var ih=W9("state");G9[ih]=!0,kg=function(r,o){if(Py(r,ih))throw new My(VN);return o.facade=r,j9(r,ih,o),o},sf=function(r){return Py(r,ih)?r[ih]:{}},Dg=function(r){return Py(r,ih)}}var Bl,jN,WN,Pg={set:kg,get:sf,has:Dg,enforce:function(r){return Dg(r)?sf(r):kg(r,{})},getterFor:function(r){return function(o){var a;if(!B9(o)||(a=sf(o)).type!==r)throw My("Incompatible receiver, "+r+" required");return a}}},$y=H,q9=fs,GN=Function.prototype,X9=$y&&Object.getOwnPropertyDescriptor,Fy=q9(GN,"name"),zN={EXISTS:Fy,PROPER:Fy&&function(){}.name==="something",CONFIGURABLE:Fy&&(!$y||$y&&X9(GN,"name").configurable)},Y9=gn,Lg=function(r,o,a,u){u&&u.enumerable?r[o]=a:Y9(r,o,a)},J9=i,Q9=$,Z9=wg,HN=vy,ej=Lg,Uy=Mr("iterator"),KN=!1;[].keys&&("next"in(WN=[].keys())?(jN=HN(HN(WN)))!==Object.prototype&&(Bl=jN):KN=!0);var tj=Bl==null||J9(function(){var r={};return Bl[Uy].call(r)!==r});Q9((Bl=tj?{}:Z9(Bl))[Uy])||ej(Bl,Uy,function(){return this});var qN={IteratorPrototype:Bl,BUGGY_SAFARI_ITERATORS:KN},nj=Cu,rj=Ny?{}.toString:function(){return"[object "+nj(this)+"]"},sj=Ny,oj=B.f,ij=gn,aj=fs,cj=rj,XN=Mr("toStringTag"),of=function(r,o,a,u){if(r){var h=a?r:r.prototype;aj(h,XN)||oj(h,XN,{configurable:!0,value:o}),u&&!sj&&ij(h,"toString",cj)}},uj=qN.IteratorPrototype,lj=wg,dj=Oe,hj=of,pj=sh,fj=function(){return this},mj=Zs,gj=oe,Ej=function(r,o,a,u){var h=o+" Iterator";return r.prototype=lj(uj,{next:dj(+!u,a)}),hj(r,h,!1,!0),pj[h]=fj,r},_j=vy,yj=of,YN=Lg,JN=sh,vj=zN.PROPER,Mg=qN.BUGGY_SAFARI_ITERATORS,Vy=Mr("iterator"),QN="keys",$g="values",ZN="entries",Sj=function(){return this},eA=function(r,o,a,u,h,g,E){Ej(a,o,u);var S,T,C,w=function(fe){if(fe===h&&X)return X;if(!Mg&&fe in U)return U[fe];switch(fe){case QN:case $g:case ZN:return function(){return new a(this,fe)}}return function(){return new a(this)}},N=o+" Iterator",M=!1,U=r.prototype,Y=U[Vy]||U["@@iterator"]||h&&U[h],X=!Mg&&Y||w(h),J=o=="Array"&&U.entries||Y;if(J&&(S=_j(J.call(new r)))!==Object.prototype&&S.next&&(yj(S,N,!0,!0),JN[N]=Sj),vj&&h==$g&&Y&&Y.name!==$g&&(M=!0,X=function(){return gj(Y,this)}),h)if(T={values:w($g),keys:g?X:w(QN),entries:w(ZN)},E)for(C in T)(Mg||M||!(C in U))&&YN(U,C,T[C]);else mj({target:o,proto:!0,forced:Mg||M},T);return E&&U[Vy]!==X&&YN(U,Vy,X,{name:h}),JN[o]=X,T},Tj=St,tA=sh,nA=Pg;B.f;var Ij=eA,rA="Array Iterator",Cj=nA.set,wj=nA.getterFor(rA);Ij(Array,"Array",function(r,o){Cj(this,{type:rA,target:Tj(r),index:0,kind:o})},function(){var r=wj(this),o=r.target,a=r.kind,u=r.index++;return!o||u>=o.length?(r.target=void 0,{value:void 0,done:!0}):a=="keys"?{value:u,done:!1}:a=="values"?{value:o[u],done:!1}:{value:[u,o[u]],done:!1}},"values"),tA.Arguments=tA.Array;var sA=I.Promise,Rj=Lg,bj=Fn,Nj=B,Aj=H,oA=Mr("species"),Oj=y,xj=I.TypeError,iA=Mr("iterator"),aA=!1;try{var kj=0,cA={next:function(){return{done:!!kj++}},return:function(){aA=!0}};cA[iA]=function(){return this},Array.from(cA,function(){throw 2})}catch{}var Dj=_,Pj=i,uA=$,Lj=Cu,Mj=ky,lA=function(){},$j=[],dA=Fn("Reflect","construct"),By=/^\s*(?:class|function)\b/,Fj=Dj(By.exec),Uj=!By.exec(lA),af=function(r){if(!uA(r))return!1;try{return dA(lA,$j,r),!0}catch{return!1}},hA=function(r){if(!uA(r))return!1;switch(Lj(r)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Uj||!!Fj(By,Mj(r))}catch{return!0}};hA.sham=!0;var cf,ah,pA,jy,Wy=!dA||Pj(function(){var r;return af(af.call)||!af(Object)||!af(function(){r=!0})||r})?hA:af,Vj=Wy,Bj=Un,jj=I.TypeError,fA=he,Wj=function(r){if(Vj(r))return r;throw jj(Bj(r)+" is not a constructor")},Gj=Mr("species"),mA=function(r,o){var a,u=fA(r).constructor;return u===void 0||(a=fA(u)[Gj])==null?o:Wj(a)},Gy=_([].slice),gA=/(?:ipad|iphone|ipod).*applewebkit/i.test(Pn),Ti=I,zj=L,Hj=x,EA=$,Kj=fs,qj=i,_A=CN,Xj=Gy,yA=Rc,Yj=gA,Jj=_g,zy=Ti.setImmediate,Hy=Ti.clearImmediate,Qj=Ti.process,Ky=Ti.Dispatch,Zj=Ti.Function,vA=Ti.MessageChannel,eW=Ti.String,qy=0,uf={},tW="onreadystatechange";try{cf=Ti.location}catch{}var Xy=function(r){if(Kj(uf,r)){var o=uf[r];delete uf[r],o()}},Yy=function(r){return function(){Xy(r)}},SA=function(r){Xy(r.data)},TA=function(r){Ti.postMessage(eW(r),cf.protocol+"//"+cf.host)};zy&&Hy||(zy=function(r){var o=Xj(arguments,1);return uf[++qy]=function(){zj(EA(r)?r:Zj(r),void 0,o)},ah(qy),qy},Hy=function(r){delete uf[r]},Jj?ah=function(r){Qj.nextTick(Yy(r))}:Ky&&Ky.now?ah=function(r){Ky.now(Yy(r))}:vA&&!Yj?(jy=(pA=new vA).port2,pA.port1.onmessage=SA,ah=Hj(jy.postMessage,jy)):Ti.addEventListener&&EA(Ti.postMessage)&&!Ti.importScripts&&cf&&cf.protocol!=="file:"&&!qj(TA)?(ah=TA,Ti.addEventListener("message",SA,!1)):ah=tW in yA("script")?function(r){_A.appendChild(yA("script")).onreadystatechange=function(){_A.removeChild(this),Xy(r)}}:function(r){setTimeout(Yy(r),0)});var lf,jl,df,ch,Jy,Qy,Zy,IA,CA={set:zy,clear:Hy},nW=I,rW=/ipad|iphone|ipod/i.test(Pn)&&nW.Pebble!==void 0,sW=/web0s(?!.*chrome)/i.test(Pn),Wl=I,wA=x,oW=G.f,ev=CA.set,iW=gA,aW=rW,cW=sW,tv=_g,RA=Wl.MutationObserver||Wl.WebKitMutationObserver,bA=Wl.document,NA=Wl.process,Fg=Wl.Promise,AA=oW(Wl,"queueMicrotask"),OA=AA&&AA.value;OA||(lf=function(){var r,o;for(tv&&(r=NA.domain)&&r.exit();jl;){o=jl.fn,jl=jl.next;try{o()}catch(a){throw jl?ch():df=void 0,a}}df=void 0,r&&r.enter()},iW||tv||cW||!RA||!bA?!aW&&Fg&&Fg.resolve?((Zy=Fg.resolve(void 0)).constructor=Fg,IA=wA(Zy.then,Zy),ch=function(){IA(lf)}):tv?ch=function(){NA.nextTick(lf)}:(ev=wA(ev,Wl),ch=function(){ev(lf)}):(Jy=!0,Qy=bA.createTextNode(""),new RA(lf).observe(Qy,{characterData:!0}),ch=function(){Qy.data=Jy=!Jy}));var uW=OA||function(r){var o={fn:r,next:void 0};df&&(df.next=o),jl||(jl=o,ch()),df=o},uh={},xA=zr,lW=function(r){var o,a;this.promise=new r(function(u,h){if(o!==void 0||a!==void 0)throw TypeError("Bad Promise constructor");o=u,a=h}),this.resolve=xA(o),this.reject=xA(a)};uh.f=function(r){return new lW(r)};var dW=he,hW=Kt,pW=uh,kA=function(r,o){if(dW(r),hW(o)&&o.constructor===r)return o;var a=pW.f(r);return(0,a.resolve)(o),a.promise},fW=I,Ug=function(r){try{return{error:!1,value:r()}}catch(o){return{error:!0,value:o}}},DA=function(){this.head=null,this.tail=null};DA.prototype={add:function(r){var o={item:r,next:null};this.head?this.tail.next=o:this.head=o,this.tail=o},get:function(){var r=this.head;if(r)return this.head=r.next,this.tail===r&&(this.tail=null),r.item}};var nv,PA,rv,mW=typeof window=="object",Vg=Zs,Nc=I,gW=Fn,wu=oe,sv=sA,EW=function(r,o,a){for(var u in o)a&&a.unsafe&&r[u]?r[u]=o[u]:Rj(r,u,o[u],a);return r},_W=of,yW=function(r){var o=bj(r),a=Nj.f;Aj&&o&&!o[oA]&&a(o,oA,{configurable:!0,get:function(){return this}})},ov=zr,Bg=$,vW=Kt,SW=function(r,o){if(Oj(o,r))return r;throw xj("Incorrect invocation")},TW=ky,LA=Ng,IW=function(r,o){if(!o&&!aA)return!1;var a=!1;try{var u={};u[iA]=function(){return{next:function(){return{done:a=!0}}}},r(u)}catch{}return a},CW=mA,MA=CA.set,iv=uW,wW=kA,RW=function(r,o){var a=fW.console;a&&a.error&&(arguments.length==1?a.error(r):a.error(r,o))},$A=uh,av=Ug,bW=DA,cv=Pg,NW=vn,AW=mW,jg=_g,FA=Wr,OW=Mr("species"),ec="Promise",UA=cv.getterFor(ec),xW=cv.set,kW=cv.getterFor(ec),DW=sv&&sv.prototype,tc=sv,Wg=DW,VA=Nc.TypeError,uv=Nc.document,lv=Nc.process,lh=$A.f,PW=lh,LW=!!(uv&&uv.createEvent&&Nc.dispatchEvent),BA=Bg(Nc.PromiseRejectionEvent),jA="unhandledrejection",Gg=NW(ec,function(){var r=TW(tc),o=r!==String(tc);if(!o&&FA===66||!Wg.finally)return!0;if(FA>=51&&/native code/.test(r))return!1;var a=new tc(function(h){h(1)}),u=function(h){h(function(){},function(){})};return(a.constructor={})[OW]=u,!(a.then(function(){})instanceof u)||!o&&AW&&!BA}),MW=Gg||!IW(function(r){tc.all(r).catch(function(){})}),WA=function(r){var o;return!(!vW(r)||!Bg(o=r.then))&&o},GA=function(r,o){var a,u,h,g=o.value,E=o.state==1,S=E?r.ok:r.fail,T=r.resolve,C=r.reject,w=r.domain;try{S?(E||(o.rejection===2&&FW(o),o.rejection=1),S===!0?a=g:(w&&w.enter(),a=S(g),w&&(w.exit(),h=!0)),a===r.promise?C(VA("Promise-chain cycle")):(u=WA(a))?wu(u,a,T,C):T(a)):C(g)}catch(N){w&&!h&&w.exit(),C(N)}},zA=function(r,o){r.notified||(r.notified=!0,iv(function(){for(var a,u=r.reactions;a=u.get();)GA(a,r);r.notified=!1,o&&!r.rejection&&$W(r)}))},HA=function(r,o,a){var u,h;LW?((u=uv.createEvent("Event")).promise=o,u.reason=a,u.initEvent(r,!1,!0),Nc.dispatchEvent(u)):u={promise:o,reason:a},!BA&&(h=Nc["on"+r])?h(u):r===jA&&RW("Unhandled promise rejection",a)},$W=function(r){wu(MA,Nc,function(){var o,a=r.facade,u=r.value;if(KA(r)&&(o=av(function(){jg?lv.emit("unhandledRejection",u,a):HA(jA,a,u)}),r.rejection=jg||KA(r)?2:1,o.error))throw o.value})},KA=function(r){return r.rejection!==1&&!r.parent},FW=function(r){wu(MA,Nc,function(){var o=r.facade;jg?lv.emit("rejectionHandled",o):HA("rejectionhandled",o,r.value)})},dh=function(r,o,a){return function(u){r(o,u,a)}},hh=function(r,o,a){r.done||(r.done=!0,a&&(r=a),r.value=o,r.state=2,zA(r,!0))},dv=function(r,o,a){if(!r.done){r.done=!0,a&&(r=a);try{if(r.facade===o)throw VA("Promise can't be resolved itself");var u=WA(o);u?iv(function(){var h={done:!1};try{wu(u,o,dh(dv,h,r),dh(hh,h,r))}catch(g){hh(h,g,r)}}):(r.value=o,r.state=1,zA(r,!1))}catch(h){hh({done:!1},h,r)}}};Gg&&(Wg=(tc=function(r){SW(this,Wg),ov(r),wu(nv,this);var o=UA(this);try{r(dh(dv,o),dh(hh,o))}catch(a){hh(o,a)}}).prototype,(nv=function(r){xW(this,{type:ec,done:!1,notified:!1,parent:!1,reactions:new bW,rejection:!1,state:0,value:void 0})}).prototype=EW(Wg,{then:function(r,o){var a=kW(this),u=lh(CW(this,tc));return a.parent=!0,u.ok=!Bg(r)||r,u.fail=Bg(o)&&o,u.domain=jg?lv.domain:void 0,a.state==0?a.reactions.add(u):iv(function(){GA(u,a)}),u.promise},catch:function(r){return this.then(void 0,r)}}),PA=function(){var r=new nv,o=UA(r);this.promise=r,this.resolve=dh(dv,o),this.reject=dh(hh,o)},$A.f=lh=function(r){return r===tc||r===rv?new PA(r):PW(r)}),Vg({global:!0,wrap:!0,forced:Gg},{Promise:tc}),_W(tc,ec,!1,!0),yW(ec),rv=gW(ec),Vg({target:ec,stat:!0,forced:Gg},{reject:function(r){var o=lh(this);return wu(o.reject,void 0,r),o.promise}}),Vg({target:ec,stat:!0,forced:!0},{resolve:function(r){return wW(this===rv?tc:this,r)}}),Vg({target:ec,stat:!0,forced:MW},{all:function(r){var o=this,a=lh(o),u=a.resolve,h=a.reject,g=av(function(){var E=ov(o.resolve),S=[],T=0,C=1;LA(r,function(w){var N=T++,M=!1;C++,wu(E,o,w).then(function(U){M||(M=!0,S[N]=U,--C||u(S))},h)}),--C||u(S)});return g.error&&h(g.value),a.promise},race:function(r){var o=this,a=lh(o),u=a.reject,h=av(function(){var g=ov(o.resolve);LA(r,function(E){wu(g,o,E).then(a.resolve,u)})});return h.error&&u(h.value),a.promise}});var UW=oe,VW=zr,BW=uh,jW=Ug,WW=Ng;Zs({target:"Promise",stat:!0},{allSettled:function(r){var o=this,a=BW.f(o),u=a.resolve,h=a.reject,g=jW(function(){var E=VW(o.resolve),S=[],T=0,C=1;WW(r,function(w){var N=T++,M=!1;C++,UW(E,o,w).then(function(U){M||(M=!0,S[N]={status:"fulfilled",value:U},--C||u(S))},function(U){M||(M=!0,S[N]={status:"rejected",reason:U},--C||u(S))})}),--C||u(S)});return g.error&&h(g.value),a.promise}});var GW=zr,zW=Fn,HW=oe,KW=uh,qW=Ug,XW=Ng,qA="No one promise resolved";Zs({target:"Promise",stat:!0},{any:function(r){var o=this,a=zW("AggregateError"),u=KW.f(o),h=u.resolve,g=u.reject,E=qW(function(){var S=GW(o.resolve),T=[],C=0,w=1,N=!1;XW(r,function(M){var U=C++,Y=!1;w++,HW(S,o,M).then(function(X){Y||N||(N=!0,h(X))},function(X){Y||N||(Y=!0,T[U]=X,--w||g(new a(T,qA)))})}),--w||g(new a(T,qA))});return E.error&&g(E.value),u.promise}});var XA=sA,YW=Fn,JW=$,QW=mA,YA=kA;Zs({target:"Promise",proto:!0,real:!0,forced:!!XA&&i(function(){XA.prototype.finally.call({then:function(){}},function(){})})},{finally:function(r){var o=QW(this,YW("Promise")),a=JW(r);return this.then(a?function(u){return YA(o,r()).then(function(){return u})}:r,a?function(u){return YA(o,r()).then(function(){throw u})}:r)}});var hv=_,ZW=my,eG=oh,tG=Ct,nG=hv("".charAt),JA=hv("".charCodeAt),rG=hv("".slice),QA=function(r){return function(o,a){var u,h,g=eG(tG(o)),E=ZW(a),S=g.length;return E<0||E>=S?r?"":void 0:(u=JA(g,E))<55296||u>56319||E+1===S||(h=JA(g,E+1))<56320||h>57343?r?nG(g,E):u:r?rG(g,E,E+2):h-56320+(u-55296<<10)+65536}},sG={codeAt:QA(!1),charAt:QA(!0)}.charAt,oG=oh,ZA=Pg,iG=eA,eO="String Iterator",aG=ZA.set,cG=ZA.getterFor(eO);iG(String,"String",function(r){aG(this,{type:eO,string:oG(r),index:0})},function(){var r,o=cG(this),a=o.string,u=o.index;return u>=a.length?{value:void 0,done:!0}:(r=sG(a,u),o.index+=r.length,{value:r,done:!1})});var uG=sn.Promise,lG={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},dG=I,hG=Cu,pG=gn,tO=sh,nO=Mr("toStringTag");for(var pv in lG){var rO=dG[pv],fv=rO&&rO.prototype;fv&&hG(fv)!==nO&&pG(fv,nO,pv),tO[pv]=tO.Array}var sO=uG,Je=sO;const oO=pN;function iO(r,o){const a=r&&r.navigator;if(!a.mediaDevices)return;const u=function(E){if(typeof E!="object"||E.mandatory||E.optional)return E;const S={};return Object.keys(E).forEach(T=>{if(T==="require"||T==="advanced"||T==="mediaSource")return;const C=typeof E[T]=="object"?E[T]:{ideal:E[T]};C.exact!==void 0&&typeof C.exact=="number"&&(C.min=C.max=C.exact);const w=function(N,M){return N?N+M.charAt(0).toUpperCase()+M.slice(1):M==="deviceId"?"sourceId":M};if(C.ideal!==void 0){S.optional=S.optional||[];let N={};typeof C.ideal=="number"?(N[w("min",T)]=C.ideal,S.optional.push(N),N={},N[w("max",T)]=C.ideal,S.optional.push(N)):(N[w("",T)]=C.ideal,S.optional.push(N))}C.exact!==void 0&&typeof C.exact!="number"?(S.mandatory=S.mandatory||{},S.mandatory[w("",T)]=C.exact):["min","max"].forEach(N=>{C[N]!==void 0&&(S.mandatory=S.mandatory||{},S.mandatory[w(N,T)]=C[N])})}),E.advanced&&(S.optional=(S.optional||[]).concat(E.advanced)),S},h=function(E,S){if(o.version>=61)return S(E);if((E=JSON.parse(JSON.stringify(E)))&&typeof E.audio=="object"){const T=function(C,w,N){w in C&&!(N in C)&&(C[N]=C[w],delete C[w])};T((E=JSON.parse(JSON.stringify(E))).audio,"autoGainControl","googAutoGainControl"),T(E.audio,"noiseSuppression","googNoiseSuppression"),E.audio=u(E.audio)}if(E&&typeof E.video=="object"){let T=E.video.facingMode;T=T&&(typeof T=="object"?T:{ideal:T});const C=o.version<66;if(T&&(T.exact==="user"||T.exact==="environment"||T.ideal==="user"||T.ideal==="environment")&&(!a.mediaDevices.getSupportedConstraints||!a.mediaDevices.getSupportedConstraints().facingMode||C)){let w;if(delete E.video.facingMode,T.exact==="environment"||T.ideal==="environment"?w=["back","rear"]:T.exact!=="user"&&T.ideal!=="user"||(w=["front"]),w)return a.mediaDevices.enumerateDevices().then(N=>{let M=(N=N.filter(U=>U.kind==="videoinput")).find(U=>w.some(Y=>U.label.toLowerCase().includes(Y)));return!M&&N.length&&w.includes("back")&&(M=N[N.length-1]),M&&(E.video.deviceId=T.exact?{exact:M.deviceId}:{ideal:M.deviceId}),E.video=u(E.video),oO("chrome: "+JSON.stringify(E)),S(E)})}E.video=u(E.video)}return oO("chrome: "+JSON.stringify(E)),S(E)},g=function(E){return o.version>=64?E:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[E.name]||E.name,message:E.message,constraint:E.constraint||E.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(a.getUserMedia=function(E,S,T){h(E,C=>{a.webkitGetUserMedia(C,S,w=>{T&&T(g(w))})})}.bind(a),a.mediaDevices.getUserMedia){const E=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(S){return h(S,T=>E(T).then(C=>{if(T.audio&&!C.getAudioTracks().length||T.video&&!C.getVideoTracks().length)throw C.getTracks().forEach(w=>{w.stop()}),new DOMException("","NotFoundError");return C},C=>Je.reject(g(C))))}}}function aO(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function cO(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(a){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=a)},enumerable:!0,configurable:!0});const o=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=a=>{a.stream.addEventListener("addtrack",u=>{let h;h=r.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(E=>E.track&&E.track.id===u.track.id):{track:u.track};const g=new Event("track");g.track=u.track,g.receiver=h,g.transceiver={receiver:h},g.streams=[a.stream],this.dispatchEvent(g)}),a.stream.getTracks().forEach(u=>{let h;h=r.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(E=>E.track&&E.track.id===u.id):{track:u};const g=new Event("track");g.track=u,g.receiver=h,g.transceiver={receiver:h},g.streams=[a.stream],this.dispatchEvent(g)})},this.addEventListener("addstream",this._ontrackpoly)),o.apply(this,arguments)}}else Ul(r,"track",o=>(o.transceiver||Object.defineProperty(o,"transceiver",{value:{receiver:o.receiver}}),o))}function uO(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){const o=function(h,g){return{track:g,get dtmf(){return this._dtmf===void 0&&(g.kind==="audio"?this._dtmf=h.createDTMFSender(g):this._dtmf=null),this._dtmf},_pc:h}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const h=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(E,S){let T=h.apply(this,arguments);return T||(T=o(this,E),this._senders.push(T)),T};const g=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(E){g.apply(this,arguments);const S=this._senders.indexOf(E);S!==-1&&this._senders.splice(S,1)}}const a=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(h){this._senders=this._senders||[],a.apply(this,[h]),h.getTracks().forEach(g=>{this._senders.push(o(this,g))})};const u=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(h){this._senders=this._senders||[],u.apply(this,[h]),h.getTracks().forEach(g=>{const E=this._senders.find(S=>S.track===g);E&&this._senders.splice(this._senders.indexOf(E),1)})}}else if(typeof r=="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){const o=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){const a=o.apply(this,[]);return a.forEach(u=>u._pc=this),a},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function lO(r){if(!r.RTCPeerConnection)return;const o=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[a,u,h]=arguments;if(arguments.length>0&&typeof a=="function")return o.apply(this,arguments);if(o.length===0&&(arguments.length===0||typeof a!="function"))return o.apply(this,[]);const g=function(S){const T={};return S.result().forEach(C=>{const w={id:C.id,timestamp:C.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[C.type]||C.type};C.names().forEach(N=>{w[N]=C.stat(N)}),T[w.id]=w}),T},E=function(S){return new Map(Object.keys(S).map(T=>[T,S[T]]))};if(arguments.length>=2){const S=function(T){u(E(g(T)))};return o.apply(this,[S,a])}return new Je((S,T)=>{o.apply(this,[function(C){S(E(g(C)))},T])}).then(u,h)}}function dO(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver))return;if(!("getStats"in r.RTCRtpSender.prototype)){const a=r.RTCPeerConnection.prototype.getSenders;a&&(r.RTCPeerConnection.prototype.getSenders=function(){const h=a.apply(this,[]);return h.forEach(g=>g._pc=this),h});const u=r.RTCPeerConnection.prototype.addTrack;u&&(r.RTCPeerConnection.prototype.addTrack=function(){const h=u.apply(this,arguments);return h._pc=this,h}),r.RTCRtpSender.prototype.getStats=function(){const h=this;return this._pc.getStats().then(g=>gN(g,h.track,!0))}}if(!("getStats"in r.RTCRtpReceiver.prototype)){const a=r.RTCPeerConnection.prototype.getReceivers;a&&(r.RTCPeerConnection.prototype.getReceivers=function(){const u=a.apply(this,[]);return u.forEach(h=>h._pc=this),u}),Ul(r,"track",u=>(u.receiver._pc=u.srcElement,u)),r.RTCRtpReceiver.prototype.getStats=function(){const u=this;return this._pc.getStats().then(h=>gN(h,u.track,!1))}}if(!("getStats"in r.RTCRtpSender.prototype)||!("getStats"in r.RTCRtpReceiver.prototype))return;const o=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){const a=arguments[0];let u,h,g;return this.getSenders().forEach(E=>{E.track===a&&(u?g=!0:u=E)}),this.getReceivers().forEach(E=>(E.track===a&&(h?g=!0:h=E),E.track===a)),g||u&&h?Je.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):u?u.getStats():h?h.getStats():Je.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}function hO(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(g=>this._shimmedLocalStreams[g][0])};const o=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(g,E){if(!E)return o.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const S=o.apply(this,arguments);return this._shimmedLocalStreams[E.id]?this._shimmedLocalStreams[E.id].indexOf(S)===-1&&this._shimmedLocalStreams[E.id].push(S):this._shimmedLocalStreams[E.id]=[E,S],S};const a=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(g){this._shimmedLocalStreams=this._shimmedLocalStreams||{},g.getTracks().forEach(T=>{if(this.getSenders().find(C=>C.track===T))throw new DOMException("Track already exists.","InvalidAccessError")});const E=this.getSenders();a.apply(this,arguments);const S=this.getSenders().filter(T=>E.indexOf(T)===-1);this._shimmedLocalStreams[g.id]=[g].concat(S)};const u=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(g){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[g.id],u.apply(this,arguments)};const h=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(g){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},g&&Object.keys(this._shimmedLocalStreams).forEach(E=>{const S=this._shimmedLocalStreams[E].indexOf(g);S!==-1&&this._shimmedLocalStreams[E].splice(S,1),this._shimmedLocalStreams[E].length===1&&delete this._shimmedLocalStreams[E]}),h.apply(this,arguments)}}function pO(r,o){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&o.version>=65)return hO(r);const a=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){const C=a.apply(this);return this._reverseStreams=this._reverseStreams||{},C.map(w=>this._reverseStreams[w.id])};const u=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(C){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},C.getTracks().forEach(w=>{if(this.getSenders().find(N=>N.track===w))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[C.id]){const w=new r.MediaStream(C.getTracks());this._streams[C.id]=w,this._reverseStreams[w.id]=C,C=w}u.apply(this,[C])};const h=r.RTCPeerConnection.prototype.removeStream;function g(C,w){let N=w.sdp;return Object.keys(C._reverseStreams||[]).forEach(M=>{const U=C._reverseStreams[M],Y=C._streams[U.id];N=N.replace(new RegExp(Y.id,"g"),U.id)}),new RTCSessionDescription({type:w.type,sdp:N})}function E(C,w){let N=w.sdp;return Object.keys(C._reverseStreams||[]).forEach(M=>{const U=C._reverseStreams[M],Y=C._streams[U.id];N=N.replace(new RegExp(U.id,"g"),Y.id)}),new RTCSessionDescription({type:w.type,sdp:N})}r.RTCPeerConnection.prototype.removeStream=function(C){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.apply(this,[this._streams[C.id]||C]),delete this._reverseStreams[this._streams[C.id]?this._streams[C.id].id:C.id],delete this._streams[C.id]},r.RTCPeerConnection.prototype.addTrack=function(C,w){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const N=[].slice.call(arguments,1);if(N.length!==1||!N[0].getTracks().find(Y=>Y===C))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(Y=>Y.track===C))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const U=this._streams[w.id];if(U)U.addTrack(C),Je.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const Y=new r.MediaStream([C]);this._streams[w.id]=Y,this._reverseStreams[Y.id]=w,this.addStream(Y)}return this.getSenders().find(Y=>Y.track===C)},["createOffer","createAnswer"].forEach(function(C){const w=r.RTCPeerConnection.prototype[C],N={[C](){const M=arguments;return arguments.length&&typeof arguments[0]=="function"?w.apply(this,[U=>{const Y=g(this,U);M[0].apply(null,[Y])},U=>{M[1]&&M[1].apply(null,U)},arguments[2]]):w.apply(this,arguments).then(U=>g(this,U))}};r.RTCPeerConnection.prototype[C]=N[C]});const S=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=E(this,arguments[0]),S.apply(this,arguments)):S.apply(this,arguments)};const T=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get(){const C=T.get.apply(this);return C.type===""?C:g(this,C)}}),r.RTCPeerConnection.prototype.removeTrack=function(C){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!C._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(C._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let w;this._streams=this._streams||{},Object.keys(this._streams).forEach(N=>{this._streams[N].getTracks().find(M=>C.track===M)&&(w=this._streams[N])}),w&&(w.getTracks().length===1?this.removeStream(this._reverseStreams[w.id]):w.removeTrack(C.track),this.dispatchEvent(new Event("negotiationneeded")))}}function mv(r,o){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),r.RTCPeerConnection&&o.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const u=r.RTCPeerConnection.prototype[a],h={[a](){return arguments[0]=new(a==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};r.RTCPeerConnection.prototype[a]=h[a]})}function fO(r,o){Ul(r,"negotiationneeded",a=>{const u=a.target;if(!(o.version<72||u.getConfiguration&&u.getConfiguration().sdpSemantics==="plan-b")||u.signalingState==="stable")return a})}var mO=Object.freeze({__proto__:null,shimMediaStream:aO,shimOnTrack:cO,shimGetSendersWithDtmf:uO,shimGetStats:lO,shimSenderReceiverGetStats:dO,shimAddTrackRemoveTrackWithNative:hO,shimAddTrackRemoveTrack:pO,shimPeerConnection:mv,fixNegotiationNeeded:fO,shimGetUserMedia:iO,shimGetDisplayMedia:function(r,o){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(typeof o=="function"?r.navigator.mediaDevices.getDisplayMedia=function(a){return o(a).then(u=>{const h=a.video&&a.video.width,g=a.video&&a.video.height,E=a.video&&a.video.frameRate;return a.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:u,maxFrameRate:E||3}},h&&(a.video.mandatory.maxWidth=h),g&&(a.video.mandatory.maxHeight=g),r.navigator.mediaDevices.getUserMedia(a)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function gO(r,o){const a=r&&r.navigator,u=r&&r.MediaStreamTrack;if(a.getUserMedia=function(h,g,E){_y("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),a.mediaDevices.getUserMedia(h).then(g,E)},!(o.version>55&&"autoGainControl"in a.mediaDevices.getSupportedConstraints())){const h=function(E,S,T){S in E&&!(T in E)&&(E[T]=E[S],delete E[S])},g=a.mediaDevices.getUserMedia.bind(a.mediaDevices);if(a.mediaDevices.getUserMedia=function(E){return typeof E=="object"&&typeof E.audio=="object"&&(E=JSON.parse(JSON.stringify(E)),h(E.audio,"autoGainControl","mozAutoGainControl"),h(E.audio,"noiseSuppression","mozNoiseSuppression")),g(E)},u&&u.prototype.getSettings){const E=u.prototype.getSettings;u.prototype.getSettings=function(){const S=E.apply(this,arguments);return h(S,"mozAutoGainControl","autoGainControl"),h(S,"mozNoiseSuppression","noiseSuppression"),S}}if(u&&u.prototype.applyConstraints){const E=u.prototype.applyConstraints;u.prototype.applyConstraints=function(S){return this.kind==="audio"&&typeof S=="object"&&(S=JSON.parse(JSON.stringify(S)),h(S,"autoGainControl","mozAutoGainControl"),h(S,"noiseSuppression","mozNoiseSuppression")),E.apply(this,[S])}}}}function EO(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gv(r,o){if(typeof r!="object"||!r.RTCPeerConnection&&!r.mozRTCPeerConnection)return;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),o.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(h){const g=r.RTCPeerConnection.prototype[h],E={[h](){return arguments[0]=new(h==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),g.apply(this,arguments)}};r.RTCPeerConnection.prototype[h]=E[h]});const a={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},u=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[h,g,E]=arguments;return u.apply(this,[h||null]).then(S=>{if(o.version<53&&!g)try{S.forEach(T=>{T.type=a[T.type]||T.type})}catch(T){if(T.name!=="TypeError")throw T;S.forEach((C,w)=>{S.set(w,Object.assign({},C,{type:a[C.type]||C.type}))})}return S}).then(g,E)}}function _O(r){if(typeof r!="object"||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)return;const o=r.RTCPeerConnection.prototype.getSenders;o&&(r.RTCPeerConnection.prototype.getSenders=function(){const u=o.apply(this,[]);return u.forEach(h=>h._pc=this),u});const a=r.RTCPeerConnection.prototype.addTrack;a&&(r.RTCPeerConnection.prototype.addTrack=function(){const u=a.apply(this,arguments);return u._pc=this,u}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Je.resolve(new Map)}}function yO(r){if(typeof r!="object"||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)return;const o=r.RTCPeerConnection.prototype.getReceivers;o&&(r.RTCPeerConnection.prototype.getReceivers=function(){const a=o.apply(this,[]);return a.forEach(u=>u._pc=this),a}),Ul(r,"track",a=>(a.receiver._pc=a.srcElement,a)),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function vO(r){r.RTCPeerConnection&&!("removeStream"in r.RTCPeerConnection.prototype)&&(r.RTCPeerConnection.prototype.removeStream=function(o){_y("removeStream","removeTrack"),this.getSenders().forEach(a=>{a.track&&o.getTracks().includes(a.track)&&this.removeTrack(a)})})}function SO(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function TO(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const o=r.RTCPeerConnection.prototype.addTransceiver;o&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let a=arguments[1]&&arguments[1].sendEncodings;a===void 0&&(a=[]),a=[...a];const u=a.length>0;u&&a.forEach(g=>{if("rid"in g&&!/^[a-z0-9]{0,16}$/i.test(g.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in g&&!(parseFloat(g.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in g&&!(parseFloat(g.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const h=o.apply(this,arguments);if(u){const{sender:g}=h,E=g.getParameters();(!("encodings"in E)||E.encodings.length===1&&Object.keys(E.encodings[0]).length===0)&&(E.encodings=a,g.sendEncodings=a,this.setParametersPromises.push(g.setParameters(E).then(()=>{delete g.sendEncodings}).catch(()=>{delete g.sendEncodings})))}return h})}function IO(r){if(typeof r!="object"||!r.RTCRtpSender)return;const o=r.RTCRtpSender.prototype.getParameters;o&&(r.RTCRtpSender.prototype.getParameters=function(){const a=o.apply(this,arguments);return"encodings"in a||(a.encodings=[].concat(this.sendEncodings||[{}])),a})}function CO(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const o=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Je.all(this.setParametersPromises).then(()=>o.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):o.apply(this,arguments)}}function wO(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const o=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Je.all(this.setParametersPromises).then(()=>o.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):o.apply(this,arguments)}}var RO=Object.freeze({__proto__:null,shimOnTrack:EO,shimPeerConnection:gv,shimSenderGetStats:_O,shimReceiverGetStats:yO,shimRemoveStream:vO,shimRTCDataChannel:SO,shimAddTransceiver:TO,shimGetParameters:IO,shimCreateOffer:CO,shimCreateAnswer:wO,shimGetUserMedia:gO,shimGetDisplayMedia:function(r,o){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(a){if(!a||!a.video){const u=new DOMException("getDisplayMedia without video constraints is undefined");return u.name="NotFoundError",u.code=8,Je.reject(u)}return a.video===!0?a.video={mediaSource:o}:a.video.mediaSource=o,r.navigator.mediaDevices.getUserMedia(a)})}});function bO(r){if(typeof r=="object"&&r.RTCPeerConnection){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){const o=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(a){this._localStreams||(this._localStreams=[]),this._localStreams.includes(a)||this._localStreams.push(a),a.getAudioTracks().forEach(u=>o.call(this,u,a)),a.getVideoTracks().forEach(u=>o.call(this,u,a))},r.RTCPeerConnection.prototype.addTrack=function(a){for(var u=arguments.length,h=new Array(u>1?u-1:0),g=1;g<u;g++)h[g-1]=arguments[g];return h&&h.forEach(E=>{this._localStreams?this._localStreams.includes(E)||this._localStreams.push(E):this._localStreams=[E]}),o.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(o){this._localStreams||(this._localStreams=[]);const a=this._localStreams.indexOf(o);if(a===-1)return;this._localStreams.splice(a,1);const u=o.getTracks();this.getSenders().forEach(h=>{u.includes(h.track)&&this.removeTrack(h)})})}}function NO(r){if(typeof r=="object"&&r.RTCPeerConnection&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(a){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=a),this.addEventListener("track",this._onaddstreampoly=u=>{u.streams.forEach(h=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(h))return;this._remoteStreams.push(h);const g=new Event("addstream");g.stream=h,this.dispatchEvent(g)})})}});const o=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){const a=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(u){u.streams.forEach(h=>{if(a._remoteStreams||(a._remoteStreams=[]),a._remoteStreams.indexOf(h)>=0)return;a._remoteStreams.push(h);const g=new Event("addstream");g.stream=h,a.dispatchEvent(g)})}),o.apply(a,arguments)}}}function AO(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const o=r.RTCPeerConnection.prototype,a=o.createOffer,u=o.createAnswer,h=o.setLocalDescription,g=o.setRemoteDescription,E=o.addIceCandidate;o.createOffer=function(T,C){const w=arguments.length>=2?arguments[2]:arguments[0],N=a.apply(this,[w]);return C?(N.then(T,C),Je.resolve()):N},o.createAnswer=function(T,C){const w=arguments.length>=2?arguments[2]:arguments[0],N=u.apply(this,[w]);return C?(N.then(T,C),Je.resolve()):N};let S=function(T,C,w){const N=h.apply(this,[T]);return w?(N.then(C,w),Je.resolve()):N};o.setLocalDescription=S,S=function(T,C,w){const N=g.apply(this,[T]);return w?(N.then(C,w),Je.resolve()):N},o.setRemoteDescription=S,S=function(T,C,w){const N=E.apply(this,[T]);return w?(N.then(C,w),Je.resolve()):N},o.addIceCandidate=S}function OO(r){const o=r&&r.navigator;if(o.mediaDevices&&o.mediaDevices.getUserMedia){const a=o.mediaDevices,u=a.getUserMedia.bind(a);o.mediaDevices.getUserMedia=h=>u(xO(h))}!o.getUserMedia&&o.mediaDevices&&o.mediaDevices.getUserMedia&&(o.getUserMedia=function(a,u,h){o.mediaDevices.getUserMedia(a).then(u,h)}.bind(o))}function xO(r){return r&&r.video!==void 0?Object.assign({},r,{video:mN(r.video)}):r}function kO(r){if(!r.RTCPeerConnection)return;const o=r.RTCPeerConnection;r.RTCPeerConnection=function(a,u){if(a&&a.iceServers){const h=[];for(let g=0;g<a.iceServers.length;g++){let E=a.iceServers[g];!E.hasOwnProperty("urls")&&E.hasOwnProperty("url")?(_y("RTCIceServer.url","RTCIceServer.urls"),E=JSON.parse(JSON.stringify(E)),E.urls=E.url,delete E.url,h.push(E)):h.push(a.iceServers[g])}a.iceServers=h}return new o(a,u)},r.RTCPeerConnection.prototype=o.prototype,"generateCertificate"in o&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:()=>o.generateCertificate})}function DO(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function PO(r){const o=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(a){if(a){a.offerToReceiveAudio!==void 0&&(a.offerToReceiveAudio=!!a.offerToReceiveAudio);const u=this.getTransceivers().find(g=>g.receiver.track.kind==="audio");a.offerToReceiveAudio===!1&&u?u.direction==="sendrecv"?u.setDirection?u.setDirection("sendonly"):u.direction="sendonly":u.direction==="recvonly"&&(u.setDirection?u.setDirection("inactive"):u.direction="inactive"):a.offerToReceiveAudio!==!0||u||this.addTransceiver("audio",{direction:"recvonly"}),a.offerToReceiveVideo!==void 0&&(a.offerToReceiveVideo=!!a.offerToReceiveVideo);const h=this.getTransceivers().find(g=>g.receiver.track.kind==="video");a.offerToReceiveVideo===!1&&h?h.direction==="sendrecv"?h.setDirection?h.setDirection("sendonly"):h.direction="sendonly":h.direction==="recvonly"&&(h.setDirection?h.setDirection("inactive"):h.direction="inactive"):a.offerToReceiveVideo!==!0||h||this.addTransceiver("video",{direction:"recvonly"})}return o.apply(this,arguments)}}function LO(r){typeof r!="object"||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}var MO=Object.freeze({__proto__:null,shimLocalStreamsAPI:bO,shimRemoteStreamsAPI:NO,shimCallbacksAPI:AO,shimGetUserMedia:OO,shimConstraints:xO,shimRTCIceServerUrls:kO,shimTrackEventTransceiver:DO,shimCreateOfferLegacy:PO,shimAudioContext:LO}),fG=`	
\v\f\r                　\u2028\u2029\uFEFF`,mG=Ct,gG=oh,$O=_("".replace),zg=`[	
\v\f\r                　\u2028\u2029\uFEFF]`,EG=RegExp("^"+zg+zg+"*"),_G=RegExp(zg+zg+"*$"),Ev=function(r){return function(o){var a=gG(mG(o));return 1&r&&(a=$O(a,EG,"")),2&r&&(a=$O(a,_G,"")),a}},yG={start:Ev(1),end:Ev(2),trim:Ev(3)},vG=zN.PROPER,SG=i,FO=fG,TG=yG.trim;Zs({target:"String",proto:!0,forced:function(r){return SG(function(){return!!FO[r]()||"​᠎"[r]()!=="​᠎"||vG&&FO[r].name!==r})}("trim")},{trim:function(){return TG(this)}});var IG=Tu("String").trim,CG=y,wG=IG,_v=String.prototype,Ac=function(r){var o=r.trim;return typeof r=="string"||r===_v||CG(_v,r)&&o===_v.trim?wG:o},yv={exports:{}};(function(r){const o={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};o.localCName=o.generateIdentifier(),o.splitLines=function(a){return Ac(a).call(a).split(`
`).map(u=>Ac(u).call(u))},o.splitSections=function(a){return a.split(`
m=`).map((u,h)=>{var g;return Ac(g=h>0?"m="+u:u).call(g)+`\r
`})},o.getDescription=function(a){const u=o.splitSections(a);return u&&u[0]},o.getMediaSections=function(a){const u=o.splitSections(a);return u.shift(),u},o.matchPrefix=function(a,u){return o.splitLines(a).filter(h=>h.indexOf(u)===0)},o.parseCandidate=function(a){let u;u=a.indexOf("a=candidate:")===0?a.substring(12).split(" "):a.substring(10).split(" ");const h={foundation:u[0],component:{1:"rtp",2:"rtcp"}[u[1]]||u[1],protocol:u[2].toLowerCase(),priority:parseInt(u[3],10),ip:u[4],address:u[4],port:parseInt(u[5],10),type:u[7]};for(let g=8;g<u.length;g+=2)switch(u[g]){case"raddr":h.relatedAddress=u[g+1];break;case"rport":h.relatedPort=parseInt(u[g+1],10);break;case"tcptype":h.tcpType=u[g+1];break;case"ufrag":h.ufrag=u[g+1],h.usernameFragment=u[g+1];break;default:h[u[g]]===void 0&&(h[u[g]]=u[g+1])}return h},o.writeCandidate=function(a){const u=[];u.push(a.foundation);const h=a.component;h==="rtp"?u.push(1):h==="rtcp"?u.push(2):u.push(h),u.push(a.protocol.toUpperCase()),u.push(a.priority),u.push(a.address||a.ip),u.push(a.port);const g=a.type;return u.push("typ"),u.push(g),g!=="host"&&a.relatedAddress&&a.relatedPort&&(u.push("raddr"),u.push(a.relatedAddress),u.push("rport"),u.push(a.relatedPort)),a.tcpType&&a.protocol.toLowerCase()==="tcp"&&(u.push("tcptype"),u.push(a.tcpType)),(a.usernameFragment||a.ufrag)&&(u.push("ufrag"),u.push(a.usernameFragment||a.ufrag)),"candidate:"+u.join(" ")},o.parseIceOptions=function(a){return a.substr(14).split(" ")},o.parseRtpMap=function(a){let u=a.substr(9).split(" ");const h={payloadType:parseInt(u.shift(),10)};return u=u[0].split("/"),h.name=u[0],h.clockRate=parseInt(u[1],10),h.channels=u.length===3?parseInt(u[2],10):1,h.numChannels=h.channels,h},o.writeRtpMap=function(a){let u=a.payloadType;a.preferredPayloadType!==void 0&&(u=a.preferredPayloadType);const h=a.channels||a.numChannels||1;return"a=rtpmap:"+u+" "+a.name+"/"+a.clockRate+(h!==1?"/"+h:"")+`\r
`},o.parseExtmap=function(a){const u=a.substr(9).split(" ");return{id:parseInt(u[0],10),direction:u[0].indexOf("/")>0?u[0].split("/")[1]:"sendrecv",uri:u[1]}},o.writeExtmap=function(a){return"a=extmap:"+(a.id||a.preferredId)+(a.direction&&a.direction!=="sendrecv"?"/"+a.direction:"")+" "+a.uri+`\r
`},o.parseFmtp=function(a){const u={};let h;const g=a.substr(a.indexOf(" ")+1).split(";");for(let T=0;T<g.length;T++){var E,S;h=Ac(E=g[T]).call(E).split("="),u[Ac(S=h[0]).call(S)]=h[1]}return u},o.writeFmtp=function(a){let u="",h=a.payloadType;if(a.preferredPayloadType!==void 0&&(h=a.preferredPayloadType),a.parameters&&Object.keys(a.parameters).length){const g=[];Object.keys(a.parameters).forEach(E=>{a.parameters[E]!==void 0?g.push(E+"="+a.parameters[E]):g.push(E)}),u+="a=fmtp:"+h+" "+g.join(";")+`\r
`}return u},o.parseRtcpFb=function(a){const u=a.substr(a.indexOf(" ")+1).split(" ");return{type:u.shift(),parameter:u.join(" ")}},o.writeRtcpFb=function(a){let u="",h=a.payloadType;return a.preferredPayloadType!==void 0&&(h=a.preferredPayloadType),a.rtcpFeedback&&a.rtcpFeedback.length&&a.rtcpFeedback.forEach(g=>{u+="a=rtcp-fb:"+h+" "+g.type+(g.parameter&&g.parameter.length?" "+g.parameter:"")+`\r
`}),u},o.parseSsrcMedia=function(a){const u=a.indexOf(" "),h={ssrc:parseInt(a.substr(7,u-7),10)},g=a.indexOf(":",u);return g>-1?(h.attribute=a.substr(u+1,g-u-1),h.value=a.substr(g+1)):h.attribute=a.substr(u+1),h},o.parseSsrcGroup=function(a){const u=a.substr(13).split(" ");return{semantics:u.shift(),ssrcs:u.map(h=>parseInt(h,10))}},o.getMid=function(a){const u=o.matchPrefix(a,"a=mid:")[0];if(u)return u.substr(6)},o.parseFingerprint=function(a){const u=a.substr(14).split(" ");return{algorithm:u[0].toLowerCase(),value:u[1].toUpperCase()}},o.getDtlsParameters=function(a,u){return{role:"auto",fingerprints:o.matchPrefix(a+u,"a=fingerprint:").map(o.parseFingerprint)}},o.writeDtlsParameters=function(a,u){let h="a=setup:"+u+`\r
`;return a.fingerprints.forEach(g=>{h+="a=fingerprint:"+g.algorithm+" "+g.value+`\r
`}),h},o.parseCryptoLine=function(a){const u=a.substr(9).split(" ");return{tag:parseInt(u[0],10),cryptoSuite:u[1],keyParams:u[2],sessionParams:u.slice(3)}},o.writeCryptoLine=function(a){return"a=crypto:"+a.tag+" "+a.cryptoSuite+" "+(typeof a.keyParams=="object"?o.writeCryptoKeyParams(a.keyParams):a.keyParams)+(a.sessionParams?" "+a.sessionParams.join(" "):"")+`\r
`},o.parseCryptoKeyParams=function(a){if(a.indexOf("inline:")!==0)return null;const u=a.substr(7).split("|");return{keyMethod:"inline",keySalt:u[0],lifeTime:u[1],mkiValue:u[2]?u[2].split(":")[0]:void 0,mkiLength:u[2]?u[2].split(":")[1]:void 0}},o.writeCryptoKeyParams=function(a){return a.keyMethod+":"+a.keySalt+(a.lifeTime?"|"+a.lifeTime:"")+(a.mkiValue&&a.mkiLength?"|"+a.mkiValue+":"+a.mkiLength:"")},o.getCryptoParameters=function(a,u){return o.matchPrefix(a+u,"a=crypto:").map(o.parseCryptoLine)},o.getIceParameters=function(a,u){const h=o.matchPrefix(a+u,"a=ice-ufrag:")[0],g=o.matchPrefix(a+u,"a=ice-pwd:")[0];return h&&g?{usernameFragment:h.substr(12),password:g.substr(10)}:null},o.writeIceParameters=function(a){let u="a=ice-ufrag:"+a.usernameFragment+`\r
a=ice-pwd:`+a.password+`\r
`;return a.iceLite&&(u+=`a=ice-lite\r
`),u},o.parseRtpParameters=function(a){const u={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},h=o.splitLines(a)[0].split(" ");for(let g=3;g<h.length;g++){const E=h[g],S=o.matchPrefix(a,"a=rtpmap:"+E+" ")[0];if(S){const T=o.parseRtpMap(S),C=o.matchPrefix(a,"a=fmtp:"+E+" ");switch(T.parameters=C.length?o.parseFmtp(C[0]):{},T.rtcpFeedback=o.matchPrefix(a,"a=rtcp-fb:"+E+" ").map(o.parseRtcpFb),u.codecs.push(T),T.name.toUpperCase()){case"RED":case"ULPFEC":u.fecMechanisms.push(T.name.toUpperCase())}}}return o.matchPrefix(a,"a=extmap:").forEach(g=>{u.headerExtensions.push(o.parseExtmap(g))}),u},o.writeRtpDescription=function(a,u){let h="";h+="m="+a+" ",h+=u.codecs.length>0?"9":"0",h+=" UDP/TLS/RTP/SAVPF ",h+=u.codecs.map(E=>E.preferredPayloadType!==void 0?E.preferredPayloadType:E.payloadType).join(" ")+`\r
`,h+=`c=IN IP4 0.0.0.0\r
`,h+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,u.codecs.forEach(E=>{h+=o.writeRtpMap(E),h+=o.writeFmtp(E),h+=o.writeRtcpFb(E)});let g=0;return u.codecs.forEach(E=>{E.maxptime>g&&(g=E.maxptime)}),g>0&&(h+="a=maxptime:"+g+`\r
`),u.headerExtensions&&u.headerExtensions.forEach(E=>{h+=o.writeExtmap(E)}),h},o.parseRtpEncodingParameters=function(a){const u=[],h=o.parseRtpParameters(a),g=h.fecMechanisms.indexOf("RED")!==-1,E=h.fecMechanisms.indexOf("ULPFEC")!==-1,S=o.matchPrefix(a,"a=ssrc:").map(M=>o.parseSsrcMedia(M)).filter(M=>M.attribute==="cname"),T=S.length>0&&S[0].ssrc;let C;const w=o.matchPrefix(a,"a=ssrc-group:FID").map(M=>M.substr(17).split(" ").map(U=>parseInt(U,10)));w.length>0&&w[0].length>1&&w[0][0]===T&&(C=w[0][1]),h.codecs.forEach(M=>{if(M.name.toUpperCase()==="RTX"&&M.parameters.apt){let U={ssrc:T,codecPayloadType:parseInt(M.parameters.apt,10)};T&&C&&(U.rtx={ssrc:C}),u.push(U),g&&(U=JSON.parse(JSON.stringify(U)),U.fec={ssrc:T,mechanism:E?"red+ulpfec":"red"},u.push(U))}}),u.length===0&&T&&u.push({ssrc:T});let N=o.matchPrefix(a,"b=");return N.length&&(N=N[0].indexOf("b=TIAS:")===0?parseInt(N[0].substr(7),10):N[0].indexOf("b=AS:")===0?1e3*parseInt(N[0].substr(5),10)*.95-16e3:void 0,u.forEach(M=>{M.maxBitrate=N})),u},o.parseRtcpParameters=function(a){const u={},h=o.matchPrefix(a,"a=ssrc:").map(S=>o.parseSsrcMedia(S)).filter(S=>S.attribute==="cname")[0];h&&(u.cname=h.value,u.ssrc=h.ssrc);const g=o.matchPrefix(a,"a=rtcp-rsize");u.reducedSize=g.length>0,u.compound=g.length===0;const E=o.matchPrefix(a,"a=rtcp-mux");return u.mux=E.length>0,u},o.writeRtcpParameters=function(a){let u="";return a.reducedSize&&(u+=`a=rtcp-rsize\r
`),a.mux&&(u+=`a=rtcp-mux\r
`),a.ssrc!==void 0&&a.cname&&(u+="a=ssrc:"+a.ssrc+" cname:"+a.cname+`\r
`),u},o.parseMsid=function(a){let u;const h=o.matchPrefix(a,"a=msid:");if(h.length===1)return u=h[0].substr(7).split(" "),{stream:u[0],track:u[1]};const g=o.matchPrefix(a,"a=ssrc:").map(E=>o.parseSsrcMedia(E)).filter(E=>E.attribute==="msid");return g.length>0?(u=g[0].value.split(" "),{stream:u[0],track:u[1]}):void 0},o.parseSctpDescription=function(a){const u=o.parseMLine(a),h=o.matchPrefix(a,"a=max-message-size:");let g;h.length>0&&(g=parseInt(h[0].substr(19),10)),isNaN(g)&&(g=65536);const E=o.matchPrefix(a,"a=sctp-port:");if(E.length>0)return{port:parseInt(E[0].substr(12),10),protocol:u.fmt,maxMessageSize:g};const S=o.matchPrefix(a,"a=sctpmap:");if(S.length>0){const T=S[0].substr(10).split(" ");return{port:parseInt(T[0],10),protocol:T[1],maxMessageSize:g}}},o.writeSctpDescription=function(a,u){let h=[];return h=a.protocol!=="DTLS/SCTP"?["m="+a.kind+" 9 "+a.protocol+" "+u.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+u.port+`\r
`]:["m="+a.kind+" 9 "+a.protocol+" "+u.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+u.port+" "+u.protocol+` 65535\r
`],u.maxMessageSize!==void 0&&h.push("a=max-message-size:"+u.maxMessageSize+`\r
`),h.join("")},o.generateSessionId=function(){return Math.random().toString().substr(2,21)},o.writeSessionBoilerplate=function(a,u,h){let g;const E=u!==void 0?u:2;return g=a||o.generateSessionId(),`v=0\r
o=`+(h||"thisisadapterortc")+" "+g+" "+E+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},o.getDirection=function(a,u){const h=o.splitLines(a);for(let g=0;g<h.length;g++)switch(h[g]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return h[g].substr(2)}return u?o.getDirection(u):"sendrecv"},o.getKind=function(a){return o.splitLines(a)[0].split(" ")[0].substr(2)},o.isRejected=function(a){return a.split(" ",2)[1]==="0"},o.parseMLine=function(a){const u=o.splitLines(a)[0].substr(2).split(" ");return{kind:u[0],port:parseInt(u[1],10),protocol:u[2],fmt:u.slice(3).join(" ")}},o.parseOLine=function(a){const u=o.matchPrefix(a,"o=")[0].substr(2).split(" ");return{username:u[0],sessionId:u[1],sessionVersion:parseInt(u[2],10),netType:u[3],addressType:u[4],address:u[5]}},o.isValidSDP=function(a){if(typeof a!="string"||a.length===0)return!1;const u=o.splitLines(a);for(let h=0;h<u.length;h++)if(u[h].length<2||u[h].charAt(1)!=="=")return!1;return!0},r.exports=o})(yv);var ph=yv.exports,RG=Object.freeze(n({__proto__:null,default:ph},[yv.exports]));function Hg(r){if(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)return;const o=r.RTCIceCandidate;r.RTCIceCandidate=function(a){if(typeof a=="object"&&a.candidate&&a.candidate.indexOf("a=")===0&&((a=JSON.parse(JSON.stringify(a))).candidate=a.candidate.substr(2)),a.candidate&&a.candidate.length){const u=new o(a),h=ph.parseCandidate(a.candidate),g=Object.assign(u,h);return g.toJSON=function(){return{candidate:g.candidate,sdpMid:g.sdpMid,sdpMLineIndex:g.sdpMLineIndex,usernameFragment:g.usernameFragment}},g}return new o(a)},r.RTCIceCandidate.prototype=o.prototype,Ul(r,"icecandidate",a=>(a.candidate&&Object.defineProperty(a,"candidate",{value:new r.RTCIceCandidate(a.candidate),writable:"false"}),a))}function vv(r){!r.RTCIceCandidate||r.RTCIceCandidate&&"relayProtocol"in r.RTCIceCandidate.prototype||Ul(r,"icecandidate",o=>{if(o.candidate){const a=ph.parseCandidate(o.candidate.candidate);a.type==="relay"&&(o.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[a.priority>>24])}return o})}function Kg(r,o){if(!r.RTCPeerConnection)return;"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const a=function(S){if(!S||!S.sdp)return!1;const T=ph.splitSections(S.sdp);return T.shift(),T.some(C=>{const w=ph.parseMLine(C);return w&&w.kind==="application"&&w.protocol.indexOf("SCTP")!==-1})},u=function(S){const T=S.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(T===null||T.length<2)return-1;const C=parseInt(T[1],10);return C!=C?-1:C},h=function(S){let T=65536;return o.browser==="firefox"&&(T=o.version<57?S===-1?16384:2147483637:o.version<60?o.version===57?65535:65536:2147483637),T},g=function(S,T){let C=65536;o.browser==="firefox"&&o.version===57&&(C=65535);const w=ph.matchPrefix(S.sdp,"a=max-message-size:");return w.length>0?C=parseInt(w[0].substr(19),10):o.browser==="firefox"&&T!==-1&&(C=2147483637),C},E=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,o.browser==="chrome"&&o.version>=76){const{sdpSemantics:S}=this.getConfiguration();S==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(a(arguments[0])){const S=u(arguments[0]),T=h(S),C=g(arguments[0],S);let w;w=T===0&&C===0?Number.POSITIVE_INFINITY:T===0||C===0?Math.max(T,C):Math.min(T,C);const N={};Object.defineProperty(N,"maxMessageSize",{get:()=>w}),this._sctp=N}return E.apply(this,arguments)}}function qg(r){if(!r.RTCPeerConnection||!("createDataChannel"in r.RTCPeerConnection.prototype))return;function o(u,h){const g=u.send;u.send=function(){const E=arguments[0],S=E.length||E.size||E.byteLength;if(u.readyState==="open"&&h.sctp&&S>h.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+h.sctp.maxMessageSize+" bytes)");return g.apply(u,arguments)}}const a=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){const u=a.apply(this,arguments);return o(u,this),u},Ul(r,"datachannel",u=>(o(u.channel,u.target),u))}function Sv(r){if(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)return;const o=r.RTCPeerConnection.prototype;Object.defineProperty(o,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(o,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(a){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),a&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=a)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(a=>{const u=o[a];o[a]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=h=>{const g=h.target;if(g._lastConnectionState!==g.connectionState){g._lastConnectionState=g.connectionState;const E=new Event("connectionstatechange",h);g.dispatchEvent(E)}return h},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),u.apply(this,arguments)}})}function Tv(r,o){if(!r.RTCPeerConnection||o.browser==="chrome"&&o.version>=71||o.browser==="safari"&&o.version>=605)return;const a=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(u){if(u&&u.sdp&&u.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const h=u.sdp.split(`
`).filter(g=>Ac(g).call(g)!=="a=extmap-allow-mixed").join(`
`);r.RTCSessionDescription&&u instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:u.type,sdp:h}):u.sdp=h}return a.apply(this,arguments)}}function Xg(r,o){if(!r.RTCPeerConnection||!r.RTCPeerConnection.prototype)return;const a=r.RTCPeerConnection.prototype.addIceCandidate;a&&a.length!==0&&(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(o.browser==="chrome"&&o.version<78||o.browser==="firefox"&&o.version<68||o.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Je.resolve():a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Je.resolve())})}function Yg(r,o){if(!r.RTCPeerConnection||!r.RTCPeerConnection.prototype)return;const a=r.RTCPeerConnection.prototype.setLocalDescription;a&&a.length!==0&&(r.RTCPeerConnection.prototype.setLocalDescription=function(){let u=arguments[0]||{};if(typeof u!="object"||u.type&&u.sdp)return a.apply(this,arguments);if(u={type:u.type,sdp:u.sdp},!u.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":u.type="offer";break;default:u.type="answer"}return u.sdp||u.type!=="offer"&&u.type!=="answer"?a.apply(this,[u]):(u.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(g=>a.apply(this,[g]))})}var bG=Object.freeze({__proto__:null,shimRTCIceCandidate:Hg,shimRTCIceCandidateRelayProtocol:vv,shimMaxMessageSize:Kg,shimSendThrowTypeError:qg,shimConnectionState:Sv,removeExtmapAllowMixed:Tv,shimAddIceCandidateNullOrEmpty:Xg,shimParameterlessSetLocalDescription:Yg});let Rs,En;(function(){let{window:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const a=pN,u=jB(r),h={browserDetails:u,commonShim:bG,extractVersion:yg,disableLog:VB,disableWarnings:BB,sdp:RG};switch(u.browser){case"chrome":if(!mO||!mv||!o.shimChrome)return a("Chrome shim is not included in this adapter release."),h;if(u.version===null)return a("Chrome shim can not determine version, not shimming."),h;a("adapter.js shimming chrome."),h.browserShim=mO,Xg(r,u),Yg(r),iO(r,u),aO(r),mv(r,u),cO(r),pO(r,u),uO(r),lO(r),dO(r),fO(r,u),Hg(r),vv(r),Sv(r),Kg(r,u),qg(r),Tv(r,u);break;case"firefox":if(!RO||!gv||!o.shimFirefox)return a("Firefox shim is not included in this adapter release."),h;a("adapter.js shimming firefox."),h.browserShim=RO,Xg(r,u),Yg(r),gO(r,u),gv(r,u),EO(r),vO(r),_O(r),yO(r),SO(r),TO(r),IO(r),CO(r),wO(r),Hg(r),Sv(r),Kg(r,u),qg(r);break;case"safari":if(!MO||!o.shimSafari)return a("Safari shim is not included in this adapter release."),h;a("adapter.js shimming safari."),h.browserShim=MO,Xg(r,u),Yg(r),kO(r),PO(r),AO(r),bO(r),NO(r),DO(r),OO(r),LO(r),Hg(r),vv(r),Kg(r,u),qg(r),Tv(r,u);break;default:a("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),function(r){r.WIN_10="Windows 10",r.WIN_81="Windows 8.1",r.WIN_8="Windows 8",r.WIN_7="Windows 7",r.WIN_VISTA="Windows Vista",r.WIN_SERVER_2003="Windows Server 2003",r.WIN_XP="Windows XP",r.WIN_2000="Windows 2000",r.ANDROID="Android",r.OPEN_BSD="Open BSD",r.SUN_OS="Sun OS",r.LINUX="Linux",r.IOS="iOS",r.MAC_OS="Mac OS",r.QNX="QNX",r.UNIX="UNIX",r.BEOS="BeOS",r.OS_2="OS/2",r.SEARCH_BOT="Search Bot"}(Rs||(Rs={})),function(r){r.CHROME="Chrome",r.SAFARI="Safari",r.EDGE="Edge",r.FIREFOX="Firefox",r.OPERA="OPR",r.QQ="QQBrowser",r.WECHAT="MicroMessenger"}(En||(En={}));var Iv={exports:{}};(function(r,o){(function(a,u){var h="function",g="undefined",E="object",S="string",T="major",C="model",w="name",N="type",M="vendor",U="version",Y="architecture",X="console",J="mobile",fe="tablet",ge="smarttv",Ue="wearable",lt="embedded",Ve="Amazon",Ge="Apple",Le="ASUS",Ze="BlackBerry",yn="Firefox",At="Google",Dn="Huawei",Tn="LG",ir="Microsoft",us="Motorola",tr="Opera",wo="Samsung",ve="Sharp",xe="Sony",Ke="Xiaomi",vt="Zebra",Yt="Facebook",$e="Chromium OS",D="Mac OS",q=function(qn){for(var pr={},In=0;In<qn.length;In++)pr[qn[In].toUpperCase()]=qn[In];return pr},te=function(qn,pr){return typeof qn===S&&Ie(pr).indexOf(Ie(qn))!==-1},Ie=function(qn){return qn.toLowerCase()},It=function(qn,pr){if(typeof qn===S)return qn=qn.replace(/^\s\s*/,""),typeof pr===g?qn:qn.substring(0,350)},wn=function(qn,pr){for(var In,io,lc,Xn,qt,Ro,Bu=0;Bu<pr.length&&!qt;){var La=pr[Bu],Z4=pr[Bu+1];for(In=io=0;In<La.length&&!qt&&La[In];)if(qt=La[In++].exec(qn))for(lc=0;lc<Z4.length;lc++)Ro=qt[++io],typeof(Xn=Z4[lc])===E&&Xn.length>0?Xn.length===2?typeof Xn[1]==h?this[Xn[0]]=Xn[1].call(this,Ro):this[Xn[0]]=Xn[1]:Xn.length===3?typeof Xn[1]!==h||Xn[1].exec&&Xn[1].test?this[Xn[0]]=Ro?Ro.replace(Xn[1],Xn[2]):u:this[Xn[0]]=Ro?Xn[1].call(this,Ro,Xn[2]):u:Xn.length===4&&(this[Xn[0]]=Ro?Xn[3].call(this,Ro.replace(Xn[1],Xn[2])):u):this[Xn]=Ro||u;Bu+=2}},ls=function(qn,pr){for(var In in pr)if(typeof pr[In]===E&&pr[In].length>0){for(var io=0;io<pr[In].length;io++)if(te(pr[In][io],qn))return In==="?"?u:In}else if(te(pr[In],qn))return In==="?"?u:In;return qn},oa={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Uu={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[U,[w,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[U,[w,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[w,U],[/opios[\/ ]+([\w\.]+)/i],[U,[w,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[U,[w,tr]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[w,U],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[U,[w,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[U,[w,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[U,[w,"WeChat"]],[/konqueror\/([\w\.]+)/i],[U,[w,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[U,[w,"IE"]],[/yabrowser\/([\w\.]+)/i],[U,[w,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[w,/(.+)/,"$1 Secure Browser"],U],[/\bfocus\/([\w\.]+)/i],[U,[w,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[U,[w,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[U,[w,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[U,[w,"Dolphin"]],[/coast\/([\w\.]+)/i],[U,[w,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[U,[w,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[U,[w,yn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[w,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[w,/(.+)/,"$1 Browser"],U],[/(comodo_dragon)\/([\w\.]+)/i],[[w,/_/g," "],U],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[w,U],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[w],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[w,Yt],U],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[w,U],[/\bgsa\/([\w\.]+) .*safari\//i],[U,[w,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[U,[w,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[w,"Chrome WebView"],U],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[U,[w,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[w,U],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[U,[w,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[U,w],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[w,[U,ls,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[w,U],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[w,"Netscape"],U],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[U,[w,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[w,U],[/(cobalt)\/([\w\.]+)/i],[w,[U,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[Y,"amd64"]],[/(ia32(?=;))/i],[[Y,Ie]],[/((?:i[346]|x)86)[;\)]/i],[[Y,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[Y,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[Y,"armhf"]],[/windows (ce|mobile); ppc;/i],[[Y,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[Y,/ower/,"",Ie]],[/(sun4\w)[;\)]/i],[[Y,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[Y,Ie]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[C,[M,wo],[N,fe]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[C,[M,wo],[N,J]],[/\((ip(?:hone|od)[\w ]*);/i],[C,[M,Ge],[N,J]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[C,[M,Ge],[N,fe]],[/(macintosh);/i],[C,[M,Ge]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[C,[M,ve],[N,J]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[C,[M,Dn],[N,fe]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[C,[M,Dn],[N,J]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[C,/_/g," "],[M,Ke],[N,J]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[C,/_/g," "],[M,Ke],[N,fe]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[C,[M,"OPPO"],[N,J]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[C,[M,"Vivo"],[N,J]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[C,[M,"Realme"],[N,J]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[C,[M,us],[N,J]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[C,[M,us],[N,fe]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[C,[M,Tn],[N,fe]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[C,[M,Tn],[N,J]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[C,[M,"Lenovo"],[N,fe]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[C,/_/g," "],[M,"Nokia"],[N,J]],[/(pixel c)\b/i],[C,[M,At],[N,fe]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[C,[M,At],[N,J]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[C,[M,xe],[N,J]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[C,"Xperia Tablet"],[M,xe],[N,fe]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[C,[M,"OnePlus"],[N,J]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[C,[M,Ve],[N,fe]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[C,/(.+)/g,"Fire Phone $1"],[M,Ve],[N,J]],[/(playbook);[-\w\),; ]+(rim)/i],[C,M,[N,fe]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[C,[M,Ze],[N,J]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[C,[M,Le],[N,fe]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[C,[M,Le],[N,J]],[/(nexus 9)/i],[C,[M,"HTC"],[N,fe]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[M,[C,/_/g," "],[N,J]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[C,[M,"Acer"],[N,fe]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[C,[M,"Meizu"],[N,J]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[M,C,[N,J]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[M,C,[N,fe]],[/(surface duo)/i],[C,[M,ir],[N,fe]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[C,[M,"Fairphone"],[N,J]],[/(u304aa)/i],[C,[M,"AT&T"],[N,J]],[/\bsie-(\w*)/i],[C,[M,"Siemens"],[N,J]],[/\b(rct\w+) b/i],[C,[M,"RCA"],[N,fe]],[/\b(venue[\d ]{2,7}) b/i],[C,[M,"Dell"],[N,fe]],[/\b(q(?:mv|ta)\w+) b/i],[C,[M,"Verizon"],[N,fe]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[C,[M,"Barnes & Noble"],[N,fe]],[/\b(tm\d{3}\w+) b/i],[C,[M,"NuVision"],[N,fe]],[/\b(k88) b/i],[C,[M,"ZTE"],[N,fe]],[/\b(nx\d{3}j) b/i],[C,[M,"ZTE"],[N,J]],[/\b(gen\d{3}) b.+49h/i],[C,[M,"Swiss"],[N,J]],[/\b(zur\d{3}) b/i],[C,[M,"Swiss"],[N,fe]],[/\b((zeki)?tb.*\b) b/i],[C,[M,"Zeki"],[N,fe]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[M,"Dragon Touch"],C,[N,fe]],[/\b(ns-?\w{0,9}) b/i],[C,[M,"Insignia"],[N,fe]],[/\b((nxa|next)-?\w{0,9}) b/i],[C,[M,"NextBook"],[N,fe]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[M,"Voice"],C,[N,J]],[/\b(lvtel\-)?(v1[12]) b/i],[[M,"LvTel"],C,[N,J]],[/\b(ph-1) /i],[C,[M,"Essential"],[N,J]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[C,[M,"Envizen"],[N,fe]],[/\b(trio[-\w\. ]+) b/i],[C,[M,"MachSpeed"],[N,fe]],[/\btu_(1491) b/i],[C,[M,"Rotor"],[N,fe]],[/(shield[\w ]+) b/i],[C,[M,"Nvidia"],[N,fe]],[/(sprint) (\w+)/i],[M,C,[N,J]],[/(kin\.[onetw]{3})/i],[[C,/\./g," "],[M,ir],[N,J]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[C,[M,vt],[N,fe]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[C,[M,vt],[N,J]],[/smart-tv.+(samsung)/i],[M,[N,ge]],[/hbbtv.+maple;(\d+)/i],[[C,/^/,"SmartTV"],[M,wo],[N,ge]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[M,Tn],[N,ge]],[/(apple) ?tv/i],[M,[C,"Apple TV"],[N,ge]],[/crkey/i],[[C,"Chromecast"],[M,At],[N,ge]],[/droid.+aft(\w)( bui|\))/i],[C,[M,Ve],[N,ge]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[C,[M,ve],[N,ge]],[/(bravia[\w ]+)( bui|\))/i],[C,[M,xe],[N,ge]],[/(mitv-\w{5}) bui/i],[C,[M,Ke],[N,ge]],[/Hbbtv.*(technisat) (.*);/i],[M,C,[N,ge]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[M,It],[C,It],[N,ge]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[N,ge]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[M,C,[N,X]],[/droid.+; (shield) bui/i],[C,[M,"Nvidia"],[N,X]],[/(playstation [345portablevi]+)/i],[C,[M,xe],[N,X]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[C,[M,ir],[N,X]],[/((pebble))app/i],[M,C,[N,Ue]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[C,[M,Ge],[N,Ue]],[/droid.+; (glass) \d/i],[C,[M,At],[N,Ue]],[/droid.+; (wt63?0{2,3})\)/i],[C,[M,vt],[N,Ue]],[/(quest( 2| pro)?)/i],[C,[M,Yt],[N,Ue]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[M,[N,lt]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[C,[N,J]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[C,[N,fe]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[N,fe]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[N,J]],[/(android[-\w\. ]{0,9});.+buil/i],[C,[M,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[U,[w,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[U,[w,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[w,U],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[U,w]],os:[[/microsoft (windows) (vista|xp)/i],[w,U],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[w,[U,ls,oa]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[w,"Windows"],[U,ls,oa]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[U,/_/g,"."],[w,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[w,D],[U,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[U,w],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[w,U],[/\(bb(10);/i],[U,[w,Ze]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[U,[w,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[U,[w,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[U,[w,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[U,[w,"watchOS"]],[/crkey\/([\d\.]+)/i],[U,[w,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[w,$e],U],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[w,U],[/(sunos) ?([\w\.\d]*)/i],[[w,"Solaris"],U],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[w,U]]},Li=function(qn,pr){if(typeof qn===E&&(pr=qn,qn=u),!(this instanceof Li))return new Li(qn,pr).getResult();var In=typeof a!==g&&a.navigator?a.navigator:u,io=qn||(In&&In.userAgent?In.userAgent:""),lc=In&&In.userAgentData?In.userAgentData:u,Xn=pr?function(qt,Ro){var Bu={};for(var La in qt)Ro[La]&&Ro[La].length%2==0?Bu[La]=Ro[La].concat(qt[La]):Bu[La]=qt[La];return Bu}(Uu,pr):Uu;return this.getBrowser=function(){var qt={};return qt.name=u,qt.version=u,wn.call(qt,io,Xn.browser),qt.major=function(Ro){return typeof Ro===S?Ro.replace(/[^\d\.]/g,"").split(".")[0]:u}(qt.version),In&&In.brave&&typeof In.brave.isBrave==h&&(qt.name="Brave"),qt},this.getCPU=function(){var qt={};return qt.architecture=u,wn.call(qt,io,Xn.cpu),qt},this.getDevice=function(){var qt={};return qt.vendor=u,qt.model=u,qt.type=u,wn.call(qt,io,Xn.device),!qt.type&&lc&&lc.mobile&&(qt.type=J),qt.model=="Macintosh"&&In&&typeof In.standalone!==g&&In.maxTouchPoints&&In.maxTouchPoints>2&&(qt.model="iPad",qt.type=fe),qt},this.getEngine=function(){var qt={};return qt.name=u,qt.version=u,wn.call(qt,io,Xn.engine),qt},this.getOS=function(){var qt={};return qt.name=u,qt.version=u,wn.call(qt,io,Xn.os),!qt.name&&lc&&lc.platform!="Unknown"&&(qt.name=lc.platform.replace(/chrome os/i,$e).replace(/macos/i,D)),qt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return io},this.setUA=function(qt){return io=typeof qt===S&&qt.length>350?It(qt,350):qt,this},this.setUA(io),this};Li.VERSION="0.7.34",Li.BROWSER=q([w,U,T]),Li.CPU=q([Y]),Li.DEVICE=q([C,M,N,X,J,ge,fe,Ue,lt]),Li.ENGINE=Li.OS=q([w,U]),r.exports&&(o=r.exports=Li),o.UAParser=Li;var Vu=typeof a!==g&&(a.jQuery||a.Zepto);if(Vu&&!Vu.ua){var Vh=new Li;Vu.ua=Vh.getResult(),Vu.ua.get=function(){return Vh.getUA()},Vu.ua.set=function(qn){Vh.setUA(qn);var pr=Vh.getResult();for(var In in pr)Vu.ua[In]=pr[In]}}})(typeof window=="object"?window:s)})(Iv,Iv.exports);const Cv=new Iv.exports;let Yi,Oc=Cv.getResult();function Sn(r){return r&&Cv.setUA(r),Oc=Cv.getResult(),{name:NG(Oc),version:AG(Oc),os:OG(Oc),osVersion:Oc.os.version}}function NG(r){if(r.engine.name==="Blink"&&r.browser.name!=="WeChat")return En.CHROME;switch(r.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return En.CHROME;case"Safari":case"Mobile Safari":return En.SAFARI;case"Edge":return En.EDGE;case"Firefox":return En.FIREFOX;case"QQBrowser":return En.QQ;case"Opera":return En.OPERA;case"WeChat":return En.WECHAT;default:return r.browser.name||""}}function AG(r){let o;return o=r.engine.name==="Blink"?r.engine.version||"":r.browser.version||"",o.split(".")[0]}function OG(r){switch(r.os.name){case"Windows":return r.os.version?r.os.name+" "+r.os.version:r.os.name;default:return r.os.name||""}}function Jg(){const r=Sn();return!!(Oc.engine.name==="WebKit"&&r.os===Rs.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&r.name!==En.SAFARI||eo()&&r.name!==En.SAFARI)}function xG(){const r=Sn();if(Jg()){if(r.os===Rs.MAC_OS)return!0;if(r.os===Rs.IOS){const o=Oc.os.version&&Oc.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1}function kG(){return Oc.engine.name==="WebKit"}function wv(){return Sn().name===En.CHROME}function Vo(){return Sn().name===En.SAFARI}function Jn(){return Sn().name===En.FIREFOX}function eo(){return Sn().os===Rs.IOS}function UO(){const r=Sn();return!(r.name!==En.CHROME||!r.osVersion)&&Number(r.version)<=90}function VO(){const r=Sn();if(r.os!==Rs.IOS||!r.osVersion)return!1;const o=r.osVersion.split(".");return Number(o[0])<14||Number(o[0])===14&&Number(o[1])<=6}function fh(){const r=Sn();if(r.os!==Rs.IOS||!r.osVersion)return!1;const o=r.osVersion.split(".");return Number(o[0])===15}function BO(){const r=Sn();if(r.os!==Rs.IOS||!r.osVersion)return!1;const o=r.osVersion.split(".");return Number(o[0])===15&&Number(o[1])===0}function jO(){const r=Sn();if(r.os!==Rs.IOS||!r.osVersion)return!1;const o=r.osVersion.split(".");return Number(o[0])===15&&Number(o[1])>=1}function Rv(){const r=Sn();if(r.os!==Rs.IOS||!r.osVersion)return!1;const o=r.osVersion.split(".");return Number(o[0])===15&&Number(o[1])>=2}function xc(){return Vo()&&navigator.maxTouchPoints>0}function WO(){return Sn().name===En.WECHAT}function GO(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Gl(){const r=Sn();return r.name===En.EDGE||r.name===En.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function bv(){return Sn().os===Rs.ANDROID}function hf(){const r=Sn();return r.os==="Android"&&(r.name==="Chrome"||r.name===En.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}(function(r){r.CERTIFICATE="certificate",r.CODEC="codec",r.CANDIDATE_PAIR="candidate-pair",r.LOCAL_CANDIDATE="local-candidate",r.REMOTE_CANDIDATE="remote-candidate",r.INBOUND="inbound-rtp",r.TRACK="track",r.OUTBOUND="outbound-rtp",r.PC="peer-connection",r.REMOTE_INBOUND="remote-inbound-rtp",r.REMOTE_OUTBOUND="remote-outbound-rtp",r.TRANSPORT="transport",r.CSRC="csrc",r.DATA_CHANNEL="data-channel",r.STREAM="stream",r.SENDER="sender",r.RECEIVER="receiver"})(Yi||(Yi={}));var zO={exports:{}},DG=Zs,PG=H,HO=B.f;DG({target:"Object",stat:!0,forced:Object.defineProperty!==HO,sham:!PG},{defineProperty:HO});var KO=sn.Object,LG=zO.exports=function(r,o,a){return KO.defineProperty(r,o,a)};KO.defineProperty.sham&&(LG.sham=!0);var qO=zO.exports;function k(r,o,a){return o in r?qO(r,o,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[o]=a,r}var Nv,Av={exports:{}},XO=function(r,o){return function(){for(var a=new Array(arguments.length),u=0;u<a.length;u++)a[u]=arguments[u];return r.apply(o,a)}},MG=XO,Ov=Object.prototype.toString,xv=(Nv=Object.create(null),function(r){var o=Ov.call(r);return Nv[o]||(Nv[o]=o.slice(8,-1).toLowerCase())});function zl(r){return r=r.toLowerCase(),function(o){return xv(o)===r}}function kv(r){return Array.isArray(r)}function Qg(r){return r===void 0}var YO=zl("ArrayBuffer");function JO(r){return r!==null&&typeof r=="object"}function Zg(r){if(xv(r)!=="object")return!1;var o=Object.getPrototypeOf(r);return o===null||o===Object.prototype}var $G=zl("Date"),FG=zl("File"),UG=zl("Blob"),VG=zl("FileList");function Dv(r){return Ov.call(r)==="[object Function]"}var BG=zl("URLSearchParams");function Pv(r,o){if(r!=null)if(typeof r!="object"&&(r=[r]),kv(r))for(var a=0,u=r.length;a<u;a++)o.call(null,r[a],a,r);else for(var h in r)Object.prototype.hasOwnProperty.call(r,h)&&o.call(null,r[h],h,r)}var Lv,jG=(Lv=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(r){return Lv&&r instanceof Lv}),to={isArray:kv,isArrayBuffer:YO,isBuffer:function(r){return r!==null&&!Qg(r)&&r.constructor!==null&&!Qg(r.constructor)&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)},isFormData:function(r){var o="[object FormData]";return r&&(typeof FormData=="function"&&r instanceof FormData||Ov.call(r)===o||Dv(r.toString)&&r.toString()===o)},isArrayBufferView:function(r){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer&&YO(r.buffer)},isString:function(r){return typeof r=="string"},isNumber:function(r){return typeof r=="number"},isObject:JO,isPlainObject:Zg,isUndefined:Qg,isDate:$G,isFile:FG,isBlob:UG,isFunction:Dv,isStream:function(r){return JO(r)&&Dv(r.pipe)},isURLSearchParams:BG,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:Pv,merge:function r(){var o={};function a(g,E){Zg(o[E])&&Zg(g)?o[E]=r(o[E],g):Zg(g)?o[E]=r({},g):kv(g)?o[E]=g.slice():o[E]=g}for(var u=0,h=arguments.length;u<h;u++)Pv(arguments[u],a);return o},extend:function(r,o,a){return Pv(o,function(u,h){r[h]=a&&typeof u=="function"?MG(u,a):u}),r},trim:function(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")},stripBOM:function(r){return r.charCodeAt(0)===65279&&(r=r.slice(1)),r},inherits:function(r,o,a,u){r.prototype=Object.create(o.prototype,u),r.prototype.constructor=r,a&&Object.assign(r.prototype,a)},toFlatObject:function(r,o,a){var u,h,g,E={};o=o||{};do{for(h=(u=Object.getOwnPropertyNames(r)).length;h-- >0;)E[g=u[h]]||(o[g]=r[g],E[g]=!0);r=Object.getPrototypeOf(r)}while(r&&(!a||a(r,o))&&r!==Object.prototype);return o},kindOf:xv,kindOfTest:zl,endsWith:function(r,o,a){r=String(r),(a===void 0||a>r.length)&&(a=r.length),a-=o.length;var u=r.indexOf(o,a);return u!==-1&&u===a},toArray:function(r){if(!r)return null;var o=r.length;if(Qg(o))return null;for(var a=new Array(o);o-- >0;)a[o]=r[o];return a},isTypedArray:jG,isFileList:VG},mh=to;function QO(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var ZO=function(r,o,a){if(!o)return r;var u;if(a)u=a(o);else if(mh.isURLSearchParams(o))u=o.toString();else{var h=[];mh.forEach(o,function(E,S){E!=null&&(mh.isArray(E)?S+="[]":E=[E],mh.forEach(E,function(T){mh.isDate(T)?T=T.toISOString():mh.isObject(T)&&(T=JSON.stringify(T)),h.push(QO(S)+"="+QO(T))}))}),u=h.join("&")}if(u){var g=r.indexOf("#");g!==-1&&(r=r.slice(0,g)),r+=(r.indexOf("?")===-1?"?":"&")+u}return r},WG=to;function eE(){this.handlers=[]}eE.prototype.use=function(r,o,a){return this.handlers.push({fulfilled:r,rejected:o,synchronous:!!a&&a.synchronous,runWhen:a?a.runWhen:null}),this.handlers.length-1},eE.prototype.eject=function(r){this.handlers[r]&&(this.handlers[r]=null)},eE.prototype.forEach=function(r){WG.forEach(this.handlers,function(o){o!==null&&r(o)})};var GG=eE,zG=to,ex=to;function gh(r,o,a,u,h){Error.call(this),this.message=r,this.name="AxiosError",o&&(this.code=o),a&&(this.config=a),u&&(this.request=u),h&&(this.response=h)}ex.inherits(gh,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var tx=gh.prototype,nx={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(r){nx[r]={value:r}}),Object.defineProperties(gh,nx),Object.defineProperty(tx,"isAxiosError",{value:!0}),gh.from=function(r,o,a,u,h,g){var E=Object.create(tx);return ex.toFlatObject(r,E,function(S){return S!==Error.prototype}),gh.call(E,r.message,o,a,u,h),E.name=r.name,g&&Object.assign(E,g),E};var Eh=gh,rx={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},xa=to,sx=function(r,o){o=o||new FormData;var a=[];function u(h){return h===null?"":xa.isDate(h)?h.toISOString():xa.isArrayBuffer(h)||xa.isTypedArray(h)?typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}return function h(g,E){if(xa.isPlainObject(g)||xa.isArray(g)){if(a.indexOf(g)!==-1)throw Error("Circular reference detected in "+E);a.push(g),xa.forEach(g,function(S,T){if(!xa.isUndefined(S)){var C,w=E?E+"."+T:T;if(S&&!E&&typeof S=="object"){if(xa.endsWith(T,"{}"))S=JSON.stringify(S);else if(xa.endsWith(T,"[]")&&(C=xa.toArray(S)))return void C.forEach(function(N){!xa.isUndefined(N)&&o.append(w,u(N))})}h(S,w)}}),a.pop()}else o.append(E,u(g))}(r),o},Mv=Eh,tE=to,HG=tE.isStandardBrowserEnv()?{write:function(r,o,a,u,h,g){var E=[];E.push(r+"="+encodeURIComponent(o)),tE.isNumber(a)&&E.push("expires="+new Date(a).toGMTString()),tE.isString(u)&&E.push("path="+u),tE.isString(h)&&E.push("domain="+h),g===!0&&E.push("secure"),document.cookie=E.join("; ")},read:function(r){var o=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return o?decodeURIComponent(o[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},KG=function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)},qG=function(r,o){return o?r.replace(/\/+$/,"")+"/"+o.replace(/^\/+/,""):r},ox=function(r,o){return r&&!KG(o)?qG(r,o):o},$v=to,XG=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],ix=to,YG=ix.isStandardBrowserEnv()?function(){var r,o=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");function u(h){var g=h;return o&&(a.setAttribute("href",g),g=a.href),a.setAttribute("href",g),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return r=u(window.location.href),function(h){var g=ix.isString(h)?u(h):h;return g.protocol===r.protocol&&g.host===r.host}}():function(){return!0},Fv=Eh;function ax(r){Fv.call(this,r??"canceled",Fv.ERR_CANCELED),this.name="CanceledError"}to.inherits(ax,Fv,{__CANCEL__:!0});var nE=ax,pf=to,JG=function(r,o,a){var u=a.config.validateStatus;a.status&&u&&!u(a.status)?o(new Mv("Request failed with status code "+a.status,[Mv.ERR_BAD_REQUEST,Mv.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a)):r(a)},QG=HG,ZG=ZO,ez=ox,tz=function(r){var o,a,u,h={};return r&&$v.forEach(r.split(`
`),function(g){if(u=g.indexOf(":"),o=$v.trim(g.substr(0,u)).toLowerCase(),a=$v.trim(g.substr(u+1)),o){if(h[o]&&XG.indexOf(o)>=0)return;h[o]=o==="set-cookie"?(h[o]?h[o]:[]).concat([a]):h[o]?h[o]+", "+a:a}}),h},nz=YG,rz=rx,kc=Eh,sz=nE,oz=function(r){var o=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return o&&o[1]||""},iz=function(r){return new Promise(function(o,a){var u,h=r.data,g=r.headers,E=r.responseType;function S(){r.cancelToken&&r.cancelToken.unsubscribe(u),r.signal&&r.signal.removeEventListener("abort",u)}pf.isFormData(h)&&pf.isStandardBrowserEnv()&&delete g["Content-Type"];var T=new XMLHttpRequest;if(r.auth){var C=r.auth.username||"",w=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";g.Authorization="Basic "+btoa(C+":"+w)}var N=ez(r.baseURL,r.url);function M(){if(T){var X="getAllResponseHeaders"in T?tz(T.getAllResponseHeaders()):null,J={data:E&&E!=="text"&&E!=="json"?T.response:T.responseText,status:T.status,statusText:T.statusText,headers:X,config:r,request:T};JG(function(fe){o(fe),S()},function(fe){a(fe),S()},J),T=null}}if(T.open(r.method.toUpperCase(),ZG(N,r.params,r.paramsSerializer),!0),T.timeout=r.timeout,"onloadend"in T?T.onloadend=M:T.onreadystatechange=function(){T&&T.readyState===4&&(T.status!==0||T.responseURL&&T.responseURL.indexOf("file:")===0)&&setTimeout(M)},T.onabort=function(){T&&(a(new kc("Request aborted",kc.ECONNABORTED,r,T)),T=null)},T.onerror=function(){a(new kc("Network Error",kc.ERR_NETWORK,r,T,T)),T=null},T.ontimeout=function(){var X=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",J=r.transitional||rz;r.timeoutErrorMessage&&(X=r.timeoutErrorMessage),a(new kc(X,J.clarifyTimeoutError?kc.ETIMEDOUT:kc.ECONNABORTED,r,T)),T=null},pf.isStandardBrowserEnv()){var U=(r.withCredentials||nz(N))&&r.xsrfCookieName?QG.read(r.xsrfCookieName):void 0;U&&(g[r.xsrfHeaderName]=U)}"setRequestHeader"in T&&pf.forEach(g,function(X,J){h===void 0&&J.toLowerCase()==="content-type"?delete g[J]:T.setRequestHeader(J,X)}),pf.isUndefined(r.withCredentials)||(T.withCredentials=!!r.withCredentials),E&&E!=="json"&&(T.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&T.addEventListener("progress",r.onDownloadProgress),typeof r.onUploadProgress=="function"&&T.upload&&T.upload.addEventListener("progress",r.onUploadProgress),(r.cancelToken||r.signal)&&(u=function(X){T&&(a(!X||X&&X.type?new sz:X),T.abort(),T=null)},r.cancelToken&&r.cancelToken.subscribe(u),r.signal&&(r.signal.aborted?u():r.signal.addEventListener("abort",u))),h||(h=null);var Y=oz(N);Y&&["http","https","file"].indexOf(Y)===-1?a(new kc("Unsupported protocol "+Y+":",kc.ERR_BAD_REQUEST,r)):T.send(h)})},Us=to,cx=function(r,o){zG.forEach(r,function(a,u){u!==o&&u.toUpperCase()===o.toUpperCase()&&(r[o]=a,delete r[u])})},ux=Eh,az=sx,cz={"Content-Type":"application/x-www-form-urlencoded"};function lx(r,o){!Us.isUndefined(r)&&Us.isUndefined(r["Content-Type"])&&(r["Content-Type"]=o)}var dx,rE={transitional:rx,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(dx=iz),dx),transformRequest:[function(r,o){if(cx(o,"Accept"),cx(o,"Content-Type"),Us.isFormData(r)||Us.isArrayBuffer(r)||Us.isBuffer(r)||Us.isStream(r)||Us.isFile(r)||Us.isBlob(r))return r;if(Us.isArrayBufferView(r))return r.buffer;if(Us.isURLSearchParams(r))return lx(o,"application/x-www-form-urlencoded;charset=utf-8"),r.toString();var a,u=Us.isObject(r),h=o&&o["Content-Type"];if((a=Us.isFileList(r))||u&&h==="multipart/form-data"){var g=this.env&&this.env.FormData;return az(a?{"files[]":r}:r,g&&new g)}return u||h==="application/json"?(lx(o,"application/json"),function(E,S,T){if(Us.isString(E))try{return(S||JSON.parse)(E),Us.trim(E)}catch(C){if(C.name!=="SyntaxError")throw C}return(T||JSON.stringify)(E)}(r)):r}],transformResponse:[function(r){var o=this.transitional||rE.transitional,a=o&&o.silentJSONParsing,u=o&&o.forcedJSONParsing,h=!a&&this.responseType==="json";if(h||u&&Us.isString(r)&&r.length)try{return JSON.parse(r)}catch(g){if(h)throw g.name==="SyntaxError"?ux.from(g,ux.ERR_BAD_RESPONSE,this,null,this.response):g}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Us.forEach(["delete","get","head"],function(r){rE.headers[r]={}}),Us.forEach(["post","put","patch"],function(r){rE.headers[r]=Us.merge(cz)});var Uv=rE,uz=to,lz=Uv,hx=function(r){return!(!r||!r.__CANCEL__)},px=to,Vv=function(r,o,a){var u=this||lz;return uz.forEach(a,function(h){r=h.call(u,r,o)}),r},dz=hx,hz=Uv,pz=nE;function Bv(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new pz}var Ii=to,fx=function(r,o){o=o||{};var a={};function u(C,w){return Ii.isPlainObject(C)&&Ii.isPlainObject(w)?Ii.merge(C,w):Ii.isPlainObject(w)?Ii.merge({},w):Ii.isArray(w)?w.slice():w}function h(C){return Ii.isUndefined(o[C])?Ii.isUndefined(r[C])?void 0:u(void 0,r[C]):u(r[C],o[C])}function g(C){if(!Ii.isUndefined(o[C]))return u(void 0,o[C])}function E(C){return Ii.isUndefined(o[C])?Ii.isUndefined(r[C])?void 0:u(void 0,r[C]):u(void 0,o[C])}function S(C){return C in o?u(r[C],o[C]):C in r?u(void 0,r[C]):void 0}var T={url:g,method:g,data:g,baseURL:E,transformRequest:E,transformResponse:E,paramsSerializer:E,timeout:E,timeoutMessage:E,withCredentials:E,adapter:E,responseType:E,xsrfCookieName:E,xsrfHeaderName:E,onUploadProgress:E,onDownloadProgress:E,decompress:E,maxContentLength:E,maxBodyLength:E,beforeRedirect:E,transport:E,httpAgent:E,httpsAgent:E,cancelToken:E,socketPath:E,responseEncoding:E,validateStatus:S};return Ii.forEach(Object.keys(r).concat(Object.keys(o)),function(C){var w=T[C]||h,N=w(C);Ii.isUndefined(N)&&w!==S||(a[C]=N)}),a},mx="0.27.2",fz=mx,Ru=Eh,jv={};["object","boolean","number","function","string","symbol"].forEach(function(r,o){jv[r]=function(a){return typeof a===r||"a"+(o<1?"n ":" ")+r}});var gx={};jv.transitional=function(r,o,a){function u(h,g){return"[Axios v"+fz+"] Transitional option '"+h+"'"+g+(a?". "+a:"")}return function(h,g,E){if(r===!1)throw new Ru(u(g," has been removed"+(o?" in "+o:"")),Ru.ERR_DEPRECATED);return o&&!gx[g]&&(gx[g]=!0,console.warn(u(g," has been deprecated since v"+o+" and will be removed in the near future"))),!r||r(h,g,E)}};var Ex=to,mz=ZO,_x=GG,yx=function(r){return Bv(r),r.headers=r.headers||{},r.data=Vv.call(r,r.data,r.headers,r.transformRequest),r.headers=px.merge(r.headers.common||{},r.headers[r.method]||{},r.headers),px.forEach(["delete","get","head","post","put","patch","common"],function(o){delete r.headers[o]}),(r.adapter||hz.adapter)(r).then(function(o){return Bv(r),o.data=Vv.call(r,o.data,o.headers,r.transformResponse),o},function(o){return dz(o)||(Bv(r),o&&o.response&&(o.response.data=Vv.call(r,o.response.data,o.response.headers,r.transformResponse))),Promise.reject(o)})},sE=fx,gz=ox,vx={assertOptions:function(r,o,a){if(typeof r!="object")throw new Ru("options must be an object",Ru.ERR_BAD_OPTION_VALUE);for(var u=Object.keys(r),h=u.length;h-- >0;){var g=u[h],E=o[g];if(E){var S=r[g],T=S===void 0||E(S,g,r);if(T!==!0)throw new Ru("option "+g+" must be "+T,Ru.ERR_BAD_OPTION_VALUE)}else if(a!==!0)throw new Ru("Unknown option "+g,Ru.ERR_BAD_OPTION)}},validators:jv},_h=vx.validators;function yh(r){this.defaults=r,this.interceptors={request:new _x,response:new _x}}yh.prototype.request=function(r,o){typeof r=="string"?(o=o||{}).url=r:o=r||{},(o=sE(this.defaults,o)).method?o.method=o.method.toLowerCase():this.defaults.method?o.method=this.defaults.method.toLowerCase():o.method="get";var a=o.transitional;a!==void 0&&vx.assertOptions(a,{silentJSONParsing:_h.transitional(_h.boolean),forcedJSONParsing:_h.transitional(_h.boolean),clarifyTimeoutError:_h.transitional(_h.boolean)},!1);var u=[],h=!0;this.interceptors.request.forEach(function(N){typeof N.runWhen=="function"&&N.runWhen(o)===!1||(h=h&&N.synchronous,u.unshift(N.fulfilled,N.rejected))});var g,E=[];if(this.interceptors.response.forEach(function(N){E.push(N.fulfilled,N.rejected)}),!h){var S=[yx,void 0];for(Array.prototype.unshift.apply(S,u),S=S.concat(E),g=Promise.resolve(o);S.length;)g=g.then(S.shift(),S.shift());return g}for(var T=o;u.length;){var C=u.shift(),w=u.shift();try{T=C(T)}catch(N){w(N);break}}try{g=yx(T)}catch(N){return Promise.reject(N)}for(;E.length;)g=g.then(E.shift(),E.shift());return g},yh.prototype.getUri=function(r){r=sE(this.defaults,r);var o=gz(r.baseURL,r.url);return mz(o,r.params,r.paramsSerializer)},Ex.forEach(["delete","get","head","options"],function(r){yh.prototype[r]=function(o,a){return this.request(sE(a||{},{method:r,url:o,data:(a||{}).data}))}}),Ex.forEach(["post","put","patch"],function(r){function o(a){return function(u,h,g){return this.request(sE(g||{},{method:r,headers:a?{"Content-Type":"multipart/form-data"}:{},url:u,data:h}))}}yh.prototype[r]=o(),yh.prototype[r+"Form"]=o(!0)});var Ez=yh,_z=nE;function vh(r){if(typeof r!="function")throw new TypeError("executor must be a function.");var o;this.promise=new Promise(function(u){o=u});var a=this;this.promise.then(function(u){if(a._listeners){var h,g=a._listeners.length;for(h=0;h<g;h++)a._listeners[h](u);a._listeners=null}}),this.promise.then=function(u){var h,g=new Promise(function(E){a.subscribe(E),h=E}).then(u);return g.cancel=function(){a.unsubscribe(h)},g},r(function(u){a.reason||(a.reason=new _z(u),o(a.reason))})}vh.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},vh.prototype.subscribe=function(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]},vh.prototype.unsubscribe=function(r){if(this._listeners){var o=this._listeners.indexOf(r);o!==-1&&this._listeners.splice(o,1)}},vh.source=function(){var r;return{token:new vh(function(o){r=o}),cancel:r}};var yz=vh,vz=to,Sx=to,Sz=XO,oE=Ez,Tz=fx,Yo=function r(o){var a=new oE(o),u=Sz(oE.prototype.request,a);return Sx.extend(u,oE.prototype,a),Sx.extend(u,a),u.create=function(h){return r(Tz(o,h))},u}(Uv);Yo.Axios=oE,Yo.CanceledError=nE,Yo.CancelToken=yz,Yo.isCancel=hx,Yo.VERSION=mx,Yo.toFormData=sx,Yo.AxiosError=Eh,Yo.Cancel=Yo.CanceledError,Yo.all=function(r){return Promise.all(r)},Yo.spread=function(r){return function(o){return r.apply(null,o)}},Yo.isAxiosError=function(r){return vz.isObject(r)&&r.isAxiosError===!0},Av.exports=Yo,Av.exports.default=Yo;var Ji=Av.exports;class Iz{constructor(o){k(this,"logger",void 0),k(this,"prefixLists",[]),this.logger=o}debug(){for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];this.logger.debug(...this.prefixLists,...a)}info(){for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];this.logger.info(...this.prefixLists,...a)}warning(){for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];this.logger.warning(...this.prefixLists,...a)}error(){for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];this.logger.error(...this.prefixLists,...a)}prefix(o){return this.prefixLists.push(o),this}popPrefix(){return this.prefixLists.pop(),this}}class Qn{constructor(){k(this,"_events",{}),k(this,"addListener",this.on)}getListeners(o){return this._events[o]?this._events[o].map(a=>a.listener):[]}on(o,a){this._events[o]||(this._events[o]=[]);const u=this._events[o];this._indexOfListener(u,a)===-1&&u.push({listener:a,once:!1})}once(o,a){this._events[o]||(this._events[o]=[]);const u=this._events[o];this._indexOfListener(u,a)===-1&&u.push({listener:a,once:!0})}off(o,a){if(!this._events[o])return;const u=this._events[o],h=this._indexOfListener(u,a);h!==-1&&u.splice(h,1),this._events[o].length===0&&delete this._events[o]}removeAllListeners(o){o?delete this._events[o]:this._events={}}emit(o){this._events[o]||(this._events[o]=[]);const a=this._events[o].map(E=>E);for(var u=arguments.length,h=new Array(u>1?u-1:0),g=1;g<u;g++)h[g-1]=arguments[g];for(let E=0;E<a.length;E+=1){const S=a[E];S.once&&this.off(o,S.listener),S.listener.apply(this,h||[])}}_indexOfListener(o,a){let u=o.length;for(;u--;)if(o[u].listener===a)return u;return-1}}const iE=new class extends Qn{reportLogUploadError(r){this.emit("REPORT_LOG_UPLOAD",r)}};let K;(function(r){r.UNEXPECTED_ERROR="UNEXPECTED_ERROR",r.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",r.TIMEOUT="TIMEOUT",r.INVALID_PARAMS="INVALID_PARAMS",r.NOT_READABLE="NOT_READABLE",r.NOT_SUPPORTED="NOT_SUPPORTED",r.INVALID_OPERATION="INVALID_OPERATION",r.OPERATION_ABORTED="OPERATION_ABORTED",r.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",r.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",r.NETWORK_ERROR="NETWORK_ERROR",r.NETWORK_TIMEOUT="NETWORK_TIMEOUT",r.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",r.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",r.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",r.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",r.ELECTRON_IS_NULL="ELECTRON_IS_NULL",r.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",r.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",r.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",r.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",r.TRACK_IS_DISABLED="TRACK_IS_DISABLED",r.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",r.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",r.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",r.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",r.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",r.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",r.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",r.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",r.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",r.UID_CONFLICT="UID_CONFLICT",r.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",r.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",r.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",r.INVALID_TRACK="INVALID_TRACK",r.SENDER_NOT_FOUND="SENDER_NOT_FOUND",r.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",r.SET_ANSWER_FAILED="SET_ANSWER_FAILED",r.ICE_FAILED="ICE_FAILED",r.PC_CLOSED="PC_CLOSED",r.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",r.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",r.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",r.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",r.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",r.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",r.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",r.INVALID_REMOTE_USER="INVALID_REMOTE_USER",r.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",r.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",r.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",r.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",r.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",r.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",r.WS_ABORT="WS_ABORT",r.WS_DISCONNECT="WS_DISCONNECT",r.WS_ERR="WS_ERR",r.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",r.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",r.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",r.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",r.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",r.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",r.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",r.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",r.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",r.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",r.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",r.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",r.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",r.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",r.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",r.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",r.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",r.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",r.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",r.INVALID_PLUGIN="INVALID_PLUGIN",r.DISCONNECT_P2P="DISCONNECT_P2P",r.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",r.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",r.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",r.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",r.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",r.PROHIBITED_OPERATION="PROHIBITED_OPERATION"})(K||(K={}));class Q extends Error{constructor(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",u=arguments.length>2?arguments[2]:void 0;super(a),k(this,"code",void 0),k(this,"message",void 0),k(this,"data",void 0),k(this,"name","AgoraRTCException"),this.code=o,this.message="AgoraRTCError ".concat(this.code,": ").concat(a),this.data=u}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return o==="error"&&F.error(this.toString()),o==="warning"&&F.warning(this.toString()),this}throw(){throw this.print(),this}}const Or={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Wv(r,o){const a=Math.floor(o.timeout*Math.pow(o.timeoutFactor,r));return Math.min(o.maxRetryTimeout,a)}function nc(r,o,a,u){const h=Object.assign({},Or,u);let g=h.timeout;const E=async()=>{await function(C){return new Je(w=>{window.setTimeout(w,C)})}(g),g*=h.timeoutFactor,g=Math.min(h.maxRetryTimeout,g)};let S=!1;const T=new Je(async(C,w)=>{o=o||(()=>!1),a=a||(()=>!0);for(let N=0;N<h.maxRetryCount;N+=1){if(S)return w(new Q(K.OPERATION_ABORTED));try{const M=await r();if(!o(M,N)||N+1===h.maxRetryCount)return C(M);await E()}catch(M){if(!a(M,N)||N+1===h.maxRetryCount)return w(M);await E()}}});return T.cancel=()=>S=!0,T}function Gv(){const r=new Date;return r.toTimeString().split(" ")[0]+":"+r.getMilliseconds()}function Tx(){const r=new Date,o=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return o?(o==null?void 0:o[0])+":"+r.getUTCMilliseconds():r.toTimeString().split(" ")[0]+":"+r.getMilliseconds()}const Ci={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},aE=Date.now(),ff=r=>{for(const o in Ci)if(Object.prototype.hasOwnProperty.call(Ci,o)&&Ci[o]===r)return o;return"DEFAULT"},F=new class{constructor(){k(this,"proxyServerURL",void 0),k(this,"logLevel",Ci.DEBUG),k(this,"uploadState","collecting"),k(this,"uploadLogWaitingList",[]),k(this,"uploadLogUploadingList",[]),k(this,"uploadErrorCount",0),k(this,"currentLogID",0),k(this,"url",void 0),k(this,"extLog",(r,o)=>{this.appendLogToWaitingList(r,...o)})}debug(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];const u=[Ci.DEBUG].concat(o);this.log.apply(this,u)}info(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];const u=[Ci.INFO].concat(o);this.log.apply(this,u)}warning(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];const u=[Ci.WARNING].concat(o);this.log.apply(this,u)}error(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];const u=[Ci.ERROR].concat(o);this.log.apply(this,u)}upload(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];const u=[Ci.DEBUG].concat(o);this.uploadLog.apply(this,u)}setLogLevel(r){r=Math.min(Math.max(0,r),4),this.logLevel=r}enableLogUpload(){_n("UPLOAD_LOG",!0)}disableLogUpload(){_n("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(r){this.proxyServerURL=r}prefix(r){return new Iz(this).prefix(r)}log(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];if(Date.now()-aE<100)return void setTimeout(()=>{this.log(...o)},Date.now()-aE);const u=Math.max(0,Math.min(4,o[0]));if(o[0]=Gv()+" Agora-SDK [".concat(ff(u),"]:"),this.appendLogToWaitingList(u,...o),u<this.logLevel)return;const h=Gv()+" %cAgora-SDK [".concat(ff(u),"]:");let g=[];if(!de("USE_NEW_LOG"))switch(u){case Ci.DEBUG:g=[h,"color: #64B5F6;"].concat(o.slice(1)),console.log.apply(console,g);break;case Ci.INFO:g=[h,"color: #1E88E5; font-weight: bold;"].concat(o.slice(1)),console.log.apply(console,g);break;case Ci.WARNING:g=[h,"color: #FB8C00; font-weight: bold;"].concat(o.slice(1)),console.warn.apply(console,g);break;case Ci.ERROR:g=[h,"color: #B00020; font-weight: bold;"].concat(o.slice(1)),console.error.apply(console,g)}}uploadLog(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];if(Date.now()-aE<100)return void setTimeout(()=>{this.uploadLog(...o)},Date.now()-aE);const u=Math.max(0,Math.min(4,o[0]));o[0]=Gv()+" Agora-SDK [".concat(ff(u),"]:"),this.appendLogToWaitingList(u,...o)}appendLogToWaitingList(r){if(!de("UPLOAD_LOG"))return;for(var o=arguments.length,a=new Array(o>1?o-1:0),u=1;u<o;u++)a[u-1]=arguments[u];Array.isArray(a[0])?a[0][0]=Tx()+" Agora-SDK [".concat(ff(r),"]:"):a[0]=Tx()+" Agora-SDK [".concat(ff(r),"]:");let h="";a.forEach(g=>{typeof g=="object"&&(g=JSON.stringify(g)),h+="".concat(g," ")}),this.uploadLogWaitingList.push({payload_str:h,log_level:r,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const r=this.uploadLogUploadingList,o={sdk_version:wi,process_id:de("PROCESS_ID"),payload:JSON.stringify(r)};return nc(async()=>{const a=await Ji.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(de("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(de("LOG_UPLOAD_SERVER"),"/upload/v1")),o,{responseType:"text"});if(a.data!=="OK"){const u=new Error("unexpected upload log response");throw u.response=a,u}},()=>(this.uploadLogUploadingList=[],!1),a=>(a.response?iE.reportLogUploadError({status:a.response.status,data:a.response.data,headers:a.response.headers,message:a.message}):a.request?iE.reportLogUploadError({status:a.request.status,message:a.message}):iE.reportLogUploadError({status:-1,message:a.message}),!0),{timeout:de("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:de("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,de("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),de("UPLOAD_LOG_INTERVAL"))}).catch(r=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),de("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),de("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},zv="v4.17.0-0-gf6ae6c87-dirty(3/22/2023, 2:41:22 PM)",wi=function(r){if(r.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return r;const o=r.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(o&&o[1]&&o[2]){const u=o[1],h=o[2];return"".concat(u,".").concat(h)}const a=r.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(a&&a[1]&&a[2]){const u=a[1],h=a[2];return"".concat(u,".").concat(100*(Number(h)+1))}return"4.0.0.999"}("4.17.0"),Hv=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),Ix=["CHINA","GLOBAL"],Jo=function(){const r="us".concat("erna","me"),o="pa".concat("sswo","rd"),a=["t","s","t"];a.splice(1,0,"e");const u=a.join(""),h=[];for(let S=0;S<6;S++)h.push("1");const g=h.join(""),E={};return E[r]=u,E[o]=g,Object.assign(E,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Jo;const Cz={"90p":jt(160,90),"90p_1":jt(160,90),"120p":jt(160,120,15,30,65),"120p_1":jt(160,120,15,30,65),"120p_3":jt(120,120,15,30,50),"120p_4":jt(212,120),"180p":jt(320,180,15,30,140),"180p_1":jt(320,180,15,30,140),"180p_3":jt(180,180,15,30,100),"180p_4":jt(240,180,15,30,120),"240p":jt(320,240,15,40,200),"240p_1":jt(320,240,15,40,200),"240p_3":jt(240,240,15,40,140),"240p_4":jt(424,240,15,40,220),"360p":jt(640,360,15,80,400),"360p_1":jt(640,360,15,80,400),"360p_3":jt(360,360,15,80,260),"360p_4":jt(640,360,30,80,600),"360p_6":jt(360,360,30,80,400),"360p_7":jt(480,360,15,80,320),"360p_8":jt(480,360,30,80,490),"360p_9":jt(640,360,15,80,800),"360p_10":jt(640,360,24,80,800),"360p_11":jt(640,360,24,80,1e3),"480p":jt(640,480,15,100,500),"480p_1":jt(640,480,15,100,500),"480p_2":jt(640,480,30,100,1e3),"480p_3":jt(480,480,15,100,400),"480p_4":jt(640,480,30,100,750),"480p_6":jt(480,480,30,100,600),"480p_8":jt(848,480,15,100,610),"480p_9":jt(848,480,30,100,930),"480p_10":jt(640,480,10,100,400),"720p":jt(1280,720,15,120,1130),"720p_1":jt(1280,720,15,120,1130),"720p_2":jt(1280,720,30,120,2e3),"720p_3":jt(1280,720,30,120,1710),"720p_5":jt(960,720,15,120,910),"720p_6":jt(960,720,30,120,1380),"1080p":jt(1920,1080,15,120,2080),"1080p_1":jt(1920,1080,15,120,2080),"1080p_2":jt(1920,1080,30,120,3e3),"1080p_3":jt(1920,1080,30,120,3150),"1080p_5":jt(1920,1080,60,120,4780),"1440p":jt(2560,1440,30,120,4850),"1440p_1":jt(2560,1440,30,120,4850),"1440p_2":jt(2560,1440,60,120,7350),"4k":jt(3840,2160,30,120,8910),"4k_1":jt(3840,2160,30,120,8910),"4k_3":jt(3840,2160,60,120,13500)},wz={"480p":Qi(640,480,5),"480p_1":Qi(640,480,5),"480p_2":Qi(640,480,30),"480p_3":Qi(640,480,15),"720p":Qi(1280,720,5),"720p_1":Qi(1280,720,5),"720p_2":Qi(1280,720,30),"720p_3":Qi(1280,720,15),"1080p":Qi(1920,1080,5),"1080p_1":Qi(1920,1080,5),"1080p_2":Qi(1920,1080,30),"1080p_3":Qi(1920,1080,15)},Rz={"1SL1TL":qv(1,1),"3SL3TL":qv(3,3),"2SL3TL":qv(2,3)};function Sh(r){return r||(r="480p_1"),typeof r=="string"?Object.assign({},Cz[r]):r}function Kv(r){return typeof r=="string"?Object.assign({},wz[r]):r}function cE(r){return typeof r=="string"?Object.assign({},Rz[r]):r}const bz={speech_low_quality:Th(16e3,!1),speech_standard:Th(32e3,!1,18),music_standard:Th(48e3,!1),standard_stereo:Th(48e3,!0,56),high_quality:Th(48e3,!1,128),high_quality_stereo:Th(48e3,!0,192)};function uE(r){return typeof r=="string"?Object.assign({},bz[r]):r}function _n(r,o,a){Object.keys(yo).includes(r)&&(!a&&Object.keys(Hl).includes(r)||(yo[r]=o))}function de(r){return yo[r]}const yo={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:Ix,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,AV_SYNC:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},Hl={};function Th(r,o,a){return{sampleRate:r,stereo:o,bitrate:a}}function jt(r,o,a,u,h){return{width:r,height:o,frameRate:a,bitrateMin:u,bitrateMax:h}}function Qi(r,o,a,u,h){return{width:{max:r},height:{max:o},frameRate:a,bitrateMin:u,bitrateMax:h}}function qv(r,o){return{numSpatialLayers:r,numTemporalLayers:o}}Hv||(yo.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],yo.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],yo.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],yo.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],yo.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],yo.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],yo.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",yo.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",yo.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",yo.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",yo.AREAS=["NORTH_AMERICA","OVERSEA"]);const Nz=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Ih=[],mf=[];var Az=wc,Oz=B,xz=Oe,Xv=function(r,o,a){var u=Az(o);u in r?Oz.f(r,u,xz(0,a)):r[u]=a},Cx=Sy,kz=Su,Dz=Xv,Pz=I.Array,Lz=Math.max,wx=function(r,o,a){for(var u=kz(r),h=Cx(o,u),g=Cx(a===void 0?u:a,u),E=Pz(Lz(g-h,0)),S=0;h<g;h++,S++)Dz(E,S,r[h]);return E.length=S,E},Rx=wx,Mz=Math.floor,Yv=function(r,o){var a=r.length,u=Mz(a/2);return a<8?$z(r,o):Fz(r,Yv(Rx(r,0,u),o),Yv(Rx(r,u),o),o)},$z=function(r,o){for(var a,u,h=r.length,g=1;g<h;){for(u=g,a=r[g];u&&o(r[u-1],a)>0;)r[u]=r[--u];u!==g++&&(r[u]=a)}return r},Fz=function(r,o,a,u){for(var h=o.length,g=a.length,E=0,S=0;E<h||S<g;)r[E+S]=E<h&&S<g?u(o[E],a[S])<=0?o[E++]:a[S++]:E<h?o[E++]:a[S++];return r},Uz=Yv,bx=Pn.match(/firefox\/(\d+)/i),Vz=!!bx&&+bx[1],Bz=/MSIE|Trident/.test(Pn),Nx=Pn.match(/AppleWebKit\/(\d+)\./),jz=!!Nx&&+Nx[1],Wz=Zs,Ax=_,Gz=zr,zz=vi,Hz=Su,Ox=oh,Jv=i,Kz=Uz,qz=gy,xx=Vz,Xz=Bz,kx=Wr,Dx=jz,bu=[],Px=Ax(bu.sort),Yz=Ax(bu.push),Jz=Jv(function(){bu.sort(void 0)}),Qz=Jv(function(){bu.sort(null)}),Zz=qz("sort"),Lx=!Jv(function(){if(kx)return kx<70;if(!(xx&&xx>3)){if(Xz)return!0;if(Dx)return Dx<603;var r,o,a,u,h="";for(r=65;r<76;r++){switch(o=String.fromCharCode(r),r){case 66:case 69:case 70:case 72:a=3;break;case 68:case 71:a=4;break;default:a=2}for(u=0;u<47;u++)bu.push({k:o+u,v:a})}for(bu.sort(function(g,E){return E.v-g.v}),u=0;u<bu.length;u++)o=bu[u].k.charAt(0),h.charAt(h.length-1)!==o&&(h+=o);return h!=="DGBEFHACIJK"}});Wz({target:"Array",proto:!0,forced:Jz||!Qz||!Zz||!Lx},{sort:function(r){r!==void 0&&Gz(r);var o=zz(this);if(Lx)return r===void 0?Px(o):Px(o,r);var a,u,h=[],g=Hz(o);for(u=0;u<g;u++)u in o&&Yz(h,o[u]);for(Kz(h,function(E){return function(S,T){return T===void 0?-1:S===void 0?1:E!==void 0?+E(S,T)||0:Ox(S)>Ox(T)?1:-1}}(r)),a=h.length,u=0;u<a;)o[u]=h[u++];for(;u<g;)delete o[u++];return o}});var eH=Tu("Array").sort,tH=y,nH=eH,Qv=Array.prototype,Zv=function(r){var o=r.sort;return r===Qv||tH(Qv,r)&&o===Qv.sort?nH:o};function gf(r,o){if(typeof r!="boolean")throw new Q(K.INVALID_PARAMS,"Invalid ".concat(o,": The value is of the boolean type."))}function bs(r,o,a){if(!a.includes(r))throw new Q(K.INVALID_PARAMS,"".concat(o," can only be set as ").concat(JSON.stringify(a)))}function Nn(r,o){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4,h=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(r<a||r>u||h&&!rH(r))throw new Q(K.INVALID_PARAMS,"invalid ".concat(o,": the value range is [").concat(a,", ").concat(u,"]. integer only"))}function eS(r,o){if(typeof r!="number"){if(!(r.min||r.max||r.ideal||r.exact))throw new Q(K.INVALID_PARAMS,"".concat(o," is not a valid ConstrainLong"));r.min!==void 0&&Nn(r.min,"".concat(o,".min"),0,1/0),r.max!==void 0&&Nn(r.max,"".concat(o,".max"),1,1/0),r.exact!==void 0&&Nn(r.exact,"".concat(o,".exact"),1,1/0),r.ideal!==void 0&&Nn(r.ideal,"".concat(o,".ideal"),1,1/0)}else Nn(r,o,1,1/0)}function ms(r,o){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,h=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(r==null)throw new Q(K.INVALID_PARAMS,"".concat(o||"param"," cannot be empty"));if(!Mx(r,a,u,h))throw new Q(K.INVALID_PARAMS,"Invalid ".concat(o||"string param",": Length of the string: [").concat(a,",").concat(u,"].").concat(h?" ASCII characters only.":""))}function Dc(r,o){if(!Array.isArray(r))throw new Q(K.INVALID_PARAMS,"".concat(o," should be an array"))}function tS(r){if(typeof r!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(r))throw F.error("Invalid Channel Name ".concat(r)),new Q(K.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function nS(r){if(o=r,!(typeof o=="number"&&Math.floor(o)===o&&0<=o&&o<=4294967295||Mx(r,1,255)))throw F.error("Invalid UID ".concat(r," ").concat(typeof r)),new Q(K.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var o;typeof r=="string"&&F.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function Ln(r){return r==null}function Mx(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,u=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof r=="string"&&r.length<=a&&r.length>=o&&(!u||sH(r))}function rH(r){return typeof r=="number"&&r%1==0}function sH(r){if(typeof r!="string")return!1;for(let o=0;o<r.length;o+=1){const a=r.charCodeAt(o);if(a<0||a>255)return!1}return!0}let $x,Fx,as;(function(r){r.FREE="free",r.UPLOADING="uploading"})($x||($x={})),function(r){r[r.MISC=0]="MISC",r[r.INTERNAL_EVENT=1]="INTERNAL_EVENT",r[r.PUBLIC_EVENT=2]="PUBLIC_EVENT",r[r.WEB_EVENT=3]="WEB_EVENT",r[r.INTERNAL_API=4]="INTERNAL_API",r[r.WEB_API=5]="WEB_API",r[r.PUBLIC_API=6]="PUBLIC_API"}(Fx||(Fx={})),function(r){r.NONE="none",r.INIT="init",r.CANPLAY="canplay",r.PLAYING="playing",r.PAUSED="paused",r.SUSPEND="suspend",r.STALLED="stalled",r.WAITING="waiting",r.ERROR="error",r.DESTROYED="destroyed",r.ABORT="abort",r.ENDED="ended",r.EMPTIED="emptied",r.LOADEDDATA="loadeddata"}(as||(as={}));const rS={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function oH(r){return ms(r.reportId,"params.reportId",0,100,!1),ms(r.category,"params.category",0,100,!1),ms(r.event,"params.event",0,100,!1),ms(r.label,"params.label",0,100,!1),Nn(r.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const iH={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let gs,zn,Ux,sS,vr,jn,Kl,Pc,Ch,Ef,Qo,Es,dt,oS,nn,$t,no,dn,it,Et,vo,Mt,Vx,So;function Bx(r){return Nn(r.timeout,"config.timeout",0,1e5),Nn(r.timeoutFactor,"config.timeoutFactor",0,100,!1),Nn(r.maxRetryCount,"config.maxRetryConfig",0,1/0),Nn(r.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function aH(r){return bs(r.codec,"config.codec",["vp8","vp9","av1","h264"]),bs(r.mode,"config.mode",["rtc","live"]),r.audioCodec!==void 0&&bs(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&ms(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&jx(r.turnServer),r.httpRetryConfig!==void 0&&Bx(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&Bx(r.websocketRetryConfig),!0}function _f(r){if(!Array.isArray(r)||r.length<1)return!1;try{r.forEach(o=>{if(!o.urls)throw Error()})}catch{return!1}return!0}function jx(r){return ms(r.turnServerURL,"turnServerURL"),ms(r.username,"username"),ms(r.password,"password"),r.udpport&&Nn(r.udpport,"udpport",1,99999,!0),r.forceturn&&gf(r.forceturn,"forceturn"),r.security&&gf(r.security,"security"),r.tcpport&&Nn(r.tcpport,"tcpport",1,99999,!0),!0}function Wx(r){return r.level!==void 0&&bs(r.level,"level",[1,2,3]),!0}(function(r){r.PUBLISH="publish",r.SUBSCRIBE="subscribe",r.WS_COMPRESSOR_INIT="ws_compressor_init",r.SESSION_INIT="session_init",r.JOIN_CHOOSE_SERVER="join_choose_server",r.REQ_USER_ACCOUNT="req_user_account",r.JOIN_GATEWAY="join_gateway",r.REJOIN_GATEWAY="rejoin_gateway",r.STREAM_SWITCH="stream_switch",r.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",r.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",r.FIRST_VIDEO_RECEIVED="first_video_received",r.FIRST_AUDIO_RECEIVED="first_audio_received",r.FIRST_VIDEO_DECODE="first_video_decode",r.FIRST_AUDIO_DECODE="first_audio_decode",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_UPDATE_STREAM="on_update_stream",r.ON_REMOVE_STREAM="on_remove_stream",r.USER_ANALYTICS="req_user_analytics"})(gs||(gs={})),function(r){r.SESSION="io.agora.pb.Wrtc.Session",r.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",r.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",r.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",r.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",r.PUBLISH="io.agora.pb.Wrtc.Publish",r.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",r.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",r.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",r.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",r.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",r.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",r.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",r.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",r.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",r.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",r.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",r.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",r.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",r.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",r.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",r.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",r.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",r.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",r.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",r.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",r.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",r.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",r.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",r.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed"}(zn||(zn={})),function(r){r[r.WORKER_EVENT=156]="WORKER_EVENT",r[r.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(Ux||(Ux={})),function(r){r[r.SESSION=26]="SESSION",r[r.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",r[r.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",r[r.JOIN_GATEWAY=28]="JOIN_GATEWAY",r[r.PUBLISH=30]="PUBLISH",r[r.SUBSCRIBE=29]="SUBSCRIBE",r[r.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",r[r.STREAM_SWITCH=32]="STREAM_SWITCH",r[r.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",r[r.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",r[r.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",r[r.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",r[r.API_INVOKE=41]="API_INVOKE",r[r.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",r[r.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",r[r.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",r[r.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",r[r.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",r[r.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",r[r.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",r[r.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",r[r.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",r[r.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",r[r.WORKER_EVENT=156]="WORKER_EVENT",r[r.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",r[r.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",r[r.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",r[r.USER_ANALYTICS=1e4]="USER_ANALYTICS",r[r.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(sS||(sS={})),function(r){r.CREATE_CLIENT="createClient",r.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",r.SET_AREA="setArea",r.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",r.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",r.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",r.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",r.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",r.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",r.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",r.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",r.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",r.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",r.START_PROXY_SERVER="Client.startProxyServer",r.STOP_PROXY_SERVER="Client.stopProxyServer",r.SET_PROXY_SERVER="Client.setProxyServer",r.SET_TURN_SERVER="Client.setTurnServer",r.SET_CLIENT_ROLE="Client.setClientRole",r.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",r.ENABLE_DUAL_STREAM="Client.enableDualStream",r.DISABLE_DUAL_STREAM="Client.disableDualStream",r.JOIN="Client.join",r.LEAVE="Client.leave",r.PUBLISH="Client.publish",r.UNPUBLISH="Client.unpublish",r.SUBSCRIBE="Client.subscribe",r.MASS_SUBSCRIBE="Client.massSubscribe",r.MASS_UNSUBSCRIBE="Client.massUnsubscribe",r.UNSUBSCRIBE="Client.unsubscribe",r.RENEW_TOKEN="Client.renewToken",r.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",r.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",r.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",r.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",r.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",r.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",r.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",r.DATACHANNEL_FAILBACK="Client._datachannelFailback",r.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",r.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",r.START_LIVE_STREAMING="Client.startLiveStreaming",r.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",r.STOP_LIVE_STREAMING="Client.stopLiveStreaming",r.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",r.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",r.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",r.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",r.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",r.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",r.SET_CONFIG_DISTRIBUTE="_configDistribute",r.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",r.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",r.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",r.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",r.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",r.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",r.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",r.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",r.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",r.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",r.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",r.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",r.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",r.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",r.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",r.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",r.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",r.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",r.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",r.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",r.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",r.STREAM_TYPE_CHANGE="streamTypeChange",r.CONNECTION_STATE_CHANGE="connectionStateChange",r.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage"}(vr||(vr={})),function(r){r.TRACER="tracer"}(jn||(jn={})),function(r){r.IDLE="IDLE",r.INITING="INITING",r.INITEND="INITEND"}(Kl||(Kl={})),function(r){r.STATE_CHANGE="state_change",r.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",r.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",r.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Pc||(Pc={})),function(r){r[r.ACCESS_POINT=101]="ACCESS_POINT",r[r.UNILBS=201]="UNILBS",r[r.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Ch||(Ch={})),function(r){r[r.IIIEGAL_APPID=1]="IIIEGAL_APPID",r[r.IIIEGAL_UID=2]="IIIEGAL_UID",r[r.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Ef||(Ef={})),function(r){r[r.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",r[r.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",r[r.INTERNAL_ERROR=8]="INTERNAL_ERROR",r[r.NO_AUTHORIZED=9]="NO_AUTHORIZED",r[r.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",r[r.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",r[r.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",r[r.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",r[r.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",r[r.USER_OVERLOAD=16]="USER_OVERLOAD",r[r.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",r[r.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Qo||(Qo={})),function(r){r[r.NO_FLAG_SET=100]="NO_FLAG_SET",r[r.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",r[r.INVALID_FALG_SET=102]="INVALID_FALG_SET",r[r.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",r[r.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",r[r.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",r[r.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",r[r.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",r[r.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",r[r.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",r[r.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",r[r.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",r[r.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",r[r.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",r[r.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",r[r.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",r[r.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",r[r.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",r[r.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Es||(Es={})),function(r){r[r.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",r[r.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",r[r.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",r[r.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",r[r.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",r[r.K_TICKET_INVALID=7]="K_TICKET_INVALID",r[r.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",r[r.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",r[r.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",r[r.K_UID_BANNED=14]="K_UID_BANNED",r[r.K_IP_BANNED=15]="K_IP_BANNED",r[r.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",r[r.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",r[r.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",r[r.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",r[r.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",r[r.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",r[r.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",r[r.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",r[r.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",r[r.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",r[r.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",r[r.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",r[r.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",r[r.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",r[r.ERR_INVALID_UID=117]="ERR_INVALID_UID",r[r.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",r[r.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",r[r.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",r[r.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",r[r.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",r[r.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",r[r.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",r[r.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",r[r.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",r[r.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",r[r.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",r[r.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",r[r.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",r[r.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",r[r.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",r[r.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",r[r.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",r[r.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",r[r.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",r[r.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",r[r.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",r[r.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",r[r.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",r[r.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",r[r.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",r[r.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",r[r.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",r[r.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",r[r.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",r[r.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",r[r.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",r[r.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",r[r.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",r[r.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",r[r.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",r[r.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",r[r.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(dt||(dt={})),function(r){r[r.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",r[r.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",r[r.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(oS||(oS={})),function(r){r.LEAVE="LEAVE",r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.UID_BANNED="UID_BANNED",r.IP_BANNED="IP_BANNED",r.CHANNEL_BANNED="CHANNEL_BANNED",r.FALLBACK="FALLBACK",r.LICENSE_MISSING="LICENSE_MISSING",r.LICENSE_EXPIRED="LICENSE_EXPIRED",r.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",r.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",r.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",r.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(nn||(nn={})),function(r){r.CONNECTION_STATE_CHANGE="connection-state-change",r.MEDIA_RECONNECT_START="media-reconnect-start",r.MEDIA_RECONNECT_END="media-reconnect-end",r.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",r.USER_JOINED="user-joined",r.USER_LEAVED="user-left",r.USER_PUBLISHED="user-published",r.USER_UNPUBLISHED="user-unpublished",r.USER_INFO_UPDATED="user-info-updated",r.CLIENT_BANNED="client-banned",r.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",r.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",r.VOLUME_INDICATOR="volume-indicator",r.CRYPT_ERROR="crypt-error",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGED="stream-type-changed",r.STREAM_FALLBACK="stream-fallback",r.RECEIVE_METADATA="receive-metadata",r.STREAM_MESSAGE="stream-message",r.LIVE_STREAMING_ERROR="live-streaming-error",r.LIVE_STREAMING_WARNING="live-streaming-warning",r.INJECT_STREAM_STATUS="stream-inject-status",r.EXCEPTION="exception",r.ERROR="error",r.P2P_LOST="p2p_lost",r.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",r.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",r.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",r.PUBLISHED_USER_LIST="published-user-list",r.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",r.CONTENT_INSPECT_ERROR="content-inspect-error",r.CONTENT_INSPECT_RESULT="content-inspect-result"}($t||($t={})),function(r){r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.MULTI_IP="MULTI_IP",r.TIMEOUT="TIMEOUT",r.OFFLINE="OFFLINE",r.LEAVE="LEAVE",r.P2P_FAILED="P2P_FAILED",r.FALLBACK="FALLBACK"}(no||(no={})),function(r){r.CONNECTING="connecting",r.CONNECTED="connected",r.RECONNECTING="reconnecting",r.CLOSED="closed"}(dn||(dn={})),function(r){r.WS_CONNECTED="ws_connected",r.WS_RECONNECTING="ws_reconnecting",r.WS_CLOSED="ws_closed",r.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",r.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",r.ON_BINARY_DATA="on_binary_data",r.REQUEST_RECOVER="request_recover",r.REQUEST_JOIN_INFO="request_join_info",r.REQUEST_REJOIN_INFO="req_rejoin_info",r.IS_P2P_DISCONNECTED="is_p2p_dis",r.DISCONNECT_P2P="dis_p2p",r.ABORT_P2P_EXECUTION="abort_p2p_execution",r.NEED_RENEW_SESSION="need-sid",r.REPORT_JOIN_GATEWAY="report_join_gateway",r.REQUEST_TIMEOUT="request_timeout",r.REQUEST_SUCCESS="request_success",r.JOIN_RESPONSE="join_response",r.DATACHANNEL_PRECONNECT="datachannel_preconnect",r.DATACHANNEL_CONNECTING="datachannel_connecting",r.DATACHANNEL_FAILBACK="datachannel_failback"}(it||(it={})),function(r){r.PING="ping",r.PING_BACK="ping_back",r.JOIN="join_v3",r.REJOIN="rejoin_v3",r.LEAVE="leave",r.SET_CLIENT_ROLE="set_client_role",r.PUBLISH="publish",r.UNPUBLISH="unpublish",r.SUBSCRIBE="subscribe",r.SUBSCRIBE_STREAMS="subscribe_streams",r.UNSUBSCRIBE="unsubscribe",r.UNSUBSCRIBE_STREAMS="unsubscribe_streams",r.SUBSCRIBE_CHANGE="subscribe_change",r.TRAFFIC_STATS="traffic_stats",r.RENEW_TOKEN="renew_token",r.SWITCH_VIDEO_STREAM="switch_video_stream",r.DEFAULT_VIDEO_STREAM="default_video_stream",r.SET_FALLBACK_OPTION="set_fallback_option",r.GATEWAY_INFO="gateway_info",r.CONTROL="control",r.SEND_METADATA="send_metadata",r.DATA_STREAM="data_stream",r.PICK_SVC_LAYER="pick_svc_layer",r.RESTART_ICE="restart_ice",r.CONNECT_PC="connect_pc",r.SET_VIDEO_PROFILE="set_video_profile",r.SET_PARAMETER="set_parameter"}(Et||(Et={})),function(r){r.PUBLISH_STATS="publish_stats",r.PUBLISH_RELATED_STATS="publish_related_stats",r.SUBSCRIBE_STATS="subscribe_stats",r.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",r.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",r.DENOISER_STATS="denoiser_stats",r.TRANSPORT_STATS="transport_stats",r.EXTENSION_USAGE_STATS="extension_usage_stats"}(vo||(vo={})),function(r){r.ON_USER_ONLINE="on_user_online",r.ON_USER_OFFLINE="on_user_offline",r.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",r.ON_PUBLISH_STREAM="on_publish_stream",r.ON_UPLINK_STATS="on_uplink_stats",r.ON_P2P_LOST="on_p2p_lost",r.ON_REMOVE_STREAM="on_remove_stream",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",r.ON_USER_BANNED="on_user_banned",r.ON_USER_LICENSE_BANNED="on_user_license_banned",r.ON_NOTIFICATION="on_notification",r.ON_CRYPT_ERROR="on_crypt_error",r.MUTE_AUDIO="mute_audio",r.MUTE_VIDEO="mute_video",r.UNMUTE_AUDIO="unmute_audio",r.UNMUTE_VIDEO="unmute_video",r.ON_P2P_OK="on_p2p_ok",r.RECEIVE_METADATA="receive_metadata",r.ON_DATA_STREAM="on_data_stream",r.ENABLE_LOCAL_VIDEO="enable_local_video",r.DISABLE_LOCAL_VIDEO="disable_local_video",r.ENABLE_LOCAL_AUDIO="enable_local_audio",r.DISABLE_LOCAL_AUDIO="disable_local_audio",r.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Mt||(Mt={})),function(r){r.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",r.NEED_ANSWER="NEED_ANSWER",r.NEED_RENEGOTIATE="NEED_RENEGOTIATE",r.P2P_LOST="P2P_LOST",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NEED_UNPUB="NEED_UNPUB",r.NEED_UNSUB="NEED_UNSUB",r.NEED_UPLOAD="NEED_UPLOAD",r.NEED_CONTROL="NEED_CONTROL",r.START_RECONNECT="START_RECONNECT",r.END_RECONNECT="END_RECONNECT",r.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(Vx||(Vx={})),function(r){r.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",r.RECEIVE_TRACK_BUFFER="receive_track_buffer",r.ON_AUDIO_BUFFER="on_audio_buffer",r.UPDATE_SOURCE="update_source"}(So||(So={}));const iS={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},aS={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Gx={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},cH={uplinkNetworkQuality:0,downlinkNetworkQuality:0},zx={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let kt,Sr,Nu;(function(r){r.CONNECTED="websocket:connected",r.RECONNECTING="websocket:reconnecting",r.WILL_RECONNECT="websocket:will_reconnect",r.CLOSED="websocket:closed",r.FAILED="websocket:failed",r.ON_MESSAGE="websocket:on_message",r.REQUEST_NEW_URLS="websocket:request_new_urls",r.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",r.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"})(kt||(kt={})),function(r){r.TRANSCODE="mix_streaming",r.RAW="raw_streaming",r.INJECT="inject_streaming"}(Sr||(Sr={})),function(r){r[r.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",r[r.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",r[r.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",r[r.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",r[r.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",r[r.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",r[r.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",r[r.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",r[r.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",r[r.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",r[r.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Nu||(Nu={}));const uH={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},cS={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function uS(r,o){ms(r.url,"".concat(o,".url"),1,1e3,!1),Ln(r.x)||Nn(r.x,"".concat(o,".x"),0,1e4),Ln(r.y)||Nn(r.y,"".concat(o,".y"),0,1e4),Ln(r.width)||Nn(r.width,"".concat(o,".width"),0,1e4),Ln(r.height)||Nn(r.height,"".concat(o,".height"),0,1e4),Ln(r.zOrder)||Nn(r.zOrder,"".concat(o,".zOrder"),0,255),Ln(r.alpha)||Nn(r.alpha,"".concat(o,".alpha"),0,1,!1)}const lH={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},dH={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let Zi,wh,Zn,Hx,Vs,ka,ro,Au,Tr,Vn,cr,lE,yt,ts,lS,dS,Ou,Rh,Wt;function Kx(r){if(!r.channelName)throw new Q(K.INVALID_PARAMS,"invalid channelName in info");if(typeof r.uid!="number")throw new Q(K.INVALID_PARAMS,"invalid uid in info, uid must be a number");return r.token&&ms(r.token,"info.token",1,2047),nS(r.uid),tS(r.channelName),!0}function qx(r){return bs(r,"mediaSource",["screen","window","application"]),!0}(function(r){r.WARNING="@live_uap-warning",r.ERROR="@line_uap-error",r.PUBLISH_STREAM_STATUS="@live_uap-publish-status",r.INJECT_STREAM_STATUS="@live_uap-inject-status",r.WORKER_STATUS="@live_uap-worker-status",r.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(Zi||(Zi={})),function(r){r.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(wh||(wh={})),function(r){r[r.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",r[r.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",r[r.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",r[r.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",r[r.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",r[r.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",r[r.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",r[r.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",r[r.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",r[r.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",r[r.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",r[r.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",r[r.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",r[r.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",r[r.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",r[r.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Zn||(Zn={})),function(r){r.CONNECT_FAILED="connect failed",r.CONNECT_TIMEOUT="connect timeout",r.WS_DISCONNECTED="websocket disconnected",r.REQUEST_TIMEOUT="request timeout",r.REQUEST_FAILED="request failed",r.WAIT_STATUS_TIMEOUT="wait status timeout",r.WAIT_STATUS_ERROR="wait status error",r.BAD_STATE="bad state",r.WS_ABORT="ws abort",r.AP_REQUEST_TIMEOUT="AP request timeout",r.AP_JSON_PARSE_ERROR="AP json parse error",r.AP_REQUEST_ERROR="AP request error",r.AP_REQUEST_ABORT="AP request abort"}(Hx||(Hx={})),function(r){r[r.SetSdkProfile=0]="SetSdkProfile",r[r.SetSourceChannel=1]="SetSourceChannel",r[r.SetSourceUserId=2]="SetSourceUserId",r[r.SetDestChannel=3]="SetDestChannel",r[r.StartPacketTransfer=4]="StartPacketTransfer",r[r.StopPacketTransfer=5]="StopPacketTransfer",r[r.UpdateDestChannel=6]="UpdateDestChannel",r[r.Reconnect=7]="Reconnect",r[r.SetVideoProfile=8]="SetVideoProfile"}(Vs||(Vs={})),function(r){r.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",r.NETWORK_CONNECTED="NETWORK_CONNECTED",r.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",r.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",r.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",r.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",r.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",r.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",r.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",r.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(ka||(ka={})),function(r){r.RELAY_STATE_IDLE="RELAY_STATE_IDLE",r.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",r.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",r.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(ro||(ro={})),function(r){r.RELAY_OK="RELAY_OK",r.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",r.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",r.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(Au||(Au={})),function(r){r.High="high",r.Low="low",r.Audio="audio",r.Screen="screen",r.ScreenLow="screen_low"}(Tr||(Tr={})),function(r){r.DISCONNECT="disconnect",r.CONNECTION_STATE_CHANGE="connection-state-change",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGE="stream-type-change",r.IS_P2P_DISCONNECTED="is-p2p-dis",r.DISCONNECT_P2P="dis-p2p",r.REQUEST_NEW_GATEWAY_LIST="req-gate-url",r.NEED_RENEW_SESSION="need-sid",r.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",r.JOIN_RESPONSE="join-response",r.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",r.RESET_CONNECTION_EVENTS="reset-connection-events",r.DATACHANNEL_PRECONNECT="datachannel_preconnect",r.DATACHANNEL_FAILBACK="datachannel_failback",r.RESET_SIGNAL="reset-signal"}(Vn||(Vn={})),function(r){r[r.Nothing=0]="Nothing",r[r.Audio=1]="Audio",r[r.LwoVideo=2]="LwoVideo",r[r.Video=4]="Video",r[r.Data=8]="Data"}(cr||(cr={})),function(r){r[r.websocket=0]="websocket",r[r.datachannel=1]="datachannel"}(lE||(lE={})),function(r){r.NEED_RENEGOTIATE="@need_renegotiate",r.NEED_REPLACE_TRACK="@need_replace_track",r.NEED_CLOSE="@need_close",r.NEED_ENABLE_TRACK="@need_enable_track",r.NEED_DISABLE_TRACK="@need_disable_track",r.NEED_SESSION_ID="@need_sid",r.SET_OPTIMIZATION_MODE="@set_optimization_mode",r.GET_STATS="@get_stats",r.GET_LOW_VIDEO_TRACK="@get_low_video_track",r.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",r.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",r.NEED_MUTE_TRACK="@need_mute_track",r.NEED_UNMUTE_TRACK="@need_unmute_track"}(yt||(yt={})),function(r){r.SCREEN_TRACK="screen_track",r.LOW_STREAM="low_stream"}(ts||(ts={})),function(r){r[r.HIGH_STREAM=0]="HIGH_STREAM",r[r.LOW_STREAM=1]="LOW_STREAM"}(lS||(lS={})),function(r){r[r.DISABLE=0]="DISABLE",r[r.LOW_STREAM=1]="LOW_STREAM",r[r.AUDIO_ONLY=2]="AUDIO_ONLY"}(dS||(dS={})),function(r){r.SOURCE_STATE_CHANGE="source-state-change",r.TRACK_ENDED="track-ended",r.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",r.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",r.CLOSED="closed"}(Ou||(Ou={})),function(r){r.FIRST_FRAME_DECODED="first-frame-decoded",r.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(Rh||(Rh={})),function(r){r.CHINA="CHINA",r.ASIA="ASIA",r.NORTH_AMERICA="NORTH_AMERICA",r.EUROPE="EUROPE",r.JAPAN="JAPAN",r.INDIA="INDIA",r.KOREA="KOREA",r.HKMC="HKMC",r.US="US",r.OCEANIA="OCEANIA",r.SOUTH_AMERICA="SOUTH_AMERICA",r.AFRICA="AFRICA",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL",r.EXTENSIONS="EXTENSIONS"}(Wt||(Wt={}));const hH=[Wt.AFRICA,Wt.ASIA,Wt.CHINA,Wt.EUROPE,Wt.GLOBAL,Wt.INDIA,Wt.JAPAN,Wt.NORTH_AMERICA,Wt.OCEANIA,Wt.OVERSEA,Wt.SOUTH_AMERICA];let Hr;(function(r){r.CHINA="CN",r.ASIA="AS",r.NORTH_AMERICA="NA",r.EUROPE="EU",r.JAPAN="JP",r.INDIA="IN",r.KOREA="KR",r.HKMC="HK",r.US="US",r.OCEANIA="OC",r.SOUTH_AMERICA="SA",r.AFRICA="AF",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL",r.EXTENSIONS="GLOBAL"})(Hr||(Hr={}));const dE={CHINA:{},ASIA:{CODE:Hr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Hr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Hr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Hr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Hr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Hr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Hr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Hr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Hr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Hr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Hr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Hr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Hr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};let yf,Xx,Ot,Qe,xr,Jt,Ns,xu,_s,To,Zo,ei,Ir,rc,Hn;Hv&&(dE.CHINA={CODE:Hr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(r){r.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(yf||(yf={}));class hE extends Qn{constructor(o,a){super(),k(this,"onICEConnectionStateChange",void 0),k(this,"onConnectionStateChange",void 0),k(this,"onDTLSTransportStateChange",void 0),k(this,"onDTLSTransportError",void 0),k(this,"onICETransportStateChange",void 0),k(this,"onFirstAudioReceived",void 0),k(this,"onFirstVideoReceived",void 0),k(this,"onFirstAudioDecoded",void 0),k(this,"onFirstVideoDecoded",void 0),k(this,"onFirstVideoDecodedTimeout",void 0),k(this,"onSelectedLocalCandidateChanged",void 0),k(this,"onSelectedRemoteCandidateChanged",void 0),k(this,"establishPromise",void 0)}}(function(r){r.SEND="sendonly",r.RECV="recvonly",r.SENDRECV="sendrecv",r.INACTIVE="inactive"})(Xx||(Xx={})),function(r){r.VIDEO="video",r.AUDIO="audio"}(Ot||(Ot={})),function(r){r.LocalVideoTrack="videoTrack",r.LocalAudioTrack="audioTrack",r.LocalVideoLowTrack="videoLowTrack"}(Qe||(Qe={})),function(r){r.New="new",r.Connected="connected",r.Reconnecting="reconnecting",r.Disconnected="disconnected"}(xr||(xr={})),function(r){r.StateChange="stateChange",r.IceConnectionStateChange="iceConnectionStateChange",r.RequestMuteLocal="requestMuteLocal",r.RequestUnmuteLocal="requestUnmuteLocal",r.RequestRePublish="requestRePublish",r.RequestReSubscribe="requestReSubscribe",r.RequestUploadStats="requestUploadStats",r.MediaReconnectStart="MediaReconnectStart",r.MediaReconnectEnd="MediaReconnectEnd",r.NeedSignalRTT="NeedSignalRTT",r.RequestRestartICE="RequestRestartIce",r.PeerConnectionStateChange="PeerConnectionStateChange",r.RequestReconnect="RequestReconnect",r.RequestReconnectPC="RequestReconnectPC",r.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",r.P2PLost="P2PLost",r.UpdateVideoEncoder="UpdateVideoEncoder",r.ConnectionTypeChange="ConnectionTypeChange",r.RequestLowStreamParameter="RequestLowStreamParameter",r.QueryClientConnectionState="QueryClientConnectionState"}(Jt||(Jt={})),function(r){r.ONLINE="ONLINE",r.OFFLINE="OFFLINE"}(Ns||(Ns={})),function(r){r.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",r.ONLINE="ONLINE",r.OFFLINE="OFFLINE"}(xu||(xu={})),function(r){r.ON_TRACK="on_track",r.ON_NODE="on_node"}(_s||(_s={})),function(r){r.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",r.REQUEST_CONSTRAINTS="request_constraints"}(To||(To={})),function(r){r.CONNECTING="CONNECTING",r.RECONNECTING="RECONNECTING",r.CONNECTED="CONNECTED",r.CLOSED="CLOSED"}(Zo||(Zo={})),function(r){r[r.CONNECT_AP=0]="CONNECT_AP",r[r.AP_CONNECTED=1]="AP_CONNECTED",r[r.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",r[r.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",r[r.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",r[r.CONNECT_WORKER=5]="CONNECT_WORKER",r[r.WORKER_CONNECTED=6]="WORKER_CONNECTED",r[r.CLOSED=7]="CLOSED"}(ei||(ei={})),function(r){r.CONNECTION_STATE_CHANGE="connection-state-change",r.STATE_CHANGE="state-change",r.INSPECT_RESULT="inspect-result",r.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",r.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Ir||(Ir={})),function(r){r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.MULTI_IP="MULTI_IP",r.TIMEOUT="TIMEOUT",r.OFFLINE="OFFLINE",r.LEAVE="LEAVE",r.P2P_FAILED="P2P_FAILED",r.FALLBACK="FALLBACK"}(rc||(rc={})),function(r){r.CONNECTED="transmitter:connected",r.RECONNECTING="transmitter:reconnecting",r.WILL_RECONNECT="transmitter:will_reconnect",r.CLOSED="transmitter:closed",r.FAILED="transmitter:failed",r.ON_MESSAGE="transmitter:on_message",r.REQUEST_NEW_URLS="transmitter:request_new_urls",r.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",r.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",r.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",r.FAILBACK="transmitter:failback"}(Hn||(Hn={}));const Bs={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1};function ns(){return Bs}let $r;(function(r){r[r.CHOOSE_SERVER=11]="CHOOSE_SERVER",r[r.CLOUD_PROXY=18]="CLOUD_PROXY",r[r.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",r[r.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})($r||($r={}));var pH=ke,vf=Array.isArray||function(r){return pH(r)=="Array"},fH=I,Yx=vf,mH=Wy,gH=Kt,EH=Mr("species"),Jx=fH.Array,_H=function(r){var o;return Yx(r)&&(o=r.constructor,(mH(o)&&(o===Jx||Yx(o.prototype))||gH(o)&&(o=o[EH])===null)&&(o=void 0)),o===void 0?Jx:o},Qx=function(r,o){return new(_H(r))(o===0?0:o)},yH=x,vH=nt,SH=vi,TH=Su,IH=Qx,Zx=_([].push),ku=function(r){var o=r==1,a=r==2,u=r==3,h=r==4,g=r==6,E=r==7,S=r==5||g;return function(T,C,w,N){for(var M,U,Y=SH(T),X=vH(Y),J=yH(C,w),fe=TH(X),ge=0,Ue=N||IH,lt=o?Ue(T,fe):a||E?Ue(T,0):void 0;fe>ge;ge++)if((S||ge in X)&&(U=J(M=X[ge],ge,Y),r))if(o)lt[ge]=U;else if(U)switch(r){case 3:return!0;case 5:return M;case 6:return ge;case 2:Zx(lt,M)}else switch(r){case 4:return!1;case 7:Zx(lt,M)}return g?-1:u||h?h:lt}},ek={forEach:ku(0),map:ku(1),filter:ku(2),some:ku(3),every:ku(4),find:ku(5),findIndex:ku(6),filterReject:ku(7)},CH=ek.forEach,tk=gy("forEach")?[].forEach:function(r){return CH(this,r,arguments.length>1?arguments[1]:void 0)};Zs({target:"Array",proto:!0,forced:[].forEach!=tk},{forEach:tk});var wH=Tu("Array").forEach,RH=Cu,bH=fs,NH=y,AH=wH,hS=Array.prototype,OH={DOMTokenList:!0,NodeList:!0},xH=function(r){var o=r.forEach;return r===hS||NH(hS,r)&&o===hS.forEach||bH(OH,RH(r))?AH:o},kH=vi,nk=Ry;Zs({target:"Object",stat:!0,forced:i(function(){nk(1)})},{keys:function(r){return nk(kH(r))}});var DH=sn.Object.keys,PH=lN,LH=Zs,MH=vf,$H=_([].reverse),rk=[1,2];LH({target:"Array",proto:!0,forced:String(rk)===String(rk.reverse())},{reverse:function(){return MH(this)&&(this.length=this.length),$H(this)}});var FH=Tu("Array").reverse,UH=y,VH=FH,pS=Array.prototype,BH=function(r){var o=r.reverse;return r===pS||UH(pS,r)&&o===pS.reverse?VH:o},jH=i,WH=Wr,GH=Mr("species"),sk=function(r){return WH>=51||!jH(function(){var o=[];return(o.constructor={})[GH]=function(){return{foo:1}},o[r](Boolean).foo!==1})},zH=Zs,HH=I,ok=vf,KH=Wy,qH=Kt,ik=Sy,XH=Su,YH=St,JH=Xv,QH=Mr,ZH=Gy,eK=sk("slice"),tK=QH("species"),fS=HH.Array,nK=Math.max;zH({target:"Array",proto:!0,forced:!eK},{slice:function(r,o){var a,u,h,g=YH(this),E=XH(g),S=ik(r,E),T=ik(o===void 0?E:o,E);if(ok(g)&&(a=g.constructor,(KH(a)&&(a===fS||ok(a.prototype))||qH(a)&&(a=a[tK])===null)&&(a=void 0),a===fS||a===void 0))return ZH(g,S,T);for(u=new(a===void 0?fS:a)(nK(T-S,0)),h=0;S<T;S++,h++)S in g&&JH(u,h,g[S]);return u.length=h,u}});var rK=Tu("Array").slice,sK=y,oK=rK,mS=Array.prototype,iK=function(r){var o=r.slice;return r===mS||sK(mS,r)&&o===mS.slice?oK:o};function Ne(r,o,a,u,h){var g,E,S,T={};return xH(g=DH(u)).call(g,function(C){T[C]=u[C]}),T.enumerable=!!T.enumerable,T.configurable=!!T.configurable,("value"in T||T.initializer)&&(T.writable=!0),T=PH(E=BH(S=iK(a).call(a)).call(S)).call(E,function(C,w){return w(r,o,C)||C},T),h&&T.initializer!==void 0&&(T.value=T.initializer?T.initializer.call(h):void 0,T.initializer=void 0),T.initializer===void 0&&(qO(r,o,T),T=null),T}var aK=Tu("Array").keys,cK=Cu,uK=fs,lK=y,dK=aK,gS=Array.prototype,hK={DOMTokenList:!0,NodeList:!0},ql=function(r){var o=r.keys;return r===gS||lK(gS,r)&&o===gS.keys||uK(hK,cK(r))?dK:o};function ak(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function ck(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?ak(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):ak(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}let pE=0,ES=0;function Da(r,o,a,u){return new Je((h,g)=>{o.timeout=o.timeout||de("HTTP_CONNECT_TIMEOUT"),o.responseType=o.responseType||"json",o.data&&!a?(o.data=JSON.stringify(o.data),pE+=xh(o.data)):a&&(o.data.size?pE+=o.data.size:o.data instanceof FormData?pE+=function(E){let S=0;return/DingTalk/i.test(navigator.userAgent)&&E.realFormData&&(E=E.realFormData),E.forEach(T=>{S+=typeof T=="string"?xh(T):T.size}),S+138}(o.data):pE+=xh(JSON.stringify(o.data))),o.headers=o.headers||{},o.headers["Content-Type"]=o.headers["Content-Type"]||"application/json",o.method="POST",o.url=r,Ji.request(o).then(E=>{typeof E.data=="string"?ES+=xh(E.data):E.data instanceof ArrayBuffer||E.data instanceof Uint8Array?ES+=E.data.byteLength:ES+=xh(JSON.stringify(E.data)),u&&h({data:E.data,headers:E.headers}),h(E.data)}).catch(E=>{Ji.isCancel(E)?g(new Q(K.OPERATION_ABORTED,"cancel token canceled")):E.code==="ECONNABORTED"?g(new Q(K.NETWORK_TIMEOUT,E.message)):E.response?g(new Q(K.NETWORK_RESPONSE_ERROR,E.response.status)):g(new Q(K.NETWORK_ERROR,E.message))})})}async function pK(r,o){const a=new Blob([o.data],{type:"buffer"});return await Da(r,ck(ck({},o),{},{data:a,headers:{"Content-Type":"application/octet-stream"}}),!0)}const ur=new class extends Qn{set networkState(r){F.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+r),this.emit(xu.NETWORK_STATE_CHANGE,r,this._networkState),r===Ns.ONLINE?this.emit(xu.ONLINE):r===Ns.OFFLINE&&(this.onlineWaiter=new Je(o=>{this.once(xu.ONLINE,()=>{this.onlineWaiter=void 0,o(Ns.ONLINE)})}),this.emit(xu.OFFLINE)),this._networkState=r}get networkState(){return this._networkState}constructor(){super(),k(this,"_moduleName","network-indicator"),k(this,"_networkState",Ns.ONLINE),k(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Ns.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ns.OFFLINE})}};let _S=!1;const ti=new class extends Qn{constructor(){super(...arguments),k(this,"onAutoplayFailed",void 0),k(this,"onAudioAutoplayFailed",void 0)}};function uk(){if(Sn(),!_S){const r=o=>{o.preventDefault(),_S=!1,hf()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};_S=!0,hf()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),F.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ti.onAutoplayFailed?ti.onAutoplayFailed():ti.onAudioAutoplayFailed?F.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):F.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ti.emit("autoplay-failed")}}function yS(r){return new TextEncoder().encode(r)}const lk=function(r,o){const a=new Uint8Array(r.byteLength+o.byteLength);return a.set(new Uint8Array(r),0),a.set(new Uint8Array(o),r.byteLength),a},fK=async r=>function(o,a){let u="";return new Uint8Array(o).forEach(h=>{u+=h.toString(a).padStart(2,"0")}),u}(await crypto.subtle.digest("SHA-256",yS(r)),16);function dk(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function Dt(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?dk(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):dk(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}function pt(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(o,a,u){const h=u.value;if(typeof h=="function"){const g=r.className||o.__className__||(o.constructor.name==="AgoraRTCClient"?"Client":o.constructor.name);u.value=function(){for(var E=arguments.length,S=new Array(E),T=0;T<E;T++)S[T]=arguments[T];let C=S;if(r.argsMap)try{C=r.argsMap(this,...S)}catch(N){F.warning(N),C=[]}try{JSON.stringify(C)}catch{F.warning("arguments for method ".concat(g,".").concat(a," not serializable for apiInvoke.")),C=[]}const w=(r.report||at).reportApiInvoke(this._sessionId||null,{name:"".concat(g,".").concat(a),options:C,tag:jn.TRACER,reportResult:r.reportResult},r.throttleTime);try{const N=h.apply(this,S);return N instanceof Je?N.then(M=>(w.onSuccess(r.reportResult&&M),M)).catch(M=>{throw w.onError(M),M}):(w.onSuccess(r.reportResult&&N),N)}catch(N){throw w.onError(N),N}}}return u}}const at=new class{constructor(){k(this,"baseInfoMap",new Map),k(this,"proxyServer",void 0),k(this,"clientList",Ih),k(this,"eventUploadTimer",void 0),k(this,"setSessionIdTimer",void 0),k(this,"url",void 0),k(this,"backupUrl",void 0),k(this,"_appId",void 0),k(this,"keyEventUploadPendingItems",[]),k(this,"normalEventUploadPendingItems",[]),k(this,"apiInvokeUploadPendingItems",[]),k(this,"apiInvokeCount",0),k(this,"ltsList",[]),k(this,"lastSendNormalEventTime",Date.now()),k(this,"customReportCounterTimer",void 0),k(this,"customReportCount",0),k(this,"extApiInvoke",async r=>{for(const o of r){const a=Dt(Dt({},o),{},{sid:null,invokeId:++this.apiInvokeCount,tag:jn.TRACER});this.sendApiInvoke(a)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),de("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),de("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(r){if(!this.baseInfoMap.has(r)&&!this.baseInfoMap.get(r))return void F.error("adjust session ".concat(r," start time, sid is not exist or info is undefined"));const o=this.baseInfoMap.get(r),a=Date.now(),u=o.startTime;o.startTime=a,F.debug("rewrite session ".concat(r," startTime: ").concat(a," , ").concat(a-u,"ms")),this.baseInfoMap.set(r,o)}setAppId(r){this._appId=r}reportApiInvoke(r,o,a){o.timeout=o.timeout||6e4,o.reportResult=o.reportResult===void 0||o.reportResult;const u=Date.now();this.apiInvokeCount+=1;const h=this.apiInvokeCount,g=()=>({tag:o.tag,invokeId:h,sid:r,name:o.name,apiInvokeTime:u,options:o.options,states:o.states||null}),E=!!de("SHOW_REPORT_INVOKER_LOG");E&&F.info("".concat(o.name," start"),o.options);let S=!1;vs(o.timeout).then(()=>{S||(this.sendApiInvoke(Dt(Dt({},g()),{},{error:K.API_INVOKE_TIMEOUT,success:!1})),F.debug("".concat(o.name," timeout")))});const T=new Q(K.UNEXPECTED_ERROR,"".concat(o.name,": this api invoke is end"));return{onSuccess:C=>{const w=()=>{if(S)throw T;return S=!0,this.sendApiInvoke(Dt(Dt({},g()),{},{success:!0},o.reportResult&&{result:C})),E&&F.info("".concat(o.name," onSuccess")),C};return a?I3(w,o.name+"Success",a,()=>S=!0):w()},onError:C=>{const w=()=>{if(S)throw C;S=!0,this.sendApiInvoke(Dt(Dt({},g()),{},{success:!1,error:C})),E&&F.info("".concat(o.name," onFailure"),C.toString())};return a?I3(w,o.name+"Error",a,()=>S=!0):w()}}}sessionInit(r,o){if(this.baseInfoMap.has(r))return;const a=Date.now(),u=this.createBaseInfo(r,a);u.cname=o.cname;const h=Object.assign({},{willUploadConsoleLog:de("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Hv?"global":"oversea",areas:de("AREAS")&&de("AREAS").join(",")},o.extend),g=Date.now(),E=Dt(Dt({},u),{},{eventType:gs.SESSION_INIT,appid:o.appid,browser:navigator.userAgent,build:zv,lts:g,elapse:g-a,extend:JSON.stringify(h),mode:o.mode,process:de("PROCESS_ID"),appType:de("APP_TYPE"),success:!0,version:wi});this.send({type:zn.SESSION,data:E},!0)}joinChooseServer(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info,h=Date.now(),g=Dt(Dt({},u),{},{eventType:gs.JOIN_CHOOSE_SERVER,lts:h,eventElapse:h-o.lts,chooseServerAddr:o.csAddr,errorCode:o.ec,elapse:h-a.startTime,success:o.succ,chooseServerAddrList:JSON.stringify(o.serverList),uid:o.uid?parseInt(o.uid):null,cid:o.cid?parseInt(o.cid):null,chooseServerIp:o.csIp||"",opid:o.opid,unilbsServerIds:o.unilbsServerIds,extend:o.extend||void 0,isHttp3:o.isHttp3});this.send({type:zn.JOIN_CHOOSE_SERVER,data:g},!0)}reqUserAccount(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info,h=Date.now(),g=Dt(Dt({},u),{},{eventType:gs.REQ_USER_ACCOUNT,lts:h,success:o.success,serverAddress:o.serverAddr,stringUid:o.stringUid,uid:o.uid,errorCode:o.errorCode,elapse:h-a.startTime,eventElapse:h-o.lts,extend:JSON.stringify(o.extend)});this.send({type:zn.REQ_USER_ACCOUNT,data:g},!0)}joinGateway(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info;o.vid&&(u.vid=o.vid),u.uid=o.uid,u.cid=o.cid;const h=Date.now(),{firstSuccess:g,avoidJoinStartTime:E,isProxy:S,addr:T}=o,C=h-(g&&E?E:a.startTime),w=Dt(Dt({},u),{},{eventType:gs.JOIN_GATEWAY,lts:h,gatewayAddr:o.addr,success:o.succ,errorCode:o.ec,elapse:C,eventElapse:h-o.lts,firstSuccess:g,signalChannel:o.signalChannel}),N=w.success?1:0;if(o.succ&&(a.lastJoinSuccessTime=h),g)this.send({type:zn.JOIN_GATEWAY,data:w},!0);else{let M;if(T)if(S){const Y=T.match(/h=(\d{1,3}-){3}\d{1,3}/g),X=T.match(/p=[0-9]{1,6}/g);M={isSuccess:N,gatewayIp:Y&&Y.length?Y[0].split("=")[1].replace(/-/g,"."):"",port:X&&X.length?X[0].split("=")[1]:"",isProxy:S?1:0}}else{const Y=T.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),X=T.match(/:[0-9]{1,6}/g);M={isSuccess:N,gatewayIp:Y&&Y.length?Y[0].split("//")[1].replace(/-/g,"."):"",port:X&&X.length?X[0].split(":")[1]:"",isProxy:S?1:0}}else M={isSuccess:N,gatewayIp:"",port:"",isProxy:S?1:0};delete w.success,delete w.eventType,delete w.firstSuccess,w.vid=Number(w.vid);const U=Object.assign({},w,M,{eventType:gs.REJOIN_GATEWAY});this.send({type:zn.RE_JOIN_GATEWAY,data:U},!0)}}joinChannelTimeout(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=Date.now(),h=Dt(Dt({},a.info),{},{lts:u,timeout:o,elapse:u-a.startTime});this.send({type:zn.JOIN_CHANNEL_TIMEOUT,data:h},!0)}publish(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info,h=Date.now(),g=Dt(Dt({},u),{},{eventType:gs.PUBLISH,lts:h,eventElapse:o.eventElapse,elapse:h-a.startTime,success:o.succ,errorCode:o.ec,videoName:o.videoName,audioName:o.audioName,screenName:o.screenName,screenshare:o.screenshare,audio:o.audio,video:o.video,p2pid:o.p2pid,publishRequestid:o.publishRequestid});this.send({type:zn.PUBLISH,data:g},!0)}subscribe(r,o,a){const u=this.baseInfoMap.get(r);if(!u)return;const h=u.info,g=Date.now(),E=Dt(Dt({},h),{},{eventType:gs.SUBSCRIBE,lts:g,eventElapse:o.eventElapse,elapse:g-u.startTime,success:o.succ,errorCode:o.ec,video:o.video,audio:o.audio,subscribeRequestid:o.subscribeRequestid,p2pid:o.p2pid},a&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof o.peerid=="string"?E.peerSuid=o.peerid:E.peer=o.peerid,this.send({type:zn.SUBSCRIBE,data:E},!0)}wsCompressorInit(r){var o;const a=[...ql(o=this.baseInfoMap).call(o)],u=a.length?a[0]:"UnableToGetSid",h=this.baseInfoMap.get(u);if(!h)return;const g=h.info,E=Date.now(),S=Dt(Dt({},g),{},{eventType:gs.WS_COMPRESSOR_INIT,lts:E,eventElapse:r.eventElapse,elapse:E-h.startTime,status:r.status?1:2});this.send({type:zn.WS_COMPRESSOR_INIT,data:S},!0)}firstRemoteVideoDecode(r,o,a,u){const h=this.baseInfoMap.get(r);if(!h)return;const g=h.info,E=Date.now(),S=Dt(Dt(Dt({},g),u),{},{elapse:E-h.startTime,eventType:o,lts:E,firstDecodeFrame:Math.max(E-h.startTime,0),apEnd:Math.max(u.apEnd-h.startTime,0),apStart:Math.max(u.apStart-h.startTime,0),joinGwEnd:Math.max(u.joinGwEnd-h.startTime,0),joinGwStart:Math.max(u.joinGwStart-h.startTime,0),pcEnd:Math.max(u.pcEnd-h.startTime,0),pcStart:Math.max(u.pcStart-h.startTime,0),subscriberEnd:Math.max(u.subscriberEnd-h.startTime,0),subscriberStart:Math.max(u.subscriberStart-h.startTime,0),videoAddNotify:Math.max(u.videoAddNotify-h.startTime,0)});this.send({type:a,data:S},!0)}firstRemoteFrame(r,o,a,u){const h=this.baseInfoMap.get(r);if(!h)return;const g=h.info,E=Date.now(),S=Dt(Dt(Dt({},g),u),{},{elapse:E-h.startTime,eventType:o,lts:E});this.send({type:a,data:S},!0)}onGatewayStream(r,o,a,u){const h=this.baseInfoMap.get(r);if(!h)return;const g=h.info,E=Date.now(),S=Dt(Dt(Dt({},g),u),{},{eventType:o,lts:E});this.send({type:a,data:S},!0)}streamSwitch(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info,h=Date.now(),g=Dt(Dt({},u),{},{eventType:gs.STREAM_SWITCH,lts:h,isDual:o.isdual,elapse:h-a.startTime,success:o.succ});this.send({type:zn.STREAM_SWITCH,data:g},!0)}requestProxyAppCenter(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info,h=Date.now(),g=Dt(Dt({},u),{},{eventType:gs.REQUEST_PROXY_APPCENTER,lts:h,eventElapse:h-o.lts,elapse:h-a.startTime,APAddr:o.APAddr,workerManagerList:o.workerManagerList,response:o.response,errorCode:o.ec,success:o.succ});this.send({type:zn.REQUEST_PROXY_APPCENTER,data:g},!0)}requestProxyWorkerManager(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info,h=Date.now(),g=Dt(Dt({},u),{},{eventType:gs.REQUEST_PROXY_WORKER_MANAGER,lts:h,eventElapse:h-o.lts,elapse:h-a.startTime,workerManagerAddr:o.workerManagerAddr,response:o.response,errorCode:o.ec,success:o.succ});this.send({type:zn.REQUEST_PROXY_WORKER_MANAGER,data:g},!0)}setProxyServer(r){this.proxyServer=r,r?F.debug("reportProxyServerurl: ".concat(r)):F.debug("disable reportProxyServerurl: ".concat(r))}peerPublishStatus(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info,h=Date.now(),g=Dt(Dt({},u),{},{subscribeElapse:o.subscribeElapse,peer:o.peer,peerPublishDuration:Math.max(o.audioPublishDuration,o.videoPublishDuration),audiotag:o.audioPublishDuration>0?1:-1,videotag:o.videoPublishDuration>0?1:-1,lts:h,elapse:h-a.startTime,joinChannelSuccessElapse:h-(a.lastJoinSuccessTime||h),peerPublishDurationVideo:o.videoPublishDuration,peerPublishDurationAudio:o.audioPublishDuration});this.send({type:zn.PEER_PUBLISH_STATUS,data:g},!0)}workerEvent(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info,h=Date.now();(function(g,E,S){const T=g[E];if(!T||typeof T!="string")return[g];g[E]="";const C=xh(JSON.stringify(g));let w=0;const N=[];let M=0;for(let U=0;U<T.length;U++)M+=T.charCodeAt(U)<=127?1:3,M<=S-C||(N[N.length]=Jl(Jl({},g),{},{[E]:T.substring(w,U)}),w=U,M=T.charCodeAt(U)<=127?1:3);return w!==T.length-1&&(N[N.length]=Jl(Jl({},g),{},{[E]:T.substring(w)})),N})(Dt(Dt(Dt({},u),o),{},{elapse:h-a.startTime,lts:h,productType:"WebRTC"}),"payload",1300).forEach(g=>this.send({type:zn.WORKER_EVENT,data:g},!0))}apworkerEvent(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info,h=Date.now(),g=Dt(Dt(Dt({},u),o),{},{elapse:h-a.startTime,lts:h});this.send({type:zn.AP_WORKER_EVENT,data:g},!0)}joinWebProxyAP(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info,h=Date.now(),g=Dt(Dt(Dt({},u),o),{},{elapse:h-a.startTime,lts:h,extend:o.extend||void 0});this.send({type:zn.JOIN_WEB_PROXY_AP,data:g},!0)}WebSocketQuit(r,o){const a=this.baseInfoMap.get(r);if(!a)return;const u=a.info,h=Date.now(),g=Dt(Dt(Dt({},u),o),{},{elapse:h-a.startTime,lts:h});this.send({type:zn.WEBSOCKET_QUIT,data:g},!0)}async sendCustomReportMessage(r,o){if(this.customReportCount+=o.length,this.customReportCount>de("CUSTOM_REPORT_LIMIT"))throw new Q(K.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const a=Date.now(),u=o.map(h=>({type:zn.USER_ANALYTICS,data:Dt(Dt({sid:r},h),{},{lts:a})}));try{de("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(u):await this.postDataToStatsCollector(u)}catch(h){throw F.error("send custom report message failed",h.toString()),new Q(K.CUSTOM_REPORT_SEND_FAILED,h.message)}}autoplayFailed(r,o,a,u){if(!r)return;const h=this.baseInfoMap.get(r);if(!h)return;const g=h.info,E=Date.now(),S=Dt(Dt({},g),{},{vid:g.vid===void 0?0:Number(g.vid),lts:E,elapse:E-h.startTime,cbRegistered:ti.onAutoplayFailed||ti.onAudioAutoplayFailed?1:-1,errorMsg:a,mediaType:o,trackId:u,extend:void 0});this.send({type:zn.AUTOPLAY_FAILED,data:S},!0)}sendApiInvoke(r){const o=de("NOT_REPORT_EVENT");if(r.tag&&o.includes&&o.includes(r.tag))return!1;if(r.sid===null)return this.apiInvokeUploadPendingItems.push(r),!1;const a=this.baseInfoMap.get(r.sid);if(!a)return this.apiInvokeUploadPendingItems.push(r),!1;const{cname:u,uid:h,cid:g}=a.info;r.lts=r.lts||Date.now();let E;if(r.error)if(r.error instanceof Q){const{code:T,message:C}=r.error;E=T||C||r.error.toString()}else E=r.error.toString();const S={invokeId:r.invokeId,sid:r.sid,cname:u,cid:g,uid:h,lts:r.lts,success:r.success,elapse:r.lts-a.startTime,execElapse:r.lts-r.apiInvokeTime,apiName:r.name,options:r.options?JSON.stringify(r.options):void 0,execStates:r.states?JSON.stringify(r.states):void 0,execResult:r.result?JSON.stringify(r.result):void 0,errorCode:r.error?E:void 0,errorMsg:r.error?JSON.stringify(r.error):void 0};return this.send({type:zn.API_INVOKE,data:S},!1),!0}appendSessionId(){this.clientList.forEach(r=>{if(r._sessionId){const o=this.apiInvokeUploadPendingItems.length;for(let a=0;a<o;a++){const u=this.apiInvokeUploadPendingItems.shift();u&&(u.sid=r._sessionId,this.sendApiInvoke(Object.assign({},u)))}}})}send(r,o){if(o)return this.keyEventUploadPendingItems.push(r),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(r),this.normalEventUploadPendingItems.length>de("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(r,o){const a=[],u=[];for(;r.length;){const g=r.shift();a.length<20?a.push(g):u.push(g)}r.push(...u);for(const g of[...a]){var h;this.ltsList.indexOf(g.data.lts)!==-1?(g.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(g.data.lts)):(this.ltsList.push(g.data.lts),Zv(h=this.ltsList).call(h,(E,S)=>E-S))}return o||(this.lastSendNormalEventTime=Date.now()),de("ENABLE_EVENT_REPORT")&&a.length&&(de("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(a):this.postDataToStatsCollector(a)).catch((g=>E=>{de("EVENT_REPORT_RETRY")&&(o?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(g):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(g),this.normalEventUploadPendingItems.length>de("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-de("NORMAL_EVENT_QUEUE_CAPACITY")),F.warning("report: drop normal events"))))})(a)),r}async postDataToStatsCollector2(r){ur.networkState===Ns.OFFLINE&&await Je.race([ur.onlineWaiter,vs(2*Or.maxRetryTimeout)]);const o=h=>{let g=new Uint8Array;return h.forEach(E=>{const S=yS(JSON.stringify(E.data)),T=new ArrayBuffer(5),C=(N=>{let M=0;return Object.entries(zn).forEach(U=>{let[Y,X]=U;X===N.type&&(M=sS[Y])}),M})(E),w=new DataView(T);w.setUint16(0,S.byteLength,!0),w.setUint8(2,255&C),w.setUint8(3,C>>>8&255),w.setUint8(4,C>>>16&255),g=lk(g,new Uint8Array(T)),g=lk(g,S)}),g},a="event";let u=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(de("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(a):"https://".concat(de("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(a);for(let h=0;h<2;h+=1){h===1&&(u=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(de("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(a):"https://".concat(de("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(a));try{await Da(u,{timeout:1e4,data:o(r),headers:Dt(Dt({token:"32f24ab2ddb74f508aa9286c356cec84",biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(g){if(h===1)throw g;continue}return}}async postDataToStatsCollector(r){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const a={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:r.map(g=>JSON.stringify(g)),vid:(g=>{const E=g&&g.data.sid&&this.baseInfoMap.get(g.data.sid);return E&&E.info.vid&&+E.info.vid||0})(r[0])};ur.networkState===Ns.OFFLINE&&await Je.race([ur.onlineWaiter,vs(2*Or.maxRetryTimeout)]);const u=o?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(de("EVENT_REPORT_DOMAIN"),"&p=").concat(de("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(de("EVENT_REPORT_DOMAIN"),":").concat(de("STATS_COLLECTOR_PORT")).concat(u));for(let g=0;g<2;g+=1){g===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(de("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(de("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(de("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(de("STATS_COLLECTOR_PORT")).concat(u)));try{o?await pK(h,{timeout:1e4,data:a}):await Da(h,{timeout:1e4,data:a})}catch(E){if(g===1)throw E;continue}return}}createBaseInfo(r,o){const a=Object.assign({},iH);return a.sid=r,this.baseInfoMap.set(r,{info:a,startTime:o}),a}reportResourceTiming(r,o){const a=performance.getEntriesByName(r),u=a[a.length-1];u&&this.reportApiInvoke(o,{name:"Client.resourceTiming",options:u,tag:jn.TRACER}).onSuccess()}};iE.on("REPORT_LOG_UPLOAD",r=>{r.networkState=ur.networkState,at.reportApiInvoke(null,{name:"logUploadError",options:r,tag:jn.TRACER})});class hk extends Qn{constructor(o,a){super(),k(this,"trackMediaType",void 0),k(this,"_ID",void 0),k(this,"_hints",[]),k(this,"_isClosed",!1),k(this,"_originMediaStreamTrack",void 0),k(this,"_mediaStreamTrack",void 0),k(this,"_external",{}),this._ID=a||Kn(8,"track-"),this._originMediaStreamTrack=o,this._mediaStreamTrack=o,function(u){mf.includes(u)||mf.push(u)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(o){if(!o){const a=at.reportApiInvoke(null,{name:vr.GET_MEDIA_STREAM_TRACK,options:[],tag:jn.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?a.onSuccess(this._mediaStreamTrack.label):a.onSuccess("")}return this._mediaStreamTrack}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,function(o){const a=mf.indexOf(o);a!==-1&&mf.splice(a,1)}(this),this.emit(Ou.CLOSED)}}let Fr,mK=1;class js{constructor(o){k(this,"lockingPromise",Je.resolve()),k(this,"locks",0),k(this,"name",""),k(this,"lockId",void 0),this.lockId=mK++,o&&(this.name=o),F.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(o){let a;this.locks+=1,F.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof o=="string"?o:""));const u=new Je(g=>{a=()=>{this.locks-=1,F.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof o=="string"?o:"")),g()}}),h=this.lockingPromise.then(()=>a);return this.lockingPromise=this.lockingPromise.then(()=>u),h}}function bh(r,o){return function(a,u,h){const g=h.value;if(typeof g!="function")throw new Error("Cannot use mutex on object property.");return h.value=async function(){const E=this[o];if(!E)throw new Error("mutex property key ".concat(o," doesn't exist on ").concat(r));const S=await E.lock("From ".concat(r,".").concat(u));try{for(var T=arguments.length,C=new Array(T),w=0;w<T;w++)C[w]=arguments[w];return await g.apply(this,C)}finally{S()}},h}}class vS extends hk{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}constructor(o,a){super(o,a),k(this,"_enabled",!0),k(this,"_muted",!1),k(this,"_isExternalTrack",!1),k(this,"_isClosed",!1),k(this,"_enabledMutex",void 0),k(this,"processor",void 0),k(this,"processorContext",void 0),k(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new js("".concat(a)),o.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var o,a;return(o=(a=this._originMediaStreamTrack)===null||a===void 0?void 0:a.label)!==null&&o!==void 0?o:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,F.debug("[".concat(this.getTrackId(),"] close")),this.emit(yt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(o,a){let u=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=u,o!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),a&&this._originMediaStreamTrack.stop(),o.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=o,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,yt.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){F.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(Ou.TRACK_ENDED)}stateCheck(o,a){if(F.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(o,": ").concat(a,"]")),gf(a,o),this._enabled&&this._muted&&o==="enabled"&&a===!1)throw new Q(K.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&o==="muted"&&a===!0)throw new Q(K.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function pk(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}(function(r){r.IOS_15_INTERRUPTION_START="ios15-interruption-start",r.IOS_15_INTERRUPTION_END="ios15-interruption-end",r.IOS_INTERRUPTION_START="ios-interruption-start",r.IOS_INTERRUPTION_END="ios-interruption-end",r.STATE_CHANGE="state-change"})(Fr||(Fr={}));const fk=window.AudioContext||window.webkitAudioContext;let Ri=null;const Gt=new class extends Qn{constructor(){super(...arguments),k(this,"prevState",void 0),k(this,"curState",void 0),k(this,"currentTime",void 0),k(this,"currentTimeStuckAt",void 0),k(this,"interruptDetectorTrack",void 0),k(this,"onLocalAudioTrackMute",()=>{F.info("ios15-interruption-start"),this.emit(Fr.IOS_15_INTERRUPTION_START)}),k(this,"onLocalAudioTrackUnmute",async()=>{F.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?F.info("ios15-interruption-end-canceled"):(Ri&&await Ri.suspend(),this.emit(Fr.IOS_15_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(r){F.debug("webaudio bindInterruptDetectorTrack ".concat(r.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=r,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(r){F.debug("webaudio unbindInterruptDetectorTrack ".concat(r.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===r&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function gK(){if(!fk)return void F.error("your browser is not support web audio");F.info("create audio context");const r=function(o){for(var a=1;a<arguments.length;a++){var u=arguments[a]!=null?arguments[a]:{};a%2?pk(Object(u),!0).forEach(function(h){k(o,h,u[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(u)):pk(Object(u)).forEach(function(h){Object.defineProperty(o,h,Object.getOwnPropertyDescriptor(u,h))})}return o}({},de("WEBAUDIO_INIT_OPTIONS"));F.debug("audio context init option:",JSON.stringify(r)),Ri=new fk(r),Gt.curState=Ri.state,Ri.onstatechange=()=>{Gt.prevState=Gt.curState,Gt.curState=Ri?Ri.state:void 0,(eo()||xc())&&Gt.prevState==="running"&&Gt.curState==="interrupted"&&(F.info("ios-interruption-start"),Gt.emit(Fr.IOS_INTERRUPTION_START)),(eo()||xc())&&Gt.prevState==="interrupted"&&Gt.curState==="running"&&(F.info("ios-interruption-end"),Gt.emit(Fr.IOS_INTERRUPTION_END)),Gt.prevState!==Gt.curState&&(F.debug("AudioContext State Change","".concat(Gt.prevState,"=>").concat(Gt.curState)),Gt.emit(Fr.STATE_CHANGE))},setInterval(()=>{var o;const a=(o=Ri)===null||o===void 0?void 0:o.currentTime;Gt.currentTime!==a?(Gt.currentTimeStuckAt&&(F.debug("AudioContext current time resume at ".concat(a)),Gt.currentTimeStuckAt=void 0),Gt.currentTime=a):(a!==Gt.currentTimeStuckAt&&(at.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:a},tag:jn.TRACER}).onSuccess(),F.warning("AudioContext current time stuck at ".concat(a))),Gt.currentTimeStuckAt=a)},5e3),async function(o){const a=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let u,h=!1,g=!1,E=!1;function S(J){o.state==="running"?T(!1):eo()||xc()?o.state==="suspended"&&(T(!0),J&&o.resume().then(w,w)):o.state!=="closed"&&(T(!0),J&&o.resume().then(w,w))}function T(J){if(h!==J){h=J;for(let fe=0,ge=a;fe<ge.length;fe+=1){const Ue=ge[fe];J?window.addEventListener(Ue,N,{capture:!0,passive:!0}):window.removeEventListener(Ue,N,{capture:!0,passive:!0})}}}function C(){S(!0)}function w(){S(!1)}function N(){S(!0)}function M(J){if(!E)if(u.paused)if(J){U(!1),E=!0;let fe;try{fe=u.play(),fe?fe.then(Y,Y):(u.addEventListener("playing",Y),u.addEventListener("abort",Y),u.addEventListener("error",Y))}catch{Y()}}else U(!0);else U(!1)}function U(J){if(g!==J){g=J;for(let fe=0,ge=a;fe<ge.length;fe++){const Ue=ge[fe];J?window.addEventListener(Ue,X,{capture:!0,passive:!0}):window.removeEventListener(Ue,X,{capture:!0,passive:!0})}}}function Y(){u.removeEventListener("playing",Y),u.removeEventListener("abort",Y),u.removeEventListener("error",Y),E=!1,M(!1)}function X(){M(!0)}if(eo()){const J=o.createMediaStreamDestination(),fe=document.createElement("div");fe.innerHTML="<audio x-webkit-airplay='deny'></audio>",u=fe.children.item(0),u.controls=!1,u.disableRemotePlayback=!0,u.preload="auto",u.srcObject=J.stream,M(!0)}Gt.on(Fr.STATE_CHANGE,C),S(!1)}(Ri)}function Nh(){if(!Ri){if(gK(),!Ri)throw new Q(K.NOT_SUPPORTED,"can not create audio context");return Ri}return Ri}function Xl(r){if(function(){if(SS!==null)return SS;const u=Nh(),h=u.createBufferSource(),g=u.createGain(),E=u.createGain();h.connect(g),h.connect(E),h.disconnect(g);let S=!1;try{h.disconnect(g)}catch{S=!0}return h.disconnect(),SS=S,S}())return;const o=r.connect,a=r.disconnect;r.connect=(u,h,g)=>(r._inputNodes||(r._inputNodes=[]),r._inputNodes.includes(u)||(u instanceof AudioNode?(r._inputNodes.push(u),o.call(r,u,h,g)):o.call(r,u,h)),r),r.disconnect=(u,h,g)=>{a.call(r),u?bS(r._inputNodes,u):r._inputNodes=[];for(const E of r._inputNodes)o.call(r,E)}}let SS=null;function mk(r,o){let a=!1;const u=1/o;if(de("DISABLE_WEBAUDIO")){const h=window.setInterval(()=>{a?window.clearInterval(h):r(performance.now()/1e3)},1e3*u)}else{const h=Nh();let g=h.createGain();g.gain.value=0,g.connect(h.destination);const E=()=>{if(a)return void(g=null);const S=h.createOscillator();S.onended=E,S.connect(g),S.start(0),S.stop(h.currentTime+u),r(h.currentTime)};E()}return()=>{a=!0}}class gk{constructor(){k(this,"context",void 0),k(this,"analyserNode",void 0),k(this,"sourceNode",void 0),this.context=Nh(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(o){if(o!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=o,o==null||o.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||eo()||xc()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const o=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(o);else{const u=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(u);for(let h=0;h<o.length;++h)o[h]=u[h]/128-1}const a=Iu(o).call(o,(u,h)=>u+h*h,0)/o.length;return Math.max(10*Math.log10(a)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var o,a;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(a=this.sourceNode)===null||a===void 0||a.connect(this.analyserNode)}catch{F.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class Ek extends Qn{get processSourceNode(){return this.sourceNode}set processedNode(o){var a;if(!this.isDestroyed&&this._processedNode!==o){try{var u;(u=this.sourceNode)===null||u===void 0||u.disconnect(this.outputNode)}catch{}(a=this._processedNode)===null||a===void 0||a.disconnect(),this._processedNode=o,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),k(this,"outputNode",void 0),k(this,"outputTrack",void 0),k(this,"isPlayed",!1),k(this,"sourceNode",void 0),k(this,"context",void 0),k(this,"audioBufferNode",void 0),k(this,"destNode",void 0),k(this,"audioOutputLevel",0),k(this,"volumeLevelAnalyser",void 0),k(this,"_processedNode",void 0),k(this,"playNode",void 0),k(this,"isDestroyed",!1),k(this,"onNoAudioInput",void 0),k(this,"isNoAudioInput",!1),k(this,"_noAudioInputCount",0),this.context=Nh(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Xl(this.outputNode),this.volumeLevelAnalyser=new gk}startGetAudioBuffer(o){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(o),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=a=>{this.emit(So.ON_AUDIO_BUFFER,function(u){for(let h=0;h<u.outputBuffer.numberOfChannels;h+=1){const g=u.outputBuffer.getChannelData(h);for(let E=0;E<g.length;E+=1)g[E]=0}return u.inputBuffer}(a))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ns().webAudioMediaStreamDest)throw new Q(K.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(o){this.context.state!=="running"&&ta(()=>{Gt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=o||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(o>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;eo()||xc()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const a=this.volumeLevelAnalyser.getAnalyserNode();let u;a.getFloatTimeDomainData?(u=new Float32Array(a.fftSize),a.getFloatTimeDomainData(u)):(u=new Uint8Array(a.fftSize),a.getByteTimeDomainData(u));let h=!1;for(let g=0;g<u.length;g++)u[g]!==0&&(h=!0);return h?(this.isNoAudioInput=!1,!0):(await vs(200),await this.checkHasAudioInput(o?o+1:1)&&h)}getAudioVolume(){return this.outputNode.gain.value}setVolume(o){this.outputNode.gain.setValueAtTime(o,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var o,a;(o=this.processedNode)===null||o===void 0||o.disconnect(),(a=this.sourceNode)===null||a===void 0||a.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var o;this.processedNode?(o=this.processedNode)===null||o===void 0||o.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class _k extends Ek{get isFreeze(){return!1}constructor(o,a,u){var h;if(super(),k(this,"sourceNode",void 0),k(this,"track",void 0),k(this,"clonedTrack",void 0),k(this,"audioElement",void 0),k(this,"isCurrentTrackCloned",!1),k(this,"isRemoteTrack",!1),k(this,"originVolumeLevelAnalyser",void 0),k(this,"rebuildWebAudio",async()=>{if(F.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void F.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>F.info("resume success")),F.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const S=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?S.stop():this.isCurrentTrackCloned=!0;const T=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(T),Xl(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const C=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(C,this.context.currentTime),Xl(this.outputNode),this.emit(So.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=T,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),o.kind!=="audio")throw new Q(K.UNEXPECTED_ERROR);this.track=o;const g=new MediaStream([this.track]);if(this.isRemoteTrack=!!a,this.sourceNode=this.context.createMediaStreamSource(g),Xl(this.sourceNode),u){const S=u.clone();S.enabled=!0,this.clonedTrack=S,F.debug("create an unmuted track ".concat(S.id," from the original track ").concat(u.id," to get the volume"));const T=this.context.createMediaStreamSource(new MediaStream([S]));Xl(T),this.originVolumeLevelAnalyser=new gk,this.originVolumeLevelAnalyser.updateSource(T)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=g;const E=Sn();a&&E.os===Rs.IOS&&Number((h=E.osVersion)===null||h===void 0?void 0:h.split(".")[0])<15&&(Gt.on(Fr.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(S=>{S||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(o){this.sourceNode.disconnect(),this.track=o,this.isCurrentTrackCloned=!1;const a=new MediaStream([o]);this.sourceNode=this.context.createMediaStreamSource(a),Xl(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(So.UPDATE_SOURCE),this.audioElement.srcObject=a}destroy(){var o;this.audioElement.srcObject=null,this.audioElement.remove(),Gt.off("state-change",this.rebuildWebAudio),(o=this.originVolumeLevelAnalyser)===null||o===void 0||o.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(o){return this.context.createMediaStreamSource(new MediaStream([o]))}updateOriginTrack(o){const a=o.clone();a.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=a),F.debug("create an unmuted track ".concat(a.id," from the original track ").concat(o.id," to get the volume"));const u=this.context.createMediaStreamSource(new MediaStream([a]));Xl(u),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(u)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function yk(r,o){const a=(h,g)=>h?typeof h!="number"?h.max||h.exact||h.ideal||h.min||g:h:g,u={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxHeight:a(o.height,1080),maxWidth:a(o.width,1920)}}};return o.frameRate&&typeof o.frameRate!="number"?(u.video.mandatory.maxFrameRate=o.frameRate.max,u.video.mandatory.minFrameRate=o.frameRate.min):typeof o.frameRate=="number"&&(u.video.mandatory.maxFrameRate=o.frameRate),await navigator.mediaDevices.getUserMedia(u)}async function EK(r){const o=await vk(r.mediaSource),a=await function(u){return new Je((h,g)=>{const E=document.createElement("div");E.innerText="share screen",E.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const T=document.createElement("div");T.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",T.setAttribute("style","height: 12%;");const C=document.createElement("div");C.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const w=document.createElement("div");w.setAttribute("style","text-align: right; padding: 16px 0;");const N=document.createElement("button");N.innerHTML="cancel",N.setAttribute("style","width: 85px;"),N.onclick=()=>{document.body.removeChild(M);const U=new Error("NotAllowedError");U.name="NotAllowedError",g(U)},w.appendChild(N),S.appendChild(T),S.appendChild(C),S.appendChild(w);const M=document.createElement("div");M.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),M.appendChild(E),M.appendChild(S),document.body.appendChild(M),u.map(U=>{if(U.id){const Y=document.createElement("div");Y.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let X=U.thumbnail;const{width:J}=X.getSize();J>1920&&(X=X.resize({width:1920})),Y.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+X.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(U.name.replace(/[\u00A0-\u9999<>\&]/g,function(fe){return"&#"+fe.charCodeAt(0)+";"})+"</span>"),Y.onclick=()=>{document.body.removeChild(M),h(U.id)},C.appendChild(Y)}})})}(o);return await yk(a,r)}async function vk(r){let o=["window","screen"];r!=="application"&&r!=="window"||(o=["window"]),r==="screen"&&(o=["screen"]);const a=Sk();if(!a)throw new Q(K.ELECTRON_IS_NULL);let u=null;try{var h;u=((h=a.desktopCapturer)===null||h===void 0?void 0:h.getSources({types:o}))||a.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:o})}catch{u=null}u&&u.then||(u=new Je((g,E)=>{a.desktopCapturer.getSources({types:o},(S,T)=>{S?E(S):g(T)})}));try{return await u}catch(g){throw new Q(K.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,g.toString())}}let fE=null;function Sk(){if(fE)return fE;try{return fE=window.require("electron"),fE}catch{return null}}const TS=new js("safari");let Tk=!1,Ik=!1;async function ea(r,o){let a=0,u=null;for(;a<2;)try{u=await _K(r,o,a>0);break}catch(h){if(h instanceof Q)throw F.error("[".concat(o,"] ").concat(h.toString())),h;const g=mE(h.name||h.code||h,h.message);if(g.code===K.MEDIA_OPTION_INVALID){F.debug("[".concat(o,"] detect media option invalid, retry")),a+=1,await vs(500);continue}throw F.error("[".concat(o,"] ").concat(g.toString())),g}if(!u)throw new Q(K.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return u}async function _K(r,o,a){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Q(K.NOT_SUPPORTED,"can not find getUserMedia");a&&(r.video&&(delete r.video.width,delete r.video.height),r.screen&&(delete r.screen.width,delete r.screen.height));const u=ns(),h=new MediaStream;if(r.audioSource&&h.addTrack(r.audioSource),r.videoSource&&h.addTrack(r.videoSource),!r.audio&&!r.video&&!r.screen)return F.debug("Using Video Source/ Audio Source"),h;if(r.screen)if(Sk())r.screen.sourceId?Ah(h,await yk(r.screen.sourceId,r.screen)):Ah(h,await EK(r.screen));else if(wv()&&r.screen.extensionId&&r.screen.mandatory){if(!u.getStreamFromExtension)throw new Q(K.NOT_SUPPORTED,"This browser does not support screen sharing");F.debug("[".concat(o,'] Screen access on chrome stable, looking for extension"'));const N=await(g=r.screen.extensionId,E=o,new Je((M,U)=>{try{chrome.runtime.sendMessage(g,{getStream:!0},Y=>{if(!Y||!Y.streamId)return F.error("[".concat(E,"] No response from Chrome Plugin. Plugin not installed properly"),Y),void U(new Q(K.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));M(Y.streamId)})}catch(Y){F.error("[".concat(E,"] AgoraRTC screensharing plugin is not accessible(").concat(g,")"),Y.toString()),U(new Q(K.CHROME_PLUGIN_NOT_INSTALL))}}));r.screen.mandatory.chromeMediaSourceId=N,Ah(h,await navigator.mediaDevices.getUserMedia({video:{mandatory:r.screen.mandatory}}))}else if(u.getDisplayMedia){r.screen.mediaSource&&qx(r.screen.mediaSource);const N={width:r.screen.width,height:r.screen.height,frameRate:r.screen.frameRate,displaySurface:r.screen.mediaSource==="screen"?"monitor":r.screen.mediaSource};F.debug("[".concat(o,"] getDisplayMedia:"),JSON.stringify({video:N,audio:!!r.screenAudio})),Ah(h,await navigator.mediaDevices.getDisplayMedia({video:N,audio:!!r.screenAudio}))}else{if(!Jn())throw F.error("[".concat(o,"] This browser does not support screenSharing")),new Q(K.NOT_SUPPORTED,"This browser does not support screen sharing");{r.screen.mediaSource&&qx(r.screen.mediaSource);const N={video:{mediaSource:r.screen.mediaSource,width:r.screen.width,height:r.screen.height,frameRate:r.screen.frameRate}};F.debug("[".concat(o,"] getUserMedia: ").concat(JSON.stringify(N))),Ah(h,await navigator.mediaDevices.getUserMedia(N))}}var g,E;if(!r.video&&!r.audio)return h;let S={video:r.video,audio:r.audio},T=de("MEDIA_DEVICE_CONSTRAINTS");if(T)try{typeof T=="string"&&(T=JSON.parse(T)),S=function N(M,U){if(!C3(M)||!C3(U)||Array.isArray(M)&&!Array.isArray(U)||!Array.isArray(M)&&Array.isArray(U))return U;if(Array.isArray(U)&&Array.isArray(M)){const Y=[...M];for(let X=0;X<U.length;X++)Y[X]=N(M[X],U[X]);return Y}{const Y=Jl({},M);for(const X in U)Object.prototype.hasOwnProperty.call(U,X)&&(Object.prototype.hasOwnProperty.call(M,X)?Y[X]=N(M[X],U[X]):Y[X]=U[X]);return Y}}(S,T)}catch{}F.debug("[".concat(o,"] GetUserMedia"),JSON.stringify(S)),Sn();let C,w=null;(Vo()||eo()||Jg())&&(w=await TS.lock());try{C=await navigator.mediaDevices.getUserMedia(S)}catch(N){throw w&&w(),N}return S.audio&&(Tk=!0),S.video&&(Ik=!0),Ah(h,C),w&&w(),h}function mE(r,o){switch(r){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Q(K.MEDIA_OPTION_INVALID,"".concat(r,": ").concat(o));case"NotFoundError":case"DevicesNotFoundError":return new Q(K.DEVICE_NOT_FOUND,"".concat(r,": ").concat(o));case"NotSupportedError":return new Q(K.NOT_SUPPORTED,"".concat(r,": ").concat(o));case"NotReadableError":return new Q(K.NOT_READABLE,"".concat(r,": ").concat(o));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Q(K.PERMISSION_DENIED,"".concat(r,": ").concat(o));case"ConstraintNotSatisfiedError":return new Q(K.CONSTRAINT_NOT_SATISFIED,"".concat(r,": ").concat(o));default:return F.error("getUserMedia unexpected error",r),new Q(K.UNEXPECTED_ERROR,"".concat(r,": ").concat(o))}}function Ah(r,o){const a=r.getVideoTracks()[0],u=r.getAudioTracks()[0],h=o.getVideoTracks()[0],g=o.getAudioTracks()[0];g&&(u&&r.removeTrack(u),r.addTrack(g)),h&&(a&&r.removeTrack(a),r.addTrack(h))}const ni=new class extends Qn{get state(){return this._state}set state(r){r!==this._state&&(this.emit(Pc.STATE_CHANGE,r),this._state=r)}constructor(){super(),k(this,"_state",Kl.IDLE),k(this,"isAccessMicrophonePermission",!1),k(this,"isAccessCameraPermission",!1),k(this,"lastAccessMicrophonePermission",!1),k(this,"lastAccessCameraPermission",!1),k(this,"checkdeviceMatched",!1),k(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(de("ENUMERATE_DEVICES_INTERVAL")||bv()&&Gl())&&this.updateDevicesInfo()},de("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(r=>F.error(r.toString()))}async enumerateDevices(r,o){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Q(K.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const u=await navigator.mediaDevices.enumerateDevices(),h=this.checkMediaDeviceInfoIsOk(u);let g=!this.isAccessMicrophonePermission&&r,E=!this.isAccessCameraPermission&&o;h.audio&&(g=!1),h.video&&(E=!1);let S=null,T=null,C=null;if(!a&&(g||E)){if(TS.isLocked&&(F.debug("[device manager] wait GUM lock"),(await TS.lock())(),F.debug("[device manager] GUM unlock")),Tk&&(g=!1,this.isAccessMicrophonePermission=!0),Ik&&(E=!1,this.isAccessCameraPermission=!0),F.debug("[device manager] check media device permissions",r,o,g,E),g&&E){try{C=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(w){const N=mE(w.name||w.code||w,w.message);if(N.code===K.PERMISSION_DENIED)throw N;F.warning("getUserMedia failed in getDevices",N)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(g){try{S=await navigator.mediaDevices.getUserMedia({audio:r})}catch(w){const N=mE(w.name||w.code||w,w.message);if(N.code===K.PERMISSION_DENIED)throw N;F.warning("getUserMedia failed in getDevices",N)}this.isAccessMicrophonePermission=!0}else if(E){try{T=await navigator.mediaDevices.getUserMedia({video:o})}catch(w){const N=mE(w.name||w.code||w,w.message);if(N.code===K.PERMISSION_DENIED)throw N;F.warning("getUserMedia failed in getDevices",N)}this.isAccessCameraPermission=!0}F.debug("[device manager] mic permission",r,"cam permission",o)}try{const w=await navigator.mediaDevices.enumerateDevices();return S&&S.getTracks().forEach(N=>N.stop()),T&&T.getTracks().forEach(N=>N.stop()),C&&C.getTracks().forEach(N=>N.stop()),S=null,T=null,C=null,w}catch(w){return S&&S.getTracks().forEach(N=>N.stop()),T&&T.getTracks().forEach(N=>N.stop()),C&&C.getTracks().forEach(N=>N.stop()),S=null,T=null,C=null,new Q(K.ENUMERATE_DEVICES_FAILED,w.toString()).throw()}}async getRecordingDevices(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,r)).filter(o=>o.kind==="audioinput")}async getCamerasDevices(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,r)).filter(o=>o.kind==="videoinput")}async getSpeakers(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,r)).filter(o=>o.kind==="audiooutput")}searchDeviceIdByName(r){let o=null;return this.deviceInfoMap.forEach(a=>{a.device.label===r&&(o=a.device.deviceId)}),o}async getDeviceById(r){const o=(await this.enumerateDevices(!0,!0,!0)).find(a=>a.deviceId===r);if(!o)throw new Q(K.DEVICE_NOT_FOUND,"deviceId: ".concat(r));return o}async init(){this.state=Kl.INITING;try{await this.updateDevicesInfo(),this.state=Kl.INITEND}catch(r){throw F.warning("Device Detection functionality cannot start properly.",r.toString()),this.state=Kl.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new Q(K.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),r}}async updateDevicesInfo(){const r=await this.enumerateDevices(!0,!0,!0),o=Date.now(),a=[];if(r[0]&&r[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const h=r.find(E=>E.kind==="audioinput"&&E.deviceId==="default"),g=r.find(E=>E.kind==="audiooutput"&&E.deviceId==="default");h&&g?g.groupId===h.groupId?F.debug("[device-check] default input ".concat(h.label," and output ").concat(g.label," is the same group")):F.warning("[device-check] default input ".concat(h.label," and output ").concat(g.label," is not the same group")):F.debug("[device-check] default input or output not found")}const u=this.checkMediaDeviceInfoIsOk(r);if(r.forEach(h=>{if(!h.deviceId)return;const g=this.deviceInfoMap.get("".concat(h.kind,"_").concat(h.deviceId));if((g?g.state:"INACTIVE")!=="ACTIVE"){const E={initAt:o,updateAt:o,device:h,state:"ACTIVE"};this.deviceInfoMap.set("".concat(h.kind,"_").concat(h.deviceId),E),a.push(E)}g&&(g.updateAt=o)}),this.deviceInfoMap.forEach((h,g)=>{h.state==="ACTIVE"&&h.updateAt!==o&&(h.state="INACTIVE",a.push(h))}),this.state!==Kl.INITEND)return u.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(u.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));a.forEach(h=>{switch(h.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Pc.RECORDING_DEVICE_CHANGED,h);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Pc.CAMERA_DEVICE_CHANGED,h);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Pc.PLAYOUT_DEVICE_CHANGED,h)}}),u.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),u.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(r){const o=r.filter(h=>h.kind==="audioinput"),a=r.filter(h=>h.kind==="videoinput"),u={audio:!1,video:!1};for(const h of o)if(h.label&&h.deviceId){u.audio=!0;break}for(const h of a)if(h.label&&h.deviceId){u.video=!0;break}return u}},yK=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Bo=new class{constructor(){k(this,"onAutoplayFailed",void 0),k(this,"elementMap",new Map),k(this,"elementStateMap",new Map),k(this,"elementsNeedToResume",[]),k(this,"sinkIdMap",new Map),k(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(r=>{let[o,a]=r;const u=this.elementStateMap.get(o),h=a.srcObject.getAudioTracks()[0];fh()?h&&h.readyState==="live"&&Gt.curState==="running"&&(F.debug("auto resume after interruption for iOS 15"),a.pause(),a.play()):u&&u==="paused"&&h&&h.readyState==="live"&&Gt.curState==="running"&&(F.debug("auto resume after interruption for iOS"),a.play())})}),k(this,"autoResumeAfterInterruptionOnIOS15",()=>{Array.from(this.elementMap.entries()).forEach(r=>{let[o,a]=r;const u=a.srcObject.getAudioTracks()[0];u&&u.readyState==="live"&&(F.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),a.pause(),a.play())})}),this.autoResumeAudioElement(),Gt.on(Fr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Gt.on(Fr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),Gt.on(Fr.STATE_CHANGE,()=>{eo()&&Gt.prevState==="suspended"&&Gt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(r,o){const a=this.elementMap.get(r);if(this.sinkIdMap.set(r,o),a)try{await a.setSinkId(o)}catch(u){throw new Q(K.PERMISSION_DENIED,"can not set sink id: "+u.toString())}}play(r,o,a,u){if(this.elementMap.has(o))return;const h=document.createElement("audio");h.autoplay=!0,h.srcObject=new MediaStream([r]),this.bindAudioElementEvents(o,h),this.elementMap.set(o,h),this.elementStateMap.set(o,as.INIT),this.setVolume(o,a);const g=this.sinkIdMap.get(o);if(g)try{h.setSinkId(g).catch(S=>{F.warning("[".concat(o,"] set sink id failed"),S.toString())})}catch(S){F.warning("[".concat(o,"] set sink id failed"),S.toString())}const E=h.play();E&&E.then&&E.catch(S=>{u&&at.autoplayFailed(u,"audio",S.message,o),F.warning("audio element play warning",S.toString()),this.elementMap.has(o)&&S.name==="NotAllowedError"&&(F.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(h),ta(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),uk()}))})}updateTrack(r,o){const a=this.elementMap.get(r);a&&(a.srcObject=new MediaStream([o]))}isPlaying(r){return this.elementMap.has(r)}setVolume(r,o){const a=this.elementMap.get(r);a&&(o=Math.max(0,Math.min(100,o)),a.volume=o/100)}stop(r){const o=this.elementMap.get(r);if(this.sinkIdMap.delete(r),!o)return;const a=this.elementsNeedToResume.indexOf(o);this.elementsNeedToResume.splice(a,1),o.srcObject=null,o.remove(),this.elementMap.delete(r),this.elementStateMap.delete(r)}bindAudioElementEvents(r,o){yK.forEach(a=>{o.addEventListener(a,u=>{const h=this.elementStateMap.get(r),g=u.type==="pause"?"paused":u.type;if(F.debug("[".concat(r,"] audio-element-status change ").concat(h," => ").concat(g)),u.type==="error"){const E=o==null?void 0:o.error;E&&F.error("[".concat(r,"] media error, code: ").concat(E.code,", message: ").concat(E.message))}this.elementStateMap.set(r,g)})})}getPlayerState(r){return this.elementStateMap.get(r)||"uninit"}autoResumeAudioElement(){const r=()=>{this.elementsNeedToResume.forEach(o=>{o.play().then(a=>{F.debug("Auto resume audio element success")}).catch(a=>{F.warning("Auto resume audio element failed!",a)})}),this.elementsNeedToResume=[]};new Je(o=>{document.body?o():window.addEventListener("load",()=>o())}).then(()=>{hf()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0))})}};function or(){return function(r,o,a){const u=a.value;return typeof u=="function"&&(a.value=function(){this._isClosed&&new Q(K.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var h=arguments.length,g=new Array(h),E=0;E<h;E++)g[E]=arguments[E];const S=u.apply(this,g);return S instanceof Je?new Je((T,C)=>{S.then(T).catch(C)}):S}),a}}var Ck,wk,Rk,bk,Nk,Ak,Ok,xk,kk,Dk,Pk,Lk,Mk,$k,Fk,Uk,Vk,Bk,kn,jk,Wk,Gk,zk,Hk,Kk,sc,qk,Xk,Yk,Jk,Qk,Zk,e3,t3,n3,r3,Io,vK=Tu("Array").values,SK=Cu,TK=fs,IK=y,CK=vK,IS=Array.prototype,wK={DOMTokenList:!0,NodeList:!0},oc=function(r){var o=r.values;return r===IS||IK(IS,r)&&o===IS.values||TK(wK,SK(r))?CK:o};function s3(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function gE(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?s3(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):s3(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}class o3 extends Qn{constructor(o){super(),k(this,"name","VideoProcessorDestination"),k(this,"ID","0"),k(this,"_source",void 0),k(this,"videoContext",void 0),k(this,"inputTrack",void 0),this.videoContext=o}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Q(K.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Q(K.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(o){if(o.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);o.track&&o.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=o.track,this.emit(_s.ON_TRACK,o.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(_s.ON_TRACK,void 0)}}class i3 extends Qn{set chained(o){this._chained=o}get chained(){return this._chained}constructor(o,a){super(),k(this,"constraintsMap",new Map),k(this,"statsRegistry",[]),k(this,"usageRegistry",[]),k(this,"trackId",void 0),k(this,"direction",void 0),k(this,"_chained",!1),this.trackId=o,this.direction=a}async getConstraints(){return await Ss(this,To.REQUEST_CONSTRAINTS)}async requestApplyConstraints(o,a){var u;return F.info("processor ".concat(a.name," requestApplyConstraints for ").concat(this.trackId)),o&&this.constraintsMap.set(a,o),er(this,To.REQUEST_UPDATE_CONSTRAINTS,Array.from(oc(u=this.constraintsMap).call(u)))}async requestRevertConstraints(o){var a;if(this.constraintsMap.has(o))return F.info("processor ".concat(o.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(o),er(this,To.REQUEST_UPDATE_CONSTRAINTS,Array.from(oc(a=this.constraintsMap).call(a)))}registerStats(o,a,u){this.statsRegistry.find(h=>h.processorID===o.ID&&h.processorName===o.name&&h.type===a)||this.statsRegistry.push({processorName:o.name,processorID:o.ID,type:a,cb:u})}unregisterStats(o,a){const u=this.statsRegistry.findIndex(h=>h.processorID===o.ID&&h.processorName===o.name&&h.type===a);u!==-1&&this.statsRegistry.splice(u,1)}gatherStats(){const o=[];for(const{processorID:a,processorName:u,type:h,cb:g}of this.statsRegistry)try{const E=g();o.push({processorID:a,processorName:u,type:h,stats:E})}catch(E){F.error(new Q(K.UNEXPECTED_ERROR,E.message))}return o}registerUsage(o,a){this.usageRegistry.find(u=>u.processorID===o.ID&&u.processorName===o.name)||this.usageRegistry.push({processorID:o.ID,processorName:o.name,cb:a})}unregisterUsage(o){const a=this.usageRegistry.findIndex(u=>u.processorID===o.ID&&u.processorName===o.name);a!==-1&&this.usageRegistry.splice(a,1)}async gatherUsage(){const o=[];if(!this.chained)return[];for(const{cb:a}of this.usageRegistry)try{let u=a();u instanceof Je&&(u=await u),o.push(gE(gE({},u),{},{direction:this.direction}))}catch(u){F.error("gather extension usage error",u)}return o}getDirection(){return this.direction}}class a3 extends Qn{constructor(o){super(),k(this,"name","AudioProcessorDestination"),k(this,"ID","0"),k(this,"inputTrack",void 0),k(this,"inputNode",void 0),k(this,"audioProcessorContext",void 0),k(this,"_source",void 0),this.audioProcessorContext=o}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Q(K.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Q(K.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(_s.ON_TRACK,void 0),this.emit(_s.ON_NODE,void 0)}updateInput(o){if(o.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);o.track&&this.inputTrack!==o.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=o.track,this.emit(_s.ON_TRACK,this.inputTrack)),o.node&&this.inputNode!==o.node&&(this.audioProcessorContext.chained=!0,this.inputNode=o.node,this.emit(_s.ON_NODE,this.inputNode))}}class c3 extends Qn{set chained(o){this._chained=o}get chained(){return this._chained}constructor(o,a,u){super(),k(this,"constraintsMap",new Map),k(this,"statsRegistry",[]),k(this,"audioContext",void 0),k(this,"trackId",void 0),k(this,"direction",void 0),k(this,"usageRegistry",[]),k(this,"_chained",!1),this.audioContext=o,this.trackId=a,this.direction=u}async getConstraints(){return Ss(this,To.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(o,a){var u;return F.info("processor ".concat(a.name," requestApplyConstraints for ").concat(this.trackId)),o&&this.constraintsMap.set(a,o),er(this,To.REQUEST_UPDATE_CONSTRAINTS,Array.from(oc(u=this.constraintsMap).call(u)))}async requestRevertConstraints(o){var a;if(this.constraintsMap.has(o))return this.constraintsMap.delete(o),er(this,To.REQUEST_UPDATE_CONSTRAINTS,Array.from(oc(a=this.constraintsMap).call(a)))}registerStats(o,a,u){this.statsRegistry.find(h=>h.processorID===o.ID&&h.processorName===o.name&&h.type===a)||this.statsRegistry.push({processorName:o.name,processorID:o.ID,type:a,cb:u})}unregisterStats(o,a){const u=this.statsRegistry.findIndex(h=>h.processorID===o.ID&&h.processorName===o.name&&h.type===a);u!==-1&&this.statsRegistry.splice(u,1)}gatherStats(){const o=[];for(const{processorID:a,processorName:u,type:h,cb:g}of this.statsRegistry)try{const E=g();o.push({processorID:a,processorName:u,type:h,stats:E})}catch(E){F.error(new Q(K.UNEXPECTED_ERROR,E.message))}return o}registerUsage(o,a){this.usageRegistry.find(u=>u.processorID===o.ID&&u.processorName===o.name)||this.usageRegistry.push({processorID:o.ID,processorName:o.name,cb:a})}unregisterUsage(o){const a=this.usageRegistry.findIndex(u=>u.processorID===o.ID&&u.processorName===o.name);a!==-1&&this.usageRegistry.splice(a,1)}async gatherUsage(){const o=[];if(!this.chained)return[];for(const{cb:a}of this.usageRegistry)try{let u=a();u instanceof Je&&(u=await u),o.push(gE(gE({},u),{},{direction:this.direction}))}catch(u){F.error("gather extension usage error",u)}return o}getDirection(){return this.direction}}class u3 extends Qn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),k(this,"context",void 0),k(this,"processSourceNode",void 0),k(this,"outputTrack",void 0),k(this,"processedNode",void 0),k(this,"clonedTrack",void 0),k(this,"outputNode",void 0),this.outputNode=new RK}setVolume(){}createOutputTrack(){throw new Q(K.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class RK{disconnect(){}connect(){}}function l3(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function CS(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?l3(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):l3(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}let ys=(Ck=pt({argsMap:(r,o)=>[r.getTrackId(),o],throttleTime:300}),wk=pt({argsMap:(r,o)=>[r.getTrackId(),o]}),Rk=or(),bk=bh("LocalAudioTrack","_enabledMutex"),Nk=pt({argsMap:(r,o)=>[r.getTrackId(),o]}),Ak=or(),Ok=bh("LocalAudioTrack","_enabledMutex"),xk=pt({argsMap:(r,o)=>[r.getTrackId(),o]}),kk=or(),Dk=or(),Pk=or(),Lk=pt({argsMap:r=>[r.getTrackId()]}),Mk=or(),$k=pt({argsMap:r=>[r.getTrackId()]}),Fk=or(),Uk=pt({argsMap:r=>[r.getTrackId()]}),Vk=pt({argsMap:(r,o)=>[r.getTrackId(),o.name]}),Bk=pt({argsMap:r=>[r.getTrackId()]}),Ne((kn=class extends vS{get isPlaying(){return this._useAudioElement?Bo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(r,o,a,u){super(r,a),k(this,"trackMediaType","audio"),k(this,"_encoderConfig",void 0),k(this,"_source",void 0),k(this,"_enabled",!0),k(this,"_volume",100),k(this,"_useAudioElement",!1),k(this,"_bypassWebAudio",!1),k(this,"processor",void 0),k(this,"processorContext",void 0),k(this,"processorDestination",void 0),k(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=o,this._getOriginVolumeLevel=!!u,de("DISABLE_WEBAUDIO")?(this._source=new u3,this._useAudioElement=!0,this._bypassWebAudio=!0):(this._source=new _k(r,!1,this._getOriginVolumeLevel?r:void 0),de("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),this.processorContext=new c3(this._source.context,this.getTrackId(),"local"),this.processorDestination=new a3(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(So.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setVolume(r){Nn(r,"volume",0,1e3),this._volume=r,this._source.setVolume(r/100),this._useAudioElement&&Bo.setVolume(this.getTrackId(),r);try{if(this._bypassWebAudio)return void F.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const o=this._source.createOutputTrack();this._mediaStreamTrack!==o&&(this._mediaStreamTrack=o,er(this,yt.NEED_REPLACE_TRACK,this).then(()=>{F.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(a=>{F.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),a)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(r){if(!this._useAudioElement)throw new Q(K.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Bo.setSinkID(this.getTrackId(),r)}async setEnabled(r,o,a){return this._setEnabled(r,o,a)}async _setEnabled(r,o,a){if(!a){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(F.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){this._originMediaStreamTrack.enabled=!0;try{a||(this._enabled=!0),await er(this,yt.NEED_ENABLE_TRACK,this),F.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(r," success"))}catch(u){throw a||(this._enabled=!1),F.error("[".concat(this.getTrackId(),"] setEnabled to true error"),u.toString()),u}}else{this._originMediaStreamTrack.enabled=!1,a||(this._enabled=!1);try{await er(this,yt.NEED_DISABLE_TRACK,this)}catch(u){throw a||(this._enabled=!0),F.error("[".concat(this.getTrackId(),"] setEnabled to false error"),u.toString()),u}}}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,F.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await er(this,yt.NEED_MUTE_TRACK,this):await er(this,yt.NEED_UNMUTE_TRACK,this))}getStats(){return Sf(()=>{F.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ic(this,yt.GET_STATS)||CS({},iS)}setAudioFrameCallback(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!r)return this._source.removeAllListeners(So.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(o),this._source.removeAllListeners(So.ON_AUDIO_BUFFER),this._source.on(So.ON_AUDIO_BUFFER,a=>r(a))}play(){F.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(F.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Bo.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){F.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Bo.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let r=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];F.debug("[".concat(this.getTrackId(),"] update player source track")),r&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Bo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(r,o){this._originMediaStreamTrack!==r&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r.addEventListener("ended",this._handleTrackEnded),o&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:r,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,yt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(r))}renewMediaStreamTrack(r){return Je.resolve(void 0)}pipe(r){if(this._bypassWebAudio)throw new Q(K.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===r)return r;if(r._source)throw new Q(K.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),r}unpipe(){var r;if(!this.processor)return;const o=this.processor;(r=this._source.processSourceNode)===null||r===void 0||r.disconnect(),this.processor._source=!1,this.processor=void 0,o.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(_s.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await er(this,yt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,yt.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(_s.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_s.ON_TRACK),this.processorDestination.removeAllListeners(_s.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(To.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(To.REQUEST_CONSTRAINTS)}}).prototype,"setVolume",[Ck],Object.getOwnPropertyDescriptor(kn.prototype,"setVolume"),kn.prototype),Ne(kn.prototype,"setPlaybackDevice",[wk,Rk],Object.getOwnPropertyDescriptor(kn.prototype,"setPlaybackDevice"),kn.prototype),Ne(kn.prototype,"setEnabled",[bk,Nk,Ak],Object.getOwnPropertyDescriptor(kn.prototype,"setEnabled"),kn.prototype),Ne(kn.prototype,"setMuted",[Ok,xk,kk],Object.getOwnPropertyDescriptor(kn.prototype,"setMuted"),kn.prototype),Ne(kn.prototype,"getStats",[Dk],Object.getOwnPropertyDescriptor(kn.prototype,"getStats"),kn.prototype),Ne(kn.prototype,"setAudioFrameCallback",[Pk],Object.getOwnPropertyDescriptor(kn.prototype,"setAudioFrameCallback"),kn.prototype),Ne(kn.prototype,"play",[Lk,Mk],Object.getOwnPropertyDescriptor(kn.prototype,"play"),kn.prototype),Ne(kn.prototype,"stop",[$k,Fk],Object.getOwnPropertyDescriptor(kn.prototype,"stop"),kn.prototype),Ne(kn.prototype,"close",[Uk],Object.getOwnPropertyDescriptor(kn.prototype,"close"),kn.prototype),Ne(kn.prototype,"pipe",[Vk],Object.getOwnPropertyDescriptor(kn.prototype,"pipe"),kn.prototype),Ne(kn.prototype,"unpipe",[Bk],Object.getOwnPropertyDescriptor(kn.prototype,"unpipe"),kn.prototype),kn),EE=(jk=pt({argsMap:(r,o)=>[r.getTrackId(),o]}),Wk=or(),Gk=bh("MicrophoneAudioTrack","_enabledMutex"),zk=pt({argsMap:(r,o,a)=>[r.getTrackId(),o,a]}),Hk=or(),Kk=pt({argsMap:r=>[r.getTrackId()]}),Ne((sc=class extends ys{get __className__(){return"MicrophoneAudioTrack"}constructor(r,o,a,u){super(r,o.encoderConfig?uE(o.encoderConfig):{},u,de("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),k(this,"_config",void 0),k(this,"_deviceName","default"),k(this,"_constraints",void 0),k(this,"_originalConstraints",void 0),k(this,"_enabled",!0),this._config=o,this._constraints=a,this._originalConstraints=a,this._deviceName=r.label,typeof o.bypassWebAudio=="boolean"&&(this._bypassWebAudio=o.bypassWebAudio),fh()&&Gt.bindInterruptDetectorTrack(this),this.bindProcessorContextEvents()}async setDevice(r){if(F.info("[".concat(this.getTrackId(),"] start set device to ").concat(r)),this._enabled)try{const o=await ni.getDeviceById(r),a={};a.audio=CS({},this._constraints),a.audio.deviceId={exact:r},this._originMediaStreamTrack.stop();let u=null;try{u=await ea(a,this.getTrackId())}catch(h){throw F.error("[".concat(this.getTrackId(),"] setDevice failed"),h.toString()),u=await ea({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),h}await this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),this._deviceName=o.label,this._config.microphoneId=r,this._constraints.deviceId={exact:r}}catch(o){throw F.error("[".concat(this.getTrackId(),"] setDevice error"),o.toString()),o}else try{const o=await ni.getDeviceById(r);this._deviceName=o.label,this._config.microphoneId=r,this._constraints.deviceId={exact:r}}catch(o){throw F.error("[".concat(this.getTrackId(),"] setDevice error"),o.toString()),o}F.info("[".concat(this.getTrackId(),"] set device to ").concat(r," success"))}async setEnabled(r,o,a){if(o)return F.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(r);if(!a){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(F.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){var u;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(u=this._source.clonedTrack)===null||u===void 0||u.stop(),a||(this._enabled=!1);try{await er(this,yt.NEED_DISABLE_TRACK,this)}catch(E){throw F.error("[".concat(this.getTrackId(),"] setEnabled false failed"),E.toString()),E}return}const h=CS({},this._constraints),g=ni.searchDeviceIdByName(this._deviceName);g&&!h.deviceId&&(h.deviceId=g);try{a||(this._enabled=!0);const E=await ea({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(E.getAudioTracks()[0],!1),await er(this,yt.NEED_ENABLE_TRACK,this)}catch(E){throw a||(this._enabled=!1),F.error("[".concat(this.getTrackId(),"] setEnabled true failed"),E.toString()),E}F.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),fh()&&Gt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((eo()||xc())&&this._enabled&&!this._isClosed&&Gt.duringInterruption){const r=async()=>{Gt.off(Fr.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(F.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Gt.on(Fr.IOS_INTERRUPTION_END,r)}else F.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(Ou.TRACK_ENDED)}async renewMediaStreamTrack(r){const o=r||this._constraints,a=ni.searchDeviceIdByName(this._deviceName);if(a&&!o.deviceId&&(o.deviceId=a),this._constraints=o,this._enabled){this._originMediaStreamTrack.stop();const u=await ea({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(To.REQUEST_UPDATE_CONSTRAINTS,async(r,o,a)=>{try{const u=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(u),o()}catch(u){a(u)}}),this.processorContext.on(To.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[jk,Wk],Object.getOwnPropertyDescriptor(sc.prototype,"setDevice"),sc.prototype),Ne(sc.prototype,"setEnabled",[Gk,zk,Hk],Object.getOwnPropertyDescriptor(sc.prototype,"setEnabled"),sc.prototype),Ne(sc.prototype,"close",[Kk],Object.getOwnPropertyDescriptor(sc.prototype,"close"),sc.prototype),sc),bK=(qk=pt({argsMap:(r,o)=>[r.getTrackId(),o,r.duration]}),Xk=or(),Yk=pt({argsMap:r=>[r.getTrackId()]}),Jk=or(),Qk=pt({argsMap:r=>[r.getTrackId()]}),Zk=or(),e3=pt({argsMap:r=>[r.getTrackId()]}),t3=or(),n3=pt({argsMap:r=>[r.getTrackId()]}),r3=or(),Ne((Io=class extends ys{get __className__(){return"BufferSourceAudioTrack"}constructor(r,o,a,u){super(o.createOutputTrack(),a,u),k(this,"source",void 0),k(this,"_bufferSource",void 0),this.source=r,this._bufferSource=o,this._bufferSource.on(So.AUDIO_SOURCE_STATE_CHANGE,h=>{this.emit(Ou.SOURCE_STATE_CHANGE,h)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(r){r&&this._bufferSource.updateOptions(r),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(r){this._bufferSource.seekAudioBuffer(r)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}}).prototype,"startProcessAudioBuffer",[qk,Xk],Object.getOwnPropertyDescriptor(Io.prototype,"startProcessAudioBuffer"),Io.prototype),Ne(Io.prototype,"pauseProcessAudioBuffer",[Yk,Jk],Object.getOwnPropertyDescriptor(Io.prototype,"pauseProcessAudioBuffer"),Io.prototype),Ne(Io.prototype,"seekAudioBuffer",[Qk,Zk],Object.getOwnPropertyDescriptor(Io.prototype,"seekAudioBuffer"),Io.prototype),Ne(Io.prototype,"resumeProcessAudioBuffer",[e3,t3],Object.getOwnPropertyDescriptor(Io.prototype,"resumeProcessAudioBuffer"),Io.prototype),Ne(Io.prototype,"stopProcessAudioBuffer",[n3,r3],Object.getOwnPropertyDescriptor(Io.prototype,"stopProcessAudioBuffer"),Io.prototype),Io);class bi extends ys{get __className__(){return"MixingAudioTrack"}get isActive(){for(const o of this.trackList)if(o._enabled&&!o._isClosed&&!o.muted)return!0;return!1}constructor(){const o=Nh().createMediaStreamDestination();super(o.stream.getAudioTracks()[0],void 0,Kn(8,"track-mix-")),k(this,"trackList",void 0),k(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=o,this.trackList=[]}hasAudioTrack(o){return this.trackList.indexOf(o)!==-1}addAudioTrack(o){this.trackList.indexOf(o)===-1?(F.debug("add ".concat(o.getTrackId()," to mixing track")),o._source.outputNode.connect(this.destNode),this.trackList.push(o),this.updateEncoderConfig()):F.debug("track ".concat(o.getTrackId()," is already added"))}removeAudioTrack(o){if(this.trackList.indexOf(o)!==-1){F.debug("remove ".concat(o.getTrackId()," from mixing track"));try{o._source.outputNode.disconnect(this.destNode)}catch{}bS(this.trackList,o),this.updateEncoderConfig()}}updateEncoderConfig(){const o={};this.trackList.forEach(a=>{a._encoderConfig&&((a._encoderConfig.bitrate||0)>(o.bitrate||0)&&(o.bitrate=a._encoderConfig.bitrate),(a._encoderConfig.sampleRate||0)>(o.sampleRate||0)&&(o.sampleRate=a._encoderConfig.sampleRate),(a._encoderConfig.sampleSize||0)>(o.sampleSize||0)&&(o.sampleSize=a._encoderConfig.sampleSize),a._encoderConfig.stereo&&(o.stereo=!0))}),this._encoderConfig=o}}class NK extends Qn{constructor(){super(...arguments),k(this,"resultStorage",new Map)}setLocalAudioStats(o,a,u){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",o,this.checkAudioInputLevel(u,a)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",o,this.checkSendAudioBitrate(u,a))}setLocalVideoStats(o,a,u){this.record("SEND_VIDEO_BITRATE_TOO_LOW",o,this.checkSendVideoBitrate(u,a)),this.record("FRAMERATE_INPUT_TOO_LOW",o,this.checkFramerateInput(u,a)),this.record("FRAMERATE_SENT_TOO_LOW",o,this.checkFramerateSent(u))}setRemoteAudioStats(o,a){const u=o.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",u,this.checkAudioOutputLevel(a))}setRemoteVideoStats(o,a){const u=o.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",u,this.checkVideoDecode(a))}record(o,a,u){this.resultStorage.has(o)||this.resultStorage.set(o,{result:[],isPrevNormal:!0});const h=this.resultStorage.get(o);if(h&&(h.result.push(u),h.result.length>=5)){const g=h.result.includes(!0);h.isPrevNormal&&!g&&this.emit("exception",d3[o],o,a),!h.isPrevNormal&&g&&this.emit("exception",d3[o]+2e3,o+"_RECOVER",a),h.isPrevNormal=g,h.result=[]}}checkAudioOutputLevel(o){return!(o.receiveBitrate>0&&o.receiveLevel===0)}checkAudioInputLevel(o,a){return a instanceof bi&&!a.isActive||!!a.muted||o.sendVolumeLevel!==0}checkFramerateInput(o,a){let u=null;a._encoderConfig&&a._encoderConfig.frameRate&&(u=Mc(a._encoderConfig.frameRate));const h=o.captureFrameRate;return!u||!h||!(u>10&&h<5||u<10&&u>=5&&h<=1)}checkFramerateSent(o){return!(o.captureFrameRate&&o.sendFrameRate&&o.captureFrameRate>5&&o.sendFrameRate<=1)}checkSendVideoBitrate(o,a){return!!a.muted||o.sendBitrate!==0}checkSendAudioBitrate(o,a){return a instanceof bi&&!a.isActive||!!a.muted||o.sendBitrate!==0}checkVideoDecode(o){return o.receiveBitrate===0||o.decodeFrameRate!==0}}const d3={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ni=new class{markSubscribeStart(r,o){performance.mark("agora-web-sdk/".concat(r,"/subscribe-").concat(o))}markPublishStart(r,o){performance.mark("agora-web-sdk/".concat(r,"/publish-").concat(o))}measureFromSubscribeStart(r,o){const a=performance.getEntriesByName("agora-web-sdk/".concat(r,"/subscribe-").concat(o));if(a.length>0){const u=a[a.length-1];return Math.round(performance.now()-u.startTime)}return 0}measureFromPublishStart(r,o){const a=performance.getEntriesByName("agora-web-sdk/".concat(r,"/publish-").concat(o));if(a.length>0){const u=a[a.length-1];return Math.round(performance.now()-u.startTime)}return 0}};function h3(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function Yl(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?h3(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):h3(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}class Oh{constructor(o){k(this,"store",void 0),k(this,"onStatsException",void 0),k(this,"onUploadPublishDuration",void 0),k(this,"localStats",new Map),k(this,"remoteStats",new Map),k(this,"updateStatsInterval",void 0),k(this,"trafficStats",void 0),k(this,"trafficStatsPeerList",[]),k(this,"uplinkStats",void 0),k(this,"exceptionMonitor",void 0),k(this,"p2pChannel",void 0),k(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=o,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new NK,this.exceptionMonitor.on("exception",(a,u,h)=>{this.onStatsException&&this.onStatsException(a,u,h)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Qe.LocalAudioTrack)||Yl({},iS)}getLocalVideoTrackStats(){return this.localStats.get(Qe.LocalVideoTrack)||Yl({},aS)}getRemoteAudioTrackStats(o){const a=(g,E)=>{if(!this.trafficStats)return E;const S=this.trafficStats.peer_delay.find(T=>T.peer_uid===g);return S&&(E.publishDuration=S.B_ppad+(Date.now()-this.trafficStats.timestamp)),E},u={};if(o){var h;const g=(h=this.remoteStats.get(o))===null||h===void 0?void 0:h.audioStats;g&&(u[o]=a(o,g))}else Array.from(this.remoteStats.entries()).forEach(g=>{let[E,{audioStats:S}]=g;S&&(u[E]=a(E,S))});return u}getRemoteNetworkQualityStats(o){const a={};if(o){var u;const h=(u=this.remoteStats.get(o))===null||u===void 0?void 0:u.networkStats;h&&(a[o]=h)}else Array.from(this.remoteStats.entries()).forEach(h=>{let[g,{networkStats:E}]=h;E&&(a[g]=E)});return a}getRemoteVideoTrackStats(o){const a=(g,E)=>{if(!this.trafficStats)return E;const S=this.trafficStats.peer_delay.find(T=>T.peer_uid===g);return S&&(E.publishDuration=S.B_ppvd+(Date.now()-this.trafficStats.timestamp)),E},u={};if(o){var h;const g=(h=this.remoteStats.get(o))===null||h===void 0?void 0:h.videoStats;g&&(u[o]=a(o,g))}else Array.from(this.remoteStats.entries()).forEach(g=>{let[E,{videoStats:S}]=g;S&&(u[E]=a(E,S))});return u}getRTCStats(){let o=0,a=0,u=0,h=0;const g=this.localStats.get(Qe.LocalAudioTrack);g&&(o+=g.sendBytes,a+=g.sendBitrate);const E=this.localStats.get(Qe.LocalVideoTrack);E&&(o+=E.sendBytes,a+=E.sendBitrate);const S=this.localStats.get(Qe.LocalVideoLowTrack);S&&(o+=S.sendBytes,a+=S.sendBitrate),this.remoteStats.forEach(C=>{let{audioStats:w,videoStats:N}=C;w&&(u+=w.receiveBytes,h+=w.receiveBitrate),N&&(u+=N.receiveBytes,h+=N.receiveBitrate)});let T=1;return this.trafficStats&&(T+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:T,SendBitrate:a,SendBytes:o,RecvBytes:u,RecvBitrate:h,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(o){this.localStats.set(o,void 0)}removeLocalStats(o){o?this.localStats.delete(o):this.localStats.clear()}addRemoteStats(o){this.remoteStats.set(o,{})}removeRemoteStats(o){o?this.remoteStats.delete(o):this.remoteStats.clear()}addP2PChannel(o){this.p2pChannel=o}updateTrafficStats(o){o.peer_delay=o.peer_delay.filter(a=>a.B_ppad!==void 0||a.B_ppvd!==void 0),o.peer_delay.filter(a=>this.trafficStatsPeerList.indexOf(a.peer_uid)===-1).forEach(a=>{var u;const h=(u=this.p2pChannel)===null||u===void 0?void 0:u.getRemoteMedia(a.peer_uid),g=h!=null&&h.videoSSRC?Ni.measureFromSubscribeStart(this.store.clientId,h.videoSSRC):0,E=h!=null&&h.audioSSRC?Ni.measureFromSubscribeStart(this.store.clientId,h.audioSSRC):0;a.B_ppad!==void 0&&a.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(a.peer_uid,a.B_ppad,a.B_ppvd,g>E?g:E),this.trafficStatsPeerList.push(a.peer_uid))}),this.trafficStats=o}updateUplinkStats(o){this.uplinkStats&&this.uplinkStats.B_fir!==o.B_fir&&F.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(o.B_fir)),this.uplinkStats=o}static isRemoteVideoFreeze(o,a,u){if(!o)return!1;const h=!!u&&a.framesDecodeFreezeTime>u.framesDecodeFreezeTime,g=!u||a.framesDecodeCount>u.framesDecodeCount;return h||!g}static isRemoteAudioFreeze(o){return!!o&&o._isFreeze()}isLocalVideoFreeze(o){return!(!o.inputFrame||!o.sentFrame)&&o.inputFrame.frameRate>5&&o.sentFrame.frameRate<3}updateLocalStats(o){Array.from(this.localStats.entries()).forEach(a=>{let[u,h]=a;switch(u){case Qe.LocalVideoTrack:case Qe.LocalVideoLowTrack:{const g=h,E=Yl({},aS),S=o.getStats(),T=o.getLocalMedia(u);if(S){const C=S.videoSend.find(w=>w.ssrc===(T==null?void 0:T.ssrcs[0].ssrcId));if(C){const w=o.getLocalVideoSize(),N=o.getEncoderConfig(Qe.LocalVideoTrack);C.codec!=="H264"&&C.codec!=="VP8"&&C.codec!=="VP9"&&C.codec!=="AV1X"&&C.codec!=="AV1"||(E.codecType=C.codec),E.sendBytes=C.bytes,E.sendBitrate=g?8*Math.max(0,E.sendBytes-g.sendBytes):0,C.inputFrame?(E.captureFrameRate=C.inputFrame.frameRate,E.captureResolutionHeight=C.inputFrame.height,E.captureResolutionWidth=C.inputFrame.width):w&&(E.captureResolutionWidth=w.width,E.captureResolutionHeight=w.height),C.sentFrame?(E.sendFrameRate=C.sentFrame.frameRate,E.sendResolutionHeight=C.sentFrame.height,E.sendResolutionWidth=C.sentFrame.width):w&&(E.sendResolutionWidth=w.width,E.sendResolutionHeight=w.height),C.avgEncodeMs&&(E.encodeDelay=C.avgEncodeMs),N&&N.bitrateMax&&(E.targetSendBitrate=1e3*N.bitrateMax),E.sendPackets=C.packets,E.sendPacketsLost=C.packetsLost,E.totalDuration=g?g.totalDuration+1:1,E.totalFreezeTime=g?g.totalFreezeTime:0,this.isLocalVideoFreeze(C)&&(E.totalFreezeTime+=1)}this.trafficStats&&(E.sendPacketsLost=this.trafficStats.B_pvlr4/100)}this.localStats.set(u,E),E&&T&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,T.track,E);break}case Qe.LocalAudioTrack:{const g=h,E=Yl({},iS),S=o.getStats(),T=o.getLocalMedia(u);if(S){const C=S.audioSend.find(w=>w.ssrc===(T==null?void 0:T.ssrcs[0].ssrcId));if(C){if(C.codec!=="opus"&&C.codec!=="aac"&&C.codec!=="PCMU"&&C.codec!=="PCMA"&&C.codec!=="G722"||(E.codecType=C.codec),C.inputLevel)E.sendVolumeLevel=Math.round(32767*C.inputLevel);else{const w=o.getLocalAudioVolume();w&&(E.sendVolumeLevel=Math.round(32767*w))}E.sendBytes=C.bytes,E.sendPackets=C.packets,E.sendPacketsLost=C.packetsLost,E.sendBitrate=g?8*Math.max(0,E.sendBytes-g.sendBytes):0}}this.trafficStats&&(E.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(Qe.LocalAudioTrack,E),E&&T&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,T.track,E);break}}})}updateRemoteStats(o){Array.from(this.remoteStats.entries()).forEach(a=>{let[u,{videoStats:h,audioStats:g,videoPcStats:E}]=a;const S=g,T=h,C=E,w=Yl({},Gx),N=Yl({},zx),M=Yl({},cH),{audioTrack:U,videoTrack:Y,audioSSRC:X,videoSSRC:J}=o.getRemoteMedia(u),fe=o.getStats(),ge=fe==null?void 0:fe.audioRecv.find(Ve=>Ve.ssrc===X),Ue=fe==null?void 0:fe.videoRecv.find(Ve=>Ve.ssrc===J),lt=this.trafficStats&&this.trafficStats.peer_delay.find(Ve=>Ve.peer_uid===u);if(ge&&(ge.codec!=="opus"&&ge.codec!=="aac"&&ge.codec!=="PCMU"&&ge.codec!=="PCMA"&&ge.codec!=="G722"||(w.codecType=ge.codec),ge.outputLevel?w.receiveLevel=Math.round(32767*ge.outputLevel):U&&(w.receiveLevel=Math.round(32767*U.getVolumeLevel())),w.receiveBytes=ge.bytes,w.receivePackets=ge.packets,w.receivePacketsLost=ge.packetsLost,w.packetLossRate=w.receivePacketsLost/(w.receivePackets+w.receivePacketsLost),w.receiveBitrate=S?8*Math.max(0,w.receiveBytes-S.receiveBytes):0,w.totalDuration=S?S.totalDuration+1:1,w.totalFreezeTime=S?S.totalFreezeTime:0,w.freezeRate=w.totalFreezeTime/w.totalDuration,w.receiveDelay=ge.jitterBufferMs,w.totalDuration>10&&Oh.isRemoteAudioFreeze(U)&&(w.totalFreezeTime+=1)),Ue){Ue.codec!=="H264"&&Ue.codec!=="VP8"&&Ue.codec!=="VP9"&&Ue.codec!=="AV1X"&&Ue.codec!=="AV1"||(N.codecType=Ue.codec),N.receiveBytes=Ue.bytes,N.receiveBitrate=T?8*Math.max(0,N.receiveBytes-T.receiveBytes):0,N.decodeFrameRate=Ue.decodeFrameRate<0?0:Ue.decodeFrameRate,N.renderFrameRate=Ue.decodeFrameRate<0?0:Ue.decodeFrameRate,Ue.outputFrame&&(N.renderFrameRate=Ue.outputFrame.frameRate),Ue.receivedFrame?(N.receiveFrameRate=Ue.receivedFrame.frameRate,N.receiveResolutionHeight=Ue.receivedFrame.height,N.receiveResolutionWidth=Ue.receivedFrame.width):Y&&(N.receiveResolutionHeight=Y._videoHeight||0,N.receiveResolutionWidth=Y._videoWidth||0),Ue.framesRateFirefox!==void 0&&(N.receiveFrameRate=Math.round(Ue.framesRateFirefox)),N.receivePackets=Ue.packets,N.receivePacketsLost=Ue.packetsLost,N.packetLossRate=N.receivePacketsLost/(N.receivePackets+N.receivePacketsLost),N.totalDuration=T?T.totalDuration+1:1,N.totalFreezeTime=T?T.totalFreezeTime:0,N.receiveDelay=Ue.jitterBufferMs||0;const Ve=!!J&&o.getRemoteVideoIsReady(J);Y&&Ve&&Oh.isRemoteVideoFreeze(Y,Ue,C)&&(N.totalFreezeTime+=1),N.freezeRate=N.totalFreezeTime/N.totalDuration}lt&&(w.end2EndDelay=lt.B_ad,N.end2EndDelay=lt.B_vd,w.transportDelay=lt.B_ed,N.transportDelay=lt.B_ed,w.currentPacketLossRate=lt.B_ealr4/100,N.currentPacketLossRate=lt.B_evlr4/100,M.uplinkNetworkQuality=lt.B_punq?lt.B_punq:0,M.downlinkNetworkQuality=lt.B_pdnq?lt.B_pdnq:0),this.remoteStats.set(u,{audioStats:w,videoStats:N,videoPcStats:Ue,networkStats:M}),U&&this.exceptionMonitor.setRemoteAudioStats(U,w),Y&&this.exceptionMonitor.setRemoteVideoStats(Y,N)})}}const Lc=new class extends Qn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),k(this,"_lastHiddenTime",0),k(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),F.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function p3(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function _E(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?p3(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):p3(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}function yE(r){return r.match(/^[\.\:\d]+$/)?"".concat(r.replace(/[^\d]/g,"-"),".").concat(de("TURN_DOMAIN")):(F.info("Cannot recognized as IP address ".concat(r,". Used As Host instead")),r)}function f3(r,o){var a,u;const h=de("GATEWAY_DOMAINS");let g=h[1]&&o.indexOf(h[1])!==-1?1:0;r.addresses=r.addresses||[];const E=r.addresses.map(T=>T.domain_prefix?{address:"".concat(T.domain_prefix,".").concat(h[g++%h.length],":").concat(T.port)}:T.ip.match(/^[\.\:\d]+$/)?{ip:T.ip,port:T.port,address:"".concat(T.ip.replace(/[^\d]/g,"-"),".").concat(h[g++%h.length],":").concat(T.port)}:(F.info("Cannot recognized as IP address ".concat(T.ip,". Used As Host instead")),{ip:T.ip,port:T.port,address:"".concat(T.ip,":").concat(T.port)}));if((a=r.detail)!==null&&a!==void 0&&a[18]&&typeof((u=r.detail)===null||u===void 0?void 0:u[18])=="string"){const T=r.detail[18],C=T==null?void 0:T.split(";");for(let w=0;w<C.length;w++){var S;const N=Ac(S=C[w]).call(S);E[w]&&N&&(E[w].ip6=N)}}return{gatewayAddrs:E,uid:r.uid,cid:r.cid,cert:r.cert,vid:r.detail&&r.detail[8],uni_lbs_ip:r.detail&&r.detail[1],res:r,csIp:r.detail&&r.detail[502]}}function Mc(r){return typeof r=="number"?r:r.exact||r.ideal||r.max||r.min||0}function m3(r){const o=r._encoderConfig;if(!o)return{};const a={resolution:o.width&&o.height?"".concat(Mc(o.width),"x").concat(Mc(o.height)):void 0,maxVideoBW:o.bitrateMax,minVideoBW:o.bitrateMin};return typeof o.frameRate=="number"?(a.maxFrameRate=o.frameRate,a.minFrameRate=o.frameRate):o.frameRate&&(a.maxFrameRate=o.frameRate.max||o.frameRate.ideal||o.frameRate.exact||o.frameRate.min,a.minFrameRate=o.frameRate.min||o.frameRate.ideal||o.frameRate.exact||o.frameRate.max),a}function g3(r,o,a){var u,h,g,E,S,T,C,w;const N=o.videoSend.find(J=>J.ssrc===r);if(!N)return null;const M={id:Kn(10,""),timestamp:new Date(o.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:N.ssrc.toString()},U=(u=(h=(g=N.inputFrame)===null||g===void 0?void 0:g.height)!==null&&h!==void 0?h:a==null?void 0:a._videoHeight)!==null&&u!==void 0?u:0,Y=(E=(S=(T=N.inputFrame)===null||T===void 0?void 0:T.width)!==null&&S!==void 0?S:a==null?void 0:a._videoWidth)!==null&&E!==void 0?E:0,X=(C=(w=N.inputFrame)===null||w===void 0?void 0:w.frameRate)!==null&&C!==void 0?C:0;return U&&(M.A_fhi=U+""),Y&&(M.A_fwi=Y+""),X&&(M.A_fri=X+""),M}function E3(r){return r>=0&&r<.17?1:r>=.17&&r<.36?2:r>=.36&&r<.59?3:r>=.59&&r<=1?4:r>1?5:0}function wS(r,o){let a,u,h;switch(o){case $r.CHOOSE_SERVER:a=4096,u="choose server";break;case $r.CLOUD_PROXY:a=1048576,u="proxy";break;case $r.CLOUD_PROXY_5:a=4194304,u="proxy5";break;case $r.CLOUD_PROXY_FALLBACK:a=4194310,u="proxy fallback";break;default:throw new Q(K.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:r.detail&&r.detail[502],retry:!1})}if(r.response_body.forEach(g=>{g.buffer&&g.buffer.flag===a&&(h={code:g.buffer.code,addresses:(g.buffer.edges_services||[]).map(E=>_E(_E({},E),{},{ticket:g.buffer.cert})),server_ts:r.enter_ts,uid:g.buffer.uid,cid:g.buffer.cid,cname:g.buffer.cname,detail:_E(_E({},g.buffer.detail),r.detail),flag:g.buffer.flag,opid:r.opid,cert:g.buffer.cert})}),!h)throw new Q(K.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(u," from multi unilbs response"),{csIp:r.detail&&r.detail[502]});return h}async function AK(r,o){return await Je.all(r.addresses.map(async a=>({address:yE(a.ip),tcpport:a.port,udpport:a.port,username:o&&de("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?o.toString():Jo.username,password:o&&de("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await fK(o.toString()):Jo.password})))}function OK(r,o){const a=o._videoWidth||o.getMediaStreamTrack(!0).getSettings().width;return a||F.warning("cannot get original video track's width, default scale down 4 times for low stream"),a?a/Mc(r.width):4}function vE(r){let{candidateType:o,relayProtocol:a,type:u,address:h,port:g,protocol:E}=r;return u==="local-candidate"?{candidateType:o,relayProtocol:a,protocol:E}:{candidateType:o,relayProtocol:a,address:h,port:g,protocol:E}}function _3(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function Jl(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?_3(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):_3(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}function xh(r){return window.TextEncoder?new TextEncoder().encode(r).length:r.length}function vs(r){return new Je(o=>{window.setTimeout(o,r)})}function xK(r){const o=new Q(K.TIMEOUT,"timeout");return new Je((a,u)=>{window.setTimeout(()=>u(o),r)})}function Kn(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,o=arguments.length>1?arguments[1]:void 0;const a=Math.random().toString(16).substr(2,r).toLowerCase();return a.length===r?"".concat(o).concat(a):"".concat(o).concat(a)+Kn(r-a.length,"")}function RS(){return Kn(32,"").toUpperCase()}const SE=()=>{};function y3(r){return new Je((o,a)=>{let u=!1;const h=document.createElement("video");h.setAttribute("autoplay",""),h.setAttribute("muted",""),h.muted=!0,h.autoplay=!0,h.setAttribute("playsinline",""),h.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(h);const g=eo()?"canplay":"playing";h.addEventListener(g,()=>{const E=h.videoWidth,S=h.videoHeight;!E&&Jn()||(u=!0,h.srcObject=null,h.remove(),o([E,S]))}),h.srcObject=new MediaStream([r]),h.play().catch(SE),setTimeout(()=>{u||(h.srcObject=null,h.remove(),o([h.videoWidth,h.videoHeight]))},4e3)})}function kh(r){return Je.all(r.map(o=>o.then(a=>{throw a},a=>a))).then(o=>{throw o},o=>o)}function Ss(r,o){for(var a=arguments.length,u=new Array(a>2?a-2:0),h=2;h<a;h++)u[h-2]=arguments[h];return r.getListeners(o).length===0?Je.reject(new Q(K.UNEXPECTED_ERROR,"can not emit promise")):new Je((g,E)=>{r.emit(o,...u,g,E)})}function er(r,o){if(r.getListeners(o).length===0)return Je.resolve();for(var a=arguments.length,u=new Array(a>2?a-2:0),h=2;h<a;h++)u[h-2]=arguments[h];return Ss(r,o,...u)}function ic(r,o){if(r.getListeners(o).length===0)return null;for(var a=arguments.length,u=new Array(a>2?a-2:0),h=2;h<a;h++)u[h-2]=arguments[h];return Ql(r,o,...u)}function Ql(r,o){let a=null,u=null;for(var h=arguments.length,g=new Array(h>2?h-2:0),E=2;E<h;E++)g[E-2]=arguments[E];if(r.emit(o,...g,S=>{a=S},S=>{u=S}),u!==null)throw u;if(a===null)throw new Q(K.UNEXPECTED_ERROR,"handler is not sync");return a}function bS(r,o){const a=r.indexOf(o);a!==-1&&r.splice(a,1)}function v3(r){const o=[];return r.forEach(a=>{o.indexOf(a)===-1&&o.push(a)}),o}function ta(r){Je.resolve().then(r)}function lr(r){return JSON.parse(JSON.stringify(r))}const S3={};function Sf(r,o){S3[o]||(S3[o]=!0,r())}function NS(r){const o=window.atob(r),a=new Uint8Array(new ArrayBuffer(o.length));for(let u=0;u<o.length;u+=1)a[u]=o.charCodeAt(u);return a}function TE(r){let o="";for(let a=0;a<r.length;a+=1)o+=String.fromCharCode(r[a]);return window.btoa(o)}const T3=new class{constructor(){k(this,"fnMap",new Map)}throttleByKey(r,o,a,u){for(var h=arguments.length,g=new Array(h>4?h-4:0),E=4;E<h;E++)g[E-4]=arguments[E];if(this.fnMap.has(o)){const S=this.fnMap.get(o);if(S.threshold!==a){S.fn(...S.args),clearTimeout(S.timer);const T=window.setTimeout(()=>{const C=this.fnMap.get(o);C&&C.fn(...C.args),this.fnMap.delete(o)},a);this.fnMap.set(o,{fn:r,threshold:a,timer:T,args:g,skipFn:u})}else S.skipFn&&S.skipFn(...S.args),this.fnMap.set(o,Jl(Jl({},S),{},{fn:r,args:g,skipFn:u}))}else{const S=window.setTimeout(()=>{const T=this.fnMap.get(o);T&&T.fn(...T.args),this.fnMap.delete(o)},a);this.fnMap.set(o,{fn:r,threshold:a,timer:S,args:g,skipFn:u})}}},I3=T3.throttleByKey.bind(T3),Tf=async r=>{let{fragementLength:o,referenceList:a,asyncMapHandler:u,allFailedhandler:h,promisesCollector:g}=r,E=0;const S=o;let T,C=0;const w=async()=>{const N=(()=>{const M=E*S,U=M+S;return a.slice(M,U).map(u)})();g&&g.push(...N);try{T=await kh(N)}catch(M){if(C+=S,E++,!(C>=a.length))return void await w();h(M)}N.forEach(M=>M.cancel())};return await w(),T};function C3(r){return typeof r=="object"&&r!==null&&!(r instanceof RegExp)}const kK={[Ch.ACCESS_POINT]:{[Es.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Es.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Es.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Es.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Es.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Es.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Es.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Es.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[Es.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Es.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Es.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Es.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Es.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Es.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Es.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Es.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Es.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Es.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Ch.UNILBS]:{[Qo.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Qo.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Qo.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Qo.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Qo.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Qo.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Qo.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Qo.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Qo.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Qo.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Qo.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Qo.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Ch.STRING_UID_ALLOCATOR]:{[Ef.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Ef.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Ef.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function IE(r){const o=kK[Math.floor(r/1e4)];if(!o)return{desc:"unkonw error",retry:!1};const a=o[r%1e4];if(!a){if(Math.floor(r/1e4)===Ch.ACCESS_POINT){const u=r%1e4;if(u.toString()[0]==="1")return{desc:r.toString(),retry:!1};if(u.toString()[0]==="2")return{desc:r.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return a}const DK={[dt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[dt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[dt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[dt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[dt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[dt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[dt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[dt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[dt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[dt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[dt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[dt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[dt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[dt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[dt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[dt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[dt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[dt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[dt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[dt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[dt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[dt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[dt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[dt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[dt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[dt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[dt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[dt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[dt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[dt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[dt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[dt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[dt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[dt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[dt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[dt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[dt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[dt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[dt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[dt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[dt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[dt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[dt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[dt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[dt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[dt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[dt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[dt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[dt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[dt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[dt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[dt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[dt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[dt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[dt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[dt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[dt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[dt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[dt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[dt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[dt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[dt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[dt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[dt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function If(r){return DK[r]||{desc:"UNKNOW_ERROR_".concat(r),action:"failed"}}function w3(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}class Dh extends Qn{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(o){["tryNext","recover"].includes(o)&&this.resetReconnectCount(o),this._reconnectMode=o}get state(){return this._state}set state(o){o!==this._state&&(this._state=o,this._state==="reconnecting"?this.emit(kt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(kt.CONNECTED):this._state==="closed"?this.emit(kt.CLOSED):this._state==="failed"&&this.emit(kt.FAILED))}resetReconnectCount(o){F.debug("websocket reset reconnect count, reason: "+o),this.reconnectCount=0}constructor(o,a){let u=arguments.length>2&&arguments[2]!==void 0&&arguments[2],h=arguments.length>3&&arguments[3]!==void 0&&arguments[3],g=arguments.length>4?arguments[4]:void 0;super(),k(this,"connectionID",0),k(this,"currentURLIndex",0),k(this,"urls",void 0),k(this,"_reconnectMode","tryNext"),k(this,"reconnectReason",void 0),k(this,"_initMutex",new js("websocket")),k(this,"name",void 0),k(this,"_state","closed"),k(this,"reconnectInterrupter",void 0),k(this,"websocket",void 0),k(this,"retryConfig",void 0),k(this,"reconnectCount",0),k(this,"forceCloseTimeout",5e3),k(this,"onlineReconnectListener",void 0),k(this,"useCompress",void 0),k(this,"tryDoubleDomain",!1),k(this,"wsInflateLength",0),k(this,"wsDeflateLength",0),k(this,"closeEstablishingWs",()=>{}),k(this,"store",void 0),k(this,"joinChannelServiceRecordIndex",void 0),this.store=g,this.name=o,this.retryConfig=function(w){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?w3(Object(M),!0).forEach(function(U){k(w,U,M[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(M)):w3(Object(M)).forEach(function(U){Object.defineProperty(w,U,Object.getOwnPropertyDescriptor(M,U))})}return w}({},a),this.useCompress=u,this.tryDoubleDomain=h;const{timeout:E,timeoutFactor:S}=a,T=Math.max(300,Math.floor(3*E/5)),C=Math.max(1.2,Math.floor(8*S)/10);Ns.ONLINE&&(this.retryConfig.timeout=T,this.retryConfig.timeoutFactor=C),ur.on(xu.NETWORK_STATE_CHANGE,(w,N)=>{w!==N&&(this.resetReconnectCount("network state change: ".concat(N," -> ").concat(w)),w===Ns.ONLINE?(this.retryConfig.timeout=T,this.retryConfig.timeoutFactor=C):(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S))})}getConnection(){return this.websocket||void 0}init(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this.forceCloseTimeout=a;const u=(h,g)=>{this.urls=o;const E=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(E).then(h).catch(g),this.once(kt.CLOSED,()=>g(new Q(K.WS_DISCONNECT))),this.once(kt.CONNECTED,()=>h())};return this._initMutex.lock().then(h=>new Je((g,E)=>{u(g,E)}).then(()=>{h()}).catch(()=>{h()}))}close(o,a){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const u=this.websocket;a?setTimeout(()=>u.close(),500):u.close(),this.websocket=void 0}this.state=o?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(o,a){if(!this.websocket)return void F.warning("[".concat(this.name,"] can not reconnect, no websocket"));var u;o!==void 0&&(this.reconnectMode=o),F.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinChannelServiceRecordIndex=="number"&&((u=this.store)===null||u===void 0||u.recordJoinChannelService({status:"error",errors:[new Error(a)]},this.joinChannelServiceRecordIndex));const h=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),h&&h.bind(this.websocket)({code:9999,reason:a})}sendMessage(o){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Q(K.WS_ABORT,"websocket is not ready");try{a||(o=JSON.stringify(o)),this.websocket.send(o)}catch(u){throw new Q(K.WS_ERR,"send websocket message error"+u.toString())}}setWsInflateData(o){this.wsDeflateLength=this.wsDeflateLength+o.originLength,this.wsInflateLength=this.wsInflateLength+o.compressedLength}getWsInflateData(){const o=this.wsInflateLength,a=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:o,wsDeflateLength:a}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(o,a){return this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new Je((u,h)=>{var g;const E=w=>{var N;(N=this.store)===null||N===void 0||N.signalChannelOpen(),F.debug("[".concat(this.name,"] websocket opened:"),w),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),u()},S=async w=>{if(F.debug("[".concat(this.name,"] websocket close ").concat(this.websocket&&this.websocket.url,", code: ").concat(w.code,", reason: ").concat(w.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=w.reason,this.state="reconnecting");const N=ic(this,kt.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,M=await this.reconnectWithAction(N);if(this.state==="closed")return void F.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!M)return h(new Q(K.WS_DISCONNECT,"websocket reconnect failed: ".concat(w.code))),void this.close(!0);u()}else h(new Q(K.WS_DISCONNECT,"websocket close: ".concat(w.code))),this.close()},T=w=>{this.emit(kt.ON_MESSAGE,w)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),de("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(o=de("GATEWAY_WSS_ADDRESS")),F.debug("[".concat(this.name,"] start connect, url: ").concat(o));const C=(g=this.store)===null||g===void 0?void 0:g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});this.chooseBestWebsocketConnection(o,!!a,C).then(w=>{var N;this.websocket=w,E&&E(w.url),w.onclose=S,w.onmessage=T,(N=this.store)===null||N===void 0||N.recordJoinChannelService({endTs:Date.now(),status:"success"},C),this.joinChannelServiceRecordIndex=C}).catch(w=>{var N;if((N=this.store)===null||N===void 0||N.recordJoinChannelService({endTs:Date.now(),status:w instanceof Q&&w.code===K.WS_ABORT?"aborted":"error",errors:[w]},C),this.state!=="closed"){if(w instanceof Q&&w.code===K.WS_ERR){const M=new Q(K.WS_ERR,"init websocket failed! Error: ".concat(w.toString()));return F.error("[".concat(this.name,"]").concat(M)),void h(M)}S&&S(w)}else h(new Q(K.WS_DISCONNECT,"websocket is closed: ".concat(w.toString())))})})}async reconnectWithAction(o){let a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||ur.networkState!==Ns.OFFLINE||(this.onlineReconnectListener=ur.onlineWaiter&&ur.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let u=!0;if(this.reconnectInterrupter=()=>{u=!1},a){const E=Wv(this.reconnectCount,this.retryConfig);F.debug("[".concat(this.name,"] wait ").concat(E,"ms to reconnect websocket, mode: ").concat(o)),await Je.race([vs(E),this.onlineReconnectListener||new Je(()=>{})])}if(this.state==="closed"||!u)return!1;this.reconnectCount+=1;const h=async(E,S)=>{this.emit(kt.RECONNECT_CREATE_CONNECTION,S),await this.createWebSocketConnection(E)};try{if(o==="retry"){const E=this.urls[this.currentURLIndex];this.emit(kt.RECONNECT_WAITTING_FINISH,o),await h(E,o)}else if(o==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover",!1);F.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex));const E=this.urls[this.currentURLIndex];this.emit(kt.RECONNECT_WAITTING_FINISH,o),await h(E,o)}else if(o==="recover"){F.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(kt.RECONNECT_WAITTING_FINISH,o),this.urls=await Ss(this,kt.REQUEST_NEW_URLS),this.currentURLIndex=0;const E=this.urls[this.currentURLIndex];await h(E,o)}return!0}catch(E){var g;return F.error("[".concat(this.name,"] reconnect failed"),E.toString()),E!=null&&(g=E.data)!==null&&g!==void 0&&g.desc&&Array.isArray(E.data.desc)&&E.data.desc.length&&E.data.desc.includes("dynamic key expired")?(this.emit(kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(o,a)}}async chooseBestWebsocketConnection(o,a,u){return new Je((h,g)=>{let E=!1;const S=[];this.closeEstablishingWs=()=>{F.debug("[choose-best-ws] close establishing websockets"),S.forEach(X=>{X.onclose=null,X.onopen=null,X.onmessage=null,X.close()}),g(new Q(K.WS_ABORT,"choose best websocket aborted"))};const T=de("GATEWAY_DOMAINS");let C;const w=o.indexOf("?h="),N=T.find(X=>w!==-1?o.includes(X,w):o.includes(X));F.debug("[choose-best-ws] currentDomain: ",N,", domains: ",T);let M=!this.tryDoubleDomain||a||!N;if(!M&&N){var U;const X=Date.now();try{T.forEach(J=>{const fe=w===-1?o.replace(N,J):o.substr(0,w)+o.substr(w).replace(N,J),ge=new WebSocket(fe);ge.binaryType="arraybuffer",S.push(ge),F.debug("[choose-best-ws] ws is connecting:",ge.url)})}catch{for(F.debug("[choose-best-ws] ws create failed, fallback to single url"),S.forEach(fe=>fe.close());S.length;)S.pop();M=!0}(U=this.store)===null||U===void 0||U.recordJoinChannelService({urls:S.map(J=>J.url),service:"gateway"},u),S.forEach(J=>{J.onopen=()=>{if(E)return;const fe=Date.now()-X;F.debug("[choose-best-ws] ws open cost ".concat(fe,"ms")),S.filter(ge=>ge!==J).forEach(ge=>{F.debug("[choose-best-ws]close backup websocket: ".concat(ge.url)),ge.close()}),E=!0,h(J)},J.onclose=fe=>{C=fe,!E&&(S.find(ge=>!(ge.readyState===WebSocket.CLOSED||ge.readyState===WebSocket.CLOSING))||(F.debug("[choose-best-ws] all websocket is closed"),E=!0,g(C)))},J.onmessage=fe=>{F.debug("[choose-best-ws]".concat(J.url," onmessage: ").concat(fe.data))}}),vs(this.forceCloseTimeout).then(()=>{S.forEach(J=>{J.readyState!==WebSocket.OPEN&&J.close()})})}if(M){var Y;let X;F.debug("[choose-best-ws] use single url: ",o),(Y=this.store)===null||Y===void 0||Y.recordJoinChannelService({urls:[o],service:"gateway"},u);try{X=new WebSocket(o),S.push(X),X.binaryType="arraybuffer"}catch(J){const fe=new Q(K.WS_ERR,"init websocket failed! Error: ".concat(J.toString()));return F.error("[".concat(this.name,"]").concat(fe)),void g(fe)}X.onopen=()=>{h(X)},X.onclose=J=>{g(J)},X.onmessage=J=>{F.debug("[choose-best-ws]".concat(X.url," onmessage: ").concat(J.data))},vs(this.forceCloseTimeout).then(()=>{X&&X.readyState!==WebSocket.OPEN&&X.close()})}}).then(h=>(this.closeEstablishingWs=void 0,h)).catch(h=>{throw this.closeEstablishingWs=void 0,h})}}class R3{constructor(o){k(this,"input",[]),k(this,"size",void 0),this.size=o}add(o){this.input.push(o),this.input.length>this.size&&this.input.splice(0,1)}mean(){var o;return this.input.length===0?0:Iu(o=this.input).call(o,(a,u)=>a+u)/this.input.length}}class b3 extends Qn{get connectionState(){return this._connectionState}set connectionState(o){o!==this._connectionState&&(this._connectionState=o,o===dn.CONNECTED?this.emit(it.WS_CONNECTED):o===dn.RECONNECTING?this.emit(it.WS_RECONNECTING,this._websocketReconnectReason):o===dn.CLOSED&&this.emit(it.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(o,a){super(),k(this,"_disconnectedReason",void 0),k(this,"_websocketReconnectReason",void 0),k(this,"_connectionState",dn.CLOSED),k(this,"reconnectToken",void 0),k(this,"websocket",void 0),k(this,"openConnectionTime",void 0),k(this,"clientId",void 0),k(this,"lastMsgTime",Date.now()),k(this,"uploadCache",[]),k(this,"uploadCacheInterval",void 0),k(this,"rttRolling",new R3(5)),k(this,"pingpongTimer",void 0),k(this,"wsInflateDataTimer",void 0),k(this,"pingpongTimeoutCount",0),k(this,"joinResponse",void 0),k(this,"multiIpOption",void 0),k(this,"initError",void 0),k(this,"spec",void 0),k(this,"store",void 0),k(this,"onWebsocketMessage",u=>{if(u.data instanceof ArrayBuffer)return void this.emit(it.ON_BINARY_DATA,u.data);const h=JSON.parse(u.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(h,"_id")){const g="res-@".concat(h._id);this.emit(g,h._result,h._message)}else if(Object.prototype.hasOwnProperty.call(h,"_type")){if(this.emit(h._type,h._message),h._type===Mt.ON_NOTIFICATION&&this.handleNotification(h._message),h._type===Mt.ON_USER_BANNED)switch(h._message.error_code){case 14:this.close(nn.UID_BANNED);break;case 15:this.close(nn.IP_BANNED);break;case 16:this.close(nn.CHANNEL_BANNED)}if(h._type===Mt.ON_USER_LICENSE_BANNED)switch(h._message.error_code){case dt.ERR_LICENSE_MISSING:this.close(nn.LICENSE_MISSING);break;case dt.ERR_LICENSE_EXPIRED:this.close(nn.LICENSE_EXPIRED);break;case dt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(nn.LICENSE_MINUTES_EXCEEDED);break;case dt.ERR_LICENSE_PERIOD_INVALID:this.close(nn.LICENSE_PERIOD_INVALID);break;case dt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(nn.LICENSE_MULTIPLE_SDK_SERVICE);break;case dt.ERR_LICENSE_ILLEGAL:this.close(nn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=o.clientId,this.spec=o,this.store=a,this.websocket=new Dh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,a),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===dn.CONNECTED&&this.reconnect("retry",no.OFFLINE)})}async request(o,a,u,h){const g=Kn(6,""),E={_id:g,_type:o,_message:a},S=this.websocket.connectionID,T=()=>new Je((Y,X)=>{if(this.connectionState===dn.CONNECTED)return Y();const J=()=>{this.off(it.WS_CLOSED,fe),Y()},fe=()=>{this.off(it.WS_CONNECTED,J),X(new Q(K.WS_ABORT))};this.once(it.WS_CONNECTED,J),this.once(it.WS_CLOSED,fe),o!==Et.PUBLISH&&o!==Et.SUBSCRIBE&&o!==Et.UNSUBSCRIBE&&o!==Et.UNPUBLISH&&o!==Et.CONTROL&&o!==Et.RESTART_ICE||this.once(it.DISCONNECT_P2P,()=>{X(new Q(K.DISCONNECT_P2P))}),o!==Et.PUBLISH&&o!==Et.RESTART_ICE||this.once(it.ABORT_P2P_EXECUTION,()=>{X(new Q(K.DISCONNECT_P2P))})});if(this.connectionState!==dn.CONNECTING&&this.connectionState!==dn.RECONNECTING||o===Et.JOIN||o===Et.REJOIN||await T(),this.websocket.sendMessage(E,!0),h)return;const C=new Je((Y,X)=>{let J=!1;const fe=(Ue,lt)=>{J=!0,Y({isSuccess:Ue==="success",message:lt||{}}),this.off(it.WS_CLOSED,ge),this.off(it.WS_RECONNECTING,ge),this.emit(it.REQUEST_SUCCESS,o,a)};this.once("res-@".concat(g),fe);const ge=()=>{X(new Q(K.WS_ABORT,"type: ".concat(o))),this.off(it.WS_CLOSED,ge),this.off(it.WS_RECONNECTING,ge),this.off("res-@".concat(g),fe)};this.once(it.WS_CLOSED,ge),this.once(it.WS_RECONNECTING,ge),vs(de("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==S||J||(F.warning("ws request timeout, type: ".concat(o)),this.emit(it.REQUEST_TIMEOUT,o,a))})});let w=null;try{w=await C}catch(Y){if(this.connectionState===dn.CLOSED||o===Et.LEAVE)throw new Q(K.WS_ABORT);return!this.spec.forceWaitGatewayResponse||u?Y.throw():o===Et.JOIN||o===Et.REJOIN?null:(await T(),await this.request(o,a))}if(w.isSuccess)return w.message;const N=Number(w.message.error_code||w.message.code),M=If(N),U=new Q(K.UNEXPECTED_RESPONSE,"".concat(M.desc,": ").concat(w.message.error_str),{code:N,data:w.message});return M.action==="success"?w.message:(F.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(o,", error_code: ").concat(N,", message: ").concat(M.desc,", action: ").concat(M.action)),N===dt.ERR_TOO_MANY_BROADCASTERS?((o===Et.JOIN||o===Et.REJOIN)&&(this.initError=U,this.close()),U.throw()):M.action==="failed"?U.throw():M.action==="quit"?(this.initError=U,this.close(),U.throw()):(N===dt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=w.message.option,F.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",no.MULTI_IP)):this.reconnect(M.action,no.SERVER_ERROR),o===Et.JOIN||o===Et.REJOIN?null:await this.request(o,a)))}waitMessage(o,a){return new Je(u=>{const h=g=>{(!a||a(g))&&(this.off(o,h),u(g))};this.on(o,h)})}upload(o,a){const u={_type:o,_message:a};try{this.websocket.sendMessage(u)}catch{const g=de("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(u),this.uploadCache.length>g&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==dn.CONNECTED)return;const E=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(E._type,E._message)},de("UPLOAD_CACHE_INTERVAL")||2e3))}}send(o,a){const u={_type:o,_message:a};this.websocket.sendMessage(u)}init(o,a){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Je((u,h)=>{this.once(it.WS_CONNECTED,()=>u(this.joinResponse)),this.once(it.WS_CLOSED,()=>h(this.initError||new Q(K.WS_ABORT))),this.connectionState=dn.CONNECTING,this.websocket.init(o).catch(h),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4),setTimeout(()=>{a&&this.openConnectionTime===void 0&&(F.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),h(new Q(K.INIT_WEBSOCKET_TIMEOUT)))},de("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))})}close(o){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=o||nn.LEAVE,this.connectionState=dn.CLOSED,F.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),o===nn.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Dh("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(it.ABORT_P2P_EXECUTION);const o=await Ss(this,it.REQUEST_JOIN_INFO),a=await this.request(Et.JOIN,o);if(!a)return this.emit(it.REPORT_JOIN_GATEWAY,K.TIMEOUT,this.url||""),!1;this.joinResponse=a,this.emit(it.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=dn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Q(K.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const o=Ql(this,it.REQUEST_REJOIN_INFO);o.token=this.reconnectToken;const a=await this.request(Et.REJOIN,o);return!!a&&(this.connectionState=dn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),a.peers&&a.peers.forEach(u=>{this.emit(Mt.ON_USER_ONLINE,{uid:u.uid}),u.audio&&this.emit(Mt.ON_ADD_AUDIO_STREAM,{uid:u.uid,uint_id:u.uint_id,audio:!0,ssrcId:u.audio_ssrc}),u.video&&this.emit(Mt.ON_ADD_VIDEO_STREAM,{uid:u.uid,uint_id:u.uint_id,video:!0,ssrcId:u.video_ssrc}),u.audio_mute?this.emit(Mt.MUTE_AUDIO,{uid:u.uid}):this.emit(Mt.UNMUTE_AUDIO,{uid:u.uid}),u.video_mute?this.emit(Mt.MUTE_VIDEO,{uid:u.uid}):this.emit(Mt.UNMUTE_VIDEO,{uid:u.uid}),u.audio_enable_local?this.emit(Mt.ENABLE_LOCAL_AUDIO,{uid:u.uid}):this.emit(Mt.DISABLE_LOCAL_AUDIO,{uid:u.uid}),u.video_enable_local?this.emit(Mt.ENABLE_LOCAL_VIDEO,{uid:u.uid}):this.emit(Mt.DISABLE_LOCAL_VIDEO,{uid:u.uid}),u.audio||u.video||this.emit(Mt.ON_REMOVE_STREAM,{uid:u.uid,uint_id:u.uint_id})}),!0)}reconnect(o,a){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(o,a)}handleNotification(o){F.debug("[".concat(this.clientId,"] receive notification: "),o);const a=If(o.code);if(a.action!=="success"){if(a.action!=="failed")return a.action==="quit"?(a.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(nn.UID_BANNED),void this.close()):void this.reconnect(a.action,no.SERVER_ERROR);F.error("[".concat(this.clientId,"] ignore error: "),a.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const o=de("PING_PONG_TIME_OUT"),a=Date.now();this.pingpongTimeoutCount>=o&&(F.warning("PINGPONG Timeout. Last Socket Message: ".concat(a-this.lastMsgTime,"ms")),a-this.lastMsgTime>de("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",no.TIMEOUT):this.request(Et.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const u=Date.now()-a;this.rttRolling.add(u),de("REPORT_STATS")&&this.send(Et.PING_BACK,{pingpongElapse:u})}).catch(u=>{})}handleWsInflateData(){const{wsInflateLength:o,wsDeflateLength:a}=this.websocket.getWsInflateData();o!==0&&a!==0&&this.upload(vo.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:a,ws_inflate_length:o})}handleWebsocketEvents(){this.websocket.on(kt.RECONNECT_WAITTING_FINISH,o=>{this.emit(it.WS_RECONNECT_WAITTING_FINISH,o)}),this.websocket.on(kt.RECONNECT_CREATE_CONNECTION,o=>{this.emit(it.WS_RECONNECT_CREATE_CONNECTION,o)}),this.websocket.on(kt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(kt.CLOSED,()=>{this.connectionState=dn.CLOSED}),this.websocket.on(kt.FAILED,()=>{this._disconnectedReason=nn.NETWORK_ERROR,this.connectionState=dn.CLOSED}),this.websocket.on(kt.RECONNECTING,o=>{this._websocketReconnectReason=o,this.joinResponse=void 0,this.connectionState===dn.CONNECTED?this.connectionState=dn.RECONNECTING:this.connectionState=dn.CONNECTING}),this.websocket.on(kt.WILL_RECONNECT,(o,a)=>{if(Ql(this,it.IS_P2P_DISCONNECTED)&&o==="retry")return F.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(it.NEED_RENEW_SESSION),this.emit(it.DISCONNECT_P2P),a("tryNext");o!=="retry"&&(F.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(o)),this.reconnectToken=void 0,this.emit(it.NEED_RENEW_SESSION),this.emit(it.DISCONNECT_P2P)),a(o)}),this.websocket.on(kt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(o=>{F.warning("[".concat(this.clientId,"] rejoin failed ").concat(o)),this.reconnect("tryNext",no.SERVER_ERROR)}):this.join().catch(o=>{if(this.emit(it.REPORT_JOIN_GATEWAY,o.message||o.code,this.url||""),o instanceof Q&&o.code===K.UNEXPECTED_RESPONSE&&o.data.code===dt.ERR_NO_AUTHORIZED)return F.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",no.SERVER_ERROR);F.error("[".concat(this.clientId,"] join gateway request failed"),o.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",no.SERVER_ERROR):(this.initError=o,this.close())})}),this.websocket.on(kt.REQUEST_NEW_URLS,(o,a)=>{Ss(this,it.REQUEST_RECOVER,this.multiIpOption).then(o).catch(a)}),this.websocket.on(kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function N3(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}class PK extends Qn{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(o){["tryNext","recover"].includes(o)&&this.resetReconnectCount(o),this._reconnectMode=o}get state(){return this._state}set state(o){o!==this._state&&(this._state=o,this._state==="reconnecting"?this.emit(Hn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Hn.CONNECTED):this._state==="closed"?this.emit(Hn.CLOSED):this._state==="failed"&&this.emit(Hn.FAILED))}constructor(o,a,u,h){super(),k(this,"connectionID",0),k(this,"currentURLIndex",0),k(this,"reconnectReason",void 0),k(this,"_reconnectMode","tryNext"),k(this,"_initMutex",void 0),k(this,"_name",void 0),k(this,"_state","closed"),k(this,"_reconnectInterrupter",void 0),k(this,"_url",void 0),k(this,"_retryConfig",void 0),k(this,"_reconnectCount",0),k(this,"_forceCloseTimeout",5e3),k(this,"_onlineReconnectListener",void 0),k(this,"_closeEstablishingTransmitter",()=>{}),k(this,"_store",void 0),k(this,"_joinChannelServiceRecordIndex",void 0),k(this,"_transmitter",void 0),k(this,"_useCompress",void 0),k(this,"_inflateLength",0),k(this,"_deflateLength",0),this._store=h,this._name=o,this._retryConfig=function(g){for(var E=1;E<arguments.length;E++){var S=arguments[E]!=null?arguments[E]:{};E%2?N3(Object(S),!0).forEach(function(T){k(g,T,S[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(S)):N3(Object(S)).forEach(function(T){Object.defineProperty(g,T,Object.getOwnPropertyDescriptor(S,T))})}return g}({},a),this._useCompress=u}resetReconnectCount(o){F.debug("".concat(this._name," reset reconnect count, reason: ").concat(o)),this._reconnectCount=0}close(o,a){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const u=this._transmitter;a?setTimeout(()=>u.close(),500):u.close(),this._transmitter=void 0}this.state=o?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(o,a){if(!this._transmitter)return void F.warning("[".concat(this._name,"] can not reconnect, no websocket"));var u;o!==void 0&&(this.reconnectMode=o),F.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((u=this._store)===null||u===void 0||u.recordJoinChannelService({status:"error",errors:[new Error(a)]},this._joinChannelServiceRecordIndex));const h=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),h&&h.bind(this._transmitter)({code:9999,reason:a})}getInflateData(){const o=this._inflateLength,a=this._deflateLength;return this.clearInflateData(),{inflateLength:o,deflateLength:a}}setInflateData(o){this._deflateLength=this._deflateLength+o.originLength,this._inflateLength=this._inflateLength+o.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function A3(r,o,a){if("getBigUint64"in DataView.prototype)return r.getBigUint64(o,a);const u=r.getUint32(o,a),h=r.getUint32(o+4,a),g=+!!a,E=+!a;return BigInt(u*E+h*g)<<BigInt(32)|BigInt(u*g+h*E)}function O3(r,o,a,u){if("setBigUint64"in DataView.prototype)return r.setBigUint64(o,a,u);const h=Number(a>>BigInt(32)),g=Number(a&BigInt(4294967295));u?(r.setUint32(o+4,h,u),r.setUint32(o,g,u)):(r.setUint32(o,h,u),r.setUint32(o+4,g,u))}let Ai;(function(r){r[r.Default=0]="Default",r[r.Ack=1]="Ack"})(Ai||(Ai={}));class LK{constructor(o,a,u){k(this,"version",1),k(this,"initialRTO",void 0),k(this,"maxBatchAckCount",void 0),k(this,"maxRTO",void 0),k(this,"initialRTT",void 0),k(this,"ID",void 0),k(this,"rtt",void 0),k(this,"packetNumber",1),k(this,"rtoRatioMap",new Map),k(this,"timeoutMap",new Map),k(this,"unorderedPacketQueue",[]),k(this,"batchAckPacketQueue",[]),k(this,"lastOrderedPacketNumber",0),k(this,"batchAckTimer",void 0),k(this,"sendImpl",void 0),k(this,"receiveImpl",void 0),this.sendImpl=o,this.receiveImpl=a,this.ID=Kn(7,"transmitter-"),this.initialRTO=(u==null?void 0:u.initialRTO)!==void 0?u.initialRTO:de("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(u==null?void 0:u.initialRTT)!==void 0?u.initialRTT:de("TRANSMITTER_INITIAL_RTT"),this.rtt=(u==null?void 0:u.initialRTT)!==void 0?u.initialRTT:de("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(u==null?void 0:u.maxBatchAckCount)!==void 0?u.maxBatchAckCount:de("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(u==null?void 0:u.maxRTO)!==void 0?u.maxRTO:de("TRANSMITTER_MAX_RTO")}packetize(o,a){return{type:Ai.Default,version:this.version,packetNumber:a,payload:o}}serialize(o){switch(o.type){case Ai.Default:{let a;typeof o.payload=="string"?a=new TextEncoder().encode(o.payload):a=o.payload;const u=new ArrayBuffer(a.length+15),h=new DataView(u);return h.setUint16(0,o.version),h.setUint8(2,o.type),h.setUint32(3,o.packetNumber),O3(h,7,BigInt(o.sendTs)),new Uint8Array(h.buffer).set(a,15),u}case Ai.Ack:{const a=new ArrayBuffer(16),u=new DataView(a);return u.setUint16(0,o.version),u.setUint8(2,o.type),u.setUint32(3,o.maxAckPacketNumber),u.setUint8(7,o.shift),O3(u,8,BigInt(o.ackSendTs)),a}}}deserialize(o){const a=new DataView(o),u=a.getUint16(0),h=a.getUint8(2);switch(h){case Ai.Default:{const g=a.getUint32(3),E=A3(a,7),S=o.slice(15),T=new TextDecoder().decode(S);return{version:u,type:h,packetNumber:g,sendTs:Number(E),payload:T}}case Ai.Ack:{const g=a.getUint32(3),E=a.getUint8(7),S=A3(a,8);return{version:u,type:h,maxAckPacketNumber:g,shift:E,ackSendTs:Number(S)}}default:throw F.error("[".concat(this.ID,"] Unrecognized packet type ").concat(h)),new Error("Unrecognized packet type ".concat(h))}}sendMessage(o){const a=this.packetize(o,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const u=this.calculateRTO(a),h=window.setTimeout(()=>{this.resendMessage(a)},u);this.timeoutMap.set(a.packetNumber,h),this.sendPacket(a)}onData(o){const a=this.deserialize(o);a.type===Ai.Default?this.ack(a):a.type===Ai.Ack&&(this.updateRTT(a,Math.round(performance.now())),this.clearRTO(a))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(o=>{let[a,u]=o;window.clearTimeout(u)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(o){const a=this.calculateRTO(o),u=window.setTimeout(()=>{this.resendMessage(o)},a);this.timeoutMap.set(o.packetNumber,u),this.sendPacket(o)}calculateRTO(o){const a=this.rtoRatioMap.get(o.packetNumber);if(a===void 0)return this.rtoRatioMap.set(o.packetNumber,1),this.initialRTO;{const u=9*this.rtt/8*a;return this.rtoRatioMap.set(o.packetNumber,a+1),u>this.maxRTO?this.maxRTO:u}}updateRTT(o,a){const u=o.ackSendTs;this.rtt=this.rtt*(7/8)+(a-u-this.rtt)/8}ack(o){if(o.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(o):(this.batchAckPacketQueue.push(o),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(o.payload);;){const a=this.unorderedPacketQueue[0];if(!a){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(a.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(o.packetNumber<=this.lastOrderedPacketNumber){const a={ackSendTs:o.sendTs,maxAckPacketNumber:o.packetNumber,shift:0,type:Ai.Ack,version:this.version};this.sendPacket(a)}else if(o.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[o.packetNumber-this.lastOrderedPacketNumber-2]=o;const a={ackSendTs:o.sendTs,maxAckPacketNumber:o.packetNumber,shift:0,type:Ai.Ack,version:this.version};this.sendPacket(a)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const o={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Ai.Ack,version:this.version};this.sendPacket(o),this.batchAckPacketQueue=[]}sendPacket(o){o.type===Ai.Default&&(o.sendTs=Math.round(performance.now()));const a=this.serialize(o);this.sendImpl(a)}clearRTO(o){for(let a=o.maxAckPacketNumber-o.shift;a<=o.maxAckPacketNumber;a++){const u=this.timeoutMap.get(a);u!==void 0&&window.clearTimeout(u),this.timeoutMap.delete(a),this.rtoRatioMap.delete(a)}}}class x3 extends PK{constructor(o,a){super(o,a,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),k(this,"_initMutex",void 0),k(this,"_reconnectInterrupter",void 0),k(this,"_url",void 0),k(this,"_transmitter",void 0),k(this,"_addresses",void 0),k(this,"_reliableTransmission",void 0),this._initMutex=new js("datachannel");const{timeout:u,timeoutFactor:h}=a,g=Math.max(300,Math.floor(3*u/5)),E=Math.max(1.2,Math.floor(8*h)/10);Ns.ONLINE&&(this._retryConfig.timeout=g,this._retryConfig.timeoutFactor=E),ur.on(xu.NETWORK_STATE_CHANGE,(S,T)=>{S!==T&&(this.resetReconnectCount("network state change: ".concat(T," -> ").concat(S)),S===Ns.ONLINE?(this._retryConfig.timeout=g,this._retryConfig.timeoutFactor=E):(this._retryConfig.timeout=u,this._retryConfig.timeoutFactor=h))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=a;const u=(h,g)=>{this._addresses=o,this.currentURLIndex=this._addresses.findIndex(S=>S.fingerprint||de("FINGERPRINT"));const E=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(E).then(h).catch(g),this.once(Hn.CLOSED,()=>g(new Q(K.WS_DISCONNECT))),this.once(Hn.CONNECTED,()=>h())};return this._initMutex.lock().then(h=>new Je((g,E)=>{u(g,E)}).then(()=>{h()}).catch(()=>{h()}))}sendMessage(o){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new Q(K.WS_ABORT,"datachannel is not ready");try{a||(o=JSON.stringify(o)),this._reliableTransmission.sendMessage(o)}catch(u){throw new Q(K.WS_ERR,"send datachannel signal message error"+u.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(o){const a=JSON.stringify(o);return{compressed:a,compressedLength:a.length,origin:o}}sendMessageWithUint8Array(o){return{compressed:o,compressedLength:o.byteLength,origin:o}}createTransmitterConnection(o){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(o.ip,":").concat(o.port),new Je((a,u)=>{var h;const g=()=>{F.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a()},E=async w=>{var N;if((N=this._closeEstablishingTransmitter)===null||N===void 0||N.call(this),F.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(w.code,", reason: ").concat(w.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=w.reason,this.state="reconnecting");const M=ic(this,Hn.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,U=await this.reconnectWithAction(M);if(this.state==="closed")return void F.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!U)return u(new Q(K.WS_DISCONNECT,"datachannel reconnect failed: ".concat(w.code))),void this.close(!0);a()}else u(new Q(K.WS_DISCONNECT,"datachannel close: ".concat(w.code))),this.close()},S=w=>{var N;(N=this._reliableTransmission)===null||N===void 0||N.onData(w.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),F.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(o)));const T=(h=this._store)===null||h===void 0?void 0:h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),C=Date.now();Ss(this,Hn.TO_CONNECT_DATACHANNEL,o).then(w=>{var N,M;if(!w)throw new Error("transmissonInfo not exist yet");const{transmitter:U,close:Y}=w;this._transmitter=U,(N=this._store)===null||N===void 0||N.signalChannelOpen();const X=Date.now()-C;F.debug("[choose dc] dc open cost ".concat(X,"ms")),this._reliableTransmission=new LK(J=>{var fe;this._transmitter&&this._transmitter.readyState==="open"&&((fe=this._transmitter)===null||fe===void 0||fe.send(J))},J=>{typeof J=="string"&&this.emit(Hn.ON_MESSAGE,J)}),this._closeEstablishingTransmitter=()=>{var J;(J=this._reliableTransmission)===null||J===void 0||J.close(),this._reliableTransmission=void 0,Y()},g&&g(),U.onclose=E,U.onmessage=S,(M=this._store)===null||M===void 0||M.recordJoinChannelService({endTs:Date.now(),status:"success"},T),this._joinChannelServiceRecordIndex=T}).catch(w=>{var N;if((N=this._store)===null||N===void 0||N.recordJoinChannelService({endTs:Date.now(),status:w instanceof Q&&w.code===K.WS_ABORT?"aborted":"error",errors:[w]},T),this.state!=="closed"){if(w instanceof Q&&w.code===K.WS_ERR){const M=new Q(K.WS_ERR,"init datachannel failed! Error: ".concat(w.toString()));return F.error("[".concat(this._name,"]").concat(M)),void u(M)}E&&E(w)}else u(new Q(K.WS_DISCONNECT,"datachannel is closed: ".concat(w.toString())))})})}async reconnectWithAction(o){let a=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||ur.networkState!==Ns.OFFLINE||(this._onlineReconnectListener=ur.onlineWaiter&&ur.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let u=!0;if(this._reconnectInterrupter=()=>{u=!1},a){const E=Wv(this._reconnectCount,this._retryConfig);F.debug("[".concat(this._name,"] wait ").concat(E,"ms to reconnect datachannel, mode: ").concat(o)),await Je.race([vs(E),this._onlineReconnectListener||new Je(()=>{})])}if(this.state==="closed"||!u)return!1;this._reconnectCount+=1;const h=async(E,S)=>{this.emit(Hn.RECONNECT_CREATE_CONNECTION,S),await this.createTransmitterConnection(E)};try{if(o==="retry"){const E=this._addresses[this.currentURLIndex];this.emit(Hn.RECONNECT_WAITTING_FINISH,o),await h(E,o)}else if(o==="tryNext"){this.currentURLIndex+=1;for(let S=this.currentURLIndex;S<this._addresses.length;S++){if(this._addresses[S].fingerprint||de("FINGERPRINT")){this.currentURLIndex=S;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return F.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);F.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const E=this._addresses[this.currentURLIndex];this.emit(Hn.RECONNECT_WAITTING_FINISH,o),await h(E,o)}else o==="recover"&&(F.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(Hn.RECONNECT_WAITTING_FINISH,o),this.emit(Hn.FAILBACK));return!0}catch(E){var g;return F.error("[".concat(this._name,"] reconnect failed"),E.toString()),E!=null&&(g=E.data)!==null&&g!==void 0&&g.desc&&Array.isArray(E.data.desc)&&E.data.desc.length&&E.data.desc.includes("dynamic key expired")?(this.emit(Hn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(o,a)}}}class $c extends Qn{get connectionState(){return this._connectionState}set connectionState(o){o!==this._connectionState&&(this._connectionState=o,o===dn.CONNECTED?this.emit(it.WS_CONNECTED):o===dn.RECONNECTING?this.emit(it.WS_RECONNECTING,this._websocketReconnectReason):o===dn.CLOSED&&this.emit(it.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(o,a){super(),k(this,"_disconnectedReason",void 0),k(this,"_websocketReconnectReason",void 0),k(this,"_connectionState",dn.CLOSED),k(this,"reconnectToken",void 0),k(this,"websocket",void 0),k(this,"openConnectionTime",void 0),k(this,"clientId",void 0),k(this,"lastMsgTime",Date.now()),k(this,"uploadCache",[]),k(this,"uploadCacheInterval",void 0),k(this,"rttRolling",new R3(5)),k(this,"pingpongTimer",void 0),k(this,"inflateDataTimer",void 0),k(this,"pingpongTimeoutCount",0),k(this,"joinResponse",void 0),k(this,"multiIpOption",void 0),k(this,"initError",void 0),k(this,"spec",void 0),k(this,"store",void 0),k(this,"onWebsocketMessage",u=>{if(u instanceof ArrayBuffer)return void this.emit(it.ON_BINARY_DATA,u);const h=JSON.parse(u);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(h,"_id")){const g="res-@".concat(h._id);this.emit(g,h._result,h._message)}else if(Object.prototype.hasOwnProperty.call(h,"_type")&&(this.emit(h._type,h._message),h._type===Mt.ON_NOTIFICATION&&this.handleNotification(h._message),h._type===Mt.ON_USER_BANNED))switch(h._message.error_code){case 14:this.close(nn.UID_BANNED);break;case 15:this.close(nn.IP_BANNED);break;case 16:this.close(nn.CHANNEL_BANNED)}}),this.clientId=o.clientId,this.spec=o,this.store=a,this.websocket=new x3("gateway-".concat(this.clientId),this.spec.retryConfig,!0,a),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===dn.CONNECTED&&this.reconnect("retry",rc.OFFLINE)})}async request(o,a,u,h){const g=Kn(6,""),E={_id:g,_type:o,_message:a},S=this.websocket.connectionID,T=()=>new Je((Y,X)=>{if(this.connectionState===dn.CONNECTED)return Y();const J=()=>{this.off(it.WS_CLOSED,fe),Y()},fe=()=>{this.off(it.WS_CONNECTED,J),X(new Q(K.WS_ABORT))};this.once(it.WS_CONNECTED,J),this.once(it.WS_CLOSED,fe),o!==Et.PUBLISH&&o!==Et.SUBSCRIBE&&o!==Et.UNSUBSCRIBE&&o!==Et.UNPUBLISH&&o!==Et.CONTROL&&o!==Et.RESTART_ICE||this.once(it.DISCONNECT_P2P,()=>{X(new Q(K.DISCONNECT_P2P))}),o!==Et.PUBLISH&&o!==Et.RESTART_ICE||this.once(it.ABORT_P2P_EXECUTION,()=>{X(new Q(K.DISCONNECT_P2P))})});if(this.connectionState!==dn.CONNECTING&&this.connectionState!==dn.RECONNECTING||o===Et.JOIN||o===Et.REJOIN||await T(),o===Et.LEAVE&&(this.websocket.unbindDcCloseEventListener(),h=!0),this.websocket.sendMessage(E,!0,!1),h)return;const C=new Je((Y,X)=>{let J=!1;const fe=(Ue,lt)=>{J=!0,Y({isSuccess:Ue==="success",message:lt||{}}),this.off(it.WS_CLOSED,ge),this.off(it.WS_RECONNECTING,ge),this.emit(it.REQUEST_SUCCESS,o,a)};this.once("res-@".concat(g),fe);const ge=()=>{X(new Q(K.WS_ABORT,"type: ".concat(o))),this.off(it.WS_CLOSED,ge),this.off(it.WS_RECONNECTING,ge),this.off("res-@".concat(g),fe)};this.once(it.WS_CLOSED,ge),this.once(it.WS_RECONNECTING,ge),vs(de("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==S||J||(F.warning("dc request timeout, type: ".concat(o)),this.emit(it.REQUEST_TIMEOUT,o,a))})});let w=null;try{w=await C}catch(Y){if(this.connectionState===dn.CLOSED||o===Et.LEAVE)throw new Q(K.WS_ABORT);return!this.spec.forceWaitGatewayResponse||u?Y.throw():o===Et.JOIN||o===Et.REJOIN?null:(await T(),await this.request(o,a))}if(w.isSuccess)return w.message;const N=Number(w.message.error_code||w.message.code),M=If(N),U=new Q(K.UNEXPECTED_RESPONSE,"".concat(M.desc,": ").concat(w.message.error_str),{code:N,data:w.message});return M.action==="success"?w.message:(F.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(o,", error_code: ").concat(N,", message: ").concat(M.desc,", action: ").concat(M.action)),N===dt.ERR_TOO_MANY_BROADCASTERS?((o===Et.JOIN||o===Et.REJOIN)&&(this.initError=U,this.close()),U.throw()):M.action==="failed"?U.throw():M.action==="quit"?(this.initError=U,this.close(),U.throw()):(N===dt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=w.message.option,F.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",rc.MULTI_IP)):this.reconnect(M.action,rc.SERVER_ERROR),o===Et.JOIN||o===Et.REJOIN?null:await this.request(o,a)))}waitMessage(o,a){return new Je(u=>{const h=g=>{(!a||a(g))&&(this.off(o,h),u(g))};this.on(o,h)})}upload(o,a){const u={_type:o,_message:a};try{this.websocket.sendMessage(u)}catch{const g=de("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(u),this.uploadCache.length>g&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==dn.CONNECTED)return;const E=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(E._type,E._message)},de("UPLOAD_CACHE_INTERVAL")||2e3))}}send(o,a){const u={_type:o,_message:a};this.websocket.sendMessage(u)}init(o,a){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Je((u,h)=>{this.once(it.WS_CONNECTED,()=>u(this.joinResponse)),this.once(it.WS_CLOSED,()=>h(this.initError||new Q(K.WS_ABORT))),this.connectionState=dn.CONNECTING,this.websocket.init(o).catch(h),this.websocket.once(Hn.FAILBACK,()=>{this.openConnectionTime===void 0&&h(new Q(K.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{a&&this.openConnectionTime===void 0&&(F.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),h(new Q(K.INIT_DATACHANNEL_TIMEOUT)))},de("DC_JOIN_WITH_FAILBACK"))})}close(o){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=o||nn.LEAVE,this.connectionState=dn.CLOSED,F.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),o===nn.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new x3("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(it.ABORT_P2P_EXECUTION);const o=await Ss(this,it.DATACHANNEL_CONNECTING),a=await this.request(Et.JOIN,o);if(!a)return this.emit(it.REPORT_JOIN_GATEWAY,K.TIMEOUT,this.url||""),!1;this.joinResponse=a,this.emit(it.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=dn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Q(K.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const o=Ql(this,it.REQUEST_REJOIN_INFO);o.token=this.reconnectToken;const a=await this.request(Et.REJOIN,o);return!!a&&(this.connectionState=dn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),a.peers&&a.peers.forEach(u=>{this.emit(Mt.ON_USER_ONLINE,{uid:u.uid}),u.audio&&this.emit(Mt.ON_ADD_AUDIO_STREAM,{uid:u.uid,uint_id:u.uint_id,audio:!0,ssrcId:u.audio_ssrc}),u.video&&this.emit(Mt.ON_ADD_VIDEO_STREAM,{uid:u.uid,uint_id:u.uint_id,video:!0,ssrcId:u.video_ssrc}),u.audio_mute?this.emit(Mt.MUTE_AUDIO,{uid:u.uid}):this.emit(Mt.UNMUTE_AUDIO,{uid:u.uid}),u.video_mute?this.emit(Mt.MUTE_VIDEO,{uid:u.uid}):this.emit(Mt.UNMUTE_VIDEO,{uid:u.uid}),u.audio_enable_local?this.emit(Mt.ENABLE_LOCAL_AUDIO,{uid:u.uid}):this.emit(Mt.DISABLE_LOCAL_AUDIO,{uid:u.uid}),u.video_enable_local?this.emit(Mt.ENABLE_LOCAL_VIDEO,{uid:u.uid}):this.emit(Mt.DISABLE_LOCAL_VIDEO,{uid:u.uid}),u.audio||u.video||this.emit(Mt.ON_REMOVE_STREAM,{uid:u.uid,uint_id:u.uint_id})}),!0)}reconnect(o,a){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(o,a)}handleNotification(o){F.debug("[".concat(this.clientId,"] receive notification: "),o);const a=If(o.code);if(a.action!=="success"){if(a.action!=="failed")return a.action==="quit"?(a.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(nn.UID_BANNED),void this.close()):void this.reconnect(a.action,rc.SERVER_ERROR);F.error("[".concat(this.clientId,"] ignore error: "),a.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const o=de("PING_PONG_TIME_OUT"),a=Date.now();this.pingpongTimeoutCount>=o&&(F.warning("PINGPONG Timeout. Last Socket Message: ".concat(a-this.lastMsgTime,"ms")),a-this.lastMsgTime>de("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",rc.TIMEOUT):this.request(Et.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const u=Date.now()-a;this.rttRolling.add(u),de("REPORT_STATS")&&this.send(Et.PING_BACK,{pingpongElapse:u})}).catch(u=>{})}handleInflateData(){const{inflateLength:o,deflateLength:a}=this.websocket.getInflateData();o!==0&&a!==0&&this.upload(vo.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:a,ws_inflate_length:o})}handleWebsocketEvents(){this.websocket.on(Hn.RECONNECT_WAITTING_FINISH,o=>{this.emit(it.WS_RECONNECT_WAITTING_FINISH,o)}),this.websocket.on(Hn.RECONNECT_CREATE_CONNECTION,o=>{this.emit(it.WS_RECONNECT_CREATE_CONNECTION,o)}),this.websocket.on(Hn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Hn.CLOSED,()=>{this.connectionState=dn.CLOSED}),this.websocket.on(Hn.FAILED,()=>{this._disconnectedReason=nn.NETWORK_ERROR,this.connectionState=dn.CLOSED}),this.websocket.on(Hn.RECONNECTING,o=>{this._websocketReconnectReason=o,this.joinResponse=void 0,this.connectionState===dn.CONNECTED?this.connectionState=dn.RECONNECTING:this.connectionState=dn.CONNECTING}),this.websocket.on(Hn.WILL_RECONNECT,(o,a)=>{if(Ql(this,it.IS_P2P_DISCONNECTED)&&o==="retry")return F.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(it.NEED_RENEW_SESSION),this.emit(it.DISCONNECT_P2P),a("tryNext");o!=="retry"&&(F.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(o)),this.reconnectToken=void 0,this.emit(it.NEED_RENEW_SESSION),this.emit(it.DISCONNECT_P2P)),a(o)}),this.websocket.on(Hn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(o=>{F.warning("[".concat(this.clientId,"] rejoin failed ").concat(o)),this.reconnect("tryNext",rc.SERVER_ERROR)}):this.join().catch(o=>{if(this.emit(it.REPORT_JOIN_GATEWAY,o.message||o.code,this.url||""),o instanceof Q&&o.code===K.UNEXPECTED_RESPONSE&&o.data.code===dt.ERR_NO_AUTHORIZED)return F.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",rc.SERVER_ERROR);F.error("[".concat(this.clientId,"] join gateway request failed"),o.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",rc.SERVER_ERROR):(this.initError=o,this.close())})}),this.websocket.on(Hn.REQUEST_NEW_URLS,(o,a)=>{Ss(this,it.REQUEST_RECOVER,this.multiIpOption).then(o).catch(a)}),this.websocket.on(Hn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Hn.TO_CONNECT_DATACHANNEL,async(o,a,u)=>Ss(this,it.DATACHANNEL_PRECONNECT,o).then(a).catch(u)),this.websocket.on(Hn.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(it.DATACHANNEL_FAILBACK)})}}function k3(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function ac(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?k3(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):k3(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}const AS=new Map;class MK extends Qn{get state(){return this._state}set state(o){if(o===this._state)return;const a=this._state;this._state=o,o==="DISCONNECTED"&&this._disconnectedReason?this.emit(Vn.CONNECTION_STATE_CHANGE,o,a,this._disconnectedReason):this.emit(Vn.CONNECTION_STATE_CHANGE,o,a)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(o){F.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(o)),this._joinGatewayStartTime=o}constructor(o,a){super(),k(this,"store",void 0),k(this,"joinInfo",void 0),k(this,"key",void 0),k(this,"signal",void 0),k(this,"role",void 0),k(this,"inChannelInfo",{joinAt:null,duration:0}),k(this,"spec",void 0),k(this,"_state","DISCONNECTED"),k(this,"_statsCollector",void 0),k(this,"_disconnectedReason",void 0),k(this,"isSignalRecover",!1),k(this,"hasChangeBGPAddress",!1),k(this,"trafficStatsInterval",void 0),k(this,"networkQualityInterval",void 0),k(this,"_joinGatewayStartTime",0),k(this,"_signalTimeout",!1),k(this,"_clientRoleOptions",void 0),k(this,"_isProactiveJoin",!1),this.store=o,this.spec=a,this.signal=this.store.useDataChannel?new $c(ac(ac({},a),{},{retryConfig:a.websocketRetryConfig}),o):new b3(ac(ac({},a),{},{retryConfig:a.websocketRetryConfig}),o),this._statsCollector=a.statsCollector,this.role=a.role||"audience",this._clientRoleOptions=a.clientRoleOptions,this.handleSignalEvents()}async join(o,a,u){if(this.signal instanceof $c){let T=!1;o.cloudProxyServer!=="disabled"?(F.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(o.cloudProxyServer,")")),T=!0):"".concat(o.apResponse.cid,"_").concat(o.apResponse.cert).length>255||"".concat(o.apResponse.cid,"_").concat(o.apResponse.cert).length<22?(F.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),T=!0):o.apResponse.addresses.some(C=>C.fingerprint)||de("FINGERPRINT")||(F.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),T=!0),T&&this.resetSignal()}this.store.joinGatewayStart(),o.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const h=Date.now();let g=AS.get(o.cname);if(g||(g=new Map,AS.set(o.cname,g)),this._isProactiveJoin=!0,g.has(o.uid)){const T=new Q(K.UID_CONFLICT);throw at.joinGateway(o.sid,{lts:h,succ:!1,ec:T.message,addr:null,uid:o.uid,cid:o.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!o.proxyServer,signalChannel:this.signal instanceof $c?"1":"0"}),this._isProactiveJoin=!1,T}g.set(o.uid,!0),this.joinInfo=o,this.key=a;let E=0;this.joinGatewayStartTime=h;const S=o.proxyServer;try{let T;if(F.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof $c?"datachannel":"websocket"," join uid ").concat(E)),this.signal instanceof $c)T=await this.signal.init(o.apResponse.addresses,u);else{const C=o.proxyServer,w=C?o.gatewayAddrs.map(N=>{const M=N.address.split(":");return"wss://".concat(C,"/ws/?h=").concat(M[0],"&p=").concat(M[1])}):o.gatewayAddrs.map(N=>"wss://".concat(N.address));T=await this.signal.init(w,u)}E=T.uid,F.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof $c?"datachannel":"websocket"," join uid ").concat(E," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(T){throw T&&T.code===K.INIT_WEBSOCKET_TIMEOUT?(F.warning("[".concat(this.store.clientId,"] User join failed"),T.toString()),T):T&&T.code===K.INIT_DATACHANNEL_TIMEOUT?(F.warning("[".concat(this.store.clientId,"] User join datachannel failed"),T.toString()),this.resetSignal(),T):(F.error("[".concat(this.store.clientId,"] User join failed"),T.toString()),at.joinGateway(o.sid,{lts:h,succ:!1,ec:T.message,addr:this.signal.url,uid:o.uid,cid:o.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!S,signalChannel:this.signal instanceof $c?"1":"0"}),this._isProactiveJoin=!1,g.delete(o.uid),this.signal.close(),T)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),F.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(T=>{F.warning("[".concat(this.store.clientId,"] get traffic stats error"),T.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Vn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Vn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Vn.NETWORK_QUALITY,{uplinkNetworkQuality:E3(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:E3(this._statsCollector.trafficStats.B_dnq)}):this.emit(Vn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),E}async leave(){let o=arguments.length>0&&arguments[0]!==void 0&&arguments[0],a=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){a!==nn.FALLBACK&&(this.state="DISCONNECTING");try{o||this.signal.connectionState!==dn.CONNECTED||await function(u,h){return h===1/0?u:Je.race([u,xK(h)])}(this.signal.request(Et.LEAVE,void 0,!0),3e3)}catch(u){F.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),u)}this.signal.close(a),a!==nn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(o,a,u){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const h={state:"offer",p2p_id:this.store.p2pId,ortc:a,mode:this.spec.mode,extend:de("PUB_EXTEND"),twcc:!!de("PUBLISH_TWCC")};try{return(await this.signal.request(Et.PUBLISH,h,!0))._message}catch(g){if(u&&g.data&&g.data.code===dt.ERR_PUBLISH_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),g.toString()),await this.tryUnpubBeforeRepub(o,a),this.publish(o,a,!1);throw g}}async unpublish(o,a){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(K.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Et.UNPUBLISH,{stream_id:a,ortc:o},!0)}catch(u){F.warning("unpublish warning: ",u)}}async subscribe(o,a,u){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(K.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const h={stream_id:o,stream_type:a.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!de("SUBSCRIBE_TWCC"),extend:de("SUB_EXTEND"),ssrcId:a.ssrcId};try{return(await this.signal.request(Et.SUBSCRIBE,h,!0))._message}catch(g){if(u&&g.data&&g.data.code===dt.ERR_SUBSCRIBE_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),g.toString()),await this.tryUnsubBeforeResub(o,a),await this.subscribe(o,a,!1);throw g}}async subscribeAll(o,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Q(K.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const u={p2p_id:this.store.p2pId,users:o,dtx:!1};try{return await this.signal.request(Et.SUBSCRIBE_STREAMS,u,!0)}catch(h){if(a&&h.data&&h.data.code===dt.ERR_SUBSCRIBE_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),h.toString()),await this.tryMassUnsubBeforeResub(o),await this.subscribeAll(o,!1);throw h}}async setVideoProfile(o){const a=function(u){if(!(u.bitrateMax&&u.bitrateMin&&u.frameRate&&u.height&&u.width))return;let h=u.frameRate,g=u.width,E=u.height,S=!0;return typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,h||(S=!1)),typeof g!="number"&&(g=g.exact||g.ideal||g.max||g.min||0,g||(S=!1)),typeof E!="number"&&(E=E.exact||E.ideal||E.max||E.min||0,h||(S=!1)),S?{stream_type:0,width:g,height:E,fps:h,start_bps:1e3*u.bitrateMax,min_bps:1e3*u.bitrateMin,target_bps:1e3*u.bitrateMax}:void 0}(o);if(a)return this.signal.request(Et.SET_VIDEO_PROFILE,a);F.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(o,a){try{await this.signal.request(Et.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:o,stream_id:a},!0)}catch(u){F.warning("unsubscribe warning: ",u)}}async massUnsubscribe(o){try{await this.signal.request(Et.UNSUBSCRIBE_STREAMS,o,!0)}catch(a){F.warning("unsubscribeAll warning: ",a)}}async reconnectPC(o){const{iceParameters:a,dtlsParameters:u,rtpCapabilities:h}=o;return{gatewayEstablishParams:await this.signal.request(Et.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:a,dtlsParameters:u,rtpCapabilities:h}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Et.GATEWAY_INFO)}renewToken(o){return this.signal.request(Et.RENEW_TOKEN,o)}async setClientRole(o,a){if(a&&(this._clientRoleOptions=Object.assign({},a)),this.state!=="CONNECTED")return void(this.role=o);let u;u=o==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(Et.SET_CLIENT_ROLE,{role:o,level:u,client_ts:Date.now()}),this.role=o}async setRemoteVideoStreamType(o,a){await this.signal.request(Et.SWITCH_VIDEO_STREAM,{stream_id:o,stream_type:a})}async setDefaultRemoteVideoStreamType(o){await this.signal.request(Et.DEFAULT_VIDEO_STREAM,{stream_type:o})}async setStreamFallbackOption(o,a){await this.signal.request(Et.SET_FALLBACK_OPTION,{stream_id:o,fallback_type:a})}async pickSVCLayer(o,a){await this.signal.request(Et.PICK_SVC_LAYER,{stream_id:o,spatial_layer:a.spatialLayer,temporal_layer:a.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ac({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Et.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const o=AS.get(this.joinInfo.cname);o&&o.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const o=function(a){let u;return u=a.startsWith("dc")?a.match(/(dc\:\/\/)?([^:]+):(\d+)/):a.match(/(wss\:\/\/)?([^:]+):(\d+)/),u?{username:Jo.username,password:Jo.password,turnServerURL:u[2],tcpport:parseInt(u[3])+30,udpport:parseInt(u[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],o&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(ac(ac({},Jo),{},{turnServerURL:o.turnServerURL,tcpport:o.tcpport,udpport:o.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const o=await this.signal.request(Et.TRAFFIC_STATS,void 0,!0);o.timestamp=Date.now(),o.peer_delay.forEach(a=>{const u=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(h=>h.peer_uid===a.peer_uid);u&&u.B_st!==a.B_st&&ta(()=>{this.emit(Vn.STREAM_TYPE_CHANGE,a.peer_uid,a.B_st)})}),this._statsCollector.updateTrafficStats(o)}getJoinMessage(o){if(!this.joinInfo||!this.key)throw new Q(K.UNEXPECTED_ERROR,"can not generate join message, no join info");const a=Object.assign({},this.joinInfo.apResponse);let u=de("REPORT_APP_SCENARIO");if(typeof u!="string")try{u=JSON.stringify(u)}catch{u=void 0}u&&u.length>128&&(u=void 0);const h=ac({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:wi,browser:navigator.userAgent,process_id:de("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:a,extend:de("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:u,attributes:{userAttributes:{enablePublishedUserList:de("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:de("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof de("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?de("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof de("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?de("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof de("ENABLE_USER_LICENSE_CHECK")=="boolean"?de("ENABLE_USER_LICENSE_CHECK"):void 0}},join_ts:this.joinGatewayStartTime},o);return this.joinInfo.stringUid&&(h.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(h.aes_mode=this.joinInfo.aesmode,de("ENCRYPT_AES")?(h.aes_secret=this.joinInfo.aespassword,h.aes_encrypt=!0):h.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(h.aes_salt=this.joinInfo.aessalt)),a.addresses[this.signal.websocket.currentURLIndex]&&(h.ap_response.ticket=a.addresses[this.signal.websocket.currentURLIndex].ticket,delete a.addresses),this.joinInfo.defaultVideoStream!==void 0&&(h.default_video_stream=this.joinInfo.defaultVideoStream),h}getRejoinMessage(){if(!this.joinInfo)throw new Q(K.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(it.WS_RECONNECT_WAITTING_FINISH,o=>{["tryNext","recover"].includes(o)&&this.joinInfo&&at.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(it.WS_RECONNECT_CREATE_CONNECTION,o=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(it.WS_RECONNECTING,o=>{this.joinInfo&&at.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:o||no.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",at.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(it.WS_CLOSED,o=>{let a;switch(o){case nn.LEAVE:a=no.LEAVE;break;case nn.UID_BANNED:case nn.IP_BANNED:case nn.CHANNEL_BANNED:case nn.SERVER_ERROR:a=no.SERVER_ERROR;break;case nn.FALLBACK:a=no.FALLBACK;break;case nn.LICENSE_MISSING:case nn.LICENSE_EXPIRED:case nn.LICENSE_MINUTES_EXCEEDED:case nn.LICENSE_PERIOD_INVALID:case nn.LICENSE_MULTIPLE_SDK_SERVICE:case nn.LICENSE_ILLEGAL:a=o;break;default:a=no.NETWORK_ERROR}F.debug("[signal] websocket closed, reason: ".concat(a||"undefined -> "+no.NETWORK_ERROR)),this.joinInfo&&at.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:o===nn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:a}),this._disconnectedReason=o,o!==nn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(it.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(F.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),at.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof $c?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const o=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!o)return void F.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(o));_n("EVENT_REPORT_DOMAIN",o[1]),_n("EVENT_REPORT_BACKUP_DOMAIN",o[1]),_n("LOG_UPLOAD_SERVER","".concat(o[1],":6444"))}}),this.signal.on(Mt.ON_UPLINK_STATS,o=>{this._statsCollector.updateUplinkStats(o)}),this.signal.on(it.REQUEST_RECOVER,(o,a,u)=>{if(!this.joinInfo)return u(new Q(K.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));o&&(this.joinInfo.multiIP=o,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ss(this,Vn.REQUEST_NEW_GATEWAY_LIST).then(a).catch(u)}),this.signal.on(it.REQUEST_JOIN_INFO,async o=>{var a;this.updateTurnConfigFromSignal();const{iceParameters:u,dtlsParameters:h,rtpCapabilities:g}=await Ss(this,Vn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(a=this.joinInfo)===null||a===void 0?void 0:a.turnServer});o(this.getJoinMessage({ortc:{iceParameters:u,dtlsParameters:h,rtpCapabilities:g,version:"2"}}))}),this.signal.on(it.REQUEST_REJOIN_INFO,o=>{o(this.getRejoinMessage())}),this.signal.on(it.REPORT_JOIN_GATEWAY,(o,a)=>{this.joinInfo&&(at.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,addr:a,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof $c?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(it.IS_P2P_DISCONNECTED,o=>{o(Ql(this,Vn.IS_P2P_DISCONNECTED))}),this.signal.on(it.DISCONNECT_P2P,()=>{this.emit(Vn.DISCONNECT_P2P)}),this.signal.on(it.NEED_RENEW_SESSION,()=>{this.emit(Vn.NEED_RENEW_SESSION)}),this.signal.on(it.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(it.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(it.JOIN_RESPONSE,o=>{const a=this.getCurrentGatewayAddress();this.emit(Vn.JOIN_RESPONSE,o,a)}),this.signal.on(it.DATACHANNEL_PRECONNECT,async(o,a,u)=>{this.updateTurnConfigFromSignal();const h=this.getCurrentGatewayAddress();return Ss(this,Vn.DATACHANNEL_PRECONNECT,o,h).then(a).catch(u)}),this.signal.on(it.DATACHANNEL_CONNECTING,async o=>{const{iceParameters:a,dtlsParameters:u,rtpCapabilities:h}=await Ss(this,Vn.REQUEST_DC_CONNECTION_PARAMS);o(this.getJoinMessage({ortc:{iceParameters:a,dtlsParameters:u,rtpCapabilities:h,version:"2"}}))}),this.signal.on(it.DATACHANNEL_FAILBACK,()=>{F.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Vn.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(o,a){try{await this.signal.request(Et.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:o,ortc:[a]},!0)}catch(u){throw F.warning("unsubscribe warning",u),u}}async tryUnpubBeforeRepub(o,a){try{await this.signal.request(Et.UNPUBLISH,{stream_id:o,ortc:a},!0)}catch(u){throw F.warning("unpublish warning: ",u),u}}async tryMassUnsubBeforeResub(o){const a={users:o.map(u=>({stream_id:u.stream_id,stream_type:u.stream_type}))};try{await this.signal.request(Et.UNSUBSCRIBE_STREAMS,a,!0)}catch(u){throw F.warning("massUnsubscribe warning",u),u}}async muteLocal(o,a){const u={action:o.find(h=>h.stream_type===Tr.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:o,stream_id:a};try{await this.signal.request(Et.CONTROL,u,!0,!0)}catch(h){throw F.warning("gateway unmuteLocal warning: ",h),h}}async unmuteLocal(o,a){const u={action:o.find(h=>h.stream_type===Tr.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:o,stream_id:a};try{await this.signal.request(Et.CONTROL,u,!0,!0)}catch(h){throw F.warning("gateway muteLocal warning: ",h),h}}uploadStats(o,a){this.signal.upload(o,a)}getSignalRTT(){return this.signal.rtt}async restartICE(o){const a={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:o};try{return await this.signal.request(Et.RESTART_ICE,a,!0)}catch(u){throw F.warning("P2PChannel.restartICE warning: ",u),u}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,no.P2P_FAILED)}getCurrentGatewayAddress(){var o;if(!de("GATEWAY_WSS_ADDRESS"))return(o=this.joinInfo)!==null&&o!==void 0&&o.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(o){await this.signal.request(Et.SET_PARAMETER,{enablePublishAudioFilter:o})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(nn.FALLBACK)),this.store.useDataChannel=!1,this.signal=new b3(ac(ac({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Vn.RESET_SIGNAL,lE.websocket)}}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var r;function o(ve){var xe=0;return function(){return xe<ve.length?{done:!1,value:ve[xe++]}:{done:!0}}}var a=typeof Object.defineProperties=="function"?Object.defineProperty:function(ve,xe,Ke){return ve==Array.prototype||ve==Object.prototype||(ve[xe]=Ke.value),ve},u,h=function(ve){ve=[typeof globalThis=="object"&&globalThis,ve,typeof window=="object"&&window,typeof self=="object"&&self,typeof s=="object"&&s];for(var xe=0;xe<ve.length;++xe){var Ke=ve[xe];if(Ke&&Ke.Math==Math)return Ke}throw Error("Cannot find global object")}(this);function g(ve,xe){if(xe)e:{var Ke=h;ve=ve.split(".");for(var vt=0;vt<ve.length-1;vt++){var Yt=ve[vt];if(!(Yt in Ke))break e;Ke=Ke[Yt]}(xe=xe(vt=Ke[ve=ve[ve.length-1]]))!=vt&&xe!=null&&a(Ke,ve,{configurable:!0,writable:!0,value:xe})}}function E(ve){return(ve={next:ve})[Symbol.iterator]=function(){return this},ve}function S(ve){var xe=typeof Symbol<"u"&&Symbol.iterator&&ve[Symbol.iterator];return xe?xe.call(ve):{next:o(ve)}}if(g("Symbol",function(ve){function xe(Yt,$e){this.A=Yt,a(this,"description",{configurable:!0,writable:!0,value:$e})}if(ve)return ve;xe.prototype.toString=function(){return this.A};var Ke="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",vt=0;return function Yt($e){if(this instanceof Yt)throw new TypeError("Symbol is not a constructor");return new xe(Ke+($e||"")+"_"+vt++,$e)}}),g("Symbol.iterator",function(ve){if(ve)return ve;ve=Symbol("Symbol.iterator");for(var xe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Ke=0;Ke<xe.length;Ke++){var vt=h[xe[Ke]];typeof vt=="function"&&typeof vt.prototype[ve]!="function"&&a(vt.prototype,ve,{configurable:!0,writable:!0,value:function(){return E(o(this))}})}return ve}),typeof Object.setPrototypeOf=="function")u=Object.setPrototypeOf;else{var T;e:{var C={};try{C.__proto__={a:!0},T=C.a;break e}catch{}T=!1}u=T?function(ve,xe){if(ve.__proto__=xe,ve.__proto__!==xe)throw new TypeError(ve+" is not extensible");return ve}:null}var w=u;function N(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function M(ve){if(ve.m)throw new TypeError("Generator is already running");ve.m=!0}function U(ve,xe){return ve.h=3,{value:xe}}function Y(ve){this.g=new N,this.G=ve}function X(ve,xe,Ke,vt){try{var Yt=xe.call(ve.g.j,Ke);if(!(Yt instanceof Object))throw new TypeError("Iterator result "+Yt+" is not an object");if(!Yt.done)return ve.g.m=!1,Yt;var $e=Yt.value}catch(D){return ve.g.j=null,ve.g.s(D),J(ve)}return ve.g.j=null,vt.call(ve.g,$e),J(ve)}function J(ve){for(;ve.g.h;)try{var xe=ve.G(ve.g);if(xe)return ve.g.m=!1,{value:xe.value,done:!1}}catch(Ke){ve.g.v=void 0,ve.g.s(Ke)}if(ve.g.m=!1,ve.g.l){if(xe=ve.g.l,ve.g.l=null,xe.F)throw xe.D;return{value:xe.return,done:!0}}return{value:void 0,done:!0}}function fe(ve){this.next=function(xe){return ve.o(xe)},this.throw=function(xe){return ve.s(xe)},this.return=function(xe){return function(Ke,vt){M(Ke.g);var Yt=Ke.g.j;return Yt?X(Ke,"return"in Yt?Yt.return:function($e){return{value:$e,done:!0}},vt,Ke.g.return):(Ke.g.return(vt),J(Ke))}(ve,xe)},this[Symbol.iterator]=function(){return this}}function ge(ve,xe){return xe=new fe(new Y(xe)),w&&ve.prototype&&w(xe,ve.prototype),xe}if(N.prototype.o=function(ve){this.v=ve},N.prototype.s=function(ve){this.l={D:ve,F:!0},this.h=this.C||this.u},N.prototype.return=function(ve){this.l={return:ve},this.h=this.u},Y.prototype.o=function(ve){return M(this.g),this.g.j?X(this,this.g.j.next,ve,this.g.o):(this.g.o(ve),J(this))},Y.prototype.s=function(ve){return M(this.g),this.g.j?X(this,this.g.j.throw,ve,this.g.o):(this.g.s(ve),J(this))},g("Array.prototype.entries",function(ve){return ve||function(){return function(xe,Ke){xe instanceof String&&(xe+="");var vt=0,Yt=!1,$e={next:function(){if(!Yt&&vt<xe.length){var D=vt++;return{value:Ke(D,xe[D]),done:!1}}return Yt=!0,{done:!0,value:void 0}}};return $e[Symbol.iterator]=function(){return $e},$e}(this,function(xe,Ke){return[xe,Ke]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var Ue=function(ve,xe){for(var Ke=0;Ke<ve.length;Ke++)xe(ve[Ke])},lt=function(ve){return ve.replace(/\r?\n|\r/g,`\r
`)},Ve=function(ve,xe,Ke){return xe instanceof Blob?(Ke=Ke!==void 0?Ke+"":typeof xe.name=="string"?xe.name:"blob",xe.name===Ke&&Object.prototype.toString.call(xe)!=="[object Blob]"||(xe=new File([xe],Ke)),[String(ve),xe]):[String(ve),String(xe)]},Ge=function(ve,xe){if(ve.length<xe)throw new TypeError(xe+" argument required, but only "+ve.length+" present.")},Le=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ze=Le.FormData,yn=Le.XMLHttpRequest&&Le.XMLHttpRequest.prototype.send,At=Le.Request&&Le.fetch,Dn=Le.navigator&&Le.navigator.sendBeacon,Tn=Le.Element&&Le.Element.prototype,ir=Le.Symbol&&Symbol.toStringTag;ir&&(Blob.prototype[ir]||(Blob.prototype[ir]="Blob"),"File"in Le&&!File.prototype[ir]&&(File.prototype[ir]="File"));try{new File([],"")}catch{Le.File=function(xe,Ke,vt){return xe=new Blob(xe,vt||{}),Object.defineProperties(xe,{name:{value:Ke},lastModified:{value:+(vt&&vt.lastModified!==void 0?new Date(vt.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ir&&Object.defineProperty(xe,ir,{value:"File"}),xe}}var us=function(ve){return ve.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},tr=function(ve){this.i=[];var xe=this;ve&&Ue(ve.elements,function(Ke){if(Ke.name&&!Ke.disabled&&Ke.type!=="submit"&&Ke.type!=="button"&&!Ke.matches("form fieldset[disabled] *"))if(Ke.type==="file"){var vt=Ke.files&&Ke.files.length?Ke.files:[new File([],"",{type:"application/octet-stream"})];Ue(vt,function(Yt){xe.append(Ke.name,Yt)})}else Ke.type==="select-multiple"||Ke.type==="select-one"?Ue(Ke.options,function(Yt){!Yt.disabled&&Yt.selected&&xe.append(Ke.name,Yt.value)}):Ke.type==="checkbox"||Ke.type==="radio"?Ke.checked&&xe.append(Ke.name,Ke.value):(vt=Ke.type==="textarea"?lt(Ke.value):Ke.value,xe.append(Ke.name,vt))})};if((r=tr.prototype).append=function(ve,xe,Ke){Ge(arguments,2),this.i.push(Ve(ve,xe,Ke))},r.delete=function(ve){Ge(arguments,1);var xe=[];ve=String(ve),Ue(this.i,function(Ke){Ke[0]!==ve&&xe.push(Ke)}),this.i=xe},r.entries=function ve(){var xe,Ke=this;return ge(ve,function(vt){if(vt.h==1&&(xe=0),vt.h!=3)return xe<Ke.i.length?vt=U(vt,Ke.i[xe]):(vt.h=0,vt=void 0),vt;xe++,vt.h=2})},r.forEach=function(ve,xe){Ge(arguments,1);for(var Ke=S(this),vt=Ke.next();!vt.done;vt=Ke.next()){var Yt=S(vt.value);vt=Yt.next().value,Yt=Yt.next().value,ve.call(xe,Yt,vt,this)}},r.get=function(ve){Ge(arguments,1);var xe=this.i;ve=String(ve);for(var Ke=0;Ke<xe.length;Ke++)if(xe[Ke][0]===ve)return xe[Ke][1];return null},r.getAll=function(ve){Ge(arguments,1);var xe=[];return ve=String(ve),Ue(this.i,function(Ke){Ke[0]===ve&&xe.push(Ke[1])}),xe},r.has=function(ve){Ge(arguments,1),ve=String(ve);for(var xe=0;xe<this.i.length;xe++)if(this.i[xe][0]===ve)return!0;return!1},r.keys=function ve(){var xe,Ke,vt,Yt,$e=this;return ge(ve,function(D){if(D.h==1&&(xe=S($e),Ke=xe.next()),D.h!=3)return Ke.done?void(D.h=0):(vt=Ke.value,Yt=S(vt),U(D,Yt.next().value));Ke=xe.next(),D.h=2})},r.set=function(ve,xe,Ke){Ge(arguments,2),ve=String(ve);var vt=[],Yt=Ve(ve,xe,Ke),$e=!0;Ue(this.i,function(D){D[0]===ve?$e&&($e=!vt.push(Yt)):vt.push(D)}),$e&&vt.push(Yt),this.i=vt},r.values=function ve(){var xe,Ke,vt,Yt,$e=this;return ge(ve,function(D){if(D.h==1&&(xe=S($e),Ke=xe.next()),D.h!=3)return Ke.done?void(D.h=0):(vt=Ke.value,(Yt=S(vt)).next(),U(D,Yt.next().value));Ke=xe.next(),D.h=2})},tr.prototype._asNative=function(){for(var ve=new Ze,xe=S(this),Ke=xe.next();!Ke.done;Ke=xe.next()){var vt=S(Ke.value);Ke=vt.next().value,vt=vt.next().value,ve.append(Ke,vt)}return ve},tr.prototype._blob=function(){var ve="----formdata-polyfill-"+Math.random(),xe=[],Ke="--"+ve+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(vt,Yt){return typeof vt=="string"?xe.push(Ke+us(lt(Yt))+`"\r
\r
`+lt(vt)+`\r
`):xe.push(Ke+us(lt(Yt))+'"; filename="'+us(vt.name)+`"\r
Content-Type: `+(vt.type||"application/octet-stream")+`\r
\r
`,vt,`\r
`)}),xe.push("--"+ve+"--"),new Blob(xe,{type:"multipart/form-data; boundary="+ve})},tr.prototype[Symbol.iterator]=function(){return this.entries()},tr.prototype.toString=function(){return"[object FormData]"},Tn&&!Tn.matches&&(Tn.matches=Tn.matchesSelector||Tn.mozMatchesSelector||Tn.msMatchesSelector||Tn.oMatchesSelector||Tn.webkitMatchesSelector||function(ve){for(var xe=(ve=(this.document||this.ownerDocument).querySelectorAll(ve)).length;0<=--xe&&ve.item(xe)!==this;);return-1<xe}),ir&&(tr.prototype[ir]="FormData"),yn){var wo=Le.XMLHttpRequest.prototype.setRequestHeader;Le.XMLHttpRequest.prototype.setRequestHeader=function(ve,xe){wo.call(this,ve,xe),ve.toLowerCase()==="content-type"&&(this.B=!0)},Le.XMLHttpRequest.prototype.send=function(ve){ve instanceof tr?(ve=ve._blob(),this.B||this.setRequestHeader("Content-Type",ve.type),yn.call(this,ve)):yn.call(this,ve)}}At&&(Le.fetch=function(ve,xe){return xe&&xe.body&&xe.body instanceof tr&&(xe.body=xe.body._blob()),At.call(this,ve,xe)}),Dn&&(Le.navigator.sendBeacon=function(ve,xe){return xe instanceof tr&&(xe=xe._asNative()),Dn.call(this,ve,xe)}),Le.FormData=tr}})();const CE=()=>{const r=de("AREAS");return r.length===0&&r.push(Wt.GLOBAL),Iu(r).call(r,(o,a,u)=>{const h=D3(a);return h?u===0?h:"".concat(o,",").concat(h):o},"")},D3=r=>r===Wt.OVERSEA?"".concat(Hr.ASIA,",").concat(Hr.EUROPE,",").concat(Hr.AFRICA,",").concat(Hr.NORTH_AMERICA,",").concat(Hr.SOUTH_AMERICA,",").concat(Hr.OCEANIA):Hr[r],$K=r=>{const o={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return r.map(a=>{const u=dE[a],h=Object.keys(u);h&&h.map(g=>{g!=="CODE"&&(o[g]=o[g].concat(u[g]))})}),o},wE={GLOBAL:{ASIA:[Wt.CHINA,Wt.JAPAN,Wt.INDIA,Wt.KOREA,Wt.HKMC],EUROPE:[],NORTH_AMERICA:[Wt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},OS=Object.keys(wE[Wt.GLOBAL]),P3=[Wt.CHINA,Wt.NORTH_AMERICA,Wt.EUROPE,Wt.ASIA,Wt.JAPAN,Wt.INDIA,Wt.OCEANIA,Wt.SOUTH_AMERICA,Wt.AFRICA,Wt.KOREA,Wt.HKMC,Wt.US],FK=function(r,o){let a=[];if(r.includes(Wt.GLOBAL)){const g=[Wt.GLOBAL,Wt.OVERSEA],E=Object.keys(dE);if(o===Wt.GLOBAL)throw new Q(K.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(o===Wt.CHINA)a=[Wt.OVERSEA];else if(h=o,OS.includes(h)){const S=(u=o,wE[Wt.GLOBAL][u]||[]),T=[...g,o,...S];a=E.filter(C=>!T.includes(C))}else if(function(S){let T=!1;return OS.forEach(C=>{wE[Wt.GLOBAL][C].includes(S)&&(T=!0)}),T}(o)){const S=function(C){let w;return OS.forEach(N=>{wE[Wt.GLOBAL][N].includes(C)&&(w=N)}),w}(o),T=[...g,S,o];a=E.filter(C=>!T.includes(C))}else a=r;a=function(S){const T=[];return P3.forEach(C=>{S.includes(C)&&T.push(C)}),T.concat(S.filter(C=>!P3.includes(C)))}(a)}else a=r;var u,h;return a};function L3(r){if(!r&&de("AREAS").includes(Wt.EXTENSIONS))return F.debug("update area from ap : reset"),void xS(Ix,!0);if(!de("AREAS").includes(Wt.GLOBAL)||!r)return;let o=dE.EXTENSIONS;o&&(o={CODE:D3(Wt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(r,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(r,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(r,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(r,".agora.io"),"cds-ap-web-2-".concat(r,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(r,".agora.io"),"sua-ap-web-2-".concat(r,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(r,".agora.io"),"uap-ap-web-2-".concat(r,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(r,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(r,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(r,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(r,".agora.io")]},F.debug("update area from ap success: ".concat(r,",config is "),o),_n("AREAS",[Wt.EXTENSIONS],!0),Object.keys(o).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?_n(a,o[a][0]):_n(a,o[a])}))}function xS(r){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const a=at.reportApiInvoke(null,{name:vr.SET_AREA,options:r,tag:jn.TRACER});try{let u=[];if(typeof r=="string"&&(u=[r]),Array.isArray(r)&&(r.forEach(g=>{if(!hH.includes(g))throw new Q(K.INVALID_PARAMS,"invalid area code")}),u=r),Object.prototype.toString.call(r)==="[object Object]"){const{areaCode:g,excludedArea:E}=r;if(!g)throw new Q(K.INVALID_PARAMS,"area code is needed");let S=g;typeof g=="string"&&(S=[g]),u=E?FK(S,E):S}if(!o){if(Hl.AREAS){const g=new Q(K.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return a.onError(g),void F.warning("setArea is prohibited because of config-distribute")}if(u.includes(Wt.GLOBAL)&&de("AREAS")===Wt.EXTENSIONS){const g=new Q(K.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return a.onError(g),void F.warning("setArea is prohibited because of ap extensions")}}_n("AREAS",u,o);const h=$K(u);Object.keys(h).map(g=>{g==="LOG_UPLOAD_SERVER"||g==="EVENT_REPORT_DOMAIN"||g==="EVENT_REPORT_BACKUP_DOMAIN"||g==="PROXY_SERVER_TYPE3"?_n(g,h[g][0]):_n(g,h[g])}),F.debug("set area success:",u.join(","))}catch(u){throw a.onError(u),u}a.onSuccess()}function M3(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function $3(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?M3(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):M3(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}let kS=1;function UK(r,o,a,u,h){kS+=1;const g={sid:a.sid,command:"convergeAllocateEdge",uid:"666",appId:a.appId,ts:Math.floor(Date.now()/1e3),seq:kS,requestId:kS,version:wi,cname:a.cname},E={service_name:o,json_body:JSON.stringify(g)};let S,T,C=r[0];return nc(async()=>{S=Date.now();const w=await Da(C,{data:E,cancelToken:u,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(T=Date.now()-S,w.code!==0){const U=new Q(K.UNEXPECTED_RESPONSE,"live streaming ap error, code"+w.code,{retry:!0,responseTime:T});throw F.error(U.toString()),U}const N=JSON.parse(w.json_body);if(N.code!==200){const U=new Q(K.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(N.code,", reason: ").concat(N.reason),{code:N.code,responseTime:T});throw F.error(U.toString()),U}if(!N.servers||N.servers.length===0){const U=new Q(K.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:N.code,responseTime:T});throw F.error(U.toString()),U}const M=function(U,Y){return{addressList:U.servers.map(X=>"wss://".concat(X.address.replace(/\./g,"-"),".").concat(de("WORKER_DOMAIN"),":").concat(X.wss,"?serviceName=").concat(encodeURIComponent(Y))),workerToken:U.workerToken,vid:U.vid}}(N,o);return de("LIVE_STREAMING_ADDRESS")&&(M.addressList=de("LIVE_STREAMING_ADDRESS")instanceof Array?de("LIVE_STREAMING_ADDRESS"):[de("LIVE_STREAMING_ADDRESS")]),$3($3({},M),{},{responseTime:T})},(w,N)=>(at.apworkerEvent(a.sid,{success:!0,sc:200,serviceName:o,responseDetail:JSON.stringify(w.addressList),firstSuccess:N===0,responseTime:T,serverIp:r[N%r.length]}),!1),(w,N)=>(at.apworkerEvent(a.sid,{success:!1,sc:w.data&&w.data.code||200,serviceName:o,responseTime:T,serverIp:r[N%r.length]}),!!(w.code!==K.OPERATION_ABORTED&&w.code!==K.UNEXPECTED_RESPONSE||w.data&&w.data.retry)&&(C=r[(N+1)%r.length],!0)),h)}let DS=1;function F3(r,o,a,u){let{url:h,areaCode:g}=r;const E=Date.now();let S;const[T,C]=j3(o,g,[$r.CHOOSE_SERVER]);let w=ur.networkState;return nc(async()=>{w&&ur.networkState===Ns.OFFLINE&&ur.onlineWaiter&&await Je.race([ur.onlineWaiter,vs(u&&u.maxRetryTimeout||Or.maxRetryTimeout)]),w=ur.networkState;const{data:N,headers:M}=await Da(h,{data:T,cancelToken:a,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);S=M.http3==="1"?1:-1,at.reportResourceTiming(h,o.sid),V3(N,h,o,E,[$r.CHOOSE_SERVER],S);const U=wS(N,$r.CHOOSE_SERVER);return B3(U),f3(U,h)},N=>(N&&at.joinChooseServer(o.sid,{lts:E,succ:!0,csAddr:h,opid:C,serverList:N.gatewayAddrs.map(M=>M.address),ec:null,cid:N.cid.toString(),uid:N.uid.toString(),csIp:N.csIp,unilbsServerIds:[$r.CHOOSE_SERVER].toString(),isHttp3:S}),!1),N=>N.code!==K.OPERATION_ABORTED&&(N.code===K.CAN_NOT_GET_GATEWAY_SERVER?N.data.retry:(at.joinChooseServer(o.sid,{lts:E,succ:!1,csAddr:h,serverList:null,opid:C,ec:N.code,csIp:N.data&&N.data.csIp,unilbsServerIds:[$r.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:w}),isHttp3:S}),F.warning("[".concat(o.clientId,"] Choose server network error, retry"),N),!0)),u)}function U3(r,o,a,u){let h,{url:g,areaCode:E,serviceIds:S}=r;const T=Date.now(),[C,w]=j3(o,E,S);let N;return nc(async()=>{N&&ur.networkState===Ns.OFFLINE&&ur.onlineWaiter&&await Je.race([ur.onlineWaiter,vs(u&&u.maxRetryTimeout||Or.maxRetryTimeout)]),N=ur.networkState;const{data:M,headers:U}=await Da(g,{data:C,cancelToken:a,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=U.http3==="1"?1:-1,at.reportResourceTiming(g,o.sid),V3(M,g,o,T,S,h);const Y=wS(M,$r.CHOOSE_SERVER),X=wS(M,o.cloudProxyServer==="proxy5"?$r.CLOUD_PROXY_5:o.cloudProxyServer==="proxy3"||o.cloudProxyServer==="proxy4"?$r.CLOUD_PROXY:$r.CLOUD_PROXY_FALLBACK);return B3(Y),{gatewayInfo:f3(Y,g),proxyInfo:X,url:g}},M=>(M.gatewayInfo&&at.joinChooseServer(o.sid,{lts:T,succ:!0,csAddr:g,serverList:M.gatewayInfo.gatewayAddrs.map(U=>U.address),ec:null,opid:w,cid:M.gatewayInfo.cid.toString(),uid:M.gatewayInfo.uid.toString(),csIp:M.gatewayInfo.csIp,unilbsServerIds:S.toString(),isHttp3:h}),M.proxyInfo&&at.joinWebProxyAP(o.sid,{lts:T,sucess:1,apServerAddr:g,turnServerAddrList:M.proxyInfo.addresses.map(U=>U.ip).join(","),errorCode:null,eventType:o.cloudProxyServer,unilbsServerIds:S.toString()}),!1),M=>M.code!==K.OPERATION_ABORTED&&(M.code===K.CAN_NOT_GET_GATEWAY_SERVER?M.data.retry:(at.joinWebProxyAP(o.sid,{lts:T,sucess:0,apServerAddr:g,turnServerAddrList:null,errorCode:M.code,eventType:o.cloudProxyServer,unilbsServerIds:S.toString(),extend:JSON.stringify({networkState:N})}),F.warning("[".concat(o.clientId,"] multi unilbs network error, retry"),M),!0)),u)}const V3=(r,o,a,u,h,g)=>{const E=[],S=T=>{T.flag===4096?at.joinChooseServer(a.sid,{lts:u,succ:!1,csAddr:o,opid:r.opid,serverList:null,ec:T.error.message,csIp:T.error.data&&T.error.data.csIp,unilbsServerIds:h.toString(),isHttp3:g}):T.flag!==1048576&&T.flag!==4194304&&T.flag!==4194310||at.joinWebProxyAP(a.sid,{lts:u,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:T.error.code,eventType:a.cloudProxyServer,unilbsServerIds:h.toString()})};if(r.response_body.forEach(T=>{const C=T.buffer.code;if(T.uri===23&&C===0&&!T.buffer.edges_services)if(T.buffer.flag===4194310)F.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),T.buffer.edges_services=[];else{const w={error:new Q(K.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:r.detail[502]}),flag:T.buffer.flag};E.push(w),S(w)}if(C!==0){const w=IE(C),N={error:new Q(K.CAN_NOT_GET_GATEWAY_SERVER,w.desc,{desc:w.desc,retry:w.retry,csIp:r.detail[502]}),flag:T.buffer.flag};T.buffer.flag===4194310?F.warning(N.error.toString()):E.push(N),S(N)}}),E.length)throw F.warning("[".concat(a.clientId,"] multi unilbs ").concat(o," failed, ").concat(E.map(T=>"flag: ".concat(T.flag,", message: ").concat(T.error.message,", retry: ").concat(T.error.data.retry)).join(" | "))),new Q(K.CAN_NOT_GET_GATEWAY_SERVER,E.map(T=>"flag: ".concat(T.flag,", message: ").concat(T.error.message)).join(" | "),{retry:!!E.find(T=>T.error.data.retry),csIp:r.detail[502],desc:[...new Set(E.map(T=>{var C,w;return T==null||(C=T.error)===null||C===void 0||(w=C.data)===null||w===void 0?void 0:w.desc}).filter(T=>!!T))]})},B3=r=>{var o,a,u,h;if(r.addresses&&r.addresses.length===0&&r.code===0)throw new Q(K.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:r.detail&&r.detail[502]});if((o=r.detail)!==null&&o!==void 0&&o[23]&&typeof((a=r.detail)===null||a===void 0?void 0:a[23])=="string"?L3(r.detail[23].toLowerCase()):L3(),(u=r.detail)!==null&&u!==void 0&&u[19]&&typeof((h=r.detail)===null||h===void 0?void 0:h[19])=="string"){const E=r.detail[19],S=E==null?void 0:E.split(";");for(let T=0;T<S.length;T++){var g;const C=Ac(g=S[T]).call(g);r.addresses[T]&&S&&(r.addresses[T].fingerprint=C)}}if(de("GATEWAY_ADDRESS")&&de("GATEWAY_ADDRESS").length>0){F.debug("assign gateway address to",de("GATEWAY_ADDRESS"));const E=de("GATEWAY_ADDRESS").map(S=>{var T,C;const w=(T=(C=r.addresses.find(N=>N.ip===S.ip&&N.port===S.port))===null||C===void 0?void 0:C.fingerprint)!==null&&T!==void 0?T:"";return{ip:S.ip,port:S.port,ticket:r.addresses[0]&&r.addresses[0].ticket,fingerprint:w}});r.addresses=E}},VK=(r,o)=>{if(r.response_body&&r.response_body.length){const a=r.response_body[0];if(a.buffer.code!==0){const u=IE(a.buffer.code);throw new Q(K.UPDATE_TICKET_FAILED,"[".concat(a.buffer.code,"]: ").concat(u.desc),{retry:u.retry})}return a.buffer.ticket}throw F.debug("update ticket request received ap response without response body:",o),new Q(K.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},j3=(r,o,a)=>{const u=Math.floor(Math.random()*1e12),h={appid:r.appId,client_ts:Date.now(),opid:u,sid:r.sid,request_bodies:[{uri:22,buffer:{cname:r.cname,detail:{6:r.stringUid,11:o,12:de("USE_NEW_TOKEN")?"1":void 0,22:o},key:r.token,service_ids:a,uid:r.uid||0}}]};h.request_bodies.forEach(E=>{r.multiIP&&r.multiIP.gateway_ip&&(E.buffer.detail[5]=JSON.stringify({vocs_ip:[r.multiIP.uni_lbs_ip],vos_ip:[r.multiIP.gateway_ip]}))});const g=new FormData;return g.append("request",JSON.stringify(h)),[g,u]},BK=(r,o)=>{const a=Math.floor(Math.random()*1e12),u={appid:r.appId,client_ts:Date.now(),opid:a,sid:r.sid,request_bodies:[{uri:28,buffer:{cname:r.cname,detail:{1:"",6:r.stringUid,12:"1"},token:r.token,service_ids:o,uid:r.uid||0,edges_services:r.apResponse.addresses.map(g=>({ip:g.ip,port:g.port}))}}]},h=new FormData;return h.append("request",JSON.stringify(u)),[h,a]};let PS=0;async function LS(r,o,a,u){return{gatewayInfo:await async function(g,E,S,T){let C=null;const w=[],N=async()=>{const U=de("WEBCS_DOMAIN").slice(0,de("AJAX_REQUEST_CONCURRENT")).map(J=>({url:g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(J+"/api/v2/transpond/webrtc?v=2"):"https://".concat(J,"/api/v2/transpond/webrtc?v=2"),areaCode:CE()})),Y=T.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:U.map(J=>J.url)}),X=await Tf({fragementLength:de("FRAGEMENT_LENGTH"),referenceList:U,asyncMapHandler:J=>(F.debug("[".concat(g.clientId,"] Connect to choose_server:"),J.url),F3(J,g,E,S)),allFailedhandler:J=>{throw T.recordJoinChannelService({endTs:Date.now(),status:"error",errors:J},Y),J[0]},promisesCollector:w});return T.recordJoinChannelService({endTs:Date.now(),status:"success"},Y),X},M=async()=>{if(await vs(1e3),C!==null)return C;const U=de("WEBCS_DOMAIN_BACKUP_LIST").map(J=>({url:g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(J+"/api/v2/transpond/webrtc?v=2"):"https://".concat(J,"/api/v2/transpond/webrtc?v=2"),areaCode:CE()})),Y=T.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:U.map(J=>J.url)}),X=await Tf({fragementLength:de("FRAGEMENT_LENGTH"),referenceList:U,asyncMapHandler:J=>(F.debug("[".concat(g.clientId,"] Connect to backup choose_server:"),J.url),F3(J,g,E,S)),allFailedhandler:J=>{throw T.recordJoinChannelService({endTs:Date.now(),status:"error",errors:J},Y),J[0]},promisesCollector:w});return T.recordJoinChannelService({endTs:Date.now(),status:"success"},Y),X};try{return C=await kh([N(),M()]),w.length&&w.forEach(U=>U.cancel&&typeof U.cancel=="function"&&U.cancel()),C}catch(U){throw U[0]}}(r,o,a,u)}}async function W3(r,o,a,u,h){const g=r.cloudProxyServer;if(g==="disabled"){if(!u)return;if(r.useLocalAccessPoint)return await LS(r,o,a,h);if(de("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:C,proxyInfo:w}=await z3(r,o,a,h);return r.turnServer&&r.turnServer.mode!=="auto"||(r.turnServer={mode:"manual",servers:w.map(N=>({turnServerURL:N.address,tcpport:N.tcpport||Jo.tcpport,udpport:N.udpport||Jo.udpport,username:N.username||Jo.username,password:N.password||Jo.password,forceturn:de("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE"),security:!0}))}),{gatewayInfo:C}}return await LS(r,o,a,h)}const{proxyInfo:E,gatewayInfo:S}=await z3(r,o,a,h),T={gatewayInfo:S};return r.turnServer={mode:"manual",servers:E.map(C=>({turnServerURL:C.address,tcpport:g==="proxy3"?void 0:C.tcpport?C.tcpport:Jo.tcpport,udpport:g==="proxy4"?void 0:C.udpport?C.udpport:Jo.udpport,username:C.username||Jo.username,password:C.password||Jo.password,forceturn:g!=="proxy4",security:g==="proxy5"}))},F.debug("[".concat(r.clientId,"] set proxy server: ").concat(r.proxyServer,", mode: ").concat(g)),T}async function G3(r,o,a,u,h){const g=de("ACCOUNT_REGISTER").slice(0,de("AJAX_REQUEST_CONCURRENT"));let E=[];E=o.proxyServer?g.map(T=>"https://".concat(o.proxyServer,"/ap/?url=").concat(T+"/api/v1")):g.map(T=>"https://".concat(T,"/api/v1"));const S=h==null?void 0:h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:E});try{const T=await async function(C,w,N,M,U){const Y=Date.now(),X={sid:N.sid,opid:10,appid:N.appId,string_uid:w};let J=C[0];const fe=await nc(()=>Da(J+"".concat(J.indexOf("?")===-1?"?":"&","action=stringuid"),{data:X,cancelToken:M,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(ge,Ue)=>{if(ge.code===0){if(ge.uid<=0||ge.uid>=Math.pow(2,32))throw F.error("Invalid Uint Uid ".concat(w," => ").concat(ge.uid),ge),at.reqUserAccount(X.sid,{lts:Y,success:!1,serverAddr:J,stringUid:X.string_uid,uid:ge.uid,errorCode:K.INVALID_UINT_UID_FROM_STRING_UID,extend:X}),new Q(K.INVALID_UINT_UID_FROM_STRING_UID);return at.reqUserAccount(X.sid,{lts:Y,success:!0,serverAddr:J,stringUid:X.string_uid,uid:ge.uid,errorCode:null,extend:X}),!1}const lt=IE(ge.code);return lt.retry&&(J=C[(Ue+1)%C.length]),at.reqUserAccount(X.sid,{lts:Y,success:!1,serverAddr:J,stringUid:X.string_uid,uid:ge.uid,errorCode:lt.desc,extend:X}),lt.retry},(ge,Ue)=>ge.code!==K.OPERATION_ABORTED&&(at.reqUserAccount(X.sid,{lts:Y,success:!1,serverAddr:J,stringUid:X.string_uid,uid:null,errorCode:ge.code,extend:X}),J=C[(Ue+1)%C.length],!0),U);if(fe.code!==0){const ge=IE(fe.code);throw new Q(K.UNEXPECTED_RESPONSE,ge.desc)}return fe}(E,r,o,a,u);return h==null||h.recordJoinChannelService({status:"success",endTs:Date.now()},S),T.uid}catch(T){throw h==null||h.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[T]},S),T}}async function jK(r,o,a){const u=de("CDS_AP").slice(0,de("AJAX_REQUEST_CONCURRENT")).map(S=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(S+"/api/v1"):"https://".concat(S,"/api/v1?action=config")).map(S=>function(T,C,w,N){const M=Sn(),U={flag:64,cipher_method:0,features:{device:M.name,system:M.os,system_general:navigator.userAgent,vendor:C.appId,version:wi,cname:C.cname,sid:C.sid,session_id:C.sid,detail:"",proxyServer:C.proxyServer}};return nc(()=>Da(T,{data:U,timeout:1e3,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,Y=>Y.code!==K.OPERATION_ABORTED,N)}(S,r,o,a));let h=null,g=null,E={};try{h=await kh(u)}catch(S){if(S.code===K.OPERATION_ABORTED)throw S;g=S}if(u.forEach(S=>S.cancel()),at.reportApiInvoke(r.sid,{name:vr.REQUEST_CONFIG_DISTRIBUTE,options:{error:g,res:h}}).onSuccess(),h&&h.test_tags)try{E=function(S){if(!S.test_tags)return{};const T=S.test_tags,C=Object.keys(T),w={};return C.forEach(N=>{var M;const U=Ac(M=N.slice(4)).call(M),Y=JSON.parse(T[N])[1];w[U]=Y}),w}(h)}catch{}return E}async function z3(r,o,a,u){const h=de("PROXY_SERVER_TYPE3"),g=(U,Y,X)=>{let J=X||h;return Array.isArray(J)&&(J=Y%2==0?h[1]:h[0]),"https://".concat(J,"/ap/?url=").concat(U)};let E=null;const S=[],T=async()=>{const U=de("WEBCS_DOMAIN").slice(0,de("AJAX_REQUEST_CONCURRENT")).map((J,fe)=>{let ge;return ge=r.cloudProxyServer==="disabled"&&r.proxyServer?g("".concat(J,"/api/v2/transpond/webrtc?v=2"),fe,r.proxyServer):r.cloudProxyServer==="disabled"||r.cloudProxyServer==="fallback"?"https://".concat(J,"/api/v2/transpond/webrtc?v=2"):g("".concat(J,"/api/v2/transpond/webrtc?v=2"),fe),{url:ge,areaCode:CE(),serviceIds:[$r.CHOOSE_SERVER,r.cloudProxyServer==="proxy5"?$r.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?$r.CLOUD_PROXY:$r.CLOUD_PROXY_FALLBACK]}}),Y=u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:U.map(J=>J.url)}),X=await Tf({fragementLength:de("FRAGEMENT_LENGTH"),referenceList:U,asyncMapHandler:J=>(F.debug("[".concat(r.clientId,"] Connect to choose_server:"),J.url),U3(J,r,o,a)),allFailedhandler:J=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:J},Y),J[0]},promisesCollector:S});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},Y),X},C=async()=>{if(await vs(1e3),E!==null)return E;const U=de("WEBCS_DOMAIN_BACKUP_LIST").map((J,fe)=>{let ge;return ge=r.cloudProxyServer==="disabled"&&r.proxyServer?g("".concat(J,"/api/v2/transpond/webrtc?v=2"),fe,r.proxyServer):r.cloudProxyServer==="disabled"||r.cloudProxyServer==="fallback"?"https://".concat(J,"/api/v2/transpond/webrtc?v=2"):g("".concat(J,"/api/v2/transpond/webrtc?v=2"),fe),{url:ge,areaCode:CE(),serviceIds:[$r.CHOOSE_SERVER,r.cloudProxyServer==="proxy5"?$r.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?$r.CLOUD_PROXY:$r.CLOUD_PROXY_FALLBACK]}}),Y=u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:U.map(J=>J.url)}),X=await Tf({fragementLength:de("FRAGEMENT_LENGTH"),referenceList:U,asyncMapHandler:J=>(F.debug("[".concat(r.clientId,"] Connect to backup choose_server:"),J.url),U3(J,r,o,a)),allFailedhandler:J=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:J},Y),J[0]},promisesCollector:S});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},Y),X};let w,N,M;try{({gatewayInfo:w,proxyInfo:N,url:M}=await kh([T(),C()]))}catch(U){throw U[0]}if(S.length&&S.forEach(U=>U.cancel&&typeof U.cancel=="function"&&U.cancel()),!w||!N)throw new Q(K.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(r.apUrl=M,r.cloudProxyServer!=="disabled"&&Array.isArray(h)&&M){const U=/^https?:\/\/(.+?)(\/.*)?$/.exec(M)[1];h.includes(U)&&(r.proxyServer=U,F.setProxyServer(U),at.setProxyServer(U))}return E={gatewayInfo:w,proxyInfo:await AK(N,w.uid)},E}async function H3(r,o,a,u){const h=de("UAP_AP").slice(0,de("AJAX_REQUEST_CONCURRENT")).map(g=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(g+"/api/v1?action=uap"):"https://".concat(g,"/api/v1?action=uap"));return await UK(h,r,o,a,u)}async function WK(r,o,a){const u=de("UAP_AP").slice(0,de("AJAX_REQUEST_CONCURRENT")).map(h=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(h+"/api/v1?action=uap"):"https://".concat(h,"/api/v1?action=uap")).map(h=>function(g,E,S,T){const C={command:"convergeAllocateEdge",sid:E.sid,appId:E.appId,token:E.token,ts:Date.now(),version:wi,cname:E.cname,uid:E.uid.toString(),requestId:DS,seq:DS};DS+=1;const w={service_name:"tele_channel",json_body:JSON.stringify(C)};return nc(async()=>{const N=await Da(g,{data:w,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(N.code!==0){const U=new Q(K.UNEXPECTED_RESPONSE,"cross channel ap error, code"+N.code,{retry:!0});throw F.error(U.toString()),U}const M=JSON.parse(N.json_body);if(M.code!==200){const U=new Q(K.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(M.code,", reason: ").concat(M.reason));throw F.error(U.toString()),U}if(!M.servers||M.servers.length===0){const U=new Q(K.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw F.error(U.toString()),U}return{vid:M.vid,workerToken:M.workerToken,addressList:(de("CHANNEL_MEDIA_RELAY_SERVERS")||M.servers).map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(de("WORKER_DOMAIN"),":").concat(U.wss))}},void 0,N=>!!(N.code!==K.OPERATION_ABORTED&&N.code!==K.UNEXPECTED_RESPONSE||N.data&&N.data.retry),T)}(h,r,o,a));try{const h=await kh(u);return u.forEach(g=>g.cancel()),h}catch(h){throw h[0]}}async function GK(r,o,a){let u=null;const h=[],g=async E=>{const S=de(E?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(T=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(T+"/api/v2/transpond/webrtc?v=2"):"https://".concat(T,"/api/v2/transpond/webrtc?v=2"));return E&&(await vs(1e3),u!==null)?u:await Tf({fragementLength:de("FRAGEMENT_LENGTH"),referenceList:S,asyncMapHandler:T=>(F.debug("[".concat(r.clientId,"] update ticket, Connect to ").concat(E?"backup":""," choose_server:"),T),function(C,w,N,M){const[U]=BK(w,[$r.CHOOSE_SERVER]);let Y=ur.networkState;return nc(async()=>{Y&&ur.networkState===Ns.OFFLINE&&ur.onlineWaiter&&await Je.race([ur.onlineWaiter,vs(M&&M.maxRetryTimeout||Or.maxRetryTimeout)]),Y=ur.networkState;const X=await Da(C,{data:U,cancelToken:N,headers:{"Content-Type":"multipart/form-data;"}},!0);return VK(X,C)},()=>!1,X=>X.code!==K.OPERATION_ABORTED&&(X.code===K.UPDATE_TICKET_FAILED?X.data.retry:(F.warning("[".concat(w.clientId,"] update ticket network error, retry"),X),!0)),M)}(T,r,o,a)),allFailedhandler:T=>{throw T[0]},promisesCollector:h})};try{return u=await kh([g(!1),g(!0)]),h.length&&h.forEach(E=>E.cancel&&typeof E.cancel=="function"&&E.cancel()),u}catch(E){throw E[0]}}function K3(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function q3(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?K3(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):K3(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}class zK extends Qn{constructor(){super(),k(this,"configs",void 0),k(this,"joinInfo",void 0),k(this,"cancelToken",void 0),k(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),k(this,"interval",void 0),k(this,"mutex",new js("config-distribute")),k(this,"mutableParamsRead",!1)}startGetConfigDistribute(o,a){this.joinInfo=o,this.cancelToken=a,this.interval&&this.stopGetConfigDistribute(),de("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},de("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,at.reportApiInvoke(null,{options:void 0,name:vr.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:jn.TRACER}).onSuccess(JSON.stringify(Hl))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void F.debug("[config-distribute] get config distribute interrupted have no joininfo");let o;const a=await this.mutex.lock();try{o=await jK(this.joinInfo,this.cancelToken,this.retryConfig),F.debug("[config-distribute] get config distribute",JSON.stringify(o)),o.limit_bitrate&&this.handleBitrateLimit(o.limit_bitrate),this.cacheGlobalParameterConfig(o),this.configs=o}catch(u){const h=new Q(K.NETWORK_RESPONSE_ERROR,u);F.warning("[config-distribute] ".concat(h.toString()))}finally{a()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(o){var a;(a=o)&&a.uplink&&a.id&&a.uplink.max_bitrate!==void 0&&a.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==o.id&&this.emit(yf.UPDATE_BITRATE_LIMIT,o):this.emit(yf.UPDATE_BITRATE_LIMIT,o))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&q3({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(o){var a;const u=Zv(a=Object.keys(o).filter(g=>/^webrtc_ng_global_parameter/.test(g))).call(a);for(let g=0;g<u.length;g++)for(let E=u.length-1;E>g;E--){const S=u[E];if(typeof o[S].__priority=="number"){const T=o[S].__priority,C=u[E-1];if(typeof o[C].__priority=="number"){if(!(T>o[C].__priority))continue;{const w=S;u[E]=u[E-1],u[E-1]=w}}else{const w=S;u[E]=u[E-1],u[E-1]=w}}}const h={};u.forEach(g=>{const E=o[g],S=E.__expires;Object.keys(E).forEach(T=>{T==="__priority"||T==="__expires"||Object.prototype.hasOwnProperty.call(h,T)||(h[T]=q3({value:E[T]},S&&{expires:S}))})});try{const g=JSON.stringify(h),E=window.btoa(g);window.localStorage.setItem("websdk_ng_global_parameter",E),F.debug("Caching global parameters ".concat(g))}catch(g){F.error("Error caching global parameters:",g.message)}}}function X3(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function Cf(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?X3(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):X3(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}class HK extends Qn{constructor(o,a,u,h){super(),k(this,"spec",void 0),k(this,"token",void 0),k(this,"websocket",void 0),k(this,"pingpongTimer",void 0),k(this,"reconnectMode","retry"),k(this,"serviceMode",void 0),k(this,"reqId",0),k(this,"commandReqId",0),k(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),k(this,"handleWebSocketMessage",g=>{if(!g.data)return;const E=JSON.parse(g.data);E.requestId?this.emit("@".concat(E.requestId,"-").concat(E.sid),E):this.serviceMode===Sr.INJECT?this.emit(Zi.INJECT_STREAM_STATUS,E):(at.workerEvent(this.spec.sid,{actionType:"status",serverCode:E.code,workerType:this.serviceMode===Sr.TRANSCODE?1:2}),this.emit(Zi.PUBLISH_STREAM_STATUS,E))}),this.spec=a,this.token=o,this.serviceMode=h,this.websocket=new Dh("live-streaming",u),this.websocket.on(kt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(kt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(kt.REQUEST_NEW_URLS,(g,E)=>{Ss(this,Zi.REQUEST_NEW_ADDRESS).then(g).catch(E)}),this.websocket.on(kt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(o){return this.websocket.init(o)}async request(o,a,u,h){this.reqId+=1,o==="request"&&(this.commandReqId+=1);const g=this.commandReqId,E=this.reqId;if(!E||!this.websocket)throw new Q(K.UNEXPECTED_ERROR);const S=Cf({command:o,sdkVersion:wi==="4.17.0"?"0.0.1":wi,seq:E,requestId:E,allocate:u,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},a);if(this.websocket.state==="closed")throw new Q(K.WS_DISCONNECT);const T=()=>new Je((M,U)=>{this.websocket.once(kt.CLOSED,()=>U(new Q(K.WS_ABORT))),this.websocket.once(kt.CONNECTED,M)});this.websocket.state!=="connected"&&await T(),S.clientRequest&&(S.clientRequest.workerToken=this.token);const C=new Je((M,U)=>{const Y=()=>{U(new Q(K.WS_ABORT))};this.websocket.once(kt.RECONNECTING,Y),this.websocket.once(kt.CLOSED,Y),this.once("@".concat(E,"-").concat(this.spec.sid),X=>{M(X)})});h&&at.workerEvent(this.spec.sid,Cf(Cf({},h),{},{requestId:g,actionType:"request",payload:JSON.stringify(a.clientRequest),serverCode:0,code:0}));const w=Date.now();this.websocket.sendMessage(S);let N=null;try{N=await C}catch(M){if(this.websocket.state==="closed")throw M;return await T(),await this.request(o,a,u)}return h&&at.workerEvent(this.spec.sid,Cf(Cf({},h),{},{requestId:g,actionType:"response",payload:JSON.stringify(N.serverResponse),serverCode:N.code,success:N.code===200,responseTime:Date.now()-w})),N.code!==200&&this.handleResponseError(N),N}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const o=wi==="4.17.0"?"0.0.1":wi;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:o,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(o){switch(o.code){case Zn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void F.warning("live stream response already exists stream");case Zn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Zn.LIVE_STREAM_RESPONSE_BAD_STREAM:case Zn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Q(K.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:o.code}).throw();case Zn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(o.serverResponse.command==="UnpublishStream"||o.serverResponse.command==="UninjectStream")return;throw new Q(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Zn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Q(K.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:o.code}).throw();case Zn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const a=new Q(K.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Zi.WARNING,a,o.serverResponse.url)}case Zn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const a=new Q(K.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Zi.WARNING,a,o.serverResponse.url)}case Zn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Q(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Zn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Q(K.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:o.code}).throw();case Zn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const a=new Q(K.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Zi.WARNING,a,o.serverResponse.url)}case Zn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Q(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:o.code}).throw();case Zn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Q(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Zn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Zn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(o.serverResponse.command==="UnpublishStream"||o.serverResponse.command==="UninjectStream")return;throw new Q(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Zn.ERROR_FAIL_SEND_MESSAGE:if(o.serverResponse.command==="UnpublishStream"||o.serverResponse.command==="UninjectStream")return;if(o.serverResponse.command==="UpdateTranscoding"||o.serverResponse.command==="ControlStream")return new Q(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:o.code}).throw();throw new Q(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Zn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Zn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Zn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Zn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Q(K.LIVE_STREAMING_CDN_ERROR,"",{code:o.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(SE)},6e3)}}function Y3(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function so(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?Y3(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):Y3(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}class KK extends Qn{constructor(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Or,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Or;super(),k(this,"onLiveStreamWarning",void 0),k(this,"onLiveStreamError",void 0),k(this,"onInjectStatusChange",void 0),k(this,"spec",void 0),k(this,"retryTimeout",1e4),k(this,"connection",void 0),k(this,"httpRetryConfig",void 0),k(this,"wsRetryConfig",void 0),k(this,"streamingTasks",new Map),k(this,"isStartingStreamingTask",!1),k(this,"taskMutex",new js("live-streaming")),k(this,"cancelToken",Ji.CancelToken.source()),k(this,"transcodingConfig",void 0),k(this,"injectConfig",so({},dH)),k(this,"injectLoopTimes",0),k(this,"uapResponse",void 0),k(this,"lastTaskId",1),k(this,"statusError",new Map),this.spec=o,this.httpRetryConfig=u,this.wsRetryConfig=a}async setTranscodingConfig(o){const a=so(so({},lH),o);a.videoCodecProfile!==66&&a.videoCodecProfile!==77&&a.videoCodecProfile!==100&&(F.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(a.videoCodecProfile," -> 100")),a.videoCodecProfile=100),a.transcodingUsers||(a.transcodingUsers=a.userConfigs),a.transcodingUsers&&(a.transcodingUsers=a.transcodingUsers.map(E=>so(so(so({},uH),E),{},{zOrder:E.zOrder?E.zOrder+1:1}))),function(E){Ln(E.width)||Nn(E.width,"config.width",0,1e4),Ln(E.height)||Nn(E.height,"config.height",0,1e4),Ln(E.videoBitrate)||Nn(E.videoBitrate,"config.videoBitrate",1,1e6),Ln(E.videoFrameRate)||Nn(E.videoFrameRate,"config.videoFrameRate"),Ln(E.lowLatency)||gf(E.lowLatency,"config.lowLatency"),Ln(E.audioSampleRate)||bs(E.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Ln(E.audioBitrate)||Nn(E.audioBitrate,"config.audioBitrate",1,128),Ln(E.audioChannels)||bs(E.audioChannels,"config.audioChannels",[1,2,3,4,5]),Ln(E.videoGop)||Nn(E.videoGop,"config.videoGop"),Ln(E.videoCodecProfile)||bs(E.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Ln(E.userCount)||Nn(E.userCount,"config.userCount",0,17),Ln(E.backgroundColor)||Nn(E.backgroundColor,"config.backgroundColor",0,16777215),Ln(E.userConfigExtraInfo)||ms(E.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),E.transcodingUsers&&!Ln(E.transcodingUsers)&&(Dc(E.transcodingUsers,"config.transcodingUsers"),E.transcodingUsers.forEach((S,T)=>{nS(S.uid),Ln(S.x)||Nn(S.x,"transcodingUser[".concat(T,"].x"),0,1e4),Ln(S.y)||Nn(S.y,"transcodingUser[".concat(T,"].y"),0,1e4),Ln(S.width)||Nn(S.width,"transcodingUser[".concat(T,"].width"),0,1e4),Ln(S.height)||Nn(S.height,"transcodingUser[".concat(T,"].height"),0,1e4),Ln(S.zOrder)||Nn(S.zOrder-1,"transcodingUser[".concat(T,"].zOrder"),0,100),Ln(S.alpha)||Nn(S.alpha,"transcodingUser[".concat(T,"].alpha"),0,1,!1)})),Ln(E.watermark)||uS(E.watermark,"watermark"),Ln(E.backgroundImage)||uS(E.backgroundImage,"backgroundImage"),E.images&&!Ln(E.images)&&(Dc(E.images,"config.images"),E.images.forEach((S,T)=>{uS(S,"images[".concat(T,"]"))}))}(a);const u=[];a.images&&u.push(...a.images.map(E=>so(so(so({},cS),E),{},{zOrder:255}))),a.backgroundImage&&(u.push(so(so(so({},cS),a.backgroundImage),{},{zOrder:0})),delete a.backgroundImage),a.watermark&&(u.push(so(so(so({},cS),a.watermark),{},{zOrder:255})),delete a.watermark),a.images=u,a.transcodingUsers&&(a.userConfigs=a.transcodingUsers.map(E=>so({},E)),a.userCount=a.transcodingUsers.length,delete a.transcodingUsers);const h=(a.userConfigs||[]).map(E=>typeof E.uid=="number"?Je.resolve(E.uid):G3(E.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Je.all(h)).forEach((E,S)=>{a.userConfigs&&a.userConfigs[S]&&(a.userConfigs[S].uid=E)}),this.transcodingConfig=a,this.connection)try{var g;const E=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(oc(g=this.streamingTasks).call(g)).map(S=>S.taskId).join("#")});F.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(E.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(E){if(!E.data||!E.data.retry)throw E;E.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(S=>{F.warning("[".concat(this.spec.clientId,"] live streaming receive error"),E.toString(),"try to republish",S.url),this.startLiveStreamingTask(S.url,S.mode,E).then(()=>{F.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(S.url," success"))}).catch(T=>{F.error("[".concat(this.spec.clientId,"] live streaming republish failed"),S.url,T.toString()),this.onLiveStreamError&&this.onLiveStreamError(S.url,T)})})}}setInjectStreamConfig(o,a){this.injectConfig=Object.assign({},this.injectConfig,o),this.injectLoopTimes=a}async startLiveStreamingTask(o,a,u){var h;if(Array.from(oc(h=this.streamingTasks).call(h)).find(T=>T.mode===Sr.INJECT)&&a===Sr.INJECT)return new Q(K.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&a===Sr.TRANSCODE)throw new Q(K.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let g={command:"PublishStream",ts:Date.now(),url:o,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};F.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(o,", mode: ").concat(a));const E=await this.taskMutex.lock();if(!this.connection&&u)return void E();if(this.streamingTasks.get(o)&&!u)return E(),new Q(K.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(a))}catch(T){throw E(),T}switch(a){case Sr.TRANSCODE:g.transcodingConfig=so({},this.transcodingConfig);break;case Sr.RAW:break;case Sr.INJECT:g={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:o,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(g.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const S=this.lastTaskId++;try{const T=new Je((w,N)=>{vs(this.retryTimeout).then(()=>{if(u)return N(u);const M=this.statusError.get(o);return M?(this.statusError.delete(o),N(M)):void 0})}),C=await Je.race([this.connection.request("request",{clientRequest:g},!0,{url:o,command:"PublishStream",workerType:a===Sr.TRANSCODE?1:2,requestByUser:!u,tid:S.toString()}),T]);this.isStartingStreamingTask=!1,F.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(C.code)),this.streamingTasks.set(o,{clientRequest:g,mode:a,url:o,taskId:S}),E()}catch(T){if(E(),this.isStartingStreamingTask=!1,!T.data||!T.data.retry||u)throw T;return T.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(o,a,T)):await this.startLiveStreamingTask(o,a,T)}}stopLiveStreamingTask(o){return new Je((a,u)=>{const h=this.streamingTasks.get(o);if(!h||!this.connection)return new Q(K.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const g=h.mode;h.abortTask=()=>{F.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(o),a()},this.connection.request("request",{clientRequest:{command:g===Sr.INJECT?"UninjectStream":"UnpublishStream",url:h.url}},!1,{url:o,command:"UnPublishStream",workerType:g===Sr.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(E=>{F.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(E.code)),this.streamingTasks.delete(o),this.streamingTasks.size===0&&g!==Sr.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),a(),g===Sr.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Nu.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,o)}).catch(u)})}async controlInjectStream(o,a,u,h){const g=this.streamingTasks.get(o);if(!g||!this.connection||g.mode!==Sr.INJECT)throw new Q(K.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:o,control:a,audioVolume:u,position:h}})).serverResponse}resetAllTask(){var o;const a=Array.from(oc(o=this.streamingTasks).call(o));this.terminate();for(const u of a)this.startLiveStreamingTask(u.url,u.mode).catch(h=>{this.onLiveStreamError&&this.onLiveStreamError(u.url,h)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ji.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(o){if(this.connection)throw new Q(K.UNEXPECTED_ERROR,"live streaming connection has already connected");const a=await Ss(this,wh.REQUEST_WORKER_MANAGER_LIST,o);return this.uapResponse=a,this.connection=new HK(a.workerToken,this.spec,this.wsRetryConfig,o),this.connection.on(Zi.WARNING,(u,h)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(h,u)),this.connection.on(Zi.PUBLISH_STREAM_STATUS,u=>this.handlePublishStreamServer(u)),this.connection.on(Zi.INJECT_STREAM_STATUS,u=>this.handleInjectStreamServerStatus(u)),this.connection.on(Zi.REQUEST_NEW_ADDRESS,(u,h)=>{if(!this.connection)return h(new Q(K.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ss(this,wh.REQUEST_WORKER_MANAGER_LIST,o).then(g=>{this.uapResponse=g,u(g.addressList)}).catch(h)}),await this.connection.init(a.addressList),this.connection}handlePublishStreamServer(o){const a=o.serverStatus&&o.serverStatus.url||"empty_url",u=this.streamingTasks.get(a),h=o.reason;switch(o.code){case Zn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Zn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Zn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Zn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const E=new Q(K.LIVE_STREAMING_CDN_ERROR,"",{code:o.code});if(u)return F.error(E.toString()),this.onLiveStreamError&&this.onLiveStreamError(a,E);if(!this.isStartingStreamingTask)return;this.statusError.set(a,E)}case Zn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const E=new Q(K.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,h);return this.onLiveStreamWarning&&this.onLiveStreamWarning(a,E)}case Zn.LIVE_STREAM_RESPONSE_WORKER_LOST:case Zn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var g;if(!this.connection)return;this.connection.tryNextAddress();const E=Array.from(oc(g=this.streamingTasks).call(g));for(const S of E)S.abortTask?S.abortTask():(F.warning("[".concat(this.spec.clientId,"] publish stream status code"),o.code,"try to republish",S.url),this.startLiveStreamingTask(S.url,S.mode,new Q(K.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:o.code})).then(()=>{F.debug("[".concat(this.spec.clientId,"] republish live stream success"),S.url)}).catch(T=>{F.error(T.toString()),this.onLiveStreamError&&this.onLiveStreamError(S.url,T)}));return}}}handleInjectStreamServerStatus(o){const a=Number(o.uid),u=o.serverStatus&&o.serverStatus.url;switch(o.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Nu.INJECT_STREAM_STATUS_START_SUCCESS,a,u));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Nu.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,a,u),void this.streamingTasks.delete(u);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Nu.INJECT_STREAM_STATUS_START_UNAUTHORIZED,a,u),void this.streamingTasks.delete(u);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Nu.INJECT_STREAM_STATUS_BROKEN,a,u),void this.streamingTasks.delete(u);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Nu.INJECT_STREAM_STATUS_START_TIMEOUT,a,u),void this.streamingTasks.delete(u);default:return void F.debug("inject stream server status",o)}}hasUrl(o){return this.streamingTasks.has(o)}}class J3{constructor(){k(this,"destChannelMediaInfos",new Map),k(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(o){Kx(o),this.srcChannelMediaInfo=o}addDestChannelInfo(o){Kx(o),this.destChannelMediaInfos.set(o.channelName,o)}removeDestChannelInfo(o){tS(o),this.destChannelMediaInfos.delete(o)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Q3(r){if(!(r instanceof J3))return new Q(K.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const o=r.getSrcChannelMediaInfo(),a=r.getDestChannelMediaInfo();if(!o)return new Q(K.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(a.size===0)return new Q(K.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class qK extends Qn{constructor(o,a,u){super(),k(this,"ws",void 0),k(this,"requestId",1),k(this,"heartBeatTimer",void 0),k(this,"joinInfo",void 0),k(this,"clientId",void 0),k(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),k(this,"onClose",h=>{this.emit("close"),this.dispose()}),k(this,"onMessage",h=>{const g=JSON.parse(h.data);if(!g||g.command!=="serverResponse"||!g.requestId)return g&&g.command==="serverStatus"&&g.serverStatus&&g.serverStatus.command?(this.emit("status",g.serverStatus),void this.emit(g.serverStatus.command,g.serverStatus)):void 0;this.emit("req_".concat(g.requestId),g)}),this.joinInfo=o,this.clientId=a,this.ws=new Dh("cross-channel-".concat(this.clientId),u),this.ws.on(kt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(kt.CONNECTED,this.onOpen),this.ws.on(kt.ON_MESSAGE,this.onMessage),this.ws.on(kt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(o){const a=this.requestId++;return o.requestId=a,o.seq=a,this.ws.sendMessage(o),a}waitStatus(o){return new Je((a,u)=>{const h=window.setTimeout(()=>{u(new Q(K.TIMEOUT,"wait status timeout, status: ".concat(o)))},5e3);this.once(o,g=>{window.clearTimeout(h),g.state&&g.state!==0?u(new Q(K.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(o))):a(void 0)}),this.once("dispose",()=>{window.clearTimeout(h),u(new Q(K.WS_ABORT))})})}async request(o){if(this.ws.state==="closed")throw new Q(K.WS_DISCONNECT);const a=()=>new Je((E,S)=>{this.ws.once(kt.CLOSED,()=>S(new Q(K.WS_ABORT))),this.ws.once(kt.CONNECTED,E)});this.ws.state!=="connected"&&await a();const u=this.sendMessage(o),h=new Je((E,S)=>{const T=()=>{S(new Q(K.WS_ABORT))};this.ws.once(kt.RECONNECTING,T),this.ws.once(kt.CLOSED,T),this.once("req_".concat(u),E),vs(3e3).then(()=>{this.removeAllListeners("req_".concat(u)),this.ws.off(kt.RECONNECTING,T),this.ws.off(kt.CLOSED,T),S(new Q(K.TIMEOUT,"cross channel ws request timeout"))})}),g=await h;if(!g||g.code!==200)throw new Q(K.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(g)));return g}async connect(o){this.ws.removeAllListeners(kt.REQUEST_NEW_URLS),this.ws.on(kt.REQUEST_NEW_URLS,a=>{a(o)}),await this.ws.init(o)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(o){const a=this.requestId++;return o.requestId=a,this.ws.sendMessage(o),a}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class XK extends Qn{set state(o){o!==this._state&&(o!==ro.RELAY_STATE_FAILURE&&(this.errorCode=Au.RELAY_OK),this.emit("state",o,this.errorCode),this._state=o)}get state(){return this._state}constructor(o,a,u,h){super(),k(this,"joinInfo",void 0),k(this,"sid",void 0),k(this,"clientId",void 0),k(this,"cancelToken",Ji.CancelToken.source()),k(this,"workerToken",void 0),k(this,"requestId",0),k(this,"signal",void 0),k(this,"prevChannelMediaConfig",void 0),k(this,"httpRetryConfig",void 0),k(this,"_state",ro.RELAY_STATE_IDLE),k(this,"errorCode",Au.RELAY_OK),k(this,"onStatus",g=>{F.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(g))),g&&g.command&&(g.command==="onAudioPacketReceived"&&this.emit("event",ka.PACKET_RECEIVED_AUDIO_FROM_SRC),g.command==="onVideoPacketReceived"&&this.emit("event",ka.PACKET_RECEIVED_VIDEO_FROM_SRC),g.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Au.SRC_TOKEN_EXPIRED,this.state=ro.RELAY_STATE_FAILURE),g.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Au.DEST_TOKEN_EXPIRED,this.state=ro.RELAY_STATE_FAILURE))}),k(this,"onReconnect",async()=>{F.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",ka.NETWORK_DISCONNECTED),this.state=ro.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(g=>{this.state!==ro.RELAY_STATE_IDLE&&(F.error("auto restart channel media relay failed",g.toString()),this.errorCode=Au.SERVER_CONNECTION_LOST,this.state=ro.RELAY_STATE_FAILURE)})}),this.joinInfo=o,this.clientId=a,this.sid=RS(),this.signal=new qK(this.joinInfo,this.clientId,u),this.httpRetryConfig=h}async startChannelMediaRelay(o){if(this.state!==ro.RELAY_STATE_IDLE)throw new Q(K.INVALID_OPERATION);this.state=ro.RELAY_STATE_CONNECTING,await this.connect(),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(o)}catch(a){throw a.data&&a.data.serverResponse&&a.data.serverResponse.command==="SetSourceChannel"?new Q(K.CROSS_CHANNEL_FAILED_JOIN_SRC):a.data&&a.data.serverResponse&&a.serverResponse.command==="SetDestChannelStatus"?new Q(K.CROSS_CHANNEL_FAILED_JOIN_DEST):a.data&&a.data.serverResponse&&a.serverResponse.command==="StartPacketTransfer"?new Q(K.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):a}this.prevChannelMediaConfig=o}async updateChannelMediaRelay(o){if(this.state!==ro.RELAY_STATE_RUNNING)throw new Q(K.INVALID_OPERATION);await this.sendUpdateMessage(o),this.prevChannelMediaConfig=o}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),F.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ro.RELAY_STATE_IDLE,this.dispose()}dispose(){F.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ji.CancelToken.source(),this.state=ro.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const o=await WK(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=o.workerToken,await this.signal.connect(o.addressList),this.emit("event",ka.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(o){const a=this.genMessage(Vs.StopPacketTransfer);await this.signal.request(a),await this.signal.waitStatus("Normal Quit"),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const u=this.genMessage(Vs.SetSdkProfile,o);await this.signal.request(u),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const h=this.genMessage(Vs.SetSourceChannel,o);await this.signal.request(h),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",ka.PACKET_JOINED_SRC_CHANNEL),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const g=this.genMessage(Vs.SetSourceUserId,o);await this.signal.request(g),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const E=this.genMessage(Vs.SetDestChannel,o);await this.signal.request(E),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",ka.PACKET_JOINED_DEST_CHANNEL),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const S=this.genMessage(Vs.StartPacketTransfer,o);await this.signal.request(S),this.emit("event",ka.PACKET_SENT_TO_DEST_CHANNEL),this.state=ro.RELAY_STATE_RUNNING,F.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))}async sendUpdateMessage(o){const a=this.genMessage(Vs.UpdateDestChannel,o);await this.signal.request(a),this.emit("event",ka.PACKET_UPDATE_DEST_CHANNEL),F.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const o=this.genMessage(Vs.StopPacketTransfer);await this.signal.request(o),F.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(o,a){const u=[],h=[],g=[];this.requestId+=1;const E={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:wi,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};E.sdkVersion==="4.17.0"&&(E.sdkVersion="0.0.1");let S=null,T=null;switch(o){case Vs.SetSdkProfile:return E.clientRequest={command:"SetSdkProfile",type:"multi_channel"},E;case Vs.SetSourceChannel:if(T=a&&a.getSrcChannelMediaInfo(),!T)throw new Q(K.UNEXPECTED_ERROR,"can not find source config");return E.clientRequest={command:"SetSourceChannel",uid:"0",channelName:T.channelName,token:T.token||this.joinInfo.appId},E;case Vs.SetSourceUserId:if(T=a&&a.getSrcChannelMediaInfo(),!T)throw new Q(K.UNEXPECTED_ERROR,"can not find source config");return E.clientRequest={command:"SetSourceUserId",uid:T.uid+""},E;case Vs.SetDestChannel:if(S=a&&a.getDestChannelMediaInfo(),!S)throw new Q(K.UNEXPECTED_ERROR,"can not find dest config");return S.forEach(C=>{u.push(C.channelName),h.push(C.uid+""),g.push(C.token||this.joinInfo.appId)}),E.clientRequest={command:"SetDestChannel",channelName:u,uid:h,token:g},E;case Vs.StartPacketTransfer:return E.clientRequest={command:"StartPacketTransfer"},E;case Vs.Reconnect:return E.clientRequest={command:"Reconnect"},E;case Vs.StopPacketTransfer:return E.clientRequest={command:"StopPacketTransfer"},E;case Vs.UpdateDestChannel:if(S=a&&a.getDestChannelMediaInfo(),!S)throw new Q(K.UNEXPECTED_ERROR,"can not find dest config");return S.forEach(C=>{u.push(C.channelName),h.push(C.uid+""),g.push(C.token||this.joinInfo.appId)}),E.clientRequest={command:"UpdateDestChannel",channelName:u,uid:h,token:g},E}return E}}const MS=r=>{const o=document.createElement("canvas");return o.width=2,o.height=2,new Je((a,u)=>{o.toBlob(async h=>{if(o.remove(),h){const g=await Z3(h);a({buffer:g,width:o.width,height:o.height})}else u(new Q(K.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,1)})},Z3=async r=>{const o=await r.arrayBuffer();return new Uint8Array(o)};function eD(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function tD(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?eD(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):eD(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}class nD{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(o){o!==this._videoElementStatus&&(F.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(o)),this._videoElementStatus=o)}constructor(o){k(this,"trackId",void 0),k(this,"config",void 0),k(this,"onFirstVideoFrameDecoded",void 0),k(this,"freezeTimeCounterList",[]),k(this,"renderFreezeAccTime",0),k(this,"timeUpdatedCount",0),k(this,"freezeTime",0),k(this,"playbackTime",0),k(this,"lastTimeUpdatedTime",0),k(this,"autoplayFailed",!1),k(this,"videoTrack",void 0),k(this,"container",void 0),k(this,"videoElement",void 0),k(this,"cacheVideoElement",void 0),k(this,"videoElementCheckInterval",void 0),k(this,"_videoElementStatus",as.NONE),k(this,"slot",void 0),k(this,"isGettingVideoDimensions",!1),k(this,"handleVideoEvents",a=>{switch(a.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=as.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.container&&this.container.removeChild(this.cacheVideoElement)}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=as.CANPLAY;break;case"stalled":this.videoElementStatus=as.STALLED;break;case"suspend":this.videoElementStatus=as.SUSPEND;break;case"pause":this.videoElementStatus=as.PAUSED,eo()||xc()||Vo()&&this.autoplayFailed||!this.videoElement||!this.videoTrack||this.videoTrack.readyState!=="live"||(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=as.WAITING;break;case"abort":this.videoElementStatus=as.ABORT;break;case"ended":this.videoElementStatus=as.ENDED;break;case"emptied":this.videoElementStatus=as.EMPTIED;break;case"error":{var u;this.videoElementStatus=as.ERROR;const h=(u=this.videoElement)===null||u===void 0?void 0:u.error;h&&F.error("[".concat(this.trackId,"] media error, code: ").concat(h.code,", message: ").concat(h.message));break}case"timeupdate":{const h=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=h);const g=h-this.lastTimeUpdatedTime,E=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=h,Lc.lastVisibleTime<Lc.lastHiddenTime||E<Lc.lastHiddenTime||E<Lc.lastVisibleTime)return;for(g>de("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=g),this.playbackTime+=g;this.playbackTime>=6e3;){this.playbackTime-=6e3;const S=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(S),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),k(this,"startGetVideoDimensions",()=>{const a=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement&&this.videoElement.videoWidth*this.videoElement.videoHeight>4)return F.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(a,500)};!this.isGettingVideoDimensions&&a()}),k(this,"autoResumeAfterInterruption",()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&Gt.curState==="running"&&(Rv()?(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.2")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):jO()?(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):BO()&&(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()))}),k(this,"autoResumeAfterInterruptionOnIOS15",()=>{this.videoElement&&this.videoTrack&&this.videoTrack.readyState==="live"&&(Rv()?(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.2")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):jO()?(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):BO()&&(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()))}),this.slot=o.element,this.trackId=o.trackId,this.updateConfig(o),Gt.on(Fr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Gt.on(Fr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}updateConfig(o){this.config=o,this.trackId=o.trackId;const a=o.element;a!==this.slot&&(this.destroy(),this.slot=a),this.createElements()}updateVideoTrack(o){this.videoTrack!==o&&(this.videoTrack=o,this.createElements())}play(o){if(this.videoElement){const a=this.videoElement.play();a&&a.catch&&a.catch(h=>{o&&at.autoplayFailed(o,"video",h.message,this.trackId),h.name==="NotAllowedError"?(F.warning("detected video element autoplay failed",h),this.autoplayFailed=!0,this.handleAutoPlayFailed()):F.warning("[".concat(this.trackId,"] play warning: "),h)});const u=Sn();if((u.name==="Safari"&&Number(u.version)===15||fh())&&a&&a.then&&a.catch){const h=()=>{this.config.mirror&&this.videoElement&&(this.videoElement.style.transform="rotateY(180deg)")};a.then(h).catch(h)}}}getCurrentFrame(){if(!this.videoElement)return new ImageData(2,2);const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const a=o.getContext("2d");if(!a)return F.error("create canvas context failed!"),new ImageData(2,2);a.drawImage(this.videoElement,0,0,o.width,o.height);const u=a.getImageData(0,0,o.width,o.height);return o.remove(),u}async getCurrentFrameToUint8Array(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(!this.videoElement)return await MS(o);const u=document.createElement("canvas");u.width=this.videoElement.videoWidth,u.height=this.videoElement.videoHeight;const h=u.getContext("2d");return h?(h.drawImage(this.videoElement,0,0,u.width,u.height),new Je((g,E)=>{u.toBlob(async S=>{if(u.remove(),S){const T=await Z3(S);g({buffer:T,width:u.width,height:u.height})}else E(new Q(K.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},o,a<0?.1:a>1?1:a)})):await MS(o)}destroy(){if(Gt.off(Fr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Gt.off(Fr.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),this.videoElement&&(this.videoElement.srcObject=null,this.videoElement.remove(),this.videoElement=void 0),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}this.freezeTimeCounterList=[]}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",de("KEEP_LAST_FRAME")&&this.resetVideoElement(),this.createVideoElement(),this.container.appendChild(this.videoElement)):this.removeVideoElement(),this.slot.appendChild(this.container)}createVideoElement(){if(!this.videoElement&&(this.videoElementStatus=as.INIT,this.videoElement=document.createElement("video"),this.container&&this.container.appendChild(this.videoElement),$S.forEach(g=>{this.videoElement&&this.videoElement.addEventListener(g,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{!document.getElementById("video_".concat(this.trackId))&&this.videoElement&&(this.videoElementStatus=as.DESTROYED)},1e3),de("ENABLE_VIDEO_FRAME_CALLBACK"))){var o,a;let g;const E=(S,T)=>{if(this.videoElementStatus===as.PLAYING){if(g){const N=T.presentationTime-g.presentationTime;N>de("VIDEO_FREEZE_DURATION")&&Lc.lastVisibleTime>=Lc.lastHiddenTime&&g.timestamp>Lc.lastVisibleTime&&g.timestamp>Lc.lastHiddenTime&&(this.renderFreezeAccTime+=N)}g=tD(tD({},T),{},{timestamp:S})}var C,w;de("ENABLE_VIDEO_FRAME_CALLBACK")&&((C=this.videoElement)===null||C===void 0||(w=C.requestVideoFrameCallback)===null||w===void 0||w.call(C,E))};(o=(a=this.videoElement).requestVideoFrameCallback)===null||o===void 0||o.call(a,E)}this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),this.videoElement.style.left="0",this.videoElement.style.top="0",bv()&&(this.videoElement.poster="noposter");const u=Sn();u.name==="Safari"&&Number(u.version)===15||fh()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Jn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Jn()&&this.videoElement.load());const h=this.videoElement.play();h!==void 0&&h.catch(g=>{F.debug("[".concat(this.trackId,"] playback interrupted"),g.toString())})}removeVideoElement(){if(this.videoElement){$S.forEach(o=>{this.videoElement&&this.videoElement.removeEventListener(o,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0);try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=void 0,this.videoElementStatus=as.NONE}}resetVideoElement(){this.videoElement&&($S.forEach(o=>{this.videoElement&&this.videoElement.removeEventListener(o,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.cacheVideoElement=this.videoElement,this.videoElement=void 0,this.videoElementStatus=as.NONE)}handleAutoPlayFailed(){if(this.videoElement){const o=a=>{a.preventDefault(),this.videoElement&&(this.videoElement.play().then(()=>{F.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(u=>{F.error(u)}),this.autoplayFailed=!1,hf()?document.body.removeEventListener("click",o,!0):(document.body.removeEventListener("touchstart",o,!0),document.body.removeEventListener("mousedown",o,!0)))};hf()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0)),uk()}}getVideoElement(){return this.videoElement}getContainerElement(){return this.container}}const $S=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];function FS(r){const o={};r.facingMode&&(o.facingMode=r.facingMode),r.cameraId&&(o.deviceId={exact:r.cameraId});const a=Sh(r.encoderConfig);return o.width=a.width,o.height=a.height,!GO()&&a.frameRate&&(o.frameRate=a.frameRate),Sn().name===En.EDGE&&typeof o.frameRate=="object"&&(o.frameRate.max=60),Jn()&&(o.frameRate={ideal:30,max:30}),o}function YK(r){const o={};r.screenSourceType&&(o.mediaSource=r.screenSourceType),r.extensionId&&wv()&&(o.extensionId=r.extensionId),r.electronScreenSourceId&&(o.sourceId=r.electronScreenSourceId);const a=r.encoderConfig?Kv(r.encoderConfig):null;return o.mandatory={chromeMediaSource:"desktop",maxWidth:a?a.width:void 0,maxHeight:a?a.height:void 0},a&&a.frameRate&&(typeof a.frameRate=="number"?(o.mandatory.maxFrameRate=a.frameRate,o.mandatory.minFrameRate=a.frameRate):(o.mandatory.maxFrameRate=a.frameRate.max||a.frameRate.ideal||a.frameRate.exact||void 0,o.mandatory.minFrameRate=a.frameRate.min||a.frameRate.ideal||a.frameRate.exact||void 0),o.frameRate=a.frameRate),a&&a.width&&(o.width=a.width),a&&a.height&&(o.height=a.height),o}function rD(r){const o={};if(GO()||(r.AGC!==void 0&&(o.autoGainControl=r.AGC),r.AEC!==void 0&&(o.echoCancellation=r.AEC),r.ANS!==void 0&&(o.noiseSuppression=r.ANS,wv()&&r.ANS&&(o.googHighpassFilter=r.ANS))),r.encoderConfig){const a=uE(r.encoderConfig);o.channelCount=a.stereo?2:1,o.sampleRate=a.sampleRate,o.sampleSize=a.sampleSize}return r.microphoneId&&(o.deviceId={exact:r.microphoneId}),bv()&&(o.sampleRate=void 0),o}var Ph,RE;(function(r){r.COVERED="COVERED",r.POSITION="POSITION",r.SIZE="SIZE",r.STYLE="STYLE"})(Ph||(Ph={})),function(r){r.UNMOUNTED="UNMOUNTED",r.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(RE||(RE={}));var sD,oD,iD,aD,cD,uD,lD,dD,hD,pD,fD,mD,gD,ED,_D,yD,vD,SD,TD,ID,CD,wD,Ht,RD,bD,ND,AD,OD,xD,kD,DD,Oi,PD=new class{constructor(){k(this,"_clientSize",null),k(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),k(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),k(this,"getStyle",r=>window.getComputedStyle(r,null)),k(this,"checkCssVisibleProperty",r=>{let o=!0;const a=this.getStyle(r),{display:u,visibility:h,opacity:g,filter:E}=a;return(u==="none"||["hidden","collapse"].includes(h)||Number(g)<.1)&&(o=!1),o?(E&&E.split(" ").filter(S=>{const T=S.split("(")[0];return["brightness","blur","opacity"].includes(T)}).map(S=>{const[T,C]=S.split(/\(|\)/);return[T,Number(C.match(/^[0-9\.]+/))]}).forEach(S=>{const[T,C]=S;switch(T){case"brightness":(C<.1||C>3)&&(o=!1);break;case"blur":C>3&&(o=!1);break;case"opacity":C<.1&&(o=!1)}}),o):!1}),k(this,"checkPropertyUpToAllParentNodes",(r,o)=>{let a=!0,u=!0;const h=E=>o(E);let g=r;for(;g&&u;)h(g)||(a=!1,u=!1),g=g.parentElement,g||(u=!1);return a}),k(this,"checkActualCssVisibleIncludeInherit",r=>this.checkPropertyUpToAllParentNodes(r,this.checkCssVisibleProperty)),k(this,"getSizeAboutClient",r=>{const{width:o,height:a,left:u,right:h,top:g,bottom:E}=r.getBoundingClientRect(),S=this.getClientWidth(),T=this.getClientHeight();return{width:o,height:a,left:u,right:h,top:g,bottom:E,clientWidth:S,clientHeight:T,clientMin:Math.min(S,T)}}),k(this,"checkActualSize",()=>{const{width:r,height:o,clientMin:a}=this._clientSize;return this.checkSizeIsVisible(r,o,a)}),k(this,"elementFromPoint",(r,o)=>document.elementFromPoint?document.elementFromPoint(r,o):null),k(this,"checkCoverForAPoint",(r,o,a)=>{const u=this.elementFromPoint(r,o);return u!==null&&u!==a}),k(this,"getPointPositionList",()=>{const{width:r,height:o,left:a,top:u}=this._clientSize,h=r/6,g=o/6,E=[],S=10**6;for(let T=0;T<5;T++)for(let C=0;C<5;C++){const w=(a*S+(T===0?.1:T===4?(h*T*S-1e5)/S:h*T)*S)/S,N=(u*S+(C===0?.1:C===4?(g*C*S-1e5)/S:g*C)*S)/S;E.push({x:w,y:N})}return[...E]}),k(this,"checkElementCover",r=>this.getPointPositionList().map(o=>this.checkCoverForAPoint(o.x,o.y,r)).filter(o=>!!o).length>6),k(this,"checkSizeIsVisible",(r,o,a)=>(r>50||a/r<=10)&&(o>50||a/o<=10)),k(this,"checkSizeOfPartInClient",()=>{const{left:r,right:o,top:a,bottom:u,clientHeight:h,clientWidth:g,clientMin:E}=this._clientSize;let S,T,C,w;if(r<0)S=0;else{if(!(r<g))return!1;S=r}if(o<0)return!1;if(T=o<g?o:g,a<0)C=0;else{if(!(a<h))return!1;C=a}if(u<0)return!1;w=u<h?u:h;const N=T-S,M=w-C;return this.checkSizeIsVisible(N,M,E)}),k(this,"returnHiddenResult",r=>(this._clientSize=null,{visible:!1,reason:r})),k(this,"checkOneElementVisible",r=>{if(r instanceof HTMLElement){if(this.checkElementIsMountedOnDom(r)){if(this.checkActualCssVisibleIncludeInherit(r)){if(this._clientSize=this.getSizeAboutClient(r),this.checkElementCover(r))return this.returnHiddenResult(Ph.COVERED);{const o=this.checkActualSize(),a=this.checkSizeOfPartInClient();return o&&!a?this.returnHiddenResult(Ph.POSITION):o?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Ph.SIZE)}}return this.returnHiddenResult(Ph.STYLE)}return this.returnHiddenResult(RE.UNMOUNTED)}return this.returnHiddenResult(RE.INVALID_HTML_ELEMENT)}),k(this,"checkElementIsMountedOnDom",r=>this.checkPropertyUpToAllParentNodes(r,o=>o.nodeName.toUpperCase()!=="HTML"?o.parentElement!==null:!!document.documentElement))}};function LD(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function wf(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?LD(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):LD(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}let dr=(sD=pt({argsMap:(r,o,a)=>[r.getTrackId(),typeof o=="string"?o:"HTMLElement",a]}),oD=or(),iD=pt({argsMap:r=>[r.getTrackId()]}),aD=bh("LocalVideoTrack","_enabledMutex"),cD=pt({argsMap:(r,o)=>[r.getTrackId(),o]}),uD=or(),lD=bh("LocalVideoTrack","_enabledMutex"),dD=pt({argsMap:(r,o)=>[r.getTrackId(),o]}),hD=or(),pD=or(),fD=pt({argsMap:(r,o,a)=>[r.getTrackId(),o,a]}),mD=or(),gD=or(),ED=or(),_D=or(),yD=or(),vD=or(),SD=or(),TD=pt({argsMap:(r,o)=>[r.getTrackId(),o.name]}),ID=pt({argsMap:r=>[r.getTrackId()]}),CD=pt({argsMap:r=>[r.getTrackId()]}),wD=pt({argsMap:(r,o,a)=>[r.getTrackId(),o.label,a]}),Ne((Ht=class WU extends vS{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==as.PLAYING)}get __className__(){return"LocalVideoTrack"}constructor(o,a,u,h,g,E){super(o,g),k(this,"trackMediaType","video"),k(this,"_player",void 0),k(this,"_videoVisibleTimer",null),k(this,"_previousVideoVisibleStatus",void 0),k(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),k(this,"_encoderConfig",void 0),k(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),k(this,"_optimizationMode",void 0),k(this,"_videoHeight",void 0),k(this,"_videoWidth",void 0),k(this,"_forceBitrateLimit",void 0),k(this,"_enabled",!0),k(this,"processorDestination",void 0),k(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this._encoderConfig=a,this._scalabiltyMode=u,this._optimizationMode=h,this._hints=E||[],this._hints.indexOf(ts.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile(),this.processorContext=new i3(this.getTrackId(),"local"),this.processorDestination=new o3(this.processorContext),this.bindProcessorDestinationEvents()}play(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof o=="string"){const h=document.getElementById(o);h?o=h:(F.warning("[".concat(this.getTrackId(),'] can not find "#').concat(o,'" element, use document.body')),o=document.body)}F.debug("[".concat(this.getTrackId(),"] start video playback"),JSON.stringify(a));const u=wf(wf(wf({},this._getDefaultPlayerConfig()),a),{},{trackId:this.getTrackId(),element:o});this._player?this._player.updateConfig(u):(this._player=new nD(u),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const h=this.getVideoElementVisibleStatus();this.emit(Ou.VIDEO_ELEMENT_VISIBLE_STATUS,h)}catch{}},de("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,F.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(o,a){if(!a){if(o===this._enabled)return;this.stateCheck("enabled",o)}if(F.info("[".concat(this.getTrackId(),"] start setEnabled"),o),!o){this._originMediaStreamTrack.enabled=!1;try{await er(this,yt.NEED_DISABLE_TRACK,this)}catch(u){throw F.error("[".concat(this.getTrackId(),"] setEnabled to false error"),u.toString()),u}return a||(this._enabled=!1),void F.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await er(this,yt.NEED_ENABLE_TRACK,this)}catch(u){throw F.error("[".concat(this.getTrackId(),"] setEnabled to true error"),u.toString()),u}F.info("[".concat(this.getTrackId(),"] setEnabled to true success")),a||(this._enabled=!0)}async setMuted(o){o!==this._muted&&(this.stateCheck("muted",o),this._muted=o,this._originMediaStreamTrack.enabled=!o,F.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(o)),o?await er(this,yt.NEED_MUTE_TRACK,this):await er(this,yt.NEED_UNMUTE_TRACK,this))}getStats(){return Sf(()=>{F.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ic(this,yt.GET_STATS)||wf({},aS)}async setBeautyEffect(o){F.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect https://docs-beta.agora.io/en/video-calling/develop/image-enhancement?platform=web ")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(o,a):await MS(o)}clone(o,a,u,h){const g=this._mediaStreamTrack.clone();return new WU(g,o,a,u,h)}async setBitrateLimit(o){if(F.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(o))),o){this._forceBitrateLimit=o,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<o.max_bitrate?this._encoderConfig.bitrateMax:o.max_bitrate:this._encoderConfig.bitrateMax=o.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=o.min_bitrate);try{await er(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw()}}}async setOptimizationMode(o){if(o!=="motion"&&o!=="detail"&&o!=="balanced")return void F.error(K.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const a=this._optimizationMode;try{this._optimizationMode=o,await er(this,yt.SET_OPTIMIZATION_MODE,this)}catch(u){throw this._optimizationMode=a,F.error("[".concat(this.getTrackId(),"] set optimization mode failed"),u.toString()),u}F.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(o,")"))}setScalabiltyMode(o){if(o.numSpatialLayers===1&&o.numTemporalLayers!==1)return F.error(K.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=o,F.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(o,")"))}updateMediaStreamTrackResolution(){y3(this._originMediaStreamTrack).then(o=>{let[a,u]=o;this._videoHeight=u,this._videoWidth=a}).catch(SE)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:o,height:a,frameRate:u}=this.getMediaStreamTrackSettings();if(!o||!a||!u)return;const[h,g]=function(E,S,T){const C=de("BITRATE_ADAPTER_TYPE");let w;const N=200*Math.pow(T/15,.6)*Math.pow(E*S/640/360,.75),M=N;if(C==="STANDARD_BITRATE")w=4*N;else{if(C!=="COMPATIABLE_BITRATE")return;w=2*N}return[Math.floor(w),Math.floor(M)]}(o,a,u)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=g,this._encoderConfig.bitrateMax=h,F.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(o,", h: ").concat(a,", fps: ").concat(u,"] => [brMax: ").concat(h,", brMin: ").concat(g,"]")))}getVideoElementVisibleStatus(){try{var o,a;const u=this==null||(o=this._player)===null||o===void 0?void 0:o.getContainerElement(),h={track:this,element:this==null||(a=this._player)===null||a===void 0?void 0:a.getVideoElement(),slot:u==null?void 0:u.parentElement},{element:g,slot:E}=h;if(this.isPlaying&&g instanceof HTMLVideoElement&&E instanceof HTMLElement){const S=PD.checkOneElementVisible(g),T=Object.assign({},S);if(T.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=T.visible;const C=at.reportApiInvoke(null,{tag:jn.TRACER,name:vr.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});T.visible?C.onSuccess("Video is visible"):C.onSuccess("Invisible because of ".concat(T.reason))}return T}return}catch(u){throw new Q(K.GET_VIDEO_ELEMENT_VISIBLE_ERROR,u.message)}}async renewMediaStreamTrack(o){}pipe(o){if(this.processor===o)return o;if(o._source)throw new Q(K.INVALID_OPERATION,"Processor ".concat(o.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=o,this.processor._source=this,o.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),o}unpipe(){if(!this.processor)return;const o=this.processor;this.processor._source=void 0,this.processor=void 0,o.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}async replaceTrack(o,a){if(!(o instanceof MediaStreamTrack))throw new Q(K.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(o.kind!=="video")throw new Q(K.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(o,a,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on(_s.ON_TRACK,async o=>{o?o!==this._mediaStreamTrack&&(this._mediaStreamTrack=o,this._updatePlayerSource(),await er(this,yt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await er(this,yt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_s.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(To.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(To.REQUEST_CONSTRAINTS)}}).prototype,"play",[sD,oD],Object.getOwnPropertyDescriptor(Ht.prototype,"play"),Ht.prototype),Ne(Ht.prototype,"stop",[iD],Object.getOwnPropertyDescriptor(Ht.prototype,"stop"),Ht.prototype),Ne(Ht.prototype,"setEnabled",[aD,cD,uD],Object.getOwnPropertyDescriptor(Ht.prototype,"setEnabled"),Ht.prototype),Ne(Ht.prototype,"setMuted",[lD,dD,hD],Object.getOwnPropertyDescriptor(Ht.prototype,"setMuted"),Ht.prototype),Ne(Ht.prototype,"getStats",[pD],Object.getOwnPropertyDescriptor(Ht.prototype,"getStats"),Ht.prototype),Ne(Ht.prototype,"setBeautyEffect",[fD,mD],Object.getOwnPropertyDescriptor(Ht.prototype,"setBeautyEffect"),Ht.prototype),Ne(Ht.prototype,"getCurrentFrameData",[gD],Object.getOwnPropertyDescriptor(Ht.prototype,"getCurrentFrameData"),Ht.prototype),Ne(Ht.prototype,"getCurrentFrameImage",[ED],Object.getOwnPropertyDescriptor(Ht.prototype,"getCurrentFrameImage"),Ht.prototype),Ne(Ht.prototype,"setBitrateLimit",[_D],Object.getOwnPropertyDescriptor(Ht.prototype,"setBitrateLimit"),Ht.prototype),Ne(Ht.prototype,"setOptimizationMode",[yD],Object.getOwnPropertyDescriptor(Ht.prototype,"setOptimizationMode"),Ht.prototype),Ne(Ht.prototype,"setScalabiltyMode",[vD],Object.getOwnPropertyDescriptor(Ht.prototype,"setScalabiltyMode"),Ht.prototype),Ne(Ht.prototype,"updateMediaStreamTrackResolution",[SD],Object.getOwnPropertyDescriptor(Ht.prototype,"updateMediaStreamTrackResolution"),Ht.prototype),Ne(Ht.prototype,"pipe",[TD],Object.getOwnPropertyDescriptor(Ht.prototype,"pipe"),Ht.prototype),Ne(Ht.prototype,"unpipe",[ID],Object.getOwnPropertyDescriptor(Ht.prototype,"unpipe"),Ht.prototype),Ne(Ht.prototype,"close",[CD],Object.getOwnPropertyDescriptor(Ht.prototype,"close"),Ht.prototype),Ne(Ht.prototype,"replaceTrack",[wD],Object.getOwnPropertyDescriptor(Ht.prototype,"replaceTrack"),Ht.prototype),Ht),MD=(RD=pt({argsMap:(r,o)=>[r.getTrackId(),o]}),bD=or(),ND=bh("CameraVideoTrack","_enabledMutex"),AD=pt({argsMap:(r,o)=>[r.getTrackId(),o]}),OD=or(),xD=pt({argsMap:(r,o)=>[r.getTrackId(),o]}),kD=or(),DD=pt({argsMap:r=>[r.getTrackId()]}),Ne((Oi=class extends dr{get __className__(){return"CameraVideoTrack"}constructor(r,o,a,u,h,g){super(r,Sh(o.encoderConfig),u,h,g),k(this,"_config",void 0),k(this,"_originalConstraints",void 0),k(this,"_constraints",void 0),k(this,"_enabled",!0),k(this,"_deviceName","default"),k(this,"tryResumeVideoForIOS15WeChat",async()=>{fh()&&!Rv()&&WO()&&this._enabled&&!this._isClosed&&(F.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=o,this._originalConstraints=a,this._constraints=a,this._deviceName=r.label,this._encoderConfig=Sh(this._config.encoderConfig),Gt.on(Fr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),Gt.on(Fr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),this.bindProcessorContextEvents()}async setDevice(r){if(F.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const o=await ni.getDeviceById(r),a={};a.video=wf({},this._constraints),a.video.deviceId={exact:r},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let u=null;try{u=await ea(a,this.getTrackId())}catch(h){throw F.error("[".concat(this.getTrackId(),"] setDevice failed"),h.toString()),u=await ea({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(u.getVideoTracks()[0],!1),h}await this._updateOriginMediaStreamTrack(u.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=o.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(o){throw F.error("[".concat(this.getTrackId(),"] setDevice error"),o.toString()),o}else try{const o=await ni.getDeviceById(r);this._deviceName=o.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(o){throw F.error("[".concat(this.getTrackId(),"] setDevice error"),o.toString()),o}F.info("[".concat(this.getTrackId(),"] setDevice success"))}async setEnabled(r,o){if(!o){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(F.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await ea({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await er(this,yt.NEED_ENABLE_TRACK,this)}catch(a){throw F.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),F.info("[".concat(this.getTrackId(),"] setEnabled to true success")),o||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),o||(this._enabled=!1);try{await er(this,yt.NEED_DISABLE_TRACK,this)}catch(a){throw F.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}F.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,o){if(!this._enabled)throw new Q(K.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Sh(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin);const a=lr(this._config);a.encoderConfig=r;const u=FS(a);(Vo()||eo()||xc())&&(u.deviceId=void 0),F.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(u));try{await this._originMediaStreamTrack.applyConstraints(u),this.updateMediaStreamTrackResolution()}catch(h){const g=new Q(K.UNEXPECTED_ERROR,h.toString());throw F.error("[".concat(this.getTrackId(),"] applyConstraints error"),g.toString()),g}this._config=a,this._constraints=u,this._originalConstraints=u,this._encoderConfig=r,this._hints.indexOf(ts.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await er(this,yt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(h){return h.throw()}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((eo()||xc())&&this._enabled&&!this._isClosed&&Gt.duringInterruption){const r=async()=>{Gt.off(Fr.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(F.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Gt.on(Fr.IOS_INTERRUPTION_END,r)}else F.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(Ou.TRACK_ENDED)}async renewMediaStreamTrack(r){const o=r||this._constraints,a=ni.searchDeviceIdByName(this._deviceName);if(a&&!o.deviceId&&(o.deviceId={exact:a}),this._enabled){const u=await ea({video:o},this.getTrackId());this._constraints=o,await this._updateOriginMediaStreamTrack(u.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Gt.off(Fr.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),Gt.off(Fr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}bindProcessorContextEvents(){this.processorContext.on(To.REQUEST_UPDATE_CONSTRAINTS,async(r,o,a)=>{try{const u=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(u),o()}catch(u){a(u)}}),this.processorContext.on(To.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[RD,bD],Object.getOwnPropertyDescriptor(Oi.prototype,"setDevice"),Oi.prototype),Ne(Oi.prototype,"setEnabled",[ND,AD,OD],Object.getOwnPropertyDescriptor(Oi.prototype,"setEnabled"),Oi.prototype),Ne(Oi.prototype,"setEncoderConfiguration",[xD,kD],Object.getOwnPropertyDescriptor(Oi.prototype,"setEncoderConfiguration"),Oi.prototype),Ne(Oi.prototype,"close",[DD],Object.getOwnPropertyDescriptor(Oi.prototype,"close"),Oi.prototype),Oi);class US{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(o,a){k(this,"uid",void 0),k(this,"_uintid",void 0),k(this,"_trust_in_room_",!0),k(this,"_trust_audio_enabled_state_",!0),k(this,"_trust_video_enabled_state_",!0),k(this,"_trust_audio_mute_state_",!0),k(this,"_trust_video_mute_state_",!0),k(this,"_audio_muted_",!1),k(this,"_video_muted_",!1),k(this,"_audio_enabled_",!0),k(this,"_video_enabled_",!0),k(this,"_audio_added_",!1),k(this,"_video_added_",!1),k(this,"_trust_video_stream_added_state_",!0),k(this,"_trust_audio_stream_added_state_",!0),k(this,"_audioTrack",void 0),k(this,"_videoTrack",void 0),k(this,"_audioSSRC",void 0),k(this,"_videoSSRC",void 0),k(this,"_audioOrtc",void 0),k(this,"_videoOrtc",void 0),k(this,"_cname",void 0),k(this,"_rtxSsrcId",void 0),this.uid=o,this._uintid=a}}var JK=sO,QK=uh,ZK=Ug;Zs({target:"Promise",stat:!0},{try:function(r){var o=QK.f(this),a=ZK(r);return(a.error?o.reject:o.resolve)(a.value),o.promise}});var VS=JK,eq=Zs,tq=I,nq=i,rq=vf,sq=Kt,oq=vi,iq=Su,$D=Xv,aq=Qx,cq=sk,uq=Wr,FD=Mr("isConcatSpreadable"),UD=9007199254740991,VD="Maximum allowed index exceeded",BD=tq.TypeError,lq=uq>=51||!nq(function(){var r=[];return r[FD]=!1,r.concat()[0]!==r}),dq=cq("concat"),hq=function(r){if(!sq(r))return!1;var o=r[FD];return o!==void 0?!!o:rq(r)};eq({target:"Array",proto:!0,forced:!lq||!dq},{concat:function(r){var o,a,u,h,g,E=oq(this),S=aq(E,0),T=0;for(o=-1,u=arguments.length;o<u;o++)if(hq(g=o===-1?E:arguments[o])){if(T+(h=iq(g))>UD)throw BD(VD);for(a=0;a<h;a++,T++)a in g&&$D(S,T,g[a])}else{if(T>=UD)throw BD(VD);$D(S,T++,g)}return S.length=T,S}});var jD={},pq=ke,fq=St,WD=Sg.f,mq=wx,GD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];jD.f=function(r){return GD&&pq(r)=="Window"?function(o){try{return WD(o)}catch{return mq(GD)}}(r):WD(fq(r))};var Rf={},gq=Mr;Rf.f=gq;var zD=sn,Eq=fs,_q=Rf,yq=B.f,cs=function(r){var o=zD.Symbol||(zD.Symbol={});Eq(o,r)||yq(o,r,{value:_q.f(r)})},Lh=Zs,BS=I,vq=Fn,Sq=L,bf=oe,Tq=_,Mh=H,Zl=_i,jS=i,Ts=fs,Iq=vf,Cq=$,wq=Kt,Rq=y,WS=ws,GS=he,bq=vi,bE=St,zS=wc,HD=oh,HS=Oe,Nf=wg,KD=Ry,Nq=Sg,qD=jD,KS=Cy,XD=G,YD=B,Aq=wy,JD=ae,Oq=Gy,qS=Lg,Af=Na.exports,QD=Tg,ZD=Nl,eP=Mr,xq=Rf,kq=cs,Dq=of,tP=Pg,NE=ek.forEach,ri=vg("hidden"),AE="Symbol",nP=eP("toPrimitive"),Pq=tP.set,rP=tP.getterFor(AE),Pa=Object.prototype,Du=BS.Symbol,ed=Du&&Du.prototype,sP=BS.TypeError,XS=BS.QObject,Of=vq("JSON","stringify"),oP=XD.f,Pu=YD.f,iP=qD.f,Lq=JD.f,aP=Tq([].push),Fc=Af("symbols"),xf=Af("op-symbols"),YS=Af("string-to-symbol-registry"),JS=Af("symbol-to-string-registry"),Mq=Af("wks"),QS=!XS||!XS.prototype||!XS.prototype.findChild,ZS=Mh&&jS(function(){return Nf(Pu({},"a",{get:function(){return Pu(this,"a",{value:7}).a}})).a!=7})?function(r,o,a){var u=oP(Pa,o);u&&delete Pa[o],Pu(r,o,a),u&&r!==Pa&&Pu(Pa,o,u)}:Pu,eT=function(r,o){var a=Fc[r]=Nf(ed);return Pq(a,{type:AE,tag:r,description:o}),Mh||(a.description=o),a},OE=function(r,o,a){r===Pa&&OE(xf,o,a),GS(r);var u=zS(o);return GS(a),Ts(Fc,u)?(a.enumerable?(Ts(r,ri)&&r[ri][u]&&(r[ri][u]=!1),a=Nf(a,{enumerable:HS(0,!1)})):(Ts(r,ri)||Pu(r,ri,HS(1,{})),r[ri][u]=!0),ZS(r,u,a)):Pu(r,u,a)},tT=function(r,o){GS(r);var a=bE(o),u=KD(a).concat(nT(a));return NE(u,function(h){Mh&&!bf(cP,a,h)||OE(r,h,a[h])}),r},cP=function(r){var o=zS(r),a=bf(Lq,this,o);return!(this===Pa&&Ts(Fc,o)&&!Ts(xf,o))&&(!(a||!Ts(this,o)||!Ts(Fc,o)||Ts(this,ri)&&this[ri][o])||a)},uP=function(r,o){var a=bE(r),u=zS(o);if(a!==Pa||!Ts(Fc,u)||Ts(xf,u)){var h=oP(a,u);return!h||!Ts(Fc,u)||Ts(a,ri)&&a[ri][u]||(h.enumerable=!0),h}},lP=function(r){var o=iP(bE(r)),a=[];return NE(o,function(u){Ts(Fc,u)||Ts(QD,u)||aP(a,u)}),a},nT=function(r){var o=r===Pa,a=iP(o?xf:bE(r)),u=[];return NE(a,function(h){!Ts(Fc,h)||o&&!Ts(Pa,h)||aP(u,Fc[h])}),u};if(Zl||(qS(ed=(Du=function(){if(Rq(ed,this))throw sP("Symbol is not a constructor");var r=arguments.length&&arguments[0]!==void 0?HD(arguments[0]):void 0,o=ZD(r),a=function(u){this===Pa&&bf(a,xf,u),Ts(this,ri)&&Ts(this[ri],o)&&(this[ri][o]=!1),ZS(this,o,HS(1,u))};return Mh&&QS&&ZS(Pa,o,{configurable:!0,set:a}),eT(o,r)}).prototype,"toString",function(){return rP(this).tag}),qS(Du,"withoutSetter",function(r){return eT(ZD(r),r)}),JD.f=cP,YD.f=OE,Aq.f=tT,XD.f=uP,Nq.f=qD.f=lP,KS.f=nT,xq.f=function(r){return eT(eP(r),r)},Mh&&Pu(ed,"description",{configurable:!0,get:function(){return rP(this).description}})),Lh({global:!0,wrap:!0,forced:!Zl,sham:!Zl},{Symbol:Du}),NE(KD(Mq),function(r){kq(r)}),Lh({target:AE,stat:!0,forced:!Zl},{for:function(r){var o=HD(r);if(Ts(YS,o))return YS[o];var a=Du(o);return YS[o]=a,JS[a]=o,a},keyFor:function(r){if(!WS(r))throw sP(r+" is not a symbol");if(Ts(JS,r))return JS[r]},useSetter:function(){QS=!0},useSimple:function(){QS=!1}}),Lh({target:"Object",stat:!0,forced:!Zl,sham:!Mh},{create:function(r,o){return o===void 0?Nf(r):tT(Nf(r),o)},defineProperty:OE,defineProperties:tT,getOwnPropertyDescriptor:uP}),Lh({target:"Object",stat:!0,forced:!Zl},{getOwnPropertyNames:lP,getOwnPropertySymbols:nT}),Lh({target:"Object",stat:!0,forced:jS(function(){KS.f(1)})},{getOwnPropertySymbols:function(r){return KS.f(bq(r))}}),Of&&Lh({target:"JSON",stat:!0,forced:!Zl||jS(function(){var r=Du();return Of([r])!="[null]"||Of({a:r})!="{}"||Of(Object(r))!="{}"})},{stringify:function(r,o,a){var u=Oq(arguments),h=o;if((wq(o)||r!==void 0)&&!WS(r))return Iq(o)||(o=function(g,E){if(Cq(h)&&(E=bf(h,this,g,E)),!WS(E))return E}),u[1]=o,Sq(Of,null,u)}}),!ed[nP]){var $q=ed.valueOf;qS(ed,nP,function(r){return bf($q,this)})}Dq(Du,AE),QD[ri]=!0,cs("asyncIterator"),cs("hasInstance"),cs("isConcatSpreadable"),cs("iterator"),cs("match"),cs("matchAll"),cs("replace"),cs("search"),cs("species"),cs("split"),cs("toPrimitive"),cs("toStringTag"),cs("unscopables"),of(I.JSON,"JSON",!0);var Fq=sn.Symbol;cs("asyncDispose"),cs("dispose"),cs("matcher"),cs("metadata"),cs("observable"),cs("patternMatch"),cs("replaceAll");var dP=Fq,hP=Rf.f("asyncIterator"),Uq=hP;function pP(r){this.wrapped=r}function kf(r){var o,a;function u(g,E){try{var S=r[g](E),T=S.value,C=T instanceof pP;VS.resolve(C?T.wrapped:T).then(function(w){C?u(g==="return"?"return":"next",w):h(S.done?"return":"normal",w)},function(w){u("throw",w)})}catch(w){h("throw",w)}}function h(g,E){switch(g){case"return":o.resolve({value:E,done:!0});break;case"throw":o.reject(E);break;default:o.resolve({value:E,done:!1})}(o=o.next)?u(o.key,o.arg):a=null}this._invoke=function(g,E){return new VS(function(S,T){var C={key:g,arg:E,resolve:S,reject:T,next:null};a?a=a.next=C:(o=a=C,u(g,E))})},typeof r.return!="function"&&(this.return=void 0)}function na(r){return function(){return new kf(r.apply(this,arguments))}}function Ft(r){return new pP(r)}kf.prototype[typeof dP=="function"&&Uq||"@@asyncIterator"]=function(){return this},kf.prototype.next=function(r){return this._invoke("next",r)},kf.prototype.throw=function(r){return this._invoke("throw",r)},kf.prototype.return=function(r){return this._invoke("return",r)};var Vq=Rf.f("iterator");function Df(r,o){var a={},u=!1;function h(g,E){return u=!0,E=new VS(function(S){S(r[g](E))}),{done:!1,value:o(E)}}return a[dP!==void 0&&Vq||"@@iterator"]=function(){return this},a.next=function(g){return u?(u=!1,g):h("next",g)},typeof r.throw=="function"&&(a.throw=function(g){if(u)throw u=!1,g;return h("throw",g)}),typeof r.return=="function"&&(a.return=function(g){return u?(u=!1,g):h("return",g)}),a}var fP=hP,hr={exports:{}};function mP(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function gP(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?mP(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):mP(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}function rT(r,o,a,u,h,g,E){let S=[],T=[],C=[],w=[],N=!1,M=!1;if(hr.exports.parse(r).mediaDescriptions.forEach(U=>{E&&E!==U.attributes.direction||(U.media.mediaType!=="video"||N||(T=U.attributes.payloads,w=U.attributes.extmaps,N=!0),U.media.mediaType!=="audio"||M||(S=U.attributes.payloads,C=U.attributes.extmaps,M=!0))}),!w||T.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!C||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");return T.forEach(U=>{var Y;(Y=U.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(U.rtpMap.clockRate=parseInt(U.rtpMap.clockRate))}),S.forEach(U=>{var Y;(Y=U.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(U.rtpMap.clockRate=parseInt(U.rtpMap.clockRate))}),o&&(S=S.filter(U=>{var Y;return((Y=U.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"}),T=T.filter(U=>{var Y;return((Y=U.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"})),a&&(T=T.filter(U=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=U.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),u&&(S=S.filter(U=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=U.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),h&&(h==null?void 0:h.length)>0&&(S=S.filter(U=>{var Y;return h.includes(((Y=U.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")})),g&&(g==null?void 0:g.length)>0&&(T=T.filter(U=>{var Y;return g.includes(((Y=U.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")})),{audioCodecs:S,videoCodecs:T,audioExtensions:C,videoExtensions:w}}function td(r){const o=hr.exports.parse(r);let a,u;for(const h of o.mediaDescriptions){if(!a){const g=h.attributes.iceUfrag,E=h.attributes.icePwd;if(!g||!E)throw new Error("Cannot get iceUfrag or icePwd from SDP.");a={iceUfrag:g,icePwd:E}}if(!u){const g=h.attributes.fingerprints;g.length>0&&(u={fingerprints:g})}}if(!u&&o.attributes.fingerprints.length>0&&(u={fingerprints:o.attributes.fingerprints}),!u||!a)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:a,dtlsParameters:u}}function EP(r,o){const a=[],u=r.attributes.ssrcGroups.filter(E=>E.semantic==="FID"),h=r.attributes.ssrcGroups.find(E=>E.semantic==="SIM"),g=r.attributes.ssrcs;if(h)h.ssrcIds.forEach(E=>{var S;const T=(S=u.find(C=>C.ssrcIds[0]===E))===null||S===void 0?void 0:S.ssrcIds[1];a.push({ssrcId:E,rtx:o?T:void 0})});else if(u.length>0){const E=u[0].ssrcIds[0],S=u[0].ssrcIds[1];a.push({ssrcId:E,rtx:o?S:void 0})}else{if(g.length===0)throw new Error("No ssrcs found on local media description.");a.push({ssrcId:g[0].ssrcId})}return a}function _P(r,o){const{cname:a}=r;let u;o&&o.ip&&typeof o.port=="number"?(u=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:o.ip,port:o.port.toString(),type:"host",extension:{}}],F.debug("Using remote candidate from AP ".concat(o.ip,":").concat(o.port)),o.ip6&&(u.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:o.ip6,port:o.port.toString(),type:"host",extension:{}}),F.debug("Using IPV6 remote candidate from AP ".concat(o.ip6,":").concat(o.port)))):u=r.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}}));const h={fingerprints:r.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},g={iceUfrag:r.iceParameters.iceUfrag,icePwd:r.iceParameters.icePwd};let E;switch(r.dtlsParameters.role){case"server":E="passive";break;case"client":E="active";break;case"auto":E="actpass"}return{dtlsParameters:h,iceParameters:g,candidates:u,rtpCapabilities:iT(r.rtpCapabilities),setup:E,cname:a}}function xi(r,o,a){const u=[],h=[];return r.forEach(g=>{let{ssrcId:E,rtx:S}=g;const T=Kn(8,"track-"),C={ssrcId:E,attributes:gP({label:T,mslabel:a=a||Kn(10,""),msid:"".concat(a," ").concat(T)},o&&{cname:o})};if(u.push(C),S!==void 0){const w={ssrcId:S,attributes:gP({label:T,mslabel:a,msid:"".concat(a," ").concat(T)},o&&{cname:o})};u.push(w),h.push({semantic:"FID",ssrcIds:[E,S]})}}),r.length>1&&h.push({semantic:"SIM",ssrcIds:r.map(g=>{let{ssrcId:E}=g;return E})}),{ssrcs:u,ssrcGroups:h}}function $h(r,o){o instanceof ys&&r.attributes.payloads.forEach(a=>{var u;const h=(u=a.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase();if(!h||["opus","pcmu","pcma","g722"].indexOf(h)===-1)return;a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters.minptime="10",a.fmtp.parameters.useinbandfec="1";const g=o._encoderConfig;g&&h!=="pcmu"&&h!=="pcma"&&h!=="g722"&&(g.bitrate&&!Jn()&&(a.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*g.bitrate))),g.sampleRate&&(a.fmtp.parameters.maxplaybackrate="".concat(g.sampleRate),a.fmtp.parameters["sprop-maxcapturerate"]="".concat(g.sampleRate)),g.stereo&&(a.fmtp.parameters.stereo="1",a.fmtp.parameters["sprop-stereo"]="1"))})}function sT(r){const o=r.attributes.unrecognized.findIndex(a=>a.attField==="x-google-flag"&&a.attValue==="conference");o!==-1&&r.attributes.unrecognized.splice(o,1)}function oT(r,o){if(!(o instanceof dr&&o._encoderConfig&&o._hints.indexOf(ts.SCREEN_TRACK)===-1))return;const a=o._encoderConfig;ns().supportMinBitrate&&a.bitrateMin&&r.attributes.payloads.forEach(u=>{var h;["h264","vp8","vp9","av1"].includes(((h=u.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(u.fmtp||(u.fmtp={parameters:{}}),u.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))}),ns().supportMinBitrate&&!o._hints.includes(ts.LOW_STREAM)&&a.bitrateMax&&r.attributes.payloads.forEach(u=>{var h;["h264","vp8","vp9","av1"].includes(((h=u.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(u.fmtp||(u.fmtp={parameters:{}}),u.fmtp.parameters["x-google-start-bitrate"]="".concat(de("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))})}function yP(r){if(r.media.mediaType!=="video")return;const o=Sn();if(o.name!==En.SAFARI&&o.os!==Rs.IOS)return;const a=r.attributes.extmaps.findIndex(u=>/video-orientation/g.test(u.extensionName));a!==-1&&r.attributes.extmaps.splice(a,1)}function xE(r,o,a){if(!o)return;let u,h;if(r.media.mediaType==="video"?(u=a.videoExtensions,h=a.videoCodecs):(u=a.audioExtensions,h=a.audioCodecs),o.twcc===!0){const g=u.find(E=>E.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");g&&(r.attributes.extmaps.find(E=>E.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||r.attributes.extmaps.push({entry:g.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(E,S){return S.filter(T=>!!E.find(C=>C.payloadType===T.payloadType&&!!C.rtcpFeedbacks.find(w=>w.type==="transport-cc")))}(h,r.attributes.payloads).forEach(E=>{E.rtcpFeedbacks.find(S=>S.type==="transport-cc")||E.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(o.twcc===!1){const g=r.attributes.extmaps.findIndex(E=>E.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");g!==-1&&r.attributes.extmaps.splice(g,1),r.attributes.payloads.forEach(E=>{const S=E.rtcpFeedbacks.findIndex(T=>T.type==="transport-cc");S!==-1&&E.rtcpFeedbacks.splice(S,1)})}if(o.remb===!0){const g=u.find(E=>E.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");g&&(r.attributes.extmaps.find(E=>E.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||r.attributes.extmaps.push({entry:g.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(E,S){return S.filter(T=>!!E.find(C=>C.payloadType===T.payloadType&&!!C.rtcpFeedbacks.find(w=>w.type==="goog-remb")))}(h,r.attributes.payloads).forEach(E=>{E.rtcpFeedbacks.find(S=>S.type==="goog-remb")||E.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(o.remb===!1){const g=r.attributes.extmaps.findIndex(E=>E.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");g!==-1&&r.attributes.extmaps.splice(g,1),r.attributes.payloads.forEach(E=>{const S=E.rtcpFeedbacks.findIndex(T=>T.type==="goog-remb");S!==-1&&E.rtcpFeedbacks.splice(S,1)})}}function vP(r,o,a){if(Jn()||r.media.mediaType!=="video"||!(o instanceof dr)||a!=="vp9"&&a!=="vp8"||a==="vp8"&&!de("SIMULCAST")||o._scalabiltyMode===void 0||o._scalabiltyMode.numSpatialLayers<=1)return;const u=a==="vp8"?2:o._scalabiltyMode.numSpatialLayers,h=r.attributes.ssrcs[0],g=r.attributes.ssrcGroups.find(S=>S.semantic==="FID"&&S.ssrcIds[0]===h.ssrcId),E={semantic:"SIM",ssrcIds:[h.ssrcId]};for(let S=1;S<u;S++)r.attributes.ssrcs.push({ssrcId:h.ssrcId+S,attributes:lr(h.attributes)}),E.ssrcIds.push(h.ssrcId+S),g&&(r.attributes.ssrcs.push({ssrcId:g.ssrcIds[1]+S,attributes:lr(h.attributes)}),r.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[h.ssrcId+S,g.ssrcIds[1]+S]}));r.attributes.ssrcGroups.unshift(E)}async function SP(r,o,a,u,h){const g=new RTCPeerConnection;g.addTransceiver("video",{direction:"sendonly"}),g.addTransceiver("audio",{direction:"sendonly"}),g.addTransceiver("video",{direction:"recvonly"}),g.addTransceiver("audio",{direction:"recvonly"});const E=(await g.createOffer()).sdp,S=rT(E,r,o,a,u,h,"sendonly"),T=rT(E,r,o,a,u,h,"recvonly"),C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},w={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(kE(S,T,"videoExtensions",C,w,N),kE(S,T,"videoCodecs",C,w,N),kE(S,T,"audioExtensions",C,w,N),kE(S,T,"audioCodecs",C,w,N),de("RAISE_H264_BASELINE_PRIORITY")){const M=N.videoCodecs.findIndex(U=>{var Y,X;return((Y=U.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((X=U.fmtp)===null||X===void 0?void 0:X.parameters["profile-level-id"])==="42001f"});if(M!==-1){const U=N.videoCodecs.findIndex(Y=>{var X;return((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"});if(U<M){F.debug("raising H264 baseline profile priority");const Y=N.videoCodecs[M];N.videoCodecs.splice(M,1),N.videoCodecs.splice(U,0,Y)}U!==-1&&(w.videoCodecs=w.videoCodecs.filter(Y=>{var X,J;return!(((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"&&((J=Y.fmtp)===null||J===void 0?void 0:J.parameters["profile-level-id"])!=="42001f")})),U!==-1&&de("FILTER_SEND_H264_BASELINE")&&(C.videoCodecs=C.videoCodecs.filter(Y=>{var X,J;return!(((X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLocaleLowerCase())==="h264"&&((J=Y.fmtp)===null||J===void 0?void 0:J.parameters["profile-level-id"])!=="42001f")}))}}try{g.close()}catch{}return{send:C,recv:w,sendrecv:N}}function kE(r,o,a,u,h,g){if(a==="videoExtensions"||a==="audioExtensions"){const E=[];return r[a].forEach(S=>{o[a].some((T,C)=>{if(S.entry===T.entry&&S.extensionName===T.extensionName)return E.push(C),!0})?g[a].push(S):u[a].push(S)}),void o[a].forEach((S,T)=>{E.indexOf(T)===-1&&h[a].push(S)})}if(a==="videoCodecs"||a==="audioCodecs"){const E=[];return r[a].forEach(S=>{o[a].some((T,C)=>{if(S.payloadType===T.payloadType&&JSON.stringify(S)===JSON.stringify(T))return E.push(C),!0})?g[a].push(S):u[a].push(S)}),void o[a].forEach((S,T)=>{E.indexOf(T)===-1&&h[a].push(S)})}}function iT(r){const{send:o,recv:a,sendrecv:u}=r;if(!u){if(!o||!a)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:o,recv:a}}let h,g;return o?(h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},h.audioCodecs=[...o.audioCodecs,...u.audioCodecs],h.videoCodecs=[...o.videoCodecs,...u.videoCodecs],h.audioExtensions=[...o.audioExtensions,...u.audioExtensions],h.videoExtensions=[...o.videoExtensions,...u.videoExtensions]):h=u,a?(g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g.audioCodecs=[...a.audioCodecs,...u.audioCodecs],g.videoCodecs=[...a.videoCodecs,...u.videoCodecs],g.audioExtensions=[...a.audioExtensions,...u.audioExtensions],g.videoExtensions=[...a.videoExtensions,...u.videoExtensions]):g=u,{send:h,recv:g}}function Lu(r){r.media.mediaType==="audio"&&r.attributes.payloads.filter(o=>{var a;return((a=o.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase())==="opus"}).forEach(o=>{o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters.stereo="1",o.fmtp.parameters["sprop-stereo"]="1"})}(function(r,o){r.exports=(()=>{var a={8:(g,E,S)=>{S.r(E),S.d(E,{Parser:()=>Dn,Printer:()=>wo,parse:()=>vt,print:()=>Yt});const T=`
`,C="".concat("\r").concat(T),w=" ";let N;function M($e){return $e>="0"&&$e<="9"}function U($e){return $e>="!"&&$e<="~"}function Y($e){return U($e)||$e>=""&&$e<="ÿ"}function X($e){return $e==="!"||$e>="#"&&$e<="'"||$e>="*"&&$e<="+"||$e>="-"&&$e<="."||$e>="0"&&$e<="9"||$e>="A"&&$e<="Z"||$e>="^"&&$e<="~"}function J($e){return $e>="1"&&$e<="9"}function fe($e){return $e>="A"&&$e<="Z"||$e>="a"&&$e<="z"}function ge($e){return $e==="d"||$e==="h"||$e==="m"||$e==="s"}function Ue($e){return $e>""&&$e<"	"||$e>"\v"&&$e<"\f"||$e>""&&$e<"ÿ"}function lt($e){return fe($e)||M($e)||$e==="+"||$e==="/"}function Ve($e){return M($e)||fe($e)||$e==="+"||$e==="/"||$e==="-"||$e==="_"}function Ge($e){return fe($e)||M($e)||$e==="+"||$e==="/"}function Le($e,D){var q=Object.keys($e);if(Object.getOwnPropertySymbols){var te=Object.getOwnPropertySymbols($e);D&&(te=te.filter(function(Ie){return Object.getOwnPropertyDescriptor($e,Ie).enumerable})),q.push.apply(q,te)}return q}function Ze($e){for(var D=1;D<arguments.length;D++){var q=arguments[D]!=null?arguments[D]:{};D%2?Le(Object(q),!0).forEach(function(te){yn($e,te,q[te])}):Object.getOwnPropertyDescriptors?Object.defineProperties($e,Object.getOwnPropertyDescriptors(q)):Le(Object(q)).forEach(function(te){Object.defineProperty($e,te,Object.getOwnPropertyDescriptor(q,te))})}return $e}function yn($e,D,q){return D in $e?Object.defineProperty($e,D,{value:q,enumerable:!0,configurable:!0,writable:!0}):$e[D]=q,$e}(function($e){$e.VERSION="v",$e.ORIGIN="o",$e.SESSION_NAME="s",$e.INFORMATION="i",$e.URI="u",$e.EMAIL="e",$e.PHONE="p",$e.CONNECTION="c",$e.BANDWIDTH="b",$e.TIME="t",$e.REPEAT="r",$e.ZONE_ADJUSTMENTS="z",$e.KEY="k",$e.ATTRIBUTE="a",$e.MEDIA="m"})(N||(N={}));class At{consumeText(D,q){let te=q;for(;te<D.length;){const Ie=D[te];if(Ie==="\0"||Ie==="\r"||Ie===T)break;te+=1}if(te-q==0)throw new Error("Invalid text, at ".concat(D));return te}consumeUnicastAddress(D,q,te){return this.consumeTill(D,q,w)}consumeOneOrMore(D,q,te){let Ie=q;for(;te(D[Ie]);)Ie++;if(Ie-q==0)throw new Error("Invalid rule at ".concat(q,"."));return Ie}consumeSpace(D,q){if(D[q]===w)return q+1;throw new Error("Invalid space at ".concat(q,"."))}consumeIP4Address(D,q){let te=q;for(let Ie=0;Ie<4;Ie++)if(te=this.consumeDecimalUChar(D,te),Ie!==3){if(D[te]!==".")throw new Error("Invalid IP4 address.");te++}return te}consumeDecimalUChar(D,q){let te=q;for(let It=0;It<3&&M(D[te]);It++,te++);if(te-q==0)throw new Error("Invalid decimal uchar.");const Ie=parseInt(D.slice(q,te));if(Ie>=0&&Ie<=255)return te;throw new Error("Invalid decimal uchar")}consumeIP6Address(D,q){let te=this.consumeHexpart(D,q);return D[te]===":"&&(te+=1,te=this.consumeIP4Address(D,te)),te}consumeHexpart(D,q){let te=q;if(D[te]===":"&&D[te+1]===":"){te+=2;try{te=this.consumeHexseq(D,te)}catch{}return te}if(te=this.consumeHexseq(D,te),D[te]===":"&&D[te+1]===":"){te+=2;try{te=this.consumeHexseq(D,te)}catch{}return te}return te}consumeHexseq(D,q){let te=q;for(;te=this.consumeHex4(D,te),D[te]===":"&&D[te+1]!==":";)te+=1;return te}consumeHex4(D,q){let te=0;for(;te<4;te++)if(!((Ie=D[q+te])>="0"&&Ie<="9"||Ie>="a"&&Ie<="f"||Ie>="A"&&Ie<="F")){if(te===0)throw new Error("Invalid hex 4");break}var Ie;return q+te}consumeFQDN(D,q){let te=q;for(;M(D[te])||fe(D[te])||D[te]==="-"||D[te]===".";)te+=1;if(te-q<4)throw new Error("Invalid FQDN");return te}consumeExtnAddr(D,q){return this.consumeOneOrMore(D,q,Y)}consumeMulticastAddress(D,q,te){switch(te){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(D,q);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(D,q);default:try{return this.consumeFQDN(D,q)}catch{return this.consumeExtnAddr(D,q)}}}consumeIP6MulticastAddress(D,q){const te=this.consumeHexpart(D,q);return D[te]==="/"?this.consumeInteger(D,te+1):te}consumeIP4MulticastAddress(D,q){let te=q+3;const Ie=D.slice(q,te),It=parseInt(Ie);if(It<224||It>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let wn=0;wn<3;wn++){if(D[te]!==".")throw new Error("Invalid IP4 multicast address.");te+=1,te=this.consumeDecimalUChar(D,te)}return D[te]==="/"&&(te+=1),te=this.consumeTTL(D,te),D[te]==="/"&&(te=this.consumeInteger(D,te)),te}consumeInteger(D,q){if(!J(D[q]))throw new Error("Invalid integer.");for(q+=1;M(D[q]);)q+=1;return q}consumeTTL(D,q){if(D[q]==="0")return q+1;if(!J(D[q]))throw new Error("Invalid TTL.");q+=1;for(let te=0;te<2&&M(D[q]);te++)q+=1;return q}consumeToken(D,q){return this.consumeOneOrMore(D,q,X)}consumeTime(D,q){let te=q;if(D[te]==="0")return te+1;for(J(D[te])&&(te+=1);M(D[te]);)te++;if(te-q<10)throw new Error("Invalid time");return te}consumeAddress(D,q){return this.consumeTill(D,q,w)}consumeTypedTime(D,q){let te=q;return te=this.consumeOneOrMore(D,te,M),ge(D[te])?te+1:te}consumeRepeatInterval(D,q){if(!J(D[q]))throw new Error("Invalid repeat interval");for(q+=1;M(D[q]);)q+=1;return ge(D[q])&&(q+=1),q}consumePort(D,q){return this.consumeOneOrMore(D,q,M)}consume(D,q,te){for(let Ie=0;Ie<te.length;Ie++){if(q+Ie>=D.length)throw new Error("consume exceeding value length");if(D[q+Ie]!==te[Ie])throw new Error("consume ".concat(te," failed at ").concat(Ie))}return q+te.length}consumeTill(D,q,te){let Ie=q;for(;Ie<D.length&&(typeof te!="string"||D[Ie]!==te)&&(typeof te!="function"||!te(D[Ie]));)Ie++;return Ie}}class Dn extends At{constructor(){super(),yn(this,"records",[]),yn(this,"currentLine",0)}parse(D){const q=this.probeEOL(D);this.records=D.split(q).filter(io=>!!io.trim()).map(this.parseLine),this.currentLine=0;const te=this.parseVersion(),Ie=this.parseOrigin(),It=this.parseSessionName(),wn=this.parseInformation(),ls=this.parseUri(),oa=this.parseEmail(),Uu=this.parsePhone(),Li=this.parseConnection(),Vu=this.parseBandWidth(),Vh=this.parseTimeFields(),qn=this.parseKey(),pr=this.parseSessionAttribute(),In=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:te,origin:Ie,sessionName:It,information:wn,uri:ls,emails:oa,phones:Uu,connection:Li,bandwidths:Vu,timeFields:Vh,key:qn,attributes:pr,mediaDescriptions:In}}getCurrentRecord(){const D=this.records[this.currentLine];if(!D)throw new Error("Record doesn't exit.");return D}probeEOL(D){for(let q=0;q<D.length;q++)if(D[q]===T)return D[q-1]==="\r"?C:T;throw new Error("Invalid newline character.")}parseLine(D,q){if(D.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const te=D[0];if(D[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:te,value:D.slice(2),line:q,cur:0}}parseSessionAttribute(){const D=new ir;for(;this.currentLine<this.records.length;){const q=this.getCurrentRecord();if(q.type!==N.ATTRIBUTE)break;const te={attField:this.extractOneOrMore(q,Ie=>X(Ie)&&Ie!==":"),_cur:0};q.value[q.cur]===":"&&(q.cur+=1,te.attValue=this.extractOneOrMore(q,Ue)),D.parse(te),this.currentLine++}return D.digest()}parseMediaAttributes(D){const q=new us(D);for(;this.currentLine<this.records.length;){const te=this.getCurrentRecord();if(te.type!==N.ATTRIBUTE)break;const Ie={attField:this.extractOneOrMore(te,It=>X(It)&&It!==":"),_cur:0};te.value[te.cur]===":"&&(te.cur+=1,Ie.attValue=this.extractOneOrMore(te,Ue)),q.parse(Ie),this.currentLine++}return q.digest()}parseKey(){const D=this.getCurrentRecord();if(D.type===N.KEY){if(D.value==="prompt"||D.value==="clear:"||D.value==="base64:"||D.value==="uri:")return D.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const D=this.getCurrentRecord();if(D.type===N.ZONE_ADJUSTMENTS){const q=[];for(;;)try{const te=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);let Ie=!1;D.value[D.cur]==="-"&&(Ie=!0,D.cur+=1);const It=this.extract(D,this.consumeTypedTime);q.push({time:te,typedTime:It,back:Ie})}catch{break}if(q.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,q}return[]}parseRepeat(){const D=[];for(;;){const q=this.getCurrentRecord();if(q.type!==N.REPEAT)break;{const te=this.extract(q,this.consumeRepeatInterval),Ie=this.parseTypedTime(q);D.push({repeatInterval:te,typedTimes:Ie}),this.currentLine++}}return D}parseTypedTime(D){const q=[];for(;;)try{this.consumeSpaceForRecord(D),q.push(this.extract(D,this.consumeTypedTime))}catch{break}if(q.length===0)throw new Error("Invalid typed time.");return q}parseTime(){const D=this.getCurrentRecord(),q=this.extract(D,this.consumeTime);this.consumeSpaceForRecord(D);const te=this.extract(D,this.consumeTime);return this.currentLine++,{startTime:q,stopTime:te}}parseBandWidth(){const D=[];for(;this.currentLine<this.records.length;){const q=this.getCurrentRecord();if(q.type!==N.BANDWIDTH)break;{const te=this.extractOneOrMore(q,X);if(q.value[q.cur]!==":")throw new Error("Invalid bandwidth field.");q.cur++;const Ie=this.extractOneOrMore(q,M);D.push({bwtype:te,bandwidth:Ie}),this.currentLine++}}return D}parseVersion(){const D=this.getCurrentRecord();if(D.type!==N.VERSION)throw new Error("first sdp record must be version");const q=D.value.slice(0,this.consumeOneOrMore(D.value,0,M));if(q.length!==D.value.length)throw new Error('invalid proto version, "v='.concat(D.value,'"'));return this.currentLine++,q}parseOrigin(){const D=this.getCurrentRecord();if(D.type!==N.ORIGIN)throw new Error("second line of sdp must be origin");const q=this.extractOneOrMore(D,Y);this.consumeSpaceForRecord(D);const te=this.extractOneOrMore(D,M);this.consumeSpaceForRecord(D);const Ie=this.extractOneOrMore(D,M);this.consumeSpaceForRecord(D);const It=this.extractOneOrMore(D,X);this.consumeSpaceForRecord(D);const wn=this.extractOneOrMore(D,X);this.consumeSpaceForRecord(D);const ls=this.extract(D,this.consumeUnicastAddress);return this.currentLine++,{username:q,sessId:te,sessVersion:Ie,nettype:It,addrtype:wn,unicastAddress:ls}}parseSessionName(){const D=this.getCurrentRecord();if(D.type===N.SESSION_NAME){const q=this.extract(D,this.consumeText);return this.currentLine++,q}}parseInformation(){const D=this.getCurrentRecord();if(D.type!==N.INFORMATION)return;const q=this.extract(D,this.consumeText);return this.currentLine++,q}parseUri(){const D=this.getCurrentRecord();if(D.type===N.URI)return this.currentLine++,D.value}parseEmail(){const D=[];for(;;){const q=this.getCurrentRecord();if(q.type!==N.EMAIL)break;D.push(q.value),this.currentLine++}return D}parsePhone(){const D=[];for(;;){const q=this.getCurrentRecord();if(q.type!==N.PHONE)break;D.push(q.value),this.currentLine++}return D}parseConnection(){const D=this.getCurrentRecord();if(D.type===N.CONNECTION){const q=this.extractOneOrMore(D,X);this.consumeSpaceForRecord(D);const te=this.extractOneOrMore(D,X);this.consumeSpaceForRecord(D);const Ie=this.extract(D,this.consumeAddress);return this.currentLine++,{nettype:q,addrtype:te,address:Ie}}}parseMedia(){const D=this.getCurrentRecord(),q=this.extract(D,this.consumeToken);this.consumeSpaceForRecord(D);let te=this.extract(D,this.consumePort);D.value[D.cur]==="/"&&(D.cur+=1,te+=this.extract(D,this.consumeInteger)),this.consumeSpaceForRecord(D);const Ie=[];for(Ie.push(this.extract(D,this.consumeToken));D.value[D.cur]==="/";)D.cur+=1,Ie.push(this.extract(D,this.consumeToken));if(Ie.length===0)throw new Error("Invalid proto");const It=this.parseFmt(D);return this.currentLine++,{mediaType:q,port:te,protos:Ie,fmts:It}}parseTimeFields(){const D=[];for(;this.getCurrentRecord().type===N.TIME;){const q=this.parseTime(),te=this.parseRepeat(),Ie=this.parseZone();D.push({time:q,repeats:te,zones:Ie})}return D}parseMediaDescription(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===N.MEDIA;){const q=this.parseMedia(),te=this.parseInformation(),Ie=this.parseConnections(),It=this.parseBandWidth(),wn=this.parseKey(),ls=this.parseMediaAttributes(q);D.push({media:q,information:te,connections:Ie,bandwidths:It,key:wn,attributes:ls})}return D}parseConnections(){const D=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===N.CONNECTION;)D.push(this.parseConnection());return D}parseFmt(D){const q=[];for(;;)try{this.consumeSpaceForRecord(D),q.push(this.extract(D,this.consumeToken))}catch{break}if(q.length===0)throw new Error("Invalid fmts");return q}extract(D,q,...te){const Ie=q.call(this,D.value,D.cur,...te),It=D.value.slice(D.cur,Ie);return D.cur=Ie,It}extractOneOrMore(D,q){const te=this.consumeOneOrMore(D.value,D.cur,q),Ie=D.value.slice(D.cur,te);return D.cur=te,Ie}consumeSpaceForRecord(D){if(D.value[D.cur]!==w)throw new Error("Invalid space at ".concat(D.cur,"."));D.cur+=1}}class Tn extends At{constructor(...D){super(...D),yn(this,"attributes",void 0),yn(this,"digested",!1)}extractOneOrMore(D,q,te){const Ie=this.consumeOneOrMore(D.attValue,D._cur,q),It=D.attValue.slice(D._cur,Ie),[wn,ls]=te||[];if(typeof wn=="number"&&It.length<wn)throw new Error("error in length, should be more or equal than ".concat(wn," characters."));if(typeof ls=="number"&&It.length>ls)throw new Error("error in length, should be less or equal than ".concat(ls," characters."));return D._cur=Ie,It}consumeAttributeSpace(D){if(D.attValue[D._cur]!==w)throw new Error("Invalid space at ".concat(D._cur,"."));D._cur+=1}extract(D,q,...te){if(!D.attValue)throw new Error("Nothing to extract from attValue.");const Ie=q.call(this,D.attValue,D._cur,...te),It=D.attValue.slice(D._cur,Ie);return D._cur=Ie,It}atEnd(D){if(!D.attValue)throw new Error;return D._cur>=D.attValue.length}peekChar(D){if(!D.attValue)throw new Error;return D.attValue[D._cur]}peek(D,q){if(!D.attValue)throw new Error;for(let te=0;te<q.length;te++)if(q[te]!==D.attValue[D._cur+te])return!1;return!0}parseIceUfrag(D){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(D,lt,[4,256])}parseIcePwd(D){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(D,lt,[22,256])}parseIceOptions(D){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const q=[];for(;!this.atEnd(D);){q.push(this.extractOneOrMore(D,lt));try{this.consumeAttributeSpace(D)}catch(te){if(this.atEnd(D))break;throw te}}this.attributes.iceOptions=q}parseFingerprint(D){const q=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const te=this.extract(D,this.consumeTill);this.attributes.fingerprints.push({hashFunction:q,fingerprint:te})}parseExtmap(D){const q=this.extractOneOrMore(D,M);let te;this.peekChar(D)==="/"&&(this.extract(D,this.consume,"/"),te=this.extract(D,this.consumeToken)),this.consumeAttributeSpace(D);const Ie=this.extract(D,this.consumeTill,w),It=Ze(Ze({entry:parseInt(q,10)},te&&{direction:te}),{},{extensionName:Ie});this.peekChar(D)===w&&(this.consumeAttributeSpace(D),It.extensionAttributes=this.extract(D,this.consumeTill)),this.attributes.extmaps.push(It)}parseSetup(D){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const q=this.extract(D,this.consumeTill);if(q!=="active"&&q!=="passive"&&q!=="actpass"&&q!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=q}}class ir extends Tn{constructor(...D){super(...D),yn(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"group":this.parseGroup(D);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"fingerprint":this.parseFingerprint(D);break;case"setup":this.parseSetup(D);break;case"tls-id":this.parseTlsId(D);break;case"identity":this.parseIdentity(D);break;case"extmap":this.parseExtmap(D);break;case"msid-semantic":this.parseMsidSemantic(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(q){throw console.error("parsing session attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),q}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(D){const q=this.extract(D,this.consumeToken),te=[];for(;!this.atEnd(D)&&this.peekChar(D)===w;)this.consumeAttributeSpace(D),te.push(this.extract(D,this.consumeToken));this.attributes.groups.push({semantic:q,identificationTag:te})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(D){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(D,Ve)}parseIdentity(D){const q=this.extractOneOrMore(D,Ge),te=[];for(;!this.atEnd(D)&&this.peekChar(D)===w;){this.consumeAttributeSpace(D);const Ie=this.extract(D,this.consumeToken);this.extract(D,this.consume,"=");const It=this.extractOneOrMore(D,wn=>wn!==w&&Ue(wn));te.push({name:Ie,value:It})}this.attributes.identities.push({assertionValue:q,extensions:te})}parseMsidSemantic(D){this.peekChar(D)===w&&this.consumeAttributeSpace(D);const q={semantic:this.extract(D,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(D)}catch{break}if(this.peekChar(D)==="*"){this.extract(D,this.consume,"*"),q.applyForAll=!0;break}{const te=this.extract(D,this.consumeTill,w);q.identifierList.push(te)}}this.attributes.msidSemantic=q}}class us extends Tn{constructor(D){super(),yn(this,"attributes",void 0),D.protos.indexOf("RTP")!==-1||D.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(D){if(this.digested)throw new Error("already digested");try{switch(D.attField){case"extmap":this.parseExtmap(D);break;case"setup":this.parseSetup(D);break;case"ice-ufrag":this.parseIceUfrag(D);break;case"ice-pwd":this.parseIcePwd(D);break;case"ice-options":this.parseIceOptions(D);break;case"candidate":this.parseCandidate(D);break;case"remote-candidate":this.parseRemoteCandidate(D);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(D);break;case"rtpmap":this.parseRtpmap(D);break;case"ptime":this.parsePtime(D);break;case"maxptime":this.parseMaxPtime(D);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(D);break;case"ssrc":this.parseSSRC(D);break;case"fmtp":this.parseFmtp(D);break;case"rtcp-fb":this.parseRtcpFb(D);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(D);break;case"mid":this.parseMid(D);break;case"msid":this.parseMsid(D);break;case"imageattr":this.parseImageAttr(D);break;case"rid":this.parseRid(D);break;case"simulcast":this.parseSimulcast(D);break;case"sctp-port":this.parseSctpPort(D);break;case"max-message-size":this.parseMaxMessageSize(D);break;case"ssrc-group":this.parseSSRCGroup(D);break;default:D.ignored=!0,this.attributes.unrecognized.push(D)}}catch(q){throw console.error("parsing media attribute ".concat(D.attField,' error, "a=').concat(D.attField,":").concat(D.attValue,'"')),q}if(!D.ignored&&D.attValue&&!this.atEnd(D))throw new Error("attribute parsing error")}parseCandidate(D){const q=this.extractOneOrMore(D,lt,[1,32]);this.consumeAttributeSpace(D);const te=this.extractOneOrMore(D,M,[1,5]);this.consumeAttributeSpace(D);const Ie=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const It=this.extractOneOrMore(D,M,[1,10]);this.consumeAttributeSpace(D);const wn=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const ls=this.extract(D,this.consumePort);this.consumeAttributeSpace(D),this.extract(D,this.consume,"typ"),this.consumeAttributeSpace(D);const oa={foundation:q,componentId:te,transport:Ie,priority:It,connectionAddress:wn,port:ls,type:this.extract(D,this.consumeToken),extension:{}};for(this.peek(D," raddr")&&(this.extract(D,this.consume," raddr"),this.consumeAttributeSpace(D),oa.relAddr=this.extract(D,this.consumeAddress)),this.peek(D," rport")&&(this.extract(D,this.consume," rport"),this.consumeAttributeSpace(D),oa.relPort=this.extract(D,this.consumePort));this.peekChar(D)===w;){this.consumeAttributeSpace(D);const Uu=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D),oa.extension[Uu]=this.extractOneOrMore(D,U)}this.attributes.candidates.push(oa)}parseRemoteCandidate(D){const q=[];for(;;){const te=this.extractOneOrMore(D,M,[1,5]);this.consumeAttributeSpace(D);const Ie=this.extract(D,this.consumeAddress);this.consumeAttributeSpace(D);const It=this.extract(D,this.consumePort);q.push({componentId:te,connectionAddress:Ie,port:It});try{this.consumeAttributeSpace(D)}catch{break}}this.attributes.remoteCandidatesList.push(q)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(D){const q=this.extract(D,this.consumeToken);this.consumeAttributeSpace(D);const te=this.extract(D,this.consumeTill,"/");this.extract(D,this.consume,"/");const Ie={encodingName:te,clockRate:this.extractOneOrMore(D,M)};this.atEnd(D)||this.peekChar(D)!=="/"||(this.extract(D,this.consume,"/"),Ie.encodingParameters=parseInt(this.extract(D,this.consumeTill),10));const It=this.attributes.payloads.find(wn=>wn.payloadType===parseInt(q,10));It?It.rtpMap=Ie:this.attributes.payloads.push({payloadType:parseInt(q,10),rtpMap:Ie,rtcpFeedbacks:[]})}parsePtime(D){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(D,this.consumeTill)}parseMaxPtime(D){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(D,this.consumeTill)}parseDirection(D){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=D.attField}parseSSRC(D){const q=this.extractOneOrMore(D,M);this.consumeAttributeSpace(D);const te=this.extract(D,this.consumeTill,":");let Ie;this.peekChar(D)===":"&&(this.extract(D,this.consume,":"),Ie=this.extract(D,this.consumeTill));const It=this.attributes.ssrcs.find(wn=>wn.ssrcId===parseInt(q,10));It?It.attributes[te]=Ie:this.attributes.ssrcs.push({ssrcId:parseInt(q,10),attributes:{[te]:Ie}})}parseFmtp(D){const q=this.extract(D,this.consumeTill,w);this.consumeAttributeSpace(D);const te=this.extract(D,this.consumeTill),Ie={};te.split(";").forEach(wn=>{let[ls,oa]=wn.split("=");ls=ls.trim();const Uu=typeof oa=="string"?oa.trim():null;typeof ls=="string"&&ls.length>0&&(Ie[ls]=Uu)});const It=this.attributes.payloads.find(wn=>wn.payloadType===parseInt(q,10));It?It.fmtp={parameters:Ie}:this.attributes.payloads.push({payloadType:parseInt(q,10),rtcpFeedbacks:[],fmtp:{parameters:Ie}})}parseFmtParameters(D){const q={},te=this.extract(D,this.consumeTill,"=");D._cur++;const Ie=this.extract(D,this.consumeTill,";");for(q[te]=Ie;D.attValue[D._cur]===";";){const It=this.extract(D,this.consumeTill,"=");D._cur++;const wn=this.extract(D,this.consumeTill,";");q[It]=wn}return q}parseRtcpFb(D){let q="";q=this.peekChar(D)==="*"?this.extract(D,this.consume,"*"):this.extract(D,this.consumeTill,w),this.consumeAttributeSpace(D);const te=this.extract(D,this.consumeTill,w);let Ie;switch(te){case"trr-int":Ie={type:te,interval:this.extract(D,this.consumeTill)};break;case"ack":case"nack":default:{const It={type:te};this.peekChar(D)===w&&(this.consumeAttributeSpace(D),It.parameter=this.extract(D,this.consumeToken),this.peekChar(D)===w&&(It.additional=this.extract(D,this.consumeTill))),Ie=It}}if(q==="*")this.attributes.rtcpFeedbackWildcards.push(Ie);else{const It=this.attributes.payloads.find(wn=>wn.payloadType===parseInt(q,10));It?It.rtcpFeedbacks.push(Ie):this.attributes.payloads.push({payloadType:parseInt(q,10),rtcpFeedbacks:[Ie]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(D){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const q={port:this.extract(D,this.consumePort)};this.peekChar(D)===w&&(this.consumeAttributeSpace(D),q.netType=this.extractOneOrMore(D,X),this.consumeAttributeSpace(D),q.addressType=this.extractOneOrMore(D,X),this.consumeAttributeSpace(D),q.address=this.extract(D,this.consumeAddress)),this.attributes.rtcp=q}parseMsid(D){const q={id:this.extractOneOrMore(D,X,[1,64])};this.peekChar(D)===w&&(this.consumeAttributeSpace(D),q.appdata=this.extractOneOrMore(D,X,[1,64])),this.attributes.msids.push(q)}parseImageAttr(D){this.attributes.imageattr.push(D.attValue)}parseRid(D){const q=this.extractOneOrMore(D,Ie=>fe(Ie)||M(Ie)||Ie==="_"||Ie==="-");this.consumeAttributeSpace(D);const te={id:q,direction:this.extract(D,this.consumeToken),params:[]};if(this.peekChar(D)===w){if(this.consumeAttributeSpace(D),this.peek(D,"pt=")){this.extract(D,this.consume,"pt=");const Ie=[];for(;;){const It=this.extract(D,this.consumeToken);Ie.push(It);try{this.extract(D,this.consume,",")}catch{break}}te.payloads=Ie,this.peekChar(D)===w&&this.extract(D,this.consume,w)}for(;;){const Ie=this.extract(D,this.consumeToken);switch(Ie){case"depend":{const It={type:Ie,rids:this.extract(D,this.consume,"=").split(",")};te.params.push(It);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const It={type:Ie};this.peekChar(D)==="="&&(this.extract(D,this.consume,"="),It.val=this.extract(D,this.consumeTill,";")),te.params.push(It)}}try{this.extract(D,this.consume,";")}catch{break}}}this.attributes.rids.push(te)}parseSimulcast(D){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=D.attValue,this.extract(D,this.consumeTill)}parseSctpPort(D){this.attributes.sctpPort=this.extractOneOrMore(D,M,[1,5])}parseMaxMessageSize(D){this.attributes.maxMessageSize=this.extractOneOrMore(D,M,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(D){this.attributes.mid=this.extract(D,this.consumeToken)}parseSSRCGroup(D){const q=this.extract(D,this.consumeToken),te=[];for(;;)try{this.consumeAttributeSpace(D);const Ie=this.extract(D,this.consumeInteger);te.push(parseInt(Ie,10))}catch{break}this.attributes.ssrcGroups.push({semantic:q,ssrcIds:te})}}function tr($e,D,q){return D in $e?Object.defineProperty($e,D,{value:q,enumerable:!0,configurable:!0,writable:!0}):$e[D]=q,$e}class wo{constructor(){tr(this,"eol",C)}print(D,q){let te="";return q&&(this.eol=q),te+=this.printVersion(D.version),te+=this.printOrigin(D.origin),te+=this.printSessionName(D.sessionName),te+=this.printInformation(D.information),te+=this.printUri(D.uri),te+=this.printEmail(D.emails),te+=this.printPhone(D.phones),te+=this.printConnection(D.connection),te+=this.printBandwidth(D.bandwidths),te+=this.printTimeFields(D.timeFields),te+=this.printKey(D.key),te+=this.printSessionAttributes(D.attributes),te+=this.printMediaDescription(D.mediaDescriptions),te}printVersion(D){return"v=".concat(D).concat(this.eol)}printOrigin(D){return"o=".concat(D.username," ").concat(D.sessId," ").concat(D.sessVersion," ").concat(D.nettype," ").concat(D.addrtype," ").concat(D.unicastAddress).concat(this.eol)}printSessionName(D){return D?"s=".concat(D).concat(this.eol):""}printInformation(D){return D?"i=".concat(D).concat(this.eol):""}printUri(D){return D?"u=".concat(D).concat(this.eol):""}printEmail(D){let q="";for(const te of D)q+="e=".concat(te).concat(this.eol);return q}printPhone(D){let q="";for(const te of D)q+="e=".concat(te).concat(this.eol);return q}printConnection(D){return D?"c=".concat(D.nettype," ").concat(D.addrtype," ").concat(D.address).concat(this.eol):""}printBandwidth(D){let q="";for(const te of D)q+="b=".concat(te.bwtype,":").concat(te.bandwidth).concat(this.eol);return q}printTimeFields(D){let q="";for(const te of D){q+="t=".concat(te.time.startTime," ").concat(te.time.startTime).concat(this.eol);for(const Ie of te.repeats)q+="r=".concat(Ie.repeatInterval," ").concat(Ie.typedTimes.join(" ")).concat(this.eol);te.zoneAdjustments&&(q+="z=",q+="z=".concat(te.zoneAdjustments.map(Ie=>"".concat(Ie.time," ").concat(Ie.back?"-":""," ").concat(Ie.typedTime)).join(" ")).concat(this.eol),q+=this.eol)}return q}printKey(D){return D?"k=".concat(D).concat(this.eol):""}printAttributes(D){let q="";for(const te of D)q+="a=".concat(te.attField).concat(te.attValue?":".concat(te.attValue):"").concat(this.eol);return q}printMediaDescription(D){let q="";for(const te of D)q+=this.printMedia(te.media),q+=this.printInformation(te.information),q+=this.printConnections(te.connections),q+=this.printBandwidth(te.bandwidths),q+=this.printKey(te.key),q+=this.printMediaAttributes(te);return q}printConnections(D){let q="";for(const te of D)q+=this.printConnection(te);return q}printMedia(D){return"m=".concat(D.mediaType," ").concat(D.port," ").concat(D.protos.join("/")," ").concat(D.fmts.join(" ")).concat(this.eol)}printSessionAttributes(D){return new xe(this.eol).print(D)}printMediaAttributes(D){return new Ke(this.eol).print(D)}}class ve{constructor(D){tr(this,"eol",void 0),this.eol=D}printIceUfrag(D){return D===void 0?"":"a=ice-ufrag:".concat(D).concat(this.eol)}printIcePwd(D){return D===void 0?"":"a=ice-pwd:".concat(D).concat(this.eol)}printIceOptions(D){return D===void 0?"":"a=ice-options:".concat(D.join(w)).concat(this.eol)}printFingerprints(D){return D.length>0?D.map(q=>"a=fingerprint:".concat(q.hashFunction).concat(w).concat(q.fingerprint)).join(this.eol)+this.eol:""}printExtmap(D){return D.map(q=>"a=extmap:".concat(q.entry).concat(q.direction?"/".concat(q.direction):"").concat(w).concat(q.extensionName).concat(q.extensionAttributes?"".concat(w).concat(q.extensionAttributes):"").concat(this.eol)).join("")}printSetup(D){return D===void 0?"":"a=setup:".concat(D).concat(this.eol)}printUnrecognized(D){return D.map(q=>"a=".concat(q.attField).concat(q.attValue?":".concat(q.attValue):"").concat(this.eol)).join("")}}class xe extends ve{print(D){let q="";return q+=this.printGroups(D.groups),q+=this.printMsidSemantic(D.msidSemantic),q+=this.printIceLite(D.iceLite),q+=this.printIceUfrag(D.iceUfrag),q+=this.printIcePwd(D.icePwd),q+=this.printIceOptions(D.iceOptions),q+=this.printFingerprints(D.fingerprints),q+=this.printSetup(D.setup),q+=this.printTlsId(D.tlsId),q+=this.printIdentity(D.identities),q+=this.printExtmap(D.extmaps),q+=this.printUnrecognized(D.unrecognized),q}printGroups(D){let q="";return D.length>0&&(q+=D.map(te=>"a=group:".concat(te.semantic).concat(te.identificationTag.map(Ie=>"".concat(w).concat(Ie)).join("")).concat(this.eol)).join("")),q}printIceLite(D){return D===void 0?"":"a=ice-lite"+this.eol}printTlsId(D){return D?"a=tls-id:".concat(D).concat(this.eol):""}printIdentity(D){return D.length===0?"":D.map(q=>"a=identity:".concat(q.assertionValue).concat(q.extensions.map(te=>"".concat(w).concat(te.name).concat(te.value?"=".concat(te.value):"")))).join(this.eol)+this.eol}printMsidSemantic(D){if(!D)return"";let q="a=msid-semantic:".concat(D.semantic);return D.applyForAll?q+="".concat(w,"*"):D.identifierList.length>0&&(q+=D.identifierList.map(te=>"".concat(w).concat(te))),q+this.eol}}class Ke extends ve{print(D){const q=D.attributes;let te="";return te+=this.printRTCP(q.rtcp),te+=this.printIceUfrag(q.iceUfrag),te+=this.printIcePwd(q.icePwd),te+=this.printIceOptions(q.iceOptions),te+=this.printCandidates(q.candidates),te+=this.printRemoteCandidatesList(q.remoteCandidatesList),te+=this.printEndOfCandidates(q.endOfCandidates),te+=this.printFingerprints(q.fingerprints),te+=this.printSetup(q.setup),te+=this.printMid(q.mid),te+=this.printExtmap(q.extmaps),te+=this.printRTPRelated(q),te+=this.printPtime(q.ptime),te+=this.printMaxPtime(q.maxPtime),te+=this.printDirection(q.direction),te+=this.printSSRCGroups(q.ssrcGroups),te+=this.printSSRC(q.ssrcs),te+=this.printRTCPMux(q.rtcpMux),te+=this.printRTCPMuxOnly(q.rtcpMuxOnly),te+=this.printRTCPRsize(q.rtcpRsize),te+=this.printMSId(q.msids),te+=this.printImageattr(q.imageattr),te+=this.printRid(q.rids),te+=this.printSimulcast(q.simulcast),te+=this.printSCTPPort(q.sctpPort),te+=this.printMaxMessageSize(q.maxMessageSize),te+=this.printUnrecognized(q.unrecognized),te}printCandidates(D){return D.map(q=>"a=candidate:".concat(q.foundation).concat(w).concat(q.componentId).concat(w).concat(q.transport).concat(w).concat(q.priority).concat(w).concat(q.connectionAddress).concat(w).concat(q.port).concat(w,"typ").concat(w).concat(q.type).concat(q.relAddr?"".concat(w,"raddr").concat(w).concat(q.relAddr):"").concat(q.relPort?"".concat(w,"rport").concat(w).concat(q.relPort):"").concat(Object.keys(q.extension).map(te=>"".concat(w).concat(te).concat(w).concat(q.extension[te])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(D){return D.map(q=>"a=remote-candidates:".concat(q.join(w)).concat(this.eol)).join("")}printEndOfCandidates(D){return D===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(D){if(!D.payloads)return"";const q=D.payloads;let te="";te+=D.rtcpFeedbackWildcards.map(Ie=>this.printRTCPFeedback("*",Ie)).join("");for(const Ie of q)te+=this.printRtpMap(Ie.payloadType,Ie.rtpMap),te+=this.printFmtp(Ie.payloadType,Ie.fmtp),te+=Ie.rtcpFeedbacks.map(It=>this.printRTCPFeedback(Ie.payloadType,It)).join("");return te}printFmtp(D,q){if(!q)return"";const te=Object.keys(q.parameters);return te.length===1&&q.parameters[te[0]]===null?"a=fmtp:".concat(D).concat(w).concat(te[0]).concat(this.eol):"a=fmtp:".concat(D).concat(w).concat(Object.keys(q.parameters).map(Ie=>"".concat(Ie,"=").concat(q.parameters[Ie])).join(";")).concat(this.eol)}printRtpMap(D,q){return q?"a=rtpmap:".concat(D).concat(w).concat(q.encodingName,"/").concat(q.clockRate).concat(q.encodingParameters?"/".concat(q.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(D,q){let te="a=rtcp-fb:".concat(D).concat(w),Ie=q;switch(Ie.type){case"trr-int":te+="ttr-int".concat(w).concat(Ie.interval);break;case"ack":case"nack":default:Ie=Ie,te+="".concat(Ie.type),Ie.parameter&&(te+="".concat(w).concat(Ie.parameter),Ie.additional&&(te+="".concat(w).concat(Ie.additional)))}return te+this.eol}printPtime(D){return D===void 0?"":"a=ptime:".concat(D).concat(this.eol)}printMaxPtime(D){return D===void 0?"":"a=maxptime:".concat(D).concat(this.eol)}printDirection(D){return D===void 0?"":"a=".concat(D).concat(this.eol)}printSSRC(D){return D.map(q=>Object.keys(q.attributes).map(te=>"a=ssrc:".concat(q.ssrcId.toString(10)).concat(w).concat(te).concat(q.attributes[te]?":".concat(q.attributes[te]):"").concat(this.eol)).join("")).join("")}printRTCPMux(D){return D===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(D){return D===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(D){return D===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(D){if(D===void 0)return"";let q="a=rtcp:".concat(D.port);return D.netType&&(q+="".concat(w).concat(D.netType)),D.addressType&&(q+="".concat(w).concat(D.addressType)),D.address&&(q+="".concat(w).concat(D.address)),q+this.eol}printMSId(D){return D.map(q=>"a=msid:".concat(q.id).concat(q.appdata?"".concat(w).concat(q.appdata):"").concat(this.eol)).join("")}printImageattr(D){return D.map(q=>"a=imageattr:".concat(q).concat(this.eol)).join("")}printRid(D){return D.map(q=>{let te="a=rid:".concat(q.id).concat(w).concat(q.direction);return q.payloads&&(te+="".concat(w,"pt=").concat(q.payloads.join(","))),q.params.length>0&&(te+="".concat(w).concat(q.params.map(Ie=>Ie.type==="depend"?"depend=".concat(Ie.rids.join(",")):"".concat(Ie.type,"=").concat(Ie.val)).join(";"))),te+this.eol}).join("")}printSimulcast(D){return D===void 0?"":"a=simulcast:".concat(D).concat(this.eol)}printSCTPPort(D){return D===void 0?"":"a=sctp-port:".concat(D).concat(this.eol)}printMaxMessageSize(D){return D===void 0?"":"a=max-message-size:".concat(D).concat(this.eol)}printMid(D){return D===void 0?"":"a=mid:".concat(D).concat(this.eol)}printSSRCGroups(D){return D.map(q=>"a=ssrc-group:".concat(q.semantic).concat(q.ssrcIds.map(te=>"".concat(w).concat(te.toString(10))).join("")).concat(this.eol)).join("")}}function vt($e){return new Dn().parse($e)}function Yt($e,D){return new wo().print($e,D)}}},u={};function h(g){if(u[g])return u[g].exports;var E=u[g]={exports:{}};return a[g](E,E.exports,h),E.exports}return h.d=(g,E)=>{for(var S in E)h.o(E,S)&&!h.o(g,S)&&Object.defineProperty(g,S,{enumerable:!0,get:E[S]})},h.o=(g,E)=>Object.prototype.hasOwnProperty.call(g,E),h.r=g=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},h(8)})()})(hr);class Bq{constructor(o){k(this,"sessionDesc",void 0),k(this,"localCapabilities",void 0),k(this,"rtpCapabilities",void 0),k(this,"candidates",void 0),k(this,"iceParameters",void 0),k(this,"dtlsParameters",void 0),k(this,"setup",void 0),k(this,"currentMidIndex",void 0),k(this,"cname",void 0),o=lr(o);const{remoteIceParameters:a,remoteDtlsParameters:u,candidates:h,remoteRTPCapabilities:g,remoteSetup:E,localCapabilities:S,sdkCodec:T,cname:C}=o,w=hr.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=g,this.candidates=h,this.iceParameters=a,this.dtlsParameters=u,this.setup=E,this.localCapabilities=S,this.cname=C;for(let N=0;N<w.mediaDescriptions.length;N++){const M=w.mediaDescriptions[N];if(M.attributes.iceUfrag=a.iceUfrag,M.attributes.icePwd=a.icePwd,M.attributes.fingerprints=u.fingerprints,M.attributes.candidates=h,M.attributes.setup=E,M.media.mediaType==="video"){M.media.fmts=g.videoCodecs.map(Y=>Y.payloadType.toString(10));const U=g.videoCodecs.filter(Y=>{var X;return(X=Y.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase().includes(T)});if(U.length===0)throw new Error("Codec ".concat(T," not supported by remote SDP."));M.attributes.payloads=U,M.attributes.extmaps=g.videoExtensions}M.media.mediaType==="audio"&&(M.media.fmts=g.audioCodecs.map(U=>U.payloadType.toString(10)),M.attributes.payloads=g.audioCodecs,M.attributes.extmaps=g.audioExtensions),w.mediaDescriptions[N]=this.mungMediaDesc(M)}this.sessionDesc=w,this.currentMidIndex=w.mediaDescriptions.length-1}toString(){return hr.exports.print(this.sessionDesc)}send(o,a,u){const{ssrcs:h,ssrcGroups:g}=xi(a,this.cname),E=this.sessionDesc.mediaDescriptions.find(C=>o===Ot.VIDEO?C.media.mediaType==="video":C.media.mediaType==="audio"),S=h[0].attributes.label,T=h[0].attributes.mslabel;return E.attributes.ssrcs=E.attributes.ssrcs.concat(h),E.attributes.ssrcGroups=E.attributes.ssrcGroups.concat(g),{id:S,mslabel:T}}batchSend(o){return o.map(a=>{let{kind:u,ssrcMsg:h}=a;return this.send(u,h,void 0)})}stopSending(o){this.sessionDesc.mediaDescriptions.forEach(a=>{const u=[],h=[],g=[];a.attributes.ssrcs.forEach(E=>{o.includes(E.attributes.label||"")?g.push(E):u.push(E)}),a.attributes.ssrcGroups.forEach(E=>{g.map(S=>S.ssrcId).includes(E.ssrcIds[0])||h.push(E)}),a.attributes.ssrcs=u,a.attributes.ssrcGroups=h})}mute(o){const a=this.sessionDesc.mediaDescriptions.find(u=>u.attributes.mid===o);if(!a)throw new Error("mediaDescription not found with ".concat(o," in remote SDP when calling RemoteSDP.mute."));a.attributes.direction="inactive"}unmute(o){const a=this.sessionDesc.mediaDescriptions.find(u=>u.attributes.mid===o);if(!a)throw new Error("mediaDescription not found with ".concat(o," in remote SDP when calling RemoteSDP.unmute."));a.attributes.direction="sendonly"}receive(o,a,u){o.forEach((h,g)=>{const E=h._mediaStreamTrack,S=this.sessionDesc.mediaDescriptions.findIndex(C=>C.attributes.mid===E.kind),T=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[S],h);this.sessionDesc.mediaDescriptions[S]=T})}stopReceiving(o){}restartICE(o){o=lr(o),this.iceParameters=o,this.sessionDesc.mediaDescriptions.forEach(a=>{a.attributes.iceUfrag=o.iceUfrag,a.attributes.icePwd=o.icePwd})}predictReceivingMids(o){const a=[];for(let u=0;u<o;u++)a.push((this.currentMidIndex+u+1).toString(10));return a}mungRecvMediaDsec(o,a){const u=lr(o);return $h(u,a),oT(u,a),u}updateRecvMedia(o,a){const u=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===o);if(u!==-1){const h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u],a);this.sessionDesc.mediaDescriptions[u]=h}}bumpMid(o){this.currentMidIndex+=o}updateTrackLabel(o,a,u){const h=this.sessionDesc.mediaDescriptions.find(E=>o===Ot.VIDEO?E.attributes.mid==="video":E.attributes.mid==="audio");if(h){const E=h.attributes.ssrcs.find(S=>S.attributes.label===a);var g;E&&(E.attributes.label=u,(g=E.attributes.msid)===null||g===void 0||g.replace(a,u))}}mungMediaDesc(o){const a=lr(o);return sT(a),function(u){const h=u.attributes.extmaps.find(g=>g.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");h&&u.attributes.extmaps.splice(u.attributes.extmaps.indexOf(h),1),u.attributes.payloads.forEach(g=>{const E=g.rtcpFeedbacks.findIndex(S=>S.type==="transport-cc");E!==-1&&g.rtcpFeedbacks.splice(E,1)})}(a),a}getSSRC(o){for(const a of this.sessionDesc.mediaDescriptions)for(const u of a.attributes.ssrcs)if(u.attributes.label===o)return[u]}}function ra(r){if(Array.isArray(r))return r.map(a=>a);if(!TP(r))return r;const o={};for(const a in r)TP(r[a])||Array.isArray(r[a])?o[a]=ra(r[a]):o[a]=r[a];return o}function TP(r){return!(typeof r!="object"||Array.isArray(r)||!r)}function jq(){const r=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return r&&r[0]?Number(r[0].split("/")[1]):null}function Wq(r){return window.RTCStatsReport?r.getStats()instanceof Je:!1}class aT{constructor(o){k(this,"input",[]),k(this,"size",void 0),this.size=o}add(o){this.input.push(o),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const IP={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Pf={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:IP,remoteCandidate:IP}},CP={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},wP={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},RP={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},bP={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};class cT{constructor(o,a){k(this,"onFirstVideoReceived",void 0),k(this,"onFirstVideoDecoded",void 0),k(this,"onFirstAudioReceived",void 0),k(this,"onFirstVideoDecodedTimeout",void 0),k(this,"onFirstAudioDecoded",void 0),k(this,"onSelectedLocalCandidateChanged",void 0),k(this,"onSelectedRemoteCandidateChanged",void 0),k(this,"videoIsReady",!1),k(this,"videoIsReady2",{}),k(this,"pc",void 0),k(this,"options",void 0),k(this,"intervalTimer",void 0),k(this,"stats",ra(Pf)),k(this,"isFirstVideoReceived",{}),k(this,"isFirstVideoDecoded",{}),k(this,"isFirstAudioReceived",{}),k(this,"isFirstAudioDecoded",{}),k(this,"isFirstVideoDecodedTimeout",{}),k(this,"lossRateWindowStats",[]),this.pc=o,this.options=a,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}setVideoIsReady(o){this.videoIsReady=o}setVideoIsReady2(o,a){this.videoIsReady2[o]=a}getVideoIsReady(o){return this.videoIsReady2[o]||!1}setIsFirstAudioDecoded(o){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(o){this.lossRateWindowStats.push(o),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const a=this.lossRateWindowStats.length,u=["videoSend","audioSend","videoRecv","audioRecv"];let h=0,g=0,E=0,S=0;for(const T of u)o[T].forEach((C,w)=>{if(!this.lossRateWindowStats[a-1][T][w]||!this.lossRateWindowStats[0][T][w])return;const N=this.lossRateWindowStats[a-1][T][w].packets-this.lossRateWindowStats[0][T][w].packets,M=this.lossRateWindowStats[a-1][T][w].packetsLost-this.lossRateWindowStats[0][T][w].packetsLost;T==="videoSend"||T==="audioSend"?(h+=N,E+=M):(g+=N,S+=M),Number.isNaN(N)||Number.isNaN(N)?C.packetLostRate=0:C.packetLostRate=N<=0||M<=0?0:M/(N+M)});o.sendPacketLossRate=h<=0||E<=0?0:E/(h+E),o.recvPacketLossRate=g<=0||S<=0?0:S/(g+S)}}function NP(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function Gq(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?NP(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):NP(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}class zq extends cT{constructor(){super(...arguments),k(this,"_stats",Pf),k(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const o=await this._getStats(),a=this.statsResponsesToObjects(o);this._stats=ra(Pf);const u=a.filter(g=>g.type==="ssrc");this.processSSRCStats(u);const h=a.find(g=>g.type==="VideoBwe");h&&this.processBandwidthStats(h),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(o){this._stats.bitrate={actualEncoded:Number(o.googActualEncBitrate),targetEncoded:Number(o.googTargetEncBitrate),retransmit:Number(o.googRetransmitBitrate),transmit:Number(o.googTransmitBitrate)},this._stats.sendBandwidth=Number(o.googAvailableSendBandwidth)}processSSRCStats(o){o.forEach(a=>{const u=a.id.includes("send");switch("".concat(a.mediaType,"_").concat(u?"send":"recv")){case"video_send":{const h=ra(wP);h.codec=a.googCodecName,h.adaptionChangeReason="none",a.googCpuLimitedResolution&&(h.adaptionChangeReason="cpu"),a.googBandwidthLimitedResolution&&(h.adaptionChangeReason="bandwidth"),h.avgEncodeMs=Number(a.googAvgEncodeMs),h.inputFrame={width:Number(a.googFrameWidthInput)||Number(a.googFrameWidthSent),height:Number(a.googFrameHeightInput)||Number(a.googFrameHeightSent),frameRate:Number(a.googFrameRateInput)},h.sentFrame={width:Number(a.googFrameWidthSent),height:Number(a.googFrameHeightSent),frameRate:Number(a.googFrameRateInput)},h.firsCount=Number(a.googFirReceived),h.nacksCount=Number(a.googNacksReceived),h.plisCount=Number(a.googPlisReceived),h.frameCount=Number(a.framesEncoded),h.bytes=Number(a.bytesSent),h.packets=Number(a.packetsSent),h.packetsLost=Number(a.packetsLost),h.ssrc=Number(a.ssrc),h.rttMs=Number(a.googRtt||0),this._stats.videoSend.push(h),this._stats.rtt=h.rttMs;break}case"video_recv":{const h=ra(CP),g=this.lastDecodeVideoReceiverStats.get(Number(a.ssrc));if(h.codec=a.googCodecName,h.targetDelayMs=Number(a.googTargetDelayMs),h.renderDelayMs=Number(a.googRenderDelayMs),h.currentDelayMs=Number(a.googCurrentDelayMs),h.minPlayoutDelayMs=Number(a.googMinPlayoutDelayMs),h.decodeMs=Number(a.googDecodeMs),h.maxDecodeMs=Number(a.googMaxDecodeMs),h.receivedFrame={width:Number(a.googFrameWidthReceived),height:Number(a.googFrameHeightReceived),frameRate:Number(a.googFrameRateReceived)},h.decodedFrame={width:Number(a.googFrameWidthReceived),height:Number(a.googFrameHeightReceived),frameRate:Number(a.googFrameRateDecoded)},h.decodeFrameRate=Number(a.googFrameRateDecoded),h.outputFrame={width:Number(a.googFrameWidthReceived),height:Number(a.googFrameHeightReceived),frameRate:Number(a.googFrameRateOutput)},h.jitterBufferMs=Number(a.googJitterBufferMs),h.firsCount=Number(a.googFirsSent),h.nacksCount=Number(a.googNacksSent),h.plisCount=Number(a.googPlisSent),h.framesDecodeCount=Number(a.framesDecoded),h.bytes=Number(a.bytesReceived),h.packets=Number(a.packetsReceived),h.packetsLost=Number(a.packetsLost),h.ssrc=Number(a.ssrc),h.packets>0&&!this.isFirstVideoReceived[h.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(h.ssrc),this.isFirstVideoReceived[h.ssrc]=!0),h.framesDecodeCount>0&&!this.isFirstVideoDecoded[h.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(h.ssrc,h.decodedFrame.width,h.decodedFrame.height),this.isFirstVideoDecoded[h.ssrc]=!0),g){const E=g.stats,S=Date.now()-g.lts;h.framesDecodeFreezeTime=E.framesDecodeFreezeTime,h.framesDecodeInterval=E.framesDecodeInterval,h.framesDecodeCount>E.framesDecodeCount&&this.isFirstVideoDecoded[h.ssrc]?(g.lts=Date.now(),h.framesDecodeInterval=S,h.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(a.ssrc,10))?h.framesDecodeFreezeTime+=h.framesDecodeInterval:this.setVideoIsReady2(parseInt(a.ssrc,10),!0))):h.framesDecodeCount<g.stats.framesDecodeCount&&(h.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(h.ssrc,{stats:Gq({},h),lts:Date.now()}),this._stats.videoRecv.push(h);break}case"audio_recv":{const h=ra(bP);h.codec=a.googCodecName,h.outputLevel=Math.abs(Number(a.audioOutputLevel))/32767,h.decodingCNG=Number(a.googDecodingCNG),h.decodingCTN=Number(a.googDecodingCTN),h.decodingCTSG=Number(a.googDecodingCTSG),h.decodingNormal=Number(a.googDecodingNormal),h.decodingPLC=Number(a.googDecodingPLC),h.decodingPLCCNG=Number(a.googDecodingPLCCNG),h.expandRate=Number(a.googExpandRate),h.accelerateRate=Number(a.googAccelerateRate),h.preemptiveExpandRate=Number(a.googPreemptiveExpandRate),h.secondaryDecodedRate=Number(a.googSecondaryDecodedRate),h.speechExpandRate=Number(a.googSpeechExpandRate),h.preferredJitterBufferMs=Number(a.googPreferredJitterBufferMs),h.jitterBufferMs=Number(a.googJitterBufferMs),h.jitterMs=Number(a.googJitterReceived),h.bytes=Number(a.bytesReceived),h.packets=Number(a.packetsReceived),h.packetsLost=Number(a.packetsLost),h.ssrc=Number(a.ssrc),h.receivedFrames=Number(a.googDecodingCTN)||Number(a.packetsReceived),h.droppedFrames=Number(a.googDecodingPLC)+Number(a.googDecodingPLCCNG)||Number(a.packetsLost),h.receivedFrames>0&&!this.isFirstAudioReceived[h.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(h.ssrc),this.isFirstAudioReceived[h.ssrc]=!0),h.decodingNormal>0&&!this.isFirstAudioDecoded[h.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(h.ssrc),this.isFirstAudioDecoded[h.ssrc]=!0),this._stats.audioRecv.push(h);break}case"audio_send":{const h=ra(RP);h.codec=a.googCodecName,h.inputLevel=Math.abs(Number(a.audioInputLevel))/32767,h.aecReturnLoss=Number(a.googEchoCancellationReturnLoss||0),h.aecReturnLossEnhancement=Number(a.googEchoCancellationReturnLossEnhancement||0),h.residualEchoLikelihood=Number(a.googResidualEchoLikelihood||0),h.residualEchoLikelihoodRecentMax=Number(a.googResidualEchoLikelihoodRecentMax||0),h.bytes=Number(a.bytesSent),h.packets=Number(a.packetsSent),h.packetsLost=Number(a.packetsLost),h.ssrc=Number(a.ssrc),h.rttMs=Number(a.googRtt||0),this._stats.rtt=h.rttMs,this._stats.audioSend.push(h);break}}})}_getStats(){return new Je((o,a)=>{this.pc.getStats(o,a)})}statsResponsesToObjects(o){const a=[];return o.result().forEach(u=>{const h={id:u.id,timestamp:u.timestamp.valueOf().toString(),type:u.type};u.names().forEach(g=>{h[g]=u.stat(g)}),a.push(h)}),a}}function AP(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function Lf(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?AP(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):AP(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}class OP extends cT{constructor(){super(...arguments),k(this,"_stats",Pf),k(this,"report",void 0),k(this,"lastDecodeVideoReceiverStats",new Map),k(this,"lastVideoFramesRecv",new Map),k(this,"lastVideoFramesSent",new Map),k(this,"lastVideoFramesDecode",new Map),k(this,"lastVideoJBDelay",new Map),k(this,"lastAudioJBDelay",new Map),k(this,"mediaBytesSent",new Map),k(this,"mediaBytesRetransmit",new Map),k(this,"mediaBytesTargetEncode",new Map),k(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ra(Pf),this.report.forEach(o=>{switch(o.type){case Yi.OUTBOUND:o.mediaType==="audio"?this.processAudioOutboundStats(o):o.mediaType==="video"&&this.processVideoOutboundStats(o);break;case Yi.INBOUND:o.mediaType==="audio"?this.processAudioInboundStats(o):o.mediaType==="video"&&this.processVideoInboundStats(o);break;case Yi.TRANSPORT:{const a=this.report.get(o.selectedCandidatePairId);a&&this.processCandidatePairStats(a);break}case Yi.CANDIDATE_PAIR:o.selected&&this.processCandidatePairStats(o)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processCandidatePairStats(o){if(this._stats.sendBandwidth=o.availableOutgoingBitrate||0,o.currentRoundTripTime&&(this._stats.rtt=1e3*o.currentRoundTripTime),this._stats.videoSend.forEach(a=>{!a.rttMs&&o.currentRoundTripTime&&(a.rttMs=1e3*o.currentRoundTripTime)}),this._stats.audioSend.forEach(a=>{!a.rttMs&&o.currentRoundTripTime&&(a.rttMs=1e3*o.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=o.id,o.localCandidateId){const a=this.report.get(o.localCandidateId);a&&this.processCandidateStats(a)}if(o.remoteCandidateId){const a=this.report.get(o.remoteCandidateId);a&&this.processCandidateStats(a)}}processCandidateStats(o){let a;o.type===Yi.LOCAL_CANDIDATE&&(a=this._stats.selectedCandidatePair.localCandidate),o.type===Yi.REMOTE_CANDIDATE&&(a=this._stats.selectedCandidatePair.remoteCandidate),a&&(a.type=o.type,a.id=o.id,o.address&&(a.address=o.address),o.candidateType&&(a.candidateType=o.candidateType),o.port&&(a.port=o.port),o.priority&&(a.priority=o.priority),o.protocol&&(a.protocol=o.protocol),o.relayProtocol&&(a.relayProtocol=o.relayProtocol),o.type===Yi.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==a.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Lf({},a),Lf({},this.stats.selectedCandidatePair.localCandidate)),o.type===Yi.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==a.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Lf({},a),Lf({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(o){let a=this._stats.audioRecv.find(u=>u.ssrc===o.ssrc);a||(a=ra(bP),this._stats.audioRecv.push(a)),a.ssrc=o.ssrc,a.packets=o.packetsReceived,a.packetsLost=o.packetsLost,a.bytes=o.bytesReceived,a.jitterMs=1e3*o.jitter,this.processAudioTrackReceiverStats(o,o.trackId,a),o.codecId&&(a.codec=this.getCodecFromCodecStats(o.codecId)),a.receivedFrames||(a.receivedFrames=o.packetsReceived),a.droppedFrames||(a.droppedFrames=o.packetsLost),a.receivedFrames>0&&!this.isFirstAudioReceived[a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(a.ssrc),this.isFirstAudioReceived[a.ssrc]=!0),a.outputLevel&&a.outputLevel>0&&!this.isFirstAudioDecoded[a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(a.ssrc),this.isFirstAudioDecoded[a.ssrc]=!0),typeof o.concealedSamples=="number"&&(a.concealedSamples=o.concealedSamples)}processVideoInboundStats(o){let a=this._stats.videoRecv.find(E=>E.ssrc===o.ssrc);a||(a=ra(CP),this._stats.videoRecv.push(a)),a.ssrc=o.ssrc,a.packets=o.packetsReceived,a.packetsLost=o.packetsLost,a.bytes=o.bytesReceived,a.firsCount=o.firCount,a.nacksCount=o.nackCount,a.plisCount=o.pliCount,a.framesDecodeCount=o.framesDecoded,a.totalInterFrameDelay=o.totalInterFrameDelay,a.totalSquaredInterFrameDelay=o.totalSquaredInterFrameDelay;const u=this.lastDecodeVideoReceiverStats.get(a.ssrc),h=this.lastVideoFramesDecode.get(a.ssrc),g=Date.now();if(a.framesDecodeCount>0&&!this.isFirstVideoDecoded[a.ssrc]){const E=a.decodedFrame?a.decodedFrame.width:0,S=a.decodedFrame?a.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(a.ssrc,E,S),this.isFirstVideoDecoded[a.ssrc]=!0}if(u){const E=u.stats,S=g-u.lts;a.framesDecodeFreezeTime=E.framesDecodeFreezeTime,a.framesDecodeInterval=E.framesDecodeInterval,!this.isFirstVideoDecoded[a.ssrc]&&S>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[a.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(a.ssrc),this.isFirstVideoDecodedTimeout[a.ssrc]=!0),a.framesDecodeCount>E.framesDecodeCount&&this.isFirstVideoDecoded[a.ssrc]?(u.lts=Date.now(),a.framesDecodeInterval=S,a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(o.ssrc))?a.framesDecodeFreezeTime+=a.framesDecodeInterval:this.setVideoIsReady2(parseInt(o.ssrc,10),!0))):a.framesDecodeCount<E.framesDecodeCount&&(a.framesDecodeInterval=0),o.framesDecoded&&o.qpSum&&(u.stats.framesDecodeCount>o.framesDecoded?a.qpSumPerFrame=o.qpSum/o.framesDecoded:a.qpSumPerFrame=(o.qpSum-u.qpSum)/(o.framesDecoded-u.stats.framesDecodeCount))}h&&g-h.lts>=800?(a.decodeFrameRate=Math.round((a.framesDecodeCount-h.count)/((g-h.lts)/1e3)),this.lastVideoFramesDecode.set(a.ssrc,{count:a.framesDecodeCount,lts:g,rate:a.decodeFrameRate})):h?a.decodeFrameRate=h.rate:this.lastVideoFramesDecode.set(a.ssrc,{count:a.framesDecodeCount,lts:g,rate:0}),o.totalDecodeTime&&(a.decodeMs=1e3*o.totalDecodeTime),this.processVideoTrackReceiverStats(o,o.trackId,a),o.codecId&&(a.codec=this.getCodecFromCodecStats(o.codecId)),o.framerateMean&&(a.framesRateFirefox=o.framerateMean),a.packets>0&&!this.isFirstVideoReceived[a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(a.ssrc),this.isFirstVideoReceived[a.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(a.ssrc,{stats:Lf({},a),lts:u?u.lts:Date.now(),qpSum:o.qpSum})}processVideoOutboundStats(o){let a=this._stats.videoSend.find(h=>h.ssrc===o.ssrc);a||(a=ra(wP),this._stats.videoSend.push(a));const u=this.mediaBytesSent.get(o.ssrc);if(u)u.add(o.bytesSent);else{const h=new aT(10);h.add(o.bytesSent),this.mediaBytesSent.set(o.ssrc,h)}if(o.retransmittedBytesSent!==void 0){const h=this.mediaBytesRetransmit.get(o.ssrc);if(h)h.add(o.retransmittedBytesSent);else{const g=new aT(10);g.add(o.retransmittedBytesSent),this.mediaBytesRetransmit.set(o.ssrc,g)}}if(o.totalEncodedBytesTarget){const h=this.mediaBytesTargetEncode.get(o.ssrc);if(h)h.add(o.totalEncodedBytesTarget);else{const g=new aT(10);g.add(o.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(o.ssrc,g)}}if(a.ssrc=o.ssrc,a.bytes=o.bytesSent,a.packets=o.packetsSent,a.firsCount=o.firCount,a.nacksCount=o.nackCount,a.plisCount=o.pliCount,a.frameCount=o.framesEncoded,a.adaptionChangeReason=o.qualityLimitationReason,o.totalEncodeTime&&o.framesEncoded){const h=this.lastEncoderMs.get(o.ssrc);if(!h||h.lastFrameCount>o.framesEncoded)a.avgEncodeMs=1e3*o.totalEncodeTime/o.framesEncoded;else{const g=o.framesEncoded-h.lastFrameCount,E=o.totalEncodeTime-h.lastEncoderTime;a.avgEncodeMs=1e3*E/g}}if(o.framesEncoded&&o.qpSum){const h=this.lastEncoderMs.get(o.ssrc);!h||h.lastFrameCount>o.framesEncoded?a.qpSumPerFrame=o.qpSum/o.framesEncoded:a.qpSumPerFrame=(o.qpSum-h.lastQpSum)/(o.framesEncoded-h.lastFrameCount)}if(this.lastEncoderMs.set(o.ssrc,{lastFrameCount:o.framesEncoded,lastEncoderTime:o.totalEncodeTime,lastQpSum:o.qpSum,lts:Date.now()}),o.codecId&&(a.codec=this.getCodecFromCodecStats(o.codecId)),o.mediaSourceId&&this.processVideoMediaSource(o.mediaSourceId,a),this.processVideoTrackSenderStats(o,o.trackId,a),o.remoteId)this.processRemoteInboundStats(o.remoteId,a);else{const h=this.findRemoteStatsId(o.ssrc,Yi.REMOTE_INBOUND);h&&this.processRemoteInboundStats(h,a)}}processAudioOutboundStats(o){let a=this._stats.audioSend.find(u=>u.ssrc===o.ssrc);if(a||(a=ra(RP),this._stats.audioSend.push(a)),a.ssrc=o.ssrc,a.packets=o.packetsSent,a.bytes=o.bytesSent,o.mediaSourceId&&this.processAudioMediaSource(o.mediaSourceId,a),o.codecId&&(a.codec=this.getCodecFromCodecStats(o.codecId)),this.processAudioTrackSenderStats(o,o.trackId,a),o.remoteId)this.processRemoteInboundStats(o.remoteId,a);else{const u=this.findRemoteStatsId(o.ssrc,Yi.REMOTE_INBOUND);u&&this.processRemoteInboundStats(u,a)}}findRemoteStatsId(o,a){var u;const h=Array.from(oc(u=this.report).call(u)).find(g=>g.type===a&&g.ssrc===o);return h?h.id:null}processVideoMediaSource(o,a){const u=this.report.get(o);u&&u.width&&u.height&&u.framesPerSecond&&(a.inputFrame={width:u.width,height:u.height,frameRate:u.framesPerSecond})}processAudioMediaSource(o,a){const u=this.report.get(o);u&&(a.inputLevel=u.audioLevel)}processVideoTrackSenderStats(o,a,u){var h,g,E;const S=a?this.report.get(a):void 0,T=(h=S==null?void 0:S.framesSent)!==null&&h!==void 0?h:o.framesSent;let C=(g=S==null?void 0:S.frameWidth)!==null&&g!==void 0?g:o.frameWidth,w=(E=S==null?void 0:S.frameHeight)!==null&&E!==void 0?E:o.frameHeight;if(typeof T!="number")return;T!==0||typeof C=="number"&&typeof w=="number"||(C=0,w=0);let N=0;const M=Date.now(),U=this.lastVideoFramesSent.get(u.ssrc);U&&M-U.lts>=800?(N=Math.round((T-U.count)/((M-U.lts)/1e3)),this.lastVideoFramesSent.set(u.ssrc,{count:T,lts:M,rate:N})):U?N=U.rate:this.lastVideoFramesSent.set(u.ssrc,{count:T,lts:M,rate:0}),u.sentFrame={width:C,height:w,frameRate:Math.max(0,N)}}processVideoTrackReceiverStats(o,a,u){var h,g,E,S,T;const C=a?this.report.get(a):void 0,w=(h=C==null?void 0:C.framesReceived)!==null&&h!==void 0?h:o.framesReceived,N=(g=C==null?void 0:C.frameWidth)!==null&&g!==void 0?g:o.frameWidth,M=(E=C==null?void 0:C.frameHeight)!==null&&E!==void 0?E:o.frameHeight,U=(S=C==null?void 0:C.jitterBufferDelay)!==null&&S!==void 0?S:o.jitterBufferDelay,Y=(T=C==null?void 0:C.jitterBufferEmittedCount)!==null&&T!==void 0?T:o.jitterBufferEmittedCount;if(typeof w=="number"){const X=this.lastVideoFramesRecv.get(u.ssrc),J=Date.now();u.framesReceivedCount=w;let fe=0;X&&J-X.lts>=800?(fe=Math.round((w-X.count)/((J-X.lts)/1e3)),this.lastVideoFramesRecv.set(u.ssrc,{count:w,lts:J,rate:fe})):X?fe=X.rate:this.lastVideoFramesRecv.set(u.ssrc,{count:w,lts:J,rate:0}),u.receivedFrame={width:N||0,height:M||0,frameRate:fe||0},u.decodedFrame={width:N||0,height:M||0,frameRate:u.decodeFrameRate||0},u.outputFrame={width:N||0,height:M||0,frameRate:u.decodeFrameRate||0}}if(U&&Y){let X=this.lastVideoJBDelay.get(u.ssrc);this.lastVideoJBDelay.set(u.ssrc,{jitterBufferDelay:U,jitterBufferEmittedCount:Y}),X||(X={jitterBufferDelay:0,jitterBufferEmittedCount:0});const J=1e3*(U-X.jitterBufferDelay)/(Y-X.jitterBufferEmittedCount);u.jitterBufferMs=J,u.currentDelayMs=Math.round(J)}}processAudioTrackSenderStats(o,a,u){var h,g,E,S;const T=a?this.report.get(a):void 0,C=(h=(g=T==null?void 0:T.echoReturnLoss)!==null&&g!==void 0?g:o.echoReturnLoss)!==null&&h!==void 0?h:0,w=(E=(S=T==null?void 0:T.echoReturnLossEnhancement)!==null&&S!==void 0?S:o.echoReturnLossEnhancement)!==null&&E!==void 0?E:0;u.aecReturnLoss=C,u.aecReturnLossEnhancement=w}processAudioTrackReceiverStats(o,a,u){var h,g,E,S,T,C,w;const N=a?this.report.get(a):void 0,M=(h=N==null?void 0:N.removedSamplesForAcceleration)!==null&&h!==void 0?h:o.removedSamplesForAcceleration,U=(g=N==null?void 0:N.totalSamplesReceived)!==null&&g!==void 0?g:o.totalSamplesReceived,Y=(E=N==null?void 0:N.jitterBufferDelay)!==null&&E!==void 0?E:o.jitterBufferDelay,X=(S=N==null?void 0:N.jitterBufferEmittedCount)!==null&&S!==void 0?S:o.jitterBufferEmittedCount,J=(T=N==null?void 0:N.audioLevel)!==null&&T!==void 0?T:o==null?void 0:o.audioLevel,fe=(C=N==null?void 0:N.totalSamplesDuration)!==null&&C!==void 0?C:o==null?void 0:o.totalSamplesDuration,ge=(w=N==null?void 0:N.concealedSamples)!==null&&w!==void 0?w:o.concealedSamples;if(M&&U&&(u.accelerateRate=M/U),Y&&X){let lt=this.lastAudioJBDelay.get(u.ssrc);this.lastAudioJBDelay.set(u.ssrc,{jitterBufferDelay:Y,jitterBufferEmittedCount:X}),lt||(lt={jitterBufferDelay:0,jitterBufferEmittedCount:0});const Ve=1e3*(Y-lt.jitterBufferDelay)/(X-lt.jitterBufferEmittedCount);u.jitterBufferMs=Math.round(Ve)}u.outputLevel=J;let Ue=1920;fe&&U&&(Ue=U/fe/50,u.receivedFrames=Math.round(U/Ue)),ge&&(u.droppedFrames=Math.round(ge/Ue))}processRemoteInboundStats(o,a){const u=this.report.get(o);u&&(a.packetsLost=u.packetsLost,u.roundTripTime&&(a.rttMs=1e3*u.roundTripTime))}getCodecFromCodecStats(o){const a=this.report.get(o);if(!a)return"";const u=a.mimeType.match(/\/(.*)$/);return u&&u[1]?u[1]:""}updateSendBitrate(){let o=0,a=null,u=null;this.mediaBytesSent.forEach(g=>{o+=g.diffMean()}),this.mediaBytesRetransmit.forEach(g=>{a=a===null?g.diffMean():a+g.diffMean()}),this.mediaBytesTargetEncode.forEach(g=>{u=u===null?g.diffMean():u+g.diffMean()});const h=a!==null?o-a:o;this._stats.bitrate={actualEncoded:8*h/(this.options.updateInterval/1e3),transmit:8*o/(this.options.updateInterval/1e3)},a!==null&&(this._stats.bitrate.retransmit=8*a/(this.options.updateInterval/1e3)),u!==null&&(this._stats.bitrate.targetEncoded=8*u/(this.options.updateInterval/1e3))}}class Hq extends cT{updateStats(){return Je.resolve()}}function uT(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const g=jq();return g?g<76?new zq(r,{updateInterval:o,lossRateInterval:a,freezeRateLimit:u,firstVideoDecodedTimeout:h}):new OP(r,{updateInterval:o,lossRateInterval:a,freezeRateLimit:u,firstVideoDecodedTimeout:h}):Wq(r)?new OP(r,{updateInterval:o,lossRateInterval:a,freezeRateLimit:u,firstVideoDecodedTimeout:h}):new Hq(r,{updateInterval:o,lossRateInterval:a,freezeRateLimit:u,firstVideoDecodedTimeout:h})}var fn;function xP(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function kP(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?xP(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):xP(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}let Mf=(Ne((fn=class tm extends hE{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(o,a){super(o,a),k(this,"store",void 0),k(this,"peerConnection",void 0),k(this,"remoteSDP",void 0),k(this,"initialOffer",void 0),k(this,"statsFilter",void 0),k(this,"useRTX",!1),k(this,"localCapabilities",void 0),k(this,"localCandidateCount",0),k(this,"allCandidatesReceived",!1),k(this,"establishPromise",void 0),k(this,"mutex",new js("P2PConnection-mutex")),this.store=a,this.peerConnection=new RTCPeerConnection(tm.resolvePCConfiguration(o),{optional:[{googDscp:!0}]}),this.statsFilter=uT(this.peerConnection,void 0,void 0,Jn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const o=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=td(o.sdp),u=rT(o.sdp,!this.useRTX,de("FILTER_VIDEO_FEC"),de("FILTER_AUDIO_FEC"),["opus"]);return this.localCapabilities=u,this.initialOffer=o,kP(kP({},a),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:u},offerSDP:o.sdp})}catch(o){throw new Q(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}}async connect(o,a,u,h,g,E){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Bq({remoteIceParameters:o,remoteDtlsParameters:a,candidates:u,remoteRTPCapabilities:h.send,remoteSetup:g,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:E});const S=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:S})}catch(S){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(S.toString()))}}send(o,a){var u=this;return na(function*(){const h=yield Ft(u.mutex.lock());try{if(!u.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const g=o.map(M=>u.peerConnection.addTrack(M._mediaStreamTrack)),E=yield Ft(u.peerConnection.createOffer()),S=hr.exports.parse(E.sdp),T=o.map(M=>{const U=M._mediaStreamTrack,Y=S.mediaDescriptions.find(X=>X.attributes.mid===U.kind);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return function(X,J,fe){const ge=X.attributes.ssrcs.filter(lt=>lt.attributes.label===J),Ue=X.attributes.ssrcGroups;if(ge.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(Ue&&ge.length>1){const lt=Ue.find(Ve=>Ve.ssrcIds.indexOf(ge[0].ssrcId)!==-1);return lt?[{ssrcId:lt.ssrcIds[0],rtx:fe?lt.ssrcIds[1]:void 0}]:[{ssrcId:ge[0].ssrcId}]}return[{ssrcId:ge[0].ssrcId}]}(Y,U.id,u.useRTX)});let C;try{C=yield T}catch(M){throw g.forEach(U=>{Vo()&&U.replaceTrack(null),u.peerConnection.removeTrack(U)}),M}const w=u.mungSendOfferSDP(E.sdp,o);u.remoteSDP.receive(o,a,C);const N=u.remoteSDP.toString();return yield Ft(u.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield Ft(u.applySendEncodings(g,o)),yield Ft(u.peerConnection.setRemoteDescription({type:"answer",sdp:N})),o.map((M,U)=>{const Y=M._mediaStreamTrack.id;return{localSSRC:T[U],id:Y}})}catch(g){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(g.toString()))}finally{h()}})()}async stopSending(o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const a=this.peerConnection.getSenders().filter(g=>{var E;return o.indexOf(((E=g.track)===null||E===void 0?void 0:E.id)||"")!==-1});if(a.length!==o.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(g=>{Vo()&&g.replaceTrack(null),this.peerConnection.removeTrack(g)});const u=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(o);const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}}async receive(o,a,u,h){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(o," before remoteSDP created."));const{id:g,mslabel:E}=this.remoteSDP.send(o,a,h),S=new Je((w,N)=>{const M=setTimeout(()=>{N(new Error("Cannot receive track, id: ".concat(g)))},1e4),U=Y=>{const X=Sn();if((X.name==="Safari"&&Number(X.version)===11||eo())&&Y.track.id!==g&&Y.streams[0].id===E){var J;const fe=Y.streams[0].getTracks()[0];return(J=this.remoteSDP)===null||J===void 0||J.updateTrackLabel(o,g,Y.track.id),this.peerConnection.removeEventListener("track",U),clearTimeout(M),void w(fe)}if(Y.track.id===g)return this.peerConnection.removeEventListener("track",U),clearTimeout(M),void w(Y.track)};this.peerConnection.addEventListener("track",U)}),T=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:T});const C=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(C),{track:await S,id:g}}catch(g){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(g.toString()))}}async stopReceiving(o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(o);const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u)}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}}async muteRemote(o){}async unmuteRemote(o){}async muteLocal(o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=this.peerConnection.getSenders().filter(u=>{var h;return o.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(a.length!==o.length)throw new Error("sender' length doesn't match mids' length.");a.map(u=>{if(Vo()&&u.track)u.track.enabled=!1;else{const h=u.getParameters();h.encodings.forEach(g=>g.active=!1),u.setParameters(h)}})}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}}async unmuteLocal(o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=this.peerConnection.getSenders().filter(g=>{var E;return o.indexOf(((E=g.track)===null||E===void 0?void 0:E.id)||"")!==-1});if(a.length!==o.length)throw new Error("Senders' length doesn't match mids' length.");a.map(async g=>{if(Vo()&&g.track)g.track.enabled=!0;else{const E=g.getParameters();E.encodings.forEach(S=>S.active=!0),await g.setParameters(E)}});const u=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(u);const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}}restartICE(){var o=this;return na(function*(){const a=yield Ft(o.mutex.lock("From P2PConnection.restartICE"));try{const u=yield Ft(o.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=td(u.sdp),{remoteIceParameters:g}=yield h.iceParameters;if(!o.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");o.remoteSDP.restartICE(g);const E=o.remoteSDP.toString();yield Ft(o.peerConnection.setLocalDescription(u)),yield Ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(u){F.warning("restart ICE failed, abort operation",u)}finally{a()}})()}close(){var o;this.peerConnection.close(),(o=this.onConnectionStateChange)===null||o===void 0||o.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(o){return this.statsFilter.getVideoIsReady(o)}async updateEncoderConfig(o,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const u=await this.peerConnection.createOffer(),h=this.mungSendOfferSDP(u.sdp,[a]);this.remoteSDP.updateRecvMedia(a._mediaStreamTrack.kind,a);const g=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(u){throw new Q(K.EXCHANGE_SDP_FAILED,u.toString())}}async updateSendParameters(o,a){const u=this.peerConnection.getSenders().filter(h=>{var g;return((g=h.track)===null||g===void 0?void 0:g.id)===o});u.length===1&&await this.applySendEncodings(u,[a])}setStatsRemoteVideoIsReady(o,a){this.statsFilter.setVideoIsReady2(o,a)}async replaceTrack(o,a){const u=this.peerConnection.getSenders().find(h=>{var g;return((g=h.track)===null||g===void 0?void 0:g.id)===a});u&&await u.replaceTrack(o._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var o;(o=this.onICEConnectionStateChange)===null||o===void 0||o.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var o;(o=this.onConnectionStateChange)===null||o===void 0||o.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=o=>{o.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,F.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,F.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},de("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(o){const a={iceServers:[],sdpSemantics:"plan-b"};return o.iceServers?a.iceServers=o.iceServers:o.turnServer&&o.turnServer.mode!=="off"&&(_f(o.turnServer.servers)?a.iceServers=o.turnServer.servers:(a.iceServers&&a.iceServers.push(...tm.turnServerConfigToIceServers(o.turnServer.servers)),de("USE_TURN_SERVER_OF_GATEWAY")&&a.iceServers&&o.turnServer.serversFromGateway&&a.iceServers.push(...tm.turnServerConfigToIceServers(o.turnServer.serversFromGateway)),o.turnServer.servers.concat(o.turnServer.serversFromGateway||[]).forEach(u=>{u.forceturn&&(a.iceTransportPolicy="relay")}))),a}static turnServerConfigToIceServers(o){const a=[];return o.forEach(u=>{u.security?u.tcpport&&a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=tcp")}):(u.udpport&&a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.udpport,"?transport=udp")}),u.tcpport&&a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=tcp")}))}),a}async applySendEncodings(o,a){try{if(!ns().supportSetRtpSenderParameters||o.length!==a.length)return;for(let h=0;h<o.length;h++){var u;const g=o[h],E=a[h];if(!E)continue;const S={},T={};if(E instanceof dr)switch(E._optimizationMode){case"motion":S.degradationPreference="maintain-framerate";break;case"detail":S.degradationPreference="maintain-resolution";break;default:S.degradationPreference="balanced"}if(de("DSCP_TYPE")&&Gl()){const N=de("DSCP_TYPE");["very-low","low","medium","high"].includes(N)&&(T.networkPriority=N)}const C=g.getParameters(),w=(u=C.encodings)===null||u===void 0?void 0:u[0];w&&Object.assign(w,T),Object.assign(C,S),await g.setParameters(C)}}catch{F.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(o,a){const u=hr.exports.parse(o);return a.forEach((h,g)=>{const E=h._mediaStreamTrack,S=u.mediaDescriptions.find(T=>T.attributes.mid===E.kind);S&&$h(S,h)}),hr.exports.print(u)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=o=>{var a;(a=this.onFirstAudioReceived)===null||a===void 0||a.call(this,o)},this.statsFilter.onFirstVideoReceived=o=>{var a;(a=this.onFirstVideoReceived)===null||a===void 0||a.call(this,o)},this.statsFilter.onFirstAudioDecoded=o=>{var a;(a=this.onFirstAudioDecoded)===null||a===void 0||a.call(this,o)},this.statsFilter.onFirstVideoDecoded=(o,a,u)=>{var h;(h=this.onFirstVideoDecoded)===null||h===void 0||h.call(this,o,a,u)},this.statsFilter.onSelectedLocalCandidateChanged=(o,a)=>{var u;(u=this.onSelectedLocalCandidateChanged)===null||u===void 0||u.call(this,o,a)},this.statsFilter.onSelectedRemoteCandidateChanged=(o,a)=>{var u;(u=this.onSelectedRemoteCandidateChanged)===null||u===void 0||u.call(this,o,a)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const a=this.remoteSDP.batchSend(o).map((g,E)=>{let{id:S,mslabel:T}=g;const{kind:C}=o[E];return new Je((w,N)=>{const M=setTimeout(()=>{N(new Error("Cannot receive track, id: ".concat(S)))},1e4),U=Y=>{const X=Sn();if(X.name==="Safari"&&Number(X.version)===11&&Y.track.id!==S&&Y.streams[0].id===T){var J;const fe=Y.streams[0].getTracks()[0];return(J=this.remoteSDP)===null||J===void 0||J.updateTrackLabel(C,S,Y.track.id),this.peerConnection.removeEventListener("track",U),clearTimeout(M),void w({track:fe,id:S})}if(Y.track.id===S)return this.peerConnection.removeEventListener("track",U),clearTimeout(M),void w({track:Y.track,id:S})};this.peerConnection.addEventListener("track",U)})}),u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),await Je.all(a)}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async getRemoteSSRC(o){if(!this.remoteSDP)return;const a=this.remoteSDP.getSSRC(o);return a==null?void 0:a[0].ssrcId}setConfiguration(o){if(ns().supportPCSetConfiguration){const a=tm.resolvePCConfiguration(o);this.peerConnection.setConfiguration(a)}}}).prototype,"connect",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"connect"),fn.prototype),Ne(fn.prototype,"stopSending",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"stopSending"),fn.prototype),Ne(fn.prototype,"receive",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"receive"),fn.prototype),Ne(fn.prototype,"stopReceiving",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"stopReceiving"),fn.prototype),Ne(fn.prototype,"muteRemote",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"muteRemote"),fn.prototype),Ne(fn.prototype,"unmuteRemote",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"unmuteRemote"),fn.prototype),Ne(fn.prototype,"muteLocal",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"muteLocal"),fn.prototype),Ne(fn.prototype,"unmuteLocal",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"unmuteLocal"),fn.prototype),Ne(fn.prototype,"close",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"close"),fn.prototype),Ne(fn.prototype,"updateEncoderConfig",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"updateEncoderConfig"),fn.prototype),Ne(fn.prototype,"updateSendParameters",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"updateSendParameters"),fn.prototype),Ne(fn.prototype,"replaceTrack",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"replaceTrack"),fn.prototype),Ne(fn.prototype,"getRemoteSSRC",[ki],Object.getOwnPropertyDescriptor(fn.prototype,"getRemoteSSRC"),fn.prototype),fn);function ki(r,o,a){const u=r[o];if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){const h=this.mutex,g=await h.lock("Locking from P2PConnection.".concat(o));try{for(var E=arguments.length,S=new Array(E),T=0;T<E;T++)S[T]=arguments[T];return await u.apply(this,S)}finally{g()}},a}const DE="9",DP=4e4;class Kq{get localCapabilities(){return lr(this._localCapabilities)}get rtpCapabilities(){return lr(this._rtpCapabilities)}get candidates(){return lr(this._candidates)}get iceParameters(){return lr(this._iceParameters)}get dtlsParameters(){return lr(this._dtlsParameters)}constructor(o){k(this,"sessionDesc",void 0),k(this,"_localCapabilities",void 0),k(this,"_rtpCapabilities",void 0),k(this,"_candidates",void 0),k(this,"_iceParameters",void 0),k(this,"_dtlsParameters",void 0),k(this,"setup",void 0),k(this,"currentMidIndex",void 0),k(this,"cname",void 0),k(this,"firefoxSsrcMidMap",new Map),o=lr(o);const{remoteIceParameters:a,remoteDtlsParameters:u,candidates:h,remoteRTPCapabilities:g,remoteSetup:E,localCapabilities:S,cname:T}=o,C=hr.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=g,this._candidates=h,this._iceParameters=a,this._dtlsParameters=u,this._localCapabilities=S,this.setup=E,this.cname=T;const w=this.rtpCapabilities.send;for(const N of C.mediaDescriptions){if(N.attributes.iceUfrag=a.iceUfrag,N.attributes.icePwd=a.icePwd,N.attributes.fingerprints=u.fingerprints,N.attributes.candidates=h,N.attributes.setup=E,N.media.mediaType==="video"&&(N.media.fmts=w.videoCodecs.map(M=>M.payloadType.toString(10)),N.attributes.payloads=w.videoCodecs,N.attributes.extmaps=w.videoExtensions,de("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:M,ssrcGroups:U}=xi([{ssrcId:DP,rtx:de("USE_RTX")?40001:void 0}],this.cname);N.attributes.ssrcs=M,N.attributes.ssrcGroups=U}if(N.media.mediaType==="audio"&&(N.media.fmts=w.audioCodecs.map(M=>M.payloadType.toString(10)),N.attributes.payloads=w.audioCodecs,N.attributes.extmaps=w.audioExtensions,Lu(N),de("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:M,ssrcGroups:U}=xi([{ssrcId:2e4}],this.cname);N.attributes.ssrcs=M,N.attributes.ssrcGroups=U}}this.sessionDesc=C,this.currentMidIndex=C.mediaDescriptions.length-1}preloadRemoteMedia(){const o=de("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const a=this.candidates,u=this.dtlsParameters,h=this.iceParameters,g=this.rtpCapabilities.send;for(let E=1;E<o;E++){const S=2*E+2e4,T=2*E+DP,{ssrcs:C,ssrcGroups:w}=xi([{ssrcId:S}],this.cname),{ssrcs:N,ssrcGroups:M}=xi([{ssrcId:T,rtx:de("USE_RTX")?T+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:DE,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.videoCodecs.map(U=>U.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:h.iceUfrag,icePwd:h.icePwd,unrecognized:[],candidates:a,extmaps:g.videoExtensions,fingerprints:u.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:N,ssrcGroups:M,rtcpFeedbackWildcards:[],payloads:g.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*E)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:DE,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.audioCodecs.map(U=>U.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:h.iceUfrag,icePwd:h.icePwd,unrecognized:[],candidates:a,extmaps:g.audioExtensions,fingerprints:u.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:C,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:g.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*E+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return hr.exports.print(this.sessionDesc)}send(o,a,u,h){const{ssrcs:g,ssrcGroups:E}=xi(a,this.cname,de("AV_SYNC")?u:void 0),S=this.findPreloadMediaDesc(g);if(S){if(Jn()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,S.attributes.mid),h&&(h.twcc||h.remb)){const T=this.sessionDesc.mediaDescriptions.indexOf(S);return this.sessionDesc.mediaDescriptions[T]=this.mungSendMediaDesc(S,h),{mid:S.attributes.mid,needExchangeSDP:!0}}return{mid:S.attributes.mid,needExchangeSDP:!1}}{const T=this.findAvailableMediaIndex(o,g);let C;return T===-1||T===1&&(Vo()||UO())||VO()?(C=this.createOrRecycleSendMedia(o,g,E,"sendonly",h),this.updateBundleMids()):(C=lr(this.sessionDesc.mediaDescriptions[T]),C.attributes.direction="sendonly",C.attributes.ssrcs=g,C.attributes.ssrcGroups=E,this.sessionDesc.mediaDescriptions[T]=this.mungSendMediaDesc(C,h)),Jn()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,C.attributes.mid),{mid:C.attributes.mid,needExchangeSDP:!0}}}batchSend(o){const a=o.map(g=>{let{kind:E,ssrcMsg:S,mslabel:T}=g;return this.send(E,S,T)}),u=[];let h=!1;return a.forEach(g=>{let{mid:E,needExchangeSDP:S}=g;S&&(h=!0),u.push(E)}),{mids:u,needExchangeSDP:h}}stopSending(o){const a=this.sessionDesc.mediaDescriptions.filter(u=>u.attributes.mid&&o.indexOf(u.attributes.mid)!==-1);if(a.length!==o.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");a.forEach(u=>{u.attributes.mid==="0"||Jn()||VO()?u.attributes.ssrcs=[]:(u.attributes.ssrcs=[],u.attributes.direction="inactive",u.media.port="0")}),this.updateBundleMids()}mute(o){const a=this.sessionDesc.mediaDescriptions.find(u=>u.attributes.mid===o);if(!a)throw new Error("mediaDescription not found with ".concat(o," in remote SDP when calling RemoteSDP.mute."));a.attributes.direction="inactive"}unmute(o){const a=this.sessionDesc.mediaDescriptions.find(u=>u.attributes.mid===o);if(!a)throw new Error("mediaDescription not found with ".concat(o," in remote SDP when calling RemoteSDP.unmute."));a.attributes.direction="sendonly"}muteRemote(o){const a=this.sessionDesc.mediaDescriptions.filter(u=>o.includes(u.attributes.mid||""));if(a.length!==o.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");a.forEach(u=>{u.attributes.direction="inactive"})}unmuteRemote(o){const a=this.sessionDesc.mediaDescriptions.filter(u=>o.includes(u.attributes.mid||""));if(a.length!==o.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");a.forEach(u=>{u.attributes.direction="recvonly"})}receive(o,a,u,h){o.forEach((g,E)=>{this.createOrRecycleRecvMedia(g,[],"recvonly",a,u,h[E])}),this.updateBundleMids()}stopReceiving(o){const a=this.sessionDesc.mediaDescriptions.filter(u=>o.indexOf(u.attributes.mid)!==-1);if(a.length!==o.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");a.forEach(u=>{u.media.port="0",u.attributes.direction="inactive"}),this.updateBundleMids()}restartICE(o){o=lr(o),this._iceParameters=o,this.sessionDesc.mediaDescriptions.forEach(a=>{a.attributes.iceUfrag=o.iceUfrag,a.attributes.icePwd=o.icePwd})}predictReceivingMids(o){const a=[];for(let u=0;u<o;u++)a.push((this.currentMidIndex+u+1).toString(10));return a}findAvailableMediaIndex(o,a){return this.sessionDesc.mediaDescriptions.findIndex(u=>{const h=u.media.mediaType===o&&u.media.port!=="0"&&(u.attributes.direction==="sendonly"||u.attributes.direction==="sendrecv")&&u.attributes.ssrcs.length===0;if(Jn()){if(h){const g=this.firefoxSsrcMidMap.get(a[0].ssrcId);return!(g||u.attributes.mid!=="0"&&u.attributes.mid!=="1")||!(!g||g!==u.attributes.mid)}return!1}return h})}createOrRecycleRecvMedia(o,a,u,h,g,E){const S=o._mediaStreamTrack.kind,T=this.rtpCapabilities.recv,C=this.localCapabilities.send;let w=[];if(S===Ot.VIDEO){var N,M;if(de("H264_PROFILE_LEVEL_ID")&&h==="h264"&&(w=T.videoCodecs.filter(fe=>{var ge,Ue;return(((ge=fe.rtpMap)===null||ge===void 0?void 0:ge.encodingName.toLowerCase())||"").includes(h)&&(fe==null||(Ue=fe.fmtp)===null||Ue===void 0?void 0:Ue.parameters["profile-level-id"])===de("H264_PROFILE_LEVEL_ID")})),!w||((N=w)===null||N===void 0?void 0:N.length)===0){const fe=C.videoCodecs.filter(ge=>{var Ue;return(((Ue=ge.rtpMap)===null||Ue===void 0?void 0:Ue.encodingName.toLowerCase())||"").includes(h)});fe.length!==0&&(w=T.videoCodecs.filter(ge=>fe.some(Ue=>Ue.payloadType===ge.payloadType)))}if(de("USE_RTX")){const fe=w.map(Ue=>Ue.payloadType.toString()),ge=T.videoCodecs.filter(Ue=>{var lt,Ve;return((lt=Ue.rtpMap)===null||lt===void 0?void 0:lt.encodingName)==="rtx"&&fe.includes(((Ve=Ue.fmtp)===null||Ve===void 0?void 0:Ve.parameters.apt)||"")});w=[...w,...ge]}w.length===0&&(F.warning("codec ".concat(h," not included in rtpCapabilities, fallback to default payloads: ").concat((M=T.videoCodecs[0].rtpMap)===null||M===void 0?void 0:M.encodingName)),w=T.videoCodecs)}else w=T.audioCodecs.filter(fe=>{var ge;return(((ge=fe.rtpMap)===null||ge===void 0?void 0:ge.encodingName.toLowerCase())||"").includes(g)}),w.length===0&&(F.warning("codec ".concat(g," not included in rtpCapabilities, fallback to opus")),w=T.audioCodecs.filter(fe=>{var ge;return(((ge=fe.rtpMap)===null||ge===void 0?void 0:ge.encodingName.toLowerCase())||"").includes("opus")}));const U=S===Ot.VIDEO?T.videoExtensions:T.audioExtensions;this.currentMidIndex+=1;const Y="".concat(this.currentMidIndex);let X={media:{mediaType:S,port:DE,protos:["UDP","TLS","RTP","SAVPF"],fmts:w.map(fe=>fe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:U,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:a,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:w,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:u,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};X=this.mungRecvMediaDsec(X,o,E);const J=this.findFirstClosedMedia(S);if(J){const fe=this.sessionDesc.mediaDescriptions.indexOf(J);this.sessionDesc.mediaDescriptions[fe]=X}else this.sessionDesc.mediaDescriptions.push(X);return X}createOrRecycleSendMedia(o,a,u,h,g){const E=this.rtpCapabilities.send,S=o===Ot.VIDEO?E.videoCodecs:E.audioCodecs,T=o===Ot.VIDEO?E.videoExtensions:E.audioExtensions;this.currentMidIndex+=1;const C="".concat(this.currentMidIndex);let w={media:{mediaType:o,port:DE,protos:["UDP","TLS","RTP","SAVPF"],fmts:S.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:T,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:a,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:S,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:h,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(C)}};w=this.mungSendMediaDesc(w,g);const N=this.findFirstClosedMedia(o);if(N){const M=this.sessionDesc.mediaDescriptions.indexOf(N);this.sessionDesc.mediaDescriptions[M]=w}else this.sessionDesc.mediaDescriptions.push(w);return w}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(o=>o.media.port!=="0").map(o=>o.attributes.mid)}mungRecvMediaDsec(o,a,u){const h=lr(o);return sT(h),$h(h,a),oT(h,a),yP(h),xE(h,u,this.localCapabilities.send),h}mungSendMediaDesc(o,a){const u=lr(o);return xE(u,a,this.localCapabilities.recv),Lu(u),u}updateRecvMedia(o,a){const u=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===o);if(u!==-1){const h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u],a);this.sessionDesc.mediaDescriptions[u]=h}}bumpMid(o){this.currentMidIndex+=o}findFirstClosedMedia(o){return this.sessionDesc.mediaDescriptions.find(a=>Jn()?a.media.port==="0"&&a.media.mediaType===o:a.media.port==="0")}findPreloadMediaDesc(o){return this.sessionDesc.mediaDescriptions.find(a=>{var u,h;return((u=a.attributes)===null||u===void 0||(h=u.ssrcs[0])===null||h===void 0?void 0:h.ssrcId)===o[0].ssrcId})}getSSRC(o){var a;return(a=this.sessionDesc.mediaDescriptions.find(u=>u.attributes.mid===o))===null||a===void 0?void 0:a.attributes.ssrcs}}var mn;function PP(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function LP(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?PP(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):PP(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}let $f=(Ne((mn=class nm extends hE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(o,a){super(o,a),k(this,"store",void 0),k(this,"peerConnection",void 0),k(this,"remoteSDP",void 0),k(this,"initialOffer",void 0),k(this,"transportEventReceiver",void 0),k(this,"statsFilter",void 0),k(this,"useRTX",de("USE_RTX")),k(this,"localCapabilities",void 0),k(this,"localCandidateCount",0),k(this,"allCandidatesReceived",!1),k(this,"establishPromise",void 0),k(this,"mutex",new js("P2PConnection-mutex")),this.store=a,this.peerConnection=new RTCPeerConnection(nm.resolvePCConfiguration(o),{optional:[{googDscp:!0}]}),this.statsFilter=uT(this.peerConnection,void 0,void 0,Jn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const a=td(o.sdp),u=await SP(!this.useRTX,de("FILTER_VIDEO_FEC"),de("FILTER_AUDIO_FEC"));return this.localCapabilities=iT(u),this.initialOffer=o,LP(LP({},a),{},{rtpCapabilities:u,offerSDP:o.sdp})}catch(o){throw new Q(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}}async connect(o,a,u,h,g,E){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Kq({remoteIceParameters:o,remoteDtlsParameters:a,candidates:u,remoteRTPCapabilities:h,remoteSetup:g,localCapabilities:this.localCapabilities,cname:E});const S=this.remoteSDP.toString(),T=hr.exports.parse(this.initialOffer.sdp),C=T.mediaDescriptions.find(U=>U.media.mediaType==="audio");C&&Lu(C);const w=hr.exports.print(T),N=this.logSDPExchange(w||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:w}),N==null||N(S),await this.peerConnection.setRemoteDescription({type:"answer",sdp:S});const M=this.peerConnection.getTransceivers()[0];if(M!=null&&M.receiver&&this.tryBindTransportEvents(M.receiver),de("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const U=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:U});const Y=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(Y)}}catch(S){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(S.toString()))}}send(o,a,u){var h=this;return na(function*(){const g=yield Ft(h.mutex.lock("From P2PConnection.send"));try{if(!h.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const E=[];o.forEach(X=>{const J=h.peerConnection.addTransceiver(X._mediaStreamTrack,{direction:"sendonly"});E.push(J)}),Jn()&&de("SIMULCAST")===!0&&(yield Ft(h.applySimulcastForFirefox(E,o)));const S=yield Ft(h.peerConnection.createOffer()),T=h.remoteSDP.predictReceivingMids(o.length),C=h.mungSendOfferSDP(S.sdp,o,T),w=hr.exports.parse(C),N=T.map(X=>{const J=w.mediaDescriptions.find(fe=>fe.attributes.mid===X);if(!J)throw new Error("Cannot extract ssrc from mediaDescription.");return EP(J,h.useRTX)});let M;try{M=yield N}catch(X){M=[],h.remoteSDP.receive(o,a,u,M);const J=h.remoteSDP.toString();throw yield Ft(h.peerConnection.setLocalDescription({type:"offer",sdp:C})),yield Ft(h.peerConnection.setRemoteDescription({type:"answer",sdp:J})),yield Ft(h.stopSending(T,!0)),X}h.remoteSDP.receive(o,a,u,M);const U=h.remoteSDP.toString(),Y=h.logSDPExchange(C,"offer","local","send");return yield Ft(h.peerConnection.setLocalDescription({type:"offer",sdp:C})),yield Ft(h.applySimulcastEncodings(E,o)),yield Ft(h.applySendEncodings(E,o)),Y==null||Y(U),yield Ft(h.peerConnection.setRemoteDescription({type:"answer",sdp:U})),E.map((X,J)=>{const fe=T[J];return{localSSRC:N[J],id:fe,transceiver:X}})}catch(E){throw E instanceof Q?E:new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(E.toString()))}finally{g()}})()}async stopSending(o,a){const u=a?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const h=this.peerConnection.getTransceivers().filter(T=>o.indexOf(T.mid)!==-1);if(h.length!==o.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");h.map(T=>{var C;T.direction="inactive",(C=T.stop)===null||C===void 0||C.call(T)});const g=await this.peerConnection.createOffer(),E=this.logSDPExchange(g.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(g),this.remoteSDP.stopReceiving(o);const S=this.remoteSDP.toString();E==null||E(S),await this.peerConnection.setRemoteDescription({type:"answer",sdp:S})}catch(h){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(h.toString()))}finally{u&&u()}}async receive(o,a,u,h){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(o," before remoteSDP created."));const{mid:g,needExchangeSDP:E}=this.remoteSDP.send(o,a,u,h);if(E){const T=this.remoteSDP.toString(),C=this.logSDPExchange(T,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:T});const w=await this.peerConnection.createAnswer(),N=this.mungReceiveAnswerSDP(w.sdp,g,o);C==null||C(N||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:N}),F.debug("[P2PConnection] receive ".concat(o," by exchanging SDP."))}else F.debug("[P2PConnection] receive ".concat(o," no need to exchange SDP."));const S=this.peerConnection.getTransceivers().find(T=>T.mid===g);if(!S)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:S.receiver.track,id:g}}catch(g){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(g.toString()))}}async batchReceive(o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:u}=this.remoteSDP.batchSend(o);if(u){const h=this.remoteSDP.toString(),g=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const E=await this.peerConnection.createAnswer();g==null||g(E.sdp||""),await this.peerConnection.setLocalDescription(E),F.debug("[P2PConnection] batchReceive by exchanging SDP.")}else F.debug("[P2PConnection] batchReceive no need to exchange SDP.");return a.map(h=>{const g=this.peerConnection.getTransceivers().find(E=>E.mid===h);if(!g)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:g.receiver.track,id:h}})}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(o);const a=this.remoteSDP.toString(),u=this.logSDPExchange(a,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const h=await this.peerConnection.createAnswer();u==null||u(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(a.toString()))}}async muteRemote(o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(o," before remote SDP created."));this.remoteSDP.mute(o);const a=this.remoteSDP.toString(),u=this.logSDPExchange(a,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const h=await this.peerConnection.createAnswer();u==null||u(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(a.toString()))}}async unmuteRemote(o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(o," before remote SDP created."));this.remoteSDP.unmute(o);const a=this.remoteSDP.toString(),u=this.logSDPExchange(a,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const h=await this.peerConnection.createAnswer();u==null||u(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(a.toString()))}}async muteLocal(o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const a=this.peerConnection.getTransceivers().filter(E=>E.mid&&o.indexOf(E.mid)!==-1);if(a.length!==o.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(E=>{E.direction="inactive"});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(u),this.remoteSDP.muteRemote(o);const g=this.remoteSDP.toString();h==null||h(g),await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(a.toString()))}}async unmuteLocal(o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const a=this.peerConnection.getTransceivers().filter(E=>E.mid&&o.indexOf(E.mid)!==-1);if(a.length!==o.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(async(E,S)=>{E.direction="sendonly"});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(u),this.remoteSDP.unmuteRemote(o);const g=this.remoteSDP.toString();h==null||h(g),await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(a.toString()))}}restartICE(){var o=this;return na(function*(){const a=yield Ft(o.mutex.lock("From P2PConnection.restartICE"));try{const u=yield Ft(o.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=td(u.sdp),{remoteIceParameters:g}=yield h.iceParameters;if(!o.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");o.remoteSDP.restartICE(g);const E=o.remoteSDP.toString(),S=o.logSDPExchange(u.sdp||"","offer","local","restartICE");yield Ft(o.peerConnection.setLocalDescription(u)),S==null||S(E),yield Ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(u){F.warning("restart ICE failed, abort operation",u)}finally{a()}})()}close(){var o;this.peerConnection.close(),(o=this.onConnectionStateChange)===null||o===void 0||o.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(o){return this.statsFilter.getVideoIsReady(o)}async updateEncoderConfig(o,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const u=await this.peerConnection.createOffer(),h=this.mungSendOfferSDP(u.sdp,[a],[o]);this.remoteSDP.updateRecvMedia(o,a);const g=this.remoteSDP.toString(),E=this.logSDPExchange(h,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),E==null||E(g),await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(u){throw new Q(K.EXCHANGE_SDP_FAILED,u.toString())}}async updateSendParameters(o,a){const u=this.peerConnection.getTransceivers().filter(h=>h.mid===o);u.length===1&&(this.isVP8Simulcast(a)?Jn()||await this.applySimulcastEncodings(u,[a]):await this.applySendEncodings(u,[a]))}setStatsRemoteVideoIsReady(o,a){this.statsFilter.setVideoIsReady2(o,a)}async replaceTrack(o,a){const u=this.peerConnection.getTransceivers().find(h=>h.mid===a);u&&await u.sender.replaceTrack(o._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var o;(o=this.onICEConnectionStateChange)===null||o===void 0||o.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var o;(o=this.onConnectionStateChange)===null||o===void 0||o.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=o=>{o.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,F.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,F.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},de("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(o){const a={iceServers:[]};return o.iceServers?a.iceServers=o.iceServers:o.turnServer&&o.turnServer.mode!=="off"&&(_f(o.turnServer.servers)?a.iceServers=o.turnServer.servers:(a.iceServers&&a.iceServers.push(...nm.turnServerConfigToIceServers(o.turnServer.servers)),de("USE_TURN_SERVER_OF_GATEWAY")&&a.iceServers&&o.turnServer.serversFromGateway&&a.iceServers.push(...nm.turnServerConfigToIceServers(o.turnServer.serversFromGateway)),de("FORCE_TURN_TCP")?a.iceTransportPolicy="relay":o.turnServer.servers.concat(o.turnServer.serversFromGateway||[]).forEach(u=>{u.forceturn&&(a.iceTransportPolicy="relay")}))),a}static turnServerConfigToIceServers(o){const a=[];return o.forEach(u=>{u.security?u.tcpport&&a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(yE(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}):(u.udpport&&!de("FORCE_TURN_TCP")&&a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.udpport,"?transport=udp")}),u.tcpport&&a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=tcp")}))}),a}tryBindTransportEvents(o){o.transport&&(this.transportEventReceiver=o,o.transport.onstatechange=()=>{var a,u;(a=o.transport)!==null&&a!==void 0&&a.state&&((u=this.onDTLSTransportStateChange)===null||u===void 0||u.call(this,o.transport.state))},o.transport.onerror=a=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,a.error)},o.transport.iceTransport&&(o.transport.iceTransport.onstatechange=()=>{var a,u,h;(a=o.transport)!==null&&a!==void 0&&a.iceTransport.state&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,(h=o.transport)===null||h===void 0?void 0:h.iceTransport.state))}))}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(o,a){try{if(!ns().supportSetRtpSenderParameters||o.length!==a.length)return;for(let C=0;C<o.length;C++){const w=o[C],N=a[C];if(N&&N instanceof dr){var u,h;if(this.isVP8Simulcast(N))continue;const M={},U={};switch(N._optimizationMode){case"motion":M.degradationPreference="maintain-framerate";break;case"detail":M.degradationPreference="maintain-resolution";break;default:M.degradationPreference="balanced"}var g,E,S,T;if((u=N._encoderConfig)!==null&&u!==void 0&&u.bitrateMax&&(U.maxBitrate=1e3*((g=N._encoderConfig)===null||g===void 0?void 0:g.bitrateMax)),N._hints.includes(ts.LOW_STREAM)&&((E=N._encoderConfig)!==null&&E!==void 0&&E.frameRate&&(U.maxFramerate=Mc(N._encoderConfig.frameRate)),(S=N._encoderConfig)!==null&&S!==void 0&&S.scaleResolutionDownBy&&((T=N._encoderConfig)===null||T===void 0?void 0:T.scaleResolutionDownBy)>1&&(U.scaleResolutionDownBy=N._encoderConfig.scaleResolutionDownBy)),de("DSCP_TYPE")&&Gl()){const J=de("DSCP_TYPE");["very-low","low","medium","high"].includes(J)&&(U.networkPriority=J)}const Y=w.sender.getParameters(),X=(h=Y.encodings)===null||h===void 0?void 0:h[0];Jn()&&!X&&(M.encodings=[U]),X&&Object.assign(X,U),Object.assign(Y,M),await w.sender.setParameters(Y)}}}catch{F.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(o,a,u){const h=hr.exports.parse(o);return a.forEach((g,E)=>{const S=u[E],T=h.mediaDescriptions.find(C=>C.attributes.mid===S);T&&($h(T,g),vP(T,g,this.store.codec))}),hr.exports.print(h)}mungReceiveAnswerSDP(o,a,u){const h=hr.exports.parse(o),g=h.mediaDescriptions.find(E=>E.attributes.mid===a);return g&&u===Ot.AUDIO&&g.media.mediaType==="audio"&&Lu(g),hr.exports.print(h)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=o=>{var a;(a=this.onFirstAudioReceived)===null||a===void 0||a.call(this,o)},this.statsFilter.onFirstVideoReceived=o=>{var a;(a=this.onFirstVideoReceived)===null||a===void 0||a.call(this,o)},this.statsFilter.onFirstAudioDecoded=o=>{var a;(a=this.onFirstAudioDecoded)===null||a===void 0||a.call(this,o)},this.statsFilter.onFirstVideoDecoded=(o,a,u)=>{var h;(h=this.onFirstVideoDecoded)===null||h===void 0||h.call(this,o,a,u)},this.statsFilter.onSelectedLocalCandidateChanged=(o,a)=>{var u;(u=this.onSelectedLocalCandidateChanged)===null||u===void 0||u.call(this,o,a)},this.statsFilter.onSelectedRemoteCandidateChanged=(o,a)=>{var u;(u=this.onSelectedRemoteCandidateChanged)===null||u===void 0||u.call(this,o,a)},this.statsFilter.onFirstVideoDecodedTimeout=o=>{var a;(a=this.onFirstVideoDecodedTimeout)===null||a===void 0||a.call(this,o)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(o,a){if(o.length===a.length)for(let S=0;S<o.length;S++){var u,h,g,E;const T=o[S],C=a[S];if(C instanceof dr&&!C._hints.includes(ts.LOW_STREAM)&&(u=C._encoderConfig)!==null&&u!==void 0&&u.bitrateMax&&((h=C._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)>200&&(g=C._scalabiltyMode)!==null&&g!==void 0&&g.numSpatialLayers&&((E=C._scalabiltyMode)===null||E===void 0?void 0:E.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},N={high:1e3*(C._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:N.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:N.high}];const M=T.sender.getParameters();await T.sender.setParameters(Object.assign(M,w))}}}async applySimulcastEncodings(o,a){if(!Jn()&&o.length===a.length)for(let u=0;u<o.length;u++){const h=a[u];if(h instanceof dr&&this.isVP8Simulcast(h)){const g=o[u],E={},S={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:S.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:S.medium,scaleResolutionDownBy:4}];const T=g.sender.getParameters();await g.sender.setParameters(Object.assign(T,E))}}}isVP8Simulcast(o){var a,u,h,g;return!!(o instanceof dr&&de("SIMULCAST")&&this.store.codec==="vp8"&&!o._hints.includes(ts.LOW_STREAM)&&(a=o._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((u=o._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=o._scalabiltyMode)!==null&&h!==void 0&&h.numSpatialLayers&&((g=o._scalabiltyMode)===null||g===void 0?void 0:g.numSpatialLayers)>1)}logSDPExchange(o,a,u,h){if(de("SDP_LOGGING"))return F.upload("exchanging ".concat(u," ").concat(a," SDP during P2PConnection.").concat(h,`
`),o),a==="offer"?g=>{this.logSDPExchange(g,"answer",u==="local"?"remote":"local",h)}:void 0}async getRemoteSSRC(o){if(!this.remoteSDP)return;const a=this.remoteSDP.getSSRC(o);return a==null?void 0:a[0].ssrcId}setConfiguration(o){if(ns().supportPCSetConfiguration){const a=nm.resolvePCConfiguration(o);this.peerConnection.setConfiguration(a)}}}).prototype,"connect",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"connect"),mn.prototype),Ne(mn.prototype,"receive",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"receive"),mn.prototype),Ne(mn.prototype,"batchReceive",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"batchReceive"),mn.prototype),Ne(mn.prototype,"stopReceiving",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"stopReceiving"),mn.prototype),Ne(mn.prototype,"muteRemote",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"muteRemote"),mn.prototype),Ne(mn.prototype,"unmuteRemote",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"unmuteRemote"),mn.prototype),Ne(mn.prototype,"muteLocal",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"muteLocal"),mn.prototype),Ne(mn.prototype,"unmuteLocal",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"unmuteLocal"),mn.prototype),Ne(mn.prototype,"close",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"close"),mn.prototype),Ne(mn.prototype,"updateEncoderConfig",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"updateEncoderConfig"),mn.prototype),Ne(mn.prototype,"updateSendParameters",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"updateSendParameters"),mn.prototype),Ne(mn.prototype,"replaceTrack",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"replaceTrack"),mn.prototype),Ne(mn.prototype,"getRemoteSSRC",[Di],Object.getOwnPropertyDescriptor(mn.prototype,"getRemoteSSRC"),mn.prototype),mn);function Di(r,o,a){const u=r[o];if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){const h=this.mutex,g=await h.lock("From P2PConnection.".concat(o));try{for(var E=arguments.length,S=new Array(E),T=0;T<E;T++)S[T]=arguments[T];return await u.apply(this,S)}finally{g()}},a}function MP(r,o){let a=document.createElement("video"),u=document.createElement("canvas");a.setAttribute("style","display:none"),u.setAttribute("style","display:none"),a.setAttribute("muted",""),a.muted=!0,a.setAttribute("autoplay",""),a.autoplay=!0,a.setAttribute("playsinline",""),u.width=Mc(o.width),u.height=Mc(o.height);const h=Mc(o.framerate||15);document.body.append(a),document.body.append(u);let g=r._mediaStreamTrack;a.srcObject=new MediaStream([g]),a.play();const E=u.getContext("2d");if(!E)throw new Q(K.UNEXPECTED_ERROR,"can not get canvas context");const S=ns(),T=u.captureStream(S.supportRequestFrame?0:h).getVideoTracks()[0],C=mk(()=>(()=>{if(a.paused&&a.play(),a.videoHeight>2&&a.videoWidth>2){const N=a.videoWidth,M=a.videoHeight/N,U=u.width*M;Math.abs(U-u.height)>=2&&(F.debug("adjust low stream resolution","".concat(u.width,"x").concat(u.height," -> ").concat(u.width,"x").concat(U)),u.height=U)}E.drawImage(a,0,0,u.width,u.height),T.requestFrame&&T.requestFrame(),g!==r._mediaStreamTrack&&(g=r._mediaStreamTrack,a.srcObject=new MediaStream([g]))})(),h),w=T.stop;return T.stop=()=>{w.call(T),C(),a&&(a.remove(),a=null),u&&(u.width=0,u.remove(),u=null),F.debug("clean low stream renderer")},T}var $P,FP,UP,VP,Pi,BP,jP,WP,GP,zP,HP,As;function KP(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function PE(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?KP(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):KP(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}class qP extends hk{getUserId(){return this._userId}constructor(o,a,u,h){super(o,"track-".concat(o.kind,"-").concat(a,"-").concat(h.clientId,"_").concat(Kn(5,""))),k(this,"_userId",void 0),k(this,"_uintId",void 0),k(this,"_isDestroyed",!1),k(this,"store",void 0),k(this,"processor",void 0),k(this,"processorContext",void 0),this._userId=a,this._uintId=u,this.store=h}_updateOriginMediaStreamTrack(o){this._originMediaStreamTrack=o,this._mediaStreamTrack=o,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,F.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let LE=($P=pt({argsMap:(r,o,a)=>[r.getTrackId(),typeof o=="string"?o:"HTMLElement",a]}),FP=pt({argsMap:r=>[r.getTrackId()]}),UP=pt({argsMap:(r,o)=>[r.getTrackId(),o.name]}),VP=pt({argsMap:r=>[r.getTrackId()]}),Ne((Pi=class extends qP{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==as.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(r,o,a,u){super(r,o,a,u),k(this,"_videoVisibleTimer",null),k(this,"_previousVideoVisibleStatus",void 0),k(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),k(this,"trackMediaType","video"),k(this,"_videoWidth",void 0),k(this,"_videoHeight",void 0),k(this,"_player",void 0),k(this,"processorDestination",void 0),k(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new i3(this.getTrackId(),"remote"),this.processorDestination=new o3(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Sf(()=>{F.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ic(this,yt.GET_STATS)||PE({},zx)}play(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const u=document.getElementById(r);u?r=u:(F.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}F.debug("[".concat(this.getTrackId(),"] start video playback"),JSON.stringify(o));const a=PE(PE({fit:"cover"},o),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(a):(this._player=new nD(a),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.emit(Rh.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const u=this.getVideoElementVisibleStatus();this.emit(Rh.VIDEO_ELEMENT_VISIBLE_STATUS,u)}catch{}},de("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,F.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){y3(this._originMediaStreamTrack).then(r=>{let[o,a]=r;this._videoHeight=a,this._videoWidth=o}).catch(SE)}_updatePlayerSource(){F.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var r,o;const a=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),u={track:this,element:this==null||(o=this._player)===null||o===void 0?void 0:o.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:h,slot:g}=u;if(this.isPlaying&&h instanceof HTMLVideoElement&&g instanceof HTMLElement){const E=PD.checkOneElementVisible(h),S=Object.assign({},E);if(S.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=S.visible;const T=at.reportApiInvoke(null,{tag:jn.TRACER,name:vr.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});S.visible?T.onSuccess("Video is visible"):T.onSuccess("Invisible because of ".concat(S.reason))}return S}return}catch(a){throw new Q(K.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}pipe(r){if(this.processor===r)return r;if(r._source)throw new Q(K.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(_s.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_s.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[$P],Object.getOwnPropertyDescriptor(Pi.prototype,"play"),Pi.prototype),Ne(Pi.prototype,"stop",[FP],Object.getOwnPropertyDescriptor(Pi.prototype,"stop"),Pi.prototype),Ne(Pi.prototype,"pipe",[UP],Object.getOwnPropertyDescriptor(Pi.prototype,"pipe"),Pi.prototype),Ne(Pi.prototype,"unpipe",[VP],Object.getOwnPropertyDescriptor(Pi.prototype,"unpipe"),Pi.prototype),Pi),ME=(BP=pt({argsMap:(r,o)=>[r.getTrackId(),o],throttleTime:300}),jP=pt({argsMap:(r,o)=>[r.getTrackId(),o]}),WP=pt({argsMap:r=>[r.getTrackId()]}),GP=pt({argsMap:r=>[r.getTrackId()]}),zP=pt({argsMap:(r,o)=>[r.getTrackId(),o.name]}),HP=pt({argsMap:r=>[r.getTrackId()]}),Ne((As=class extends qP{get isPlaying(){return this._useAudioElement?Bo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(r,o,a,u){super(r,o,a,u),k(this,"trackMediaType","audio"),k(this,"_source",void 0),k(this,"_useAudioElement",!0),k(this,"_volume",100),k(this,"processorContext",void 0),k(this,"processorDestination",void 0),k(this,"_played",!1),k(this,"_bypassWebAudio",!1),de("DISABLE_WEBAUDIO")?(this._source=new u3,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new _k(r,!0),de("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(So.RECEIVE_TRACK_BUFFER,()=>{this.emit(Rh.FIRST_FRAME_DECODED)}),this.processorContext=new c3(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new a3(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(So.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!r)return this._source.removeAllListeners(So.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(o),this._source.removeAllListeners(So.ON_AUDIO_BUFFER),this._source.on(So.ON_AUDIO_BUFFER,a=>r(a))}setVolume(r){this._volume=r,this._useAudioElement?Bo.setVolume(this.getTrackId(),r):this._source.setVolume(r/100)}async setPlaybackDevice(r){if(!this._useAudioElement)throw new Q(K.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Bo.setSinkID(this.getTrackId(),r)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Sf(()=>{F.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ic(this,yt.GET_STATS)||PE({},Gx)}play(){F.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(F.debug("[".concat(this.getTrackId(),"] use audio element to play")),Bo.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){F.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Bo.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let r=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];F.debug("[".concat(this.getTrackId(),"] update player source track")),r&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Bo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(r){if(this._bypassWebAudio)throw new Q(K.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===r)return r;if(r._source)throw new Q(K.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),r}unpipe(){var r;if(this._bypassWebAudio)throw new Q(K.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const o=this.processor;(r=this._source.processSourceNode)===null||r===void 0||r.disconnect(),this.processor._source=!1,this.processor=void 0,o.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(_s.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(_s.ON_NODE,r=>{this._source.processedNode=r;const o=!r;this._useAudioElement!==o&&(this._played?(this.stop(),this._useAudioElement=o,this.play()):this._useAudioElement=o)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(_s.ON_TRACK),this.processorDestination.removeAllListeners(_s.ON_NODE)}}).prototype,"setVolume",[BP],Object.getOwnPropertyDescriptor(As.prototype,"setVolume"),As.prototype),Ne(As.prototype,"setPlaybackDevice",[jP],Object.getOwnPropertyDescriptor(As.prototype,"setPlaybackDevice"),As.prototype),Ne(As.prototype,"play",[WP],Object.getOwnPropertyDescriptor(As.prototype,"play"),As.prototype),Ne(As.prototype,"stop",[GP],Object.getOwnPropertyDescriptor(As.prototype,"stop"),As.prototype),Ne(As.prototype,"pipe",[zP],Object.getOwnPropertyDescriptor(As.prototype,"pipe"),As.prototype),Ne(As.prototype,"unpipe",[HP],Object.getOwnPropertyDescriptor(As.prototype,"unpipe"),As.prototype),As);function XP(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function YP(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?XP(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):XP(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}class qq extends Qn{constructor(){super(),k(this,"uplinkStatsUploadInterval",void 0),k(this,"uplinkStatsUploadSlowInterval",void 0),k(this,"uplinkRelatedStatsUploadInterval",void 0),k(this,"uplinkDenoiserStatsUploadInterval",void 0),k(this,"transportStatsUploadInterval",void 0),k(this,"uplinkExtensionStatsUploadInterval",void 0),k(this,"downlinkExtensionStatsUploadInterval",void 0),k(this,"extensionUsageStatsUploadInterval",void 0),k(this,"downlinkStatsUploadInterval",void 0),k(this,"downlinkStatsUploadSlowInterval",void 0),k(this,"downlinkRelatedStatsUploadInterval",void 0),k(this,"lastStats",void 0),k(this,"uploadUnplinkStarted",!1),k(this,"uploadDownlinkStarted",!1),k(this,"uploadTransportStarted",!1),k(this,"uploadExtensionUsageStarted",!1),k(this,"requestStats",void 0),k(this,"requestLocalMedia",void 0),k(this,"requestRemoteMedia",void 0),k(this,"requestAllTracks",void 0),k(this,"requestVideoIsReady",void 0),k(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var o;const a=(o=this.requestStats)===null||o===void 0?void 0:o.call(this);a&&this.uploadTransportStats(a)},6e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const o=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var a,u,h;const g=Date.now(),E={connectionInterval:de("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:g};let S=[];const T=((a=this.requestAllTracks)===null||a===void 0?void 0:a.call(this))||[];for(const M of T)!M.muted&&M.enabled&&(S=S.concat(await M.getProcessorUsage()));const C=((u=this.requestRemoteMedia)===null||u===void 0?void 0:u.call(this))||[];for(const[M,U]of C)U.has(Ot.VIDEO)&&M.videoTrack&&(S=S.concat(await M.videoTrack.getProcessorUsage())),U.has(Ot.AUDIO)&&M.audioTrack&&(S=S.concat(await M.audioTrack.getProcessorUsage()));if(S.length===0)return;E.details=function(M,U){const Y={};for(const{id:ge,value:Ue,level:lt,direction:Ve}of M){var X;const Ge=(X=U.get(ge))!==null&&X!==void 0?X:0,Le=Ue===2?Ge+de("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:Ge;var J,fe;U.set(ge,Le),Y[ge]?(Ue===2&&(Y[ge].value=Ue),lt>Y[ge].level&&(Y[ge].level=lt),Ve==="remote"&&(Y[ge].remoteUidCount+=1),Y[ge].totalTs=(J=U.get(ge))!==null&&J!==void 0?J:0):Y[ge]={value:Ue,level:lt,remoteUidCount:Ve==="local"?0:1,totalTs:(fe=U.get(ge))!==null&&fe!==void 0?fe:0}}return Object.keys(Y).map(ge=>{const{level:Ue,value:lt,totalTs:Ve}=Y[ge];return{id:ge,level:Ue,value:lt,totalTs:Ve}})}(S,o);const w=Date.now(),N=w>g?w:g+1;(h=this.requestUpload)===null||h===void 0||h.call(this,vo.EXTENSION_USAGE_STATS,{usageStats:E,sendTs:N})},de("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var o;const a=(o=this.requestStats)===null||o===void 0?void 0:o.call(this);a&&(this.uploadUplinkStats(a),this.lastStats=a)},3e3),this.uplinkStatsUploadSlowInterval&&window.clearInterval(this.uplinkStatsUploadSlowInterval),this.uplinkStatsUploadSlowInterval=window.setInterval(()=>{var o;const a=(o=this.requestStats)===null||o===void 0?void 0:o.call(this);a&&this.uploadSlowUplinkStats(a)},6e4),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var o;const a=(o=this.requestStats)===null||o===void 0?void 0:o.call(this);a&&this.uploadRelatedUplinkStats(a,this.lastStats),this.lastStats=a},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var o;const a=(o=this.requestAllTracks)===null||o===void 0?void 0:o.call(this);a&&this.uploadDenoiserStats(a)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var o;const a=(o=this.requestAllTracks)===null||o===void 0?void 0:o.call(this);a&&this.uploadExtensionStats(a)},2e3))}uploadTransportStats(o){ta(()=>{var a;(a=this.requestUpload)===null||a===void 0||a.call(this,vo.TRANSPORT_STATS,function(u){const h={connectionType:100};if(u.selectedCandidatePair.localCandidate.candidateType==="relay"){const g=u.selectedCandidatePair.localCandidate.relayProtocol;g==="udp"&&(h.connectionType=101),g==="tcp"&&(h.connectionType=103),g==="tls"&&(h.connectionType=104)}return h}(o))})}uploadUplinkStats(o){var a;(((a=this.requestLocalMedia)===null||a===void 0?void 0:a.call(this))||[]).forEach(u=>{let[h,{track:g,ssrcs:E}]=u;switch(h){case Qe.LocalVideoLowTrack:case Qe.LocalVideoTrack:{const S=function(w,N,M){var U;const Y=N.videoSend.find(J=>J.ssrc===w);if(!Y)return null;const X={id:Kn(10,""),timestamp:new Date(N.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:Y.ssrc.toString()};switch(X.A_vstd=M._originMediaStreamTrack&&!M._originMediaStreamTrack.enabled||M._mediaStreamTrack&&!M._mediaStreamTrack.enabled?"1":"0",Y.sentFrame&&(X.A_fhs=Y.sentFrame.height.toString(),X.A_frs=Y.sentFrame.frameRate.toString(),X.A_fws=Y.sentFrame.width.toString()),Y.adaptionChangeReason){case"none":X.A_ac="0";break;case"cpu":X.A_ac="1";break;case"bandwidth":X.A_ac="2";break;case"other":X.A_ac="3"}return X.A_lvps=rS[M._player?M._player.videoElementStatus:"uninit"].toString(),X.A_nr=(U=Y.nacksCount)===null||U===void 0?void 0:U.toString(),Y.avgEncodeMs&&(X.A_aem=Y.avgEncodeMs.toFixed(0).toString()),X}(E[0].ssrcId,o,g),T=h===Qe.LocalVideoTrack?g3(E[0].ssrcId,o,g):null;S&&ta(()=>{var w;return(w=this.requestUpload)===null||w===void 0?void 0:w.call(this,vo.PUBLISH_STATS,{stream_type:h===Qe.LocalVideoLowTrack?"low":"high",stats:YP(YP({},S),T)})});const C=function(w){const N={id:"bweforvideo",timestamp:new Date(w.timestamp).toISOString(),type:"VideoBwe"};return w.bitrate.retransmit&&(N.A_rb=w.bitrate.retransmit.toString()),w.bitrate.targetEncoded&&(N.A_teb=w.bitrate.targetEncoded.toString()),N.A_aeb=w.bitrate.actualEncoded.toString(),N.A_tb=w.bitrate.transmit.toString(),w.sendBandwidth!==void 0&&(N.A_asb=w.sendBandwidth.toString()),N}(o);C&&setTimeout(()=>{var w;return(w=this.requestUpload)===null||w===void 0?void 0:w.call(this,vo.PUBLISH_STATS,{stream_type:h===Qe.LocalVideoLowTrack?"low":"high",stats:C})},1e3);break}case Qe.LocalAudioTrack:{const S=function(T,C,w){const N=C.audioSend.find(U=>U.ssrc===T);if(!N)return null;const M={id:Kn(10,""),timestamp:new Date(C.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:N.ssrc.toString()};return M.A_astd=w._originMediaStreamTrack.enabled&&w._mediaStreamTrack.enabled?"0":"1",N.inputLevel?M.A_ail=Math.round(100*N.inputLevel).toString():M.A_ail=Math.round(100*w._source.getAccurateVolumeLevel()).toString(),M.A_apil=Math.round(100*w._source.getAccurateVolumeLevel()).toString(),N.aecReturnLoss&&(M.A_ecrl=Math.round(N.aecReturnLoss).toString()),N.aecReturnLossEnhancement&&(M.A_ecrle=Math.round(N.aecReturnLossEnhancement).toString()),M}(E[0].ssrcId,o,g);S&&ta(()=>{var T;return(T=this.requestUpload)===null||T===void 0?void 0:T.call(this,vo.PUBLISH_STATS,{stream_type:"high",stats:S})});break}}})}uploadSlowUplinkStats(o){var a;(((a=this.requestLocalMedia)===null||a===void 0?void 0:a.call(this))||[]).filter(u=>{let[h]=u;return h===Qe.LocalVideoLowTrack||h===Qe.LocalVideoTrack}).forEach(u=>{let[h,{ssrcs:g}]=u;const E=g3(g[0].ssrcId,o);E&&ta(()=>{var S;return(S=this.requestUpload)===null||S===void 0?void 0:S.call(this,vo.PUBLISH_STATS,{stream_type:h===Qe.LocalVideoLowTrack?"low":"high",stats:E})})})}uploadRelatedUplinkStats(o,a){var u;(((u=this.requestLocalMedia)===null||u===void 0?void 0:u.call(this))||[]).filter(h=>{let[g]=h;return g===Qe.LocalVideoLowTrack||g===Qe.LocalVideoTrack}).forEach(h=>{let[g,{ssrcs:E}]=h;const S=function(T,C){const w=C.videoSend.find(N=>N.ssrc===T);return w?{mediaType:"video",isVideoMute:!1,frameRateInput:w.inputFrame&&w.inputFrame.frameRate.toString(),frameRateSent:w.sentFrame&&w.sentFrame.frameRate.toString(),googRtt:w.rttMs.toString(),qpSumPerFrame:Math.floor(w.qpSumPerFrame).toString()}:null}(E[0].ssrcId,o);S&&ta(()=>{var T;(T=this.requestUpload)===null||T===void 0||T.call(this,vo.PUBLISH_RELATED_STATS,{stream_type:g===Qe.LocalVideoLowTrack?"low":"high",stats:S})})})}uploadDenoiserStats(o){for(let g=0;g<o.length;g++){const E=o[g];if(E instanceof EE){var a,u,h;const S=(a=(u=E._external).getDenoiserStats)===null||a===void 0?void 0:a.call(u);return void(S&&((h=this.requestUpload)===null||h===void 0||h.call(this,vo.DENOISER_STATS,S)))}}}uploadExtensionStats(o){for(let a=0;a<o.length;a++)o[a].getProcessorStats().forEach(u=>{var h;(h=this.requestUpload)===null||h===void 0||h.call(this,u.type,u.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let o;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let a=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var u;const h=(u=this.requestStats)===null||u===void 0?void 0:u.call(this);h&&(this.uploadDownlinkStats(h,a,o),o=h),a=!a},3e3),this.downlinkStatsUploadSlowInterval&&window.clearInterval(this.downlinkStatsUploadSlowInterval),this.downlinkStatsUploadSlowInterval=window.setInterval(()=>{var u;const h=(u=this.requestStats)===null||u===void 0?void 0:u.call(this);h&&this.uploadSlowDownlinkStats(h)},6e4),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var u;const h=(u=this.requestStats)===null||u===void 0?void 0:u.call(this);h&&(this.uploadRelatedDownlinkStats(h,this.lastStats),this.lastStats=h)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var u;const h=(u=this.requestRemoteMedia)===null||u===void 0?void 0:u.call(this);h&&this.uploadDownlinkExtensionStats(h)},2e3)}uploadDownlinkStats(o,a,u){var h;(((h=this.requestRemoteMedia)===null||h===void 0?void 0:h.call(this))||[]).forEach(g=>{let[E,S]=g;if(S.has(Ot.VIDEO)&&E.videoTrack){const T=E.videoTrack?function(C,w,N,M,U){const Y=w.videoRecv.find(ge=>ge.ssrc===C);if(!Y)return null;const X={id:Kn(10,""),timestamp:new Date(w.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:Y.ssrc.toString()};var J,fe;if(X.bytesReceived=Y.bytes.toString(),X.packetsLost=Y.packetsLost.toString(),X.packetsReceived=Y.packets.toString(),Y.framesRateFirefox&&(X.A_frr=Y.framesRateFirefox.toString()),Y.receivedFrame?(X.A_frr=Y.receivedFrame.frameRate.toString(),X.A_fhr=Y.receivedFrame.height.toString(),X.A_fwr=Y.receivedFrame.width.toString()):(X.A_fhr=(J=M._videoHeight)===null||J===void 0?void 0:J.toString(),X.A_fwr=(fe=M._videoWidth)===null||fe===void 0?void 0:fe.toString()),X.A_frd=Y.decodeFrameRate.toString(),Y.outputFrame&&(X.A_fro=Y.outputFrame.frameRate.toString()),Y.jitterBufferMs!==void 0&&(X.A_jbm=Math.floor(Y.jitterBufferMs).toString()),Y.currentDelayMs!==void 0&&(X.A_cdm=Math.floor(Y.currentDelayMs).toString()),X.A_fs=Y.firsCount.toString(),X.A_ns=Y.nacksCount.toString(),X.A_ps=Y.plisCount.toString(),M&&(X.A_vrtd=M._originMediaStreamTrack.enabled&&M._mediaStreamTrack.enabled?"0":"1"),M._player&&M._player.freezeTimeCounterList.length>0&&(X.A_vrft=Math.round(M._player.freezeTimeCounterList.splice(0,1)[0]).toString()),U&&M._player&&Lc.visibility==="visible"){const ge=Math.min(6e3,M._player.renderFreezeAccTime);X.A_vrrft=Math.round(ge).toString(),M._player.renderFreezeAccTime=Math.max(0,M._player.renderFreezeAccTime-ge)}if(X.A_rvps=rS[M._player?M._player.videoElementStatus:"uninit"].toString(),N){const ge=N.videoRecv.find(Ue=>Ue.ssrc===C);if(ge&&Y.totalInterFrameDelay!==void 0&&Y.totalSquaredInterFrameDelay!==void 0&&ge.totalInterFrameDelay!==void 0&&ge.totalSquaredInterFrameDelay!==void 0){const Ue=Y.totalInterFrameDelay-ge.totalInterFrameDelay,lt=Y.totalSquaredInterFrameDelay-ge.totalSquaredInterFrameDelay,Ve=Y.framesDecodeCount-ge.framesDecodeCount,Ge=Ue/Ve*1e3,Le=Math.round(1e3*Math.sqrt((lt-Math.pow(Ue,2)/Ve)/Ve));!isNaN(Le)&&Ge+Le>Math.max(3*Ge,Ge+150)&&(X.A_ifdsd=Le.toString())}}return X}(E._videoSSRC,o,u,E.videoTrack,a):void 0;T&&ta(()=>{var C;return(C=this.requestUpload)===null||C===void 0?void 0:C.call(this,vo.SUBSCRIBE_STATS,{stream_id:E.uid,stats:T})})}if(S.has(Ot.AUDIO)&&E.audioTrack){const T=E.audioTrack?function(C,w,N,M){const U=w.audioRecv.find(X=>X.ssrc===C);if(!U)return null;const Y={id:Kn(10,""),timestamp:new Date(w.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:U.ssrc.toString()};if(Y.bytesReceived=U.bytes.toString(),Y.packetsLost=U.packetsLost.toString(),Y.packetsReceived=U.packets.toString(),U.outputLevel?Y.A_aol=Math.round(100*U.outputLevel).toString():Y.A_aol=Math.round(100*M._source.getAccurateVolumeLevel()).toString(),Y.A_apol=Math.round(100*M._source.getAccurateVolumeLevel()).toString(),M&&(Y.A_artd=M._originMediaStreamTrack.enabled&&M._mediaStreamTrack.enabled?"0":"1"),Y.A_jr=U.jitterMs.toString(),Y.A_jbm=Math.floor(U.jitterBufferMs).toString(),Y.A_cdm=Math.floor(U.jitterBufferMs).toString(),Y.A_raps=rS[Bo.getPlayerState(M.getTrackId())].toString(),N){const X=N.audioRecv.find(J=>J.ssrc===C);if(X){const J=U.concealedSamples-X.concealedSamples;J>0&&(Y.A_cs=Math.round(J).toString())}}return Y}(E._audioSSRC,o,u,E.audioTrack):void 0;T&&ta(()=>{var C;return(C=this.requestUpload)===null||C===void 0?void 0:C.call(this,vo.SUBSCRIBE_STATS,{stream_id:E.uid,stats:T})})}})}uploadSlowDownlinkStats(o){}uploadRelatedDownlinkStats(o,a){var u;(((u=this.requestRemoteMedia)===null||u===void 0?void 0:u.call(this))||[]).forEach(h=>{let[g,E]=h;if(E.has(Ot.VIDEO)&&g.videoTrack){var S;const T=(g._videoSSRC&&((S=this.requestVideoIsReady)===null||S===void 0?void 0:S.call(this,g._videoSSRC))||!1)===!0,C=function(w,N,M,U,Y,X){const J=M.videoRecv.find(lt=>lt.ssrc===w),fe=Y?Y.videoRecv.find(lt=>lt.ssrc===w):void 0;if(!J)return null;const ge=Oh.isRemoteVideoFreeze(X,J,fe)&&N,Ue={mediaType:"video",isVideoMute:!1,peerId:U,frameRateReceived:J.receivedFrame&&J.receivedFrame.frameRate.toString(),frameRateDecoded:J.decodedFrame&&J.decodedFrame.frameRate.toString(),isFreeze:ge,bytesReceived:J.bytes.toString(),packetsReceived:J.packets.toString(),packetsLost:J.packetsLost.toString(),qpSumPerFrame:Math.floor(J.qpSumPerFrame).toString()};return J.framesRateFirefox&&(Ue.frameRateDecoded=J.framesRateFirefox.toString(),Ue.frameRateReceived=J.framesRateFirefox.toString()),Ue}(g._videoSSRC,T,o,g.uid,a,g.videoTrack);C&&ta(()=>{var w;(w=this.requestUpload)===null||w===void 0||w.call(this,vo.SUBSCRIBE_RELATED_STATS,{stream_id:g.uid,stats:C})})}if(E.has(Ot.AUDIO)&&g.audioTrack){const T=function(C,w,N,M){const U=w.audioRecv.find(X=>X.ssrc===C);if(!U)return null;const Y=Oh.isRemoteAudioFreeze(M);return{mediaType:"audio",isAudioMute:!1,peerId:N,googJitterReceived:U.jitterMs.toString(),isFreeze:Y,bytesReceived:U.bytes.toString(),packetsReceived:U.packets.toString(),packetsLost:U.packetsLost.toString(),frameReceived:U.receivedFrames.toString(),frameDropped:U.droppedFrames.toString()}}(g._audioSSRC,o,g.uid,g.audioTrack);T&&ta(()=>{var C;(C=this.requestUpload)===null||C===void 0||C.call(this,vo.SUBSCRIBE_RELATED_STATS,{stream_id:g.uid,stats:T})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(o){o.forEach(a=>{let[u,h]=a;h.has(Ot.VIDEO)&&u.videoTrack&&u.videoTrack.getProcessorStats().forEach(g=>{var E;(E=this.requestUpload)===null||E===void 0||E.call(this,g.type,g.stats)}),h.has(Ot.AUDIO)&&u.audioTrack&&u.audioTrack.getProcessorStats().forEach(g=>{var E;(E=this.requestUpload)===null||E===void 0||E.call(this,g.type,g.stats)})})}}const JP=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,$E="9",lT=2e4,dT=4e4;class Xq{get localCapabilities(){return lr(this._localCapabilities)}get rtpCapabilities(){return lr(this._rtpCapabilities)}get candidates(){return lr(this._candidates)}get iceParameters(){return lr(this._iceParameters)}get dtlsParameters(){return lr(this._dtlsParameters)}constructor(o){k(this,"sessionDesc",void 0),k(this,"_localCapabilities",void 0),k(this,"_rtpCapabilities",void 0),k(this,"_candidates",void 0),k(this,"_iceParameters",void 0),k(this,"_dtlsParameters",void 0),k(this,"setup",void 0),k(this,"currentMidIndex",void 0),k(this,"cname",void 0),k(this,"firefoxSsrcMidMap",new Map),o=lr(o);const{remoteIceParameters:a,remoteDtlsParameters:u,candidates:h,remoteRTPCapabilities:g,remoteSetup:E,localCapabilities:S,cname:T}=o,C=hr.exports.parse(JP);this._rtpCapabilities=g,this._candidates=h,this._iceParameters=a,this._dtlsParameters=u,this._localCapabilities=S,this.setup=E,this.cname=T;const w=this.rtpCapabilities.send;for(const N of C.mediaDescriptions){if(N.attributes.iceUfrag=a.iceUfrag,N.attributes.icePwd=a.icePwd,N.attributes.fingerprints=u.fingerprints,N.attributes.candidates=h,N.attributes.setup=E,N.media.mediaType==="application"&&(N.attributes.sctpPort="5000"),N.media.mediaType==="video"&&(N.media.fmts=w.videoCodecs.map(M=>M.payloadType.toString(10)),N.attributes.payloads=w.videoCodecs,N.attributes.extmaps=w.videoExtensions,de("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:M,ssrcGroups:U}=xi([{ssrcId:dT,rtx:de("USE_RTX")?40001:void 0}],this.cname);N.attributes.ssrcs=M,N.attributes.ssrcGroups=U}if(N.media.mediaType==="audio"&&(N.media.fmts=w.audioCodecs.map(M=>M.payloadType.toString(10)),N.attributes.payloads=w.audioCodecs,N.attributes.extmaps=w.audioExtensions,Lu(N),de("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:M,ssrcGroups:U}=xi([{ssrcId:lT}],this.cname);N.attributes.ssrcs=M,N.attributes.ssrcGroups=U}}this.sessionDesc=C,this.currentMidIndex=C.mediaDescriptions.length-1}updateRemoteRTPCapabilities(o){const a=hr.exports.parse(JP);this._rtpCapabilities=o;const u=this.rtpCapabilities.send;for(const h of a.mediaDescriptions){if(h.attributes.iceUfrag=this._iceParameters.iceUfrag,h.attributes.icePwd=this._iceParameters.icePwd,h.attributes.fingerprints=this._dtlsParameters.fingerprints,h.attributes.candidates=this._candidates,h.attributes.setup=this.setup,h.media.mediaType==="application"&&(h.attributes.sctpPort="5000"),h.media.mediaType==="video"&&(h.media.fmts=u.videoCodecs.map(g=>g.payloadType.toString(10)),h.attributes.payloads=u.videoCodecs,h.attributes.extmaps=u.videoExtensions,de("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:g,ssrcGroups:E}=xi([{ssrcId:dT,rtx:de("USE_RTX")?40001:void 0}],this.cname);h.attributes.ssrcs=g,h.attributes.ssrcGroups=E}if(h.media.mediaType==="audio"&&(h.media.fmts=u.audioCodecs.map(g=>g.payloadType.toString(10)),h.attributes.payloads=u.audioCodecs,h.attributes.extmaps=u.audioExtensions,de("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:g,ssrcGroups:E}=xi([{ssrcId:lT}],this.cname);h.attributes.ssrcs=g,h.attributes.ssrcGroups=E}}this.sessionDesc=a,this.currentMidIndex=a.mediaDescriptions.length-1}preloadRemoteMedia(o){this.rtpCapabilities;const a=this.candidates,u=this.dtlsParameters,h=this.iceParameters,g=this.rtpCapabilities.send;for(let E=1;E<o;E++){const S=2*E+lT,T=2*E+dT,{ssrcs:C,ssrcGroups:w}=xi([{ssrcId:S}],this.cname),{ssrcs:N,ssrcGroups:M}=xi([{ssrcId:T,rtx:de("USE_RTX")?T+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:$E,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.videoCodecs.map(U=>U.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:h.iceUfrag,icePwd:h.icePwd,unrecognized:[],candidates:a,extmaps:g.videoExtensions,fingerprints:u.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:N,ssrcGroups:M,rtcpFeedbackWildcards:[],payloads:g.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*E-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:$E,protos:["UDP","TLS","RTP","SAVPF"],fmts:g.audioCodecs.map(U=>U.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:h.iceUfrag,icePwd:h.icePwd,unrecognized:[],candidates:a,extmaps:g.audioExtensions,fingerprints:u.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:C,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:g.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*E)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return hr.exports.print(this.sessionDesc)}send(o,a,u,h){const{ssrcs:g,ssrcGroups:E}=xi(a,this.cname,de("AV_SYNC")?u:void 0),S=this.findPreloadMediaDesc(g);if(S){if(Jn()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,S.attributes.mid),h&&(h.twcc||h.remb)){const T=this.sessionDesc.mediaDescriptions.indexOf(S);return this.sessionDesc.mediaDescriptions[T]=this.mungSendMediaDesc(S,h),{mid:S.attributes.mid,needExchangeSDP:!0}}return{mid:S.attributes.mid,needExchangeSDP:!1}}{const T=this.findAvailableMediaIndex(o,g);let C;return T===-1||Vo()||eo()||UO()?(C=this.createOrRecycleSendMedia(o,g,E,"sendonly",h),this.updateBundleMids()):(C=lr(this.sessionDesc.mediaDescriptions[T]),C.attributes.direction="sendonly",C.attributes.ssrcs=g,C.attributes.ssrcGroups=E,this.sessionDesc.mediaDescriptions[T]=this.mungSendMediaDesc(C,h)),Jn()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,C.attributes.mid),{mid:C.attributes.mid,needExchangeSDP:!0}}}batchSend(o){const a=o.map(g=>{let{kind:E,ssrcMsg:S,mslabel:T}=g;return this.send(E,S,T)}),u=[];let h=!1;return a.forEach(g=>{let{mid:E,needExchangeSDP:S}=g;S&&(h=!0),u.push(E)}),{mids:u,needExchangeSDP:h}}stopSending(o){const a=this.sessionDesc.mediaDescriptions.filter(u=>u.attributes.mid&&o.indexOf(u.attributes.mid)!==-1);if(a.length!==o.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");a.forEach(u=>{u.attributes.mid==="0"||Jn()||Vo()||eo()?u.attributes.ssrcs=[]:(u.attributes.ssrcs=[],u.attributes.direction="inactive",u.media.port="0")}),this.updateBundleMids()}mute(o){const a=this.sessionDesc.mediaDescriptions.find(u=>u.attributes.mid===o);if(!a)throw new Error("mediaDescription not found with ".concat(o," in remote SDP when calling RemoteSDP.mute."));a.attributes.direction="inactive"}unmute(o){const a=this.sessionDesc.mediaDescriptions.find(u=>u.attributes.mid===o);if(!a)throw new Error("mediaDescription not found with ".concat(o," in remote SDP when calling RemoteSDP.unmute."));a.attributes.direction="sendonly"}muteRemote(o){const a=this.sessionDesc.mediaDescriptions.filter(u=>o.includes(u.attributes.mid||""));if(a.length!==o.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");a.forEach(u=>{u.attributes.direction="inactive"})}unmuteRemote(o){const a=this.sessionDesc.mediaDescriptions.filter(u=>o.includes(u.attributes.mid||""));if(a.length!==o.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");a.forEach(u=>{u.attributes.direction="recvonly"})}receive(o,a,u,h){o.forEach((g,E)=>{this.createOrRecycleRecvMedia(g,[],"recvonly",a,u,h[E])}),this.updateBundleMids()}stopReceiving(o){const a=this.sessionDesc.mediaDescriptions.filter(u=>o.indexOf(u.attributes.mid)!==-1);if(a.length!==o.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");a.forEach(u=>{u.media.port="0",u.attributes.direction="inactive"}),this.updateBundleMids()}restartICE(o){o=lr(o),this._iceParameters=o,this.sessionDesc.mediaDescriptions.forEach(a=>{a.attributes.iceUfrag=o.iceUfrag,a.attributes.icePwd=o.icePwd})}predictReceivingMids(o){const a=[];for(let u=0;u<o;u++)a.push((this.currentMidIndex+u+1).toString(10));return a}findAvailableMediaIndex(o,a){return this.sessionDesc.mediaDescriptions.findIndex(u=>{const h=u.media.mediaType===o&&u.media.port!=="0"&&(u.attributes.direction==="sendonly"||u.attributes.direction==="sendrecv")&&u.attributes.ssrcs.length===0;if(Jn()){if(h){const g=this.firefoxSsrcMidMap.get(a[0].ssrcId);return!(g||u.attributes.mid!=="0"&&u.attributes.mid!=="1")||!(!g||g!==u.attributes.mid)}return!1}return h})}createOrRecycleRecvMedia(o,a,u,h,g,E){const S=o._mediaStreamTrack.kind,T=this.rtpCapabilities.recv,C=this.localCapabilities.send;let w=[];if(S===Ot.VIDEO){var N,M;if(de("H264_PROFILE_LEVEL_ID")&&h==="h264"&&(w=T.videoCodecs.filter(fe=>{var ge,Ue;return(((ge=fe.rtpMap)===null||ge===void 0?void 0:ge.encodingName.toLowerCase())||"").includes(h)&&(fe==null||(Ue=fe.fmtp)===null||Ue===void 0?void 0:Ue.parameters["profile-level-id"])===de("H264_PROFILE_LEVEL_ID")})),!w||((N=w)===null||N===void 0?void 0:N.length)===0){const fe=C.videoCodecs.filter(ge=>{var Ue;return(((Ue=ge.rtpMap)===null||Ue===void 0?void 0:Ue.encodingName.toLowerCase())||"").includes(h)});fe.length!==0&&(w=T.videoCodecs.filter(ge=>fe.some(Ue=>Ue.payloadType===ge.payloadType)))}if(de("USE_RTX")){const fe=w.map(Ue=>Ue.payloadType.toString()),ge=T.videoCodecs.filter(Ue=>{var lt,Ve;return((lt=Ue.rtpMap)===null||lt===void 0?void 0:lt.encodingName)==="rtx"&&fe.includes(((Ve=Ue.fmtp)===null||Ve===void 0?void 0:Ve.parameters.apt)||"")});w=[...w,...ge]}w.length===0&&(F.warning("codec ".concat(h," not included in rtpCapabilities, fallback to default payloads: ").concat((M=T.videoCodecs[0].rtpMap)===null||M===void 0?void 0:M.encodingName)),w=T.videoCodecs)}else w=T.audioCodecs.filter(fe=>{var ge;return(((ge=fe.rtpMap)===null||ge===void 0?void 0:ge.encodingName.toLowerCase())||"").includes(g)}),w.length===0&&(F.warning("codec ".concat(g," not included in rtpCapabilities, fallback to opus")),w=T.audioCodecs.filter(fe=>{var ge;return(((ge=fe.rtpMap)===null||ge===void 0?void 0:ge.encodingName.toLowerCase())||"").includes("opus")}));const U=S===Ot.VIDEO?T.videoExtensions:T.audioExtensions;this.currentMidIndex+=1;const Y="".concat(this.currentMidIndex);let X={media:{mediaType:S,port:$E,protos:["UDP","TLS","RTP","SAVPF"],fmts:w.map(fe=>fe.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:U,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:a,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:w,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:u,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};X=this.mungRecvMediaDsec(X,o,E);const J=this.findFirstClosedMedia(S);if(J){const fe=this.sessionDesc.mediaDescriptions.indexOf(J);this.sessionDesc.mediaDescriptions[fe]=X}else this.sessionDesc.mediaDescriptions.push(X);return X}createOrRecycleSendMedia(o,a,u,h,g){const E=this.rtpCapabilities.send,S=o===Ot.VIDEO?E.videoCodecs:E.audioCodecs,T=o===Ot.VIDEO?E.videoExtensions:E.audioExtensions;this.currentMidIndex+=1;const C="".concat(this.currentMidIndex);let w={media:{mediaType:o,port:$E,protos:["UDP","TLS","RTP","SAVPF"],fmts:S.map(M=>M.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:T,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:a,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:S,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:h,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(C)}};w=this.mungSendMediaDesc(w,g);const N=this.findFirstClosedMedia(o);if(N){const M=this.sessionDesc.mediaDescriptions.indexOf(N);this.sessionDesc.mediaDescriptions[M]=w}else this.sessionDesc.mediaDescriptions.push(w);return w}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(o=>o.media.port!=="0").map(o=>o.attributes.mid)}mungRecvMediaDsec(o,a,u){const h=lr(o);return sT(h),$h(h,a),oT(h,a),yP(h),xE(h,u,this.localCapabilities.send),h}mungSendMediaDesc(o,a){const u=lr(o);return xE(u,a,this.localCapabilities.recv),Lu(u),u}updateRecvMedia(o,a){const u=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===o);if(u!==-1){const h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u],a);this.sessionDesc.mediaDescriptions[u]=h}}bumpMid(o){this.currentMidIndex+=o}findFirstClosedMedia(o){return this.sessionDesc.mediaDescriptions.find(a=>Jn()?a.media.port==="0"&&a.media.mediaType===o:a.media.port==="0")}findPreloadMediaDesc(o){return this.sessionDesc.mediaDescriptions.find(a=>{var u,h;return((u=a.attributes)===null||u===void 0||(h=u.ssrcs[0])===null||h===void 0?void 0:h.ssrcId)===o[0].ssrcId})}getSSRC(o){var a;return(a=this.sessionDesc.mediaDescriptions.find(u=>u.attributes.mid===o))===null||a===void 0?void 0:a.attributes.ssrcs}}var rn;function QP(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function FE(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?QP(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):QP(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}let Yq=(Ne((rn=class b0 extends hE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(o,a,u){super(o,a),k(this,"store",void 0),k(this,"peerConnection",void 0),k(this,"remoteSDP",void 0),k(this,"initialOffer",void 0),k(this,"transportEventReceiver",void 0),k(this,"statsFilter",void 0),k(this,"useRTX",de("USE_RTX")),k(this,"localCapabilities",void 0),k(this,"localCandidateCount",0),k(this,"allCandidatesReceived",!1),k(this,"establishPromise",void 0),k(this,"mutex",new js("NVExtentionsConnection-mutex")),k(this,"rtcMedia",void 0),this.store=a,this.peerConnection=u,this.statsFilter=uT(this.peerConnection,void 0,void 0,Jn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(o){try{const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const u=td(a.sdp),h=await SP(!this.useRTX,de("FILTER_VIDEO_FEC"),de("FILTER_AUDIO_FEC"));return this.localCapabilities=h,this.initialOffer=a,FE(FE({},u),{},{rtpCapabilities:h,offerSDP:a.sdp})}catch(a){throw new Q(K.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}}async connect(o,a,u,h,g,E){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new Xq({remoteIceParameters:o,remoteDtlsParameters:a,candidates:u,remoteRTPCapabilities:h,remoteSetup:g,localCapabilities:iT(this.localCapabilities),cname:E});const S=this.remoteSDP.toString(),T=hr.exports.parse(this.initialOffer.sdp),C=T.mediaDescriptions.find(M=>M.media.mediaType==="audio");C&&Lu(C);const w=hr.exports.print(T),N=this.logSDPExchange(w||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:w}),N==null||N(S),await this.peerConnection.setRemoteDescription({type:"answer",sdp:S})}catch(S){throw new Q(K.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(S.toString()))}}async updateRemoteConnect(o){var a,u,h;(a=this.remoteSDP)===null||a===void 0||a.updateRemoteRTPCapabilities(o),(u=this.remoteSDP)===null||u===void 0||u.preloadRemoteMedia(2);const g=(h=this.remoteSDP)===null||h===void 0?void 0:h.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const E=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(E),F.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(o,a,u){var h=this;return na(function*(){const g=yield Ft(h.mutex.lock("From NVExtentionsConnection.send"));try{if(!h.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const E=[];o.forEach(X=>{const J=h.peerConnection.addTransceiver(X._mediaStreamTrack,{direction:"sendonly"});E.push(J)}),Jn()&&de("SIMULCAST")===!0&&(yield Ft(h.applySimulcastForFirefox(E,o)));const S=yield Ft(h.peerConnection.createOffer()),T=h.remoteSDP.predictReceivingMids(o.length),C=h.mungSendOfferSDP(S.sdp,o,T),w=hr.exports.parse(C),N=T.map(X=>{const J=w.mediaDescriptions.find(fe=>fe.attributes.mid===X);if(!J)throw new Error("Cannot extract ssrc from mediaDescription.");return EP(J,h.useRTX)});let M;try{M=yield N}catch(X){M=[],h.remoteSDP.receive(o,a,u,M);const J=h.remoteSDP.toString();throw yield Ft(h.peerConnection.setLocalDescription({type:"offer",sdp:C})),yield Ft(h.peerConnection.setRemoteDescription({type:"answer",sdp:J})),yield Ft(h.stopSending(T,!0)),X}h.remoteSDP.receive(o,a,u,M);const U=h.remoteSDP.toString(),Y=h.logSDPExchange(C,"offer","local","send");return yield Ft(h.peerConnection.setLocalDescription({type:"offer",sdp:C})),yield Ft(h.applySimulcastEncodings(E,o)),yield Ft(h.applySendEncodings(E,o)),Y==null||Y(U),yield Ft(h.peerConnection.setRemoteDescription({type:"answer",sdp:U})),E.map((X,J)=>{const fe=T[J];return{localSSRC:N[J],id:fe,transceiver:X}})}catch(E){throw E instanceof Q?E:new Q(K.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(E.toString()))}finally{g()}})()}async stopSending(o,a){const u=a?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const h=this.peerConnection.getTransceivers().filter(T=>o.indexOf(T.mid)!==-1);if(h.length!==o.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");h.map(T=>{var C;T.direction="inactive",(C=T.stop)===null||C===void 0||C.call(T)});const g=await this.peerConnection.createOffer(),E=this.logSDPExchange(g.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(g),this.remoteSDP.stopReceiving(o);const S=this.remoteSDP.toString();E==null||E(S),await this.peerConnection.setRemoteDescription({type:"answer",sdp:S})}catch(h){throw new Q(K.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(h.toString()))}finally{u&&u()}}async receive(o,a,u,h){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(o," before remoteSDP created."));const{mid:g,needExchangeSDP:E}=this.remoteSDP.send(o,a,u,h);if(E){const T=this.remoteSDP.toString(),C=this.logSDPExchange(T,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:T});const w=await this.peerConnection.createAnswer(),N=this.mungReceiveAnswerSDP(w.sdp,g,o);C==null||C(N||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:N}),F.debug("[NVExtentionsConnection] receive ".concat(o," by exchanging SDP."))}else F.debug("[NVExtentionsConnection] receive ".concat(o," no need to exchange SDP."));const S=this.peerConnection.getTransceivers().find(T=>T.mid===g);if(!S)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:S.receiver.track,id:g}}catch(g){throw new Q(K.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(g.toString()))}}async batchReceive(o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:a,needExchangeSDP:u}=this.remoteSDP.batchSend(o);if(u){const h=this.remoteSDP.toString(),g=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const E=await this.peerConnection.createAnswer();g==null||g(E.sdp||""),await this.peerConnection.setLocalDescription(E),F.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else F.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return a.map(h=>{const g=this.peerConnection.getTransceivers().find(E=>E.mid===h);if(!g)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:g.receiver.track,id:h}})}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(o);const a=this.remoteSDP.toString(),u=this.logSDPExchange(a,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const h=await this.peerConnection.createAnswer();u==null||u(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(a.toString()))}}async muteRemote(o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(o," before remote SDP created."));this.remoteSDP.mute(o);const a=this.remoteSDP.toString(),u=this.logSDPExchange(a,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const h=await this.peerConnection.createAnswer();u==null||u(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(a.toString()))}}async unmuteRemote(o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(o," before remote SDP created."));this.remoteSDP.unmute(o);const a=this.remoteSDP.toString(),u=this.logSDPExchange(a,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const h=await this.peerConnection.createAnswer();u==null||u(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(a.toString()))}}async muteLocal(o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const a=this.peerConnection.getTransceivers().filter(E=>E.mid&&o.indexOf(E.mid)!==-1);if(a.length!==o.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(E=>{E.direction="inactive"});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(u),this.remoteSDP.muteRemote(o);const g=this.remoteSDP.toString();h==null||h(g),await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(a.toString()))}}async unmuteLocal(o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const a=this.peerConnection.getTransceivers().filter(E=>E.mid&&o.indexOf(E.mid)!==-1);if(a.length!==o.length)throw new Error("Transceivers' length doesn't match mids' length.");a.map(async(E,S)=>{E.direction="sendonly"});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(u),this.remoteSDP.unmuteRemote(o);const g=this.remoteSDP.toString();h==null||h(g),await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(a){throw new Q(K.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(a.toString()))}}restartICE(){var o=this;return na(function*(){const a=yield Ft(o.mutex.lock("From NVExtentionsConnection.restartICE"));try{const u=yield Ft(o.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=td(u.sdp),{remoteIceParameters:g}=yield h.iceParameters;if(!o.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");o.remoteSDP.restartICE(g);const E=o.remoteSDP.toString(),S=o.logSDPExchange(u.sdp||"","offer","local","restartICE");yield Ft(o.peerConnection.setLocalDescription(u)),S==null||S(E),yield Ft(o.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(u){F.warning("restart ICE failed, abort operation",u)}finally{a()}})()}close(){var o;(o=this.onConnectionStateChange)===null||o===void 0||o.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(o){return this.statsFilter.getVideoIsReady(o)}async updateEncoderConfig(o,a){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const u=await this.peerConnection.createOffer(),h=this.mungSendOfferSDP(u.sdp,[a],[o]);this.remoteSDP.updateRecvMedia(o,a);const g=this.remoteSDP.toString(),E=this.logSDPExchange(h,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),E==null||E(g),await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(u){throw new Q(K.EXCHANGE_SDP_FAILED,u.toString())}}async updateSendParameters(o,a){const u=this.peerConnection.getTransceivers().filter(h=>h.mid===o);u.length===1&&(this.isVP8Simulcast(a)?Jn()||await this.applySimulcastEncodings(u,[a]):await this.applySendEncodings(u,[a]))}setStatsRemoteVideoIsReady(o,a){this.statsFilter.setVideoIsReady2(o,a)}async replaceTrack(o,a){const u=this.peerConnection.getTransceivers().find(h=>h.mid===a);u&&await u.sender.replaceTrack(o._mediaStreamTrack)}getP2PConnectionParams(){var o;if((o=this.peerConnection.currentLocalDescription)===null||o===void 0||!o.sdp||!this.localCapabilities)throw new Error;return FE(FE({},td(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var o;(o=this.onICEConnectionStateChange)===null||o===void 0||o.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var o;(o=this.onConnectionStateChange)===null||o===void 0||o.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=o=>{o.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,F.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,F.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},de("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(o){const a={iceServers:[]};return o.iceServers?a.iceServers=o.iceServers:o.turnServer&&o.turnServer.mode!=="off"&&(_f(o.turnServer.servers)?a.iceServers=o.turnServer.servers:(a.iceServers&&a.iceServers.push(...b0.turnServerConfigToIceServers(o.turnServer.servers)),de("USE_TURN_SERVER_OF_GATEWAY")&&a.iceServers&&o.turnServer.serversFromGateway&&a.iceServers.push(...b0.turnServerConfigToIceServers(o.turnServer.serversFromGateway)),de("FORCE_TURN_TCP")?a.iceTransportPolicy="relay":o.turnServer.servers.concat(o.turnServer.serversFromGateway||[]).forEach(u=>{u.forceturn&&(a.iceTransportPolicy="relay")}))),a}static turnServerConfigToIceServers(o){const a=[];return o.forEach(u=>{u.security?u.tcpport&&a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(yE(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}):(u.udpport&&!de("FORCE_TURN_TCP")&&a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.udpport,"?transport=udp")}),u.tcpport&&a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=tcp")}))}),a}async applySendEncodings(o,a){try{if(!ns().supportSetRtpSenderParameters||o.length!==a.length)return;for(let C=0;C<o.length;C++){const w=o[C],N=a[C];if(N&&N instanceof dr){var u,h;if(this.isVP8Simulcast(N))continue;const M={},U={};switch(N._optimizationMode){case"motion":M.degradationPreference="maintain-framerate";break;case"detail":M.degradationPreference="maintain-resolution";break;default:M.degradationPreference="balanced"}var g,E,S,T;if((u=N._encoderConfig)!==null&&u!==void 0&&u.bitrateMax&&(U.maxBitrate=1e3*((g=N._encoderConfig)===null||g===void 0?void 0:g.bitrateMax)),N._hints.includes(ts.LOW_STREAM)&&((E=N._encoderConfig)!==null&&E!==void 0&&E.frameRate&&(U.maxFramerate=Mc(N._encoderConfig.frameRate)),(S=N._encoderConfig)!==null&&S!==void 0&&S.scaleResolutionDownBy&&((T=N._encoderConfig)===null||T===void 0?void 0:T.scaleResolutionDownBy)>1&&(U.scaleResolutionDownBy=N._encoderConfig.scaleResolutionDownBy)),de("DSCP_TYPE")&&Gl()){const J=de("DSCP_TYPE");["very-low","low","medium","high"].includes(J)&&(U.networkPriority=J)}const Y=w.sender.getParameters(),X=(h=Y.encodings)===null||h===void 0?void 0:h[0];Jn()&&!X&&(M.encodings=[U]),X&&Object.assign(X,U),Object.assign(Y,M),await w.sender.setParameters(Y)}}}catch{F.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(o,a,u){const h=hr.exports.parse(o);return a.forEach((g,E)=>{const S=u[E],T=h.mediaDescriptions.find(C=>C.attributes.mid===S);T&&($h(T,g),vP(T,g,this.store.codec))}),hr.exports.print(h)}mungReceiveAnswerSDP(o,a,u){const h=hr.exports.parse(o),g=h.mediaDescriptions.find(E=>E.attributes.mid===a);return g&&u===Ot.AUDIO&&g.media.mediaType==="audio"&&Lu(g),hr.exports.print(h)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=o=>{var a;(a=this.onFirstAudioReceived)===null||a===void 0||a.call(this,o)},this.statsFilter.onFirstVideoReceived=o=>{var a;(a=this.onFirstVideoReceived)===null||a===void 0||a.call(this,o)},this.statsFilter.onFirstAudioDecoded=o=>{var a;(a=this.onFirstAudioDecoded)===null||a===void 0||a.call(this,o)},this.statsFilter.onFirstVideoDecoded=(o,a,u)=>{var h;(h=this.onFirstVideoDecoded)===null||h===void 0||h.call(this,o,a,u)},this.statsFilter.onSelectedLocalCandidateChanged=(o,a)=>{var u;(u=this.onSelectedLocalCandidateChanged)===null||u===void 0||u.call(this,o,a)},this.statsFilter.onSelectedRemoteCandidateChanged=(o,a)=>{var u;(u=this.onSelectedRemoteCandidateChanged)===null||u===void 0||u.call(this,o,a)},this.statsFilter.onFirstVideoDecodedTimeout=o=>{var a;(a=this.onFirstVideoDecodedTimeout)===null||a===void 0||a.call(this,o)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(o,a){if(o.length===a.length)for(let S=0;S<o.length;S++){var u,h,g,E;const T=o[S],C=a[S];if(C instanceof dr&&!C._hints.includes(ts.LOW_STREAM)&&(u=C._encoderConfig)!==null&&u!==void 0&&u.bitrateMax&&((h=C._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)>200&&(g=C._scalabiltyMode)!==null&&g!==void 0&&g.numSpatialLayers&&((E=C._scalabiltyMode)===null||E===void 0?void 0:E.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},N={high:1e3*(C._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:N.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:N.high}];const M=T.sender.getParameters();await T.sender.setParameters(Object.assign(M,w))}}}async applySimulcastEncodings(o,a){if(!Jn()&&o.length===a.length)for(let u=0;u<o.length;u++){const h=a[u];if(h instanceof dr&&this.isVP8Simulcast(h)){const g=o[u],E={},S={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};E.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:S.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:S.medium,scaleResolutionDownBy:4}];const T=g.sender.getParameters();await g.sender.setParameters(Object.assign(T,E))}}}isVP8Simulcast(o){var a,u,h,g;return!!(o instanceof dr&&de("SIMULCAST")&&this.store.codec==="vp8"&&!o._hints.includes(ts.LOW_STREAM)&&(a=o._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((u=o._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=o._scalabiltyMode)!==null&&h!==void 0&&h.numSpatialLayers&&((g=o._scalabiltyMode)===null||g===void 0?void 0:g.numSpatialLayers)>1)}logSDPExchange(o,a,u,h){if(de("SDP_LOGGING"))return F.upload("exchanging ".concat(u," ").concat(a," SDP during NVExtentionsConnection.").concat(h,`
`),o),a==="offer"?g=>{this.logSDPExchange(g,"answer",u==="local"?"remote":"local",h)}:void 0}async getRemoteSSRC(o){if(!this.remoteSDP)return;const a=this.remoteSDP.getSSRC(o);return a==null?void 0:a[0].ssrcId}setConfiguration(o){if(ns().supportPCSetConfiguration){const a=b0.resolvePCConfiguration(o);this.peerConnection.setConfiguration(a)}}}).prototype,"connect",[si],Object.getOwnPropertyDescriptor(rn.prototype,"connect"),rn.prototype),Ne(rn.prototype,"updateRemoteConnect",[si],Object.getOwnPropertyDescriptor(rn.prototype,"updateRemoteConnect"),rn.prototype),Ne(rn.prototype,"receive",[si],Object.getOwnPropertyDescriptor(rn.prototype,"receive"),rn.prototype),Ne(rn.prototype,"batchReceive",[si],Object.getOwnPropertyDescriptor(rn.prototype,"batchReceive"),rn.prototype),Ne(rn.prototype,"stopReceiving",[si],Object.getOwnPropertyDescriptor(rn.prototype,"stopReceiving"),rn.prototype),Ne(rn.prototype,"muteRemote",[si],Object.getOwnPropertyDescriptor(rn.prototype,"muteRemote"),rn.prototype),Ne(rn.prototype,"unmuteRemote",[si],Object.getOwnPropertyDescriptor(rn.prototype,"unmuteRemote"),rn.prototype),Ne(rn.prototype,"muteLocal",[si],Object.getOwnPropertyDescriptor(rn.prototype,"muteLocal"),rn.prototype),Ne(rn.prototype,"unmuteLocal",[si],Object.getOwnPropertyDescriptor(rn.prototype,"unmuteLocal"),rn.prototype),Ne(rn.prototype,"close",[si],Object.getOwnPropertyDescriptor(rn.prototype,"close"),rn.prototype),Ne(rn.prototype,"updateEncoderConfig",[si],Object.getOwnPropertyDescriptor(rn.prototype,"updateEncoderConfig"),rn.prototype),Ne(rn.prototype,"updateSendParameters",[si],Object.getOwnPropertyDescriptor(rn.prototype,"updateSendParameters"),rn.prototype),Ne(rn.prototype,"replaceTrack",[si],Object.getOwnPropertyDescriptor(rn.prototype,"replaceTrack"),rn.prototype),Ne(rn.prototype,"getRemoteSSRC",[si],Object.getOwnPropertyDescriptor(rn.prototype,"getRemoteSSRC"),rn.prototype),rn);function si(r,o,a){const u=r[o];if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){const h=this.mutex,g=await h.lock("From NVExtentionsConnection.".concat(o));try{for(var E=arguments.length,S=new Array(E),T=0;T<E;T++)S[T]=arguments[T];return await u.apply(this,S)}finally{g()}},a}var Cn;function ZP(r){var o,a,u,h=2;for(typeof Symbol<"u"&&(a=fP,u=Symbol.iterator);h--;){if(a&&(o=r[a])!=null)return o.call(r);if(u&&(o=r[u])!=null)return new hT(o.call(r));a="@@asyncIterator",u="@@iterator"}throw new TypeError("Object is not async iterable")}function hT(r){function o(a){if(Object(a)!==a)return Je.reject(new TypeError(a+" is not an object."));var u=a.done;return Je.resolve(a.value).then(function(h){return{value:h,done:u}})}return(hT=function(a){this.s=a,this.n=a.next}).prototype={s:null,n:null,next:function(){return o(this.n.apply(this.s,arguments))},return:function(a){var u=this.s.return;return u===void 0?Je.resolve({value:a,done:!0}):o(u.apply(this.s,arguments))},throw:function(a){var u=this.s.return;return u===void 0?Je.reject(a):o(u.apply(this.s,arguments))}},new hT(r)}let Mu=(Ne((Cn=class N0 extends hE{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(o,a){super(o,a),k(this,"store",void 0),k(this,"peerConnection",void 0),k(this,"cname",void 0),k(this,"mutex",new js("DataChannelConnection-mutex")),k(this,"dataChannel",void 0),k(this,"_p2pConnection",void 0),k(this,"establishPromise",void 0),k(this,"_nvMedia",void 0),this.store=a,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(N0.resolvePCConfiguration(o),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Yq(o,a,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var o;const a=(o=this._nvMedia)===null||o===void 0?void 0:o.getLocalRtpCapabilities();return await this._p2pConnection.establish(a)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(o,a,u,h,g,E){return this.cname=E,await this._p2pConnection.connect(o,a,u,h,g,E),await new Je((S,T)=>{const C=setTimeout(()=>{this.closeSignal(),T(new Q(K.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(u))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(C),void S()},this.dataChannel.onerror=w=>{this.closeSignal(),T(w)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(o,a,u){var h=this;return na(function*(){const g=yield Ft(h.mutex.lock("From DataChannelConnection.send"));try{return yield*Df(ZP(h._p2pConnection.send(o,a,u)),Ft)}finally{g()}})()}async stopSending(o,a){return this._p2pConnection.stopSending(o,a)}async receive(o,a,u,h){return this._nvMedia?(F.debug("[DataChannelConnection] receive ".concat(o," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(o,a,this.cname)):(F.debug("[DataChannelConnection] receive ".concat(o," by WebRTC.")),await this._p2pConnection.receive(o,a,u,h))}async batchReceive(o){return[...await this._p2pConnection.batchReceive(o)]}async stopReceiving(o){return await this._p2pConnection.stopReceiving(o)}async muteRemote(o){return await this._p2pConnection.muteRemote(o)}async unmuteRemote(o){return await this._p2pConnection.unmuteRemote(o)}async muteLocal(o){return await this._p2pConnection.muteLocal(o)}async unmuteLocal(o){return await this._p2pConnection.unmuteLocal(o)}restartICE(){var o=this;return na(function*(){return yield*Df(ZP(o._p2pConnection.restartICE()),Ft)})()}close(){var o;(o=this._nvMedia)===null||o===void 0||o.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(o){return this._p2pConnection.getRemoteVideoIsReady(o)}updateRemoteConnect(o){var a;(a=this._nvMedia)===null||a===void 0||a.setRemoteRtpCapabilities(o),this._p2pConnection.updateRemoteConnect(o)}async updateEncoderConfig(o,a){return await this._p2pConnection.updateEncoderConfig(o,a)}async updateSendParameters(o,a){return await this._p2pConnection.updateSendParameters(o,a)}setStatsRemoteVideoIsReady(o,a){this._p2pConnection.setStatsRemoteVideoIsReady(o,a)}async replaceTrack(o,a){return await this._p2pConnection.replaceTrack(o,a)}async getRemoteSSRC(o){return this._p2pConnection.getRemoteSSRC(o)}logSDPExchange(o,a,u,h){if(de("SDP_LOGGING"))return F.upload("exchanging ".concat(u," ").concat(a," SDP during DataChannelConnection.").concat(h,`
`),o),a==="offer"?g=>{this.logSDPExchange(g,"answer",u==="local"?"remote":"local",h)}:void 0}static resolvePCConfiguration(o){const a={iceServers:[]};return o.iceServers?a.iceServers=o.iceServers:o.turnServer&&o.turnServer.mode!=="off"&&(_f(o.turnServer.servers)?a.iceServers=o.turnServer.servers:(a.iceServers&&a.iceServers.push(...N0.turnServerConfigToIceServers(o.turnServer.servers)),de("USE_TURN_SERVER_OF_GATEWAY")&&a.iceServers&&o.turnServer.serversFromGateway&&a.iceServers.push(...N0.turnServerConfigToIceServers(o.turnServer.serversFromGateway)),de("FORCE_TURN_TCP")?a.iceTransportPolicy="relay":o.turnServer.servers.concat(o.turnServer.serversFromGateway||[]).forEach(u=>{u.forceturn&&(a.iceTransportPolicy="relay")}))),a}static turnServerConfigToIceServers(o){const a=[];return o.forEach(u=>{u.security?u.tcpport&&a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(yE(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}):(u.udpport&&!de("FORCE_TURN_TCP")&&a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.udpport,"?transport=udp")}),u.tcpport&&a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=tcp")}))}),a}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=o=>{var a;return(a=this.onICEConnectionStateChange)===null||a===void 0?void 0:a.call(this,o)},this._p2pConnection.onConnectionStateChange=o=>{var a;return(a=this.onConnectionStateChange)===null||a===void 0?void 0:a.call(this,o)},this._p2pConnection.onDTLSTransportStateChange=o=>{var a;return(a=this.onDTLSTransportStateChange)===null||a===void 0?void 0:a.call(this,o)},this._p2pConnection.onDTLSTransportError=o=>{var a;return(a=this.onDTLSTransportError)===null||a===void 0?void 0:a.call(this,o)},this._p2pConnection.onICETransportStateChange=o=>{var a;return(a=this.onICETransportStateChange)===null||a===void 0?void 0:a.call(this,o)},this._p2pConnection.onFirstAudioReceived=o=>{var a;return(a=this.onFirstAudioReceived)===null||a===void 0?void 0:a.call(this,o)},this._p2pConnection.onFirstVideoReceived=o=>{var a;return(a=this.onFirstVideoReceived)===null||a===void 0?void 0:a.call(this,o)},this._p2pConnection.onFirstAudioDecoded=o=>{var a;return(a=this.onFirstAudioDecoded)===null||a===void 0?void 0:a.call(this,o)},this._p2pConnection.onFirstVideoDecoded=(o,a,u)=>{var h;return(h=this.onFirstVideoDecoded)===null||h===void 0?void 0:h.call(this,o,a,u)},this._p2pConnection.onFirstVideoDecodedTimeout=o=>{var a;return(a=this.onFirstVideoDecodedTimeout)===null||a===void 0?void 0:a.call(this,o)},this._p2pConnection.onSelectedLocalCandidateChanged=(o,a)=>{var u;return(u=this.onSelectedLocalCandidateChanged)===null||u===void 0?void 0:u.call(this,o,a)},this._p2pConnection.onSelectedRemoteCandidateChanged=(o,a)=>{var u;return(u=this.onSelectedRemoteCandidateChanged)===null||u===void 0?void 0:u.call(this,o,a)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(o){o.onConnectionStateChange=void 0,o.onICEConnectionStateChange=void 0,o.onICETransportStateChange=void 0,o.onDTLSTransportStateChange=void 0,o.onDTLSTransportError=void 0,o.onFirstAudioDecoded=void 0,o.onFirstAudioReceived=void 0,o.onFirstVideoDecoded=void 0,o.onFirstVideoReceived=void 0,o.onSelectedLocalCandidateChanged=void 0,o.onSelectedRemoteCandidateChanged=void 0,o.onFirstVideoDecodedTimeout=void 0}setConfiguration(o){this._p2pConnection.setConfiguration(o)}}).prototype,"connect",[sa],Object.getOwnPropertyDescriptor(Cn.prototype,"connect"),Cn.prototype),Ne(Cn.prototype,"receive",[sa],Object.getOwnPropertyDescriptor(Cn.prototype,"receive"),Cn.prototype),Ne(Cn.prototype,"stopReceiving",[sa],Object.getOwnPropertyDescriptor(Cn.prototype,"stopReceiving"),Cn.prototype),Ne(Cn.prototype,"muteRemote",[sa],Object.getOwnPropertyDescriptor(Cn.prototype,"muteRemote"),Cn.prototype),Ne(Cn.prototype,"unmuteRemote",[sa],Object.getOwnPropertyDescriptor(Cn.prototype,"unmuteRemote"),Cn.prototype),Ne(Cn.prototype,"muteLocal",[sa],Object.getOwnPropertyDescriptor(Cn.prototype,"muteLocal"),Cn.prototype),Ne(Cn.prototype,"unmuteLocal",[sa],Object.getOwnPropertyDescriptor(Cn.prototype,"unmuteLocal"),Cn.prototype),Ne(Cn.prototype,"close",[sa],Object.getOwnPropertyDescriptor(Cn.prototype,"close"),Cn.prototype),Ne(Cn.prototype,"updateEncoderConfig",[sa],Object.getOwnPropertyDescriptor(Cn.prototype,"updateEncoderConfig"),Cn.prototype),Ne(Cn.prototype,"updateSendParameters",[sa],Object.getOwnPropertyDescriptor(Cn.prototype,"updateSendParameters"),Cn.prototype),Ne(Cn.prototype,"replaceTrack",[sa],Object.getOwnPropertyDescriptor(Cn.prototype,"replaceTrack"),Cn.prototype),Ne(Cn.prototype,"getRemoteSSRC",[sa],Object.getOwnPropertyDescriptor(Cn.prototype,"getRemoteSSRC"),Cn.prototype),Cn);function sa(r,o,a){const u=r[o];if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){const h=this.mutex,g=await h.lock("From DataChannelConnection.".concat(o));try{for(var E=arguments.length,S=new Array(E),T=0;T<E;T++)S[T]=arguments[T];return await u.apply(this,S)}finally{g()}},a}var Qt;function e4(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function $u(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?e4(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):e4(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}function pT(r){var o,a,u,h=2;for(typeof Symbol<"u"&&(a=fP,u=Symbol.iterator);h--;){if(a&&(o=r[a])!=null)return o.call(r);if(u&&(o=r[u])!=null)return new fT(o.call(r));a="@@asyncIterator",u="@@iterator"}throw new TypeError("Object is not async iterable")}function fT(r){function o(a){if(Object(a)!==a)return Je.reject(new TypeError(a+" is not an object."));var u=a.done;return Je.resolve(a.value).then(function(h){return{value:h,done:u}})}return(fT=function(a){this.s=a,this.n=a.next}).prototype={s:null,n:null,next:function(){return o(this.n.apply(this.s,arguments))},return:function(a){var u=this.s.return;return u===void 0?Je.resolve({value:a,done:!0}):o(u.apply(this.s,arguments))},throw:function(a){var u=this.s.return;return u===void 0?Je.reject(a):o(u.apply(this.s,arguments))}},new fT(r)}let Jq=(Ne((Qt=class extends Qn{get state(){return this._state}set state(r){const o=this._state;this._state=r,this.emit(Jt.StateChange,o,this._state)}constructor(r,o){super(),k(this,"store",void 0),k(this,"statsUploader",void 0),k(this,"connection",void 0),k(this,"localTrackMap",new Map),k(this,"remoteUserMap",new Map),k(this,"pendingLocalTracks",[]),k(this,"pendingRemoteTracks",[]),k(this,"statsCollector",void 0),k(this,"isPlanB",!1),k(this,"shouldForwardP2PCreation",void 0),k(this,"iceFailedCount",0),k(this,"dtlsFailedCount",0),k(this,"mutex",new js("P2PChannel-mutex")),k(this,"_state",xr.Disconnected),k(this,"handleMuteLocalTrack",async(a,u,h)=>{const g=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==xr.Connected)return void h(new Q(K.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const E=this.filterTobeMutedTracks(a);if(E.length===0)return void u();const S=E.find(C=>C[0]==="videoLowTrack");S&&S[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(E.map(C=>{let[,{id:w}]=C;return w}));const T=this.createMuteMessage(E);await er(this,Jt.RequestMuteLocal,T),u()}catch(E){h(E)}finally{g()}}),k(this,"handleUnmuteLocalTrack",async(a,u,h)=>{const g=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==xr.Connected)return void h(new Q(K.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const E=this.filterTobeUnmutedTracks(a);if(E.length===0)return void u();const S=E.find(C=>C[0]==="videoLowTrack");if(S){const C=S[1];if(C.track._originMediaStreamTrack.stop(),ns().supportDualStreamEncoding){const w=a._mediaStreamTrack.clone();C.track._mediaStreamTrack=w,C.track._originMediaStreamTrack=w}else{const w=MP(a,Ql(this,Jt.RequestLowStreamParameter));C.track._mediaStreamTrack=w,C.track._originMediaStreamTrack=w}await new Je((w,N)=>{this.handleReplaceTrack(C.track,w,N,!0)})}await this.connection.unmuteLocal(E.map(C=>{let[,{id:w}]=C;return w}));const T=this.createUnmuteMessage(E);await er(this,Jt.RequestUnmuteLocal,T),u()}catch(E){h(E)}finally{g()}}),k(this,"handleUpdateVideoEncoder",async(a,u,h)=>{const g=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const E=this.localTrackMap.get(Qe.LocalVideoTrack);if(!this.connection||!E||E.track!==a||this.state!==xr.Connected)return void u();const{id:S,track:T}=E;await this.connection.updateSendParameters(S,T),await this.connection.updateEncoderConfig(S,T),this.emit(Jt.UpdateVideoEncoder,T),u()}catch(E){h(E)}finally{g()}}),k(this,"handleSetOptimizationMode",async(a,u,h)=>{const g=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const E=this.localTrackMap.get(Qe.LocalVideoTrack);if(!this.connection||!E||E.track!==a||this.state!==xr.Connected)return;const{id:S,track:T}=E;await this.connection.updateSendParameters(S,T),u()}catch(E){h(E)}finally{g()}}),k(this,"handleReplaceTrack",async(a,u,h,g)=>{let E;F.debug("P2PChannel handleReplaceTrack for [track-id-".concat(a.getTrackId(),"]")),typeof g=="boolean"&&g||(E=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var S;const C=Array.from(this.localTrackMap.entries()).find(w=>{let[,{track:N}]=w;return a===N});if(!this.connection||!C||this.state!==xr.Connected)return void u();if(await((S=this.connection)===null||S===void 0?void 0:S.replaceTrack(a,C[1].id)),this.isPlanB){const w=C[1];w.id=a._mediaStreamTrack.id,this.localTrackMap.set(C[0],w)}if(C[0]===Qe.LocalVideoTrack&&ns().supportDualStreamEncoding){const w=this.localTrackMap.get(Qe.LocalVideoLowTrack);if(w){const N=a._mediaStreamTrack.clone();w.track._originMediaStreamTrack.stop(),w.track._mediaStreamTrack=N,w.track._originMediaStreamTrack=N,await new Je((M,U)=>{this.handleReplaceTrack(w.track,M,U,!0)})}}u()}catch(C){h(C)}finally{var T;(T=E)===null||T===void 0||T()}}),k(this,"handleGetLocalVideoStats",a=>{a(this.statsCollector.getLocalVideoTrackStats())}),k(this,"handleGetLocalAudioStats",a=>{a(this.statsCollector.getLocalAudioTrackStats())}),k(this,"handleGetRemoteVideoStats",a=>this.statsCollector.getRemoteVideoTrackStats(a.uid)[a.uid]),k(this,"handleGetRemoteAudioStats",a=>this.statsCollector.getRemoteAudioTrackStats(a.uid)[a.uid]),this.store=r,this.statsCollector=o,this.statsCollector.addP2PChannel(this),this.statsUploader=new qq,this.bindStatsUploaderEvents(),this.isPlanB=!ns().supportUnifiedPlan||de("CHROME_FORCE_PLAN_B")&&Gl(),this.shouldForwardP2PCreation=de("FORWARD_P2P_CREATION")&&ns().supportPCSetConfiguration,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Mu({},this.store):this.isPlanB?new Mf({},this.store):new $f({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(r,o){if(this.state=xr.New,this.shouldForwardP2PCreation||(this.connection=this.store.useDataChannel?new Mu(r,this.store):this.isPlanB?new Mf(r,this.store):new $f(r,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new Q(K.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this.connection.setConfiguration(r),this.connection.establishPromise}async connect(r,o,a,u,h,g){if(!this.connection)throw new Q(K.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof Mu?this.connection.updateRemoteConnect(u):(this.store.peerConnectionStart(),await this.connection.connect(r,o,a,u,h,g),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=xr.Connected)}async preConnect(r,o,a,u,h,g){if(!this.connection)throw new Q(K.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const E=await this.connection.connect(r,o,a,u,h,g);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=xr.Connected,E}getEstablishParams(){if(this.connection instanceof Mu)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(r,o,a){var u=this;return na(function*(){const h=yield Ft(u.mutex.lock("From P2PChannel.publish"));try{if(!u.connection||u.state!==xr.Connected){if(u.state===xr.Disconnected)throw new Q(K.UNEXPECTED_ERROR,"PeerConnection already disconnected.");u.throwIfTrackTypeNotMatch(r);const E=r.filter(S=>u.pendingLocalTracks.indexOf(S)===-1);return void(u.pendingLocalTracks=u.pendingLocalTracks.concat(E))}u.store.pubId=u.store.pubId+1,Ni.markPublishStart(u.store.clientId,u.store.pubId);const g=u.filterTobePublishedTracks(r,o,a);if(g.length===0)return void(yield Ft(u.tryToUnmuteAudio(r)));yield*Df(pT(u.doPublish(u.connection,g)),Ft)}finally{h()}})()}doPublish(r,o){var a=this;return na(function*(){o.forEach(C=>{let{track:w,type:N}=C;const M=Date.now();a.store.publish(w.getTrackId(),N===Qe.LocalAudioTrack?"audio":"video",M)}),a.bindLocalTrackEvents(o);const u=yield Ft(r.send(o.map(C=>{let{track:w}=C;return w}),a.store.codec,a.store.audioCodec)),h=(yield Ft(u.next())).value,g=a.createGatewayPublishMessage(o,h);let E;try{E=yield g}catch(C){throw u.throw(C),(C==null?void 0:C.code)===K.WS_ABORT&&o.forEach(w=>{let{track:N}=w;a.pendingLocalTracks.indexOf(N)===-1&&a.pendingLocalTracks.push(N)}),a.unbindLocalTrackEvents(o),C}const S=a.mapPubResToRemoteConfig(g,E),T=(yield Ft(u.next(S))).value;o.forEach(C=>{let{type:w}=C;a.statsCollector.addLocalStats(w)}),a.assignLocalTracks(o,T),a.statsUploader.startUploadUplinkStats(),o.forEach(C=>{let{track:w,type:N}=C;const M=Date.now();a.store.publish(w.getTrackId(),N===Qe.LocalAudioTrack?"audio":"video",void 0,M)})})()}publishLowStream(r){var o=this;return na(function*(){if(!o.connection||o.state!==xr.Connected)return;const a=yield Ft(o.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const h=o.localTrackMap.get(Qe.LocalVideoTrack);if(!h)throw new Q(K.UNEXPECTED_ERROR,"Could not find high stream");if(o.localTrackMap.has(Qe.LocalVideoLowTrack))throw new Q(K.UNEXPECTED_ERROR,"[".concat(o.store.clientId,"] Can't publish low stream when stream already publish"));const g=[{track:o.getLowVideoTrack(h.track,r),type:Qe.LocalVideoLowTrack}];if(yield*Df(pT(o.doPublish(o.connection,g)),Ft),h.track.muted||!h.track.enabled){var u;const E=(u=o.localTrackMap.get(Qe.LocalVideoLowTrack))===null||u===void 0?void 0:u.id;E!==void 0&&(yield Ft(o.connection.muteLocal([E])))}}finally{a()}})()}async republish(){this.pendingLocalTracks.length>0&&(F.debug("Emit P2PChannelEvents.RequestRePublish to republish tracks."),await Ss(this,Jt.RequestRePublish,this.pendingLocalTracks),this.emit(Jt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(r){for(let o=this.pendingRemoteTracks.length-1;o>=0;o--){const{user:a,kind:u}=this.pendingRemoteTracks[o];(u!==Ot.AUDIO||a._audio_added_&&a._audioSSRC)&&(u!==Ot.VIDEO||a._video_added_&&a._videoSSRC)||this.pendingRemoteTracks.splice(o,1)}if(r)await Ss(this,Jt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:o,kind:a}of this.pendingRemoteTracks)await this.subscribe(o,a,a===Ot.VIDEO?o._videoSSRC:o._audioSSRC);this.pendingRemoteTracks.forEach(o=>{let{user:a}=o;this.emit(Jt.MediaReconnectEnd,a.uid)}),this.pendingRemoteTracks=[]}async unpublish(r){if(!this.connection||this.state!==xr.Connected)return void r.forEach(u=>{const h=this.pendingLocalTracks.indexOf(u);h!==-1&&this.pendingLocalTracks.splice(h,1)});const o=this.filterTobeUnpublishedTracks(r);if(o.length===0)return;const a=o.find(u=>u[0]==="videoLowTrack");return a&&a[1].track.close(),this.doUnpublish(this.connection,o)}async unpublishLowStream(){if(!this.connection||this.state!==xr.Connected)return;const r=this.localTrackMap.get(Qe.LocalVideoLowTrack);if(!r)return;r.track.close();const o=[[Qe.LocalVideoLowTrack,r]];return this.doUnpublish(this.connection,o)}async doUnpublish(r,o){const a=this.createGatewayUnpublishMessage(o);return await r.stopSending(o.map(u=>{let[,{id:h}]=u;return h})),this.withdrawLocalTracks(o),this.unbindLocalTrackEvents(o.map(u=>{let[h,{track:g}]=u;return{type:h,track:g}})),o.forEach(u=>{let[h]=u;this.statsCollector.removeLocalStats(h)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),a}async subscribe(r,o,a,u,h){var g;if(!this.connection||this.state!==xr.Connected)throw new Q(K.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((g=this.remoteUserMap.get(r))!==null&&g!==void 0&&g.has(o))return;let E,S;if(h){const w=h.find(M=>{let{stream_type:U}=M;return U===o});if(!w)throw new Q(K.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(o," for user: ").concat(r.uid," because subscribe answer from gateway does not contain stream_type: ").concat(o,"."));const N=await this.connection.receive(o,w.ssrcs,String(r._uintid),w.attributes);E=N.track,S=N.id}else{const w=await this.connection.receive(o,[{ssrcId:a,rtx:u}],String(r._uintid),void 0);E=w.track,S=w.id}o===Ot.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(E):(r._audioTrack=new ME(E,r.uid,r._uintid,this.store),F.info("[".concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(E):(r._videoTrack=new LE(E,r.uid,r._uintid,this.store),F.info("[".concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(r,r._videoTrack));const T=this.remoteUserMap.get(r);T?T.set(o,S):this.remoteUserMap.set(r,new Map([[o,S]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadDownlinkStats();const C=this.pendingRemoteTracks.findIndex(w=>{let{user:N,kind:M}=w;return N.uid===r.uid&&o===M});C!==-1&&(this.pendingRemoteTracks.splice(C,1),this.emit(Jt.MediaReconnectEnd,r.uid))}async massSubscribe(r){return this.massSubscribeNoLock(r)}async massSubscribeNoLock(r){if(!this.connection||this.state!==xr.Connected)throw new Q(K.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");r=r.filter(a=>{var u;let{user:h,mediaType:g}=a;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(g))});const o=await this.connection.batchReceive(r.map(a=>{let{user:u,mediaType:h,ssrcId:g,rtxSsrcId:E}=a;return{kind:h,ssrcMsg:[{ssrcId:g,rtx:E}],mslabel:String(u._uintid)}}));r.forEach((a,u)=>{let{user:h,mediaType:g}=a;const{track:E,id:S}=o[u];g===Ot.AUDIO?(h._audioTrack?h._audioTrack._updateOriginMediaStreamTrack(E):(h._audioTrack=new ME(E,h.uid,h._uintid,this.store),F.info("[".concat(this.store.p2pId,"] create remote audio track: ").concat(h._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(h,h._audioTrack)):(h._videoTrack?h._videoTrack._updateOriginMediaStreamTrack(E):(h._videoTrack=new LE(E,h.uid,h._uintid,this.store),F.info("[".concat(this.store.p2pId,"] create remote video track: ").concat(h._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(h,h._videoTrack));const T=this.remoteUserMap.get(h);T?T.set(g,S):this.remoteUserMap.set(h,new Map([[g,S]])),this.statsCollector.addRemoteStats(h.uid),this.statsUploader.startUploadDownlinkStats();const C=this.pendingRemoteTracks.findIndex(w=>{let{user:N,kind:M}=w;return N.uid===h.uid&&g===M});C!==-1&&(this.pendingRemoteTracks.splice(C,1),this.emit(Jt.MediaReconnectEnd,h.uid))})}async unsubscribe(r,o,a){const u=this.pendingRemoteTracks.filter(E=>{let{user:S,kind:T}=E;return o!==void 0?S.uid===r.uid&&o===T:S.uid===r.uid});if(u.forEach(E=>{const S=this.pendingRemoteTracks.indexOf(E);this.pendingRemoteTracks.splice(S,1)}),this.connection&&this.state===xr.Connected||a||u.forEach(E=>{let{kind:S}=E;var T;if(S===Ot.AUDIO)(T=r._audioTrack)===null||T===void 0||T._destroy(),r._audioTrack=void 0;else if(S===Ot.VIDEO){var C;(C=r._videoTrack)===null||C===void 0||C._destroy(),r._videoTrack=void 0}}),!this.connection||this.state!==xr.Connected)return;const h=this.filterTobeUnSubscribedTracks(r,o);if(h.length===0)return;await this.connection.stopReceiving(h.map(E=>{let[,{id:S}]=E;return S}));const g=this.createUnsubscribeMessage(h);return this.withdrawRemoteTracks(h),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),h.forEach(E=>{let[S,{kind:T}]=E;var C,w;if(T===Ot.VIDEO&&S._videoSSRC&&((C=this.connection)===null||C===void 0||C.setStatsRemoteVideoIsReady(S._videoSSRC,!1)),T===Ot.VIDEO)this.unbindRemoteTrackEvents(S._videoTrack),a||((w=S._videoTrack)===null||w===void 0||w._destroy(),S._videoTrack=void 0);else if(T===Ot.AUDIO){var N;this.unbindRemoteTrackEvents(S._audioTrack),!a&&((N=S._audioTrack)===null||N===void 0||N._destroy(),S._audioTrack=void 0)}}),g}async massUnsubscribe(r){return this.massUnsubscribeNoLock(r)}async massUnsubscribeNoLock(r){let o=[];for(const{user:h,mediaType:g}of r){const E=this.pendingRemoteTracks.filter(S=>{let{user:T,kind:C}=S;return g!==void 0?T.uid===h.uid&&g===C:T.uid===h.uid});E.forEach(S=>{const T=this.pendingRemoteTracks.indexOf(S);this.pendingRemoteTracks.splice(T,1)}),o=o.concat(E)}if(!this.connection||this.state!==xr.Connected)return void o.forEach(h=>{let{user:g,kind:E}=h;var S;if(E===Ot.AUDIO)(S=g._audioTrack)===null||S===void 0||S._destroy(),g._audioTrack=void 0;else if(E===Ot.VIDEO){var T;(T=g._videoTrack)===null||T===void 0||T._destroy(),g._videoTrack=void 0}});const a=Iu(r).call(r,(h,g)=>{let{user:E,mediaType:S}=g;const T=this.filterTobeUnSubscribedTracks(E,S);return h.concat(T)},[]);if(a.length===0)return;await this.connection.stopReceiving(a.map(h=>{let[,{id:g}]=h;return g}));const u=this.createUnsubscribeAllMessage(a);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),a.forEach(h=>{let[g,{kind:E}]=h;var S,T;if(E===Ot.VIDEO&&g._videoSSRC&&((S=this.connection)===null||S===void 0||S.setStatsRemoteVideoIsReady(g._videoSSRC,!1)),E===Ot.VIDEO)this.unbindRemoteTrackEvents(g._videoTrack),(T=g._videoTrack)===null||T===void 0||T._destroy(),g._videoTrack=void 0;else if(E===Ot.AUDIO){var C;this.unbindRemoteTrackEvents(g._audioTrack),(C=g._audioTrack)===null||C===void 0||C._destroy(),g._audioTrack=void 0}}),u}async muteRemote(r,o){if(!this.connection)return;const a=this.remoteUserMap.get(r);if(!a)return void F.warning("P2PChannel.muteRemote has no remote user ".concat(r.uid,"."));if(!a.get(o))return void F.warning("P2PChannel.muteRemote has no remote user ".concat(r.uid," media type ").concat(o,"."));const u=o===Ot.VIDEO?r._videoSSRC:r._audioSSRC;u!==void 0&&this.connection.setStatsRemoteVideoIsReady(u,!1)}async unmuteRemote(r,o){return this.unmuteRemoteNoLock(r,o)}async unmuteRemoteNoLock(r,o){if(!this.connection)return;const a=this.remoteUserMap.get(r);if(!a)return void F.warning("P2PChannel.unmuteRemote has no remote user ".concat(r.uid,"."));a.get(o)||F.warning("P2PChannel.unmuteRemote has no remote user ".concat(r.uid," media type ").concat(o,"."))}getAllTracks(r){const o=this.localTrackMap.get(Qe.LocalAudioTrack);if((o==null?void 0:o.track)instanceof bi){const a=o.track;return Array.from(this.localTrackMap.entries()).filter(u=>{let[h]=u;return h!==Qe.LocalAudioTrack}).filter(u=>{let[h]=u;return!(r&&h===Qe.LocalVideoLowTrack)}).map(u=>{let[,{track:h}]=u;return h}).concat(a.trackList)}return Array.from(this.localTrackMap.entries()).filter(a=>{let[u]=a;return!(r&&u===Qe.LocalVideoLowTrack)}).map(a=>{let[,{track:u}]=a;return u})}reportPublishEvent(r,o,a,u,h){if(r){const E=this.localTrackMap.get(Qe.LocalAudioTrack),S=u?this.localTrackMap.get(Qe.LocalVideoLowTrack):this.localTrackMap.get(Qe.LocalVideoTrack);at.publish(this.store.sessionId,{eventElapse:Ni.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:o,audioName:E==null?void 0:E.track.getTrackLabel(),videoName:S==null?void 0:S.track.getTrackLabel(),screenshare:(S==null?void 0:S.track._hints.indexOf(ts.SCREEN_TRACK))!==-1,audio:!!E,video:!!S,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:h})}else{var g;a||(a=[]);const E=a.find(T=>T instanceof ys),S=u?(g=this.localTrackMap.get(Qe.LocalVideoTrack))===null||g===void 0?void 0:g.track:a.find(T=>T instanceof dr);at.publish(this.store.sessionId,{eventElapse:Ni.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:o,audioName:E==null?void 0:E.getTrackLabel(),videoName:S==null?void 0:S.getTrackLabel(),screenshare:(S==null?void 0:S._hints.indexOf(ts.SCREEN_TRACK))!==-1,audio:!!E,video:!!S,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:h})}}reportSubscribeEvent(r,o,a,u){const h=u===Ot.VIDEO?a._videoSSRC:a._audioSSRC;h&&at.subscribe(this.store.sessionId,{succ:r,ec:o,video:u===Ot.VIDEO,audio:u===Ot.AUDIO,peerid:a.uid,subscribeRequestid:u===Ot.VIDEO?a._videoSSRC:a._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ni.measureFromSubscribeStart(this.store.clientId,h)})}reset(){F.debug("P2PChannel.reset"),this.mutex=new js("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Mu({},this.store):this.isPlanB?new Mf({},this.store):new $f({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=xr.Disconnected}getStats(){var r;return(r=this.connection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(r){var o;return((o=this.connection)===null||o===void 0?void 0:o.getRemoteVideoIsReady(r))||!1}getLocalAudioVolume(){const r=this.localTrackMap.get(Qe.LocalAudioTrack);if(r)return r.track.getVolumeLevel()}getLocalVideoSize(){const r=this.localTrackMap.get(Qe.LocalVideoTrack);if(r)return{width:r.track._videoWidth||0,height:r.track._videoHeight||0}}getEncoderConfig(r){const o=this.localTrackMap.get(r);return o&&o.track instanceof dr||o&&o.track instanceof ys?o.track._encoderConfig:void 0}getLocalMedia(r){return this.localTrackMap.get(r)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(r,o){if(!r)return this.remoteUserMap.size>0;const a=this.remoteUserMap.get(r);return!!a&&(!o||a.has(o))}async hasRemoteMediaWithLock(r,o){if(!r)return this.remoteUserMap.size>0;const a=this.remoteUserMap.get(r);return!!a&&(!o||a.has(o))}getRemoteMedia(r){var o;const a=Array.from(ql(o=this.remoteUserMap).call(o)).find(u=>u.uid===r);return a?{audioTrack:a.audioTrack,audioSSRC:a._audioSSRC,videoTrack:a.videoTrack,videoSSRC:a._videoSSRC}:{}}getAudioLevels(){let r=Array.from(this.remoteUserMap.entries()).map(a=>{let[u]=a;return{uid:u.uid,level:u.audioTrack?100*u.audioTrack._source.getAccurateVolumeLevel():0}});const o=this.localTrackMap.get(Qe.LocalAudioTrack);return o&&r.push({level:100*o.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),r=Zv(r).call(r,(a,u)=>a.level-u.level),r}async disconnectForReconnect(){this.connection&&(F.debug("P2PChannel.disconnectForReconnect closing P2PConnection"),this.state=xr.Reconnecting,de("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(r=>{var o,a,u,h;let[g]=r;(o=g._videoTrack)===null||o===void 0||(a=o._player)===null||a===void 0||(u=a.getVideoElement())===null||u===void 0||u.pause(),(h=g._videoTrack)===null||h===void 0||h._originMediaStreamTrack.stop()}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Mu({},this.store):this.isPlanB?new Mf({},this.store):new $f({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(r=>{let[o,{track:a}]=r;switch(o){case Qe.LocalVideoTrack:a._hints.includes(ts.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Qe.LocalAudioTrack:a instanceof bi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);break;case Qe.LocalVideoLowTrack:}}),this.emit(Jt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(r=>{let[o,a]=r;Array.from(ql(a).call(a)).forEach(u=>{this.setPendingRemoteMedia(o,u)}),this.emit(Jt.MediaReconnectStart,o.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),F.debug("P2PChannel disconnected, waiting to reconnect."))}hasPendingRemoteMedia(r,o){for(const a of this.pendingRemoteTracks){const{user:u,kind:h}=a;if((r instanceof US?r.uid:r)===u.uid&&o===h)return!0}return!1}setPendingRemoteMedia(r,o){this.hasPendingRemoteMedia(r,o)||this.pendingRemoteTracks.push({user:r,kind:o})}restartICE(){var r=this;return na(function*(){if(!r.connection||r.state!==xr.Connected||r.connection instanceof Mu)return;const o=yield Ft(r.mutex.lock("From P2PChannel.restartICE"));try{yield*Df(pT(r.connection.restartICE()),Ft)}finally{o()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const r=this.connection.getStats(),o=this.localTrackMap.get(Qe.LocalVideoTrack),a=this.localTrackMap.get(Qe.LocalAudioTrack),u=r.videoSend.find(U=>U.ssrc===(o==null?void 0:o.ssrcs[0].ssrcId)),h=r.audioSend.find(U=>U.ssrc===(a==null?void 0:a.ssrcs[0].ssrcId));if(!u||!h)return 1;const g=ic(this,Jt.NeedSignalRTT),E=u?u.rttMs:void 0,S=h?h.rttMs:void 0,T=E&&S?(E+S)/2:E||S,C=(T&&g?(T+g)/2:T||g)||0,w=100*r.sendPacketLossRate*.7/50+.3*C/1500,N=w<.17?1:w<.36?2:w<.59?3:w<.1?4:5,M=o==null?void 0:o.track;if(M&&M._encoderConfig&&M._hints.indexOf(ts.SCREEN_TRACK)===-1){const U=M._encoderConfig.bitrateMax,Y=r.bitrate.actualEncoded;if(U&&Y){const X=(1e3*U-Y)/(1e3*U);return Nz[X<.15?0:X<.3?1:X<.45?2:X<.6?3:4][N]}}return N}getDownlinkNetworkQuality(){if(!this.connection)return 0;const r=this.connection.getStats();let o=0;return Array.from(this.remoteUserMap.entries()).forEach(a=>{let[u]=a;const h=u._audioSSRC,g=u._videoSSRC,E=r.audioRecv.find(Y=>Y.ssrc===h),S=r.videoRecv.find(Y=>Y.ssrc===g);if(!E&&!S)return void(o+=1);const T=ic(this,Jt.NeedSignalRTT),C=r.rtt,w=(C&&T?(C+T)/2:C||T)||0,N=E?E.jitterMs:void 0,M=r.recvPacketLossRate;let U=.7*M*100/50+.3*w/1500;N&&(U=.6*M*100/50+.2*w/1500+.2*N/400),o+=U<.1?1:U<.17?2:U<.36?3:U<.59?4:5}),this.remoteUserMap.size>0?Math.round(o/this.remoteUserMap.size):o}async muteLocalTrack(r){return new Je((o,a)=>{this.handleMuteLocalTrack(r,o,a)})}filterTobePublishedTracks(r,o,a){const u=[],h=ns(),g=this.getAllTracks();r=v3(r=r.filter(T=>g.indexOf(T)===-1));let E=!1,S=!1;for(const T of r){if(T instanceof dr&&(this.localTrackMap.has(Qe.LocalVideoTrack)||E?new Q(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(u.push({track:T,type:Qe.LocalVideoTrack}),E=!0),o)){const C=this.getLowVideoTrack(T,a);u.push({track:C,type:Qe.LocalVideoLowTrack})}if(T instanceof ys){const C=this.localTrackMap.get(Qe.LocalAudioTrack);if(C){if(!(C.track instanceof bi))throw new Q(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(T._bypassWebAudio)throw new Q(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");C.track.addAudioTrack(T),this.bindLocalAudioTrackEvents(T,!0)}else if(S){const w=u.find(N=>{let{type:M}=N;return M===Qe.LocalAudioTrack});if(!(w.track instanceof bi))throw new Q(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(T._bypassWebAudio)throw new Q(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");w.track.addAudioTrack(T)}else{if(!h.webAudioMediaStreamDest||T instanceof bi||T._bypassWebAudio)u.push({track:T,type:Qe.LocalAudioTrack});else{const w=new bi;w.addAudioTrack(T),u.push({track:w,type:Qe.LocalAudioTrack})}S=!0}}}return u}filterTobeUnpublishedTracks(r){const o=[],a=this.getAllTracks();r=v3(r=r.filter(u=>a.indexOf(u)!==-1));for(const u of r){if(u instanceof ys){const h=this.localTrackMap.get(Qe.LocalAudioTrack);if(!h)continue;h.track instanceof bi?(h.track.removeAudioTrack(u),this.unbindLocalAudioTrackEvents(u),h.track.trackList.length===0&&(o.push([Qe.LocalAudioTrack,h]),h.track.close())):o.push([Qe.LocalAudioTrack,h])}if(u instanceof dr){const h=this.localTrackMap.get(Qe.LocalVideoTrack);if(!h)continue;o.push([Qe.LocalVideoTrack,h]);const g=this.localTrackMap.get(Qe.LocalVideoLowTrack);g&&o.push([Qe.LocalVideoLowTrack,g])}}return o}bindLocalTrackEvents(r){r.forEach(o=>{let{track:a,type:u}=o;switch(u){case Qe.LocalVideoTrack:a.addListener(yt.GET_STATS,this.handleGetLocalVideoStats),a.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.addListener(yt.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Qe.LocalAudioTrack:this.bindLocalAudioTrackEvents(a);break;case Qe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(r,o){r instanceof bi?r.trackList.forEach(a=>{a.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),a.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.addListener(yt.GET_STATS,this.handleGetLocalAudioStats),r.addListener(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),o||r.addListener(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(r){r||(r=Array.from(this.localTrackMap.entries()).map(o=>{let[a,{track:u}]=o;return{track:u,type:a}})),r.forEach(o=>{let{track:a,type:u}=o;switch(u){case Qe.LocalVideoTrack:a.off(yt.GET_STATS,this.handleGetLocalVideoStats),a.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),a.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),a.off(yt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),a.off(yt.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),a.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),a.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),a.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Qe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(a);break;case Qe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(r){r instanceof bi?r.trackList.forEach(o=>{o.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(yt.GET_STATS,this.handleGetLocalAudioStats),o.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.off(yt.GET_STATS,this.handleGetLocalAudioStats),r.off(yt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(yt.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(yt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(yt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(r,o){o instanceof LE&&o.addListener(yt.GET_STATS,a=>{a(this.handleGetRemoteVideoStats(r))}),o instanceof ME&&o.addListener(yt.GET_STATS,a=>{a(this.handleGetRemoteAudioStats(r))})}unbindRemoteTrackEvents(r){r&&r.removeAllListeners(yt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(r=>{let[o,a]=r;a.has(Ot.AUDIO)&&this.unbindRemoteTrackEvents(o._audioTrack),a.has(Ot.VIDEO)&&this.unbindRemoteTrackEvents(o._videoTrack)})}createGatewayPublishMessage(r,o){return r.map((a,u)=>{let h,g,{track:E,type:S}=a;switch(S){case Qe.LocalAudioTrack:h=Tr.Audio,g={dtx:E instanceof EE&&E._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Qe.LocalVideoTrack:h=E._hints.includes(ts.SCREEN_TRACK)?Tr.Screen:Tr.High,g=$u($u({},m3(E)),{},{codec:this.store.codec});break;case Qe.LocalVideoLowTrack:h=Tr.Low,g=$u($u({},m3(E)),{},{codec:this.store.codec})}return{stream_type:h,attributes:g,ssrcs:o[u]}})}createGatewayUnpublishMessage(r){return r.map(o=>{let a,[u,{track:h,ssrcs:g,id:E}]=o;switch(u){case Qe.LocalVideoTrack:a=h._hints.includes(ts.SCREEN_TRACK)?Tr.Screen:Tr.High;break;case Qe.LocalAudioTrack:a=Tr.Audio;break;case Qe.LocalVideoLowTrack:a=Tr.Low}return{stream_type:a,ssrcs:g,mid:E}})}assignLocalTracks(r,o){r.forEach((a,u)=>{let{track:h,type:g}=a;this.localTrackMap.set(g,{track:h,id:o[u].id,ssrcs:o[u].localSSRC})})}withdrawLocalTracks(r){r.forEach(o=>{let[a]=o;this.localTrackMap.delete(a)})}bindConnectionEvents(r){r.onConnectionStateChange=async o=>{if(F.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(o,")")),this.emit(Jt.PeerConnectionStateChange,o),o!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),o==="disconnected"&&r.iceConnectionState==="disconnected")return setTimeout(()=>{r.iceConnectionState==="disconnected"&&de("ICE_RESTART")&&ic(this,Jt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Jt.RequestRestartICE)},800),void setTimeout(()=>{r.peerConnectionState==="disconnected"&&(F.debug("P2PConnection disconnected timeout 4000ms, force reconnect"),setTimeout(()=>this.emit(Jt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);o==="failed"&&(F.debug("P2PConnection state failed, force reconnect"),setTimeout(()=>this.emit(Jt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())},r.onICEConnectionStateChange=o=>{o!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),F.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(o,")")),at.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:o,tag:jn.TRACER}).onSuccess(),this.emit(Jt.IceConnectionStateChange,o)},r.onICETransportStateChange=o=>{F.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(o,")"))},r.onDTLSTransportStateChange=o=>{F.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(o,")"))},r.onDTLSTransportError=o=>{F.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(o,")"))},r.onFirstAudioDecoded=o=>{var a;const u=Array.from(ql(a=this.remoteUserMap).call(a)).find(g=>g._audioSSRC===o);var h;u&&(this.store.subscribe(u.uid,"audio",void 0,void 0,void 0,Date.now()),(h=u.audioTrack)===null||h===void 0||h.emit(Rh.FIRST_FRAME_DECODED),at.firstRemoteFrame(this.store.sessionId,gs.FIRST_AUDIO_DECODE,zn.FIRST_AUDIO_DECODE,{peer:u._uintid,subscribeElapse:Ni.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId}))},r.onFirstAudioReceived=o=>{var a;const u=Array.from(ql(a=this.remoteUserMap).call(a)).find(h=>h._audioSSRC===o);u&&at.firstRemoteFrame(this.store.sessionId,gs.FIRST_AUDIO_RECEIVED,zn.FIRST_AUDIO_RECEIVED,{peer:u._uintid,subscribeElapse:Ni.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},r.onFirstVideoDecoded=(o,a,u)=>{this.reportVideoFirstFrameDecoded(o,a,u)},r.onFirstVideoReceived=o=>{var a;const u=Array.from(ql(a=this.remoteUserMap).call(a)).find(h=>h._videoSSRC===o);u&&at.firstRemoteFrame(this.store.sessionId,gs.FIRST_VIDEO_RECEIVED,zn.FIRST_VIDEO_RECEIVED,{peer:u._uintid,subscribeElapse:Ni.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},r.onSelectedLocalCandidateChanged=(o,a)=>{const u=o.candidateType==="relay",h=a.candidateType==="relay";a.candidateType!=="unknown"&&u===h||this.emit(Jt.ConnectionTypeChange,u),F.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(vE(a))," -> ").concat(JSON.stringify(vE(o)),")"))},r.onSelectedRemoteCandidateChanged=(o,a)=>{F.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(vE(a))," -> ").concat(JSON.stringify(vE(o)),")"))},r.onFirstVideoDecodedTimeout=o=>{this.reportVideoFirstFrameDecoded(o,void 0,void 0,!0)}}unbindConnectionEvents(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(r){const o=[];if(this.getAllTracks().indexOf(r)===-1)return o;const a=this.localTrackMap.get(Qe.LocalAudioTrack);if(r instanceof ys&&(a==null?void 0:a.track)instanceof bi)return a.track.isActive||o.push([Qe.LocalAudioTrack,a]),o;const u=Array.from(this.localTrackMap.entries()).find(h=>{let[,{track:g}]=h;return r===g});if(u&&(o.push(u),u[0]===Qe.LocalVideoTrack)){const h=this.localTrackMap.get(Qe.LocalVideoLowTrack);h&&o.push([Qe.LocalVideoLowTrack,h])}return o}filterTobeUnmutedTracks(r){const o=[],a=this.localTrackMap.get(Qe.LocalAudioTrack);if(r instanceof ys&&(a==null?void 0:a.track)instanceof bi)return a.track.isActive&&o.push([Qe.LocalAudioTrack,a]),o;const u=Array.from(this.localTrackMap.entries()).find(h=>{let[,{track:g}]=h;return r===g});if(u)if(u[0]===Qe.LocalVideoTrack){o.push(u);const h=this.localTrackMap.get(Qe.LocalVideoLowTrack);h&&o.push([Qe.LocalVideoLowTrack,h])}else o.push(u);return o}createMuteMessage(r){return r.map(o=>{let a,[u,{track:h,ssrcs:g,id:E}]=o;switch(u){case Qe.LocalAudioTrack:a=Tr.Audio;break;case Qe.LocalVideoTrack:a=h._hints.includes(ts.SCREEN_TRACK)?Tr.Screen:Tr.High;break;case Qe.LocalVideoLowTrack:a=Tr.Low}return{stream_type:a,ssrcs:g,mid:E}})}createUnmuteMessage(r){return r.map(o=>{let a,[u,{track:h,ssrcs:g,id:E}]=o;switch(u){case Qe.LocalAudioTrack:a=Tr.Audio;break;case Qe.LocalVideoTrack:a=h._hints.includes(ts.SCREEN_TRACK)?Tr.Screen:Tr.High;break;case Qe.LocalVideoLowTrack:a=Tr.Low}return{stream_type:a,ssrcs:g,mid:E}})}filterTobeUnSubscribedTracks(r,o){const a=[],u=this.remoteUserMap.get(r);if(!u)return a;if(o){const h=u.get(o);if(!h)return a;a.push([r,{kind:o,id:h}])}else Array.from(u.entries()).forEach(h=>{let[g,E]=h;a.push([r,{kind:g,id:E}])});return a}createUnsubscribeMessage(r){const o=[];return r.forEach(a=>{let[u,{kind:h,id:g}]=a;switch(h){case Ot.VIDEO:return void(u._videoSSRC&&o.push({stream_type:Ot.VIDEO,ssrcId:u._videoSSRC}));case Ot.AUDIO:return void(u._audioSSRC&&o.push({stream_type:Ot.AUDIO,ssrcId:u._audioSSRC}))}}),o}createUnsubscribeAllMessage(r){const o=new Map;return r.forEach(a=>{let[u,{kind:h}]=a;if(o.has(u)){let g=o.get(u);h===Ot.VIDEO?g|=cr.Video:g|=cr.Audio,o.set(u,g)}else h===Ot.VIDEO?o.set(u,cr.Video):o.set(u,cr.Audio)}),{users:Array.from(o.entries()).map(a=>{let[u,h]=a;return{stream_id:u.uid,stream_type:h}})}}withdrawRemoteTracks(r){r.forEach(o=>{let[a,{kind:u}]=o;const h=this.remoteUserMap.get(a);h&&(h.delete(u),Array.from(h.entries()).length===0&&this.remoteUserMap.delete(a))})}async updateBitrateLimit(r){const o=this.localTrackMap.get(Qe.LocalVideoTrack),a=this.localTrackMap.get(Qe.LocalVideoLowTrack);o&&await o.track.setBitrateLimit(r.uplink),a&&r.low_stream_uplink&&await a.track.setBitrateLimit({max_bitrate:r.low_stream_uplink.bitrate,min_bitrate:r.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(r,o){return r.map((a,u)=>{var h;let{stream_type:g}=a;return(h=o.find(E=>{let{stream_type:S}=E;return g===S}))===null||h===void 0?void 0:h.attributes})}async tryToUnmuteAudio(r){for(let a=0;a<r.length;a++)if(r[a]instanceof ys){var o;const u=this.filterTobeUnmutedTracks(r[a]);if(u.length===0)continue;await((o=this.connection)===null||o===void 0?void 0:o.unmuteLocal(u.map(g=>{let[,{id:E}]=g;return E})));const h=this.createUnmuteMessage(u);return void await er(this,Jt.RequestUnmuteLocal,h)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=r=>{var o;return!((o=this.connection)===null||o===void 0||!o.getRemoteVideoIsReady(r))},this.statsUploader.requestUpload=(r,o)=>this.emit(Jt.RequestUploadStats,r,o),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await vs(Wv(this.dtlsFailedCount,Or)),this.emit(Jt.RequestReconnect)}async reconnectP2P(){const r=Array.from(this.localTrackMap.entries()),o=this.createGatewayUnpublishMessage(r);Array.from(this.remoteUserMap.entries()),o.length>0&&await Ss(this,Jt.RequestUnpublishForReconnectPC,o),this.disconnectForReconnect(),this.emit(Jt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Qe.LocalVideoTrack)||this.pendingLocalTracks.some(r=>r instanceof dr)}throwIfTrackTypeNotMatch(r){if(r.filter(o=>o instanceof dr).length>1)throw new Q(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r.filter(o=>o instanceof ys).length>1&&(r.some(o=>o instanceof ys&&o._bypassWebAudio)||!ns().webAudioMediaStreamDest))throw new Q(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const o of r){if(o instanceof dr&&this.pendingLocalTracks.some(a=>a instanceof dr))throw new Q(K.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(o instanceof ys&&this.pendingLocalTracks.some(a=>a instanceof ys)&&(!ns().webAudioMediaStreamDest||o._bypassWebAudio||this.pendingLocalTracks.some(a=>a instanceof ys&&a._bypassWebAudio)))throw new Q(K.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(r,o){const a=ns().supportDualStreamEncoding,u=$u($u({},{width:160,height:120,framerate:15,bitrate:50}),o);let h;h=a?r._mediaStreamTrack.clone():MP(r,u);const g=Kn(8,"track-low-"),E=new dr(h,$u($u({},a&&{scaleResolutionDownBy:OK(u,r)}),{},{frameRate:u.framerate,bitrateMax:u.bitrate,bitrateMin:u.bitrate}),void 0,void 0,g);return E._hints.push(ts.LOW_STREAM),r.addListener(yt.NEED_CLOSE,()=>{E.close()}),E}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}reportVideoFirstFrameDecoded(r,o,a,u){var h;const g=Array.from(ql(h=this.remoteUserMap).call(h)).find(E=>E._videoSSRC===r);if(g){u||this.store.subscribe(g.uid,"video",void 0,void 0,void 0,void 0,Date.now());const E=this.store.keyMetrics,S=E.subscribe.find(T=>T.userId===g.uid&&T.type==="video");at.firstRemoteVideoDecode(this.store.sessionId,gs.FIRST_VIDEO_DECODE,zn.FIRST_VIDEO_DECODE,{peer:g._uintid,videowidth:o,videoheight:a,subscribeElapse:Ni.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId,apEnd:E.requestAPEnd||0,apStart:E.requestAPStart||0,joinGwEnd:E.joinGatewayEnd||0,joinGwStart:E.joinGatewayStart||0,pcEnd:E.peerConnectionEnd||0,pcStart:E.peerConnectionStart||0,subscriberEnd:(S==null?void 0:S.subscribeEnd)||0,subscriberStart:(S==null?void 0:S.subscribeStart)||0,videoAddNotify:(S==null?void 0:S.streamAdded)||0,state:u?1:0})}}async remoteMediaSsrcChanged(r,o,a){if(!this.connection)return!1;const u=this.remoteUserMap.get(r);if(!u)return!1;const h=u.get(o);if(!h)return!1;const g=await this.connection.getRemoteSSRC(h);return g!==void 0&&g!==a}resetConnection(r){F.debug("[P2PChannel] reset connection to ".concat(r)),this.state===xr.Connected?(F.debug("[P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first"),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=r===lE.datachannel?new Mu({},this.store):this.isPlanB?new Mf({},this.store):new $f({},this.store),this.bindConnectionEvents(this.connection)))}}).prototype,"startP2PConnection",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"startP2PConnection"),Qt.prototype),Ne(Qt.prototype,"connect",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"connect"),Qt.prototype),Ne(Qt.prototype,"preConnect",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"preConnect"),Qt.prototype),Ne(Qt.prototype,"unpublish",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"unpublish"),Qt.prototype),Ne(Qt.prototype,"unpublishLowStream",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"unpublishLowStream"),Qt.prototype),Ne(Qt.prototype,"subscribe",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"subscribe"),Qt.prototype),Ne(Qt.prototype,"massSubscribe",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"massSubscribe"),Qt.prototype),Ne(Qt.prototype,"unsubscribe",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"unsubscribe"),Qt.prototype),Ne(Qt.prototype,"massUnsubscribe",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"massUnsubscribe"),Qt.prototype),Ne(Qt.prototype,"muteRemote",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"muteRemote"),Qt.prototype),Ne(Qt.prototype,"unmuteRemote",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"unmuteRemote"),Qt.prototype),Ne(Qt.prototype,"hasRemoteMediaWithLock",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"hasRemoteMediaWithLock"),Qt.prototype),Ne(Qt.prototype,"disconnectForReconnect",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"disconnectForReconnect"),Qt.prototype),Ne(Qt.prototype,"updateBitrateLimit",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"updateBitrateLimit"),Qt.prototype),Ne(Qt.prototype,"remoteMediaSsrcChanged",[jo],Object.getOwnPropertyDescriptor(Qt.prototype,"remoteMediaSsrcChanged"),Qt.prototype),Qt);function jo(r,o,a){const u=r[o];if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){const h=this.mutex,g=await h.lock("From P2PChannel.".concat(o));try{for(var E=arguments.length,S=new Array(E),T=0;T<E;T++)S[T]=arguments[T];return await u.apply(this,S)}finally{g()}},a}function t4(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function ct(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?t4(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):t4(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}var Ut;(function(r){r.SET_SESSION_ID="SET_SESSION_ID",r.SET_P2P_ID="SET_P2P_id",r.SET_DC_ID="SET_DC_id",r.SET_UID="SET_UID",r.SET_PUB_ID="SET_PUB_ID",r.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",r.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",r.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",r.AVOID_JOIN_START="AVOID_JOIN_START",r.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",r.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",r.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",r.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",r.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",r.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",r.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",r.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",r.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",r.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",r.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",r.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",r.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",r.RESET_KEY_METRICS="RESET_KEY_METRICS",r.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"})(Ut||(Ut={}));class Qq{constructor(o,a,u,h){k(this,"state",void 0),this.state={codec:o,audioCodec:a,mode:u,clientId:h,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}dispatch(o){this.state=function(a,u){switch(u.type){case Ut.SET_SESSION_ID:return ct(ct({},a),{},{sessionId:u.sessionId});case Ut.SET_P2P_ID:return ct(ct({},a),{},{p2pId:u.p2pId});case Ut.SET_UID:return ct(ct({},a),{},{uid:u.uid});case Ut.SET_PUB_ID:return ct(ct({},a),{},{pubId:u.pubId});case Ut.KEY_METRIC_CLIENT_CREATED:return ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{clientCreated:u.metric})});case Ut.KEY_METRIC_JOIN_START:return ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{joinStart:u.metric})});case Ut.AVOID_JOIN_START:return ct(ct({},a),{},{avoidJoinStart:u.avoidJoinStart});case Ut.KEY_METRIC_JOIN_END:return ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{joinEnd:u.metric})});case Ut.KEY_METRIC_REQUEST_AP_START:return ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{requestAPStart:u.metric})});case Ut.KEY_METRIC_REQUEST_AP_END:return ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{requestAPEnd:u.metric})});case Ut.KEY_METRIC_JOIN_GATEWAY_START:return ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{joinGatewayStart:u.metric})});case Ut.KEY_METRIC_JOIN_GATEWAY_END:return ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{joinGatewayEnd:u.metric})});case Ut.KEY_METRIC_PEER_CONNECTION_START:return ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{peerConnectionStart:u.metric})});case Ut.KEY_METRIC_PEER_CONNECTION_END:return ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{peerConnectionEnd:u.metric})});case Ut.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{signalChannelOpen:u.metric})});case Ut.KEY_METRIC_ICE_CONNECTION_END:return ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{iceConnectionEnd:u.metric})});case Ut.KEY_METRIC_PUBLISH:{const h=a.keyMetrics.publish,g=h.findIndex(E=>E.trackId===u.metric.trackId);return g!==-1?(h[g]=ct(ct({},h[g]),u.metric),ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{publish:[...h]})})):ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{publish:[...a.keyMetrics.publish,u.metric]})})}case Ut.KEY_METRIC_SUBSCRIBE:{const h=a.keyMetrics.subscribe,g=h.findIndex(E=>E.userId===u.metric.userId&&E.type===u.metric.type);return g!==-1?(h[g]=ct(ct({},h[g]),u.metric),ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{subscribe:[...h]})})):ct(ct({},a),{},{keyMetrics:ct(ct({},a.keyMetrics),{},{subscribe:[...a.keyMetrics.subscribe,u.metric]})})}case Ut.SET_CLOUD_PROXY_SERVER_MODE:return a.cloudProxyServerMode=u.mode,a;case Ut.RECORD_JOIN_CHANNEL_SERVICE:return typeof u.index!="number"?a.joinChannelServiceRecords=[...a.joinChannelServiceRecords,u.record]:(a.joinChannelServiceRecords[u.index]=ct(ct({},a.joinChannelServiceRecords[u.index]),u.record),a.joinChannelServiceRecords=[...a.joinChannelServiceRecords]),a;case Ut.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return a.joinChannelServiceRecords=[],a;case Ut.RESET_KEY_METRICS:return a.keyMetrics={publish:[],subscribe:[]},a;case Ut.SET_USE_DATACHANNEL:return ct(ct({},a),{},{useDataChannel:u.val});default:return a}}(this.state,o)}set sessionId(o){this.dispatch({type:Ut.SET_SESSION_ID,sessionId:o})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(o){this.dispatch({type:Ut.SET_P2P_ID,p2pId:o})}get p2pId(){return this.state.p2pId}set dcId(o){this.dispatch({type:Ut.SET_DC_ID,dcId:o})}get dcId(){return this.state.dcId}set uid(o){this.dispatch({type:Ut.SET_UID,uid:o})}get uid(){return this.state.uid}set pubId(o){this.dispatch({type:Ut.SET_PUB_ID,pubId:o})}get pubId(){return this.state.pubId}set cloudProxyServerMode(o){this.dispatch({type:Ut.SET_CLOUD_PROXY_SERVER_MODE,mode:o})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(o){this.dispatch({type:Ut.SET_USE_DATACHANNEL,val:o})}get useDataChannel(){return this.state.useDataChannel}clientCreated(){this.dispatch({type:Ut.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Ut.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Ut.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Ut.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Ut.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Ut.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Ut.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Ut.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Ut.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Ut.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Ut.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(o,a,u,h){this.dispatch({type:Ut.KEY_METRIC_PUBLISH,metric:ct(ct({trackId:o,type:a},u&&{publishStart:u}),h&&{publishEnd:h})})}subscribe(o,a,u,h,g,E,S){this.dispatch({type:Ut.KEY_METRIC_SUBSCRIBE,metric:ct(ct(ct(ct(ct({userId:o,type:a},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),g&&{firstFrame:g}),E&&{streamAdded:E}),S&&{firstDecoded:S})})}massSubscribe(o,a,u,h){o.forEach(g=>{this.dispatch({type:Ut.KEY_METRIC_SUBSCRIBE,metric:ct(ct(ct({userId:g.userId,type:g.type},a&&{subscribeStart:a}),u&&{subscribeEnd:u}),h&&{firstFrame:h})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(o,a){o.service==="gateway"&&Array.isArray(o.urls)&&(o.urls=o.urls.map(u=>u.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof a!="number"?(this.dispatch({type:Ut.RECORD_JOIN_CHANNEL_SERVICE,record:ct(ct({},o),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(a<0||a>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Ut.RECORD_JOIN_CHANNEL_SERVICE,record:o,index:a}),a)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Ut.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Ut.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(o){this.dispatch({type:Ut.AVOID_JOIN_START,avoidJoinStart:o})}}let UE;const Zq=()=>(UE||UE||(UE=(window.location.protocol.split(":")[0]||"").toUpperCase(),UE))==="HTTPS",n4=()=>window.isSecureContext!==void 0;function eX(r){let o=o4();return function(a,u){let h=a.appId;h!==void 0&&(en(u,10),cc(u,h));let g=a.cid;g!==void 0&&(en(u,16),en(u,g));let E=a.cname;E!==void 0&&(en(u,26),cc(u,E));let S=a.deviceId;S!==void 0&&(en(u,34),cc(u,S));let T=a.elapse;T!==void 0&&(en(u,40),Fu(u,T));let C=a.fileSize;C!==void 0&&(en(u,48),Fu(u,Fh(C)));let w=a.height;w!==void 0&&(en(u,56),Fu(u,Fh(w)));let N=a.jpg;N!==void 0&&(en(u,66),en(u,N.length),function(wo,ve){let xe=Uh(wo,ve.length);wo.bytes.set(ve,xe)}(u,N));let M=a.networkType;M!==void 0&&(en(u,72),Fu(u,Fh(M)));let U=a.osType;U!==void 0&&(en(u,80),Fu(u,Fh(U)));let Y=a.requestId;Y!==void 0&&(en(u,90),cc(u,Y));let X=a.sdkVersion;X!==void 0&&(en(u,98),cc(u,X));let J=a.sequence;J!==void 0&&(en(u,104),Fu(u,Fh(J)));let fe=a.sid;fe!==void 0&&(en(u,114),cc(u,fe));let ge=a.timestamp;ge!==void 0&&(en(u,120),Fu(u,ge));let Ue=a.uid;Ue!==void 0&&(en(u,128),en(u,Ue));let lt=a.vid;lt!==void 0&&(en(u,136),en(u,lt));let Ve=a.width;Ve!==void 0&&(en(u,144),Fu(u,Fh(Ve)));let Ge=a.service;Ge!==void 0&&(en(u,152),en(u,Ge));let Le=a.callbackData;Le!==void 0&&(en(u,162),cc(u,Le));let Ze=a.jpgEncryption;Ze!==void 0&&(en(u,168),en(u,Ze));let yn=a.requestType;yn!==void 0&&(en(u,176),en(u,yn));let At=a.scorePorn;At!==void 0&&(en(u,185),yT(u,At));let Dn=a.scoreSexy;Dn!==void 0&&(en(u,193),yT(u,Dn));let Tn=a.scoreNeutral;Tn!==void 0&&(en(u,201),yT(u,Tn));let ir=a.scene;ir!==void 0&&(en(u,208),en(u,ir));let us=a.ossFilePrefix;us!==void 0&&(en(u,218),cc(u,us));let tr=a.serviceVendor;if(tr!==void 0)for(let wo of tr){en(u,226);let ve=o4();rX(wo,ve),en(u,ve.limit),aX(u,ve),iX(ve)}}(r,o),function(a){let u=a.bytes,h=a.limit;return u.length===h?u:u.subarray(0,h)}(o)}function tX(r){return function(a){let u={};e:for(;!i4(a);){let h=uc(a);switch(h>>>3){case 0:break e;case 1:u.code=uc(a);break;case 2:u.msg=a4(a,uc(a));break;case 3:{let g=sX(a);u.data=nX(a),a.limit=g;break}default:r4(a,7&h)}}return u}({bytes:o=r,offset:0,limit:o.length});var o}function nX(r){let o={};e:for(;!i4(r);){let a=uc(r);switch(a>>>3){case 0:break e;case 1:o.requestId=a4(r,uc(r));break;case 2:o.requestType=uc(r)>>>0;break;case 3:o.scorePorn=_T(r);break;case 4:o.scoreSexy=_T(r);break;case 5:o.scoreNeutral=_T(r);break;case 6:o.requestScene=uc(r)>>>0;break;case 7:o.scene=uc(r)>>>0;break;default:r4(r,7&a)}}return o}function rX(r,o){let a=r.service;a!==void 0&&(en(o,8),en(o,a));let u=r.vendor;u!==void 0&&(en(o,16),en(o,u));let h=r.token;h!==void 0&&(en(o,26),cc(o,h));let g=r.callbackUrl;g!==void 0&&(en(o,34),cc(o,g))}function sX(r){let o=uc(r),a=r.limit;return r.limit=r.offset+o,a}function r4(r,o){switch(o){case 0:for(;128&c4(r););break;case 2:gT(r,uc(r));break;case 5:gT(r,4);break;case 1:gT(r,8);break;default:throw new Error("Unimplemented type: "+o)}}let oX=new Float32Array(1);new Uint8Array(oX.buffer);let mT=new Float64Array(1),Co=new Uint8Array(mT.buffer);function Fh(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}let s4=[];function o4(){const r=s4.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}function iX(r){s4.push(r)}function gT(r,o){if(r.offset+o>r.limit)throw new Error("Skip past limit");r.offset+=o}function i4(r){return r.offset>=r.limit}function Uh(r,o){let a=r.bytes,u=r.offset,h=r.limit,g=u+o;if(g>a.length){let E=new Uint8Array(2*g);E.set(a),r.bytes=E}return r.offset=g,g>h&&(r.limit=g),u}function ET(r,o){let a=r.offset;if(a+o>r.limit)throw new Error("Read past limit");return r.offset+=o,a}function a4(r,o){let a=ET(r,o),u=String.fromCharCode,h=r.bytes,g="�",E="";for(let S=0;S<o;S++){let T,C,w,N,M=h[S+a];128&M?(224&M)==192?S+1>=o?E+=g:(T=h[S+a+1],(192&T)!=128?E+=g:(N=(31&M)<<6|63&T,N<128?E+=g:(E+=u(N),S++))):(240&M)==224?S+2>=o?E+=g:(T=h[S+a+1],C=h[S+a+2],(49344&(T|C<<8))!=32896?E+=g:(N=(15&M)<<12|(63&T)<<6|63&C,N<2048||N>=55296&&N<=57343?E+=g:(E+=u(N),S+=2))):(248&M)==240?S+3>=o?E+=g:(T=h[S+a+1],C=h[S+a+2],w=h[S+a+3],(12632256&(T|C<<8|w<<16))!=8421504?E+=g:(N=(7&M)<<18|(63&T)<<12|(63&C)<<6|63&w,N<65536||N>1114111?E+=g:(N-=65536,E+=u(55296+(N>>10),56320+(1023&N)),S+=3))):E+=g:E+=u(M)}return E}function cc(r,o){let a=o.length,u=0;for(let E=0;E<a;E++){let S=o.charCodeAt(E);S>=55296&&S<=56319&&E+1<a&&(S=(S<<10)+o.charCodeAt(++E)-56613888),u+=S<128?1:S<2048?2:S<65536?3:4}en(r,u);let h=Uh(r,u),g=r.bytes;for(let E=0;E<a;E++){let S=o.charCodeAt(E);S>=55296&&S<=56319&&E+1<a&&(S=(S<<10)+o.charCodeAt(++E)-56613888),S<128?g[h++]=S:(S<2048?g[h++]=S>>6&31|192:(S<65536?g[h++]=S>>12&15|224:(g[h++]=S>>18&7|240,g[h++]=S>>12&63|128),g[h++]=S>>6&63|128),g[h++]=63&S|128)}}function aX(r,o){let a=Uh(r,o.limit),u=r.bytes,h=o.bytes;for(let g=0,E=o.limit;g<E;g++)u[g+a]=h[g]}function c4(r){return r.bytes[ET(r,1)]}function u4(r,o){let a=Uh(r,1);r.bytes[a]=o}function _T(r){let o=ET(r,8),a=r.bytes;return Co[0]=a[o++],Co[1]=a[o++],Co[2]=a[o++],Co[3]=a[o++],Co[4]=a[o++],Co[5]=a[o++],Co[6]=a[o++],Co[7]=a[o++],mT[0]}function yT(r,o){let a=Uh(r,8),u=r.bytes;mT[0]=o,u[a++]=Co[0],u[a++]=Co[1],u[a++]=Co[2],u[a++]=Co[3],u[a++]=Co[4],u[a++]=Co[5],u[a++]=Co[6],u[a++]=Co[7]}function uc(r){let o,a=0,u=0;do o=c4(r),a<32&&(u|=(127&o)<<a),a+=7;while(128&o);return u}function en(r,o){for(o>>>=0;o>=128;)u4(r,127&o|128),o>>>=7;u4(r,o)}function Fu(r,o){let a=o.low>>>0,u=(o.low>>>28|o.high<<4)>>>0,h=o.high>>>24,g=h===0?u===0?a<16384?a<128?1:2:a<1<<21?3:4:u<16384?u<128?5:6:u<1<<21?7:8:h<128?9:10,E=Uh(r,g),S=r.bytes;switch(g){case 10:S[E+9]=h>>>7&1;case 9:S[E+8]=g!==9?128|h:127&h;case 8:S[E+7]=g!==8?u>>>21|128:u>>>21&127;case 7:S[E+6]=g!==7?u>>>14|128:u>>>14&127;case 6:S[E+5]=g!==6?u>>>7|128:u>>>7&127;case 5:S[E+4]=g!==5?128|u:127&u;case 4:S[E+3]=g!==4?a>>>21|128:a>>>21&127;case 3:S[E+2]=g!==3?a>>>14|128:a>>>14&127;case 2:S[E+1]=g!==2?a>>>7|128:a>>>7&127;case 1:S[E]=g!==1?128|a:127&a}}const cX=async(r,o,a)=>{const u=function(E){const S=[];for(let T=0;T<E.length;T+=2)S.push(parseInt(E.slice(T,T+2),16));return Uint8Array.from(S)}(function(E){const S="0123456789abcdef";function T(yn){let At,Dn="";for(At=0;At<=3;At++)Dn+=S.charAt(yn>>8*At+4&15)+S.charAt(yn>>8*At&15);return Dn}function C(yn,At){const Dn=(65535&yn)+(65535&At);return(yn>>16)+(At>>16)+(Dn>>16)<<16|65535&Dn}function w(yn,At,Dn,Tn,ir,us){return C(function(tr,wo){return tr<<wo|tr>>>32-wo}(C(C(At,yn),C(Tn,us)),ir),Dn)}function N(yn,At,Dn,Tn,ir,us,tr){return w(At&Dn|~At&Tn,yn,At,ir,us,tr)}function M(yn,At,Dn,Tn,ir,us,tr){return w(At&Tn|Dn&~Tn,yn,At,ir,us,tr)}function U(yn,At,Dn,Tn,ir,us,tr){return w(At^Dn^Tn,yn,At,ir,us,tr)}function Y(yn,At,Dn,Tn,ir,us,tr){return w(Dn^(At|~Tn),yn,At,ir,us,tr)}const X=function(yn){let At;const Dn=1+(yn.length+8>>6),Tn=new Array(16*Dn);for(At=0;At<16*Dn;At++)Tn[At]=0;for(At=0;At<yn.length;At++)Tn[At>>2]|=yn.charCodeAt(At)<<At%4*8;return Tn[At>>2]|=128<<At%4*8,Tn[16*Dn-2]=8*yn.length,Tn}(E);let J,fe,ge,Ue,lt,Ve=1732584193,Ge=-271733879,Le=-1732584194,Ze=271733878;for(J=0;J<X.length;J+=16)fe=Ve,ge=Ge,Ue=Le,lt=Ze,Ve=N(Ve,Ge,Le,Ze,X[J+0],7,-680876936),Ze=N(Ze,Ve,Ge,Le,X[J+1],12,-389564586),Le=N(Le,Ze,Ve,Ge,X[J+2],17,606105819),Ge=N(Ge,Le,Ze,Ve,X[J+3],22,-1044525330),Ve=N(Ve,Ge,Le,Ze,X[J+4],7,-176418897),Ze=N(Ze,Ve,Ge,Le,X[J+5],12,1200080426),Le=N(Le,Ze,Ve,Ge,X[J+6],17,-1473231341),Ge=N(Ge,Le,Ze,Ve,X[J+7],22,-45705983),Ve=N(Ve,Ge,Le,Ze,X[J+8],7,1770035416),Ze=N(Ze,Ve,Ge,Le,X[J+9],12,-1958414417),Le=N(Le,Ze,Ve,Ge,X[J+10],17,-42063),Ge=N(Ge,Le,Ze,Ve,X[J+11],22,-1990404162),Ve=N(Ve,Ge,Le,Ze,X[J+12],7,1804603682),Ze=N(Ze,Ve,Ge,Le,X[J+13],12,-40341101),Le=N(Le,Ze,Ve,Ge,X[J+14],17,-1502002290),Ge=N(Ge,Le,Ze,Ve,X[J+15],22,1236535329),Ve=M(Ve,Ge,Le,Ze,X[J+1],5,-165796510),Ze=M(Ze,Ve,Ge,Le,X[J+6],9,-1069501632),Le=M(Le,Ze,Ve,Ge,X[J+11],14,643717713),Ge=M(Ge,Le,Ze,Ve,X[J+0],20,-373897302),Ve=M(Ve,Ge,Le,Ze,X[J+5],5,-701558691),Ze=M(Ze,Ve,Ge,Le,X[J+10],9,38016083),Le=M(Le,Ze,Ve,Ge,X[J+15],14,-660478335),Ge=M(Ge,Le,Ze,Ve,X[J+4],20,-405537848),Ve=M(Ve,Ge,Le,Ze,X[J+9],5,568446438),Ze=M(Ze,Ve,Ge,Le,X[J+14],9,-1019803690),Le=M(Le,Ze,Ve,Ge,X[J+3],14,-187363961),Ge=M(Ge,Le,Ze,Ve,X[J+8],20,1163531501),Ve=M(Ve,Ge,Le,Ze,X[J+13],5,-1444681467),Ze=M(Ze,Ve,Ge,Le,X[J+2],9,-51403784),Le=M(Le,Ze,Ve,Ge,X[J+7],14,1735328473),Ge=M(Ge,Le,Ze,Ve,X[J+12],20,-1926607734),Ve=U(Ve,Ge,Le,Ze,X[J+5],4,-378558),Ze=U(Ze,Ve,Ge,Le,X[J+8],11,-2022574463),Le=U(Le,Ze,Ve,Ge,X[J+11],16,1839030562),Ge=U(Ge,Le,Ze,Ve,X[J+14],23,-35309556),Ve=U(Ve,Ge,Le,Ze,X[J+1],4,-1530992060),Ze=U(Ze,Ve,Ge,Le,X[J+4],11,1272893353),Le=U(Le,Ze,Ve,Ge,X[J+7],16,-155497632),Ge=U(Ge,Le,Ze,Ve,X[J+10],23,-1094730640),Ve=U(Ve,Ge,Le,Ze,X[J+13],4,681279174),Ze=U(Ze,Ve,Ge,Le,X[J+0],11,-358537222),Le=U(Le,Ze,Ve,Ge,X[J+3],16,-722521979),Ge=U(Ge,Le,Ze,Ve,X[J+6],23,76029189),Ve=U(Ve,Ge,Le,Ze,X[J+9],4,-640364487),Ze=U(Ze,Ve,Ge,Le,X[J+12],11,-421815835),Le=U(Le,Ze,Ve,Ge,X[J+15],16,530742520),Ge=U(Ge,Le,Ze,Ve,X[J+2],23,-995338651),Ve=Y(Ve,Ge,Le,Ze,X[J+0],6,-198630844),Ze=Y(Ze,Ve,Ge,Le,X[J+7],10,1126891415),Le=Y(Le,Ze,Ve,Ge,X[J+14],15,-1416354905),Ge=Y(Ge,Le,Ze,Ve,X[J+5],21,-57434055),Ve=Y(Ve,Ge,Le,Ze,X[J+12],6,1700485571),Ze=Y(Ze,Ve,Ge,Le,X[J+3],10,-1894986606),Le=Y(Le,Ze,Ve,Ge,X[J+10],15,-1051523),Ge=Y(Ge,Le,Ze,Ve,X[J+1],21,-2054922799),Ve=Y(Ve,Ge,Le,Ze,X[J+8],6,1873313359),Ze=Y(Ze,Ve,Ge,Le,X[J+15],10,-30611744),Le=Y(Le,Ze,Ve,Ge,X[J+6],15,-1560198380),Ge=Y(Ge,Le,Ze,Ve,X[J+13],21,1309151649),Ve=Y(Ve,Ge,Le,Ze,X[J+4],6,-145523070),Ze=Y(Ze,Ve,Ge,Le,X[J+11],10,-1120210379),Le=Y(Le,Ze,Ve,Ge,X[J+2],15,718787259),Ge=Y(Ge,Le,Ze,Ve,X[J+9],21,-343485551),Ve=C(Ve,fe),Ge=C(Ge,ge),Le=C(Le,Ue),Ze=C(Ze,lt);return T(Ve)+T(Ge)+T(Le)+T(Ze)}(""+o+a)).slice(0,16),h=u.slice(0,12),g=await window.crypto.subtle.importKey("raw",u,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:h},g,r))};function l4(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}const uX=new Map([["moderation",1],["supervise",2]]);class VE extends Qn{get connectionState(){return this._connectionState}set connectionState(o){if(this._connectionState===o)return;const a=this._connectionState;this._connectionState=o,this.emit(Ir.CONNECTION_STATE_CHANGE,a,o)}get inspectType(){return this._inspectType}set inspectType(o){var a;this._inspectMode=Iu(a=o.map(u=>uX.get(u)||0)).call(a,(u,h)=>u+h),this._inspectType=o}get quality(){return this._quality}set quality(o){this._quality=o>1?1:o<.1?.1:o,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(o){super(),k(this,"name","AgoraRTCVideoContentInspect"),k(this,"_connectionState",Zo.CONNECTING),k(this,"_innerConnectionState",void 0),k(this,"sequence",0),k(this,"inspectStartTime",void 0),k(this,"workerManagerConnection",void 0),k(this,"workerConnection",void 0),k(this,"workerMessageLengthLimit",void 0),k(this,"inspectIntervalMinimum",void 0),k(this,"qualityRatio",void 0),k(this,"_connectInfo",void 0),k(this,"_cancelTokenSource",Ji.CancelToken.source()),k(this,"_retryConfig",void 0),k(this,"wmSequence",0),k(this,"inspectInterval",void 0),k(this,"inspectTimer",null),k(this,"ossFilePrefix",void 0),k(this,"extraInfo",void 0),k(this,"_inspectType",void 0),k(this,"_inspectMode",void 0),k(this,"_quality",1),k(this,"qualityTimer",null),k(this,"_inspectId",void 0),k(this,"_needWorkUrlOnly",!1),k(this,"inspectImage",()=>{if(this.connectionState!==Zo.CONNECTED)throw new Q(K.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Zo.CONNECTED?this.requestToInspectImage():F.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Kn(5,"inspect-"),this.workerMessageLengthLimit=de("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=de("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=de("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=o.interval,this.ossFilePrefix=o.ossFilePrefix,this.extraInfo=o.extraInfo,this.inspectType=o.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Dh("worker-manager-"+this._inspectId,Or),this.on(Ir.STATE_CHANGE,(a,u)=>{this._innerConnectionState=a,F.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ei[a]," ").concat(u||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Dh("worker-"+this._inspectId,Or),this.handleWorkerEvents()}async init(o,a){this.emit(Ir.STATE_CHANGE,ei.CONNECT_AP),this._connectInfo=o;const u=this._cancelTokenSource.token;return this._retryConfig=a,new Je((h,g)=>{this.on(Ir.CONNECTION_STATE_CHANGE,(E,S)=>{S===Zo.CONNECTED&&h()}),this.requestAP(o,u,a).then(E=>{this.connectWorkerManager(E)}).catch(E=>{g(E)})})}async requestAP(o,a,u){const h=de("WEBCS_DOMAIN").map(S=>"https://".concat(S,"/api/v1")),g=await function(S,T,C,w){let{appId:N,areaCode:M,cname:U,sid:Y,token:X,uid:J}=T;PS++;const fe="image_moderation_api",ge={service_name:fe,json_body:JSON.stringify({appId:N,areaCode:M,cname:U,command:"allocateEdge",requestId:PS,seq:PS,sid:Y,token:X,ts:Date.now(),uid:J+""})};let Ue,lt,Ve=S[0];return nc(async()=>{Ue=Date.now();const Ge=await Da(Ve,{data:ge,cancelToken:C,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(lt=Date.now()-Ue,Ge.code!==0){const At=new Q(K.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Ge.code,{retry:!0,responseTime:lt});throw F.error(At.toString()),At}const Le=JSON.parse(Ge.json_body);if(Le.code!==200){const At=new Q(K.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Le.code,", reason: ").concat(Le.reason),{code:Le.code,responseTime:lt});throw F.error(At.toString()),At}if(!Le.servers||!Array.isArray(Le.servers)||Le.servers.length===0){const At=new Q(K.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Le.code,responseTime:lt});throw F.error(At.toString()),At}const Ze=de("VIDEO_INSPECT_WORKER_MANAGER_HOST"),yn=de("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Le.servers.map(At=>{let{address:Dn,wss:Tn}=At;if(Dn&&Tn)return"wss://".concat(Dn.replace(/\./g,"-"),".").concat(Ze,":").concat(yn||Tn)}).filter(At=>!!At),workerToken:Le.workerToken,vid:Le.vid,responseTime:lt}},(Ge,Le)=>(at.apworkerEvent(Y,{success:!0,sc:200,serviceName:fe,responseDetail:JSON.stringify(Ge.addressList),firstSuccess:Le===0,responseTime:lt,serverIp:S[Le%S.length]}),!1),(Ge,Le)=>(at.apworkerEvent(Y,{success:!1,sc:Ge.data&&Ge.data.code||200,serviceName:fe,responseTime:lt,serverIp:S[Le%S.length]}),!!(Ge.code!==K.OPERATION_ABORTED&&Ge.code!==K.UNEXPECTED_RESPONSE||Ge.data&&Ge.data.retry)&&(Ve=S[(Le+1)%S.length],!0)),w)}(h,o,a,u);this.emit(Ir.STATE_CHANGE,ei.AP_CONNECTED);const{addressList:E}=g;return this.wmSequence++,E}async connectWorkerManager(o){let a=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=a,this.emit(Ir.STATE_CHANGE,ei.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(o,1e4)}async connectWorker(o){await this.workerConnection.init([o])}handleWorkerManagerEvents(){this.workerManagerConnection.on(kt.CONNECTED,async()=>{this.emit(Ir.STATE_CHANGE,ei.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.17.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(kt.CLOSED,()=>{this._innerConnectionState<ei.GET_WORKER_MANAGER_RESPONSE&&F.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(kt.FAILED,()=>{this._innerConnectionState<ei.GET_WORKER_MANAGER_RESPONSE&&F.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(kt.RECONNECTING,()=>{this._innerConnectionState<ei.GET_WORKER_MANAGER_RESPONSE&&F.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(kt.ON_MESSAGE,async o=>{this.emit(Ir.STATE_CHANGE,ei.GET_WORKER_MANAGER_RESPONSE);const a=this.workerManagerConnection.url;this.workerManagerConnection.close();const u=JSON.parse(o.data);if(u.code!==200)throw F.error("[".concat(this._inspectId,"] Unexpected code ").concat(u.code," from worker manager")),new Q(K.UNEXPECTED_RESPONSE,"response code of worker is unexpected",u);if(!(u.serverResponse&&u.serverResponse.portWss&&a))throw F.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(u))),new Q(K.UNEXPECTED_RESPONSE,"response content of worker is unexpected",u);{const h=de("VIDEO_INSPECT_WORKER_PORT")||u.serverResponse.portWss,g=a.replace(/:\d+\/?$/,":".concat(h));this.emit(Ir.STATE_CHANGE,ei.CONNECT_WORKER,g),this._needWorkUrlOnly?this.emit(Ir.REQUEST_NEW_WORKER_URL,g):await this.connectWorker(g)}}),this.workerManagerConnection.on(kt.WILL_RECONNECT,(o,a)=>{a(o)}),this.workerManagerConnection.on(kt.REQUEST_NEW_URLS,(o,a)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o).catch(a)})}handleWorkerEvents(){this.workerConnection.on(kt.CONNECTED,async()=>{this.emit(Ir.STATE_CHANGE,ei.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Zo.CONNECTED}),this.workerConnection.on(kt.ON_MESSAGE,async o=>{if(o.data instanceof ArrayBuffer){const u=tX(new Uint8Array(o.data));if(de("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&F.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(u)),u.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Ir.INSPECT_RESULT,void 0,void 0);if(u.data&&u.data.scorePorn&&u.data.scoreSexy&&u.data.scoreNeutral){var a;const h={porn:u.data.scorePorn,sexy:u.data.scoreSexy,neutral:u.data.scoreNeutral},g=Iu(a=Object.keys(h)).call(a,(S,T)=>h[S]>h[T]?S:T,"porn"),E=Object.keys(h).find(S=>S===g);this.emit(Ir.INSPECT_RESULT,E)}else this.emit(Ir.INSPECT_RESULT,void 0,new Q(K.UNEXPECTED_RESPONSE,u.code+"","There is an unexpected data on message"))}else this.emit(Ir.INSPECT_RESULT,void 0,new Q(K.UNEXPECTED_RESPONSE,u.code+"",u.msg))}else F.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Ir.INSPECT_RESULT,void 0,new Q(K.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(kt.CLOSED,()=>{this.connectionState=Zo.CLOSED}),this.workerConnection.on(kt.FAILED,()=>{this.connectionState=Zo.CLOSED}),this.workerConnection.on(kt.RECONNECTING,()=>{this.connectionState=this.connectionState===Zo.CONNECTED?Zo.RECONNECTING:Zo.CONNECTING}),this.workerConnection.on(kt.WILL_RECONNECT,(o,a)=>{o==="recover"&&a(o),a("tryNext")}),this.workerConnection.on(kt.REQUEST_NEW_URLS,(o,a)=>{this.workerManagerConnection.close(),this.once(Ir.REQUEST_NEW_WORKER_URL,u=>{o([u])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(u=>{this.connectWorkerManager(u,!0)}).catch(u=>{a(u)})})}static intToLong(o){return{low:o|=0,high:o>>31,unsigned:o>=0}}async requestToInspectImage(){this.sequence++;const o=ic(this,Ir.CLIENT_LOCAL_VIDEO_TRACK),a={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(o){if(!o.isPlaying)return void this.emit(Ir.INSPECT_RESULT,void 0,new Q(K.INVALID_OPERATION,"Only the track being played can be inspected"));const u=await this.generateRequestData(o,a);this.workerConnection.sendMessage(u,!0,!0)}else this.emit(Ir.INSPECT_RESULT,void 0,new Q(K.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(o,a){let{appId:u,cname:h,cid:g,vid:E,sid:S,uid:T}=a;const C=Date.now(),w=await o.getCurrentFrameImage("image/jpeg",this.quality),N=await(async(X,J,fe)=>await cX(X.buffer,J,fe))(w,u,h),M=this.sequence+"-"+g+"-"+T+"-"+C+"-"+Kn(12,""),U={appId:u,cid:g,cname:h,deviceId:"",elapse:VE.intToLong(Number(C-this.inspectStartTime)),fileSize:N.byteLength,jpgEncryption:2,height:w.height,width:w.width,jpg:N,networkType:6,osType:7,requestId:M,sdkVersion:"4.17.0",sequence:this.sequence,sid:S,timestamp:VE.intToLong(C),uid:T,vid:E,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete U.callbackData,this.ossFilePrefix===void 0&&delete U.ossFilePrefix;const Y=eX(U);if(Y.byteLength<this.workerMessageLengthLimit){if(de("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const X=function(J){for(var fe=1;fe<arguments.length;fe++){var ge=arguments[fe]!=null?arguments[fe]:{};fe%2?l4(Object(ge),!0).forEach(function(Ue){k(J,Ue,ge[Ue])}):Object.getOwnPropertyDescriptors?Object.defineProperties(J,Object.getOwnPropertyDescriptors(ge)):l4(Object(ge)).forEach(function(Ue){Object.defineProperty(J,Ue,Object.getOwnPropertyDescriptor(ge,Ue))})}return J}({},U);delete X.jpg,F.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(X))}return Y}{const X=this.quality*this.qualityRatio;return this.quality=X,await this.generateRequestData(o,{appId:u,cname:h,cid:g,vid:E,sid:S,uid:T})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ji.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Zo.CLOSED,this.emit(Ir.STATE_CHANGE,ei.CLOSED)}}var d4,h4,p4,f4,m4,g4,E4,_4,y4,v4,S4,T4,I4,C4,w4,R4,b4,N4,A4,O4,x4,k4,D4,P4,L4,M4,$4,F4,U4,V4,B4,j4,W4,G4,z4,H4,K4,q4,He;function X4(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function Ff(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?X4(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):X4(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}let lX=(d4=pt(),h4=pt({argsMap:(r,o)=>(Array.isArray(o)||(o=[o]),o.map(a=>a?Object(a).toString():"null"))}),p4=pt({argsMap:(r,o)=>(o||(o=[]),Array.isArray(o)||(o=[o]),o.map(a=>a.getTrackId()))}),f4=pt({argsMap:(r,o,a)=>[o.uid,a]}),m4=pt({argsMap:(r,o)=>o.map(a=>{let{user:u,mediaType:h}=a;return[u==null?void 0:u.uid,h]})}),g4=pt({argsMap:(r,o,a)=>[o.uid,a]}),E4=pt({argsMap:(r,o)=>o.map(a=>{let{user:u,mediaType:h}=a;return{uid:u==null?void 0:u.uid,mediaType:h}})}),_4=pt(),y4=pt(),v4=pt(),S4=pt(),T4=pt(),I4=pt(),C4=pt(),w4=pt(),R4=pt(),b4=pt(),N4=pt(),A4=pt(),O4=pt(),x4=pt(),k4=pt({argsMap:(r,o)=>[o]}),D4=pt(),P4=pt(),L4=pt(),M4=pt(),$4=pt(),F4=pt(),U4=pt(),V4=pt(),B4=pt(),j4=pt(),W4=pt({argsMap:(r,o)=>(Array.isArray(o)||(o=[o]),[JSON.stringify(o)])}),G4=pt(),z4=pt(),H4=pt(),K4=pt({reportResult:!0}),q4=pt(),Ne((He=class extends Qn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(r){let o;if(super(),k(this,"store",void 0),k(this,"_uid",void 0),k(this,"_channelName",void 0),k(this,"_uintUid",void 0),k(this,"_users",[]),k(this,"_codec",void 0),k(this,"_mode",void 0),k(this,"_config",void 0),k(this,"_clientId",void 0),k(this,"_appId",void 0),k(this,"_sessionId",null),k(this,"_key",void 0),k(this,"_joinInfo",void 0),k(this,"_gateway",void 0),k(this,"_statsCollector",void 0),k(this,"_configDistribute",void 0),k(this,"_leaveMutex",new js("client-leave")),k(this,"_publishMutex",new js("client-publish")),k(this,"_renewTokenMutex",new js("client-renewtoken")),k(this,"_subscribeMutex",new js("client-subscribe")),k(this,"_encryptionMode","none"),k(this,"_encryptionSecret",null),k(this,"_encryptionSalt",null),k(this,"_proxyServer",void 0),k(this,"_turnServer",{servers:[],mode:"auto"}),k(this,"_cloudProxyServerMode","disabled"),k(this,"_isDualStreamEnabled",!1),k(this,"_defaultStreamFallbackType",void 0),k(this,"_lowStreamParameter",void 0),k(this,"_streamFallbackTypeCacheMap",new Map),k(this,"_remoteStreamTypeCacheMap",new Map),k(this,"_axiosCancelSource",Ji.CancelToken.source()),k(this,"_audioVolumeIndicationInterval",void 0),k(this,"_networkQualityInterval",void 0),k(this,"_userOfflineTimeout",void 0),k(this,"_streamRemovedTimeout",void 0),k(this,"_injectStreamingClient",void 0),k(this,"_liveTranscodeStreamingClient",void 0),k(this,"_liveRawStreamingClient",void 0),k(this,"_channelMediaRelayClient",void 0),k(this,"_networkQualitySensitivity","normal"),k(this,"_p2pChannel",void 0),k(this,"_useLocalAccessPoint",!1),k(this,"_setLocalAPVersion",void 0),k(this,"_joinAndNotLeaveYet",!1),k(this,"_numberOfJoinCount",0),k(this,"_remoteDefaultVideoStreamType",void 0),k(this,"_inspect",void 0),k(this,"_license",void 0),k(this,"_handleLocalTrackEnable",(a,u,h)=>{this.publish(a,!1).then(u).catch(h)}),k(this,"_handleLocalTrackDisable",(a,u,h)=>{this.unpublish(a).then(u).catch(h)}),k(this,"_handleUserOnline",a=>{this.isStringUID&&typeof a.uid!="string"&&F.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===a.uid);if(u)u._trust_in_room_=!0;else{const h=new US(a.uid,a.uint_id||a.uid);this._users.push(h),F.debug("[".concat(this._clientId,"] user online"),a.uid),this.emit($t.USER_JOINED,h)}}),k(this,"_handleUserOffline",a=>{const u=this._users.find(h=>h.uid===a.uid);u&&(this._handleRemoveStream(a),bS(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),F.debug("[".concat(this._clientId,"] user offline"),a.uid,"reason:",a.reason),this.emit($t.USER_LEAVED,u,a.reason))}),k(this,"_handleAddAudioOrVideoStream",(a,u,h,g,E,S,T)=>{const C=this._users.find(N=>N.uid===u);if(!C)return void F.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));F.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(a)),this.store.subscribe(C.uid,a,void 0,void 0,void 0,Date.now());const w=a==="audio"?C.hasAudio:C.hasVideo;C._uintid||(C._uintid=E||u),a==="audio"?C._trust_audio_stream_added_state_=!0:C._trust_video_stream_added_state_=!0,a==="audio"?(C._audio_added_=!0,h!==void 0&&(C._audioSSRC=h),g!==void 0&&(C._cname=g),S&&(C._audioOrtc=S)):(C._video_added_=!0,h!==void 0&&(C._videoSSRC=h),g!==void 0&&(C._cname=g),T!==void 0&&(C._rtxSsrcId=T),S&&(C._videoOrtc=S)),(a==="audio"?C.hasAudio:C.hasVideo)&&!w&&(F.info("[".concat(this._clientId,"] remote user ").concat(C.uid," published ").concat(a)),this.emit($t.USER_PUBLISHED,C,a)),a==="video"?at.onGatewayStream(this._sessionId,gs.ON_ADD_VIDEO_STREAM,zn.ON_ADD_VIDEO_STREAM,{peer:E||u}):at.onGatewayStream(this._sessionId,gs.ON_ADD_AUDIO_STREAM,zn.ON_ADD_AUDIO_STREAM,{peer:E||u}),this._p2pChannel.remoteMediaSsrcChanged(C,a,h).then(N=>{if(N)return F.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(C.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(C,a,!0).then(()=>this._subscribe(C,a,!0).catch(M=>{F.error("[".concat(this._clientId,"] resubscribe error"),M.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(C,a)&&(F.debug("[".concat(this._clientId,"] resubscribe ").concat(a," for user ").concat(C.uid," after reconnect.")),this._subscribe(C,a,!0).catch(N=>{F.error("[".concat(this._clientId,"] resubscribe error"),N.toString())}))}),k(this,"_handleRemoveStream",a=>{const u=this._users.find(g=>g.uid===a.uid);if(!u)return void F.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));F.debug("[".concat(this._clientId,"] stream removed with uid ").concat(a.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{F.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.emit($t.USER_UNPUBLISHED,u,"audio"),F.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.emit($t.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{F.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.emit($t.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{F.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.emit($t.USER_UNPUBLISHED,u,"audio")}),u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel.unsubscribe(u).then(g=>{if(g)return this._gateway.unsubscribe(g,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0,at.onGatewayStream(this._sessionId,gs.ON_REMOVE_STREAM,zn.ON_REMOVE_STREAM,{peer:a.uint_id||a.uid}),h()}),k(this,"_handleSetStreamLocalEnable",(a,u,h)=>{const g=this._users.find(T=>T.uid===u);if(!g)return void F.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));F.debug("[".concat(this._clientId,"] local ").concat(a," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const E=a==="audio"?g.hasAudio:g.hasVideo;if(a==="audio"){g._trust_audio_enabled_state_=!0;const T=g._audio_enabled_;if(g._audio_enabled_=h,g._audio_enabled_===T)return;{const C=g._audio_enabled_?"enable-local-audio":"disable-local-audio";F.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(C)),this.emit($t.USER_INFO_UPDATED,u,C)}}else{g._trust_video_enabled_state_=!0;const T=g._video_enabled_;if(g._video_enabled_=h,g._video_enabled_===T)return;{const C=g._video_enabled_?"enable-local-video":"disable-local-video";F.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(C)),this.emit($t.USER_INFO_UPDATED,u,C)}}const S=a==="audio"?g.hasAudio:g.hasVideo;return E!==S?!E&&S?(F.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(a)),void this.emit($t.USER_PUBLISHED,g,a)):(a==="video"&&g._videoTrack&&g._videoTrack._destroy(),a==="audio"&&g._audioTrack,this._p2pChannel.muteRemote(g,a),F.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(a)),void this.emit($t.USER_UNPUBLISHED,g,a)):void 0}),k(this,"_handleMuteStream",(a,u,h)=>{F.debug("[".concat(this._clientId,"] receive mute message"),a,u,h);const g=this._users.find(T=>T.uid===a);if(!g)return void F.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a));const E=u==="audio"?g.hasAudio:g.hasVideo;if(u==="audio"){g._trust_audio_mute_state_=!0;const T=g._audio_muted_;if(g._audio_muted_=h,g._audio_muted_===T)return;{const C=g._audio_muted_?"mute-audio":"unmute-audio";F.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(C)),this.emit($t.USER_INFO_UPDATED,a,C)}}else{g._trust_video_mute_state_=!0;const T=g._video_muted_;if(g._video_muted_=h,g._video_muted_===T)return;{const C=g._video_muted_?"mute-video":"unmute-video";F.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(a,", msg: ").concat(C)),this.emit($t.USER_INFO_UPDATED,a,C)}}const S=u==="audio"?g.hasAudio:g.hasVideo;if(E!==S){if(!E&&S)return(u==="audio"?g._audioSSRC:g._videoSSRC)?(F.info("[".concat(this._clientId,"] remote user ").concat(a," published ").concat(u)),void this.emit($t.USER_PUBLISHED,g,u)):void F.warning("[".concat(this._clientId,"] remote user ").concat(a," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&g._videoTrack&&g._videoTrack._destroy(),u==="audio"&&g._audioTrack,this._p2pChannel.muteRemote(g,u),F.info("[".concat(this._clientId,"] remote user ").concat(a," unpublished ").concat(u)),this.emit($t.USER_UNPUBLISHED,g,u)}}),k(this,"_handleP2PLost",async a=>{F.debug("[".concat(this._clientId,"] receive p2p lost"),a),parseInt(a.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():F.warning("P2PLost stream not found",a)}),k(this,"_handleTokenWillExpire",()=>{F.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit($t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),k(this,"_handleBeforeUnload",a=>{a.type==="beforeunload"&&a.returnValue!==void 0&&a.returnValue!==""||(this.leave(),F.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),k(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit($t.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const a={downlinkNetworkQuality:0,uplinkNetworkQuality:0};a.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),a.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.emit($t.NETWORK_QUALITY,a)}),this._codec=r.codec,this._mode=r.mode,this._clientId=Kn(5,"client-"),this.store=new Qq(r.codec,r.audioCodec,r.mode,this._clientId),this.store.clientCreated(),r.proxyServer&&this.setProxyServer(r.proxyServer,!0),r.turnServer&&this.setTurnServer(r.turnServer,!0),F.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(wi," build: ").concat(zv,", mode: ").concat(this._mode,", codec: ").concat(this._codec)),r.clientRoleOptions)try{Wx(r.clientRoleOptions),o=Object.assign({},r.clientRoleOptions)}catch(a){F.warning("[".concat(this._clientId,"] ").concat(a.toString()))}this._statsCollector=new Oh(this.store),this._statsCollector.onStatsException=(a,u,h)=>{F.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(a,", msg: ").concat(u,", uid: ").concat(h)),this.emit($t.EXCEPTION,{code:a,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(a,u,h,g)=>{const E=this._users.find(S=>S.uid===a);E&&at.peerPublishStatus(this._sessionId,{subscribeElapse:g,audioPublishDuration:u,videoPublishDuration:h,peer:E._uintid})},this.store.useDataChannel=ns().supportDataChannel&&de("SIGNAL_CHANNEL"),this._gateway=new MK(this.store,{clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:r.websocketRetryConfig||Or,httpRetryConfig:r.httpRetryConfig||Or,forceWaitGatewayResponse:r.forceWaitGatewayResponse===void 0||r.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:r.role,clientRoleOptions:o}),this._config=r,this._configDistribute=new zK,this._p2pChannel=new Jq(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async join(r,o,a,u,h){const g=++this._numberOfJoinCount;this.store.joinStart(),u&&(this.store.uid=u);const E=Zq(),S=n4()?window.isSecureContext:"Browser Not Support";if(!n4()&&!E||!window.isSecureContext){const U="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";F.warning(U)}const T=RS();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),F.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const C=at.reportApiInvoke(T,{name:vr.JOIN,options:[r,o,a,u],states:{isHttps:E,isSecureContext:S},tag:jn.TRACER});at.setAppId(r);try{if(!a&&a!==null)throw new Q(K.INVALID_PARAMS,"Invalid token: ".concat(a,". If you don not use token, set it to null"));a&&ms(a,"token",1,2047),ms(r,"appid",1,2047),tS(o),u&&nS(u),h&&ms(h,"optionalInfo",1,2047)}catch(U){throw C.onError(U),U}if(F.info("[".concat(this._clientId,"] start join channel ").concat(o,", join number: ").concat(g)),this._leaveMutex.isLocked&&(F.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),F.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const U=new Q(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw C.onError(U),U}this._sessionId||(this._sessionId=T,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const w=Ff({clientId:this._clientId,appId:r,sid:this._sessionId,cname:o,uid:typeof u!="string"?u:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:a||r,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:h,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(w.setLocalAPVersion=this._setLocalAPVersion),typeof u=="string"&&(w.stringUid=u,this._uintUid?(w.uid=this._uintUid,this._uintUid=void 0):w.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(w.aesmode=this._encryptionMode,w.aespassword=await(async U=>{const Y=NS(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),X=await window.crypto.subtle.importKey("spki",Y,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),J=yS(U),fe=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},X,J);return TE(new Uint8Array(fe))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Q(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(w.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:o,appId:r});const N=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&N===this._sessionId&&at.joinChannelTimeout(this._sessionId,5)},5e3);try{let U;const Y=w.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(Y)){const ge=de("PROXY_SERVER_TYPE3");Array.isArray(ge)?w.proxyServer=ge[0]:w.proxyServer=ge}if(at.setProxyServer(w.proxyServer),F.setProxyServer(w.proxyServer),this.store.requestAPStart(),w.stringUid&&!w.uid){const ge=await G3(w.stringUid,w,this._axiosCancelSource.token,this._config.httpRetryConfig||Or,this.store);F.debug("getUserAccount Success ".concat(w.stringUid," => ").concat(ge)),w.uid=ge,U=await W3(w,this._axiosCancelSource.token,this._config.httpRetryConfig||Or,!0,this.store)}else U=await W3(w,this._axiosCancelSource.token,this._config.httpRetryConfig||Or,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Q(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(w,this._axiosCancelSource.token),this._configDistribute.on(yf.UPDATE_BITRATE_LIMIT,ge=>{this._p2pChannel.updateBitrateLimit(ge)})},0),this._key=a||r;const X=U.gatewayInfo;this._joinInfo=Ff(Ff({},w),{},{cid:X.cid,uid:w.uid?w.uid:X.uid,vid:X.vid,apResponse:X.res,uni_lbs_ip:X.uni_lbs_ip,gatewayAddrs:X.gatewayAddrs});const J=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Q(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));C.onSuccess(J),this._appId=r,this._channelName=w.cname,this._uid=J,this.store.uid=J,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Vo()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const fe=w.stringUid?"string uid: ".concat(w.stringUid,",uid: ").concat(w.uid):"uid: ".concat(this._uid);return F.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(o,",").concat(fe)),setTimeout(()=>{F.startUpload()},5e3),this.store.joinEnd(),M=this,Ih.includes(M)||Ih.push(M),J}catch(U){const Y=Array.isArray(U)?U[0]:U;throw F.error("[".concat(this._clientId,"] join number: ").concat(g,", Joining channel failed, rollback"),Y),Y.code!==K.OPERATION_ABORTED&&this._numberOfJoinCount===g&&(this._gateway.state="DISCONNECTED",this._reset()),C.onError(Y),Y}var M}_joinGateway(){if(!this._joinInfo||!this._key)throw new Q(K.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!de("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(r=>r).catch(r=>{if(r.code===K.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,nn.FALLBACK),r;if(r.code===K.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,nn.FALLBACK),r;throw r}).then(r=>{if(r instanceof Q){if(r.code===K.INIT_WEBSOCKET_TIMEOUT){if(F.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new Q(K.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const o=de("PROXY_SERVER_TYPE3");if(Array.isArray(o))if(this._joinInfo.apUrl){const u=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),h=u.slice(u.length-2).join(".");o.forEach(g=>{this._joinInfo&&g.includes(h)&&(this._joinInfo.proxyServer=g)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=o[0])}else this._joinInfo.proxyServer=o[0];else this._joinInfo.proxyServer=o;const a=de("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return a&&a[1]&&a[1]!=="443"&&F.setProxyServer(this._joinInfo.proxyServer),de("STATS_COLLECTOR_PORT").toString()!=="443"&&at.setProxyServer(this._joinInfo.proxyServer),at.reportApiInvoke(this._sessionId,{name:vr.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:jn.TRACER}).onSuccess(),this.emit($t.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),this._gateway.join(this._joinInfo,this._key)}if(F.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new Q(K.INVALID_OPERATION);return at.reportApiInvoke(this._sessionId,{name:vr.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:jn.TRACER}).onSuccess(),this._joinGateway()}return r}).then(r=>r)}async leave(){F.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Vo()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(o){const a=Ih.indexOf(o);a!==-1&&Ih.splice(a,1)}(this);const r=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return F.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void r();await this._gateway.leave(this.connectionState!=="CONNECTED"),F.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),r()}async publish(r){let o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(Array.isArray(r)||(r=[r]),r.length===0)throw new Q(K.INVALID_PARAMS,"track list is empty");if(this._gateway.role==="audience")throw new Q(K.INVALID_OPERATION,"audience can not publish stream");for(const u of r){if(!(u instanceof vS))throw new Q(K.INVALID_PARAMS,"parameter is not local track");if(!u._enabled&&o)throw new Q(K.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(u.getTrackId()))}F.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(u=>"".concat(u.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),o&&r.forEach(u=>{const h=this._configDistribute.getBitrateLimit();u instanceof dr&&h&&u.setBitrateLimit(h.uplink)});const a=await this._publishMutex.lock();try{await this._publishHighStream(r),F.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(u=>"".concat(u.getTrackId()," "))))}catch(u){throw F.error("[".concat(this._clientId,"] publish error"),u.toString()),u}finally{a()}}async unpublish(r){if(!this._joinInfo||this._uid===void 0)throw new Q(K.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");r?Array.isArray(r)||(r=[r]):r=this._p2pChannel.getAllTracks(!0),F.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(a=>"".concat(a.getTrackId()," "))," "));const o=await this._publishMutex.lock();try{const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.unpublish(a,this._uid),F.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(u=>"".concat(u.getTrackId()))))}catch(a){throw F.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{o&&o()}}async subscribe(r,o){return this._subscribe(r,o)}async _subscribe(r,o,a){if(bs(o,"mediaType",["audio","video"]),!this._joinInfo)throw new Q(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(T=>T===r)){const T=new Q(K.INVALID_REMOTE_USER,"user is not in the channel");throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid,", this user is not in the channel")),T}if(!r.hasAudio&&!r.hasVideo){const T=new Q(K.INVALID_REMOTE_USER,"user is not published");throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid,", user is not published")),T}if(!(a||(o!=="audio"||r.hasAudio&&r._audioSSRC!==void 0)&&(o!=="video"||r.hasVideo&&r._videoSSRC!==void 0))){const T=new Q(K.REMOTE_USER_IS_NOT_PUBLISHED);throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid," with mediaType ").concat(o,", remote track is not published")),T}const u=o==="audio"?r._audioSSRC:r._videoSSRC,h=o==="audio"?r._audioOrtc:r._videoOrtc,g=o==="video"?r._rtxSsrcId:void 0,E={stream_type:o==="audio"?Ot.AUDIO:Ot.VIDEO,ssrcId:u},S=await this._subscribeMutex.lock();F.info("[".concat(this._clientId,"] subscribe user ").concat(r.uid,", mediaType: ").concat(o));try{if(await this._p2pChannel.hasRemoteMediaWithLock(r,o))await this._p2pChannel.unmuteRemote(r,o);else try{Ni.markSubscribeStart(this.store.clientId,u),this.store.subscribe(r.uid,o,Date.now()),await this._p2pChannel.subscribe(r,o,u,g,h);try{await this._gateway.subscribe(r.uid,E,!0)}catch(C){if((C==null?void 0:C.code)!==K.WS_ABORT)throw await this._p2pChannel.unsubscribe(r,o),C;await this._p2pChannel.unsubscribe(r,o,!0),this._p2pChannel.setPendingRemoteMedia(r,o)}this.store.subscribe(r.uid,o,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,r,o)}catch(C){throw this._p2pChannel.reportSubscribeEvent(!1,C==null?void 0:C.code,r,o),C}F.info("[".concat(this._clientId,"] subscribe success user ").concat(r.uid,", mediaType: ").concat(o)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(r.uid,this._defaultStreamFallbackType).catch(C=>{F.warning("[".concat(this._clientId,"] auto set fallback failed"),C)});const T=o==="audio"?r._audioTrack:r._videoTrack;if(!T)throw new Q(K.UNEXPECTED_ERROR,"can not find remote track in user object");return T}catch(T){throw F.error("[".concat(this._clientId,"] subscribe user ").concat(r.uid," error"),T),T}finally{S()}}async massSubscribe(r){if(Dc(r,"subscribeList"),!this._joinInfo)throw new Q(K.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(K.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const o=Date.now(),a=new Map,u=await this._subscribeMutex.lock();F.info("[".concat(this._clientId,"]start massSubscribe user ").concat(r.map(S=>{let{user:T,mediaType:C}=S;return"user: ".concat(T==null?void 0:T.uid,", mediaType: ").concat(C)}).join("; ")));const h=(r=[...r]).map(S=>{let{user:T,mediaType:C}=S;return{user:T,mediaType:C}}),g=await this._p2pChannel.globalLock();try{var E;for(let T=r.length-1;T>=0;T--){const C=r[T],{user:w,mediaType:N}=C;if(bs(N,"mediaType",["audio","video"]),!w){const Y=new Q(K.INVALID_PARAMS,"user property does not exist in subscribeList item");throw F.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),Y}if(!this._users.find(Y=>Y===w)){const Y=new Q(K.INVALID_REMOTE_USER,"user is not in the channel");F.error("[".concat(this._clientId,"] can not massSubscribe ").concat(w.uid,", this user is not in the channel")),h[T].error=Y,r.splice(T,1);continue}if(N==="audio"&&(!w.hasAudio||w._audioSSRC===void 0)||N==="video"&&(!w.hasVideo||w._videoSSRC===void 0)){const Y=new Q(K.REMOTE_USER_IS_NOT_PUBLISHED);F.error("[".concat(this._clientId,"] can not subscribe ").concat(w.uid," with mediaType ").concat(N,", remote user is not published")),h[T].error=Y,r.splice(T,1);continue}const M=cr.Video|cr.LwoVideo,U=a.get(w);if(U){if(N==="video"?U&M:U&cr.Audio){r.splice(T,1),F.warning("repeat massSubscribe user:".concat(w.uid,", mediaType:").concat(N," twice"));continue}a.set(w,U|(N==="video"?M:cr.Audio))}else a.set(w,N==="video"?M:cr.Audio)}for(let T=r.length-1;T>=0;T--){const C=r[T],{user:w,mediaType:N}=C,M=cr.Video|cr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(w,N)){await this._p2pChannel.unmuteRemoteNoLock(w,N);const U=a.get(w);a.set(w,N==="video"?U^M:U^cr.Audio),r.splice(T,1)}}this.store.massSubscribe(r.map(T=>({userId:T.user.uid,type:T.mediaType})),o);const S=Iu(E=Array.from(a.entries())).call(E,(T,C)=>{let[w,N]=C;if(N===0)return T;const M={stream_id:w.uid,stream_type:N};return N&cr.Audio&&(M.audio_ssrc=w._audioSSRC),N&cr.Video&&(M.video_ssrc=w._videoSSRC),T.push(M),T},[]);try{r.length>0&&await this._p2pChannel.massSubscribeNoLock(r.map(C=>{let{user:w,mediaType:N}=C;return{user:w,mediaType:N,ssrcId:N===Ot.VIDEO?w._videoSSRC:w._audioSSRC,rtxSsrcId:w._rtxSsrcId}}));const T=new Map;if(S.length>0){const C=await this._gateway.subscribeAll(S,!0);((C==null?void 0:C.users)||[]).forEach(w=>{let{stream_id:N,video_error_code:M,audio_error_code:U,error_code:Y}=w;(M||U||Y)&&T.set(N,{video_error_code:M,audio_error_code:U,error_code:Y})})}if(Array.from(T.entries()).length>0){const C=Array.from(T.entries()).map(w=>{let N,[M,U]=w;return U.error_code||U.video_error_code&&U.audio_error_code?N=void 0:U.video_error_code?N=Ot.VIDEO:U.audio_error_code&&(N=Ot.AUDIO),{user:this.remoteUsers.find(Y=>Y.uid===M),mediaType:N}});await this._p2pChannel.massUnsubscribeNoLock(C)}for(const C of h){const w=T.get(C.user.uid);if(w){const N=w.error_code||C.mediaType==="audio"&&w.audio_error_code||C.mediaType==="video"&&w.video_error_code;if(N){const M=If(N);F.error("user:".concat(C.user.uid," mediaType:").concat(C.mediaType," has massSubscribe error ").concat(M.desc)),C.error=new Q(K.SUBSCRIBE_FAILED,"code ".concat(N,": ").concat(M.desc))}}C.error||(C.mediaType==="video"?C.track=C.user.videoTrack:C.track=C.user.audioTrack)}return this.store.massSubscribe(h.filter(C=>!C.error).map(C=>({userId:C.user.uid,type:C.mediaType})),void 0,Date.now()),h.forEach(C=>{var w;at.subscribe(this.store.sessionId,{succ:!!C.error,ec:((w=C.error)===null||w===void 0?void 0:w.code)||null,video:C.mediaType===Ot.VIDEO,audio:C.mediaType===Ot.AUDIO,peerid:C.user.uid,subscribeRequestid:C.mediaType===Ot.VIDEO?C.user._videoSSRC:C.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-o)},!0)}),F.info("[".concat(this._clientId,"] massSubscribe success ").concat(r.map(C=>{let{user:w,mediaType:N}=C;return"user: ".concat(w==null?void 0:w.uid,", mediaType: ").concat(N)}).join("; "))),h}catch(T){throw await this._p2pChannel.massUnsubscribeNoLock(r),T}}finally{g(),u()}}async unsubscribe(r,o){if(o&&bs(o,"mediaType",["audio","video"]),!this._joinInfo)throw new Q(K.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(a=>a===r)){const a=new Q(K.INVALID_REMOTE_USER,"user is not in the channel");throw F.error("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),a}F.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(r.uid,", mediaType: ").concat(o));try{const a=await this._p2pChannel.unsubscribe(r,o);a&&await this._gateway.unsubscribe(a,r.uid),F.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(r.uid,", mediaType: ").concat(o))}catch(a){if(a.code===K.DISCONNECT_P2P)return void F.warning("disconnecting p2p, abort unsubscribe request.");throw F.error("[".concat(this._clientId,"] unsubscribe user ").concat(r.uid," error"),a.toString()),a}}async massUnsubscribe(r){if(Dc(r,"unsubscribeList"),!this._joinInfo)throw new Q(K.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");F.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(r.map(a=>{let{user:u,mediaType:h}=a;return"user: ".concat(u==null?void 0:u.uid,", mediaType: ").concat(h,";")}).join())),r=[...r];const o=new Map;for(let a=r.length-1;a>=0;a--){const{user:u,mediaType:h}=r[a];if(!u){const E=new Q(K.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw F.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),E}if(bs(h,"mediaType",["video","audio",void 0]),!this._users.find(E=>E===u)){F.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(u.uid,", user is not in the channel")),r.splice(a,1);continue}const g=cr.Video|cr.LwoVideo;if(o.has(u)){const E=o.get(u);let S;switch(h){case"video":S=E&g;break;case"audio":S=E&cr.Audio;break;default:S=E&(cr.Audio|g)}if(S){F.warning("repeat massUnsubscribe user:".concat(u.uid,",mediaType:").concat(h," twice.")),r.splice(a,1);continue}h?h==="audio"?o.set(u,E|cr.Audio):h==="video"&&o.set(u,E|g):o.set(u,E|cr.Audio|g)}else h?h==="audio"?o.set(u,cr.Audio):h==="video"&&o.set(u,g):o.set(u,cr.Audio|g)}try{const a=await this._p2pChannel.massUnsubscribe(r);a&&await this._gateway.massUnsubscribe(a),F.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(r.map(u=>{let{user:h,mediaType:g}=u;return"user: ".concat(h==null?void 0:h.uid,", mediaType: ").concat(g,";")}).join()))}catch(a){if(a.code===K.DISCONNECT_P2P)return void F.warning("disconnecting p2p, abort unsubscribe request.");throw F.error("[".concat(this._clientId,"] massUnsubscribe error"),a.toString()),a}}setLowStreamParameter(r){(function(a){if(!a)throw new Q(K.INVALID_PARAMS);Ln(a.width)||eS(a.width,"streamParameter.width"),Ln(a.height)||eS(a.height,"streamParameter.height"),Ln(a.framerate)||eS(a.framerate,"streamParameter.framerate"),Ln(a.bitrate)||Nn(a.bitrate,"streamParameter.bitrate")})(r),(!r.width&&r.height||r.width&&!r.height)&&F.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),F.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(r));const o=this._configDistribute.getLowStreamConfigDistribute();o&&o.bitrate&&r.bitrate&&o.bitrate<r.bitrate&&(r.bitrate=o.bitrate),this._lowStreamParameter=r}async enableDualStream(){if(!ns().supportDualStream)throw at.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Q(K.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Q(K.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(r){throw at.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),r}this._isDualStreamEnabled=!0,at.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),F.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Q(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Qe.LocalVideoLowTrack))try{const r=await this._p2pChannel.unpublishLowStream();r&&await this._gateway.unpublish(r,this._joinInfo.stringUid||this._joinInfo.uid)}catch(r){throw at.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),r}this._isDualStreamEnabled=!1,at.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),F.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(r,o){if(function(a){bs(a,"role",["audience","host"])}(r),o&&Wx(o),this._mode==="rtc")throw F.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new Q(K.INVALID_OPERATION,"rtc mode can not use setClientRole");if(o&&o.level&&r==="host")throw new Q(K.INVALID_OPERATION,"host mode can not set audience latency level");if(r==="audience"&&this._p2pChannel.hasLocalMedia())throw new Q(K.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(r,o),F.info("[".concat(this._clientId,"] set client role to ").concat(r,", level: ").concat(o&&o.level))}setProxyServer(r,o){if(ms(r,"proxyServer"),!o){if(this.connectionState!=="DISCONNECTED")throw new Q(K.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Q(K.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=r,at.setProxyServer(this._proxyServer),F.setProxyServer(this._proxyServer),F.info("[".concat(this._clientId,"] Set proxy server ").concat(o?"by initialize call":""," success."))}setTurnServer(r,o){if(Array.isArray(r)||(r=[r]),!o){if(this.connectionState!=="DISCONNECTED")throw new Q(K.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Q(K.INVALID_OPERATION,"You have already set the proxy")}if(_f(r))return this._turnServer={servers:r,mode:"original-manual"},void F.info("[".concat(this._clientId,"] Set original turnserver ").concat(o?"by initialize call":""," success: ").concat(r.map(a=>a.urls).join(","),"."));r.forEach(a=>jx(a)),this._turnServer={servers:r,mode:"manual"},F.info("[".concat(this._clientId,"] Set turnserver ").concat(o?"by initialize call":""," success."))}setLicense(r){if(this.connectionState!=="DISCONNECTED")throw new Q(K.INVALID_OPERATION,"you should set license before join channel");if(ms(r,"license",32,32),!/^[A-Za-z\d]+$/.test(r))throw new Q(K.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=r,F.info("[".concat(this._clientId,"] set license success"),r)}startProxyServer(r){if(this.connectionState!=="DISCONNECTED")throw new Q(K.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Q(K.INVALID_OPERATION,"You have already set the proxy");const o=[3,4,5];let a;switch(r===void 0&&(r=3),r){case 1:case 2:throw new Q(K.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:a="proxy3";break;case 4:a="proxy4";break;case 5:a="proxy5";break;default:throw new Q(K.INVALID_PARAMS,"proxy server mode must be ".concat(o.join("|")))}this._cloudProxyServerMode=a,this.store.cloudProxyServerMode=a,F.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Q(K.INVALID_OPERATION,"Stop proxy server after leave channel");at.setProxyServer(),F.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",F.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(r){if(!r.accessPoints)throw new Q(K.INVALID_PARAMS,"accessPoints is required.");Dc(r.accessPoints.serverList,"accessPoints.serverList"),ms(r.accessPoints.domain,"accessPoints.domain");const o=(M,U)=>{Nn(M,U,0,65535,!0)};let a=443;if(r.accessPoints.port&&(o(r.accessPoints.port,"accessPoints.port"),a=r.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Q(K.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");de("CLOSE_AFB_FOR_LOCAL_AP")&&(_n("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),_n("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const u=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,h=r.accessPoints.domain,g=r.accessPoints.serverList.map(M=>u.test(M)?"".concat(M.replace(/\./g,"-"),".").concat(h):M),E=g.map(M=>"".concat(M,":").concat(a));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,_n("WEBCS_DOMAIN",E),_n("WEBCS_DOMAIN_BACKUP_LIST",E),_n("GATEWAY_DOMAINS",[h]),r.report&&r.report.hostname&&Array.isArray(r.report.hostname)&&r.report.hostname.length?(Dc(r.report.hostname,"report.hostname"),_n("EVENT_REPORT_DOMAIN",r.report.hostname[0]),_n("EVENT_REPORT_BACKUP_DOMAIN",r.report.hostname[1]||r.report.hostname[0])):(_n("EVENT_REPORT_DOMAIN",g[0]),_n("EVENT_REPORT_BACKUP_DOMAIN",g[1]||g[0]));let S=6443;r.report&&r.report.port&&(o(r.report.port,"report.port"),S=r.report.port),_n("STATS_COLLECTOR_PORT",S),r.report?_n("ENABLE_EVENT_REPORT",!0):_n("ENABLE_EVENT_REPORT",!1);let T="";r.log&&r.log.hostname&&Array.isArray(r.log.hostname)&&r.log.hostname.length?(Dc(r.log.hostname,"log.hostname"),T=r.log.hostname[0]):T=g[0];let C=6444;r.log&&r.log.port&&(o(r.log.port,"log.port"),C=r.log.port),_n("LOG_UPLOAD_SERVER","".concat(T,":").concat(C));let w=[];r.cds&&r.cds.hostname&&Array.isArray(r.cds.hostname)&&r.cds.hostname.length?(Dc(r.cds.hostname,"cds.hostname"),w=r.cds.hostname):w=g;let N=443;r.cds&&r.cds.port&&(o(r.cds.port,"cds.port"),N=r.cds.port),_n("CDS_AP",w.map(M=>"".concat(M,":").concat(N))),r.cds?_n("ENABLE_CONFIG_DISTRIBUTE",!0):_n("ENABLE_CONFIG_DISTRIBUTE",!1),F.info("set local access point v2 success")}setLocalAccessPoints(r,o){if(Dc(r,"serverList"),ms(o,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Q(K.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const a=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;r=r.map(u=>a.test(u)?"".concat(u.replace(/\./g,"-"),".").concat(o):u),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,_n("WEBCS_DOMAIN",r),_n("WEBCS_DOMAIN_BACKUP_LIST",r),_n("GATEWAY_DOMAINS",[o]),_n("EVENT_REPORT_DOMAIN",r[0]),_n("EVENT_REPORT_BACKUP_DOMAIN",r[1]||r[0]),_n("LOG_UPLOAD_SERVER","".concat(r[0],":6444")),F.info("set local access point success")}async setRemoteDefaultVideoStreamType(r){if(bs(r,"streamType",[0,1]),this._remoteDefaultVideoStreamType=r,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(r),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(o){throw F.error("[".concat(this._clientId,"] set default remote video stream type error"),o.toString()),o}else F.debug("haven't joined yet, cache remoteDefaultVideoStreamType ".concat(r))}async setRemoteVideoStreamType(r,o){bs(o,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(r,o),setTimeout(()=>{const a=this._users.find(u=>u.uid===r);a&&a.videoTrack&&a.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(a){throw F.error("[".concat(this._clientId,"] set remote video stream type error"),a.toString()),a}F.info("[".concat(this._clientId,"] set remote ").concat(r," video stream type to ").concat(o)),this._remoteStreamTypeCacheMap.set(r,o)}async setStreamFallbackOption(r,o){bs(o,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(r,o)}catch(a){throw F.error("[".concat(this._clientId,"] set stream fallback option"),a.toString()),a}F.info("[".concat(this._clientId,"] set remote ").concat(r," stream fallback type to ").concat(o)),this._streamFallbackTypeCacheMap.set(r,o)}setEncryptionConfig(r,o,a){if(function(u){bs(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(r),ms(o,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(r)){if(!a||!(a instanceof Uint8Array&&a.length===32))throw new Q(K.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(a)throw new Q(K.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(o)||F.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=r,this._encryptionSecret=o,a&&(this._encryptionSalt=TE(a))}async renewToken(r){if(ms(r,"token",1,2047),!this._key||!this._joinInfo)throw new Q(K.INVALID_OPERATION,"renewToken should not be called before user join");const o=this._key;this._key=r,this._joinInfo&&(this._joinInfo.token=r);const a=await this._renewTokenMutex.lock();try{if(de("USE_NEW_TOKEN")){F.debug("start renew token with ticket from unilbs");const u=await GK(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Or);F.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:r,ticket:u})}else F.debug("start renew token without ticket"),await this._gateway.renewToken({token:r});F.debug("[".concat(this._clientId,"] renewToken success"))}catch(u){throw this._key=o,this._joinInfo.token=o,F.error("[".concat(this._clientId,"] renewToken failed"),u.toString()),u}finally{a()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?F.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const r=this._p2pChannel.getAudioLevels();this.emit($t.VOLUME_INDICATOR,r)},de("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const r=this._statsCollector.getRTCStats(),o=this._gateway.getInChannelInfo();return r.Duration=Math.round(o.duration/1e3),r}async startLiveStreaming(r,o){if(!o){if(this._codec!=="h264")throw new Q(K.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Q(K.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(r)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(r))throw new Q(K.LIVE_STREAMING_TASK_CONFLICT);const a=o?Sr.TRANSCODE:Sr.RAW;return this._createLiveStreamingClient(a).startLiveStreamingTask(r,a)}setLiveTranscoding(r){return this._createLiveStreamingClient(Sr.TRANSCODE).setTranscodingConfig(r)}async stopLiveStreaming(r){const o=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(a=>a&&a.hasUrl(r));if(!o.length)throw new Q(K.INVALID_PARAMS,"can not find live streaming url to stop");await Je.all(o.map(a=>a&&a.stopLiveStreamingTask(r)))}async addInjectStreamUrl(r,o){if(!this._joinInfo)throw new Q(K.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const a=this._createLiveStreamingClient(Sr.INJECT);a.setInjectStreamConfig(o,0),await a.startLiveStreamingTask(r,Sr.INJECT)}async removeInjectStreamUrl(){var r;const o=this._createLiveStreamingClient(Sr.INJECT),a=Array.from(oc(r=o.streamingTasks).call(r)).find(u=>u.mode===Sr.INJECT);if(!this._joinInfo||!a)throw new Q(K.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await o.stopLiveStreamingTask(a.url)}async startChannelMediaRelay(r){Q3(r),await this._createChannelMediaRelayClient().startChannelMediaRelay(r)}async updateChannelMediaRelay(r){Q3(r),await this._createChannelMediaRelayClient().updateChannelMediaRelay(r)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay()}sendStreamMessage(r){let o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Q(K.INVALID_OPERATION,"can not send data stream, not joined");if(typeof r=="string"&&(r=new TextEncoder().encode(r)),new Blob([r]).size>1024)throw new Q(K.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(Et.DATA_STREAM,{payload:TE(r)},!o)}sendMetadata(r){if(!this._joinInfo)throw new Q(K.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([r]).size>1024)throw new Q(K.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Et.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:TE(r)})}async sendCustomReportMessage(r){if(Array.isArray(r)||(r=[r]),r.forEach(oH),!this._joinInfo)throw new Q(K.INVALID_OPERATION,"can not send custom report, not joined");await at.sendCustomReportMessage(this._joinInfo.sid,r)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(r,o){bs(o.spatialLayer,"spatialLayer",[0,1,2,3]),bs(o.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(r,o)}catch(a){throw F.error("[".concat(this._clientId,"] pick SVC layer failed"),a.toString()),a}}_reset(){if(F.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Ji.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach(r=>{r._audioTrack&&r._audioTrack._destroy(),r._videoTrack&&r._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new js("client-publish"),this._subscribeMutex=new js("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}}_startSession(r,o){const a=r||RS();r?F.debug("[".concat(this._clientId,"] new Session ").concat(a)):F.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a)),this._sessionId=a,this.store.sessionId=a,o?at.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:o.channel,appid:o.appId,mode:this._mode}):this._joinInfo?at.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&at.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(r){if(!this._joinInfo||this._uid===void 0)throw new Q(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(K.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&de("FORCE_TURN")&&!de("TURN_ENABLE_TCP")&&!de("TURN_ENABLE_UDP"))throw new Q(K.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");F.debug("[".concat(this._clientId,"] publish high stream"));try{const a=await this._p2pChannel.publish(r,this._isDualStreamEnabled,this._lowStreamParameter),u=(await a.next()).value;if(u){var o;let h;try{h=await this._gateway.publish(this._uid,u,!0)}catch(g){if(g.code!==K.DISCONNECT_P2P)throw a.throw(g),g}await a.next(((o=h)===null||o===void 0?void 0:o.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const h of r)h instanceof dr&&h._encoderConfig&&this._gateway.setVideoProfile(h._encoderConfig),!h.muted&&h.enabled||await this._p2pChannel.muteLocalTrack(h)}catch(a){if(this._p2pChannel.reportPublishEvent(!1,a==null?void 0:a.code,r),(a==null?void 0:a.code)===K.WS_ABORT)return;throw a}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Q(K.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Q(K.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));F.debug("[".concat(this._clientId,"] publish low stream"));const r=this._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&r.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=r.bitrate));try{const a=await this._p2pChannel.publishLowStream(this._lowStreamParameter),u=(await a.next()).value;if(u){var o;let h;try{h=await this._gateway.publish(this._uid,u,!0)}catch(g){if(g.code!==K.DISCONNECT_P2P)throw a.throw(g),g}a.next(((o=h)===null||o===void 0?void 0:o.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(a){if(this._p2pChannel.reportPublishEvent(!1,a==null?void 0:a.code,void 0,!0),(a==null?void 0:a.code)===K.WS_ABORT)return;throw a}}_createLiveStreamingClient(r){if(!this._joinInfo||!this._appId)return new Q(K.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const o=()=>new KK(this._joinInfo,this._config.websocketRetryConfig||Or,this._config.httpRetryConfig||Or),a=u=>{u.onLiveStreamError=(h,g)=>{at.reportApiInvoke(this._sessionId,{name:vr.ON_LIVE_STREAM_ERROR,options:[h,g],tag:jn.TRACER}).onSuccess(),this.emit($t.LIVE_STREAMING_ERROR,h,g)},u.onLiveStreamWarning=(h,g)=>{at.reportApiInvoke(this._sessionId,{name:vr.ON_LIVE_STREAM_WARNING,options:[h,g],tag:jn.TRACER}).onSuccess(),this.emit($t.LIVE_STREAMING_WARNING,h,g)},u.on(wh.REQUEST_WORKER_MANAGER_LIST,(h,g,E)=>{if(!this._joinInfo)return E(new Q(K.INVALID_OPERATION,"can not find join info to get worker manager"));H3(h,this._joinInfo,this._axiosCancelSource.token,Or).then(g).catch(E)})};switch(r){case Sr.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=o(),a(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Sr.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=o(),a(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Sr.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=o(),this._injectStreamingClient.on(wh.REQUEST_WORKER_MANAGER_LIST,(u,h,g)=>{if(!this._joinInfo)return g(new Q(K.INVALID_OPERATION,"can not find join info to get worker manager"));H3(u,this._joinInfo,this._axiosCancelSource.token,Or).then(h).catch(g)}),this._injectStreamingClient.onInjectStatusChange=(u,h,g)=>{this.emit($t.INJECT_STREAM_STATUS,u,h,g)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new XK(this._joinInfo,this._clientId,this._config.websocketRetryConfig||Or,this._config.httpRetryConfig||Or),this._channelMediaRelayClient.on("state",r=>{r===ro.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit($t.CHANNEL_MEDIA_RELAY_STATE,r)}),this._channelMediaRelayClient.on("event",r=>{this.emit($t.CHANNEL_MEDIA_RELAY_EVENT,r)})),this._channelMediaRelayClient):new Q(K.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(Vn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Vn.CONNECTION_STATE_CHANGE,(r,o,a)=>{var u;if(a===nn.FALLBACK)return;const h=()=>{this.emit($t.CONNECTION_STATE_CHANGE,r,o,a)};if(at.reportApiInvoke(this._sessionId||((u=this._gateway.joinInfo)===null||u===void 0?void 0:u.sid)||null,{name:vr.CONNECTION_STATE_CHANGE,options:[r,o,a],tag:jn.TRACER}).onSuccess(JSON.stringify({cur:r,prev:o,reason:a})),F.info("[".concat(this._clientId,"] connection state change: ").concat(o," -> ").concat(r)),r==="DISCONNECTED")return this._reset(),void h();if(r==="RECONNECTING")this._users.forEach(E=>{E._trust_in_room_=!1,E._trust_audio_enabled_state_=!1,E._trust_video_enabled_state_=!1,E._trust_audio_mute_state_=!1,E._trust_video_mute_state_=!1,E._trust_audio_stream_added_state_=!1,E._trust_video_stream_added_state_=!1,E._audioSSRC=void 0,E._videoSSRC=void 0,E._videoOrtc=void 0,E._audioOrtc=void 0,E._cname=void 0,E._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(r==="CONNECTED"){var g;this._streamFallbackTypeCacheMap.forEach((E,S)=>{this._gateway.setStreamFallbackOption(S,E).catch(T=>{F.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),T)})}),this._remoteStreamTypeCacheMap.forEach((E,S)=>{this._gateway.setRemoteVideoStreamType(S,E).catch(T=>{F.warning("[".concat(this._clientId,"] auto set remote stream type failed"),T)})}),this._remoteDefaultVideoStreamType!==void 0&&((g=this._joinInfo)===null||g===void 0?void 0:g.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{F.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(E=>{F.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(E))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(E=>!E._trust_in_room_).forEach(E=>{F.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(E.uid)),this._handleUserOffline({uid:E.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(E=>{E._trust_audio_mute_state_||(F.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(E.uid)),this._handleMuteStream(E.uid,"audio",!1)),E._trust_video_mute_state_||(F.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(E.uid)),this._handleMuteStream(E.uid,"video",!1)),E._trust_audio_enabled_state_||(F.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(E.uid)),this._handleSetStreamLocalEnable("audio",E.uid,!0)),E._trust_video_enabled_state_||(F.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(E.uid)),this._handleSetStreamLocalEnable("video",E.uid,!0)),E._trust_video_stream_added_state_||(F.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(E.uid)),this._handleResetAddStream(E,"video")),E._trust_audio_stream_added_state_||(F.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(E.uid)),this._handleResetAddStream(E,"audio")),E._video_added_||E._audio_added_||(F.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(E.uid)),this._handleRemoveStream({uid:E.uid,uint_id:E._uintid}))}))},1e3)}h()}),this._gateway.on(Vn.REQUEST_NEW_GATEWAY_LIST,(r,o)=>{if(!this._joinInfo)return o(new Q(K.UNEXPECTED_ERROR,"can not recover, no join info"));LS(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Or,this.store).then(a=>{this._joinInfo&&(this._joinInfo.apResponse=a.gatewayInfo.res,this._joinInfo.gatewayAddrs=a.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=a.gatewayInfo.uni_lbs_ip),r(a.gatewayInfo.gatewayAddrs.map(u=>{if(this._joinInfo&&this._joinInfo.proxyServer){const h=u.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(h[0],"&p=").concat(h[1])}return"wss://".concat(u.address)}))}).catch(o)}),this._gateway.on(Vn.NETWORK_QUALITY,r=>{this._networkQualitySensitivity==="normal"&&this.emit($t.NETWORK_QUALITY,r)}),this._gateway.on(Vn.STREAM_TYPE_CHANGE,(r,o)=>{this.emit($t.STREAM_TYPE_CHANGED,r,o),at.reportApiInvoke(this._sessionId,{name:vr.STREAM_TYPE_CHANGE,options:[r,o],tag:jn.TRACER}).onSuccess(JSON.stringify({uid:r,streamType:o}))}),this._gateway.on(Vn.IS_P2P_DISCONNECTED,r=>{this._p2pChannel.isP2PDisconnected()?r(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?r(!1):r(!0)}),this._gateway.on(Vn.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(Vn.REQUEST_P2P_CONNECTION_PARAMS,async(r,o,a)=>{try{o(await this._p2pChannel.startP2PConnection(r))}catch(u){a(u)}}),this._gateway.on(Vn.JOIN_RESPONSE,(r,o)=>{const{dtlsParameters:a,iceParameters:u,candidates:h,rtpCapabilities:g,setup:E,cname:S}=_P(r.ortc,o);this._p2pChannel.connect(u,a,h,g,E,S)}),this._gateway.on(Vn.REQUEST_DC_CONNECTION_PARAMS,r=>{r(this._p2pChannel.getEstablishParams())}),this._gateway.on(Vn.RESET_SIGNAL,r=>{this._p2pChannel.resetConnection(r),this._handleGatewaySignalEvents()}),this._gateway.on(Vn.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(Vn.DATACHANNEL_PRECONNECT,async(r,o,a,u)=>{var h,g,E,S,T,C;await this._p2pChannel.startP2PConnection({turnServer:(h=this._joinInfo)===null||h===void 0?void 0:h.turnServer},!0);const w=function(N,M){let U;return M&&M.ip&&typeof M.port=="number"?(U=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:M.ip,port:M.port.toString(),type:"host",extension:{}}],F.debug("Using remote candidate from AP ".concat(M.ip,":").concat(M.port)),M.ip6&&(U.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:M.ip6,port:M.port.toString(),type:"host",extension:{}}),F.debug("Using IPV6 remote candidate from AP ".concat(M.ip6,":").concat(M.port)))):U=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:N.ip,port:N.port.toString(),type:"host",extension:{}}],U}(r,o);return this._p2pChannel.preConnect({iceUfrag:"".concat((g=this._joinInfo)===null||g===void 0?void 0:g.apResponse.cid,"_").concat((E=this._joinInfo)===null||E===void 0?void 0:E.apResponse.cert),icePwd:"".concat((S=this._joinInfo)===null||S===void 0?void 0:S.apResponse.cid,"_").concat((T=this._joinInfo)===null||T===void 0?void 0:T.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(C=de("FINGERPRINT"))!==null&&C!==void 0?C:r.fingerprint}]},w,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(a).catch(u)})}_handleGatewaySignalEvents(){this._gateway.signal.on(Mt.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Mt.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Mt.ON_ADD_AUDIO_STREAM,r=>this._handleAddAudioOrVideoStream("audio",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc)),this._gateway.signal.on(Mt.ON_ADD_VIDEO_STREAM,r=>this._handleAddAudioOrVideoStream("video",r.uid,r.ssrcId,r.cname,r.uint_id,r.ortc,r.rtxSsrcId)),this._gateway.signal.on(Mt.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Mt.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Mt.MUTE_AUDIO,r=>this._handleMuteStream(r.uid,"audio",!0)),this._gateway.signal.on(Mt.UNMUTE_AUDIO,r=>this._handleMuteStream(r.uid,"audio",!1)),this._gateway.signal.on(Mt.MUTE_VIDEO,r=>this._handleMuteStream(r.uid,"video",!0)),this._gateway.signal.on(Mt.UNMUTE_VIDEO,r=>this._handleMuteStream(r.uid,"video",!1)),this._gateway.signal.on(Mt.RECEIVE_METADATA,r=>{const o=NS(r.metadata);this.emit($t.RECEIVE_METADATA,r.uid,o)}),this._gateway.signal.on(Mt.ON_DATA_STREAM,r=>{r.seq&&delete r.seq,r.payload=NS(r.payload),this.emit($t.STREAM_MESSAGE,r.uid,r.payload),this.onStreamMessage&&this.onStreamMessage(r)}),this._gateway.signal.on(Mt.ON_CRYPT_ERROR,()=>{Sf(()=>{F.warning("[".concat(this._clientId,"] on crypt error")),this.emit($t.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Mt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Mt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{F.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.emit($t.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Mt.ON_STREAM_FALLBACK_UPDATE,r=>{F.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(r.stream_id,", attr: ").concat(r.stream_type)),this.emit($t.STREAM_FALLBACK,r.stream_id,r.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Mt.ON_PUBLISH_STREAM,r=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:r.proxy})),F.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(r))))}),this._gateway.signal.on(Mt.ENABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!0)}),this._gateway.signal.on(Mt.DISABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!1)}),this._gateway.signal.on(it.REQUEST_TIMEOUT,(r,o)=>{if(this._joinInfo)switch(r){case Et.PUBLISH:{if(!o)return;const E=(o=o).ortc;if(E){var a,u,h,g;const S=E.some(w=>{let{stream_type:N}=w;return N===Tr.Audio}),T=E.some(w=>{let{stream_type:N}=w;return N!==Tr.Audio}),C=E.some(w=>{let{stream_type:N}=w;return N===Tr.Screen||N===Tr.ScreenLow});o.state==="offer"&&at.publish(this._joinInfo.sid,{eventElapse:Ni.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:K.TIMEOUT,audio:S,video:T,p2pid:o.p2p_id,publishRequestid:this.store.pubId,screenshare:C,audioName:S?(a=E.find(w=>{let{stream_type:N}=w;return N===Tr.Audio}))===null||a===void 0||(u=a.ssrcs[0])===null||u===void 0?void 0:u.ssrcId.toString():void 0,videoName:T?(h=E.find(w=>{let{stream_type:N}=w;return N!==Tr.Audio}))===null||h===void 0||(g=h.ssrcs[0])===null||g===void 0?void 0:g.ssrcId.toString():void 0})}break}case Et.SUBSCRIBE:(o=o)&&at.subscribe(this._joinInfo.sid,{succ:!1,ec:K.TIMEOUT,audio:o.stream_type===Ot.AUDIO,video:o.stream_type===Ot.VIDEO,peerid:o.stream_id,subscribeRequestid:o.ssrcId,p2pid:this.store.p2pId,eventElapse:Ni.measureFromSubscribeStart(this.store.clientId,o.ssrcId)})}}),this._gateway.signal.on(Mt.ON_P2P_OK,r=>{this.uid,this._uid}),this._gateway.signal.on(Mt.ON_PUBLISHED_USER_LIST,r=>{if(r==null||!r.users)return;const o=[],a=[];for(const u of r.users){let h=this._users.find(C=>C.uid===u.stream_id);h?h._trust_in_room_=!0:(h=new US(u.stream_id,u.stream_id),this._users.push(h),this.getListeners($t.PUBLISHED_USER_LIST).length===0&&(F.debug("[".concat(this._clientId,"] user online"),u.stream_id),this.emit($t.USER_JOINED,h)));const g=cr.Audio&u.stream_type,E=(cr.Video|cr.LwoVideo)&u.stream_type,S=g&&h.hasAudio,T=E&&h.hasVideo;E&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0,h._videoSSRC=u.video_ssrc),g&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0,h._audioSSRC=u.audio_ssrc),g&&!S&&this.getListeners($t.PUBLISHED_USER_LIST).length===0&&(F.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published audio")),this.emit($t.USER_PUBLISHED,h,"audio")),E&&!T&&this.getListeners($t.PUBLISHED_USER_LIST).length===0&&(F.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published video")),this.emit($t.USER_PUBLISHED,h,"video")),(g&&!S||E&&!T)&&o.push(h),E&&this._p2pChannel.hasPendingRemoteMedia(h,"video")&&a.push({user:h,mediaType:"video"}),g&&this._p2pChannel.hasPendingRemoteMedia(h,"audio")&&a.push({user:h,mediaType:"audio"})}a.length>0&&(F.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(a.map(u=>"user: ".concat(u.user.uid,", mediaType: ").concat(u.mediaType)).join("; ")," ")),this.massSubscribe(a).catch(u=>{F.error("[".concat(this._clientId,"] mass resubscribe error"),u.toString())})),this.getListeners($t.PUBLISHED_USER_LIST).length>0?(F.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(o.map(u=>u.uid).join(", "))),this.emit($t.PUBLISHED_USER_LIST,o)):F.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(o.map(u=>u.uid).join(", ")))})}_handleP2PChannelEvents(){this._p2pChannel.on(Jt.RequestMuteLocal,async(r,o,a)=>{if(this._joinInfo)try{await this._gateway.muteLocal(r,this._joinInfo.stringUid||this._joinInfo.uid),o()}catch(u){u.code===K.DISCONNECT_P2P?o():a(u)}else o()}),this._p2pChannel.on(Jt.RequestUnmuteLocal,async(r,o,a)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(r,this._joinInfo.stringUid||this._joinInfo.uid),o()}catch(u){u.code===K.DISCONNECT_P2P?o():a(u)}else o()}),this._p2pChannel.on(Jt.RequestRePublish,(r,o,a)=>{this.publish(r,!1).then(o).catch(a)}),this._p2pChannel.on(Jt.RequestReSubscribe,async(r,o,a)=>{try{for(const{user:u,kind:h}of r)h===Ot.VIDEO?await this.subscribe(u,"video"):await this.subscribe(u,"audio");o()}catch(u){a(u)}}),this._p2pChannel.on(Jt.RequestUploadStats,(r,o)=>{this._gateway.uploadStats(r,o)}),this._p2pChannel.on(Jt.MediaReconnectStart,r=>{this.emit($t.MEDIA_RECONNECT_START,r)}),this._p2pChannel.on(Jt.MediaReconnectEnd,r=>{this.emit($t.MEDIA_RECONNECT_END,r)}),this._p2pChannel.on(Jt.NeedSignalRTT,r=>{r(this._gateway.getSignalRTT())}),this._p2pChannel.on(Jt.RequestRestartICE,async()=>{const r=await this._p2pChannel.restartICE(),o=await r.next();if(o.done)return;const a=o.value;let u;try{u=await this._gateway.restartICE({iceParameters:a})}catch(g){return void r.throw(g)}const{iceParameters:h}=function(g){const E=g.iceParameters;return{iceParameters:{iceUfrag:E.iceUfrag,icePwd:E.icePwd}}}(u);await r.next({remoteIceParameters:h})}),this._p2pChannel.on(Jt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Jt.RequestReconnectPC,async()=>{var r;const{iceParameters:o,dtlsParameters:a,rtpCapabilities:u}=await this._p2pChannel.startP2PConnection({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer}),{gatewayEstablishParams:h,gatewayAddress:g}=await this._gateway.reconnectPC({iceParameters:o,dtlsParameters:a,rtpCapabilities:u}),{dtlsParameters:E,iceParameters:S,candidates:T,rtpCapabilities:C,setup:w,cname:N}=_P(h,g);await this._p2pChannel.connect(S,E,T,C,w,N),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Jt.RequestUnpublishForReconnectPC,async(r,o,a)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(r,this._uid),o()):a()}),this._p2pChannel.on(Jt.P2PLost,()=>{this.emit($t.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Jt.UpdateVideoEncoder,r=>{r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig)}),this._p2pChannel.on(Jt.ConnectionTypeChange,r=>{this.emit($t.IS_USING_CLOUD_PROXY,r)}),this._p2pChannel.on(Jt.RequestLowStreamParameter,r=>{r(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Jt.QueryClientConnectionState,r=>{r(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(r){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new Q(K.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new Q(K.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!r)throw new Q(K.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!r.inspectType||!Array.isArray(r.inspectType))throw new Q(K.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const o=[...new Set(r.inspectType)];o.forEach(a=>{if(!["supervise","moderation"].includes(a))throw new Q(K.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(a," is not a valid inspect type."))}),r.inspectType=o}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new Q(K.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const o=new VE(r);this._inspect=o,this.handleVideoInspectEvents(this._inspect),await o.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},Or)}catch(o){throw Array.isArray(o)?o[0]:o}}async disableContentInspect(){if(!this._inspect)throw new Q(K.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}handleVideoInspectEvents(r){r.on(Ir.CONNECTION_STATE_CHANGE,(o,a)=>{switch(this.emit($t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,o,a),a){case Zo.CONNECTED:if(this.connectionState!=="CONNECTED")return void this.emit($t.CONTENT_INSPECT_ERROR,new Q(K.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));r.inspectImage()}}),r.on(Ir.INSPECT_RESULT,(o,a)=>{var u;if((a==null?void 0:a.code)===K.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return F.debug("Stop inspect content because that has left channel"),this==null||(u=this._inspect)===null||u===void 0||u.close(),void(this._inspect=void 0);this.emit($t.CONTENT_INSPECT_RESULT,o,a)}),r.on(Ir.CLIENT_LOCAL_VIDEO_TRACK,o=>{o(this.localTracks.filter(a=>a.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return F.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(r){gf(r,"enabled"),_n("ENABLE_PUBLISH_AUDIO_FILTER",r),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(r)}_handleResetAddStream(r,o){switch(o){case"audio":r._audio_added_=!1,r._trust_audio_stream_added_state_=!0;break;case"video":r._video_added_=!1,r._trust_video_stream_added_state_=!0}}}).prototype,"leave",[d4],Object.getOwnPropertyDescriptor(He.prototype,"leave"),He.prototype),Ne(He.prototype,"publish",[h4],Object.getOwnPropertyDescriptor(He.prototype,"publish"),He.prototype),Ne(He.prototype,"unpublish",[p4],Object.getOwnPropertyDescriptor(He.prototype,"unpublish"),He.prototype),Ne(He.prototype,"subscribe",[f4],Object.getOwnPropertyDescriptor(He.prototype,"subscribe"),He.prototype),Ne(He.prototype,"massSubscribe",[m4],Object.getOwnPropertyDescriptor(He.prototype,"massSubscribe"),He.prototype),Ne(He.prototype,"unsubscribe",[g4],Object.getOwnPropertyDescriptor(He.prototype,"unsubscribe"),He.prototype),Ne(He.prototype,"massUnsubscribe",[E4],Object.getOwnPropertyDescriptor(He.prototype,"massUnsubscribe"),He.prototype),Ne(He.prototype,"setLowStreamParameter",[_4],Object.getOwnPropertyDescriptor(He.prototype,"setLowStreamParameter"),He.prototype),Ne(He.prototype,"enableDualStream",[y4],Object.getOwnPropertyDescriptor(He.prototype,"enableDualStream"),He.prototype),Ne(He.prototype,"disableDualStream",[v4],Object.getOwnPropertyDescriptor(He.prototype,"disableDualStream"),He.prototype),Ne(He.prototype,"setClientRole",[S4],Object.getOwnPropertyDescriptor(He.prototype,"setClientRole"),He.prototype),Ne(He.prototype,"setProxyServer",[T4],Object.getOwnPropertyDescriptor(He.prototype,"setProxyServer"),He.prototype),Ne(He.prototype,"setTurnServer",[I4],Object.getOwnPropertyDescriptor(He.prototype,"setTurnServer"),He.prototype),Ne(He.prototype,"setLicense",[C4],Object.getOwnPropertyDescriptor(He.prototype,"setLicense"),He.prototype),Ne(He.prototype,"startProxyServer",[w4],Object.getOwnPropertyDescriptor(He.prototype,"startProxyServer"),He.prototype),Ne(He.prototype,"stopProxyServer",[R4],Object.getOwnPropertyDescriptor(He.prototype,"stopProxyServer"),He.prototype),Ne(He.prototype,"setLocalAccessPointsV2",[b4],Object.getOwnPropertyDescriptor(He.prototype,"setLocalAccessPointsV2"),He.prototype),Ne(He.prototype,"setLocalAccessPoints",[N4],Object.getOwnPropertyDescriptor(He.prototype,"setLocalAccessPoints"),He.prototype),Ne(He.prototype,"setRemoteDefaultVideoStreamType",[A4],Object.getOwnPropertyDescriptor(He.prototype,"setRemoteDefaultVideoStreamType"),He.prototype),Ne(He.prototype,"setRemoteVideoStreamType",[O4],Object.getOwnPropertyDescriptor(He.prototype,"setRemoteVideoStreamType"),He.prototype),Ne(He.prototype,"setStreamFallbackOption",[x4],Object.getOwnPropertyDescriptor(He.prototype,"setStreamFallbackOption"),He.prototype),Ne(He.prototype,"setEncryptionConfig",[k4],Object.getOwnPropertyDescriptor(He.prototype,"setEncryptionConfig"),He.prototype),Ne(He.prototype,"renewToken",[D4],Object.getOwnPropertyDescriptor(He.prototype,"renewToken"),He.prototype),Ne(He.prototype,"enableAudioVolumeIndicator",[P4],Object.getOwnPropertyDescriptor(He.prototype,"enableAudioVolumeIndicator"),He.prototype),Ne(He.prototype,"startLiveStreaming",[L4],Object.getOwnPropertyDescriptor(He.prototype,"startLiveStreaming"),He.prototype),Ne(He.prototype,"setLiveTranscoding",[M4],Object.getOwnPropertyDescriptor(He.prototype,"setLiveTranscoding"),He.prototype),Ne(He.prototype,"stopLiveStreaming",[$4],Object.getOwnPropertyDescriptor(He.prototype,"stopLiveStreaming"),He.prototype),Ne(He.prototype,"addInjectStreamUrl",[F4],Object.getOwnPropertyDescriptor(He.prototype,"addInjectStreamUrl"),He.prototype),Ne(He.prototype,"removeInjectStreamUrl",[U4],Object.getOwnPropertyDescriptor(He.prototype,"removeInjectStreamUrl"),He.prototype),Ne(He.prototype,"startChannelMediaRelay",[V4],Object.getOwnPropertyDescriptor(He.prototype,"startChannelMediaRelay"),He.prototype),Ne(He.prototype,"updateChannelMediaRelay",[B4],Object.getOwnPropertyDescriptor(He.prototype,"updateChannelMediaRelay"),He.prototype),Ne(He.prototype,"stopChannelMediaRelay",[j4],Object.getOwnPropertyDescriptor(He.prototype,"stopChannelMediaRelay"),He.prototype),Ne(He.prototype,"sendCustomReportMessage",[W4],Object.getOwnPropertyDescriptor(He.prototype,"sendCustomReportMessage"),He.prototype),Ne(He.prototype,"pickSVCLayer",[G4],Object.getOwnPropertyDescriptor(He.prototype,"pickSVCLayer"),He.prototype),Ne(He.prototype,"enableContentInspect",[z4],Object.getOwnPropertyDescriptor(He.prototype,"enableContentInspect"),He.prototype),Ne(He.prototype,"disableContentInspect",[H4],Object.getOwnPropertyDescriptor(He.prototype,"disableContentInspect"),He.prototype),Ne(He.prototype,"getJoinChannelServiceRecords",[K4],Object.getOwnPropertyDescriptor(He.prototype,"getJoinChannelServiceRecords"),He.prototype),Ne(He.prototype,"setPublishAudioFilterEnabled",[q4],Object.getOwnPropertyDescriptor(He.prototype,"setPublishAudioFilterEnabled"),He.prototype),He);class dX extends Ek{set currentState(o){o!==this._currentState&&(this._currentState=o,this.emit(So.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(o){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),k(this,"audioBuffer",void 0),k(this,"sourceNode",void 0),k(this,"startPlayTime",0),k(this,"startPlayOffset",0),k(this,"pausePlayTime",0),k(this,"options",void 0),k(this,"currentLoopCount",0),k(this,"_currentState","stopped"),this.audioBuffer=o,this.options=a,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(o){this.currentState==="stopped"?(this.options=o,this.startPlayOffset=this.options.startPlayTime||0):F.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(o){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=o,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=o))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const o=this.context.createBufferSource();return o.buffer=this.audioBuffer,o.loop=!!this.options.loop,o.connect(this.outputNode),o}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Y4=new Map;async function hX(r,o){let a=null;if(typeof r=="string"){const h=Y4.get(r);if(h)return F.debug("use cached audio resource: ",r),h;try{a=(await nc(()=>Ji.get(r,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(g){throw new Q(K.FETCH_AUDIO_FILE_FAILED,g.toString())}}else a=await new Je((g,E)=>{const S=new FileReader;S.onload=T=>{T.target?g(T.target.result):E(new Q(K.READ_LOCAL_AUDIO_FILE_ERROR))},S.onerror=()=>{E(new Q(K.READ_LOCAL_AUDIO_FILE_ERROR))},S.readAsArrayBuffer(r)});const u=await function(h){const g=Nh();return new Je((E,S)=>{g.decodeAudioData(h,T=>{E(T)},T=>{S(new Q(K.DECODE_AUDIO_FILE_FAILED,T.toString()))})})}(a);return typeof r=="string"&&o&&Y4.set(r,u),u}function J4(r,o){var a=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);o&&(u=u.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),a.push.apply(a,u)}return a}function BE(r){for(var o=1;o<arguments.length;o++){var a=arguments[o]!=null?arguments[o]:{};o%2?J4(Object(a),!0).forEach(function(u){k(r,u,a[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):J4(Object(a)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(a,u))})}return r}function vT(r,o,a,u){a.optimizationMode&&(u&&u.width&&u.height?(a.encoderConfig=BE(BE({},u),{},{bitrateMin:u.bitrateMin,bitrateMax:u.bitrateMax}),a.optimizationMode!=="motion"&&a.optimizationMode!=="detail"||(o.contentHint=a.optimizationMode,o.contentHint===a.optimizationMode?F.debug("[".concat(r,"] set content hint to"),a.optimizationMode):F.debug("[".concat(r,"] set content hint failed")))):F.warning("[".concat(r,"] can not apply optimization mode bitrate config, no encoderConfig")))}const pX=Sn().name;function fX(r,o,a,u){let h,g=0,E=null;return new Je((S,T)=>{setTimeout(()=>{h&&(h(),S(g))},o),h=mk(()=>{(function(){g>u&&h&&(h(),S(g));const C=a.getContext("2d");if(!C){const M=new Q(K.UNEXPECTED_ERROR,"can not get canvas 2d context.");return F.error(M.toString()),void T(M)}C.drawImage(r,0,0,160,120);const w=C.getImageData(0,0,a.width,a.height),N=Math.floor(w.data.length/3);if(E){for(let M=0;M<N;M+=3)if(w.data[M]!==E[M])return g+=1,void(E=w.data);E=w.data}else E=w.data})()},30)})}class Uf{constructor(o,a){k(this,"id",0),k(this,"element",void 0),k(this,"peerPair",void 0),k(this,"context",void 0),k(this,"audioPlayerElement",void 0),k(this,"audioTrack",void 0),Uf.count+=1,this.id=Uf.count,this.element=o,this.context=a}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=o=>{const a=document.createElement("audio");a.srcObject=new MediaStream([o.track]),a.play(),this.audioPlayerElement=a}}async switchSdp(){if(!this.peerPair)return;const o=async(u,h)=>{const g=h==="offer"?await u.createOffer():await u.createAnswer();return await u.setLocalDescription(g),u.iceGatheringState==="complete"?u.localDescription:new Je(E=>{u.onicegatheringstatechange=()=>{u.iceGatheringState==="complete"&&E(u.localDescription)}})},a=async(u,h)=>await u.setRemoteDescription(h);try{const u=await o(this.peerPair[0],"offer");await a(this.peerPair[1],u);const h=await o(this.peerPair[1],"answer");await a(this.peerPair[0],h)}catch(u){throw new Q(K.LOCAL_AEC_ERROR,u.toString()).print()}}async getTracksFromMediaElement(o){if(this.audioTrack)return this.audioTrack;let a;try{o instanceof HTMLVideoElement&&(o.captureStream?o.captureStream():o.mozCaptureStream()),a=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(o).connect(a)}catch(h){throw new Q(K.LOCAL_AEC_ERROR,h.toString()).print()}if(!a)throw new Q(K.LOCAL_AEC_ERROR,"no dest node when local aec").print();const u=a.stream.getAudioTracks()[0];return this.audioTrack=u,u}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const o=this.element,a=await this.getTracksFromMediaElement(o);this.peerPair&&this.peerPair[0].addTrack(a),await this.switchSdp()}close(){F.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(o=>{o.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var Q4,jE;k(Uf,"count",0);const mX=window.AudioContext||window.webkitAudioContext,gX=new(Q4=pt({report:at}),Ne((jE=class{constructor(){k(this,"units",[]),k(this,"context",void 0)}processExternalMediaAEC(r){if(!this._doesEnvironmentNeedAEC())return F.debug("the system does not need to process local aec"),-1;this.context||(this.context=new mX);let o=this.units.find(a=>a&&a.getElement()===r);return o||(o=new Uf(r,this.context),this.units.push(o)),o.startEchoCancellation(),F.debug("start processing local audio echo cancellation, id is",o.id),o.id}_doesEnvironmentNeedAEC(){return Sn().name!==En.SAFARI}}).prototype,"processExternalMediaAEC",[Q4],Object.getOwnPropertyDescriptor(jE.prototype,"processExternalMediaAEC"),jE.prototype),jE);_n("PROCESS_ID","process-".concat(Kn(8,""),"-").concat(Kn(4,""),"-").concat(Kn(4,""),"-").concat(Kn(4,""),"-").concat(Kn(12,""))),function(){const r=Sn();Bs.getDisplayMedia=function(o){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),Bs.getStreamFromExtension=r.name===En.CHROME&&Number(r.version)>34,Bs.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const o=new RTCPeerConnection;let a=!1;try{o.addTransceiver("audio"),a=!0}catch{}return o.close(),a}(),Bs.supportMinBitrate=r.name===En.CHROME||r.name===En.EDGE,Bs.supportSetRtpSenderParameters=function(){const o=Sn();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!Gl()||!(!Vo()&&!Jg())||o.name===En.FIREFOX&&Number(o.version)>=64}(),r.name===En.SAFARI&&(Number(r.version)>=14?Bs.supportDualStream=!0:Bs.supportDualStream=!1),Bs.webAudioMediaStreamDest=function(){const o=Sn();return!(o.name===En.SAFARI&&Number(o.version)<12)}(),Bs.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),Bs.supportWebGL=typeof WebGLRenderingContext<"u",Bs.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Gl()||(Bs.webAudioWithAEC=!0),Bs.supportShareAudio=function(){const o=Sn();return(o.os===Rs.WIN_10||o.os===Rs.WIN_81||o.os===Rs.WIN_7||o.os===Rs.LINUX||o.os===Rs.MAC_OS)&&o.name===En.CHROME&&Number(o.version)>=74}(),Bs.supportDualStreamEncoding=function(){const o=Sn();return de("DISABLE_WEBAUDIO")?!0:o.name==="Safari"&&Number(o.version)>=14||!!(o.name==="Chrome"&&/Windows/i.test(o.os||"")&&Number(o.version)>=100&&de("CHROME_DUAL_STREAM_USE_ENCODING"))}(),Bs.supportDataChannel=function(){return!!(function(o){const a=Sn();return!(a.name!==En.CHROME||!a.osVersion)&&Number(a.version)>=o}(76)||function(o){const a=Sn();return!(a.name!==En.FIREFOX||!a.osVersion)&&Number(a.version)>=o}(68)||function(o){const a=Sn();return!(a.name!==En.SAFARI||!a.osVersion)&&Number(a.version)>=o}(14))}(),F.info("browser compatibility",JSON.stringify(Bs),JSON.stringify(r)),Bs.supportPCSetConfiguration=!Jn()&&!!RTCPeerConnection.prototype.setConfiguration}(),function(){let r;try{r=window.localStorage.getItem("websdk_ng_global_parameter")}catch(o){return void F.error("Error loading sdk config",o.message)}if(r)try{const o=JSON.parse(window.atob(r)),a=Date.now();F.debug("Loading global parameters from cache",o),Object.keys(o).forEach(u=>{if(Object.prototype.hasOwnProperty.call(yo,u)){const{value:h,expires:g}=o[u];if(g&&g<=a)return;Hl[u]=h,yo[u]=h}})}catch(o){F.error("Error loading mutableParamsCache: ".concat(r),o.message)}}(),Array.isArray(Hl.AREAS)&&Hl.AREAS.length>0&&xS(Hl.AREAS,!0);const oo={__CLIENT_LIST__:Ih,__TRACK_LIST__:mf,VERSION:wi,BUILD:zv,setParameter:(r,o,a)=>{F.debug("setParameter key:".concat(r,", value:").concat(JSON.stringify(o))),_n(r,o,a)},getParameter:de,getSupportedCodec:async function(){let r={audio:[],video:[]};try{let o=new RTCPeerConnection;o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"});const a=(await o.createOffer()).sdp;if(!a)return r;o.close(),o=null,r=function(u){const h={video:[],audio:[]};return u.match(/ VP8/i)&&h.video.push("VP8"),u.match(/ VP9/i)&&h.video.push("VP9"),u.match(/ AV1/i)&&h.video.push("AV1"),u.match(/ H264/i)&&h.video.push("H264"),u.match(/ opus/i)&&h.audio.push("OPUS"),u.match(/ PCMU/i)&&h.audio.push("PCMU"),u.match(/ PCMA/i)&&h.audio.push("PCMA"),u.match(/ G722/i)&&h.audio.push("G722"),h}(a)}catch(o){throw new Q(K.CREATE_OFFER_FAILED,o.toString&&o.toString()).print()}return r},checkSystemRequirements:function(){const r=at.reportApiInvoke(null,{name:vr.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:jn.TRACER});let o=!1;try{const g=window.RTCPeerConnection,E=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,S=window.WebSocket;o=!!(g&&E&&S)}catch(g){return F.error("check system requirement failed: ",g),!1}let a=!1;const u=Sn();u.name===En.CHROME&&Number(u.version)>=58&&(!kG()||xG())&&(a=!0),u.name===En.FIREFOX&&Number(u.version)>=56&&(a=!0),u.name===En.OPERA&&Number(u.version)>=45&&(a=!0),u.name===En.SAFARI&&Number(u.version)>=11&&(a=!0),(WO()||Sn().name===En.QQ)&&(a=!0),F.debug("checkSystemRequirements, api:",o,"browser",a);const h=o&&a;return r.onSuccess(h),h},getDevices:function(r){return ni.enumerateDevices(!0,!0,r)},getMicrophones:function(r){return ni.getRecordingDevices(r)},getCameras:function(r){return ni.getCamerasDevices(r)},getElectronScreenSources:vk,getPlaybackDevices:function(r){return ni.getSpeakers(r)},createClient:function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const o=at.reportApiInvoke(null,{name:vr.CREATE_CLIENT,options:[r],tag:jn.TRACER});try{aH(r)}catch(a){throw o.onError(a),a}return r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new lX(Ff(Ff({forceWaitGatewayResponse:!0},r),{},{role:r.mode==="rtc"?"host":r.role}))},createCameraVideoTrack:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const o=at.reportApiInvoke(null,{tag:jn.TRACER,name:vr.CREATE_CAM_VIDEO_TRACK,options:[BE({},r)]}),a=FS(r),u=Kn(8,"track-cam-");let h=null;F.info("start create camera video track with config",JSON.stringify(r),"trackId",u);try{h=(await ea({video:a},u)).getVideoTracks()[0]||null}catch(E){throw o.onError(E),E}if(!h){const E=new Q(K.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(E),E.throw()}r.optimizationMode&&vT(u,h,r,Sh(r.encoderConfig));const g=new MD(h,r,a,r.scalabiltyMode?cE(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,u);return o.onSuccess(g.getTrackId()),F.info("create camera video success, trackId:",u),g},createCustomVideoTrack:function(r){const o=at.reportApiInvoke(null,{tag:jn.TRACER,name:vr.CREATE_CUSTOM_VIDEO_TRACK,options:[r]}),a=new dr(r.mediaStreamTrack,{bitrateMax:r.bitrateMax,bitrateMin:r.bitrateMin},r.scalabiltyMode?cE(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode);return o.onSuccess(a.getTrackId()),F.info("create custom video track success with config",r,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const a=at.reportApiInvoke(null,{tag:jn.TRACER,name:vr.CREATE_SCREEN_VIDEO_TRACK,options:[BE({},r),o]});r.encoderConfig?typeof r.encoderConfig=="string"||r.encoderConfig.width&&r.encoderConfig.height||(r.encoderConfig.width={max:1920},r.encoderConfig.height={max:1080}):r.encoderConfig="1080p_2";const u=YK(r),h=Kn(8,"track-scr");let g=null,E=null;const S=ns();if(!S.supportShareAudio&&o==="enable"){const w=new Q(K.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return a.onError(w),w.throw()}F.info("start create screen video track with config",r,"withAudio",o,"trackId",h);try{const w=await ea({screen:u,screenAudio:o==="auto"?S.supportShareAudio:o==="enable"},h);g=w.getVideoTracks()[0]||null,E=w.getAudioTracks()[0]||null}catch(w){throw a.onError(w),w}if(!g){const w=new Q(K.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(w),w.throw()}if(!E&&o==="enable"){g&&g.stop();const w=new Q(K.SHARE_AUDIO_NOT_ALLOWED);return a.onError(w),w.throw()}r.optimizationMode||(r.optimizationMode="detail"),r.optimizationMode&&(vT(h,g,r,r.encoderConfig&&Kv(r.encoderConfig)),r.encoderConfig&&typeof r.encoderConfig!="string"&&(r.encoderConfig.bitrateMin=r.encoderConfig.bitrateMax));const T=new dr(g,r.encoderConfig?Kv(r.encoderConfig):{},r.scalabiltyMode?cE(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,h,[ts.SCREEN_TRACK]);if(!E)return a.onSuccess(T.getTrackId()),F.info("create screen video track success","video:",T.getTrackId()),T;const C=new ys(E);return a.onSuccess([T.getTrackId(),C.getTrackId()]),F.info("create screen video track success","video:",T.getTrackId(),"audio:",C.getTrackId()),[T,C]},createMicrophoneAndCameraTracks:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=at.reportApiInvoke(null,{tag:jn.TRACER,name:vr.CREATE_MIC_AND_CAM_TRACKS,options:[r,o]}),u=FS(o),h=rD(r),g=Kn(8,"track-mic-"),E=Kn(8,"track-cam-");let S=null,T=null;F.info("start create camera video track(".concat(E,") and microphone audio track(").concat(g,") with config, audio: ").concat(JSON.stringify(r),", video: ").concat(JSON.stringify(o)));try{const N=await ea({audio:h,video:u},"".concat(g,"-").concat(E));S=N.getAudioTracks()[0],T=N.getVideoTracks()[0]}catch(N){throw a.onError(N),N}if(!S||!T){const N=new Q(K.UNEXPECTED_ERROR,"can not find tracks in media stream");return a.onError(N),N.throw()}o.optimizationMode&&vT(E,T,o,Sh(o.encoderConfig));const C=new EE(S,r,h,g),w=new MD(T,o,u,o.scalabiltyMode?cE(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,E);return a.onSuccess([C.getTrackId(),w.getTrackId()]),F.info("create camera video track(".concat(E,") and microphone audio track(").concat(g,") success")),[C,w]},createMicrophoneAudioTrack:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const o=at.reportApiInvoke(null,{tag:jn.TRACER,name:vr.CREATE_MIC_AUDIO_TRACK,options:[r]}),a=rD(r),u=Kn(8,"track-mic-");let h=null;F.info("start create microphone audio track with config",JSON.stringify(r),"trackId",u);try{h=(await ea({audio:a},u)).getAudioTracks()[0]||null}catch(E){throw o.onError(E),E}if(!h){const E=new Q(K.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(E),E.throw()}const g=new EE(h,r,a,u);return o.onSuccess(g.getTrackId()),F.info("create microphone audio track success, trackId:",u),g},createCustomAudioTrack:function(r){const o=at.reportApiInvoke(null,{tag:jn.TRACER,name:vr.CREATE_CUSTOM_AUDIO_TRACK,options:[r]}),a=new ys(r.mediaStreamTrack,r.encoderConfig?uE(r.encoderConfig):{});return F.info("create custom audio track success with config",r,"trackId",a.getTrackId()),o.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(r){const o=at.reportApiInvoke(null,{tag:jn.TRACER,name:vr.CREATE_BUFFER_AUDIO_TRACK,options:[r]});if(de("DISABLE_WEBAUDIO"))throw new Q(K.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const a=Kn(8,"track-buf-");F.info("start create buffer source audio track with config",JSON.stringify(r),"trackId",a);const u=r.source;if(!(r.source instanceof AudioBuffer))try{r.source=await hX(r.source,r.cacheOnlineFile)}catch(E){return o.onError(E),E.throw()}const h=new dX(r.source),g=new bK(u,h,r.encoderConfig?uE(r.encoderConfig):{},a);return F.info("create buffer source audio track success, trackId:",a),o.onSuccess(g.getTrackId()),g},setAppType:function(r){if(F.debug("setAppType: ".concat(r)),!(Number.isInteger(r)&&r>=0))throw F.debug("Invalid appType"),new Q(K.INVALID_PARAMS,"invalid app type",r);_n("APP_TYPE",Math.floor(r))},setLogLevel:function(r){F.setLogLevel(r)},enableLogUpload:function(){de("USE_NEW_LOG")?_n("UPLOAD_LOG",!0):F.enableLogUpload()},disableLogUpload:function(){de("USE_NEW_LOG")?_n("UPLOAD_LOG",!1):F.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new J3},checkAudioTrackIsActive:async function(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=at.reportApiInvoke(null,{tag:jn.TRACER,name:vr.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[o]});if(!(r instanceof ys||r instanceof ME)){const T=new Q(K.INVALID_TRACK,"the parameter is not a audio track");return a.onError(T),T.throw()}o&&o<1e3&&(o=1e3);const u=r instanceof ys?r.getTrackLabel():"remote_track",h=r.getVolumeLevel();let g=h,E=h;const S=Date.now();return new Je(T=>{const C=setInterval(()=>{const w=r.getVolumeLevel();g=w>g?w:g,E=w<E?w:E;const N=g-E>1e-4,M=Date.now()-S;if(N||M>o){clearInterval(C);const U=N,Y={duration:M,deviceLabel:u,maxVolumeLevel:g,result:U};F.info("[track-".concat(r.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(Y))),a.onSuccess(Y),T(U)}},200)})},checkVideoTrackIsActive:async function(r){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=at.reportApiInvoke(null,{tag:jn.TRACER,name:vr.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[o]});if(!(r instanceof dr||r instanceof LE)){const M=new Q(K.INVALID_TRACK,"the parameter is not a video track");return a.onError(M),M.throw()}const u=4;o&&o<1e3&&(o=1e3);const h=r instanceof dr?r.getTrackLabel():"remote_track",g=r.getMediaStreamTrack(!0),E=document.createElement("video");E.style.width="1px",E.style.height="1px",E.setAttribute("muted",""),E.muted=!0,E.setAttribute("playsinline",""),E.controls=!1,(Vo()||Jg())&&(E.style.opacity="0.01",E.style.position="fixed",E.style.left="0",E.style.top="0",document.body.appendChild(E)),E.srcObject=new MediaStream([g]),E.play();const S=document.createElement("canvas");S.width=160,S.height=120;let T=0,C=0;try{const M=Date.now();T=await fX(E,o,S,u),C=Date.now()-M}catch(M){throw a.onError(M),M}pX===En.SAFARI&&(E.pause(),E.remove()),E.srcObject=null;const w=T>u,N={duration:C,changedPicNum:T,deviceLabel:h,result:w};return F.info("[track-".concat(r.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(N))),a.onSuccess(N),w},setArea:xS,audioElementPlayCenter:Bo,processExternalMediaAEC:function(r){gX.processExternalMediaAEC(r)},registerExtensions:function(r){r.forEach(o=>{const a=o;a.__registered__=!0,a.logger.hookLog=F.extLog,a.reporter.hookApiInvoke=at.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach(u=>{a.parameters[u]=de(u)})})},ChannelMediaRelayError:Au,ChannelMediaRelayEvent:ka,ChannelMediaRelayState:ro,RemoteStreamFallbackType:dS,RemoteStreamType:lS,ConnectionDisconnectedReason:nn,AudienceLatencyLevelType:oS,AREAS:Wt},ST=window||document;return Object.defineProperties(oo,{onAudioAutoplayFailed:{get:()=>ti.onAudioAutoplayFailed,set:r=>{ti.onAudioAutoplayFailed=r}},onAutoplayFailed:{get:()=>ti.onAutoplayFailed,set:r=>{ti.onAutoplayFailed=r}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>oo._onSecurityPolicyViolation,set(r){if(oo._onSecurityPolicyViolation=r,!ST)return;const o=u=>{if(!(u&&u.blockedURI&&oo.onSecurityPolicyViolation))return;const h=u.blockedURI;de("CSP_DETECTED_HOSTNAME_LIST").some(g=>h.includes(g))&&oo.onSecurityPolicyViolation&&typeof oo.onSecurityPolicyViolation=="function"&&oo.onSecurityPolicyViolation(u)},a=oo._cspEventHandlerPointer;a&&ST.removeEventListener("securitypolicyviolation",a),r&&typeof r=="function"&&ST.addEventListener("securitypolicyviolation",o),oo._cspEventHandlerPointer=o}}}),ni.on(Pc.CAMERA_DEVICE_CHANGED,r=>{F.info("camera device changed",JSON.stringify(r)),oo.onCameraChanged&&oo.onCameraChanged(r)}),ni.on(Pc.RECORDING_DEVICE_CHANGED,r=>{F.info("microphone device changed",JSON.stringify(r)),oo.onMicrophoneChanged&&oo.onMicrophoneChanged(r)}),ni.on(Pc.PLAYOUT_DEVICE_CHANGED,r=>{F.debug("playout device changed",JSON.stringify(r)),oo.onPlaybackDeviceChanged&&oo.onPlaybackDeviceChanged(r)}),Bo.onAutoplayFailed=()=>{F.info("detect audio element autoplay failed"),ti.onAudioAutoplayFailed&&ti.onAudioAutoplayFailed()},Gt.on("autoplay-failed",()=>{F.info("detect webaudio autoplay failed"),ti.onAudioAutoplayFailed&&ti.onAudioAutoplayFailed()}),window&&(window.__ARTC__=oo),oo})})(qJ);const W1=P$(h2);function XJ(t,e){if(t==null)return{};var n={},s=Object.keys(t),i,c;for(c=0;c<s.length;c++)i=s[c],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}var uM;(function(t){t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"})(uM||(uM={}));var YJ=function(e){var n;function s(){return n||(n=W1.createClient(e)),n}return function(){return s()}};function JJ(t,e){var n=function(){try{return Promise.resolve(W1.createMicrophoneAndCameraTracks(t,e)).then(function(c){return s=c,s})}catch(c){return Promise.reject(c)}},s=null;return function(){var c=Dr.useState(!1),l=c[0],d=c[1],p=Dr.useState(null),f=p[0],m=p[1],_=Dr.useRef(s);return Dr.useEffect(function(){return _.current===null?n().then(function(y){_.current=y,d(!0)},function(y){m(y)}):d(!0),function(){s=null}},[]),{ready:l,tracks:_.current,error:f}}}var QJ=function(e){var n=Dr.useRef(null),s=e.videoTrack,i=e.config,c=XJ(e,["videoTrack","config"]);return Dr.useLayoutEffect(function(){return n.current!==null&&s.play(n.current,i),function(){s.stop()}},[s]),MX.createElement("div",Object.assign({},c,{ref:n}))};const ZJ={mode:"rtc",codec:"vp8"};W1.setLogLevel(4);const eQ="78362308677b4d78a2438206fb6563a7",tQ="007eJxTYPhz5ZGYkYOyYt4+ZnFuue7FiU/DDR5yLVX3/iQ57aJX8iYFBnMLYzMjYwMLM3PzJJMUc4tEIxNjCyMDs7QkM1Mz40TzK7o2KQ2BjAyPqtoZGRkgEMRnYyhLjE9JLWNgAACv7B1U",nQ=YJ(ZJ),rQ=nQ();function GU(){return{client:rQ,clientConfig:{appId:eQ,token:tQ}}}const sQ=({tracks:t,setStart:e,setInCall:n})=>{const{client:s}=GU(),[i,c]=Dr.useState({video:!0,audio:!0}),l=async p=>{p==="audio"?(await t[0].setEnabled(!i.audio),c(f=>({...f,audio:!f.audio}))):p==="video"&&(await t[1].setEnabled(!i.video),c(f=>({...f,video:!f.video})))},d=async()=>{await s.leave(),s.removeAllListeners(),t[0].close(),t[1].close(),e(!1),n(!1)};return Ed("div",{className:"controls",children:[zs("button",{className:i.audio?"on":"",onClick:()=>l("audio"),children:i.audio?"MuteAudio":"UnmuteAudio"}),zs("button",{className:i.video?"on":"",onClick:()=>l("video"),children:i.video?"MuteVideo":"UnmuteVideo"}),zs("button",{onClick:()=>d(),children:"Leave"})]})},oQ=Dr.memo(sQ);var iQ={};(function(){var t;function e(P){var V=0;return function(){return V<P.length?{done:!1,value:P[V++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(P,V,W){return P==Array.prototype||P==Object.prototype||(P[V]=W.value),P};function s(P){P=[typeof globalThis=="object"&&globalThis,P,typeof window=="object"&&window,typeof self=="object"&&self,typeof Bi=="object"&&Bi];for(var V=0;V<P.length;++V){var W=P[V];if(W&&W.Math==Math)return W}throw Error("Cannot find global object")}var i=s(this);function c(P,V){if(V)e:{var W=i;P=P.split(".");for(var ue=0;ue<P.length-1;ue++){var Se=P[ue];if(!(Se in W))break e;W=W[Se]}P=P[P.length-1],ue=W[P],V=V(ue),V!=ue&&V!=null&&n(W,P,{configurable:!0,writable:!0,value:V})}}c("Symbol",function(P){function V(Be){if(this instanceof V)throw new TypeError("Symbol is not a constructor");return new W(ue+(Be||"")+"_"+Se++,Be)}function W(Be,Re){this.g=Be,n(this,"description",{configurable:!0,writable:!0,value:Re})}if(P)return P;W.prototype.toString=function(){return this.g};var ue="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Se=0;return V}),c("Symbol.iterator",function(P){if(P)return P;P=Symbol("Symbol.iterator");for(var V="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),W=0;W<V.length;W++){var ue=i[V[W]];typeof ue=="function"&&typeof ue.prototype[P]!="function"&&n(ue.prototype,P,{configurable:!0,writable:!0,value:function(){return l(e(this))}})}return P});function l(P){return P={next:P},P[Symbol.iterator]=function(){return this},P}function d(P){var V=typeof Symbol<"u"&&Symbol.iterator&&P[Symbol.iterator];return V?V.call(P):{next:e(P)}}function p(P){if(!(P instanceof Array)){P=d(P);for(var V,W=[];!(V=P.next()).done;)W.push(V.value);P=W}return P}var f=typeof Object.create=="function"?Object.create:function(P){function V(){}return V.prototype=P,new V},m;if(typeof Object.setPrototypeOf=="function")m=Object.setPrototypeOf;else{var _;e:{var y={a:!0},v={};try{v.__proto__=y,_=v.a;break e}catch{}_=!1}m=_?function(P,V){if(P.__proto__=V,P.__proto__!==V)throw new TypeError(P+" is not extensible");return P}:null}var I=m;function b(P,V){if(P.prototype=f(V.prototype),P.prototype.constructor=P,I)I(P,V);else for(var W in V)if(W!="prototype")if(Object.defineProperties){var ue=Object.getOwnPropertyDescriptor(V,W);ue&&Object.defineProperty(P,W,ue)}else P[W]=V[W];P.ea=V.prototype}function A(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function R(P){if(P.l)throw new TypeError("Generator is already running");P.l=!0}A.prototype.o=function(P){this.h=P};function O(P,V){P.j={U:V,V:!0},P.g=P.m||P.s}A.prototype.return=function(P){this.j={return:P},this.g=this.s};function L(P,V,W){return P.g=W,{value:V}}function $(P){this.g=new A,this.h=P}function G(P,V){R(P.g);var W=P.g.i;return W?H(P,"return"in W?W.return:function(ue){return{value:ue,done:!0}},V,P.g.return):(P.g.return(V),Z(P))}function H(P,V,W,ue){try{var Se=V.call(P.g.i,W);if(!(Se instanceof Object))throw new TypeError("Iterator result "+Se+" is not an object");if(!Se.done)return P.g.l=!1,Se;var Be=Se.value}catch(Re){return P.g.i=null,O(P.g,Re),Z(P)}return P.g.i=null,ue.call(P.g,Be),Z(P)}function Z(P){for(;P.g.g;)try{var V=P.h(P.g);if(V)return P.g.l=!1,{value:V.value,done:!1}}catch(W){P.g.h=void 0,O(P.g,W)}if(P.g.l=!1,P.g.j){if(V=P.g.j,P.g.j=null,V.V)throw V.U;return{value:V.return,done:!0}}return{value:void 0,done:!0}}function re(P){this.next=function(V){return R(P.g),P.g.i?V=H(P,P.g.i.next,V,P.g.o):(P.g.o(V),V=Z(P)),V},this.throw=function(V){return R(P.g),P.g.i?V=H(P,P.g.i.throw,V,P.g.o):(O(P.g,V),V=Z(P)),V},this.return=function(V){return G(P,V)},this[Symbol.iterator]=function(){return this}}function oe(P,V){return V=new re(new $(V)),I&&P.prototype&&I(V,P.prototype),V}function ae(P,V){P instanceof String&&(P+="");var W=0,ue=!1,Se={next:function(){if(!ue&&W<P.length){var Be=W++;return{value:V(Be,P[Be]),done:!1}}return ue=!0,{done:!0,value:void 0}}};return Se[Symbol.iterator]=function(){return Se},Se}var Ee=typeof Object.assign=="function"?Object.assign:function(P,V){for(var W=1;W<arguments.length;W++){var ue=arguments[W];if(ue)for(var Se in ue)Object.prototype.hasOwnProperty.call(ue,Se)&&(P[Se]=ue[Se])}return P};c("Object.assign",function(P){return P||Ee}),c("Promise",function(P){function V(Re){this.h=0,this.i=void 0,this.g=[],this.o=!1;var We=this.j();try{Re(We.resolve,We.reject)}catch(rt){We.reject(rt)}}function W(){this.g=null}function ue(Re){return Re instanceof V?Re:new V(function(We){We(Re)})}if(P)return P;W.prototype.h=function(Re){if(this.g==null){this.g=[];var We=this;this.i(function(){We.l()})}this.g.push(Re)};var Se=i.setTimeout;W.prototype.i=function(Re){Se(Re,0)},W.prototype.l=function(){for(;this.g&&this.g.length;){var Re=this.g;this.g=[];for(var We=0;We<Re.length;++We){var rt=Re[We];Re[We]=null;try{rt()}catch(_t){this.j(_t)}}}this.g=null},W.prototype.j=function(Re){this.i(function(){throw Re})},V.prototype.j=function(){function Re(_t){return function(zt){rt||(rt=!0,_t.call(We,zt))}}var We=this,rt=!1;return{resolve:Re(this.C),reject:Re(this.l)}},V.prototype.C=function(Re){if(Re===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(Re instanceof V)this.F(Re);else{e:switch(typeof Re){case"object":var We=Re!=null;break e;case"function":We=!0;break e;default:We=!1}We?this.u(Re):this.m(Re)}},V.prototype.u=function(Re){var We=void 0;try{We=Re.then}catch(rt){this.l(rt);return}typeof We=="function"?this.G(We,Re):this.m(Re)},V.prototype.l=function(Re){this.s(2,Re)},V.prototype.m=function(Re){this.s(1,Re)},V.prototype.s=function(Re,We){if(this.h!=0)throw Error("Cannot settle("+Re+", "+We+"): Promise already settled in state"+this.h);this.h=Re,this.i=We,this.h===2&&this.D(),this.A()},V.prototype.D=function(){var Re=this;Se(function(){if(Re.B()){var We=i.console;typeof We<"u"&&We.error(Re.i)}},1)},V.prototype.B=function(){if(this.o)return!1;var Re=i.CustomEvent,We=i.Event,rt=i.dispatchEvent;return typeof rt>"u"?!0:(typeof Re=="function"?Re=new Re("unhandledrejection",{cancelable:!0}):typeof We=="function"?Re=new We("unhandledrejection",{cancelable:!0}):(Re=i.document.createEvent("CustomEvent"),Re.initCustomEvent("unhandledrejection",!1,!0,Re)),Re.promise=this,Re.reason=this.i,rt(Re))},V.prototype.A=function(){if(this.g!=null){for(var Re=0;Re<this.g.length;++Re)Be.h(this.g[Re]);this.g=null}};var Be=new W;return V.prototype.F=function(Re){var We=this.j();Re.J(We.resolve,We.reject)},V.prototype.G=function(Re,We){var rt=this.j();try{Re.call(We,rt.resolve,rt.reject)}catch(_t){rt.reject(_t)}},V.prototype.then=function(Re,We){function rt(an,Xt){return typeof an=="function"?function(Nt){try{_t(an(Nt))}catch(x){zt(x)}}:Xt}var _t,zt,vn=new V(function(an,Xt){_t=an,zt=Xt});return this.J(rt(Re,_t),rt(We,zt)),vn},V.prototype.catch=function(Re){return this.then(void 0,Re)},V.prototype.J=function(Re,We){function rt(){switch(_t.h){case 1:Re(_t.i);break;case 2:We(_t.i);break;default:throw Error("Unexpected state: "+_t.h)}}var _t=this;this.g==null?Be.h(rt):this.g.push(rt),this.o=!0},V.resolve=ue,V.reject=function(Re){return new V(function(We,rt){rt(Re)})},V.race=function(Re){return new V(function(We,rt){for(var _t=d(Re),zt=_t.next();!zt.done;zt=_t.next())ue(zt.value).J(We,rt)})},V.all=function(Re){var We=d(Re),rt=We.next();return rt.done?ue([]):new V(function(_t,zt){function vn(Nt){return function(x){an[Nt]=x,Xt--,Xt==0&&_t(an)}}var an=[],Xt=0;do an.push(void 0),Xt++,ue(rt.value).J(vn(an.length-1),zt),rt=We.next();while(!rt.done)})},V}),c("Object.is",function(P){return P||function(V,W){return V===W?V!==0||1/V===1/W:V!==V&&W!==W}}),c("Array.prototype.includes",function(P){return P||function(V,W){var ue=this;ue instanceof String&&(ue=String(ue));var Se=ue.length;for(W=W||0,0>W&&(W=Math.max(W+Se,0));W<Se;W++){var Be=ue[W];if(Be===V||Object.is(Be,V))return!0}return!1}}),c("String.prototype.includes",function(P){return P||function(V,W){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(V instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(V,W||0)!==-1}}),c("Array.prototype.keys",function(P){return P||function(){return ae(this,function(V){return V})}});var Ce=this||self;function ye(P,V){P=P.split(".");var W=Ce;P[0]in W||typeof W.execScript>"u"||W.execScript("var "+P[0]);for(var ue;P.length&&(ue=P.shift());)P.length||V===void 0?W[ue]&&W[ue]!==Object.prototype[ue]?W=W[ue]:W=W[ue]={}:W[ue]=V}function we(P,V){return V=String.fromCharCode.apply(null,V),P==null?V:P+V}var Ae,Oe=typeof TextDecoder<"u",Me,me=typeof TextEncoder<"u";function Te(P){if(me)P=(Me||(Me=new TextEncoder)).encode(P);else{var V=void 0;V=V===void 0?!1:V;for(var W=0,ue=new Uint8Array(3*P.length),Se=0;Se<P.length;Se++){var Be=P.charCodeAt(Se);if(128>Be)ue[W++]=Be;else{if(2048>Be)ue[W++]=Be>>6|192;else{if(55296<=Be&&57343>=Be){if(56319>=Be&&Se<P.length){var Re=P.charCodeAt(++Se);if(56320<=Re&&57343>=Re){Be=1024*(Be-55296)+Re-56320+65536,ue[W++]=Be>>18|240,ue[W++]=Be>>12&63|128,ue[W++]=Be>>6&63|128,ue[W++]=Be&63|128;continue}else Se--}if(V)throw Error("Found an unpaired surrogate");Be=65533}ue[W++]=Be>>12|224,ue[W++]=Be>>6&63|128}ue[W++]=Be&63|128}}P=ue.subarray(0,W)}return P}var ke={},Fe=null;function Xe(P,V){V===void 0&&(V=0),et(),V=ke[V];for(var W=Array(Math.floor(P.length/3)),ue=V[64]||"",Se=0,Be=0;Se<P.length-2;Se+=3){var Re=P[Se],We=P[Se+1],rt=P[Se+2],_t=V[Re>>2];Re=V[(Re&3)<<4|We>>4],We=V[(We&15)<<2|rt>>6],rt=V[rt&63],W[Be++]=_t+Re+We+rt}switch(_t=0,rt=ue,P.length-Se){case 2:_t=P[Se+1],rt=V[(_t&15)<<2]||ue;case 1:P=P[Se],W[Be]=V[P>>2]+V[(P&3)<<4|_t>>4]+rt+ue}return W.join("")}function Ye(P){var V=P.length,W=3*V/4;W%3?W=Math.floor(W):"=.".indexOf(P[V-1])!=-1&&(W="=.".indexOf(P[V-2])!=-1?W-2:W-1);var ue=new Uint8Array(W),Se=0;return tt(P,function(Be){ue[Se++]=Be}),ue.subarray(0,Se)}function tt(P,V){function W(rt){for(;ue<P.length;){var _t=P.charAt(ue++),zt=Fe[_t];if(zt!=null)return zt;if(!/^[\s\xa0]*$/.test(_t))throw Error("Unknown base64 encoding at char: "+_t)}return rt}et();for(var ue=0;;){var Se=W(-1),Be=W(0),Re=W(64),We=W(64);if(We===64&&Se===-1)break;V(Se<<2|Be>>4),Re!=64&&(V(Be<<4&240|Re>>2),We!=64&&V(Re<<6&192|We))}}function et(){if(!Fe){Fe={};for(var P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),V=["+/=","+/","-_=","-_.","-_"],W=0;5>W;W++){var ue=P.concat(V[W].split(""));ke[W]=ue;for(var Se=0;Se<ue.length;Se++){var Be=ue[Se];Fe[Be]===void 0&&(Fe[Be]=Se)}}}}var nt=typeof Uint8Array.prototype.slice=="function",gt;function Ct(P,V,W){return V===W?gt||(gt=new Uint8Array(0)):nt?P.slice(V,W):new Uint8Array(P.subarray(V,W))}var Tt=0,Lt=0;function St(P,V){V=V===void 0?{}:V,V=V.v===void 0?!1:V.v,this.h=null,this.g=this.j=this.l=0,this.m=!1,this.v=V,P&&un(this,P)}function un(P,V){V=V.constructor===Uint8Array?V:V.constructor===ArrayBuffer?new Uint8Array(V):V.constructor===Array?new Uint8Array(V):V.constructor===String?Ye(V):V instanceof Uint8Array?new Uint8Array(V.buffer,V.byteOffset,V.byteLength):new Uint8Array(0),P.h=V,P.l=0,P.j=P.h.length,P.g=P.l}St.prototype.reset=function(){this.g=this.l};function Kt(P){for(var V=128,W=0,ue=0,Se=0;4>Se&&128<=V;Se++)V=P.h[P.g++],W|=(V&127)<<7*Se;if(128<=V&&(V=P.h[P.g++],W|=(V&127)<<28,ue|=(V&127)>>4),128<=V)for(Se=0;5>Se&&128<=V;Se++)V=P.h[P.g++],ue|=(V&127)<<7*Se+3;if(128>V)return P=W>>>0,V=ue>>>0,(ue=V&2147483648)&&(P=~P+1>>>0,V=~V>>>0,P==0&&(V=V+1>>>0)),P=4294967296*V+(P>>>0),ue?-P:P;P.m=!0}St.prototype.i=function(){var P=this.h,V=P[this.g],W=V&127;return 128>V?(this.g+=1,W):(V=P[this.g+1],W|=(V&127)<<7,128>V?(this.g+=2,W):(V=P[this.g+2],W|=(V&127)<<14,128>V?(this.g+=3,W):(V=P[this.g+3],W|=(V&127)<<21,128>V?(this.g+=4,W):(V=P[this.g+4],W|=(V&15)<<28,128>V?(this.g+=5,W>>>0):(this.g+=5,128<=P[this.g++]&&128<=P[this.g++]&&128<=P[this.g++]&&128<=P[this.g++]&&this.g++,W)))))},St.prototype.o=function(){var P=this.h[this.g],V=this.h[this.g+1],W=this.h[this.g+2],ue=this.h[this.g+3];return this.g+=4,W=(P<<0|V<<8|W<<16|ue<<24)>>>0,P=2*(W>>31)+1,V=W>>>23&255,W&=8388607,V==255?W?NaN:1/0*P:V==0?P*Math.pow(2,-149)*W:P*Math.pow(2,V-150)*(W+Math.pow(2,23))};var sn=[];function on(){this.g=new Uint8Array(64),this.h=0}on.prototype.push=function(P){if(!(this.h+1<this.g.length)){var V=this.g;this.g=new Uint8Array(Math.ceil(1+2*this.g.length)),this.g.set(V)}this.g[this.h++]=P},on.prototype.length=function(){return this.h},on.prototype.end=function(){var P=this.g,V=this.h;return this.h=0,Ct(P,0,V)};function Zt(P,V){for(;127<V;)P.push(V&127|128),V>>>=7;P.push(V)}function xn(P){var V={},W=V.N===void 0?!1:V.N;this.o={v:V.v===void 0?!1:V.v},this.N=W,V=this.o,sn.length?(W=sn.pop(),V&&(W.v=V.v),P&&un(W,P),P=W):P=new St(P,V),this.g=P,this.m=this.g.g,this.h=this.i=this.l=-1,this.j=!1}xn.prototype.reset=function(){this.g.reset(),this.h=this.l=-1};function pn(P){var V=P.g;if((V=V.g==V.j)||(V=P.j)||(V=P.g,V=V.m||0>V.g||V.g>V.j),V)return!1;P.m=P.g.g,V=P.g.i();var W=V&7;return W!=0&&W!=5&&W!=1&&W!=2&&W!=3&&W!=4?(P.j=!0,!1):(P.i=V,P.l=V>>>3,P.h=W,!0)}function Fn(P){switch(P.h){case 0:if(P.h!=0)Fn(P);else{for(P=P.g;P.h[P.g]&128;)P.g++;P.g++}break;case 1:P.h!=1?Fn(P):(P=P.g,P.g+=8);break;case 2:if(P.h!=2)Fn(P);else{var V=P.g.i();P=P.g,P.g+=V}break;case 5:P.h!=5?Fn(P):(P=P.g,P.g+=4);break;case 3:V=P.l;do{if(!pn(P)){P.j=!0;break}if(P.h==4){P.l!=V&&(P.j=!0);break}Fn(P)}while(1);break;default:P.j=!0}}function Pn(P,V,W){var ue=P.g.j,Se=P.g.i(),Be=P.g.g+Se;if(P.g.j=Be,W(V,P),W=Be-P.g.g,W!==0)throw Error("Message parsing ended unexpectedly. Expected to read "+Se+" bytes, instead read "+(Se-W)+" bytes, either the data ended unexpectedly or the message misreported its own length");return P.g.g=Be,P.g.j=ue,V}function Bn(P){return P.g.o()}function Ar(P){var V=P.g.i();P=P.g;var W=P.g;P.g+=V,P=P.h;var ue;if(Oe)(ue=Ae)||(ue=Ae=new TextDecoder("utf-8",{fatal:!1})),ue=ue.decode(P.subarray(W,W+V));else{V=W+V;for(var Se=[],Be=null,Re,We,rt;W<V;)Re=P[W++],128>Re?Se.push(Re):224>Re?W>=V?Se.push(65533):(We=P[W++],194>Re||(We&192)!==128?(W--,Se.push(65533)):Se.push((Re&31)<<6|We&63)):240>Re?W>=V-1?Se.push(65533):(We=P[W++],(We&192)!==128||Re===224&&160>We||Re===237&&160<=We||((ue=P[W++])&192)!==128?(W--,Se.push(65533)):Se.push((Re&15)<<12|(We&63)<<6|ue&63)):244>=Re?W>=V-2?Se.push(65533):(We=P[W++],(We&192)!==128||(Re<<28)+(We-144)>>30||((ue=P[W++])&192)!==128||((rt=P[W++])&192)!==128?(W--,Se.push(65533)):(Re=(Re&7)<<18|(We&63)<<12|(ue&63)<<6|rt&63,Re-=65536,Se.push((Re>>10&1023)+55296,(Re&1023)+56320))):Se.push(65533),8192<=Se.length&&(Be=we(Be,Se),Se.length=0);ue=we(Be,Se)}return ue}function fo(P,V,W){var ue=P.g.i();for(ue=P.g.g+ue;P.g.g<ue;)W.push(V.call(P.g))}function ps(P,V){P.h==2?fo(P,St.prototype.o,V):V.push(Bn(P))}function Qr(){this.h=[],this.i=0,this.g=new on}function Lr(P,V){V.length!==0&&(P.h.push(V),P.i+=V.length)}function Wr(P){var V=P.i+P.g.length();if(V===0)return new Uint8Array(0);V=new Uint8Array(V);for(var W=P.h,ue=W.length,Se=0,Be=0;Be<ue;Be++){var Re=W[Be];Re.length!==0&&(V.set(Re,Se),Se+=Re.length)}return W=P.g,ue=W.h,ue!==0&&(V.set(W.g.subarray(0,ue),Se),W.h=0),P.h=[V],V}function _r(P,V,W){if(W!=null){Zt(P.g,8*V+5),P=P.g;var ue=W;ue=(W=0>ue?1:0)?-ue:ue,ue===0?0<1/ue?Tt=Lt=0:(Lt=0,Tt=2147483648):isNaN(ue)?(Lt=0,Tt=2147483647):34028234663852886e22<ue?(Lt=0,Tt=(W<<31|2139095040)>>>0):11754943508222875e-54>ue?(ue=Math.round(ue/Math.pow(2,-149)),Lt=0,Tt=(W<<31|ue)>>>0):(V=Math.floor(Math.log(ue)/Math.LN2),ue*=Math.pow(2,-V),ue=Math.round(8388608*ue),16777216<=ue&&++V,Lt=0,Tt=(W<<31|V+127<<23|ue&8388607)>>>0),W=Tt,P.push(W>>>0&255),P.push(W>>>8&255),P.push(W>>>16&255),P.push(W>>>24&255)}}var Uo=typeof Uint8Array=="function";function _i(P,V,W){if(P!=null)return typeof P=="object"?Uo&&P instanceof Uint8Array?W(P):Hi(P,V,W):V(P)}function Hi(P,V,W){if(Array.isArray(P)){for(var ue=Array(P.length),Se=0;Se<P.length;Se++)ue[Se]=_i(P[Se],V,W);return Array.isArray(P)&&P.W&&is(ue),ue}ue={};for(Se in P)ue[Se]=_i(P[Se],V,W);return ue}function du(P){return typeof P=="number"?isFinite(P)?P:String(P):P}var wa={W:{value:!0,configurable:!0}};function is(P){return Array.isArray(P)&&!Object.isFrozen(P)&&Object.defineProperties(P,wa),P}var yr;function Gr(P,V,W){var ue=yr;yr=null,P||(P=ue),ue=this.constructor.ca,P||(P=ue?[ue]:[]),this.j=ue?0:-1,this.m=this.g=null,this.h=P;e:{if(ue=this.h.length,P=ue-1,ue&&(ue=this.h[P],!(ue===null||typeof ue!="object"||Array.isArray(ue)||Uo&&ue instanceof Uint8Array))){this.l=P-this.j,this.i=ue;break e}V!==void 0&&-1<V?(this.l=Math.max(V,P+1-this.j),this.i=null):this.l=Number.MAX_VALUE}if(W)for(V=0;V<W.length;V++)P=W[V],P<this.l?(P+=this.j,(ue=this.h[P])?is(ue):this.h[P]=ws):(Ic(this),(ue=this.i[P])?is(ue):this.i[P]=ws)}var ws=Object.freeze(is([]));function Ic(P){var V=P.l+P.j;P.h[V]||(P.i=P.h[V]={})}function Un(P,V,W){return V===-1?null:W!==void 0&&W||V>=P.l?P.i?P.i[V]:void 0:P.h[V+P.j]}function Cc(P,V){var W=W===void 0?!1:W,ue=Un(P,V,W);return ue==null&&(ue=ws),ue===ws&&(ue=is([]),ln(P,V,ue,W)),ue}function bl(P){var V=Cc(P,3);if(P.m||(P.m={}),!P.m[3]){for(var W=0;W<V.length;W++)V[W]=+V[W];P.m[3]=!0}return V}function Ki(P,V,W){return P=Un(P,V),P??W}function zr(P,V,W){return P=Un(P,V),P=P==null?P:+P,P??(W===void 0?0:W)}function ln(P,V,W,ue){ue!==void 0&&ue||V>=P.l?(Ic(P),P.i[V]=W):P.h[V+P.j]=W}function hu(P,V,W){if(W===-1)return null;if(P.g||(P.g={}),!P.g[W]){var ue=Un(P,W,!1);ue&&(P.g[W]=new V(ue))}return P.g[W]}function Xa(P,V){P.g||(P.g={});var W=P.g[1];if(!W){var ue=Cc(P,1);W=[];for(var Se=0;Se<ue.length;Se++)W[Se]=new V(ue[Se]);P.g[1]=W}return W}function Ra(P,V,W){var ue=ue===void 0?!1:ue;P.g||(P.g={});var Se=W&&qi(W);P.g[V]=W,ln(P,V,Se,ue)}function ba(P,V,W,ue){var Se=Xa(P,W);V=V||new W,P=Cc(P,1),ue!=null?(Se.splice(ue,0,V),P.splice(ue,0,qi(V))):(Se.push(V),P.push(qi(V)))}Gr.prototype.toJSON=function(){var P=qi(this);return Hi(P,du,Xe)};function qi(P,V){if(P.g)for(var W in P.g){var ue=P.g[W];if(Array.isArray(ue))for(var Se=0;Se<ue.length;Se++)ue[Se]&&qi(ue[Se]);else ue&&qi(ue)}return P.h}Gr.prototype.toString=function(){return qi(this).toString()};function Na(P,V){if(P=P.o){Lr(V,V.g.end());for(var W=0;W<P.length;W++)Lr(V,P[W])}}function mo(P,V){if(V.h==4)return!1;var W=V.m;return Fn(V),V.N||(V=Ct(V.g.h,W,V.g.g),(W=P.o)?W.push(V):P.o=[V]),!0}function Xi(P){Gr.call(this,P,-1,Kd)}b(Xi,Gr),Xi.prototype.getRows=function(){return Un(this,1)},Xi.prototype.getCols=function(){return Un(this,2)},Xi.prototype.getPackedDataList=function(){return bl(this)},Xi.prototype.getLayout=function(){return Ki(this,4,0)};function Hd(P,V){for(;pn(V);)switch(V.i){case 8:var W=V.g.i();ln(P,1,W);break;case 16:W=V.g.i(),ln(P,2,W);break;case 29:case 26:ps(V,P.getPackedDataList());break;case 32:W=Kt(V.g),ln(P,4,W);break;default:if(!mo(P,V))return P}return P}var Kd=[3];function Zr(P,V){var W=void 0;return new(W||(W=Promise))(function(ue,Se){function Be(rt){try{We(V.next(rt))}catch(_t){Se(_t)}}function Re(rt){try{We(V.throw(rt))}catch(_t){Se(_t)}}function We(rt){rt.done?ue(rt.value):new W(function(_t){_t(rt.value)}).then(Be,Re)}We((V=V.apply(P,void 0)).next())})}function yi(P){Gr.call(this,P)}b(yi,Gr);function qd(P,V){for(;pn(V);)switch(V.i){case 8:var W=V.g.i();ln(P,1,W);break;case 21:W=Bn(V),ln(P,2,W);break;case 26:W=Ar(V),ln(P,3,W);break;case 34:W=Ar(V),ln(P,4,W);break;default:if(!mo(P,V))return P}return P}function pu(P){Gr.call(this,P,-1,vi)}b(pu,Gr),pu.prototype.addClassification=function(P,V){return ba(this,P,yi,V),this};var vi=[1];function Ya(P){Gr.call(this,P)}b(Ya,Gr);function Jp(P,V){for(;pn(V);)switch(V.i){case 13:var W=Bn(V);ln(P,1,W);break;case 21:W=Bn(V),ln(P,2,W);break;case 29:W=Bn(V),ln(P,3,W);break;case 37:W=Bn(V),ln(P,4,W);break;case 45:W=Bn(V),ln(P,5,W);break;default:if(!mo(P,V))return P}return P}function fs(P){Gr.call(this,P,-1,Yd)}b(fs,Gr);function Xd(P){e:{var V=new fs;for(P=new xn(P);pn(P);)switch(P.i){case 10:var W=Pn(P,new Ya,Jp);ba(V,W,Ya,void 0);break;default:if(!mo(V,P))break e}}return V}var Yd=[1];function fu(P){Gr.call(this,P)}b(fu,Gr);function Aa(P){Gr.call(this,P,-1,Qp)}b(Aa,Gr),Aa.prototype.getVertexType=function(){return Ki(this,1,0)},Aa.prototype.getPrimitiveType=function(){return Ki(this,2,0)},Aa.prototype.getVertexBufferList=function(){return bl(this)},Aa.prototype.getIndexBufferList=function(){return Cc(this,4)};function Nl(P,V){for(;pn(V);)switch(V.i){case 8:var W=Kt(V.g);ln(P,1,W);break;case 16:W=Kt(V.g),ln(P,2,W);break;case 29:case 26:ps(V,P.getVertexBufferList());break;case 32:case 34:W=V;var ue=P.getIndexBufferList();W.h==2?fo(W,St.prototype.i,ue):ue.push(W.g.i());break;default:if(!mo(P,V))return P}return P}var Qp=[3,4];function mu(P){Gr.call(this,P)}b(mu,Gr),mu.prototype.getMesh=function(){return hu(this,Aa,1)},mu.prototype.getPoseTransformMatrix=function(){return hu(this,Xi,2)};function Al(P){e:{var V=new mu;for(P=new xn(P);pn(P);)switch(P.i){case 10:var W=Pn(P,new Aa,Nl);Ra(V,1,W);break;case 18:W=Pn(P,new Xi,Hd),Ra(V,2,W);break;default:if(!mo(V,P))break e}}return V}function Ol(P,V,W){if(W=P.createShader(W===0?P.VERTEX_SHADER:P.FRAGMENT_SHADER),P.shaderSource(W,V),P.compileShader(W),!P.getShaderParameter(W,P.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+P.getShaderInfoLog(W));return W}function gu(P){return Xa(P,yi).map(function(V){return{index:Ki(V,1,0),Y:zr(V,2),label:Un(V,3)!=null?Ki(V,3,""):void 0,displayName:Un(V,4)!=null?Ki(V,4,""):void 0}})}function Eu(P){return{x:zr(P,1),y:zr(P,2),z:zr(P,3),visibility:Un(P,4)!=null?zr(P,4):void 0}}function Si(P,V){this.h=P,this.g=V,this.l=0}function go(P,V,W){return Eo(P,V),typeof P.g.canvas.transferToImageBitmap=="function"?Promise.resolve(P.g.canvas.transferToImageBitmap()):W?Promise.resolve(P.g.canvas):typeof createImageBitmap=="function"?createImageBitmap(P.g.canvas):(P.i===void 0&&(P.i=document.createElement("canvas")),new Promise(function(ue){P.i.height=P.g.canvas.height,P.i.width=P.g.canvas.width,P.i.getContext("2d",{}).drawImage(P.g.canvas,0,0,P.g.canvas.width,P.g.canvas.height),ue(P.i)}))}function Eo(P,V){var W=P.g;if(P.m===void 0){var ue=Ol(W,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),Se=Ol(W,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),Be=W.createProgram();if(W.attachShader(Be,ue),W.attachShader(Be,Se),W.linkProgram(Be),!W.getProgramParameter(Be,W.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+W.getProgramInfoLog(Be));ue=P.m=Be,W.useProgram(ue),Se=W.getUniformLocation(ue,"sampler0"),P.j={I:W.getAttribLocation(ue,"aVertex"),H:W.getAttribLocation(ue,"aTex"),da:Se},P.s=W.createBuffer(),W.bindBuffer(W.ARRAY_BUFFER,P.s),W.enableVertexAttribArray(P.j.I),W.vertexAttribPointer(P.j.I,2,W.FLOAT,!1,0,0),W.bufferData(W.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),W.STATIC_DRAW),W.bindBuffer(W.ARRAY_BUFFER,null),P.o=W.createBuffer(),W.bindBuffer(W.ARRAY_BUFFER,P.o),W.enableVertexAttribArray(P.j.H),W.vertexAttribPointer(P.j.H,2,W.FLOAT,!1,0,0),W.bufferData(W.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),W.STATIC_DRAW),W.bindBuffer(W.ARRAY_BUFFER,null),W.uniform1i(Se,0)}ue=P.j,W.useProgram(P.m),W.canvas.width=V.width,W.canvas.height=V.height,W.viewport(0,0,V.width,V.height),W.activeTexture(W.TEXTURE0),P.h.bindTexture2d(V.glName),W.enableVertexAttribArray(ue.I),W.bindBuffer(W.ARRAY_BUFFER,P.s),W.vertexAttribPointer(ue.I,2,W.FLOAT,!1,0,0),W.enableVertexAttribArray(ue.H),W.bindBuffer(W.ARRAY_BUFFER,P.o),W.vertexAttribPointer(ue.H,2,W.FLOAT,!1,0,0),W.bindFramebuffer(W.DRAW_FRAMEBUFFER?W.DRAW_FRAMEBUFFER:W.FRAMEBUFFER,null),W.clearColor(0,0,0,0),W.clear(W.COLOR_BUFFER_BIT),W.colorMask(!0,!0,!0,!0),W.drawArrays(W.TRIANGLE_FAN,0,4),W.disableVertexAttribArray(ue.I),W.disableVertexAttribArray(ue.H),W.bindBuffer(W.ARRAY_BUFFER,null),P.h.bindTexture2d(0)}function Zp(P){this.g=P}var Mr=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Jd(P,V){return V+P}function _u(P,V){window[P]=V}function Js(P){var V=document.createElement("script");return V.setAttribute("src",P),V.setAttribute("crossorigin","anonymous"),new Promise(function(W){V.addEventListener("load",function(){W()},!1),V.addEventListener("error",function(){W()},!1),document.body.appendChild(V)})}function Qd(){return Zr(this,function P(){return oe(P,function(V){switch(V.g){case 1:return V.m=2,L(V,WebAssembly.instantiate(Mr),4);case 4:V.g=3,V.m=0;break;case 2:return V.m=0,V.j=null,V.return(!1);case 3:return V.return(!0)}})})}function Oa(P){if(this.g=P,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=P&&P.locateFile||Jd,typeof window=="object")var V=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location<"u")V=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.S=V,P.options){V=d(Object.keys(P.options));for(var W=V.next();!W.done;W=V.next()){W=W.value;var ue=P.options[W].default;ue!==void 0&&(this.j[W]=typeof ue=="function"?ue():ue)}}}t=Oa.prototype,t.close=function(){return this.i&&this.i.delete(),Promise.resolve()};function Zd(P,V){return P.g.files===void 0?[]:typeof P.g.files=="function"?P.g.files(V):P.g.files}function xl(P){return Zr(P,function V(){var W=this,ue,Se,Be,Re,We,rt,_t,zt,vn,an,Xt;return oe(V,function(Nt){switch(Nt.g){case 1:return ue=W,W.R?(Se=Zd(W,W.j),L(Nt,Qd(),2)):Nt.return();case 2:if(Be=Nt.h,typeof window=="object")return _u("createMediapipeSolutionsWasm",{locateFile:W.locateFile}),_u("createMediapipeSolutionsPackedAssets",{locateFile:W.locateFile}),rt=Se.filter(function(x){return x.data!==void 0}),_t=Se.filter(function(x){return x.data===void 0}),zt=Promise.all(rt.map(function(x){var B=Ja(ue,x.url);if(x.path!==void 0){var z=x.path;B=B.then(function(ee){return ue.overrideFile(z,ee),Promise.resolve(ee)})}return B})),vn=Promise.all(_t.map(function(x){return x.simd===void 0||x.simd&&Be||!x.simd&&!Be?Js(ue.locateFile(x.url,ue.S)):Promise.resolve()})).then(function(){return Zr(ue,function x(){var B,z,ee=this;return oe(x,function(ce){if(ce.g==1)return B=window.createMediapipeSolutionsWasm,z=window.createMediapipeSolutionsPackedAssets,L(ce,B(z),2);ee.h=ce.h,ce.g=0})})}),an=function(){return Zr(ue,function x(){var B=this;return oe(x,function(z){return B.g.graph&&B.g.graph.url?z=L(z,Ja(B,B.g.graph.url),0):(z.g=0,z=void 0),z})})}(),L(Nt,Promise.all([vn,zt,an]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return Re=Se.filter(function(x){return x.simd===void 0||x.simd&&Be||!x.simd&&!Be}).map(function(x){return ue.locateFile(x.url,ue.S)}),importScripts.apply(null,p(Re)),L(Nt,createMediapipeSolutionsWasm(Module),6);case 6:W.h=Nt.h,W.l=new OffscreenCanvas(1,1),W.h.canvas=W.l,We=W.h.GL.createContext(W.l,{antialias:!1,alpha:!1,ba:typeof WebGL2RenderingContext<"u"?2:1}),W.h.GL.makeContextCurrent(We),Nt.g=4;break;case 7:if(W.l=document.createElement("canvas"),Xt=W.l.getContext("webgl2",{}),!Xt&&(Xt=W.l.getContext("webgl",{}),!Xt))return alert("Failed to create WebGL canvas context when passing video frame."),Nt.return();W.D=Xt,W.h.canvas=W.l,W.h.createContext(W.l,!0,!0,{});case 4:W.i=new W.h.SolutionWasm,W.R=!1,Nt.g=0}})})}function ef(P){return Zr(P,function V(){var W=this,ue,Se,Be,Re,We,rt,_t,zt;return oe(V,function(vn){if(vn.g==1){if(W.g.graph&&W.g.graph.url&&W.P===W.g.graph.url)return vn.return();if(W.o=!0,!W.g.graph||!W.g.graph.url){vn.g=2;return}return W.P=W.g.graph.url,L(vn,Ja(W,W.g.graph.url),3)}for(vn.g!=2&&(ue=vn.h,W.i.loadGraph(ue)),Se=d(Object.keys(W.B)),Be=Se.next();!Be.done;Be=Se.next())Re=Be.value,W.i.overrideFile(Re,W.B[Re]);if(W.B={},W.g.listeners)for(We=d(W.g.listeners),rt=We.next();!rt.done;rt=We.next())_t=rt.value,Dl(W,_t);zt=W.j,W.j={},W.setOptions(zt),vn.g=0})})}t.reset=function(){return Zr(this,function P(){var V=this;return oe(P,function(W){V.i&&(V.i.reset(),V.m={},V.s={}),W.g=0})})},t.setOptions=function(P,V){var W=this;if(V=V||this.g.options){for(var ue=[],Se=[],Be={},Re=d(Object.keys(P)),We=Re.next();!We.done;Be={K:Be.K,L:Be.L},We=Re.next()){var rt=We.value;rt in this.j&&this.j[rt]===P[rt]||(this.j[rt]=P[rt],We=V[rt],We!==void 0&&(We.onChange&&(Be.K=We.onChange,Be.L=P[rt],ue.push(function(_t){return function(){return Zr(W,function zt(){var vn,an=this;return oe(zt,function(Xt){if(Xt.g==1)return L(Xt,_t.K(_t.L),2);vn=Xt.h,vn===!0&&(an.o=!0),Xt.g=0})})}}(Be))),We.graphOptionXref&&(rt={valueNumber:We.type===1?P[rt]:0,valueBoolean:We.type===0?P[rt]:!1,valueString:We.type===2?P[rt]:""},We=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),We.graphOptionXref),rt),Se.push(We))))}(ue.length!==0||Se.length!==0)&&(this.o=!0,this.A=(this.A===void 0?[]:this.A).concat(Se),this.u=(this.u===void 0?[]:this.u).concat(ue))}};function tf(P){return Zr(P,function V(){var W=this,ue,Se,Be,Re,We,rt,_t;return oe(V,function(zt){switch(zt.g){case 1:if(!W.o)return zt.return();if(!W.u){zt.g=2;break}ue=d(W.u),Se=ue.next();case 3:if(Se.done){zt.g=5;break}return Be=Se.value,L(zt,Be(),4);case 4:Se=ue.next(),zt.g=3;break;case 5:W.u=void 0;case 2:if(W.A){for(Re=new W.h.GraphOptionChangeRequestList,We=d(W.A),rt=We.next();!rt.done;rt=We.next())_t=rt.value,Re.push_back(_t);W.i.changeOptions(Re),Re.delete(),W.A=void 0}W.o=!1,zt.g=0}})})}t.initialize=function(){return Zr(this,function P(){var V=this;return oe(P,function(W){return W.g==1?L(W,xl(V),2):W.g!=3?L(W,ef(V),3):L(W,tf(V),0)})})};function Ja(P,V){return Zr(P,function W(){var ue=this,Se,Be;return oe(W,function(Re){return V in ue.F?Re.return(ue.F[V]):(Se=ue.locateFile(V,""),Be=fetch(Se).then(function(We){return We.arrayBuffer()}),ue.F[V]=Be,Re.return(Be))})})}t.overrideFile=function(P,V){this.i?this.i.overrideFile(P,V):this.B[P]=V},t.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},t.send=function(P,V){return Zr(this,function W(){var ue=this,Se,Be,Re,We,rt,_t,zt,vn,an;return oe(W,function(Xt){switch(Xt.g){case 1:return ue.g.inputs?(Se=1e3*(V??performance.now()),L(Xt,ue.C,2)):Xt.return();case 2:return L(Xt,ue.initialize(),3);case 3:for(Be=new ue.h.PacketDataList,Re=d(Object.keys(P)),We=Re.next();!We.done;We=Re.next())if(rt=We.value,_t=ue.g.inputs[rt]){e:{var Nt=ue,x=P[rt];switch(_t.type){case"video":var B=Nt.m[_t.stream];if(B||(B=new Si(Nt.h,Nt.D),Nt.m[_t.stream]=B),Nt=B,Nt.l===0&&(Nt.l=Nt.h.createTexture()),typeof HTMLVideoElement<"u"&&x instanceof HTMLVideoElement){var z=x.videoWidth;B=x.videoHeight}else typeof HTMLImageElement<"u"&&x instanceof HTMLImageElement?(z=x.naturalWidth,B=x.naturalHeight):(z=x.width,B=x.height);B={glName:Nt.l,width:z,height:B},z=Nt.g,z.canvas.width=B.width,z.canvas.height=B.height,z.activeTexture(z.TEXTURE0),Nt.h.bindTexture2d(Nt.l),z.texImage2D(z.TEXTURE_2D,0,z.RGBA,z.RGBA,z.UNSIGNED_BYTE,x),Nt.h.bindTexture2d(0),Nt=B;break e;case"detections":for(B=Nt.m[_t.stream],B||(B=new Zp(Nt.h),Nt.m[_t.stream]=B),Nt=B,Nt.data||(Nt.data=new Nt.g.DetectionListData),Nt.data.reset(x.length),B=0;B<x.length;++B){z=x[B];var ee=Nt.data,ce=ee.setBoundingBox,ie=B,le=z.T,he=new fu;ln(he,1,le.Z),ln(he,2,le.$),ln(he,3,le.height),ln(he,4,le.width),ln(he,5,le.rotation),ln(he,6,le.X);var be=le=new Qr;_r(be,1,Un(he,1)),_r(be,2,Un(he,2)),_r(be,3,Un(he,3)),_r(be,4,Un(he,4)),_r(be,5,Un(he,5));var je=Un(he,6);if(je!=null&&je!=null){Zt(be.g,48);var qe=be.g,st=je;je=0>st,st=Math.abs(st);var ut=st>>>0;for(st=Math.floor((st-ut)/4294967296),st>>>=0,je&&(st=~st>>>0,ut=(~ut>>>0)+1,4294967295<ut&&(ut=0,st++,4294967295<st&&(st=0))),Tt=ut,Lt=st,je=Tt,ut=Lt;0<ut||127<je;)qe.push(je&127|128),je=(je>>>7|ut<<25)>>>0,ut>>>=7;qe.push(je)}if(Na(he,be),le=Wr(le),ce.call(ee,ie,le),z.O)for(ee=0;ee<z.O.length;++ee)he=z.O[ee],be=!!he.visibility,ce=Nt.data,ie=ce.addNormalizedLandmark,le=B,he=Object.assign(Object.assign({},he),{visibility:be?he.visibility:0}),be=new Ya,ln(be,1,he.x),ln(be,2,he.y),ln(be,3,he.z),he.visibility&&ln(be,4,he.visibility),qe=he=new Qr,_r(qe,1,Un(be,1)),_r(qe,2,Un(be,2)),_r(qe,3,Un(be,3)),_r(qe,4,Un(be,4)),_r(qe,5,Un(be,5)),Na(be,qe),he=Wr(he),ie.call(ce,le,he);if(z.M)for(ee=0;ee<z.M.length;++ee){if(ce=Nt.data,ie=ce.addClassification,le=B,he=z.M[ee],be=new yi,ln(be,2,he.Y),he.index&&ln(be,1,he.index),he.label&&ln(be,3,he.label),he.displayName&&ln(be,4,he.displayName),qe=he=new Qr,ut=Un(be,1),ut!=null&&ut!=null)if(Zt(qe.g,8),je=qe.g,0<=ut)Zt(je,ut);else{for(st=0;9>st;st++)je.push(ut&127|128),ut>>=7;je.push(1)}_r(qe,2,Un(be,2)),je=Un(be,3),je!=null&&(je=Te(je),Zt(qe.g,26),Zt(qe.g,je.length),Lr(qe,qe.g.end()),Lr(qe,je)),je=Un(be,4),je!=null&&(je=Te(je),Zt(qe.g,34),Zt(qe.g,je.length),Lr(qe,qe.g.end()),Lr(qe,je)),Na(be,qe),he=Wr(he),ie.call(ce,le,he)}}Nt=Nt.data;break e;default:Nt={}}}switch(zt=Nt,vn=_t.stream,_t.type){case"video":Be.pushTexture2d(Object.assign(Object.assign({},zt),{stream:vn,timestamp:Se}));break;case"detections":an=zt,an.stream=vn,an.timestamp=Se,Be.pushDetectionList(an);break;default:throw Error("Unknown input config type: '"+_t.type+"'")}}return ue.i.send(Be),L(Xt,ue.C,4);case 4:Be.delete(),Xt.g=0}})})};function wc(P,V,W){return Zr(P,function ue(){var Se,Be,Re,We,rt,_t,zt=this,vn,an,Xt,Nt,x,B,z,ee;return oe(ue,function(ce){switch(ce.g){case 1:if(!W)return ce.return(V);for(Se={},Be=0,Re=d(Object.keys(W)),We=Re.next();!We.done;We=Re.next())rt=We.value,_t=W[rt],typeof _t!="string"&&_t.type==="texture"&&V[_t.stream]!==void 0&&++Be;1<Be&&(zt.G=!1),vn=d(Object.keys(W)),We=vn.next();case 2:if(We.done){ce.g=4;break}if(an=We.value,Xt=W[an],typeof Xt=="string")return z=Se,ee=an,L(ce,kl(zt,an,V[Xt]),14);if(Nt=V[Xt.stream],Xt.type==="detection_list"){if(Nt){for(var ie=Nt.getRectList(),le=Nt.getLandmarksList(),he=Nt.getClassificationsList(),be=[],je=0;je<ie.size();++je){var qe=ie.get(je);e:{var st=new fu;for(qe=new xn(qe);pn(qe);)switch(qe.i){case 13:var ut=Bn(qe);ln(st,1,ut);break;case 21:ut=Bn(qe),ln(st,2,ut);break;case 29:ut=Bn(qe),ln(st,3,ut);break;case 37:ut=Bn(qe),ln(st,4,ut);break;case 45:ut=Bn(qe),ln(st,5,ut);break;case 48:ut=Kt(qe.g),ln(st,6,ut);break;default:if(!mo(st,qe))break e}}st={Z:zr(st,1),$:zr(st,2),height:zr(st,3),width:zr(st,4),rotation:zr(st,5,0),X:Ki(st,6,0)},qe=Xa(Xd(le.get(je)),Ya).map(Eu);var ft=he.get(je);e:for(ut=new pu,ft=new xn(ft);pn(ft);)switch(ft.i){case 10:ut.addClassification(Pn(ft,new yi,qd));break;default:if(!mo(ut,ft))break e}st={T:st,O:qe,M:gu(ut)},be.push(st)}ie=be}else ie=[];Se[an]=ie,ce.g=7;break}if(Xt.type==="proto_list"){if(Nt){for(ie=Array(Nt.size()),le=0;le<Nt.size();le++)ie[le]=Nt.get(le);Nt.delete()}else ie=[];Se[an]=ie,ce.g=7;break}if(Nt===void 0){ce.g=3;break}if(Xt.type==="float_list"){Se[an]=Nt,ce.g=7;break}if(Xt.type==="proto"){Se[an]=Nt,ce.g=7;break}if(Xt.type!=="texture")throw Error("Unknown output config type: '"+Xt.type+"'");return x=zt.s[an],x||(x=new Si(zt.h,zt.D),zt.s[an]=x),L(ce,go(x,Nt,zt.G),13);case 13:B=ce.h,Se[an]=B;case 7:Xt.transform&&Se[an]&&(Se[an]=Xt.transform(Se[an])),ce.g=3;break;case 14:z[ee]=ce.h;case 3:We=vn.next(),ce.g=2;break;case 4:return ce.return(Se)}})})}function kl(P,V,W){return Zr(P,function ue(){var Se=this,Be;return oe(ue,function(Re){return typeof W=="number"||W instanceof Uint8Array||W instanceof Se.h.Uint8BlobList?Re.return(W):W instanceof Se.h.Texture2dDataOut?(Be=Se.s[V],Be||(Be=new Si(Se.h,Se.D),Se.s[V]=Be),Re.return(go(Be,W,Se.G))):Re.return(void 0)})})}function Dl(P,V){for(var W=V.name||"$",ue=[].concat(p(V.wants)),Se=new P.h.StringList,Be=d(V.wants),Re=Be.next();!Re.done;Re=Be.next())Se.push_back(Re.value);Be=P.h.PacketListener.implement({onResults:function(We){for(var rt={},_t=0;_t<V.wants.length;++_t)rt[ue[_t]]=We.get(_t);var zt=P.listeners[W];zt&&(P.C=wc(P,rt,V.outs).then(function(vn){vn=zt(vn);for(var an=0;an<V.wants.length;++an){var Xt=rt[ue[an]];typeof Xt=="object"&&Xt.hasOwnProperty&&Xt.hasOwnProperty("delete")&&Xt.delete()}vn&&(P.C=vn)}))}}),P.i.attachMultiListener(Se,Be),Se.delete()}t.onResults=function(P,V){this.listeners[V||"$"]=P},ye("Solution",Oa),ye("OptionType",{BOOL:0,NUMBER:1,aa:2,0:"BOOL",1:"NUMBER",2:"STRING"});function nf(P){P=Al(P);var V=P.getMesh();if(!V)return P;var W=new Float32Array(V.getVertexBufferList());V.getVertexBufferList=function(){return W};var ue=new Uint32Array(V.getIndexBufferList());return V.getIndexBufferList=function(){return ue},P}var Rc={files:[{url:"face_mesh_solution_packed_assets_loader.js"},{simd:!0,url:"face_mesh_solution_simd_wasm_bin.js"},{simd:!1,url:"face_mesh_solution_wasm_bin.js"}],graph:{url:"face_mesh.binarypb"},listeners:[{wants:["multi_face_geometry","image_transformed","multi_face_landmarks"],outs:{image:"image_transformed",multiFaceGeometry:{type:"proto_list",stream:"multi_face_geometry",transform:function(P){return P.map(nf)}},multiFaceLandmarks:{type:"proto_list",stream:"multi_face_landmarks",transform:function(P){return P.map(function(V){return Xa(Xd(V),Ya).map(Eu)})}}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},enableFaceGeometry:{type:0,graphOptionXref:{calculatorName:"EnableFaceGeometryConstant",calculatorType:"ConstantSidePacketCalculator",fieldName:"bool_value"}},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},maxNumFaces:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorNumFaces",fieldName:"int_value"}},refineLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorRefineLandmarks",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"facelandmarkfrontgpu__facedetectionshortrangegpu__facedetectionshortrangecommon__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"facelandmarkfrontgpu__facelandmarkgpu__ThresholdingCalculator",fieldName:"threshold"}},cameraNear:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"near"}},cameraFar:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"far"}},cameraVerticalFovDegrees:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"vertical_fov_degrees"}}}},Pl=[[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]],yu=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],Ll=[[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]],Ml=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],$l=[[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]],Fl=[[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]],eh=[].concat(p(Pl),p(yu),p(Ll),p(Ml),p($l),p(Fl));function th(P){P=P||{},P=Object.assign(Object.assign({},Rc),P),this.g=new Oa(P)}t=th.prototype,t.close=function(){return this.g.close(),Promise.resolve()},t.onResults=function(P){this.g.onResults(P)},t.initialize=function(){return Zr(this,function P(){var V=this;return oe(P,function(W){return L(W,V.g.initialize(),0)})})},t.reset=function(){this.g.reset()},t.send=function(P){return Zr(this,function V(){var W=this;return oe(V,function(ue){return L(ue,W.g.send(P),0)})})},t.setOptions=function(P){this.g.setOptions(P)},ye("FACE_GEOMETRY",{Layout:{COLUMN_MAJOR:0,ROW_MAJOR:1,0:"COLUMN_MAJOR",1:"ROW_MAJOR"},PrimitiveType:{TRIANGLE:0,0:"TRIANGLE"},VertexType:{VERTEX_PT:0,0:"VERTEX_PT"},DEFAULT_CAMERA_PARAMS:{verticalFovDegrees:63,near:1,far:1e4}}),ye("FaceMesh",th),ye("FACEMESH_LIPS",Pl),ye("FACEMESH_LEFT_EYE",yu),ye("FACEMESH_LEFT_EYEBROW",Ll),ye("FACEMESH_LEFT_IRIS",[[474,475],[475,476],[476,477],[477,474]]),ye("FACEMESH_RIGHT_EYE",Ml),ye("FACEMESH_RIGHT_EYEBROW",$l),ye("FACEMESH_RIGHT_IRIS",[[469,470],[470,471],[471,472],[472,469]]),ye("FACEMESH_FACE_OVAL",Fl),ye("FACEMESH_CONTOURS",eh),ye("FACEMESH_TESSELATION",[[127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]]),ye("matrixDataToMatrix",function(P){for(var V=P.getCols(),W=P.getRows(),ue=P.getPackedDataList(),Se=[],Be=0;Be<W;Be++)Se.push(Array(V));for(Be=0;Be<W;Be++)for(var Re=0;Re<V;Re++){var We=P.getLayout()===1?Be*V+Re:Re*W+Be;Se[Be][Re]=ue[We]}return Se}),ye("VERSION","0.4.1633559619")}).call(Bi);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aQ=1e-7,cQ=1e-4;class zU{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class rw{refCount(e){return Mi("refCount")}incRef(e){return Mi("incRef")}timerAvailable(){return!0}time(e){return Mi("time")}read(e){return Mi("read")}readSync(e){return Mi("readSync")}readToGPU(e,n){return Mi("readToGPU")}numDataIds(){return Mi("numDataIds")}disposeData(e,n){return Mi("disposeData")}write(e,n,s){return Mi("write")}move(e,n,s,i,c){return Mi("move")}memory(){return Mi("memory")}floatPrecision(){return Mi("floatPrecision")}epsilon(){return this.floatPrecision()===32?aQ:cQ}dispose(){return Mi("dispose")}}function Mi(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bd(t,e,n){return Math.max(t,Math.min(e,n))}function sw(t){return t%2===0?t:t+1}function qf(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function uQ(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function se(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function gi(t,e,n=""){se(Nr(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function Up(t){se(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Ip(t,e=[],n=!1){if(e==null&&(e=[]),Array.isArray(t)||Sc(t)&&!n)for(let s=0;s<t.length;++s)Ip(t[s],e,n);else e.push(t);return e}function Pe(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function Nr(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Cp(t){return t%1===0}function p2(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function hp(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function lM(t,e=i=>0,n,s=setTimeout){return new Promise((i,c)=>{let l=0;const d=()=>{if(t()){i();return}l++;const p=e(l);if(n!=null&&l>=n){c();return}s(d,p)};d()})}function HU(t,e){let n=1,s=-1;for(let c=0;c<t.length;++c)if(t[c]>=0)n*=t[c];else if(t[c]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${c}`);s=c}else if(t[c]<0)throw Error(`Shapes can not be < 0. Found ${t[c]} at dim ${c}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const i=t.slice();return i[s]=e/n,i}function $n(t,e){const n=e.length;return t=t==null?e.map((s,i)=>i):[].concat(t),se(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),se(t.every(s=>Cp(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function vl(t,e){const n=[],s=[],i=e!=null&&Array.isArray(e)&&e.length===0,c=e==null||i?null:$n(e,t).sort();let l=0;for(let d=0;d<t.length;++d){if(c!=null){if(c[l]===d&&t[d]!==1)throw new Error(`Can't squeeze axis ${d} since its dim '${t[d]}' is not 1`);(c[l]==null||c[l]>d)&&t[d]===1&&(n.push(t[d]),s.push(d)),c[l]<=d&&l++}t[d]!==1&&(n.push(t[d]),s.push(d))}return{newShape:n,keptDims:s}}function Ms(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else throw new Error(`Unknown data type ${t}`);return n}function Ps(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function lQ(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function dQ(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function KU(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function Sc(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function f2(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function hQ(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function Qm(t){return typeof t=="string"||t instanceof String}function pQ(t){return typeof t=="boolean"}function fQ(t){return typeof t=="number"}function Zm(t){return Array.isArray(t)?Zm(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":fQ(t)?"float32":Qm(t)?"string":pQ(t)?"bool":"float32"}function dM(t){return!!(t&&t.constructor&&t.call&&t.apply)}function m2(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function Pt(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function qU(t,e,n,s=!1){const i=new Array;if(e.length===1){const c=e[0]*(s?2:1);for(let l=0;l<c;l++)i[l]=n[t+l]}else{const c=e[0],l=e.slice(1),d=l.reduce((p,f)=>p*f)*(s?2:1);for(let p=0;p<c;p++)i[p]=qU(t+p*d,l,n,s)}return i}function ya(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((i,c)=>i*c)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return qU(0,t,e,n)}function ow(t,e){const n=lo(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function lo(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function XU(t,e){const n=t.reduce((s,i)=>s*i,1);if(e==null||e==="float32")return ya(t,new Float32Array(n));if(e==="int32")return ya(t,new Int32Array(n));if(e==="bool")return ya(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function YU(t){t.forEach(e=>{se(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function _c(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let i=0;i<t.length-1;++i)s+=n[i]*t[i];return s}function Vp(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let i=0;i<s.length-1;++i)s[i]=Math.floor(t/n[i]),t-=s[i]*n[i];return s[s.length-1]=t,s}function wp(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hM="tfjsflags";class mQ{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=gQ,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(De().getBool("IS_TEST")||De().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const i=this.urlFlags[e];De().getBool("IS_TEST")||De().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${i}.`),this.set(e,i)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(wp(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);hM in e&&e[hM].split(",").forEach(s=>{const[i,c]=s.split(":");this.urlFlags[i]=_Q(i,c)})}}function gQ(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(EQ(e,s[0],s[1]),s.join("="))),e}function EQ(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function _Q(t,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}function De(){return JU}let JU=null;function yQ(t){JU=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let qT;function QU(){if(qT==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");qT=t}return qT}function vQ(){const t=QU();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function iw(t,e){const n=vQ();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const aw="Abs",G1="Acos",z1="Acosh",eg="Add",cw="AddN",uw="All",lw="Any",dw="ArgMax",hw="ArgMin",H1="Asin",K1="Asinh",q1="Atan",X1="Atanh",Y1="Atan2",pw="AvgPool",ZU="AvgPoolGrad",fw="AvgPool3D",e6="AvgPool3DGrad",mw="BatchMatMul",gw="BatchToSpaceND",Ew="Bincount",_w="BroadcastArgs",J1="Cast",Q1="Ceil",Z1="ClipByValue",yw="Complex",vw="ComplexAbs",Sw="Concat",Tw="Conv2D",Iw="Conv2DBackpropFilter",Cw="Conv2DBackpropInput",ww="Conv3D",t6="Conv3DBackpropFilterV2",Rw="Conv3DBackpropInputV2",e_="Cos",t_="Cosh",bw="Cumprod",Nw="Cumsum",Aw="CropAndResize",Ow="DenseBincount",xw="DepthToSpace",kw="DepthwiseConv2dNative",Dw="DepthwiseConv2dNativeBackpropFilter",Pw="DepthwiseConv2dNativeBackpropInput",Lw="Diag",Mw="Dilation2D",pM="Dilation2DBackpropInput",fM="Dilation2DBackpropFilter",n_="RealDiv",$w="Einsum",r_="Elu",n6="EluGrad",s_="Erf",o_="Equal",i_="Exp",Fw="ExpandDims",a_="Expm1",Uw="FFT",Vw="Fill",Bw="FlipLeftRight",c_="Floor",u_="FloorDiv",jw="FusedBatchNorm",Ww="GatherV2",Gw="GatherNd",l_="Greater",d_="GreaterEqual",h_="Identity",zw="IFFT",Hw="Imag",p_="IsFinite",f_="IsInf",m_="IsNan",Kw="LeakyRelu",g_="Less",E_="LessEqual",qw="LinSpace",__="Log",y_="Log1p",v_="LogicalAnd",S_="LogicalNot",T_="LogicalOr",Xw="LRN",r6="LRNGrad",Yw="Max",I_="Maximum",Jw="MaxPool",s6="MaxPoolGrad",Qw="MaxPool3D",o6="MaxPool3DGrad",Zw="MaxPoolWithArgmax",eR="Mean",tR="Min",C_="Minimum",nR="MirrorPad",w_="Mod",rR="Multinomial",R_="Multiply",sR="Neg",b_="NotEqual",oR="NonMaxSuppressionV3",iR="NonMaxSuppressionV4",aR="NonMaxSuppressionV5",cR="OnesLike",uR="OneHot",lR="Pack",dR="PadV2",N_="Pow",hR="Prelu",pR="Prod",fR="RaggedGather",mR="RaggedTensorToTensor",gR="Range",ER="Real",A_="Reciprocal",O_="Relu",_R="Reshape",yR="ResizeNearestNeighbor",i6="ResizeNearestNeighborGrad",vR="ResizeBilinear",a6="ResizeBilinearGrad",x_="Relu6",SR="Reverse",k_="Round",D_="Rsqrt",TR="ScatterNd",IR="SearchSorted",CR="Select",P_="Selu",wR="Slice",L_="Sin",M_="Sinh",$_="Sign",F_="Sigmoid",U_="Softplus",V_="Sqrt",RR="Sum",bR="SpaceToBatchND",NR="SplitV",AR="Softmax",OR="SparseFillEmptyRows",xR="SparseReshape",kR="SparseSegmentMean",DR="SparseSegmentSum",PR="SparseToDense",B_="SquaredDifference",c6="Square",LR="StridedSlice",MR="StringNGrams",$R="StringSplit",FR="StringToHashBucketFast",j_="Sub",W_="Tan",G_="Tanh",z_="Tile",UR="TopK",VR="Transform",Em="Transpose",BR="Unique",jR="Unpack",WR="UnsortedSegmentSum",GR="ZerosLike",H_="Step",g2="FromPixels",zR="RotateWithOffset",r1="_FusedMatMul",s1="FusedConv2D",o1="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ha(...t){De().getBool("IS_TEST")||De().getBool("PROD")||console.warn(...t)}function SQ(...t){De().getBool("IS_TEST")||De().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i1=iw("kernelRegistry",()=>new Map),TQ=iw("gradRegistry",()=>new Map);function E2(t,e){const n=l6(t,e);return i1.get(n)}function mM(t){return TQ.get(t)}function gM(t){const e=i1.entries(),n=[];for(;;){const{done:s,value:i}=e.next();if(s)break;const[c,l]=i,[d]=c.split("_");d===t&&n.push(l)}return n}function u6(t){const{kernelName:e,backendName:n}=t,s=l6(e,n);i1.has(s)&&ha(`The kernel '${e}' for backend '${n}' is already registered`),i1.set(s,t)}function l6(t,e){return`${e}_${t}`}var _2=Rr,fa=null;try{fa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Rr(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}Rr.prototype.__isLong__;Object.defineProperty(Rr.prototype,"__isLong__",{value:!0});function Ei(t){return(t&&t.__isLong__)===!0}Rr.isLong=Ei;var EM={},_M={};function Ud(t,e){var n,s,i;return e?(t>>>=0,(i=0<=t&&t<256)&&(s=_M[t],s)?s:(n=br(t,(t|0)<0?-1:0,!0),i&&(_M[t]=n),n)):(t|=0,(i=-128<=t&&t<128)&&(s=EM[t],s)?s:(n=br(t,t<0?-1:0,!1),i&&(EM[t]=n),n))}Rr.fromInt=Ud;function ma(t,e){if(isNaN(t))return e?pd:ga;if(e){if(t<0)return pd;if(t>=d6)return f6}else{if(t<=-vM)return ui;if(t+1>=vM)return p6}return t<0?ma(-t,e).neg():br(t%Rp|0,t/Rp|0,e)}Rr.fromNumber=ma;function br(t,e,n){return new Rr(t,e,n)}Rr.fromBits=br;var a1=Math.pow;function HR(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return ga;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return HR(t.substring(1),e,n).neg();for(var i=ma(a1(n,8)),c=ga,l=0;l<t.length;l+=8){var d=Math.min(8,t.length-l),p=parseInt(t.substring(l,l+d),n);if(d<8){var f=ma(a1(n,d));c=c.mul(f).add(ma(p))}else c=c.mul(i),c=c.add(ma(p))}return c.unsigned=e,c}Rr.fromString=HR;function qa(t,e){return typeof t=="number"?ma(t,e):typeof t=="string"?HR(t,e):br(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Rr.fromValue=qa;var yM=1<<16,IQ=1<<24,Rp=yM*yM,d6=Rp*Rp,vM=d6/2,SM=Ud(IQ),ga=Ud(0);Rr.ZERO=ga;var pd=Ud(0,!0);Rr.UZERO=pd;var sp=Ud(1);Rr.ONE=sp;var h6=Ud(1,!0);Rr.UONE=h6;var y2=Ud(-1);Rr.NEG_ONE=y2;var p6=br(-1,2147483647,!1);Rr.MAX_VALUE=p6;var f6=br(-1,-1,!0);Rr.MAX_UNSIGNED_VALUE=f6;var ui=br(0,-2147483648,!1);Rr.MIN_VALUE=ui;var ht=Rr.prototype;ht.toInt=function(){return this.unsigned?this.low>>>0:this.low};ht.toNumber=function(){return this.unsigned?(this.high>>>0)*Rp+(this.low>>>0):this.high*Rp+(this.low>>>0)};ht.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ui)){var n=ma(e),s=this.div(n),i=s.mul(n).sub(this);return s.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var c=ma(a1(e,6),this.unsigned),l=this,d="";;){var p=l.div(c),f=l.sub(p.mul(c)).toInt()>>>0,m=f.toString(e);if(l=p,l.isZero())return m+d;for(;m.length<6;)m="0"+m;d=""+m+d}};ht.getHighBits=function(){return this.high};ht.getHighBitsUnsigned=function(){return this.high>>>0};ht.getLowBits=function(){return this.low};ht.getLowBitsUnsigned=function(){return this.low>>>0};ht.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ui)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};ht.isZero=function(){return this.high===0&&this.low===0};ht.eqz=ht.isZero;ht.isNegative=function(){return!this.unsigned&&this.high<0};ht.isPositive=function(){return this.unsigned||this.high>=0};ht.isOdd=function(){return(this.low&1)===1};ht.isEven=function(){return(this.low&1)===0};ht.equals=function(e){return Ei(e)||(e=qa(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};ht.eq=ht.equals;ht.notEquals=function(e){return!this.eq(e)};ht.neq=ht.notEquals;ht.ne=ht.notEquals;ht.lessThan=function(e){return this.comp(e)<0};ht.lt=ht.lessThan;ht.lessThanOrEqual=function(e){return this.comp(e)<=0};ht.lte=ht.lessThanOrEqual;ht.le=ht.lessThanOrEqual;ht.greaterThan=function(e){return this.comp(e)>0};ht.gt=ht.greaterThan;ht.greaterThanOrEqual=function(e){return this.comp(e)>=0};ht.gte=ht.greaterThanOrEqual;ht.ge=ht.greaterThanOrEqual;ht.compare=function(e){if(Ei(e)||(e=qa(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};ht.comp=ht.compare;ht.negate=function(){return!this.unsigned&&this.eq(ui)?ui:this.not().add(sp)};ht.neg=ht.negate;ht.add=function(e){Ei(e)||(e=qa(e));var n=this.high>>>16,s=this.high&65535,i=this.low>>>16,c=this.low&65535,l=e.high>>>16,d=e.high&65535,p=e.low>>>16,f=e.low&65535,m=0,_=0,y=0,v=0;return v+=c+f,y+=v>>>16,v&=65535,y+=i+p,_+=y>>>16,y&=65535,_+=s+d,m+=_>>>16,_&=65535,m+=n+l,m&=65535,br(y<<16|v,m<<16|_,this.unsigned)};ht.subtract=function(e){return Ei(e)||(e=qa(e)),this.add(e.neg())};ht.sub=ht.subtract;ht.multiply=function(e){if(this.isZero())return ga;if(Ei(e)||(e=qa(e)),fa){var n=fa.mul(this.low,this.high,e.low,e.high);return br(n,fa.get_high(),this.unsigned)}if(e.isZero())return ga;if(this.eq(ui))return e.isOdd()?ui:ga;if(e.eq(ui))return this.isOdd()?ui:ga;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(SM)&&e.lt(SM))return ma(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,i=this.high&65535,c=this.low>>>16,l=this.low&65535,d=e.high>>>16,p=e.high&65535,f=e.low>>>16,m=e.low&65535,_=0,y=0,v=0,I=0;return I+=l*m,v+=I>>>16,I&=65535,v+=c*m,y+=v>>>16,v&=65535,v+=l*f,y+=v>>>16,v&=65535,y+=i*m,_+=y>>>16,y&=65535,y+=c*f,_+=y>>>16,y&=65535,y+=l*p,_+=y>>>16,y&=65535,_+=s*m+i*f+c*p+l*d,_&=65535,br(v<<16|I,_<<16|y,this.unsigned)};ht.mul=ht.multiply;ht.divide=function(e){if(Ei(e)||(e=qa(e)),e.isZero())throw Error("division by zero");if(fa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?fa.div_u:fa.div_s)(this.low,this.high,e.low,e.high);return br(n,fa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?pd:ga;var s,i,c;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return pd;if(e.gt(this.shru(1)))return h6;c=pd}else{if(this.eq(ui)){if(e.eq(sp)||e.eq(y2))return ui;if(e.eq(ui))return sp;var l=this.shr(1);return s=l.div(e).shl(1),s.eq(ga)?e.isNegative()?sp:y2:(i=this.sub(e.mul(s)),c=s.add(i.div(e)),c)}else if(e.eq(ui))return this.unsigned?pd:ga;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();c=ga}for(i=this;i.gte(e);){s=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var d=Math.ceil(Math.log(s)/Math.LN2),p=d<=48?1:a1(2,d-48),f=ma(s),m=f.mul(e);m.isNegative()||m.gt(i);)s-=p,f=ma(s,this.unsigned),m=f.mul(e);f.isZero()&&(f=sp),c=c.add(f),i=i.sub(m)}return c};ht.div=ht.divide;ht.modulo=function(e){if(Ei(e)||(e=qa(e)),fa){var n=(this.unsigned?fa.rem_u:fa.rem_s)(this.low,this.high,e.low,e.high);return br(n,fa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};ht.mod=ht.modulo;ht.rem=ht.modulo;ht.not=function(){return br(~this.low,~this.high,this.unsigned)};ht.and=function(e){return Ei(e)||(e=qa(e)),br(this.low&e.low,this.high&e.high,this.unsigned)};ht.or=function(e){return Ei(e)||(e=qa(e)),br(this.low|e.low,this.high|e.high,this.unsigned)};ht.xor=function(e){return Ei(e)||(e=qa(e)),br(this.low^e.low,this.high^e.high,this.unsigned)};ht.shiftLeft=function(e){return Ei(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?br(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):br(0,this.low<<e-32,this.unsigned)};ht.shl=ht.shiftLeft;ht.shiftRight=function(e){return Ei(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?br(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):br(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};ht.shr=ht.shiftRight;ht.shiftRightUnsigned=function(e){if(Ei(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return br(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?br(n,0,this.unsigned):br(n>>>e-32,0,this.unsigned)};ht.shru=ht.shiftRightUnsigned;ht.shr_u=ht.shiftRightUnsigned;ht.toSigned=function(){return this.unsigned?br(this.low,this.high,!1):this};ht.toUnsigned=function(){return this.unsigned?this:br(this.low,this.high,!0)};ht.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};ht.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};ht.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};Rr.fromBytes=function(e,n,s){return s?Rr.fromBytesLE(e,n):Rr.fromBytesBE(e,n)};Rr.fromBytesLE=function(e,n){return new Rr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};Rr.fromBytesBE=function(e,n){return new Rr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const CQ=EX({__proto__:null,default:_2},[_2]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cd=_2||CQ;function K_(t){return cd.fromString(t,!0,16)}const m6=K_("c3a5c85c97cb3127"),ad=K_("b492b66fbe98f273"),xo=K_("9ae16a3b2f90404f");function v2(t){return t.xor(t.shru(47))}function g6(t,e,n){const s=t.slice(e,e+n);return cd.fromBytes(Array.from(s),!0,!0)}function fr(t,e){return g6(t,e,8)}function TM(t,e){return g6(t,e,4)}function ks(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function al(t,e,n=K_("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let i=e.xor(s).mul(n);return i=i.xor(i.shru(47)),i=i.mul(n),i}function wQ(t,e,n,s,i,c){i=i.add(t),c=ks(c.add(i).add(s),21);const l=i;return i=i.add(e),i=i.add(n),c=c.add(ks(i,44)),[i.add(s),c.add(l)]}function i0(t,e,n,s){return wQ(fr(t,e),fr(t,e+8),fr(t,e+16),fr(t,e+24),n,s)}function RQ(t,e=t.length){if(e>=8){const n=xo.add(e*2),s=fr(t,0).add(xo),i=fr(t,e-8),c=ks(i,37).mul(n).add(s),l=ks(s,25).add(i).mul(n);return al(c,l,n)}if(e>=4){const n=xo.add(e*2),s=TM(t,0);return al(s.shl(3).add(e),TM(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],i=t[e-1],c=n+(s<<8),l=e+(i<<2);return v2(xo.mul(c).xor(m6.mul(l))).mul(xo)}return xo}function bQ(t,e=t.length){const n=xo.add(e*2),s=fr(t,0).mul(ad),i=fr(t,8),c=fr(t,e-8).mul(n),l=fr(t,e-16).mul(xo);return al(ks(s.add(i),43).add(ks(c,30)).add(l),s.add(ks(i.add(xo),18)).add(c),n)}function NQ(t,e=t.length){const n=xo.add(e*2),s=fr(t,0).mul(xo),i=fr(t,8),c=fr(t,e-8).mul(n),l=fr(t,e-16).mul(xo),d=ks(s.add(i),43).add(ks(c,30)).add(l),p=al(d,s.add(ks(i.add(xo),18)).add(c),n),f=fr(t,16).mul(n),m=fr(t,24),_=d.add(fr(t,e-32)).mul(n),y=p.add(fr(t,e-24)).mul(n);return al(ks(f.add(m),43).add(ks(_,30)).add(y),f.add(ks(m.add(s),18)).add(_),n)}function AQ(t,e=t.length){const n=cd.fromNumber(81,!0);if(e<=32)return e<=16?RQ(t,e):bQ(t,e);if(e<=64)return NQ(t,e);let s=n,i=n.mul(ad).add(113),c=v2(i.mul(xo).add(113)).mul(xo),l=[cd.UZERO,cd.UZERO],d=[cd.UZERO,cd.UZERO];s=s.mul(xo).add(fr(t,0));let p=0;const f=(e-1>>6)*64,m=f+(e-1&63)-63;do s=ks(s.add(i).add(l[0]).add(fr(t,p+8)),37).mul(ad),i=ks(i.add(l[1]).add(fr(t,p+48)),42).mul(ad),s=s.xor(d[1]),i=i.add(l[0]).add(fr(t,p+40)),c=ks(c.add(d[0]),33).mul(ad),l=i0(t,p,l[1].mul(ad),s.add(d[0])),d=i0(t,p+32,c.add(d[1]),i.add(fr(t,p+16))),[c,s]=[s,c],p+=64;while(p!==f);const _=ad.add(c.and(255).shl(1));return p=m,d[0]=d[0].add(e-1&63),l[0]=l[0].add(d[0]),d[0]=d[0].add(l[0]),s=ks(s.add(i).add(l[0]).add(fr(t,p+8)),37).mul(_),i=ks(i.add(l[1]).add(fr(t,p+48)),42).mul(_),s=s.xor(d[1].mul(9)),i=i.add(l[0].mul(9).add(fr(t,p+40))),c=ks(c.add(d[0]),33).mul(_),l=i0(t,p,l[1].mul(_),s.add(d[0])),d=i0(t,p+32,c.add(d[1]),i.add(fr(t,p+16))),[c,s]=[s,c],al(al(l[0],d[0],_).add(v2(i).mul(m6)).add(c),al(l[1],d[1],_).add(s),_)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sl(t,e){return e==="string"?cl(t):Vd([t],e)}function OQ(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Vd(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Ip(t)),De().getBool("DEBUG")&&lQ(t,e),OQ(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function Fi(){return De().platform.now()}function cl(t,e="utf-8"){return e=e||"utf-8",De().platform.encode(t,e)}function pl(t,e="utf-8"){return e=e||"utf-8",De().platform.decode(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xQ{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new DQ)}profileKernel(e,n,s){let i;const c=()=>{i=s()};let l;const d=Fi();if(this.backendTimer.timerAvailable())l=this.backendTimer.time(c);else{c();for(const f of i)f.dataSync();l=Promise.resolve({kernelMs:Fi()-d})}if(De().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let f=0;f<i.length;f++){const m=i[f];m.data().then(_=>{kQ(_,m.dtype,e)})}return{kernelName:e,outputs:i,inputs:n,timeMs:l.then(f=>f.kernelMs),extraInfo:l.then(f=>f.getExtraProfileInfo!=null?f.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:i,inputs:c,extraInfo:l}=e;s.forEach(d=>{Promise.all([d.data(),i,l]).then(p=>{this.logger.logKernelProfile(n,d,p[0],p[1],c,p[2])})})}}function kQ(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const i=t[s];if(isNaN(i)||!isFinite(i))return console.warn(`Found ${i} in the result of '${n}'`),!0}return!1}class DQ{logKernelProfile(e,n,s,i,c,l){const d=typeof i=="number"?hp(`${i}ms`,9):i.error,p=hp(e,25),f=n.rank,m=n.size,_=hp(n.shape.toString(),14);let y="";for(const v in c){const I=c[v];if(I!=null){const b=I.shape||n.shape,A=b.length;y+=`${v}: ${A}D ${A>0?b:""} `}}console.log(`%c${p}	%c${d}	%c${f}D ${_}	%c${m}	%c${y}	%c${l}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PQ(t,e,n){const s={},i={};for(let p=0;p<e.length;p++)s[e[p].id]=!0;for(let p=0;p<t.length;p++){const f=t[p],m=f.inputs;for(const _ in m){const y=m[_];let v=!1;for(let I=0;I<e.length;I++)if(s[y.id]){f.outputs.forEach(b=>s[b.id]=!0),v=!0,i[f.id]=!0;break}if(v)break}}const c={};c[n.id]=!0;const l={};for(let p=t.length-1;p>=0;p--){const f=t[p],m=f.inputs;for(let _=0;_<f.outputs.length;_++)if(c[f.outputs[_].id]){for(const y in m)c[m[y].id]=!0,l[f.id]=!0;break}}const d=[];for(let p=0;p<t.length;p++){const f=t[p];if(i[f.id]&&l[f.id]){const m={};for(const y in f.inputs){const v=f.inputs[y];s[v.id]&&(m[y]=v)}const _=Object.assign({},f);_.inputs=m,_.outputs=f.outputs,d.push(_)}}return d}function LQ(t,e,n,s){for(let i=e.length-1;i>=0;i--){const c=e[i],l=[];if(c.outputs.forEach(p=>{const f=t[p.id];f!=null?l.push(f):l.push(null)}),c.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${c.kernelName}.`);const d=c.gradient(l);for(const p in c.inputs){if(!(p in d))throw new Error(`Cannot backprop through input ${p}. Available gradients found: ${Object.keys(d)}.`);const f=n(()=>d[p]());if(f.dtype!=="float32")throw new Error(`Error in gradient for op ${c.kernelName}. The gradient of input ${p} must have 'float32' dtype, but has '${f.dtype}'`);const m=c.inputs[p];if(!Nr(f.shape,m.shape))throw new Error(`Error in gradient for op ${c.kernelName}. The gradient of input '${p}' has shape '${f.shape}', which does not match the shape of the input '${m.shape}'`);if(t[m.id]==null)t[m.id]=f;else{const _=t[m.id];t[m.id]=s(_,f),_.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IM=20,Xf=3,XT=7;function MQ(t,e,n,s){const i=Pt(e),c=$Q(t,e,n,i),l=e.length,d=A0(t,e,n,i,c),p=["Tensor"];return s&&(p.push(`  dtype: ${n}`),p.push(`  rank: ${l}`),p.push(`  shape: [${e}]`),p.push("  values:")),p.push(d.map(f=>"    "+f).join(`
`)),p.join(`
`)}function $Q(t,e,n,s){const i=Pe(e),c=s[s.length-1],l=new Array(c).fill(0),d=e.length,p=n==="complex64"?sm(t):t;if(d>1)for(let f=0;f<i/c;f++){const m=f*c;for(let _=0;_<c;_++)l[_]=Math.max(l[_],rm(p[m+_],0,n).length)}return l}function rm(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(XT))} + ${parseFloat(t[1].toFixed(XT))}j`:Qm(t)?s=`'${t}'`:n==="bool"?s=E6(t):s=parseFloat(t.toFixed(XT)).toString(),hp(s,e)}function E6(t){return t===0?"false":"true"}function A0(t,e,n,s,i,c=!0){const l=n==="complex64"?2:1,d=e[0],p=e.length;if(p===0){if(n==="complex64"){const b=sm(t);return[rm(b[0],0,n)]}return n==="bool"?[E6(t[0])]:[t[0].toString()]}if(p===1){if(d>IM){const A=Xf*l;let R=Array.from(t.slice(0,A)),O=Array.from(t.slice((d-Xf)*l,d*l));return n==="complex64"&&(R=sm(R),O=sm(O)),["["+R.map((L,$)=>rm(L,i[$],n)).join(", ")+", ..., "+O.map((L,$)=>rm(L,i[d-Xf+$],n)).join(", ")+"]"]}return["["+(n==="complex64"?sm(t):Array.from(t)).map((A,R)=>rm(A,i[R],n)).join(", ")+"]"]}const f=e.slice(1),m=s.slice(1),_=s[0]*l,y=[];if(d>IM){for(let b=0;b<Xf;b++){const A=b*_,R=A+_;y.push(...A0(t.slice(A,R),f,n,m,i,!1))}y.push("...");for(let b=d-Xf;b<d;b++){const A=b*_,R=A+_;y.push(...A0(t.slice(A,R),f,n,m,i,b===d-1))}}else for(let b=0;b<d;b++){const A=b*_,R=A+_;y.push(...A0(t.slice(A,R),f,n,m,i,b===d-1))}const v=p===2?",":"";y[0]="["+y[0]+v;for(let b=1;b<y.length-1;b++)y[b]=" "+y[b]+v;let I=`,
`;for(let b=2;b<p;b++)I+=`
`;return y[y.length-1]=" "+y[y.length-1]+"]"+(c?"":I),y}function sm(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ls{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=Pe(e),s!=null){const i=s.length;se(i===this.size,()=>`Length of values '${i}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||Ps(n,this.size),this.strides=Pt(e)}set(e,...n){n.length===0&&(n=[0]),se(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const i of e){if(i<0||i>=this.shape[n]){const c=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(c)}n++}let s=e[e.length-1];for(let i=0;i<e.length-1;++i)s+=this.strides[i]*e[i];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return Va().makeTensor(this.values,this.shape,this.dtype)}}let Va=null,Gh=null;function FQ(t){Va=t}function UQ(t){Gh=t}class Br{constructor(e,n,s,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=Pe(e),this.strides=Pt(e),this.dataId=s,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Gh.buffer(this.shape,this.dtype,e)}bufferSync(){return Gh.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return ya(this.shape,e,this.dtype==="complex64")}arraySync(){return ya(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Va().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>pl(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Va().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Va().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>pl(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Va().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(Va().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Gh.print(this,e)}clone(){return this.throwIfDisposed(),Gh.clone(this)}toString(e=!1){const n=this.dataSync();return MQ(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Gh.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),Va().makeVariable(this,e,n,s)}}Object.defineProperty(Br,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function VQ(){return iw("Tensor",()=>Br)}VQ();class S2 extends Br{constructor(e,n,s,i){super(e.shape,e.dtype,e.dataId,i),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Nr(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Va().disposeTensor(this),this.dataId=e.dataId,Va().incRef(this,null)}dispose(){Va().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(S2,Symbol.hasInstance,{value:t=>t instanceof Br&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var CM;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(CM||(CM={}));var T2;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(T2||(T2={}));var I2;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(I2||(I2={}));var C2;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(C2||(C2={}));var w2;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(w2||(w2={}));const BQ={float32:C2,int32:T2,bool:I2,complex64:w2};function pi(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return BQ[t][e]}function KR(t){return pi(t,"int32")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jr(t,e){if(t.dtype===e.dtype)return[t,e];const n=pi(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function jQ(t,e){se(t.dtype===e.dtype,()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`)}function _6(t){const e=[];return y6(t,e,new Set),e}function y6(t,e,n){if(t==null)return;if(t instanceof Br){e.push(t);return}if(!WQ(t))return;const s=t;for(const i in s){const c=s[i];n.has(c)||(n.add(c),y6(c,e,n))}}function WQ(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YT(t){return t.kernelName!=null}class wM{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class bp{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new wM}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(ha(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new xQ(this.backendInstance),!0}setupRegisteredKernels(){gM(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){gM(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof rw)&&typeof s.then=="function"){const i=++this.pendingBackendInitId,c=s.then(l=>i<this.pendingBackendInitId?!1:(this.registry[e]=l,this.pendingBackendInit=null,!0)).catch(l=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,ha(`Initialization of backend ${e} failed`),ha(l.stack||l.message)),!1));return this.pendingBackendInit=c,{success:c,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return ha(`Initialization of backend ${e} failed`),ha(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:i,asyncInit:c}=this.initializeBackend(s);if(c||i)return{name:s,asyncInit:c}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),i=s.backend,c=this.readSync(n),l=i.refCount(n);i.disposeData(n,!0),s.backend=e,e.move(n,c,s.shape,s.dtype,l),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let i;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(i),()=>(i=n(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,n,s){e();try{const i=s();return n(),i}catch(i){throw n(),i}}nextTensorId(){return bp.nextTensorId++}nextVariableId(){return bp.nextVariableId++}clone(e){const n=_e.runKernel(h_,{x:e}),s={x:e},i=l=>({x:()=>{const d="float32",p={x:l},f={dtype:d};return _e.runKernel(J1,p,f)}}),c=[];return this.addTapeNode(this.state.activeScope.name,s,[n],i,c,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(E2(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const i=this.backend.numDataIds();let c=0;s.forEach(p=>{c+=p.dtype==="complex64"?3:1});const l=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],d=i-n-c-l;if(d>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${d} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const i=this.isTapeOn(),c=this.state.numBytes,l=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let d;this.backendName==null&&this.backend;let p;const f=YT(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(YT(e)){const{kernelName:I,inputs:b,attrs:A}=e;this.backendName==null&&this.backend;const R=E2(I,this.backendName);se(R!=null,()=>`Cannot find registered kernel '${I}' for backend '${this.backendName}'`),d=()=>{const O=this.backend.numDataIds();p=R.kernelFunc({inputs:b,attrs:A,backend:this.backend});const L=Array.isArray(p)?p:[p];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(I,O,L);const $=L.map(G=>G.rank!=null?G:this.makeTensorFromTensorInfo(G));if(i){const G=this.getTensorsForGradient(I,b,$);s=this.saveTensorsForBackwardMode(G)}return $}}else{const{forwardFunc:I}=e,b=A=>{i&&(s=A.map(R=>this.keep(this.clone(R))))};d=()=>{const A=this.backend.numDataIds();p=this.tidy(()=>I(this.backend,b));const R=Array.isArray(p)?p:[p];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(f,A,R),R}}const{inputs:m,attrs:_}=e,y=YT(e)?null:e.backwardsFunc;let v;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=d():(v=this.profiler.profileKernel(f,m,()=>d()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(v),n=v.outputs)}),i&&this.addTapeNode(f,m,n,y,s,_),this.state.profiling&&this.state.activeProfile.kernels.push({name:f,bytesAdded:this.state.numBytes-c,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-l,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(m).map(I=>m[I]!=null?m[I].shape:null),outputShapes:n.map(I=>I.shape),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(p)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const i=mM(e);if(i!=null){const c=i.inputsToSave||[],l=i.outputsToSave||[];let d;i.saveAllInputs?(se(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),d=Object.keys(n).map(f=>n[f])):d=c.map(f=>n[f]);const p=s.filter((f,m)=>l[m]);return d.concat(p)}return[]}makeTensor(e,n,s,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",i=i||this.backend;let c=e;s==="string"&&Qm(e[0])&&(c=e.map(p=>cl(p)));const l=i.write(c,n,s),d=new Br(n,s,l,this.nextTensorId());if(this.trackTensor(d,i),s==="string"){const p=this.state.tensorInfo.get(l),f=hQ(c);this.state.numBytes+=f-p.bytes,p.bytes=f}return d}makeTensorFromDataId(e,n,s,i){s=s||"float32";const c={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(c,i)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:i,dtype:c}=e,l=new Br(i,c,s,this.nextTensorId());return this.trackTensor(l,n),l}makeVariable(e,n=!0,s,i){s=s||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));const c=new S2(e,n,s,this.nextTensorId());if(this.state.registeredVariables[c.name]!=null)throw new Error(`Variable with name ${c.name} was already registered`);return this.state.registeredVariables[c.name]=c,this.incRef(c,this.backend),c}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*f2(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof S2||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*f2(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,i,c,l){const d={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:c},p=mM(e);p!=null&&(i=p.gradFunc),i!=null&&(d.gradient=f=>(f=f.map((m,_)=>{if(m==null){const y=s[_],v=lo(y.size,y.dtype);return this.makeTensor(v,y.shape,y.dtype)}return m}),i(f.length>1?f:f[0],c,l))),this.state.activeTape.push(d)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=_6(e),s=new Set(n.map(c=>c.id));for(let c=0;c<this.state.activeScope.track.length;c++){const l=this.state.activeScope.track[c];!l.kept&&!s.has(l.id)&&l.dispose()}const i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(c=>{!c.kept&&c.scopeId===i.id&&this.track(c)})}gradients(e,n,s,i=!1){if(se(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const c=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));se(c instanceof Br,()=>"The result y returned by f() must be a tensor.");const l=PQ(this.state.activeTape,n,c);if(!i&&l.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const d={};d[c.id]=s??GQ(c.shape),LQ(d,l,f=>this.tidy(f),zQ);const p=n.map(f=>d[f.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(f=>{for(const m of f.saved)m.dispose()}),this.state.activeTape=null),{value:c,grads:p}})}customGrad(e){return se(dM(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{se(n.every(d=>d instanceof Br),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const i={};n.forEach((d,p)=>{i[p]=d});const c=(d,p)=>(s=e(...n,p),se(s.value instanceof Br,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),se(dM(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),l=(d,p)=>{const f=s.gradFunc(d,p),m=Array.isArray(f)?f:[f];se(m.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),se(m.every(y=>y instanceof Br),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const _={};return m.forEach((y,v)=>{_[v]=()=>y}),_};return this.runKernelFunc({forwardFunc:c,backwardsFunc:l,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=Fi(),s=await this.backend.time(e);return s.wallMs=Fi()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new wM;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}bp.nextTensorId=0;bp.nextVariableId=0;function GQ(t){const e=ow(Pe(t),"float32");return _e.makeTensor(e,t,"float32")}function v6(){const t=QU();if(t._tfengine==null){const e=new mQ(t);t._tfengine=new bp(e)}return yQ(t._tfengine.ENV),FQ(()=>t._tfengine),t._tfengine}const _e=v6();function zQ(t,e){const n={a:t,b:e};return _e.runKernel(eg,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HQ(){return typeof navigator<"u"&&navigator!=null}function S6(t){if(t||HQ()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function T6(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fi=De();fi.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});fi.registerFlag("IS_BROWSER",()=>T6());fi.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");fi.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));fi.registerFlag("PROD",()=>!1);fi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>fi.getBool("DEBUG"));fi.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);fi.registerFlag("IS_TEST",()=>!1);fi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);fi.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);fi.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);fi.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);fi.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tl(t,e){let n=t;if(Sc(t))return e==="string"?[]:[t.length];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||Sc(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&De().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&I6(t,s,[]),s}function I6(t,e,n){if(n=n||[],!Array.isArray(t)&&!Sc(t)){se(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}se(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),se(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let i=0;i<t.length;++i)I6(t[i],s,n.concat(i))}function RM(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function ne(t,e,n,s="numeric"){if(t instanceof Br)return RM(s,t.dtype,e,n),t;let i=Zm(t);if(i!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(i=s),RM(s,i,e,n),t==null||!Sc(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const p=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${p}'`)}const c=Tl(t,i);!Sc(t)&&!Array.isArray(t)&&(t=[t]);const d=i!=="string"?Vd(t,i):Ip(t,[],!0);return _e.makeTensor(d,c,i)}function c1(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((c,l)=>ne(c,`${e}[${l}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C6="__op";function pe(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+C6;const i=(...c)=>{_e.startScope(n);try{const l=s(...c);return wp(l)&&console.error("Cannot return a Promise inside of tidy."),_e.endScope(l),l}catch(l){throw _e.endScope(null),l}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KQ(t,e){const n=ne(t,"real","complex"),s=ne(e,"imag","complex");gi(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const i={real:n,imag:s};return _e.runKernel(yw,i)}const fl=pe({complex_:KQ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Il(t,e,n,s){if(s==null&&(s=Zm(t)),s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Sc(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){YU(e);const i=Pe(e),c=Pe(n);se(i===c,()=>`Based on the provided shape, [${e}], the tensor should have ${i} values but has ${c}`);for(let l=0;l<n.length;++l){const d=n[l],p=l===n.length-1?d!==Pe(e.slice(l)):!0;se(n[l]===e[l]||!p,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!Sc(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?Vd(t,s):Ip(t,[],!0),_e.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yc(t,e,n){const s=Tl(t,n);return Il(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R2={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u1=4;async function qQ(t,e){const n=[],s=[],i=Array.isArray(t)?t.map(l=>l.name):Object.keys(t);for(let l=0;l<i.length;++l){const d=i[l],p=Array.isArray(t)?t[l].tensor:t[d];if(p.dtype!=="float32"&&p.dtype!=="int32"&&p.dtype!=="bool"&&p.dtype!=="string"&&p.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${d}': ${p.dtype}`);const f={name:d,shape:p.shape,dtype:p.dtype};if(p.dtype==="string"){const m=new Promise(async _=>{const y=await p.bytes(),v=y.reduce((A,R)=>A+R.length,0)+u1*y.length,I=new Uint8Array(v);let b=0;for(let A=0;A<y.length;A++){const R=y[A],O=new Uint8Array(new Uint32Array([R.length]).buffer);I.set(O,b),b+=u1,I.set(R,b),b+=R.length}_(I)});s.push(m)}else s.push(p.data());e!=null&&(f.group=e),n.push(f)}const c=await Promise.all(s);return{data:XQ(c),specs:n}}function w6(t,e){const n={};let s,i=0;for(const c of e){const l=c.name,d=c.dtype,p=c.shape,f=Pe(p);let m;if("quantization"in c){const _=c.quantization;if(_.dtype==="uint8"||_.dtype==="uint16"){if(!("min"in _&&"scale"in _))throw new Error(`Weight ${c.name} with quantization ${_.dtype} doesn't have corresponding metadata min and scale.`)}else if(_.dtype==="float16"){if(d!=="float32")throw new Error(`Weight ${c.name} is quantized with ${_.dtype} which only supports weights of type float32 not ${d}.`)}else throw new Error(`Weight ${c.name} has unknown quantization dtype ${_.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const y=R2[_.dtype],v=t.slice(i,i+f*y),I=_.dtype==="uint8"?new Uint8Array(v):new Uint16Array(v);if(d==="float32")if(_.dtype==="uint8"||_.dtype==="uint16"){m=new Float32Array(I.length);for(let b=0;b<I.length;b++){const A=I[b];m[b]=A*_.scale+_.min}}else if(_.dtype==="float16")s===void 0&&(s=tZ()),m=s(I);else throw new Error(`Unsupported quantization type ${_.dtype} for weight type float32.`);else if(d==="int32"){if(_.dtype!=="uint8"&&_.dtype!=="uint16")throw new Error(`Unsupported quantization type ${_.dtype} for weight type int32.`);m=new Int32Array(I.length);for(let b=0;b<I.length;b++){const A=I[b];m[b]=Math.round(A*_.scale+_.min)}}else throw new Error(`Unsupported dtype in weight '${l}': ${d}`);i+=f*y}else if(d==="string"){const _=Pe(c.shape);m=[];for(let y=0;y<_;y++){const v=new Uint32Array(t.slice(i,i+u1))[0];i+=u1;const I=new Uint8Array(t.slice(i,i+v));m.push(I),i+=v}}else{const _=R2[d],y=t.slice(i,i+f*_);if(d==="float32")m=new Float32Array(y);else if(d==="int32")m=new Int32Array(y);else if(d==="bool")m=new Uint8Array(y);else if(d==="complex64"){m=new Float32Array(y);const v=new Float32Array(m.length/2),I=new Float32Array(m.length/2);for(let R=0;R<v.length;R++)v[R]=m[R*2],I[R]=m[R*2+1];const b=yc(v,p,"float32"),A=yc(I,p,"float32");n[l]=fl(b,A),b.dispose(),A.dispose()}else throw new Error(`Unsupported dtype in weight '${l}': ${d}`);i+=f*_}d!=="complex64"&&(n[l]=yc(m,p,d))}return n}function XQ(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(c=>{if(e+=c.byteLength,n.push(c.byteLength===c.buffer.byteLength?c:new c.constructor(c)),!(c instanceof Float32Array||c instanceof Int32Array||c instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${c.constructor.name}`)});const s=new Uint8Array(e);let i=0;return n.forEach(c=>{s.set(new Uint8Array(c.buffer),i),i+=c.byteLength}),s.buffer}const qR=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function bM(t){return qR?Buffer.byteLength(t):new Blob([t]).size}function YQ(t){if(qR)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,i=e.length;s<i;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function JQ(t){if(qR){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function XR(t){if(t.length===1)return t[0];let e=0;t.forEach(i=>{e+=i.byteLength});const n=new Uint8Array(e);let s=0;return t.forEach(i=>{n.set(new Uint8Array(i),s),s+=i.byteLength}),n.buffer}function NM(t){const e="/";for(t=t.trim();t.endsWith(e);)t=t.slice(0,t.length-1);const n=t.split(e);return n[n.length-1]}function R6(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function b6(t,e,n){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=n}return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),s}async function YR(t,e){let n,s;return t.weightsManifest!=null&&([n,s]=await e(t.weightsManifest)),b6(t,n,s)}function tg(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:bM(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:bM(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}function N6(t){const e=[];for(const n of t)e.push(...n.weights);return e}function QQ(){const t=n=>{let s=n<<13,i=0;for(;!(s&8388608);)i-=8388608,s<<=1;return s&=-8388609,i+=947912704,s|i},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function ZQ(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function eZ(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function tZ(){const t=QQ(),e=ZQ(),n=eZ();return s=>{const i=new ArrayBuffer(4*s.length),c=new Uint32Array(i);for(let l=0;l<s.length;l++){const d=s[l],p=t[n[d>>10]+(d&1023)]+e[d>>10];c[l]=p}return new Float32Array(i)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ur{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Ur.instance==null&&(Ur.instance=new Ur),Ur.instance}static registerSaveRouter(e){Ur.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Ur.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Ur.getHandlers(e,"save")}static getLoadHandlers(e,n){return Ur.getHandlers(e,"load",n)}static getHandlers(e,n,s){const i=[];return(n==="load"?Ur.getInstance().loadRouters:Ur.getInstance().saveRouters).forEach(l=>{const d=l(e,s);d!==null&&i.push(d)}),i}}const nZ=t=>Ur.registerSaveRouter(t),rZ=t=>Ur.registerLoadRouter(t),sZ=t=>Ur.getSaveHandlers(t),oZ=(t,e)=>Ur.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b2="tensorflowjs",N2=1,fd="models_store",Ju="model_info_store";function A6(){if(!De().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function A2(t){const e=t.result;e.createObjectStore(fd,{keyPath:"modelPath"}),e.createObjectStore(Ju,{keyPath:"modelPath"})}class Nd{constructor(e){if(this.indexedDB=A6(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,i)=>{const c=this.indexedDB.open(b2,N2);c.onupgradeneeded=()=>A2(c),c.onsuccess=()=>{const l=c.result;if(n==null){const d=l.transaction(fd,"readonly"),f=d.objectStore(fd).get(this.modelPath);f.onsuccess=()=>{if(f.result==null)return l.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(f.result.modelArtifacts)},f.onerror=m=>(l.close(),i(f.error)),d.oncomplete=()=>l.close()}else{const d=tg(n),p=l.transaction(Ju,"readwrite");let f=p.objectStore(Ju);const m=f.put({modelPath:this.modelPath,modelArtifactsInfo:d});let _;m.onsuccess=()=>{_=l.transaction(fd,"readwrite");const v=_.objectStore(fd).put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:d});v.onsuccess=()=>s({modelArtifactsInfo:d}),v.onerror=I=>{f=p.objectStore(Ju);const b=f.delete(this.modelPath);b.onsuccess=()=>(l.close(),i(v.error)),b.onerror=A=>(l.close(),i(v.error))}},m.onerror=y=>(l.close(),i(m.error)),p.oncomplete=()=>{_==null?l.close():_.oncomplete=()=>l.close()}}},c.onerror=l=>i(c.error)})}}Nd.URL_SCHEME="indexeddb://";const O6=t=>De().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Nd.URL_SCHEME)?iZ(t.slice(Nd.URL_SCHEME.length)):null;Ur.registerSaveRouter(O6);Ur.registerLoadRouter(O6);function iZ(t){return new Nd(t)}function aZ(t){return t.startsWith(Nd.URL_SCHEME)?t.slice(Nd.URL_SCHEME.length):t}class cZ{constructor(){this.indexedDB=A6()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(b2,N2);s.onupgradeneeded=()=>A2(s),s.onsuccess=()=>{const i=s.result,c=i.transaction(Ju,"readonly"),d=c.objectStore(Ju).getAll();d.onsuccess=()=>{const p={};for(const f of d.result)p[f.modelPath]=f.modelArtifactsInfo;e(p)},d.onerror=p=>(i.close(),n(d.error)),c.oncomplete=()=>i.close()},s.onerror=i=>n(s.error)})}async removeModel(e){return e=aZ(e),new Promise((n,s)=>{const i=this.indexedDB.open(b2,N2);i.onupgradeneeded=()=>A2(i),i.onsuccess=()=>{const c=i.result,l=c.transaction(Ju,"readwrite"),d=l.objectStore(Ju),p=d.get(e);let f;p.onsuccess=()=>{if(p.result==null)return c.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const m=d.delete(e),_=()=>{f=c.transaction(fd,"readwrite");const v=f.objectStore(fd).delete(e);v.onsuccess=()=>n(p.result.modelArtifactsInfo),v.onerror=I=>s(p.error)};m.onsuccess=_,m.onerror=y=>(_(),c.close(),s(p.error))}},p.onerror=m=>(c.close(),s(p.error)),l.oncomplete=()=>{f==null?c.close():f.oncomplete=()=>c.close()}},i.onerror=c=>s(i.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jc="/",zh="tensorflowjs_models",x6="info",uZ="model_topology",lZ="weight_specs",dZ="weight_data",hZ="model_metadata";function k6(t){return{info:[zh,t,x6].join(jc),topology:[zh,t,uZ].join(jc),weightSpecs:[zh,t,lZ].join(jc),weightData:[zh,t,dZ].join(jc),modelMetadata:[zh,t,hZ].join(jc)}}function D6(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function pZ(t){const e=t.split(jc);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(jc)}function fZ(t){return t.startsWith(Ad.URL_SCHEME)?t.slice(Ad.URL_SCHEME.length):t}class Ad{constructor(e){if(!De().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=k6(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),i=tg(e);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,YQ(e.weightData));const c={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(c)),{modelArtifactsInfo:i}}catch{throw D6(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=i;const c=this.LS.getItem(this.keys.modelMetadata);if(c!=null){const d=JSON.parse(c);n.format=d.format,n.generatedBy=d.generatedBy,n.convertedBy=d.convertedBy,d.signature!=null&&(n.signature=d.signature),d.userDefinedMetadata!=null&&(n.userDefinedMetadata=d.userDefinedMetadata),d.modelInitializer!=null&&(n.modelInitializer=d.modelInitializer),d.trainingConfig!=null&&(n.trainingConfig=d.trainingConfig)}const l=this.LS.getItem(this.keys.weightData);if(l==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=JQ(l),n}}Ad.URL_SCHEME="localstorage://";const P6=t=>De().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ad.URL_SCHEME)?mZ(t.slice(Ad.URL_SCHEME.length)):null;Ur.registerSaveRouter(P6);Ur.registerLoadRouter(P6);function mZ(t){return new Ad(t)}class gZ{constructor(){se(De().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),se(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=zh+jc,s=jc+x6;for(let i=0;i<this.LS.length;++i){const c=this.LS.key(i);if(c.startsWith(n)&&c.endsWith(s)){const l=pZ(c);e[l]=JSON.parse(this.LS.getItem(c))}}return e}async removeModel(e){e=fZ(e);const n=k6(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return D6(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pp="://";class Ao{constructor(){this.managers={}}static getInstance(){return Ao.instance==null&&(Ao.instance=new Ao),Ao.instance}static registerManager(e,n){se(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(pp)&&(e=e.slice(0,e.indexOf(pp))),se(e.length>0,()=>"scheme must not be an empty string.");const s=Ao.getInstance();se(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=Ao.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(Ao.getInstance().managers)}}function O0(t){if(t.indexOf(pp)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Ao.getSchemes().join(",")}`);return{scheme:t.split(pp)[0],path:t.split(pp)[1]}}async function L6(t,e,n=!1){se(t!==e,()=>`Old path and new path are the same: '${t}'`);const s=Ur.getLoadHandlers(t);se(s.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),se(s.length<2,()=>`Copying failed because more than one (${s.length}) load handlers for source URL ${t}.`);const i=s[0],c=Ur.getSaveHandlers(e);se(c.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),se(c.length<2,()=>`Copying failed because more than one (${s.length}) save handlers for destination URL ${e}.`);const l=c[0],d=O0(t).scheme,p=O0(t).path,f=d===O0(t).scheme,m=await i.load();n&&f&&await Ao.getManager(d).removeModel(p);const _=await l.save(m);return n&&!f&&await Ao.getManager(d).removeModel(p),_.modelArtifactsInfo}async function EZ(){const t=Ao.getSchemes(),e={};for(const n of t){const s=await Ao.getManager(n).listModels();for(const i in s){const c=n+pp+i;e[c]=s[i]}}return e}async function _Z(t){const e=O0(t);return Ao.getManager(e.scheme).removeModel(e.path)}async function yZ(t,e){return L6(t,e,!1)}async function vZ(t,e){return L6(t,e,!0)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SZ{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(!window||!De().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const i=this.functionRefs[s.data.index];i(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}}if(De().get("IS_BROWSER")){De().setPlatform("browser",new SZ);try{Ao.registerManager(Ad.URL_SCHEME,new gZ)}catch{}try{Ao.registerManager(Nd.URL_SCHEME,new cZ)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TZ={importFetch:()=>require("node-fetch")};let JT;class IZ{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return De().global.fetch!=null?De().global.fetch(e,n):(JT==null&&(JT=TZ.importFetch()),JT(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}}De().get("IS_NODE")&&!De().get("IS_BROWSER")&&De().setPlatform("node",new IZ);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cn(t,e="float32",n){return e=e||"float32",YU(t),new Ls(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CZ(t,e){const n=ne(t,"x","cast");if(!dQ(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},i={dtype:e};return _e.runKernel(J1,s,i)}const jr=pe({cast_:CZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wZ(t){const n={x:ne(t,"x","clone","string_or_numeric")};return _e.runKernel(h_,n)}const ul=pe({clone_:wZ});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M6(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */v6();const RZ={buffer:cn,cast:jr,clone:ul,print:M6};UQ(RZ);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bZ="model",NZ=".json",AZ=".weights.bin";function AM(t){return new Promise(e=>setTimeout(e)).then(t)}class Od{constructor(e){if(!De().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Od.URL_SCHEME)&&(e=e.slice(Od.URL_SCHEME.length)),(e==null||e.length===0)&&(e=bZ),this.modelJsonFileName=e+NZ,this.weightDataFileName=e+AZ}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");const n=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const s=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=R6(e,s),c=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),l=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(l.download=this.modelJsonFileName,l.href=c,await AM(()=>l.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){const d=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;d.download=this.weightDataFileName,d.href=n,await AM(()=>d.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:tg(e)}}}}Od.URL_SCHEME="downloads://";class OZ{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,n)=>{const s=new FileReader;s.onload=i=>{const c=JSON.parse(i.target.result),l=c.modelTopology;if(l==null){n(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(c.weightsManifest==null){n(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:l});return}const p=YR(c,f=>this.loadWeights(f));e(p)},s.onerror=i=>n(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),s.readAsText(this.jsonFile)})}loadWeights(e){const n=[],s=[];for(const l of e)n.push(...l.weights),s.push(...l.paths);const i=this.checkManifestAndWeightFiles(e),c=s.map(l=>this.loadWeightsFile(l,i[l]));return Promise.all(c).then(l=>[n,XR(l)])}loadWeightsFile(e,n){return new Promise((s,i)=>{const c=new FileReader;c.onload=l=>{const d=l.target.result;s(d)},c.onerror=l=>i(`Failed to weights data from file of path '${e}'.`),c.readAsArrayBuffer(n)})}checkManifestAndWeightFiles(e){const n=[],s=this.weightsFiles.map(c=>NM(c.name)),i={};for(const c of e)c.paths.forEach(l=>{const d=NM(l);if(n.indexOf(d)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${d}'`);if(n.push(d),s.indexOf(d)===-1)throw new Error(`Weight file with basename '${d}' is not provided.`);i[l]=this.weightsFiles[s.indexOf(d)]});if(n.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${n.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return i}}const xZ=t=>De().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Od.URL_SCHEME)?kZ(t.slice(Od.URL_SCHEME.length)):null;Ur.registerSaveRouter(xZ);function kZ(t="model"){return new Od(t)}function DZ(t){return new OZ(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OM(t,e,n,s){l(t),n=n??0,s=s??1,d(n,s);let i=0;const c=p=>(p.then(f=>{const m=n+ ++i/t.length*(s-n);return e(m),f}),p);function l(p){se(p!=null&&Array.isArray(p)&&p.length>0,()=>"promises must be a none empty array")}function d(p,f){se(p>=0&&p<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${p}`),se(f>=0&&f<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${f}`),se(f>=p,()=>`startFraction must be no more than endFraction, but got startFraction ${p} and endFraction ${f}`)}return Promise.all(t.map(c))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function $6(t,e){e==null&&(e={});const n=e.fetchFunc==null?De().platform.fetch:e.fetchFunc,s=t.map(_=>n(_,e.requestInit,{isBinary:!0})),i=0,c=.5,d=(e.onProgress==null?await Promise.all(s):await OM(s,e.onProgress,i,c)).map(_=>_.arrayBuffer()),p=.5,f=1;return e.onProgress==null?await Promise.all(d):await OM(d,e.onProgress,p,f)}async function PZ(t,e="",n,s){return F6(l=>$6(l,{requestInit:s}))(t,e,n)}function F6(t){return async(e,n="",s)=>{const i=e.map(()=>!1),c={},l=s!=null?s.map(()=>!1):[],d=[];if(e.forEach((v,I)=>{let b=0;v.weights.forEach(A=>{const R="quantization"in A?A.quantization.dtype:A.dtype,O=R2[R]*Pe(A.shape),L=()=>{i[I]=!0,c[I]==null&&(c[I]=[]),c[I].push({manifestEntry:A,groupOffset:b,sizeBytes:O})};s!=null?s.forEach(($,G)=>{$===A.name&&(L(),l[G]=!0)}):L(),d.push(A.name),b+=O})}),!l.every(v=>v)){const v=s.filter((I,b)=>!l[b]);throw new Error(`Could not find weights in manifest with names: ${v.join(", ")}. 
Manifest JSON has weights with names: ${d.join(", ")}.`)}const p=i.reduce((v,I,b)=>(I&&v.push(b),v),[]),f=[];p.forEach(v=>{e[v].paths.forEach(I=>{const b=n+(n.endsWith("/")?"":"/")+I;f.push(b)})});const m=await t(f),_={};let y=0;return p.forEach(v=>{const I=e[v].paths.length;let b=0;for(let $=0;$<I;$++)b+=m[y+$].byteLength;const A=new ArrayBuffer(b),R=new Uint8Array(A);let O=0;for(let $=0;$<I;$++){const G=new Uint8Array(m[y+$]);R.set(G,O),O+=G.byteLength}c[v].forEach($=>{const G=A.slice($.groupOffset,$.groupOffset+$.sizeBytes),H=w6(G,[$.manifestEntry]);for(const Z in H)_[Z]=H[Z]}),y+=I}),_}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LZ="application/octet-stream",MZ="application/json";class JR{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(se(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=De().platform.fetch,se(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&se(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i=R6(e,s);n.body.append("model.json",new Blob([JSON.stringify(i)],{type:MZ}),"model.json"),e.weightData!=null&&n.body.append("model.weights.bin",new Blob([e.weightData],{type:LZ}),"model.weights.bin");const c=await this.fetch(this.path,n);if(c.ok)return{modelArtifactsInfo:tg(e),responses:[c]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${c.status}.`)}async load(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let l=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?l+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":l+=" Please make sure the server is serving valid JSON for this request.",new Error(l)}const s=n.modelTopology,i=n.weightsManifest;if(s==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return YR(n,c=>this.loadWeights(c))}async loadWeights(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,i]=$Z(n),c=this.weightPathPrefix||s,l=N6(e),d=[],p=[];for(const m of e)for(const _ of m.paths)this.weightUrlConverter!=null?p.push(this.weightUrlConverter(_)):d.push(c+_+i);this.weightUrlConverter&&d.push(...await Promise.all(p));const f=await $6(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[l,XR(f)]}}JR.URL_SCHEME_REGEX=/^https?:\/\//;function $Z(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),i=n>e?t.substring(n):"";return[s+"/",i]}function O2(t){return t.match(JR.URL_SCHEME_REGEX)!=null}const U6=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(s=>O2(s)):n=O2(t),n)return QR(t,e)}return null};Ur.registerSaveRouter(U6);Ur.registerLoadRouter(U6);function QR(t,e){return new JR(t,e)}function FZ(t,e){return QR(t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QT{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}}class V6{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}}class UZ{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=n=>Promise.resolve(e.save(n)))}}function VZ(t,e,n,s){const i=arguments;return new UZ(B6(...i))}function B6(t,e,n,s){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new QT(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new QT({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new QT({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:s}))}function BZ(t){return new V6(t)}function jZ(t){return new V6(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j6=Object.freeze(Object.defineProperty({__proto__:null,browserFiles:DZ,browserHTTPRequest:FZ,concatenateArrayBuffers:XR,copyModel:yZ,decodeWeights:w6,encodeWeights:qQ,fromMemory:VZ,fromMemorySync:B6,getLoadHandlers:oZ,getModelArtifactsForJSON:YR,getModelArtifactsForJSONSync:b6,getModelArtifactsInfoForJSON:tg,getSaveHandlers:sZ,getWeightSpecs:N6,http:QR,isHTTPScheme:O2,listModels:EZ,loadWeights:PZ,moveModel:vZ,registerLoadRouter:rZ,registerSaveRouter:nZ,removeModel:_Z,weightsLoaderFactory:F6,withSaveHandler:BZ,withSaveHandlerSync:jZ},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WZ(t,e,n=!1,s=!1){let i=ne(t,"a","matMul"),c=ne(e,"b","matMul");[i,c]=Jr(i,c);const l={a:i,b:c},d={transposeA:n,transposeB:s};return _e.runKernel(mw,l,d)}const nr=pe({matMul_:WZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GZ(t,e,n=1,s=0,i="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const l={indices:ne(t,"indices","oneHot","int32")},d={dtype:i,depth:e,onValue:n,offValue:s};return _e.runKernel(uR,l,d)}const zZ=pe({oneHot_:GZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hu(){return _e}function Xr(t,e){return _e.tidy(t,e)}function mc(t){_6(t).forEach(n=>n.dispose())}function Qu(t){return _e.keep(t)}function W6(t,e,n=1){return _e.registerBackend(t,e,n)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HZ(t){const n={input:ne(t,"input","imag")};return _e.runKernel(Hw,n)}const q_=pe({imag_:HZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KZ(t){const n={x:ne(t,"x","neg")};return _e.runKernel(sR,n)}const Xc=pe({neg_:KZ});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qZ(t){const n={input:ne(t,"input","real")};return _e.runKernel(ER,n)}const Fm=pe({real_:qZ});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XZ(t,e,n){const s=ne(t,"x","transpose");if(e==null&&(e=s.shape.map((l,d)=>d).reverse()),se(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(l=>{se(l>=0&&l<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const i={x:s},c={perm:e};return s.dtype==="complex64"?Xr(()=>{let l=Fm(s),d=q_(s);return l=_e.runKernel(Em,{x:l},c),d=_e.runKernel(Em,{x:d},c),n&&(d=Xc(d)),fl(l,d)}):_e.runKernel(Em,i,c)}const x2=pe({transpose_:XZ});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Np(t,e){const n=t.length,s=[];for(let i=0;i<n;i++){const c=n-1-i,l=t[c]||1;(e[e.length-1-i]||1)>1&&l===1&&s.unshift(c)}return s}function G6(t,e){const n=[];for(let s=0;s<e.length;s++){const i=t[t.length-s-1],c=e.length-s-1,l=e[c];(i==null||i===1&&l>1)&&n.unshift(c)}return n}function Rn(t,e){const n=[],s=Math.max(t.length,e.length);for(let i=0;i<s;i++){let c=t[t.length-i-1];c==null&&(c=1);let l=e[e.length-i-1];if(l==null&&(l=1),c===1)n.unshift(l);else if(l===1)n.unshift(c);else if(c!==l){const d=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(d)}else n.unshift(c)}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z6(t,e,n){if(Up(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const s=Tl(t,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Il(t,e,s,n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let nd;function YZ(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,i=!1,c=!1,l=!1,d=!1;if(t.data instanceof Uint8Array)n=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)s=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)c=!0;else if(t.getContext!=null)l=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)d=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(E2(g2,_e.backendName)!=null){const I={pixels:t},b={numChannels:e};return _e.runKernel(g2,I,b)}const[f,m]=i?[t.videoWidth,t.videoHeight]:[t.width,t.height];let _;if(l)_=t.getContext("2d").getImageData(0,0,f,m).data;else if(s||n)_=t.data;else if(c||i||d){if(nd==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")nd=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else nd=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});nd.canvas.width=f,nd.canvas.height=m,nd.drawImage(t,0,0,f,m),_=nd.getImageData(0,0,f,m).data}let y;if(e===4)y=new Int32Array(_);else{const I=f*m;y=new Int32Array(I*e);for(let b=0;b<I;b++)for(let A=0;A<e;++A)y[b*e+A]=_[b*4+A]}return z6(y,[m,f,e],"int32")}async function H6(t,e){let n=ne(t,"img","toPixels");if(!(t instanceof Br)){const f=n;n=jr(f,"int32"),f.dispose()}if(n.rank!==2&&n.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${n.rank}.`);const[s,i]=n.shape.slice(0,2),c=n.rank===2?1:n.shape[2];if(c>4||c===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${c}`);if(n.dtype!=="float32"&&n.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${n.dtype}. Please use float32 or int32 tensors.`);const l=await n.data(),d=n.dtype==="float32"?255:1,p=new Uint8ClampedArray(i*s*4);for(let f=0;f<s*i;++f){const m=[0,0,0,255];for(let y=0;y<c;y++){const v=l[f*c+y];if(n.dtype==="float32"){if(v<0||v>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${v}.`)}else if(n.dtype==="int32"&&(v<0||v>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${v}.`);c===1?(m[0]=v*d,m[1]=v*d,m[2]=v*d):m[y]=v*d}const _=f*4;p[_+0]=Math.round(m[0]),p[_+1]=Math.round(m[1]),p[_+2]=Math.round(m[2]),p[_+3]=Math.round(m[3])}if(e!=null){e.width=i,e.height=s;const f=e.getContext("2d"),m=new ImageData(p,i,s);f.putImageData(m,0,0)}return n!==t&&n.dispose(),p}const K6=pe({fromPixels_:YZ});function ZR(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(Pe(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const i=e.shape,c=i[i.length-1];let l=1;for(let _=0;_<i.length-1;++_)l*=i[_];const d=t.shape,p=i.slice();p.pop();let f=1;for(let _=c;_<n;++_)f*=d[_],p.push(d[_]);const m=[...Pt(t.shape).map(_=>_/f),1].slice(0,c);return[p,l,f,m]}function q6(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,c=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(c+` update.rank < ${i}. `);if(t.length<s+(n.rank-i))throw new Error(c+` Output shape length < ${s+(n.rank-i)}`);if(n.rank!==i+t.length-s)throw new Error(c+` update.rank != ${i+t.length-s}`);for(let l=0;l<i;++l)if(n.shape[l]!==e.shape[l])throw new Error(c+` updates.shape[${l}] (${n.shape[l]}) != indices.shape[${l}] (${e.shape[l]}).`);for(let l=0;l<n.rank-i;++l)if(n.shape[l+i]!==t[l+s])throw new Error(c+` updates.shape[${l+i}] (${n.shape[l+i]}) != shape[${l+i}] (${t[l+i]})`)}function X6(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}q6(n,e,t)}function ng(t,e,n){const s=e.shape.length,i=s>1?e.shape[s-1]:1,c=n.length;let l=1;for(let _=i;_<c;++_)l*=n[_];const d=i<1?1:i,p=Pe(e.shape)/d,f=[...Pt(n.slice(0,i)),1],m=Pe(n);return{sliceRank:i,numUpdates:p,sliceSize:l,strides:f,outputSize:m}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k2=-2,JZ=-1;function eb(t,e,n){const s=t.shape.length;se(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),se(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let i=0;i<s;++i)se(e[i]+n[i]<=t.shape[i],()=>`Error in slice${s}D: begin[${i}] + size[${i}] (${e[i]+n[i]}) would overflow input.shape[${i}] (${t.shape[i]})`)}function QZ(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function tb(t,e,n){const s=[];for(let i=0;i<t.length;i++)s[i]=Math.ceil((e[i]-t[i])/n[i]);return s}function Y6(t,e,n,s){const i=[...t];for(let c=i.length;c<s.length;c++)i.push(1);for(let c=0;c<n;c++)c===0?i[e]=1:(i.splice(e,0,1),i.pop());return i}function J6(t,e,n){return n<=t?n:n-(e-1)}function Q6(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function ZZ(t,e,n,s,i,c,l,d,p){const f=t.length;let m=new Array(f),_=new Array(f),y=new Array(f);if(e.length&&n>0){const v=e[0],I=n+1;m=Z6(l,v,I,s,t),_=e5(d,v,I,i,t),y=Y6(c,v,I,t)}else for(let v=0;v<f;v++)m[v]=n5(l,s,c,t,v,p),_[v]=r5(d,i,c,t,v,p),y[v]=t5(c,v,p);return{begin:m,end:_,strides:y}}function Z6(t,e,n,s,i){const c=[...i],l=Q6(n,e);for(let d=0;d<c.length;d++)if(l.indexOf(d)>-1)c[d]=0;else{const p=J6(e,n,d);let f=s[p];t&1<<p&&(f=0),c[d]=f}return c}function e5(t,e,n,s,i){const c=[...i],l=Q6(n,e);for(let d=0;d<c.length;d++)if(l.indexOf(d)>-1)c[d]=Number.MAX_SAFE_INTEGER;else{const p=J6(e,n,d);let f=s[p];t&1<<p&&(f=Number.MAX_SAFE_INTEGER),c[d]=f}for(let d=0;d<c.length;d++){const p=i[d];c[d]<0&&(c[d]+=p),c[d]=bd(0,c[d],i[d])}return c}function t5(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function n5(t,e,n,s,i,c){let l=e[i];const d=n[i]||1;(t&1<<i||c&1<<i||l==null)&&(d>0?l=Number.MIN_SAFE_INTEGER:l=Number.MAX_SAFE_INTEGER);const p=s[i];return l<0&&(l+=p),l=bd(0,l,p-1),l}function r5(t,e,n,s,i,c){let l=e[i];const d=n[i]||1;(t&1<<i||c&1<<i||l==null)&&(d>0?l=Number.MAX_SAFE_INTEGER:l=Number.MIN_SAFE_INTEGER);const p=s[i];return l<0&&(l+=p),d>0?l=bd(0,l,p):l=bd(-1,l,p-1),l}function nb(t,e,n){let s=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){s=i;break}for(let i=s+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function rb(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function sb(t,e,n){let s;const i=t.shape.length;typeof e=="number"?s=[e,...new Array(i-1).fill(0)]:e.length<i?s=e.concat(new Array(i-e.length).fill(0)):s=e.slice(),s.forEach(l=>{se(l!==-1,()=>"slice() does not support negative begin indexing.")});let c;return n==null?c=new Array(i).fill(-1):typeof n=="number"?c=[n,...new Array(i-1).fill(-1)]:n.length<i?c=n.concat(new Array(i-n.length).fill(-1)):c=n,c=c.map((l,d)=>l>=0?l:(se(l===-1,()=>`Negative size values should be exactly -1 but got ${l} for the slice() size at index ${d}.`),t.shape[d]-s[d])),[s,c]}function ob(t,e,n,s,i,c,l,d,p){let f;if(s==null?(f=new Array(e.length),f.fill(1)):f=s,l!=null&&l&l-1)throw new Error("Multiple ellipses in slice is not allowed.");let m=!1;const _={dims:f.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:f.slice(),beginMask:i,endMask:c,ellipsisMask:l,newAxisMask:d,shrinkAxisMask:p};for(let L=0;L<_.dims;L++)m&&1<<L&d&&_.numAddAxisAfterEllipsis++,1<<L&l&&(m=!0);m||(_.ellipsisMask|=1<<_.dims,_.dims++);const y={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};eee(_,y);let v=!0,I=!0,b=!0;const A=[],R=[];for(let L=0;L<t.length;++L){if(y.strides[L]===0)throw Error(`strides[${L}] must be non-zero`);const $=!!(y.shrinkAxisMask&1<<L),G=t[L];if(G===-1){A.push($?1:-1);continue}const H=[y.beginMask&1<<L,y.endMask&1<<L],Z=[y.strides[L]>0?0:-1,y.strides[L]>0?G:G-1];if($&&y.strides[L]<=0)throw Error("only stride 1 allowed on non-range indexing.");b=b&&y.strides[L]===1;const re=!!(y.beginMask&1<<L&&y.endMask&1<<L);if(y.beginValid&&y.endValid){if($){const Ce=y.begin[L]<0?G+y.begin[L]:y.begin[L];if(y.begin[L]=Ce,y.end[L]=y.begin[L]+1,Ce<0||Ce>=G)throw Error(`slice index ${y.begin[L]} of dimension ${L} out of bounds.`)}else y.begin[L]=xM(y.begin[L],0,y.strides[L],G,H,Z),y.end[L]=xM(y.end[L],1,y.strides[L],G,H,Z);const Ee=y.strides[L]===1&&y.begin[L]===0&&y.end[L]===G;v=v&&Ee,I=I&&(L===0&&y.strides[L]===1||Ee)}else v=v&&y.strides[L]===1&&re,I=I&&(L===0&&y.strides[L]===1||re);let oe,ae=!1;if(y.beginValid&&y.endValid?(oe=y.end[L]-y.begin[L],ae=!0):$?(oe=1,ae=!0):re&&G>=0&&(y.strides[L]<0?oe=-G:oe=G,ae=!0),ae){let Ee;oe===0||oe<0!=y.strides[L]<0?Ee=0:Ee=Math.trunc(oe/y.strides[L])+(oe%y.strides[L]!==0?1:0),A.push(Ee)}else A.push(-1)}for(let L=0;L<y.finalShapeGatherIndices.length;++L){const $=y.finalShapeGatherIndices[L];$>=0?R.push(A[$]):$===k2&&R.push(1)}return{finalShapeSparse:R.filter((L,$)=>y.finalShapeGatherIndices[$]!==k2),finalShape:R,isIdentity:v,sliceDim0:I,isSimpleSlice:b,begin:y.begin,end:y.end,strides:y.strides}}function eee(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const i=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<i;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(k2),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(JZ),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function xM(t,e,n,s,i,c){if(i[e])return n>0?c[e]:c[e+1&1];{const l=t<0?s+t:t;return l<c[0]?c[0]:l>c[1]?c[1]:l}}const tee=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:eb,computeFlatOffset:rb,computeOutShape:tb,getNormalizedAxes:ZZ,isSliceContinous:nb,maskToAxes:QZ,parseSliceParams:sb,sliceInfo:ob,startForAxis:n5,startIndicesWithElidedDims:Z6,stopForAxis:r5,stopIndicesWithElidedDims:e5,stridesForAxis:t5,stridesWithElidedDims:Y6},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nee(t,e){let n=ne(t,"a","add"),s=ne(e,"b","add");[n,s]=Jr(n,s);const i={a:n,b:s};return _e.runKernel(eg,i)}const mr=pe({add_:nee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ree(t,e){let n=ne(t,"a","floorDiv"),s=ne(e,"b","floorDiv");[n,s]=Jr(n,s);const i={a:n,b:s};return _e.runKernel(u_,i)}const s5=pe({floorDiv_:ree});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function see(t,e){let n=ne(t,"a","div"),s=ne(e,"b","div");if([n,s]=Jr(n,s),n.dtype==="int32"&&s.dtype==="int32")return s5(n,s);const i={a:n,b:s},c={};return _e.runKernel(n_,i,c)}const ar=pe({div_:see});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oee(t,e){let n=ne(t,"a","mul"),s=ne(e,"b","mul");[n,s]=Jr(n,s);const i={a:n,b:s};return _e.runKernel(R_,i)}const Vt=pe({mul_:oee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iee(t){const e=ne(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return _e.runKernel(vw,n)}else{const n={x:e};return _e.runKernel(aw,n)}}const ca=pe({abs_:iee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aee(t){const n={x:ne(t,"x","acos")};return _e.runKernel(G1,n)}const cee=pe({acos_:aee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uee(t){const n={x:ne(t,"x","acosh")};return _e.runKernel(z1,n)}const lee=pe({acosh_:uee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dee(t){se(Array.isArray(t),()=>"The argument passed to tf.addN() must be a list of tensors"),se(t.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${t.length}`);const e=t.map((i,c)=>ne(i,`tensors${c}`,"addN")),n=e[0];e.forEach(i=>{if(i.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(i=>{if(!Nr(i.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});const s=e;return _e.runKernel(cw,s)}const hee=pe({addN_:dee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pee(t,e=null,n=!1){const i={x:ne(t,"x","all","bool")},c={axis:e,keepDims:n};return _e.runKernel(uw,i,c)}const fee=pe({all_:pee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mee(t,e=null,n=!1){const i={x:ne(t,"x","any","bool")},c={axis:e,keepDims:n};return _e.runKernel(lw,i,c)}const gee=pe({any_:mee});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eee(t,e=0){const s={x:ne(t,"x","argMax")},i={axis:e};return _e.runKernel(dw,s,i)}const _ee=pe({argMax_:Eee});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yee(t,e=0){const s={x:ne(t,"x","argMin")},i={axis:e};return _e.runKernel(hw,s,i)}const vee=pe({argMin_:yee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function See(t){const n={x:ne(t,"x","asin")};return _e.runKernel(H1,n)}const Tee=pe({asin_:See});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iee(t){const n={x:ne(t,"x","asinh")};return _e.runKernel(K1,n)}const Cee=pe({asinh_:Iee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wee(t){const n={x:ne(t,"x","atan")};return _e.runKernel(q1,n)}const Ree=pe({atan_:wee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bee(t,e){let n=ne(t,"a","atan2"),s=ne(e,"b","atan2");[n,s]=Jr(n,s);const i={a:n,b:s};return _e.runKernel(Y1,i)}const Nee=pe({atan2_:bee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aee(t){const n={x:ne(t,"x","atanh")};return _e.runKernel(X1,n)}const Oee=pe({atanh_:Aee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rg(t,e,n,s,i="NHWC",c){const l=t[3],d=[...e,l],p=cu(i);return $s(t,d,n,c,s,null,null,p)}function Ta(t,e,n,s,i,c,l="channelsLast"){const[d,p]=l1(e);let f;if(l==="channelsLast")f=[d,p,t[3],t[3]];else if(l==="channelsFirst")f=[d,p,t[1],t[1]];else throw new Error(`Unknown dataFormat ${l}`);return $s(t,f,n,s,i,c,!1,l)}function au(t,e,n,s,i,c,l="NDHWC"){const[d,p,f]=D2(e);let m,_;if(l==="NDHWC")_="channelsLast",m=[d,p,f,t[4],t[4]];else if(l==="NCDHW")_="channelsFirst",m=[d,p,f,t[1],t[1]];else throw new Error(`Unknown dataFormat ${l}`);return Cl(t,m,n,s,i,!1,_,c)}function $s(t,e,n,s,i,c,l=!1,d="channelsLast"){let[p,f,m,_]=[-1,-1,-1,-1];if(d==="channelsLast")[p,f,m,_]=t;else if(d==="channelsFirst")[p,_,f,m]=t;else throw new Error(`Unknown dataFormat ${d}`);const[y,v,,I]=e,[b,A]=l1(n),[R,O]=l1(s),L=fp(y,R),$=fp(v,O),{padInfo:G,outHeight:H,outWidth:Z}=Dee(i,f,m,b,A,L,$,c,d),re=l?I*_:I;let oe;return d==="channelsFirst"?oe=[p,re,H,Z]:d==="channelsLast"&&(oe=[p,H,Z,re]),{batchSize:p,dataFormat:d,inHeight:f,inWidth:m,inChannels:_,outHeight:H,outWidth:Z,outChannels:re,padInfo:G,strideHeight:b,strideWidth:A,filterHeight:y,filterWidth:v,effectiveFilterHeight:L,effectiveFilterWidth:$,dilationHeight:R,dilationWidth:O,inShape:t,outShape:oe,filterShape:e}}function Cl(t,e,n,s,i,c=!1,l="channelsLast",d){let[p,f,m,_,y]=[-1,-1,-1,-1,-1];if(l==="channelsLast")[p,f,m,_,y]=t;else if(l==="channelsFirst")[p,y,f,m,_]=t;else throw new Error(`Unknown dataFormat ${l}`);const[v,I,b,,A]=e,[R,O,L]=D2(n),[$,G,H]=D2(s),Z=fp(v,$),re=fp(I,G),oe=fp(b,H),{padInfo:ae,outDepth:Ee,outHeight:Ce,outWidth:ye}=Pee(i,f,m,_,R,O,L,Z,re,oe,d),we=c?A*y:A;let Ae;return l==="channelsFirst"?Ae=[p,we,Ee,Ce,ye]:l==="channelsLast"&&(Ae=[p,Ee,Ce,ye,we]),{batchSize:p,dataFormat:l,inDepth:f,inHeight:m,inWidth:_,inChannels:y,outDepth:Ee,outHeight:Ce,outWidth:ye,outChannels:we,padInfo:ae,strideDepth:R,strideHeight:O,strideWidth:L,filterDepth:v,filterHeight:I,filterWidth:b,effectiveFilterDepth:Z,effectiveFilterHeight:re,effectiveFilterWidth:oe,dilationDepth:$,dilationHeight:G,dilationWidth:H,inShape:t,outShape:Ae,filterShape:e}}function xee(t,e,n,s,i){s==null&&(s=ib(t,e,n));const c=t[0],l=t[1],d=vd((c-e+2*s)/n+1,i),p=vd((l-e+2*s)/n+1,i);return[d,p]}function kee(t,e,n,s,i,c){i==null&&(i=ib(t,e,s));const l=t[0],d=t[1],p=t[2],f=vd((l-e+2*i)/s+1,c),m=vd((d-e+2*i)/s+1,c),_=vd((p-e+2*i)/s+1,c);return[f,m,_,n]}function ib(t,e,n,s=1){const i=fp(e,s);return Math.floor((t[0]*(n-1)-n+i)/2)}function l1(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function D2(t){return typeof t=="number"?[t,t,t]:t}function fp(t,e){return e<=1?t:t+(t-1)*(e-1)}function Dee(t,e,n,s,i,c,l,d,p){let f,m,_;if(typeof t=="number"){f={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const v=xee([e,n],c,s,t,d);m=v[0],_=v[1]}else if(t==="same"){m=Math.ceil(e/s),_=Math.ceil(n/i);const y=Math.max(0,(m-1)*s+c-e),v=Math.max(0,(_-1)*i+l-n),I=Math.floor(y/2),b=y-I,A=Math.floor(v/2),R=v-A;f={top:I,bottom:b,left:A,right:R,type:"SAME"}}else if(t==="valid")f={top:0,bottom:0,left:0,right:0,type:"VALID"},m=Math.ceil((e-c+1)/s),_=Math.ceil((n-l+1)/i);else if(typeof t=="object"){const y=p==="channelsLast"?t[1][0]:t[2][0],v=p==="channelsLast"?t[1][1]:t[2][1],I=p==="channelsLast"?t[2][0]:t[3][0],b=p==="channelsLast"?t[2][1]:t[3][1];f={top:y,bottom:v,left:I,right:b,type:y===0&&v===0&&I===0&&b===0?"VALID":"EXPLICIT"},m=vd((e-c+y+v)/s+1,d),_=vd((n-l+I+b)/i+1,d)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:f,outHeight:m,outWidth:_}}function Pee(t,e,n,s,i,c,l,d,p,f,m){let _,y,v,I;if(typeof t=="number"){_={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const A=kee([e,n,s,1],d,1,i,t,m);y=A[0],v=A[1],I=A[2]}else if(t==="same"){y=Math.ceil(e/i),v=Math.ceil(n/c),I=Math.ceil(s/l);const b=(y-1)*i+d-e,A=(v-1)*c+p-n,R=(I-1)*l+f-s,O=Math.floor(b/2),L=b-O,$=Math.floor(A/2),G=A-$,H=Math.floor(R/2),Z=R-H;_={top:$,bottom:G,left:H,right:Z,front:O,back:L,type:"SAME"}}else if(t==="valid")_={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},y=Math.ceil((e-d+1)/i),v=Math.ceil((n-p+1)/c),I=Math.ceil((s-f+1)/l);else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:_,outDepth:y,outHeight:v,outWidth:I}}function vd(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Um(t){const[e,n,s]=l1(t);return e===1&&n===1&&s===1}function ho(t,e){return Um(t)||Um(e)}function cu(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Ia(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")se(Cp(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(i=>{se(Cp(i),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${i}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lee(t,e){const s={x:ne(t,"x","reshape","string_or_numeric")},i={shape:e};return _e.runKernel(_R,s,i)}const ze=pe({reshape_:Lee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mee(t,e,n,s,i){const c=ne(t,"x","avgPool","float32"),l=1;se(ho(n,l),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${l}'`);let d=c,p=!1;c.rank===3&&(p=!0,d=ze(c,[1,c.shape[0],c.shape[1],c.shape[2]])),se(d.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${d.rank}.`),Ia("avgPool",s,i);const f={x:d},m={filterSize:e,strides:n,pad:s,dimRoundingMode:i};let _=_e.runKernel(pw,f,m);return _=jr(_,c.dtype),p?ze(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const o5=pe({avgPool_:Mee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ee(t,e,n,s,i,c="NDHWC"){const l=ne(t,"x","avgPool3d","float32");let d=l,p=!1;l.rank===4&&(p=!0,d=ze(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),se(d.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${d.rank}.`),se(c==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${c}`),Ia("avgPool3d",s,i);const f={x:d},m={filterSize:e,strides:n,pad:s,dimRoundingMode:i,dataFormat:c};let _=_e.runKernel(fw,f,m);return _=jr(_,d.dtype),p?ze(_,[_.shape[1],_.shape[2],_.shape[3],_.shape[4]]):_}const Fee=pe({avgPool3d_:$ee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uee(t,e=0){se(t.length>=1,()=>"Pass at least one tensor to concat");const n=c1(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(c=>{if(c.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${c.dtype}. `)}),n.length===1)return ul(n[0]);const s=n,i={axis:e};return _e.runKernel(Sw,s,i)}const Ks=pe({concat_:Uee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vee(t){const n={x:ne(t,"x","sigmoid","float32")};return _e.runKernel(F_,n)}const Sd=pe({sigmoid_:Vee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bee(t,e,n){const s=ne(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const i={x:s},c={begin:e,size:n};return _e.runKernel(wR,i,c)}const hn=pe({slice_:Bee});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jee(t){const n={x:ne(t,"x","tanh","float32")};return _e.runKernel(G_,n)}const P2=pe({tanh_:jee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wee(t,e,n,s,i,c){const l=ne(t,"forgetBias","basicLSTMCell"),d=ne(e,"lstmKernel","basicLSTMCell"),p=ne(n,"lstmBias","basicLSTMCell"),f=ne(s,"data","basicLSTMCell"),m=ne(i,"c","basicLSTMCell"),_=ne(c,"h","basicLSTMCell"),y=Ks([f,_],1),v=nr(y,d),I=mr(v,p),b=I.shape[0],A=I.shape[1]/4,R=[b,A],O=hn(I,[0,0],R),L=hn(I,[0,A],R),$=hn(I,[0,A*2],R),G=hn(I,[0,A*3],R),H=mr(Vt(Sd(O),P2(L)),Vt(m,Sd(mr(l,$)))),Z=Vt(P2(H),Sd(G));return[H,Z]}const Gee=pe({basicLSTMCell_:Wee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zee(t,e,n){const s=ne(t,"x","batchToSpaceND"),i=e.reduce((d,p)=>d*p);se(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),se(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),se(s.shape[0]%i===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${i}`);const c={x:s},l={blockShape:e,crops:n};return _e.runKernel(gw,c,l)}const i5=pe({batchToSpaceND_:zee});function Hee(t){let e;return t.rank===0||t.rank===1?e=ze(t,[1,1,1,t.size]):t.rank===2?e=ze(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=ze(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kee(t,e,n,s,i,c){c==null&&(c=.001);const l=ne(t,"x","batchNorm"),d=ne(e,"mean","batchNorm"),p=ne(n,"variance","batchNorm");let f;i!=null&&(f=ne(i,"scale","batchNorm"));let m;s!=null&&(m=ne(s,"offset","batchNorm")),se(d.rank===p.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),se(m==null||d.rank===m.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),se(f==null||d.rank===f.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const y={x:Hee(l),scale:f,offset:m,mean:d,variance:p},v={varianceEpsilon:c},I=_e.runKernel(jw,y,v);return ze(I,l.shape)}const X_=pe({batchNorm_:Kee});function qee(t,e,n,s,i,c){const l=ne(t,"x","batchNorm"),d=ne(e,"mean","batchNorm"),p=ne(n,"variance","batchNorm");let f;i!=null&&(f=ne(i,"scale","batchNorm"));let m;return s!=null&&(m=ne(s,"offset","batchNorm")),se(l.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${l.rank}.`),se(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${d.rank}.`),se(p.rank===2||p.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${p.rank}.`),f!=null&&se(f.rank===2||f.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${f.rank}.`),m!=null&&se(m.rank===2||m.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${m.rank}.`),X_(l,d,p,m,f,c)}const Xee=pe({batchNorm2d_:qee});function Yee(t,e,n,s,i,c){const l=ne(t,"x","batchNorm"),d=ne(e,"mean","batchNorm"),p=ne(n,"variance","batchNorm");let f;i!=null&&(f=ne(i,"scale","batchNorm"));let m;return s!=null&&(m=ne(s,"offset","batchNorm")),se(l.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${l.rank}.`),se(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${d.rank}.`),se(p.rank===3||p.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${p.rank}.`),f!=null&&se(f.rank===3||f.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${f.rank}.`),m!=null&&se(m.rank===3||m.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${m.rank}.`),X_(l,d,p,m,f,c)}const Jee=pe({batchNorm3d_:Yee});function Qee(t,e,n,s,i,c){const l=ne(t,"x","batchNorm"),d=ne(e,"mean","batchNorm"),p=ne(n,"variance","batchNorm");let f;i!=null&&(f=ne(i,"scale","batchNorm"));let m;return s!=null&&(m=ne(s,"offset","batchNorm")),se(l.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${l.rank}.`),se(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${d.rank}.`),se(p.rank===4||p.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${p.rank}.`),f!=null&&se(f.rank===4||f.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${f.rank}.`),m!=null&&se(m.rank===4||m.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${m.rank}.`),X_(l,d,p,m,f,c)}const Zee=pe({batchNorm4d_:Qee});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ete(t,e,n){const s=ne(t,"x","bincount"),i=ne(e,"weights","bincount");se(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),se(n>=0,()=>`size must be non-negative, but got ${n}.`),se(i.size===s.size||i.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${i.shape}.`);const c={x:s,weights:i},l={size:n};return _e.runKernel(Ew,c,l)}const a5=pe({bincount_:ete});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tte(t,e){const n=ne(t,"s0","broadcastArgs","int32"),s=ne(e,"s1","broadcastArgs","int32");if(n.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${n.rank}`);if(s.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${s.rank}`);const i={s0:n,s1:s};return _e.runKernel(_w,i)}const nte=pe({broadcastArgs_:tte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rte(t,e){let n=ne(t,"broadcastTo","x");const s=n.shape;if(e.some(f=>!(f>0)||f%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const f=n.shape.slice();for(;f.length<e.length;)f.unshift(1);n=ze(n,f)}const i=n.shape,c=Array.from(e);for(let f=e.length-1;f>=0;f--)if(i[f]===e[f])c[f]=1;else if(n.shape[f]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(c.map((f,m)=>f>1?m:-1).filter(f=>f>=0).length===0)return ul(n);const d={x:n},p={reps:c};return _e.runKernel(z_,d,p)}const _m=pe({broadcastTo_:rte});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ste(t){const n={x:ne(t,"x","ceil","float32")};return _e.runKernel(Q1,n)}const ote=pe({ceil_:ste});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y_(t,e,n){const s={shape:t,value:e,dtype:n};return _e.runKernel(Vw,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ite(t,e,n){const s=ne(t,"x","clipByValue");if(se(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return Y_(s.shape,e,s.dtype);const i={x:s},c={clipValueMin:e,clipValueMax:n};return _e.runKernel(Z1,i,c)}const c5=pe({clipByValue_:ite});function ate(t){return Ks(t,0)}const cte=pe({concat1d_:ate});function ute(t,e){return Ks(t,e)}const lte=pe({concat2d_:ute});function dte(t,e){return Ks(t,e)}const hte=pe({concat3d_:dte});function pte(t,e){return Ks(t,e)}const fte=pe({concat4d_:pte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mte(t,e,n,s,i="NHWC",c=[1,1],l){const d=ne(t,"x","conv2d","float32"),p=ne(e,"filter","conv2d","float32");let f=d,m=!1;d.rank===3&&(m=!0,f=ze(d,[1,d.shape[0],d.shape[1],d.shape[2]])),se(f.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${f.rank}.`),se(p.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${p.rank}.`),Ia("conv2d",s,l);const _=i==="NHWC"?f.shape[3]:f.shape[1];se(_===p.shape[2],()=>`Error in conv2d: depth of input (${_}) must match input depth for filter ${p.shape[2]}.`),se(ho(n,c),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${c}'`);const y={x:f,filter:p},v={strides:n,pad:s,dataFormat:i,dilations:c,dimRoundingMode:l},I=_e.runKernel(Tw,y,v);return m?ze(I,[I.shape[1],I.shape[2],I.shape[3]]):I}const J_=pe({conv2d_:mte});function gte(t,e,n,s,i="NWC",c=1,l){const d=ne(t,"x","conv1d"),p=ne(e,"filter","conv1d");let f=d,m=!1;d.rank===2&&(m=!0,f=ze(d,[1,d.shape[0],d.shape[1]])),se(f.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${f.rank}.`),se(p.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${p.rank}.`),Ia("conv1d",s,l),se(f.shape[2]===p.shape[1],()=>`Error in conv1d: depth of input (${f.shape[2]}) must match input depth for filter ${p.shape[1]}.`),se(ho(n,c),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${c}'`),se(i==="NWC",()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`);const _=ze(p,[1,p.shape[0],p.shape[1],p.shape[2]]),y=ze(f,[f.shape[0],1,f.shape[1],f.shape[2]]),A=J_(y,_,[1,n],s,"NHWC",[1,c],l);return m?ze(A,[A.shape[2],A.shape[3]]):ze(A,[A.shape[0],A.shape[2],A.shape[3]])}const Ete=pe({conv1d_:gte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _te(t,e,n,s,i,c="NHWC",l){se(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let d=t,p=e,f=!1;e.rank===3&&(f=!0,p=ze(e,[1,e.shape[0],e.shape[1],e.shape[2]]),d=[1,t[0],t[1],t[2]]),se(d.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${d.length}.`),se(p.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${p.rank}`),se(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const m=c==="NHWC"?d[3]:d[1],_=c==="NHWC"?p.shape[3]:p.shape[1];se(m===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${m}) must match input depth for filter ${n.shape[2]}.`),se(_===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${_}) must match output depth for filter ${n.shape[3]}.`),Ia("conv2dDerInput",i,l);const y={dy:p,filter:n},v={strides:s,pad:i,dataFormat:c,dimRoundingMode:l,inputShape:d},I=_e.runKernel(Cw,y,v);return f?ze(I,[I.shape[1],I.shape[2],I.shape[3]]):I}const u5=pe({conv2DBackpropInput_:_te});function yte(t,e,n,s,i,c){const l=ne(t,"x","conv2dTranspose"),d=ne(e,"filter","conv2dTranspose");return u5(n,l,d,s,i,"NHWC",c)}const vte=pe({conv2dTranspose_:yte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ste(t,e,n,s,i="NDHWC",c=[1,1,1]){const l=ne(t,"x","conv3d"),d=ne(e,"filter","conv3d");let p=l,f=!1;l.rank===4&&(f=!0,p=ze(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),se(p.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${p.rank}.`),se(d.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${d.rank}.`),se(p.shape[4]===d.shape[3],()=>`Error in conv3d: depth of input (${p.shape[4]}) must match input depth for filter ${d.shape[3]}.`),se(ho(n,c),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${c}'`),se(i==="NDHWC",()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`);const m={x:p,filter:d},_={strides:n,pad:s,dataFormat:i,dilations:c},y=_e.runKernel(ww,m,_);return f?ze(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}const Tte=pe({conv3d_:Ste});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ite(t,e,n,s,i){se(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let c=t,l=e,d=!1;e.rank===4&&(d=!0,l=ze(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),c=[1,t[0],t[1],t[2],t[3]]);const p=c[4],f=l.shape[4];se(c.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${c.length}.`),se(l.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${l.rank}`),se(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),se(p===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${p}) must match input depth for filter ${n.shape[3]}.`),se(f===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${f}) must match output depth for filter ${n.shape[4]}.`);const m={dy:l,filter:n},_={pad:i,strides:s,inputShape:c},y=_e.runKernel(Rw,m,_);return d?ze(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}const Cte=pe({conv3DBackpropInput_:Ite});function wte(t,e,n,s,i){const c=ne(t,"x","conv3dTranspose"),l=ne(e,"filter","conv3dTranspose");return Cte(n,c,l,s,i)}const Rte=pe({conv3dTranspose_:wte});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bte(t){const n={x:ne(t,"x","cos","float32")};return _e.runKernel(e_,n)}const Nte=pe({cos_:bte});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ate(t){const n={x:ne(t,"x","cosh","float32")};return _e.runKernel(t_,n)}const Ote=pe({cosh_:Ate});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xte(t,e=0,n=!1,s=!1){const c={x:ne(t,"x","cumprod")},l={axis:e,exclusive:n,reverse:s};return _e.runKernel(bw,c,l)}const kte=pe({cumprod_:xte});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dte(t,e=0,n=!1,s=!1){const c={x:ne(t,"x","cumsum")},l={axis:e,exclusive:n,reverse:s};return _e.runKernel(Nw,c,l)}const Pte=pe({cumsum_:Dte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lte(t,e,n,s=!1){const i=ne(t,"x","denseBincount"),c=ne(e,"weights","denseBincount");se(i.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${i.dtype}`),se(i.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${i.rank}.`),se(n>=0,()=>`size must be non-negative, but got ${n}.`),se(c.size===i.size||c.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${i.shape}, weights shape: ${c.shape}.`);const l={x:i,weights:c},d={size:n,binaryOutput:s};return _e.runKernel(Ow,l,d)}const Mte=pe({denseBincount_:Lte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $te(t,e,n="NHWC"){const s=ne(t,"x","depthToSpace","float32"),i=n==="NHWC"?s.shape[1]:s.shape[2],c=n==="NHWC"?s.shape[2]:s.shape[3],l=n==="NHWC"?s.shape[3]:s.shape[1];se(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),se(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e}  for depthToSpace with input shape
    ${s.shape}`),se(c*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${c} and ${e} for depthToSpace with input shape
        ${s.shape}`),se(l%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${l} for depthToSpace with input shape ${s.shape}`);const d={x:s},p={blockSize:e,dataFormat:n};return _e.runKernel(xw,d,p)}const Fte=pe({depthToSpace_:$te});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ute(t,e,n,s,i="NHWC",c=[1,1],l){const d=ne(t,"x","depthwiseConv2d","float32"),p=ne(e,"filter","depthwiseConv2d","float32");let f=d,m=!1;d.rank===3&&(m=!0,f=ze(d,[1,d.shape[0],d.shape[1],d.shape[2]])),se(f.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`),se(p.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`);const _=i==="NHWC"?f.shape[3]:f.shape[1];se(_===p.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${_}) must match the inChannels dimension in filter ${p.shape[2]}.`),Ia("depthwiseConv2d",s,l);const y={x:f,filter:p},v={strides:n,pad:s,dataFormat:i,dilations:c,dimRoundingMode:l},I=_e.runKernel(kw,y,v);return m?ze(I,[I.shape[1],I.shape[2],I.shape[3]]):I}const ab=pe({depthwiseConv2d_:Ute});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vte(t){const n={x:ne(t,"x","diag")};return _e.runKernel(Lw,n)}const Bte=pe({diag_:Vte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jte(t,e,n,s,i=[1,1],c="NHWC"){const l=ne(t,"x","dilation2d"),d=ne(e,"filter","dilation2d");se(l.rank===3||l.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${l.rank}.`),se(d.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${d.rank}.`),se(c==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${c}`);let p=l,f=!1;l.rank===3&&(p=ze(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=!0);const m={x:p,filter:d},_={strides:n,pad:s,dilations:i},y=_e.runKernel(Mw,m,_);return f?ze(y,[y.shape[1],y.shape[2],y.shape[3]]):y}const Wte=pe({dilation2d_:jte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gte(t,e){let n=ne(t,"a","equal","string_or_numeric"),s=ne(e,"b","equal","string_or_numeric");[n,s]=Jr(n,s),Rn(n.shape,s.shape);const i={a:n,b:s};return _e.runKernel(o_,i)}const l5=pe({equal_:Gte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zte(t,e,n){const s=ne(e,"a","where"),i=ne(n,"b","where"),c=ne(t,"condition","where","bool"),l=Rn(Rn(c.shape,s.shape),i.shape),d=_m(c,l),p=_m(s,l),f=_m(i,l),m={condition:d,t:p,e:f};return _e.runKernel(CR,m)}const Ap=pe({where_:zte});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hte(t){const n={x:ne(t,"x","zerosLike")};return _e.runKernel(GR,n)}const cb=pe({zerosLike_:Hte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kte(t,e){let n=ne(t,"a","div"),s=ne(e,"b","div");[n,s]=Jr(n,s);const i=ar(n,s),c=cb(i),l=l5(s,c);return Ap(l,c,i)}const qte=pe({divNoNan_:Kte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xte(t,e){const n=ne(t,"t1","dot"),s=ne(e,"t2","dot");se((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const i=n.rank===1?n.size:n.shape[1],c=s.rank===1?s.size:s.shape[0];if(se(i===c,()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${c}.`),n.rank===1&&s.rank===1){const l=ze(n,[1,-1]),d=ze(s,[-1,1]),p=nr(l,d);return ze(p,[])}else if(n.rank===1&&s.rank===2){const l=ze(n,[1,-1]),d=ze(s,[s.shape[0],s.shape[1]]),p=nr(l,d);return ze(p,[p.size])}else if(n.rank===2&&s.rank===1){const l=ze(s,[-1,1]),d=nr(n,l);return ze(d,[d.size])}else{const l=ze(s,[s.shape[0],s.shape[1]]);return nr(n,l)}}const Yte=pe({dot_:Xte});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jte(t,...e){const n=e.map((i,c)=>ne(i,`tensors${c}`,"einsum")),s={equation:t};return _e.runKernel($w,n,s)}const Qte=pe({einsum_:Jte});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zte(t){const n={x:ne(t,"x","elu","float32")};return _e.runKernel(r_,n)}const d5=pe({elu_:Zte});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ene(t){let e=ne(t,"x","erf");se(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=jr(e,"float32"));const n={x:e};return _e.runKernel(s_,n)}const tne=pe({erf_:ene});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ub(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function h5(t,e,n){const s=t.length+e.length,i=[];let c=0,l=0;for(let d=0;d<s;d++)n.indexOf(d)===-1?i.push(t[c++]):i.push(e[l++]);return i}function qs(t,e){const n=[],s=t.length;for(let c=0;c<s;c++)e.indexOf(c)===-1&&n.push(t[c]);const i=e.map(c=>t[c]);return[n,i]}function Cs(t,e){const n=e.map(s=>1);return h5(t,n,e)}function Xs(t,e,n){se(ub(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function ss(t,e){if(ub(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function sg(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function os(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nne(t,e=null,n=!1){const i={x:ne(t,"x","max")},c={reductionIndices:e,keepDims:n};return _e.runKernel(Yw,i,c)}const mp=pe({max_:nne});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rne(t,e=null,n=!1){const i={x:ne(t,"x","min")},c={axis:e,keepDims:n};return _e.runKernel(tR,i,c)}const L2=pe({min_:rne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sne(t,e){let n=ne(t,"base","pow"),s=ne(e,"exp","pow");[n,s]=Jr(n,s);const i={a:n,b:s};return _e.runKernel(N_,i)}const lb=pe({pow_:sne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wn(t,e){if((Sc(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Sc(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Il(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function one(t){const n={x:ne(t,"x","sqrt","float32")};return _e.runKernel(V_,n)}const M2=pe({sqrt_:one});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ine(t){const e=ne(t,"x","square"),n={};return _e.runKernel("Square",{x:e},n)}const Q_=pe({square_:ine});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ane(t,e=null,n=!1){let s=ne(t,"x","sum");s.dtype==="bool"&&(s=jr(s,"int32"));const i={x:s},c={axis:e,keepDims:n};return _e.runKernel(RR,i,c)}const Cr=pe({sum_:ane});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cne(t,e="euclidean",n=null,s=!1){t=ne(t,"x","norm");const i=p5(t,e,n);let c=i.shape;if(s){const l=$n(n,t.shape);c=Cs(i.shape,l)}return ze(i,c)}function p5(t,e,n=null){if(t.rank===0)return ca(t);if(t.rank!==1&&n===null)return p5(ze(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return Cr(ca(t),n);if(e===1/0)return mp(ca(t),n);if(e===-1/0)return L2(ca(t),n);if(e==="euclidean"||e===2)return M2(Cr(lb(ca(t),Wn(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return mp(Cr(ca(t),n[0]),n[1]-1);if(e===1/0)return mp(Cr(ca(t),n[1]),n[0]);if(e===-1/0)return L2(Cr(ca(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return M2(Cr(Q_(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Z_=pe({norm_:cne});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function une(t,e=null,n=!1){return Z_(t,"euclidean",e,n)}const lne=pe({euclideanNorm_:une});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dne(t){const n={x:ne(t,"x","exp")};return _e.runKernel(i_,n)}const eu=pe({exp_:dne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hne(t,e=0){const n=ne(t,"x","expandDims","string_or_numeric");se(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},i={dim:e};return _e.runKernel(Fw,s,i)}const Ba=pe({expandDims_:hne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pne(t){const n={x:ne(t,"x","expm1")};return _e.runKernel(a_,n)}const fne=pe({expm1_:pne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mne(t,e){const n=ne(t,"x","tile","string_or_numeric");se(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},i={reps:e};return _e.runKernel(z_,s,i)}const ym=pe({tile_:mne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gne(t,e,n,s="float32"){e==null&&(e=t);const i=cn([t,e],s),c=t<=e?t:e;for(let d=0;d<c;++d)i.set(1,d,d);const l=ze(i.toTensor(),[t,e]);if(n==null)return l;if(n.length===1)return ym(Ba(l,0),[n[0],1,1]);if(n.length===2)return ym(Ba(Ba(l,0),0),[n[0],n[1],1,1]);if(n.length===3)return ym(Ba(Ba(Ba(l,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const f5=pe({eye_:gne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ene(t){const n={x:ne(t,"x","floor","float32")};return _e.runKernel(c_,n)}const m5=pe({floor_:Ene});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ne(t,e,n=0,s=0){const i=ne(t,"x","gather"),c=ne(e,"indices","gather","int32"),l={x:i,indices:c},d={axis:n,batchDims:s};return _e.runKernel(Ww,l,d)}const g5=pe({gather_:_ne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yne(t,e){let n=ne(t,"a","greater","string_or_numeric"),s=ne(e,"b","greater","string_or_numeric");[n,s]=Jr(n,s),Rn(n.shape,s.shape);const i={a:n,b:s};return _e.runKernel(l_,i)}const ey=pe({greater_:yne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vne(t,e){let n=ne(t,"a","greaterEqual","string_or_numeric"),s=ne(e,"b","greaterEqual","string_or_numeric");[n,s]=Jr(n,s),Rn(n.shape,s.shape);const i={a:n,b:s};return _e.runKernel(d_,i)}const E5=pe({greaterEqual_:vne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sne(t){const n={x:ne(t,"x","isFinite")};return _e.runKernel(p_,n)}const Tne=pe({isFinite_:Sne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ine(t){const n={x:ne(t,"x","isInf")};return _e.runKernel(f_,n)}const Cne=pe({isInf_:Ine});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wne(t){const n={x:ne(t,"x","isNaN")};return _e.runKernel(m_,n)}const Rne=pe({isNaN_:wne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bne(t,e=.2){const s={x:ne(t,"x","leakyRelu")},i={alpha:e};return _e.runKernel(Kw,s,i)}const _5=pe({leakyRelu_:bne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nne(t,e){let n=ne(t,"a","less","string_or_numeric"),s=ne(e,"b","less","string_or_numeric");[n,s]=Jr(n,s),Rn(n.shape,s.shape);const i={a:n,b:s};return _e.runKernel(g_,i)}const Ane=pe({less_:Nne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function One(t,e){let n=ne(t,"a","lessEqual","string_or_numeric"),s=ne(e,"b","lessEqual","string_or_numeric");[n,s]=Jr(n,s),Rn(n.shape,s.shape);const i={a:n,b:s};return _e.runKernel(E_,i)}const db=pe({lessEqual_:One});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xne(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");const s={start:t,stop:e,num:n};return _e.runKernel(qw,{},s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kne(t,e=5,n=1,s=1,i=.5){const c=ne(t,"x","localResponseNormalization");se(c.rank===4||c.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${c.rank}.`),se(Cp(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let l=c,d=!1;c.rank===3&&(d=!0,l=ze(c,[1,c.shape[0],c.shape[1],c.shape[2]]));const p={x:l},f={depthRadius:e,bias:n,alpha:s,beta:i},m=_e.runKernel(Xw,p,f);return d?ze(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const Dne=pe({localResponseNormalization_:kne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pne(t){const n={x:ne(t,"x","log","float32")};return _e.runKernel(__,n)}const Vm=pe({log_:Pne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lne(t){const n={x:ne(t,"x","log1p")};return _e.runKernel(y_,n)}const y5=pe({log1p_:Lne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tu(t){return _e.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mne(t){const n={x:ne(t,"x","softplus")};return _e.runKernel(U_,n)}const v5=pe({softplus_:Mne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ne(t){const e=ne(t,"x","logSigmoid");return tu(s=>({value:Xc(v5(Xc(s))),gradFunc:l=>Vt(l,Sd(Xc(s)))}))(e)}const Fne=pe({logSigmoid_:$ne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Une(t,e){let n=ne(t,"a","sub"),s=ne(e,"b","sub");[n,s]=Jr(n,s);const i={a:n,b:s};return _e.runKernel(j_,i)}const An=pe({sub_:Une});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vne(t,e=-1){const n=ne(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return tu((i,c)=>{const d=mp(i,e,!0),p=An(i,d),f=An(jr(p,"float32"),Vm(Cr(eu(p),e,!0)));return c([f]),{value:f,gradFunc:(_,y)=>{const[v]=y,I=!0,b=eu(v);return An(_,Vt(Cr(_,e,I),b))}}})(n)}const Bne=pe({logSoftmax_:Vne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jne(t,e=null,n=!1){const s=ne(t,"x","logSumExp"),i=$n(e,s.shape),c=mp(s,i,!0),l=An(s,c),d=eu(l),p=Cr(d,i),f=Vm(p),m=mr(ze(c,f.shape),f);if(n){const _=Cs(m.shape,i);return ze(m,_)}return m}const S5=pe({logSumExp_:jne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wne(t,e){const n=ne(t,"a","logicalAnd","bool"),s=ne(e,"b","logicalAnd","bool");Rn(n.shape,s.shape);const i={a:n,b:s};return _e.runKernel(v_,i)}const d1=pe({logicalAnd_:Wne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gne(t){const n={x:ne(t,"x","logicalNot","bool")};return _e.runKernel(S_,n)}const T5=pe({logicalNot_:Gne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zne(t,e){const n=ne(t,"a","logicalOr","bool"),s=ne(e,"b","logicalOr","bool");Rn(n.shape,s.shape);const i={a:n,b:s};return _e.runKernel(T_,i)}const I5=pe({logicalOr_:zne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hne(t,e){const n=ne(t,"a","logicalXor","bool"),s=ne(e,"b","logicalXor","bool");return Rn(n.shape,s.shape),d1(I5(t,e),T5(d1(t,e)))}const Kne=pe({logicalXor_:Hne});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a0=2147483648;function qne(t,e,n="left"){const s=ne(t,"sortedSequence","searchSorted"),i=ne(e,"values","searchSorted"),c=s.shape[s.shape.length-1],l=i.shape[i.shape.length-1],d=ze(s,[-1,c]),p=ze(i,[-1,l]);if(d.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(d.shape[0]!==p.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Pe(p.shape)>=a0)throw new Error(`values tensor size must less than ${a0}`);if(d.shape[1]>=a0)throw new Error(`trailing dim_size must less than ${a0} for int32 output type, was ${d.shape[1]}`);const f={sortedSequence:d,values:p},m={side:n};return _e.runKernel(IR,f,m)}const hb=pe({searchSorted_:qne});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xne(t,e){return hb(t,e,"left")}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yne(t,e,n,s,i){const c=ne(t,"x","maxPool"),l=1;let d=c,p=!1;c.rank===3&&(p=!0,d=ze(c,[1,c.shape[0],c.shape[1],c.shape[2]])),se(d.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${d.rank}.`),se(ho(n,l),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${l}'`),Ia("maxPool",s,i);const f={x:d},m={filterSize:e,strides:n,pad:s,dimRoundingMode:i},_=_e.runKernel(Jw,f,m);return p?ze(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const C5=pe({maxPool_:Yne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jne(t,e=[1,1,1],n,s,i,c="NDHWC"){const l=ne(t,"x","maxPool3d");let d=l,p=!1;l.rank===4&&(p=!0,d=ze(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),se(d.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${d.rank}.`),se(c==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${c}`),Ia("maxPool3d",s,i);const f={x:d},m={filterSize:e,strides:n,pad:s,dimRoundingMode:i,dataFormat:c},_=_e.runKernel(Qw,f,m);return p?ze(_,[_.shape[1],_.shape[2],_.shape[3],_.shape[4]]):_}const Qne=pe({maxPool3d_:Jne});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zne(t,e,n,s,i=!1){const l={x:ne(t,"x","maxPoolWithArgmax")},d={filterSize:e,strides:n,pad:s,includeBatchInIndex:i},p=_e.runKernel(Zw,l,d);return{result:p[0],indexes:p[1]}}const ere=pe({maxPoolWithArgmax_:Zne});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tre(t,e){let n=ne(t,"a","maximum"),s=ne(e,"b","maximum");[n,s]=Jr(n,s),n.dtype==="bool"&&(n=jr(n,"int32"),s=jr(s,"int32")),Rn(n.shape,s.shape);const i={a:n,b:s};return _e.runKernel(I_,i)}const nre=pe({maximum_:tre});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rre(t,e=null,n=!1){const i={x:ne(t,"x","mean")},c={axis:e,keepDims:n};return _e.runKernel(eR,i,c)}const h1=pe({mean_:rre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xd(t,e="float32"){if(e==="complex64"){const s=xd(t,"float32"),i=xd(t,"float32");return fl(s,i)}const n=lo(Pe(t),e);return _e.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function md(t,e="float32"){if(e==="complex64"){const s=md(t,"float32"),i=xd(t,"float32");return fl(s,i)}const n=ow(Pe(t),e);return _e.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sre(t,e,{indexing:n="xy"}={}){if(n!=="xy"&&n!=="ij")throw new TypeError(`${n} is not a valid third argument to meshgrid`);if(t===void 0)return[];let s=ne(t,"x","meshgrid",t instanceof Br?t.dtype:"float32");if(e===void 0)return[s];let i=ne(e,"y","meshgrid",e instanceof Br?e.dtype:"float32");const c=Pe(s.shape),l=Pe(i.shape);return n==="xy"?(s=ze(s,[1,-1]),i=ze(i,[-1,1]),[nr(md([l,1],s.dtype),s),nr(i,md([1,c],i.dtype))]):(s=ze(s,[-1,1]),i=ze(i,[1,-1]),[nr(s,md([1,l],s.dtype)),nr(md([c,1],i.dtype),i)])}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ore(t,e){let n=ne(t,"a","minimum"),s=ne(e,"b","minimum");[n,s]=Jr(n,s),n.dtype==="bool"&&(n=jr(n,"int32"),s=jr(s,"int32")),Rn(n.shape,s.shape);const i={a:n,b:s};return _e.runKernel(C_,i)}const w5=pe({minimum_:ore});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ire(t,e,n){se(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=ne(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");se(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const i=n==="reflect"?1:0;for(let d=0;d<s.rank;d++)se(e[d].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),se(e[d][0]>=0&&e[d][0]<=s.shape[d]-i&&e[d][1]>=0&&e[d][1]<=s.shape[d]-i,()=>`Padding in dimension ${d} cannot be greater than or equal to ${s.shape[d]-i} or less than 0 for input of shape ${s.shape}`);const c={paddings:e,mode:n},l={x:s};return _e.runKernel(nR,l,c)}const are=pe({mirrorPad_:ire});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cre(t,e){let n=ne(t,"a","mod"),s=ne(e,"b","mod");[n,s]=Jr(n,s);const i={a:n,b:s};return _e.runKernel(w_,i)}const ure=pe({mod_:cre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lre(t,e=null,n=!1){t=ne(t,"x","moments");const s=$n(e,t.shape),i=h1(t,s,n);let c=i.shape;n||(c=Cs(i.shape,s));const l=Q_(An(jr(t,"float32"),ze(i,c))),d=h1(l,s,n);return{mean:i,variance:d}}const dre=pe({moments_:lre});function hre(t,e,n,s){const i=ne(e,"data","multiRNNCell"),c=c1(n,"c","multiRNNCell"),l=c1(s,"h","multiRNNCell");let d=i;const p=[];for(let _=0;_<t.length;_++){const y=t[_](d,c[_],l[_]);p.push(y[0]),p.push(y[1]),d=y[1]}const f=[],m=[];for(let _=0;_<p.length;_+=2)f.push(p[_]),m.push(p[_+1]);return[f,m]}const pre=pe({multiRNNCell_:hre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fre(t,e,n,s=!1){const i=ne(t,"logits","multinomial"),c=i.size,l=i.rank;if(c<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${c}.`);if(l>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${l}`);n=n||Math.random();const p={logits:l===1?ze(i,[1,-1]):i},f={numSamples:e,seed:n,normalized:s},m=_e.runKernel(rR,p,f);return l===1?ze(m,[m.size]):m}const mre=pe({multinomial_:fre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gre(t,e){let n=ne(t,"a","notEqual","string_or_numeric"),s=ne(e,"b","notEqual","string_or_numeric");[n,s]=Jr(n,s),Rn(n.shape,s.shape);const i={a:n,b:s};return _e.runKernel(b_,i)}const R5=pe({notEqual_:gre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ere(t){const n={x:ne(t,"x","onesLike")};return _e.runKernel(cR,n)}const _re=pe({onesLike_:Ere});function yre(t,e){const n=ne(t,"v1","outerProduct"),s=ne(e,"v2","outerProduct");se(n.rank===1&&s.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${n.rank} and ${s.rank}.`);const i=ze(n,[-1,1]),c=ze(s,[1,-1]);return nr(i,c)}const vre=pe({outerProduct_:yre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sre(t,e,n=0){const s=ne(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:e,constantValue:n},c={x:s};return _e.runKernel(dR,c,i)}const og=pe({pad_:Sre});function Tre(t,e,n=0){return se(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),og(t,[e],n)}const Ire=pe({pad1d_:Tre});function Cre(t,e,n=0){return se(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),og(t,e,n)}const wre=pe({pad2d_:Cre});function Rre(t,e,n=0){return se(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),og(t,e,n)}const bre=pe({pad3d_:Rre});function Nre(t,e,n=0){return se(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),og(t,e,n)}const Are=pe({pad4d_:Nre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ore(t,e,n){const s=ne(t,"x","spaceToBatchND");se(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),se(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),se(s.shape.reduce((l,d,p)=>p>0&&p<=e.length?l&&(d+n[p-1][0]+n[p-1][1])%e[p-1]===0:l,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const i={x:s},c={blockShape:e,paddings:n};return _e.runKernel(bR,i,c)}const b5=pe({spaceToBatchND_:Ore});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xre(t,e,n,s,i,c,l){i==null&&(i=[1,1]),c==null&&(c=1),s===0&&(s="valid");const d=ne(t,"x","maxPool");let p=d,f=!1;d.rank===3&&(f=!0,p=ze(d,[1,d.shape[0],d.shape[1],d.shape[2]])),se(ho(c,i),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${c} and dilations '${i}'`);const m=Ta(p.shape,e,c,i,s),_=[m.dilationHeight,m.dilationWidth];let y;s==="same"?y=Dre([m.filterHeight,m.filterWidth],_):y=[[0,0],[0,0]];const v=_[0]===1&&_[1]===1,[I,b]=kre([m.inHeight,m.inWidth],_,y),A=v?s:"valid",R=v?p:b5(p,_,I),L=(n==="avg"?()=>o5(R,e,c,A,l):()=>C5(R,e,c,A,l))(),$=v?L:i5(L,_,b);return f?ze($,[$.shape[1],$.shape[2],$.shape[3]]):$}function kre(t,e,n){const s=n.map(m=>m[0]),i=n.map(m=>m[1]),c=t.concat(s,i),l=e.map((m,_)=>(m-c[_]%m)%m),d=i.map((m,_)=>m+l[_]),p=e.map((m,_)=>[s[_],d[_]]),f=e.map((m,_)=>[0,l[_]]);return[p,f]}function Dre(t,e){const s=t.map((l,d)=>l+(l-1)*(e[d]-1)).map(l=>l-1),i=s.map(l=>Math.floor(l/2)),c=s.map((l,d)=>l-i[d]);return s.map((l,d)=>[i[d],c[d]])}const Pre=pe({pool_:xre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lre(t,e){const n=ne(t,"x","prelu"),s=ne(e,"alpha","prelu"),i={x:n,alpha:s};return _e.runKernel(hR,i)}const N5=pe({prelu_:Lre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mre(t,e=null,n=!1){let s=ne(t,"x","prod");s.dtype==="bool"&&(s=jr(s,"int32"));const i={x:s},c={axis:e,keepDims:n};return _e.runKernel(pR,i,c)}const $re=pe({prod_:Mre});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fre(t,e,n,s){const i=t.map((m,_)=>ne(m,`tensors${_}`,"raggedGather","int32")),c=ne(e,"paramsDenseValues","raggedGather"),l=ne(n,"indices","raggedGather","int32"),d={paramsNestedSplits:i,paramsDenseValues:c,indices:l},p={outputRaggedRank:s},f=_e.runKernel(fR,d,p);return{outputNestedSplits:f.slice(0,f.length-1),outputDenseValues:f[f.length-1]}}const Ure=pe({raggedGather_:Fre});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vre(t,e,n,s,i){const c=ne(t,"shape","raggedTensorToTensor","int32"),l=ne(e,"values","raggedTensorToTensor"),d=ne(n,"defaultValue","raggedTensorToTensor",l.dtype),p=s.map((_,y)=>ne(_,`tensors${y}`,"raggedTensorToTensor","int32")),f={shape:c,values:l,defaultValue:d,rowPartitionTensors:p},m={rowPartitionTypes:i};return _e.runKernel(mR,f,m)}const Bre=pe({raggedTensorToTensor_:Vre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jre(t,e,n){const s=Pe(t);let i=null;if(n==null||n==="float32")i=new Float32Array(s);else if(n==="int32")i=new Int32Array(s);else if(n==="bool")i=new Uint8Array(s);else throw new Error(`Unknown data type ${n}`);for(let c=0;c<s;c++)i[c]=e();return _e.makeTensor(i,t,n)}const Wre=pe({rand_:jre});var $2={},Gre={get exports(){return $2},set exports(t){$2=t}};(function(t){(function(e,n,s){function i(p){var f=this,m=d();f.next=function(){var _=2091639*f.s0+f.c*23283064365386963e-26;return f.s0=f.s1,f.s1=f.s2,f.s2=_-(f.c=_|0)},f.c=1,f.s0=m(" "),f.s1=m(" "),f.s2=m(" "),f.s0-=m(p),f.s0<0&&(f.s0+=1),f.s1-=m(p),f.s1<0&&(f.s1+=1),f.s2-=m(p),f.s2<0&&(f.s2+=1),m=null}function c(p,f){return f.c=p.c,f.s0=p.s0,f.s1=p.s1,f.s2=p.s2,f}function l(p,f){var m=new i(p),_=f&&f.state,y=m.next;return y.int32=function(){return m.next()*4294967296|0},y.double=function(){return y()+(y()*2097152|0)*11102230246251565e-32},y.quick=y,_&&(typeof _=="object"&&c(_,m),y.state=function(){return c(m,{})}),y}function d(){var p=4022871197,f=function(m){m=String(m);for(var _=0;_<m.length;_++){p+=m.charCodeAt(_);var y=.02519603282416938*p;p=y>>>0,y-=p,y*=p,p=y>>>0,y-=p,p+=y*4294967296}return(p>>>0)*23283064365386963e-26};return f}n&&n.exports?n.exports=l:s&&s.amd?s(function(){return l}):this.alea=l})(Bi,t,!1)})(Gre);var F2={},zre={get exports(){return F2},set exports(t){F2=t}};(function(t){(function(e,n,s){function i(d){var p=this,f="";p.x=0,p.y=0,p.z=0,p.w=0,p.next=function(){var _=p.x^p.x<<11;return p.x=p.y,p.y=p.z,p.z=p.w,p.w^=p.w>>>19^_^_>>>8},d===(d|0)?p.x=d:f+=d;for(var m=0;m<f.length+64;m++)p.x^=f.charCodeAt(m)|0,p.next()}function c(d,p){return p.x=d.x,p.y=d.y,p.z=d.z,p.w=d.w,p}function l(d,p){var f=new i(d),m=p&&p.state,_=function(){return(f.next()>>>0)/4294967296};return _.double=function(){do var y=f.next()>>>11,v=(f.next()>>>0)/4294967296,I=(y+v)/(1<<21);while(I===0);return I},_.int32=f.next,_.quick=_,m&&(typeof m=="object"&&c(m,f),_.state=function(){return c(f,{})}),_}n&&n.exports?n.exports=l:s&&s.amd?s(function(){return l}):this.xor128=l})(Bi,t,!1)})(zre);var U2={},Hre={get exports(){return U2},set exports(t){U2=t}};(function(t){(function(e,n,s){function i(d){var p=this,f="";p.next=function(){var _=p.x^p.x>>>2;return p.x=p.y,p.y=p.z,p.z=p.w,p.w=p.v,(p.d=p.d+362437|0)+(p.v=p.v^p.v<<4^(_^_<<1))|0},p.x=0,p.y=0,p.z=0,p.w=0,p.v=0,d===(d|0)?p.x=d:f+=d;for(var m=0;m<f.length+64;m++)p.x^=f.charCodeAt(m)|0,m==f.length&&(p.d=p.x<<10^p.x>>>4),p.next()}function c(d,p){return p.x=d.x,p.y=d.y,p.z=d.z,p.w=d.w,p.v=d.v,p.d=d.d,p}function l(d,p){var f=new i(d),m=p&&p.state,_=function(){return(f.next()>>>0)/4294967296};return _.double=function(){do var y=f.next()>>>11,v=(f.next()>>>0)/4294967296,I=(y+v)/(1<<21);while(I===0);return I},_.int32=f.next,_.quick=_,m&&(typeof m=="object"&&c(m,f),_.state=function(){return c(f,{})}),_}n&&n.exports?n.exports=l:s&&s.amd?s(function(){return l}):this.xorwow=l})(Bi,t,!1)})(Hre);var V2={},Kre={get exports(){return V2},set exports(t){V2=t}};(function(t){(function(e,n,s){function i(d){var p=this;p.next=function(){var m=p.x,_=p.i,y,v;return y=m[_],y^=y>>>7,v=y^y<<24,y=m[_+1&7],v^=y^y>>>10,y=m[_+3&7],v^=y^y>>>3,y=m[_+4&7],v^=y^y<<7,y=m[_+7&7],y=y^y<<13,v^=y^y<<9,m[_]=v,p.i=_+1&7,v};function f(m,_){var y,v=[];if(_===(_|0))v[0]=_;else for(_=""+_,y=0;y<_.length;++y)v[y&7]=v[y&7]<<15^_.charCodeAt(y)+v[y+1&7]<<13;for(;v.length<8;)v.push(0);for(y=0;y<8&&v[y]===0;++y);for(y==8?v[7]=-1:v[y],m.x=v,m.i=0,y=256;y>0;--y)m.next()}f(p,d)}function c(d,p){return p.x=d.x.slice(),p.i=d.i,p}function l(d,p){d==null&&(d=+new Date);var f=new i(d),m=p&&p.state,_=function(){return(f.next()>>>0)/4294967296};return _.double=function(){do var y=f.next()>>>11,v=(f.next()>>>0)/4294967296,I=(y+v)/(1<<21);while(I===0);return I},_.int32=f.next,_.quick=_,m&&(m.x&&c(m,f),_.state=function(){return c(f,{})}),_}n&&n.exports?n.exports=l:s&&s.amd?s(function(){return l}):this.xorshift7=l})(Bi,t,!1)})(Kre);var B2={},qre={get exports(){return B2},set exports(t){B2=t}};(function(t){(function(e,n,s){function i(d){var p=this;p.next=function(){var m=p.w,_=p.X,y=p.i,v,I;return p.w=m=m+1640531527|0,I=_[y+34&127],v=_[y=y+1&127],I^=I<<13,v^=v<<17,I^=I>>>15,v^=v>>>12,I=_[y]=I^v,p.i=y,I+(m^m>>>16)|0};function f(m,_){var y,v,I,b,A,R=[],O=128;for(_===(_|0)?(v=_,_=null):(_=_+"\0",v=0,O=Math.max(O,_.length)),I=0,b=-32;b<O;++b)_&&(v^=_.charCodeAt((b+32)%_.length)),b===0&&(A=v),v^=v<<10,v^=v>>>15,v^=v<<4,v^=v>>>13,b>=0&&(A=A+1640531527|0,y=R[b&127]^=v+A,I=y==0?I+1:0);for(I>=128&&(R[(_&&_.length||0)&127]=-1),I=127,b=4*128;b>0;--b)v=R[I+34&127],y=R[I=I+1&127],v^=v<<13,y^=y<<17,v^=v>>>15,y^=y>>>12,R[I]=v^y;m.w=A,m.X=R,m.i=I}f(p,d)}function c(d,p){return p.i=d.i,p.w=d.w,p.X=d.X.slice(),p}function l(d,p){d==null&&(d=+new Date);var f=new i(d),m=p&&p.state,_=function(){return(f.next()>>>0)/4294967296};return _.double=function(){do var y=f.next()>>>11,v=(f.next()>>>0)/4294967296,I=(y+v)/(1<<21);while(I===0);return I},_.int32=f.next,_.quick=_,m&&(m.X&&c(m,f),_.state=function(){return c(f,{})}),_}n&&n.exports?n.exports=l:s&&s.amd?s(function(){return l}):this.xor4096=l})(Bi,t,!1)})(qre);var j2={},Xre={get exports(){return j2},set exports(t){j2=t}};(function(t){(function(e,n,s){function i(d){var p=this,f="";p.next=function(){var _=p.b,y=p.c,v=p.d,I=p.a;return _=_<<25^_>>>7^y,y=y-v|0,v=v<<24^v>>>8^I,I=I-_|0,p.b=_=_<<20^_>>>12^y,p.c=y=y-v|0,p.d=v<<16^y>>>16^I,p.a=I-_|0},p.a=0,p.b=0,p.c=-1640531527,p.d=1367130551,d===Math.floor(d)?(p.a=d/4294967296|0,p.b=d|0):f+=d;for(var m=0;m<f.length+20;m++)p.b^=f.charCodeAt(m)|0,p.next()}function c(d,p){return p.a=d.a,p.b=d.b,p.c=d.c,p.d=d.d,p}function l(d,p){var f=new i(d),m=p&&p.state,_=function(){return(f.next()>>>0)/4294967296};return _.double=function(){do var y=f.next()>>>11,v=(f.next()>>>0)/4294967296,I=(y+v)/(1<<21);while(I===0);return I},_.int32=f.next,_.quick=_,m&&(typeof m=="object"&&c(m,f),_.state=function(){return c(f,{})}),_}n&&n.exports?n.exports=l:s&&s.amd?s(function(){return l}):this.tychei=l})(Bi,t,!1)})(Xre);var W2={},Yre={get exports(){return W2},set exports(t){W2=t}};const Jre={},Qre=Object.freeze(Object.defineProperty({__proto__:null,default:Jre},Symbol.toStringTag,{value:"Module"})),Zre=_X(Qre);(function(t){(function(e,n,s){var i=256,c=6,l=52,d="random",p=s.pow(i,c),f=s.pow(2,l),m=f*2,_=i-1,y;function v($,G,H){var Z=[];G=G==!0?{entropy:!0}:G||{};var re=R(A(G.entropy?[$,L(n)]:$??O(),3),Z),oe=new I(Z),ae=function(){for(var Ee=oe.g(c),Ce=p,ye=0;Ee<f;)Ee=(Ee+ye)*i,Ce*=i,ye=oe.g(1);for(;Ee>=m;)Ee/=2,Ce/=2,ye>>>=1;return(Ee+ye)/Ce};return ae.int32=function(){return oe.g(4)|0},ae.quick=function(){return oe.g(4)/4294967296},ae.double=ae,R(L(oe.S),n),(G.pass||H||function(Ee,Ce,ye,we){return we&&(we.S&&b(we,oe),Ee.state=function(){return b(oe,{})}),ye?(s[d]=Ee,Ce):Ee})(ae,re,"global"in G?G.global:this==s,G.state)}function I($){var G,H=$.length,Z=this,re=0,oe=Z.i=Z.j=0,ae=Z.S=[];for(H||($=[H++]);re<i;)ae[re]=re++;for(re=0;re<i;re++)ae[re]=ae[oe=_&oe+$[re%H]+(G=ae[re])],ae[oe]=G;(Z.g=function(Ee){for(var Ce,ye=0,we=Z.i,Ae=Z.j,Oe=Z.S;Ee--;)Ce=Oe[we=_&we+1],ye=ye*i+Oe[_&(Oe[we]=Oe[Ae=_&Ae+Ce])+(Oe[Ae]=Ce)];return Z.i=we,Z.j=Ae,ye})(i)}function b($,G){return G.i=$.i,G.j=$.j,G.S=$.S.slice(),G}function A($,G){var H=[],Z=typeof $,re;if(G&&Z=="object")for(re in $)try{H.push(A($[re],G-1))}catch{}return H.length?H:Z=="string"?$:$+"\0"}function R($,G){for(var H=$+"",Z,re=0;re<H.length;)G[_&re]=_&(Z^=G[_&re]*19)+H.charCodeAt(re++);return L(G)}function O(){try{var $;return y&&($=y.randomBytes)?$=$(i):($=new Uint8Array(i),(e.crypto||e.msCrypto).getRandomValues($)),L($)}catch{var G=e.navigator,H=G&&G.plugins;return[+new Date,e,H,e.screen,L(n)]}}function L($){return String.fromCharCode.apply(0,$)}if(R(s.random(),n),t.exports){t.exports=v;try{y=Zre}catch{}}else s["seed"+d]=v})(typeof self<"u"?self:Bi,[],Math)})(Yre);var ese=$2,tse=F2,nse=U2,rse=V2,sse=B2,ose=j2,Bd=W2;Bd.alea=ese;Bd.xor128=tse;Bd.xorwow=nse;Bd.xorshift7=rse;Bd.xor4096=sse;Bd.tychei=ose;var ty=Bd;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pb{constructor(e,n,s,i,c){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const l=c||Math.random();this.random=ty.alea(l.toString())}nextValue(){if(!isNaN(this.nextVal)){const i=this.nextVal;return this.nextVal=NaN,i}let e,n,s=!1;for(;!s;){let i,c,l;do i=2*this.random()-1,c=2*this.random()-1,l=i*i+c*c;while(l>=1||l===0);const d=Math.sqrt(-2*Math.log(l)/l);e=this.mean+this.stdDev*i*d,n=this.mean+this.stdDev*c*d,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class ise{constructor(e,n,s,i){this.alpha=e,this.beta=1/n,this.dtype=s;const c=i||Math.random();this.randu=ty.alea(c.toString()),this.randn=new pb(0,1,s,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,n,s,i,c,l;for(;;){do i=this.randn.nextValue(),l=1+this.c*i;while(l<=0);if(l*=l*l,e=i*i,n=1-.331*e*e,s=.5*e+this.d*(1-l+Math.log(l)),c=this.randu(),c<n||Math.log(c)<s)break}return l=1/this.beta*this.d*l,this.alpha<1&&(l*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(l)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}}class ase{constructor(e=0,n=1,s,i){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=ty.alea(i)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cse(t,e,n=1,s="float32",i){if(n==null&&(n=1),s==null&&(s="float32"),s!=="float32"&&s!=="int32")throw new Error(`Unsupported data type ${s}`);const c=new ise(e,n,s,i),l=cn(t,s);for(let d=0;d<l.values.length;d++)l.values[d]=c.nextValue();return l.toTensor()}const use=pe({randomGamma_:cse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lse(t,e=0,n=1,s,i){if(s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const c=new pb(e,n,s,!1,i),l=cn(t,s);for(let d=0;d<l.values.length;d++)l.values[d]=c.nextValue();return l.toTensor()}const A5=pe({randomNormal_:lse});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dse(t,e,n){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return A5(t,0,1,e,n)}const hse=pe({randomStandardNormal_:dse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pse(t,e=0,n=1,s="float32",i){const c=cn(t,s),l=new ase(e,n,null,i);for(let d=0;d<c.values.length;d++)c.values[d]=l.nextValue();return c.toTensor()}const O5=pe({randomUniform_:pse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bm(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const i={start:t,stop:e,step:n,dtype:s};return _e.runKernel(gR,{},i)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fse(t){const n={x:ne(t,"x","reciprocal")};return _e.runKernel(A_,n)}const mse=pe({reciprocal_:fse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gse(t){const n={x:ne(t,"x","relu")};return _e.runKernel(O_,n)}const ny=pe({relu_:gse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ese(t){const n={x:ne(t,"x","relu6")};return _e.runKernel(x_,n)}const x5=pe({relu6_:Ese});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _se(t,e){const s={x:ne(t,"x","reverse")},i={dims:e};return _e.runKernel(SR,s,i)}const kd=pe({reverse_:_se});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yse(t){const e=ne(t,"x","reverse");return se(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),kd(e,0)}const vse=pe({reverse1d_:yse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sse(t,e){const n=ne(t,"x","reverse");return se(n.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${n.rank}.`),kd(n,e)}const Tse=pe({reverse2d_:Sse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ise(t,e){const n=ne(t,"x","reverse");return se(n.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${n.rank}.`),kd(n,e)}const Cse=pe({reverse3d_:Ise});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wse(t,e){const n=ne(t,"x","reverse");return se(n.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${n.rank}.`),kd(n,e)}const Rse=pe({reverse4d_:wse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bse(t){const n={x:ne(t,"x","round")};return _e.runKernel(k_,n)}const k5=pe({round_:bse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nse(t){const n={x:ne(t,"x","rsqrt","float32")};return _e.runKernel(D_,n)}const Ase=pe({rsqrt_:Nse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ose(t){const n={x:ne(t,"x","selu")};return _e.runKernel(P_,n)}const xse=pe({selu_:Ose});function kse(t,e,n,s,i,c=[1,1],l="NHWC"){const d=ne(t,"x","separableConv2d"),p=ne(e,"depthwiseFilter","separableConv2d"),f=ne(n,"pointwiseFilter","separableConv2d");let m=d,_=!1;if(d.rank===3&&(_=!0,m=ze(d,[1,d.shape[0],d.shape[1],d.shape[2]])),l==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");se(m.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${m.rank}.`),se(p.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${p.rank}.`),se(f.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${p.rank}.`),se(f.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${f.shape[0]}.`),se(f.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${f.shape[1]}.`);const y=p.shape[2],v=p.shape[3];se(f.shape[2]===y*v,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${y*v}, but got ${f.shape[2]}.`);const I=ab(m,p,s,i,l,c),A=J_(I,f,1,"valid",l);return _?ze(A,[A.shape[1],A.shape[2],A.shape[3]]):A}const Dse=pe({separableConv2d_:kse});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Pse(t,e){const n=ne(t,"x","setdiff1d"),s=ne(e,"y","setdiff1d");se(n.dtype===s.dtype,()=>`x and y should have the same dtype, but got x (${n.dtype}) and y (${s.dtype}).`),se(n.rank===1,()=>`x should be 1D tensor, but got x (${n.shape}).`),se(s.rank===1,()=>`y should be 1D tensor, but got y (${s.shape}).`);const i=await n.data(),c=await s.data(),l=new Set(c);let d=0;for(let m=0;m<i.length;m++)l.has(i[m])||d++;const p=new Ls([d],n.dtype),f=new Ls([d],"int32");for(let m=0,_=0;m<i.length;m++)l.has(i[m])||(p.values[_]=i[m],f.values[_]=m,_++);return[p.toTensor(),f.toTensor()]}const Lse=Pse;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mse(t){const n={x:ne(t,"x","sign")};return _e.runKernel($_,n)}const $se=pe({sign_:Mse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fse(t){const n={x:ne(t,"x","sin","float32")};return _e.runKernel(L_,n)}const Use=pe({sin_:Fse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vse(t){const n={x:ne(t,"x","sinh")};return _e.runKernel(M_,n)}const Bse=pe({sinh_:Vse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jse(t,e,n){const s=ne(t,"x","slice1d");return se(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),hn(s,[e],[n])}const Wse=pe({slice1d_:jse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gse(t,e,n){const s=ne(t,"x","slice2d");return se(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),hn(s,e,n)}const zse=pe({slice2d_:Gse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hse(t,e,n){const s=ne(t,"x","slice3d");return se(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),hn(s,e,n)}const Kse=pe({slice3d_:Hse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qse(t,e,n){const s=ne(t,"x","slice4d");return se(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),hn(s,e,n)}const Xse=pe({slice4d_:qse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yse(t,e=-1){const n=ne(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},i={dim:e};return _e.runKernel(AR,s,i)}const Jse=pe({softmax_:Yse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qse(t){se(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return _e.runKernel(Uw,e)}const fb=pe({fft_:Qse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zse(t){se(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return _e.runKernel(zw,e)}const p1=pe({ifft_:Zse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eoe(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const i=ze(t,[n,e]);s=p1(i)}else{const i=[n,2*(e-1)],c=ze(Fm(t),[n,e]),l=ze(q_(t),[n,e]),d=kd(hn(c,[0,1],[n,e-2]),1),p=Vt(kd(hn(l,[0,1],[n,e-2]),1),Wn(-1)),f=Ks([c,d],1),m=Ks([l,p],1),_=ze(fl(f,m),[i[0],i[1]]);s=p1(_)}if(s=Fm(s),t.rank===3&&t.shape[0]!==0){const i=s,c=t.shape[0];s=ze(s,[c,s.shape[0]/c,s.shape[1]]),i.dispose()}return s}const D5=pe({irfft_:eoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function toe(t,e,n=0){const i={x:ne(t,"x","split")},c={numOrSizeSplits:e,axis:n};return _e.runKernel(NR,i,c)}const jm=pe({split_:toe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function noe(t,e){se(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let i;if(e!=null&&e<n){const I=t.shape.map(A=>0),b=t.shape.map(A=>A);b[t.shape.length-1]=e,i=hn(t,I,b),n=e}else if(e!=null&&e>n){const I=t.shape.map(b=>b);I[t.shape.length-1]=e-n,i=Ks([t,xd(I)],t.shape.length-1),n=e}else i=t;const c=cb(i),l=ze(fl(i,c),[s,n]),d=fb(l),p=Math.floor(n/2)+1,f=Fm(d),m=q_(d),_=jm(f,[p,n-p],f.shape.length-1),y=jm(m,[p,n-p],m.shape.length-1),v=i.shape.slice();return v[i.shape.length-1]=p,ze(fl(_[0],y[0]),v)}const mb=pe({rfft_:noe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function roe(t,e){let n=ne(t,"a","squaredDifference"),s=ne(e,"b","squaredDifference");[n,s]=Jr(n,s),Rn(n.shape,s.shape);const i={a:n,b:s},c={};return _e.runKernel(B_,i,c)}const P5=pe({squaredDifference_:roe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function soe(t,e){const n=ne(t,"x","squeeze","string_or_numeric");return ze(n,vl(n.shape,e).newShape)}const Os=pe({squeeze_:soe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ooe(t,e=0){const n=c1(t,"tensors","stack","string_or_numeric");se(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&se(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,i={axis:e};return _e.runKernel(lR,s,i)}const nu=pe({stack_:ooe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(t,e=0){const s={x:ne(t,"x","step")},i={alpha:e};return _e.runKernel(H_,s,i)}const L5=pe({step_:ioe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aoe(t,e,n,s,i=0,c=0,l=0,d=0,p=0){const m={x:ne(t,"x","stridedSlice","string_or_numeric")},_={begin:e,end:n,strides:s,beginMask:i,endMask:c,ellipsisMask:l,newAxisMask:d,shrinkAxisMask:p};return _e.runKernel(LR,m,_)}const coe=pe({stridedSlice_:aoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uoe(t){const n={x:ne(t,"x","tan","float32")};return _e.runKernel(W_,n)}const loe=pe({tan_:uoe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Po(t,e){Up(t);const n=Tl(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Il(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ll(t,e,n){if(Up(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Tl(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Il(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function doe(t,e,n){if(Up(t),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");const s=Tl(t,n);if(s.length!==4&&s.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Il(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hoe(t,e,n){if(Up(t),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");const s=Tl(t,n);if(s.length!==5&&s.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Il(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function poe(t,e,n){if(Up(t),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");const s=Tl(t,n);if(s.length!==6&&s.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||s,Il(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function foe(t,e=1,n=!0){const s=ne(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const i=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${e}`);const c={x:s},l={k:e,sorted:n},[d,p]=_e.runKernel(UR,c,l);return{values:d,indices:p}}const moe=pe({topk_:foe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function goe(t,e=0,n=1,s,i){if(s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const c=new pb(e,n,s,!0,i),l=cn(t,s);for(let d=0;d<l.values.length;d++)l.values[d]=c.nextValue();return l.toTensor()}const Eoe=pe({truncatedNormal_:goe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _oe(t,e=0){const n=ne(t,"x","unique","string_or_numeric");se(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},i={axis:e},[c,l]=_e.runKernel(BR,s,i);return{values:c,indices:l}}const yoe=pe({unique_:_oe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function voe(t,e,n){const s=ne(t,"x","unsortedSegmentSum"),i=ne(e,"segmentIds","unsortedSegmentSum","int32");se(Cp(n),()=>"numSegments must be of dtype int");const c={x:s,segmentIds:i},l={numSegments:n};return _e.runKernel(WR,c,l)}const Soe=pe({unsortedSegmentSum_:voe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Toe(t,e=0){const n=ne(t,"x","unstack","string_or_numeric");se(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},i={axis:e};return _e.runKernel(jR,s,i)}const jd=pe({unstack_:Toe});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ioe(t,e){return hb(t,e,"right")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Coe(t,e=!0,n,s){return _e.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gb(t,e){const n=[];for(let c=0;c<e.length;c++)e[c]&&n.push(c);const s=cn(t,"int32"),i=cn([n.length,t.length],"int32");for(let c=0;c<n.length;c++){const l=s.indexToLoc(n[c]),d=c*t.length;i.values.set(l,d)}return i.toTensor()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function woe(t){const e=ne(t,"condition","whereAsync","bool"),n=await e.data(),s=gb(e.shape,n);return t!==e&&e.dispose(),s}const M5=woe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Roe(t,e,n){const s=ne(t,"tensor","boolMask"),i=ne(e,"mask","boolMask","bool"),c=n??0,l=i.rank,d=s.shape;se(l>0,()=>"mask cannot be scalar"),gi(d.slice(c,c+l),i.shape,"mask's shape must match the first K dimensions of tensor's shape,");let p=1;for(let b=c;b<c+l;b++)p*=d[b];const f=d.slice(0,c).concat([p],d.slice(c+l)),m=ze(s,f),_=ze(i,[-1]),y=await M5(_),v=Os(y,[1]),I=g5(m,v,c);return t!==s&&s.dispose(),e!==i&&i.dispose(),v.dispose(),m.dispose(),_.dispose(),y.dispose(),I}const boe=Roe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Noe(t,e,n,s,i=!0){const c=ne(t,"v","movingAverage"),l=ne(e,"x","movingAverage"),d=ne(n,"decay","movingAverage");jQ(c,l),se(Nr(c.shape,l.shape),()=>"Shape mismatch in v and x");const p=Wn(1),f=An(p,d);let m=Vt(An(l,c),f);if(i){se(s!=null,()=>"When using zeroDebias: true, step is required.");const _=ne(s,"step","movingAverage");m=ar(m,An(p,lb(d,_)))}return mr(c,m)}const Aoe=pe({movingAverage_:Noe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ooe(t,e,n){const s=ne(t,"indices","scatterND","int32"),i=ne(e,"updates","scatterND");X6(i,s,n);const c={indices:s,updates:i},l={shape:n};return _e.runKernel(TR,c,l)}const xoe=pe({scatterND_:Ooe});function koe(t,e,n,s){if(t.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${t.dtype}.`);if(t.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${t.shape}.`);const i=t.rank>0?t.shape[0]:1,c=t.rank>1?t.shape[1]:1;if(n.length!==c)throw new Error(`outputShape has incorrect number of elements:, ${n.length}, should be: ${c}.`);const l=e.size;if(!(e.rank===0||e.rank===1&&l===i))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${i}]`);if(e.dtype!==s.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Doe(t,e,n,s=0){const i=ne(t,"sparseIndices","sparseToDense","int32"),c=ne(e,"sparseValues","sparseToDense","string_or_numeric"),l=ne(s,"defaultValue","sparseToDense",c.dtype);koe(i,c,n,l);const d={sparseIndices:i,sparseValues:c,defaultValue:l},p={outputShape:n};return _e.runKernel(PR,d,p)}const Poe=pe({sparseToDense_:Doe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Loe(t,e){const n=ne(e,"indices","gatherND","int32"),i={params:ne(t,"x","gatherND","string_or_numeric"),indices:n};return _e.runKernel(Gw,i)}const Moe=pe({gatherND_:Loe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $oe(t,e){if(e==null)return t.shape.slice();if(Nr(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Foe(t,e,n,s){const i=ne(t,"x","dropout");if(se(i.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`),se(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Br?i.clone():i;const c=$oe(i,n),l=1-e,d=ar(m5(mr(O5(c,0,1,"float32",s),l)),l);return Vt(i,d)}const Uoe=pe({dropout_:Foe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $5(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function Eb(t,e,n){const s=1-t%2,i=new Float32Array(t);for(let c=0;c<t;++c){const l=2*Math.PI*c/(t+s-1);i[c]=e-n*Math.cos(l)}return Po(i,"float32")}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Voe(t,e,n=1){const s=ne(t,"predictions","inTopK"),i=ne(e,"targets","inTopK");se(s.rank>1,()=>`inTopK() expects the predictions to be of rank 2 or higher, but got ${s.rank}`),se(s.rank-1===i.rank,()=>`predictions rank should be 1 larger than targets rank, but got predictions rank ${s.rank} and targets rank ${i.rank}`),gi(s.shape.slice(0,s.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension.");const c=s.shape[s.shape.length-1];se(n>0&&n<=c,()=>`'k' passed to inTopK() must be > 0 && <= the predictions last dimension (${c}), but got ${n}`);const l=await s.data(),d=await i.data(),[p,f]=[l.length/c,c],m=Ms("bool",p);for(let _=0;_<p;_++){const y=_*f,v=l.subarray(y,y+f),I=[];for(let b=0;b<v.length;b++)I.push({value:v[b],index:b});I.sort((b,A)=>A.value-b.value),m[_]=0;for(let b=0;b<n;b++)if(I[b].index===d[_]){m[_]=1;break}}return t!==s&&s.dispose(),e!==i&&i.dispose(),yc(m,i.shape,"bool")}const Boe=Voe;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function joe(t,e,n,s,i,c="NHWC",l){let d=t;t.rank===3&&(d=ze(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let p=e;p.rank===3&&(p=ze(e,[1,e.shape[0],e.shape[1],e.shape[2]])),se(d.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${d.shape}.`),se(p.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${p.shape}.`),se(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const f=c==="NHWC"?d.shape[3]:d.shape[1],m=c==="NHWC"?p.shape[3]:p.shape[1];se(f===n[2],()=>`Error in conv2dDerFilter: depth of input ${f}) must match input depth in filter (${n[2]}.`),se(m===n[3],()=>`Error in conv2dDerFilter: depth of dy (${m}) must match output depth for filter (${n[3]}).`),Ia("conv2dDerFilter",i,l);const _={x:d,dy:p},y={strides:s,pad:i,dataFormat:c,dimRoundingMode:l,filterShape:n};return _e.runKernel(Iw,_,y)}const Woe=pe({conv2DBackpropFilter_:joe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ry(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return Vt(t,L5(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function sy(t,e){let n=e;const s=G6(t.shape,e.shape);return s.length>0&&(n=Cr(n,s)),ze(n,t.shape)}function oy(t,e,n,s){if(e==="linear")return t;if(e==="relu")return ny(t);if(e==="elu")return d5(t);if(e==="relu6")return x5(t);if(e==="prelu")return N5(t,n);if(e==="leakyrelu")return _5(t,s);if(e==="sigmoid")return Sd(t);throw new Error(`Unknown fused activation ${e}.`)}const iy=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Goe({x:t,filter:e,strides:n,pad:s,dataFormat:i="NHWC",dilations:c=[1,1],dimRoundingMode:l,bias:d,activation:p="linear",preluActivationWeights:f,leakyreluAlpha:m}){if(p=p||"linear",iy(_e.state.gradientDepth,p)===!1){se(i==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${i} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let H=J_(t,e,n,s,i,c,l);return d!=null&&(H=mr(H,d)),oy(H,p,f,m)}const _=ne(t,"x","conv2d","float32"),y=ne(e,"filter","conv2d","float32");let v=_,I=!1;_.rank===3&&(I=!0,v=ze(_,[1,_.shape[0],_.shape[1],_.shape[2]])),se(v.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${v.rank}.`),se(y.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${y.rank}.`),Ia("fused conv2d",s,l);const b=i==="NHWC"?v.shape[3]:v.shape[1];se(y.shape[2]===b,()=>`Error in conv2d: depth of input (${b}) must match input depth for filter ${y.shape[2]}.`),se(ho(n,c),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${c}'`);const A=$s(v.shape,y.shape,n,c,s,l);let R;d!=null&&(R=ne(d,"bias","fused conv2d"),[R]=Jr(R,_),i==="NHWC"?Rn(A.outShape,R.shape):(se(R.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${R.shape.length}.`),se(R.shape.length===0||R.shape[0]===A.outChannels||R.shape[0]===1,()=>`Error in fused conv2d: bias shape (${R.shape}) is not compatible with the number of output channels (${A.outChannels})`)));let O;if(f!=null){const H=f.shape;if(se(H.length<=1||H.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${H.length}.`),H.length===1)se(H[0]===1||H[0]===A.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${H}) is not compatible with the number of output channels (${A.outChannels}).`);else if(H.length===3)try{Rn(H,A.outShape)}catch{const re=`Error in fused conv2d: PReLU activation weights (${H}) is not compatible with the output shape of the conv2d (${A.outShape}).`;throw Error(re)}O=ne(f,"prelu weights","fused conv2d")}const L=(H,Z)=>{se(i==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${i} but only NHWC is currently supported.`);const[re,oe,ae,Ee]=Z,Ce=ry(H,ae,p);se(Um(c),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${c}'`);const ye=u5(oe.shape,Ce,re,n,s),we=Woe(oe,Ce,re.shape,n,s),Ae=[ye,we];if(Ee!=null){const Oe=sy(Ee,Ce);Ae.push(Oe)}return Ae},$={x:v,filter:y,bias:R,preluActivationWeights:O},G={strides:n,pad:s,dataFormat:i,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};return d==null?tu((Z,re,oe)=>{let ae=_e.runKernel(s1,$,G);return oe([re,Z,ae]),I&&(ae=ze(ae,[ae.shape[1],ae.shape[2],ae.shape[3]])),{value:ae,gradFunc:L}})(v,y):tu((Z,re,oe,ae)=>{let Ee=_e.runKernel(s1,$,G);return ae([re,Z,Ee,oe]),I&&(Ee=ze(Ee,[Ee.shape[1],Ee.shape[2],Ee.shape[3]])),{value:Ee,gradFunc:L}})(v,y,R)}const zoe=pe({fusedConv2d_:Goe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hoe(t,e,n,s,i,c=[1,1],l){let d=t;t.rank===3&&(d=ze(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let p=e;p.rank===3&&(p=ze(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const f={x:d,dy:p},m={strides:s,pad:i,dimRoundingMode:l,dilations:c,filterShape:n};return _e.runKernel(Dw,f,m)}const Koe=pe({depthwiseConv2dNativeBackpropFilter_:Hoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qoe(t,e,n,s,i,c=[1,1],l){let d=e,p=!1;e.rank===3&&(p=!0,d=ze(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const f={dy:d,filter:n},m={strides:s,pad:i,dimRoundingMode:l,dilations:c,inputShape:t},_=_e.runKernel(Pw,f,m);return p?ze(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const Xoe=pe({depthwiseConv2dNativeBackpropInput_:qoe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yoe({x:t,filter:e,strides:n,pad:s,dataFormat:i="NHWC",dilations:c=[1,1],dimRoundingMode:l,bias:d,activation:p="linear",preluActivationWeights:f,leakyreluAlpha:m}){if(iy(_e.state.gradientDepth,p)===!1){let G=ab(t,e,n,s,i,c,l);return d!=null&&(G=mr(G,d)),oy(G,p,f,m)}const _=ne(t,"x","depthwiseConv2d","float32"),y=ne(e,"filter","depthwiseConv2d","float32");let v=_,I=!1;_.rank===3&&(I=!0,v=ze(_,[1,_.shape[0],_.shape[1],_.shape[2]])),se(v.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${v.rank}.`),se(y.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${y.rank}.`),se(v.shape[3]===y.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${v.shape[3]}) must match the inChannels dimension in filter ${y.shape[2]}.`),c==null&&(c=[1,1]),se(ho(n,c),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${c}'`),Ia("fused depthwiseConv2d",s,l);const b=$s(v.shape,y.shape,n,c,s,l,!0);let A;d!=null&&(A=ne(d,"bias","fused conv2d"),[A]=Jr(A,_),Rn(b.outShape,A.shape));let R;f!=null&&(R=ne(f,"prelu weights","fused depthwiseConv2d"));const O=(G,H)=>{se(Um(c),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${c}'`);const[Z,re,oe,ae]=H,Ee=ry(G,oe,p),Ce=Xoe(re.shape,Ee,Z,n,s,c,l),ye=Koe(re,Ee,Z.shape,n,s,c,l);if(ae!=null){const we=sy(A,Ee);return[Ce,ye,we]}return[Ce,ye]},L={x:v,filter:y,bias:A,preluActivationWeights:R},$={strides:n,pad:s,dataFormat:i,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};return d==null?tu((H,Z,re)=>{let oe=_e.runKernel(o1,L,$);return re([Z,H,oe]),I&&(oe=ze(oe,[oe.shape[1],oe.shape[2],oe.shape[3]])),{value:oe,gradFunc:O}})(v,y):tu((H,Z,re,oe)=>{let ae=_e.runKernel(o1,L,$);return oe([Z,H,ae,re]),I&&(ae=ze(ae,[ae.shape[1],ae.shape[2],ae.shape[3]])),{value:ae,gradFunc:O}})(v,y,A)}const Joe=pe({fusedDepthwiseConv2d_:Yoe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qoe({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:i,activation:c="linear",preluActivationWeights:l,leakyreluAlpha:d=.2}){if(iy(_e.state.gradientDepth,c)===!1){let Ee=nr(t,e,n,s);return i!=null&&(Ee=mr(Ee,i)),oy(Ee,c,l,d)}let p=ne(t,"a","fused matMul"),f=ne(e,"b","fused matMul");[p,f]=Jr(p,f);const m=n?p.shape[p.rank-2]:p.shape[p.rank-1],_=s?f.shape[f.rank-1]:f.shape[f.rank-2],y=n?p.shape[p.rank-1]:p.shape[p.rank-2],v=s?f.shape[f.rank-2]:f.shape[f.rank-1],I=p.shape.slice(0,-2),b=f.shape.slice(0,-2),A=Pe(I),R=Pe(b);se(m===_,()=>`Error in fused matMul: inner shapes (${m}) and (${_}) of Tensors with shapes ${p.shape} and ${f.shape} and transposeA=${n} and transposeB=${s} must match.`);const L=Rn(p.shape.slice(0,-2),f.shape.slice(0,-2)).concat([y,v]),$=n?ze(p,[A,m,y]):ze(p,[A,y,m]),G=s?ze(f,[R,v,_]):ze(f,[R,_,v]);let H;i!=null&&(H=ne(i,"bias","fused matMul"),[H]=Jr(H,p),Rn(L,H.shape));let Z;l!=null&&(Z=ne(l,"prelu weights","fused matMul"));const re=(Ee,Ce)=>{const[ye,we,Ae,Oe]=Ce,Me=ry(ze(Ee,Ae.shape),Ae,c);let me,Te;if(!n&&!s?(me=nr(Me,we,!1,!0),Te=nr(ye,Me,!0,!1)):!n&&s?(me=nr(Me,we,!1,!1),Te=nr(Me,ye,!0,!1)):n&&!s?(me=nr(we,Me,!1,!0),Te=nr(ye,Me,!1,!1)):(me=nr(we,Me,!0,!0),Te=nr(Me,ye,!0,!0)),i!=null){const ke=sy(Oe,Me);return[me,Te,ke]}else return[me,Te]},oe={a:$,b:G,bias:H,preluActivationWeights:Z},ae={transposeA:n,transposeB:s,activation:c,leakyreluAlpha:d};return i==null?tu((Ce,ye,we)=>{const Ae=_e.runKernel(r1,oe,ae);return we([Ce,ye,Ae]),{value:ze(Ae,L),gradFunc:re}})($,G):tu((Ce,ye,we,Ae)=>{const Oe=_e.runKernel(r1,oe,ae);return Ae([Ce,ye,Oe,we]),{value:ze(Oe,L),gradFunc:re}})($,G,H)}const Zoe=pe({fusedMatMul_:Qoe});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eie=Object.freeze(Object.defineProperty({__proto__:null,conv2d:zoe,depthwiseConv2d:Joe,matMul:Zoe},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tie(t){return Eb(t,.54,.46)}const nie=pe({hammingWindow_:tie});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rie(t){return Eb(t,.5,.5)}const F5=pe({hannWindow_:rie});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sie(t,e,n,s=!1,i=0){let c=0;const l=[];for(;c+e<=t.size;)l.push(hn(t,c,e)),c+=n;if(s)for(;c<t.size;){const d=c+e-t.size,p=Ks([hn(t,c,e-d),Y_([d],i)]);l.push(p),c+=n}return l.length===0?ll([],[0,e]):ze(Ks(l),[l.length,e])}const U5=pe({frame_:sie});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oie(t,e,n,s,i=F5){s==null&&(s=$5(e));const c=U5(t,e,n),l=Vt(c,i(e));return mb(l,s)}const iie=pe({stft_:oie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aie(t,e,n,s,i="bilinear",c=0){const l=ne(t,"image","cropAndResize"),d=ne(e,"boxes","cropAndResize","float32"),p=ne(n,"boxInd","cropAndResize","int32"),f=d.shape[0];se(l.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${l.rank}.`),se(d.rank===2&&d.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${f},4] but had shape ${d.shape}.`),se(p.rank===1&&p.shape[0]===f,()=>`Error in cropAndResize: boxInd must be have size [${f}] but had shape ${d.shape}.`),se(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),se(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),se(i==="bilinear"||i==="nearest",()=>`method must be bilinear or nearest, but was ${i}`);const m={image:l,boxes:d,boxInd:p},_={method:i,extrapolationValue:c,cropSize:s};return _e.runKernel(Aw,m,_)}const cie=pe({cropAndResize_:aie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uie(t){const e=ne(t,"image","flipLeftRight","float32");se(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return _e.runKernel(Bw,n,{})}const lie=pe({flipLeftRight_:uie});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function die(t){const e=ne(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];se(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),se(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const i=new Array(e.rank);return i.fill(1,0,n),i[n]=3,ym(e,i)}const hie=pe({grayscaleToRGB_:die});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pie(t,e,n=0,s=.5){const i=ne(t,"image","rotateWithOffset","float32");se(i.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`);const c={image:i},l={radians:e,fillValue:n,center:s};return _e.runKernel(zR,c,l)}const fie=pe({rotateWithOffset_:pie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bp(t,e,n,s,i,c){s==null&&(s=.5),i==null&&(i=Number.NEGATIVE_INFINITY),c==null&&(c=0);const l=t.shape[0];return n=Math.min(n,l),se(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),se(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),se(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),se(e.rank===1,()=>"scores must be a 1D tensor"),se(e.shape[0]===l,()=>`scores has incompatible shape with boxes. Expected ${l}, but was ${e.shape[0]}`),se(0<=c&&c<=1,()=>`softNmsSigma must be in [0, 1], but was '${c}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:i,softNmsSigma:c}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mie(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY){const c=ne(t,"boxes","nonMaxSuppression","float32"),l=ne(e,"scores","nonMaxSuppression","float32"),d=Bp(c,l,n,s,i);n=d.maxOutputSize,s=d.iouThreshold,i=d.scoreThreshold;const p={maxOutputSize:n,iouThreshold:s,scoreThreshold:i};return _e.runKernel(oR,{boxes:c,scores:l},p)}const gie=pe({nonMaxSuppression_:mie});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eie(t,e,n){const s=_ie(t,e,n),i=s<0?-(s+1):s;t.splice(i,0,e)}function _ie(t,e,n){return vie(t,e,n||yie)}function yie(t,e){return t>e?1:t<e?-1:0}function vie(t,e,n){let s=0,i=t.length,c=0,l=!1;for(;s<i;){c=s+(i-s>>>1);const d=n(e,t[c]);d>0?s=c+1:(i=c,l=!d)}return l?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _b(t,e,n,s,i){return Sb(t,e,n,s,i,0)}function yb(t,e,n,s,i,c){return Sb(t,e,n,s,i,0,!1,c,!0)}function vb(t,e,n,s,i,c){return Sb(t,e,n,s,i,c,!0)}function Sb(t,e,n,s,i,c,l=!1,d=!1,p=!1){const f=[];for(let A=0;A<e.length;A++)e[A]>i&&f.push({score:e[A],boxIndex:A,suppressBeginIndex:0});f.sort(kM);const m=c>0?-.5/c:0,_=[],y=[];for(;_.length<n&&f.length>0;){const A=f.pop(),{score:R,boxIndex:O,suppressBeginIndex:L}=A;if(R<i)break;let $=!1;for(let G=_.length-1;G>=L;--G){const H=Sie(t,O,_[G]);if(H>=s){$=!0;break}if(A.score=A.score*Tie(s,m,H),A.score<=i)break}A.suppressBeginIndex=_.length,$||(A.score===R?(_.push(O),y.push(A.score)):A.score>i&&Eie(f,A,kM))}const v=_.length,I=n-v;d&&I>0&&(_.push(...new Array(I).fill(0)),y.push(...new Array(I).fill(0)));const b={selectedIndices:_};return l&&(b.selectedScores=y),p&&(b.validOutputs=v),b}function Sie(t,e,n){const s=t.subarray(e*4,e*4+4),i=t.subarray(n*4,n*4+4),c=Math.min(s[0],s[2]),l=Math.min(s[1],s[3]),d=Math.max(s[0],s[2]),p=Math.max(s[1],s[3]),f=Math.min(i[0],i[2]),m=Math.min(i[1],i[3]),_=Math.max(i[0],i[2]),y=Math.max(i[1],i[3]),v=(d-c)*(p-l),I=(_-f)*(y-m);if(v<=0||I<=0)return 0;const b=Math.max(c,f),A=Math.max(l,m),R=Math.min(d,_),O=Math.min(p,y),L=Math.max(R-b,0)*Math.max(O-A,0);return L/(v+I-L)}function Tie(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function kM(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Iie(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY){const c=ne(t,"boxes","nonMaxSuppressionAsync"),l=ne(e,"scores","nonMaxSuppressionAsync"),d=Bp(c,l,n,s,i);n=d.maxOutputSize,s=d.iouThreshold,i=d.scoreThreshold;const p=await Promise.all([c.data(),l.data()]),f=p[0],m=p[1],{selectedIndices:_}=_b(f,m,n,s,i);return c!==t&&c.dispose(),l!==e&&l.dispose(),Po(_,"int32")}const Cie=Iie;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wie(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,c=0){const l=ne(t,"boxes","nonMaxSuppression"),d=ne(e,"scores","nonMaxSuppression"),p=Bp(l,d,n,s,i,c);n=p.maxOutputSize,s=p.iouThreshold,i=p.scoreThreshold,c=p.softNmsSigma;const f={boxes:l,scores:d},m={maxOutputSize:n,iouThreshold:s,scoreThreshold:i,softNmsSigma:c},_=_e.runKernel(aR,f,m);return{selectedIndices:_[0],selectedScores:_[1]}}const Rie=pe({nonMaxSuppressionWithScore_:wie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function bie(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,c=0){const l=ne(t,"boxes","nonMaxSuppressionAsync"),d=ne(e,"scores","nonMaxSuppressionAsync"),p=Bp(l,d,n,s,i,c);n=p.maxOutputSize,s=p.iouThreshold,i=p.scoreThreshold,c=p.softNmsSigma;const f=await Promise.all([l.data(),d.data()]),m=f[0],_=f[1],{selectedIndices:y,selectedScores:v}=vb(m,_,n,s,i,c);return l!==t&&l.dispose(),d!==e&&d.dispose(),{selectedIndices:Po(y,"int32"),selectedScores:Po(v)}}const Nie=bie;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aie(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,c=!1){const l=ne(t,"boxes","nonMaxSuppression"),d=ne(e,"scores","nonMaxSuppression"),p=Bp(l,d,n,s,i,null),f=p.maxOutputSize,m=p.iouThreshold,_=p.scoreThreshold,y={boxes:l,scores:d},v={maxOutputSize:f,iouThreshold:m,scoreThreshold:_,padToMaxOutputSize:c},I=_e.runKernel(iR,y,v);return{selectedIndices:I[0],validOutputs:I[1]}}const Oie=pe({nonMaxSuppressionPadded_:Aie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function xie(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,c=!1){const l=ne(t,"boxes","nonMaxSuppressionAsync"),d=ne(e,"scores","nonMaxSuppressionAsync"),p=Bp(l,d,n,s,i,null),f=p.maxOutputSize,m=p.iouThreshold,_=p.scoreThreshold,[y,v]=await Promise.all([l.data(),d.data()]),{selectedIndices:I,validOutputs:b}=yb(y,v,f,m,_,c);return l!==t&&l.dispose(),d!==e&&d.dispose(),{selectedIndices:Po(I,"int32"),validOutputs:Wn(b,"int32")}}const kie=xie;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Die(t,e,n=!1,s=!1){const i=ne(t,"images","resizeBilinear");se(i.rank===3||i.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`),se(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),se(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let c=i,l=!1;i.rank===3&&(l=!0,c=ze(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const d={images:c},p={alignCorners:n,halfPixelCenters:s,size:e},f=_e.runKernel(vR,d,p);return l?ze(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Pie=pe({resizeBilinear_:Die});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lie(t,e,n=!1,s=!1){const i=ne(t,"images","resizeNearestNeighbor");se(i.rank===3||i.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`),se(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),se(i.dtype==="float32"||i.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),se(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let c=i,l=!1;i.rank===3&&(l=!0,c=ze(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const d={images:c},p={alignCorners:n,halfPixelCenters:s,size:e},f=_e.runKernel(yR,d,p);return l?ze(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const Mie=pe({resizeNearestNeighbor_:Lie});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ie(t,e="binary",n=!1,s=.5){const i=ne(t,"image","threshold"),c=.2989,l=.587,d=.114,p=i.shape[0]*i.shape[1];let f=Vt(Po([s]),255),m,_,y,v;if(se(i.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${i.rank}.`),se(i.shape[2]===3||i.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${i.shape[2]}.`),se(i.dtype==="int32"||i.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${i.dtype}.`),se(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),i.shape[2]===3){[m,_,y]=jm(i,[1,1,1],-1);const A=Vt(m,c),R=Vt(_,l),O=Vt(y,d);v=mr(mr(A,R),O)}else v=t;if(e==="otsu"){const A=a5(jr(k5(v),"int32"),yc([]),256);f=Fie(A,p)}const I=n?db(v,f):ey(v,f);return jr(Vt(I,255),"int32")}function Fie(t,e){let n=Po([-1]),s=Po([0]),i=Po([0]),c,l,d,p,f,m;for(let _=0;_<t.size-1;_++){c=hn(t,0,_+1),l=hn(t,_+1),f=ar(Cr(c),e),m=ar(Cr(l),e);const y=Cr(Vt(c,Bm(0,c.size)));d=ar(y,Cr(c));const v=Y_(l.shape,c.size),I=mr(Bm(0,l.size),v),b=Vt(l,I);p=ar(Cr(b),Cr(l));const A=An(d,p),R=An(d,p),O=Vt(f,m);i=Vt(Vt(O,A),R);const L=ey(i,s);s=Ap(L,i,s),n=Ap(L,Po([_]),n)}return n}const Uie=pe({threshold_:$ie});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vie(t,e,n="nearest",s="constant",i=0,c){const l=ne(t,"image","transform","float32"),d=ne(e,"transforms","transform","float32");se(l.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${l.rank}.`),se(d.rank===2&&(d.shape[0]===l.shape[0]||d.shape[0]===1)&&d.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),se(c==null||c.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${c}.`);const p={image:l,transforms:d},f={interpolation:n,fillMode:s,fillValue:i,outputShape:c};return _e.runKernel(VR,p,f)}const Bie=pe({transform_:Vie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jie(t,e,n){se(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),se(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`);const s=ne(t,"a","bandPart");se(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const i=s.shape,[c,l]=s.shape.slice(-2);if(!(e<=c))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${c}).`);if(!(n<=l))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${l}).`);e<0&&(e=c),n<0&&(n=l);const d=ze(Bm(0,c,1,"int32"),[-1,1]),p=Bm(0,l,1,"int32"),f=An(d,p),m=d1(db(f,Wn(+e,"int32")),E5(f,Wn(-n,"int32"))),_=xd([c,l],s.dtype);return ze(nu(jd(ze(s,[-1,c,l])).map(y=>Ap(m,y,_))),i)}const Wie=pe({bandPart_:jie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gie(t){let e;if(Array.isArray(t)){e=!1,se(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const i=t[0].shape[0];for(let c=1;c<t.length;++c)se(t[c].shape[0]===i,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[c].shape[0]} vs. ${i})`)}else e=!0,t=jm(t,t.shape[0],0).map(i=>Os(i,[0]));se(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let i=0;i<t.length;++i)n.push(_e.tidy(()=>{let c=s[i];if(i>0)for(let l=0;l<i;++l){const d=Vt(Cr(Vt(n[l],c)),n[l]);c=An(c,d)}return ar(c,Z_(c,"euclidean"))}));return e?nu(n,0):n}const zie=pe({gramSchmidt_:Gie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hie(t,e=!1){if(se(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return DM(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((p,f)=>p*f),s=jd(ze(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],c=[];s.forEach(p=>{const[f,m]=DM(p,e);i.push(f),c.push(m)});const l=ze(nu(i,0),t.shape),d=ze(nu(c,0),t.shape);return[l,d]}}function DM(t,e=!1){return _e.tidy(()=>{se(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let i=f5(n),c=ul(t);const l=ll([[1]],[1,1]);let d=ul(l);const p=n>=s?s:n;for(let f=0;f<p;++f){const m=c,_=d,y=i;[d,c,i]=_e.tidy(()=>{const v=hn(c,[f,f],[n-f,1]),I=Z_(v),b=hn(c,[f,f],[1,1]),A=Ap(ey(b,0),ll([[-1]]),ll([[1]])),R=An(b,Vt(A,I)),O=ar(v,R);O.shape[0]===1?d=ul(l):d=Ks([l,hn(O,[1,0],[O.shape[0]-1,O.shape[1]])],0);const L=Xc(ar(nr(A,R),I)),$=hn(c,[f,0],[n-f,s]),G=Vt(L,d),H=x2(d);if(f===0)c=An($,nr(G,nr(H,$)));else{const oe=An($,nr(G,nr(H,$)));c=Ks([hn(c,[0,0],[f,s]),oe],0)}const Z=x2(G),re=hn(i,[0,f],[n,i.shape[1]-f]);if(f===0)i=An(re,nr(nr(re,d),Z));else{const oe=An(re,nr(nr(re,d),Z));i=Ks([hn(i,[0,0],[n,f]),oe],1)}return[d,c,i]}),mc([m,_,y])}return!e&&n>s&&(i=hn(i,[0,0],[n,s]),c=hn(c,[0,0],[s,s])),[i,c]})}const Kie=pe({qr_:Hie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Go;(function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Go||(Go={}));function qie(t,e,n=Go.SUM_BY_NONZERO_WEIGHTS){const s=ne(t,"losses","computeWeightedLoss");let i=null;e!=null&&(i=ne(e,"weights","computeWeightedLoss"));const c=i==null?s:Vt(s,i);if(n===Go.NONE)return c;if(n===Go.SUM)return Cr(c);if(n===Go.MEAN){if(i==null)return h1(c);{const l=s.size/i.size,d=ar(Cr(c),Cr(i));return l>1?ar(d,Wn(l)):d}}if(n===Go.SUM_BY_NONZERO_WEIGHTS){if(i==null)return ar(Cr(c),Wn(s.size));{const l=Vt(i,md(s.shape)),d=jr(Cr(R5(l,Wn(0))),"float32");return ar(Cr(c),d)}}throw Error(`Unknown reduction: ${n}`)}const uu=pe({computeWeightedLoss_:qie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xie(t,e,n,s=Go.SUM_BY_NONZERO_WEIGHTS){const i=ne(t,"labels","absoluteDifference"),c=ne(e,"predictions","absoluteDifference");let l=null;n!=null&&(l=ne(n,"weights","absoluteDifference")),gi(i.shape,c.shape,"Error in absoluteDifference: ");const d=ca(An(i,c));return uu(d,l,s)}const Yie=pe({absoluteDifference_:Xie});function Jie(t,e,n,s,i=Go.SUM_BY_NONZERO_WEIGHTS){const c=ne(t,"labels","cosineDistance"),l=ne(e,"predictions","cosineDistance");let d=null;s!=null&&(d=ne(s,"weights","cosineDistance")),gi(c.shape,l.shape,"Error in cosineDistance: ");const p=Wn(1),f=An(p,Cr(Vt(c,l),n,!0));return uu(f,d,i)}const Qie=pe({cosineDistance_:Jie});function Zie(t,e,n,s=Go.SUM_BY_NONZERO_WEIGHTS){let i=ne(t,"labels","hingeLoss");const c=ne(e,"predictions","hingeLoss");let l=null;n!=null&&(l=ne(n,"weights","hingeLoss")),gi(i.shape,c.shape,"Error in hingeLoss: ");const d=Wn(1);i=An(Vt(Wn(2),i),d);const p=ny(An(d,Vt(i,c)));return uu(p,l,s)}const eae=pe({hingeLoss_:Zie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tae(t,e,n,s=1,i=Go.SUM_BY_NONZERO_WEIGHTS){const c=ne(t,"labels","huberLoss"),l=ne(e,"predictions","huberLoss");let d=null;n!=null&&(d=ne(n,"weights","huberLoss")),gi(c.shape,l.shape,"Error in huberLoss: ");const p=Wn(s),f=ca(An(l,c)),m=w5(f,p),_=An(f,m),y=mr(Vt(Wn(.5),Q_(m)),Vt(p,_));return uu(y,d,i)}const nae=pe({huberLoss_:tae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rae(t,e,n,s=1e-7,i=Go.SUM_BY_NONZERO_WEIGHTS){const c=ne(t,"labels","logLoss"),l=ne(e,"predictions","logLoss");let d=null;n!=null&&(d=ne(n,"weights","logLoss")),gi(c.shape,l.shape,"Error in logLoss: ");const p=Wn(1),f=Wn(s),m=Xc(Vt(c,Vm(mr(l,f)))),_=Vt(An(p,c),Vm(mr(An(p,l),f))),y=An(m,_);return uu(y,d,i)}const sae=pe({logLoss_:rae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oae(t,e,n,s=Go.SUM_BY_NONZERO_WEIGHTS){const i=ne(t,"labels","meanSquaredError"),c=ne(e,"predictions","meanSquaredError");let l=null;n!=null&&(l=ne(n,"weights","meanSquaredError")),gi(i.shape,c.shape,"Error in meanSquaredError: ");const d=P5(i,c);return uu(d,l,s)}const iae=pe({meanSquaredError_:oae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aae(t,e){const n=ne(t,"labels","sigmoidCrossEntropyWithLogits"),s=ne(e,"logits","sigmoidCrossEntropyWithLogits");gi(n.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=ny(s),c=Vt(s,n),l=y5(eu(Xc(ca(s))));return mr(An(i,c),l)}function cae(t,e,n,s=0,i=Go.SUM_BY_NONZERO_WEIGHTS){let c=ne(t,"multiClassLabels","sigmoidCrossEntropy");const l=ne(e,"logits","sigmoidCrossEntropy");let d=null;if(n!=null&&(d=ne(n,"weights","sigmoidCrossEntropy")),gi(c.shape,l.shape,"Error in sigmoidCrossEntropy: "),s>0){const f=Wn(s),m=Wn(1),_=Wn(.5);c=mr(Vt(c,An(m,f)),Vt(_,f))}const p=aae(c,l);return uu(p,d,i)}const uae=pe({sigmoidCrossEntropy_:cae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lae(t,e,n=-1){if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);return tu((i,c,l)=>{const p=S5(c,[n],!0),f=An(jr(c,"float32"),p);l([i,f]);const m=Xc(Vt(f,i));return{value:Cr(m,[n]),gradFunc:(v,I)=>{const[b,A]=I,R=Cs(v.shape,[n]);return[Vt(ze(v,R),An(jr(b,"float32"),eu(A))),Vt(ze(v,R),An(eu(A),jr(b,"float32")))]}}})(t,e)}function dae(t,e,n,s=0,i=Go.SUM_BY_NONZERO_WEIGHTS){let c=ne(t,"onehotLabels","softmaxCrossEntropy");const l=ne(e,"logits","softmaxCrossEntropy");let d=null;if(n!=null&&(d=ne(n,"weights","softmaxCrossEntropy")),gi(c.shape,l.shape,"Error in softmaxCrossEntropy: "),s>0){const f=Wn(s),m=Wn(1),_=Wn(c.shape[1]);c=mr(Vt(c,An(m,f)),ar(f,_))}const p=lae(c,l);return uu(p,d,i)}const hae=pe({softmaxCrossEntropy_:dae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pae(t,e,n,s){const i=ne(t,"indices","sparseFillEmptyRows","int32"),c=ne(e,"values","sparseFillEmptyRows"),l=ne(n,"denseShape","sparseFillEmptyRows","int32"),d=ne(s,"defaultValue","sparseFillEmptyRows",c.dtype);if(i.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${i.shape}`);if(c.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${c.shape}`);if(l.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${l.shape}`);if(d.rank!==0)throw new Error(`Default value should be a scalar but received shape ${d.shape}`);const p={indices:i,values:c,denseShape:l,defaultValue:d},f=_e.runKernel(OR,p);return{outputIndices:f[0],outputValues:f[1],emptyRowIndicator:f[2],reverseIndexMap:f[3]}}const fae=pe({sparseFillEmptyRows_:pae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mae(t,e,n){const s=ne(t,"inputIndices","sparseReshape","int32"),i=ne(e,"inputShape","sparseReshape","int32"),c=ne(n,"newShape","sparseReshape","int32");if(s.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${s.shape}`);if(i.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${i.shape}`);if(c.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${c.shape}`);const l={inputIndices:s,inputShape:i,newShape:c},d=_e.runKernel(xR,l);return{outputIndices:d[0],outputShape:d[1]}}const gae=pe({sparseReshape_:mae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eae(t,e,n){const s=ne(t,"data","sparseSegmentMean"),i=ne(e,"indices","sparseSegmentMean","int32"),c=ne(n,"segmentIds","sparseSegmentMean","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${i.shape}`);if(c.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${c.shape}`);const l={data:s,indices:i,segmentIds:c};return _e.runKernel(kR,l)}const _ae=pe({sparseSegmentMean_:Eae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yae(t,e,n){const s=ne(t,"data","sparseSegmentSum"),i=ne(e,"indices","sparseSegmentSum","int32"),c=ne(n,"segmentIds","sparseSegmentSum","int32");if(s.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${i.shape}`);if(c.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${c.shape}`);const l={data:s,indices:i,segmentIds:c};return _e.runKernel(DR,l)}const vae=pe({sparseSegmentSum_:yae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sae(t,e,n,s,i,c,l,d){const p=ne(t,"data","stringNGrams","string");if(p.dtype!=="string")throw new Error("Data must be of datatype string");if(p.shape.length!==1)throw new Error(`Data must be a vector, saw: ${p.shape}`);const f=ne(e,"dataSplits","stringNGrams");if(f.dtype!=="int32")throw new Error("Data splits must be of datatype int32");const m={separator:n,nGramWidths:s,leftPad:i,rightPad:c,padWidth:l,preserveShortSequences:d},_={data:p,dataSplits:f},y=_e.runKernel(MR,_,m);return{nGrams:y[0],nGramsSplits:y[1]}}const Tae=pe({stringNGrams_:Sae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iae(t,e,n=!0){const s=ne(t,"input","stringSplit","string"),i=ne(e,"delimiter","stringSplit","string");if(s.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${s.shape}`);if(i.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${i.shape}`);const c={skipEmpty:n},l={input:s,delimiter:i},d=_e.runKernel($R,l,c);return{indices:d[0],values:d[1],shape:d[2]}}const Cae=pe({stringSplit_:Iae});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wae(t,e){const n=ne(t,"input","stringToHashBucketFast","string"),s={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");const i={input:n};return _e.runKernel(FR,i,s)}const Rae=pe({stringToHashBucketFast_:wae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bae={fft:fb,ifft:p1,rfft:mb,irfft:D5},Nae={hammingWindow:nie,hannWindow:F5,frame:U5,stft:iie},jp={flipLeftRight:lie,grayscaleToRGB:hie,resizeNearestNeighbor:Mie,resizeBilinear:Pie,rotateWithOffset:fie,cropAndResize:cie,nonMaxSuppression:gie,nonMaxSuppressionAsync:Cie,nonMaxSuppressionWithScore:Rie,nonMaxSuppressionWithScoreAsync:Nie,nonMaxSuppressionPadded:Oie,nonMaxSuppressionPaddedAsync:kie,threshold:Uie,transform:Bie},Aae={bandPart:Wie,gramSchmidt:zie,qr:Kie},Oae={absoluteDifference:Yie,computeWeightedLoss:uu,cosineDistance:Qie,hingeLoss:eae,huberLoss:nae,logLoss:sae,meanSquaredError:iae,sigmoidCrossEntropy:uae,softmaxCrossEntropy:hae},xae={sparseFillEmptyRows:fae,sparseReshape:gae,sparseSegmentMean:_ae,sparseSegmentSum:vae},kae={stringNGrams:Tae,stringSplit:Cae,stringToHashBucketFast:Rae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dae=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t())();function Pae(){return new Promise(t=>Dae(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tb(t,e){const n=t[0].length;t.forEach((i,c)=>{se(i.length===n,()=>`Error in concat${n}D: rank of tensors[${c}] must be the same as the rank of the rest (${n})`)}),se(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((i,c)=>{for(let l=0;l<n;l++)se(l===e||i[l]===s[l],()=>`Error in concat${n}D: Shape of tensors[${c}] (${i}) does not match the shape of the rest (${s}) along the non-concatenated axis ${c}.`)})}function vc(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ja;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(ja||(ja={}));function V5(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let i=1;i<n.length;++i){const c=n[i],l=s[s.length-n.length+i],d=s[l];if(c>=0)if(d>=0){if(d!==c)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${i+t}] = ${c} but shape[${i+t}] = ${d}`)}else s[l]=c}return s}function B5(t){const e={FIRST_DIM_SIZE:ja.FIRST_DIM_SIZE,VALUE_ROWIDS:ja.VALUE_ROWIDS,ROW_LENGTHS:ja.ROW_LENGTHS,ROW_SPLITS:ja.ROW_SPLITS,ROW_LIMITS:ja.ROW_LIMITS,ROW_STARTS:ja.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function j5(t){return t.length===0?0:t[0]===ja.FIRST_DIM_SIZE?t.length-1:t.length}function W5(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let i=0;i<Math.min(n,s-1);++i){const c=t[i],l=e[i+1];if(c>=0&&l>=0&&c!==1&&c!==l)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${i-t.length}] = ${c} but ragged tensor input.flatValues.shape[${i-t.length}] = ${l}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ib=30;function ay(t){return t<=Ib?t:m2(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cb(t,e,n){const s=n*(typeof t=="number"?t:t[0]),i=e*(typeof t=="number"?t:t[1]);return[s,i]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ig(t,e,n,s=!0){let i=[];if(s)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);const c=e.length;for(let l=0;l<c;++l)i=i.concat([t[l+1]/e[l],e[l]]);i=i.concat(t.slice(c+1))}return i}function ag(t,e,n=!0){const s=[];if(n){s.push(e);for(let i=e+1;i<t;++i)i<=2*e?(s.push(i),s.push(i-(e+1))):s.push(i)}else{const i=[],c=[];for(let l=1;l<t;++l)l>=e*2+1||l%2===1?c.push(l):i.push(l);s.push(...i),s.push(0),s.push(...c)}return s}function cg(t,e,n,s=!0){const i=[];s?i.push(t[0]/n):i.push(t[0]*n);for(let c=1;c<t.length;++c)c<=e.length?s?i.push(e[c-1]*t[c]):i.push(t[c]/e[c-1]):i.push(t[c]);return i}function wb(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function Rb(t,e,n){const s=t.slice(0,1);for(let i=0;i<n;++i)s.push(t[i+1]-e[i][0]-e[i][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bb=1.7580993408473768,Nb=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ab=.3275911,Ob=.254829592,xb=-.284496736,kb=1.421413741,Db=-1.453152027,Pb=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ru(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function G5(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function z5(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let i=0;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],s[Math.floor(i/4)]=t[i+1];return{real:n,imag:s}}function H5(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let i=2;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],s[Math.floor(i/4)]=t[i+1];return{real:n,imag:s}}function Lb(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function K5(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function q5(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let i=0;i<Math.ceil(t/2);i++){const c=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(c),s[i]=Math.sin(c)}return{real:n,imag:s}}function X5(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),i=Math.cos(s),c=Math.sin(s);return{real:i,imag:c}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZT="->",Lae=/->/g,PM=",",LM="...";function Mb(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(Lae,"").length)/ZT.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${ZT}").`);const[s,i]=t.split(ZT);se(s.indexOf(LM)===-1,()=>`The ellipsis notation ("${LM}") is not supported yet.`);const c=s.split(PM),l=c.length;if(e!==l)throw new Error(`Expected ${l} input tensors, received ${e}`);if(l>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const d=[];for(let y=0;y<i.length;++y){const v=i[y];if(!c.some(I=>I.indexOf(v)!==-1))throw new Error(`Output subscripts contain the label ${v} not present in the input subscripts.`);d.indexOf(v)===-1&&d.push(v)}for(let y=0;y<s.length;++y){const v=s[y];d.indexOf(v)===-1&&v!==PM&&d.push(v)}const p=new Array(c.length);for(let y=0;y<l;++y){if(new Set(c[y].split("")).size!==c[y].length)throw new Error(`Found duplicate axes in input component ${c[y]}. Support for duplicate axes in input is not implemented yet.`);p[y]=[];for(let v=0;v<c[y].length;++v)p[y].push(d.indexOf(c[y][v]))}const f=d.length,m=i.length,_=[];for(let y=m;y<f;++y)_.push(y);return{allDims:d,summedDims:_,idDims:p}}function $b(t,e){let n=new Array(t);n.fill(-1);for(let i=0;i<e.length;++i)n[e[i]]=i;const s=[];for(let i=0;i<t;++i)n[i]===-1&&s.push(i);return n=n.filter(i=>i!==-1),{permutationIndices:n,expandDims:s}}function Fb(t,e,n){const s=new Array(t);for(let i=0;i<n.length;++i){const c=n[i].shape;for(let l=0;l<e[i].length;++l)s[e[i][l]]===void 0?s[e[i][l]]=c[l]:se(s[e[i][l]]===c[l],()=>`Expected dimension ${s[e[i][l]]} at axis ${l} of input shaped ${JSON.stringify(c)}, but got dimension ${c[l]}`)}}function Ub(t,e){const n=t,s=[];let i=0;t.length===0&&n.push(-1),i=t.length+1;for(let l=0;l<i;++l)s.push([]);const c=[];for(let l=0;l<n.length;++l){const d=n[l],p=Mae(e,d);for(const f of p)c.indexOf(f)===-1&&(s[l].push(f),c.push(f))}return{path:n,steps:s}}function Vb(t){return t.every((e,n)=>e===n)}function Mae(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function Bb(t,e,n=0){let s=[];if(typeof e=="number")se(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const i=e.reduce((l,d)=>(d===-1&&(l+=1),l),0);se(i<=1,()=>"There should be only one negative value in split array.");const c=e.indexOf(-1);if(c!==-1){const l=e.reduce((d,p)=>p>0?d+p:d);e[c]=t.shape[n]-l}se(t.shape[n]===e.reduce((l,d)=>l+d),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y5(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function J5(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function Q5(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z5(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function eV(t,e){return`size ${t} must be non-negative, not ${e}`}function tV(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function nV(t,e){const n=Pe(t),s=Pe(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function rV(t,e){const n=Pe(t),s=Pe(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G2(){return"segment ids must be >= 0"}function sV(){return"segment ids are not increasing"}function oV(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function iV(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aV(t,e){let n=!1,s;for(t<=Ib?(s=t,n=!0):s=m2(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=m2(t,s+1);return s}function cV(t,e,n){const s=[],i=t.length;for(let c=0;c<i;c++)c!==e?s.push(t[c]):s.push(n);return s}function jb(t,e,n,s){const i=e.shape.length,c=t.shape.length;if(s!==0&&(s<-i||s>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${s}`);if(s<0&&(s+=i),s>c)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${c}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let _=0;_<s;++_)if(t.shape[_]!==e.shape[_])throw new Error(`x.shape[${_}]: ${t.shape[_]} should be equal to indices.shape[${_}]: ${e.shape[_]}.`);const l=t.shape[n],d=[];let p=1,f=1,m=1;for(let _=0;_<s;++_)d.push(t.shape[_]),p*=t.shape[_];for(let _=s;_<n;_++)d.push(t.shape[_]),f*=t.shape[_];for(let _=s;_<i;_++)d.push(e.shape[_]);for(let _=n+1;_<c;_++)d.push(t.shape[_]),m*=t.shape[_];return{batchSize:p,sliceSize:m,outerSize:f,dimSize:l,outputShape:d}}const $ae=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:jb,computeOutShape:cV,segOpComputeOptimalWindowSize:aV},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dd(t){try{return t.map(e=>pl(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function uV(t){return t.map(e=>cl(e))}const Fae=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:Ob,ERF_A2:xb,ERF_A3:kb,ERF_A4:Db,ERF_A5:Pb,ERF_P:Ab,PARALLELIZE_THRESHOLD:Ib,get RowPartitionType(){return ja},SELU_SCALE:Nb,SELU_SCALEALPHA:bb,applyActivation:oy,assertAndGetBroadcastShape:Rn,assertAxesAreInnerMostDims:Xs,assertParamsConsistent:Tb,assignToTypedArray:K5,axesAreInnerMostDims:ub,calculateShapes:ng,checkEinsumDimSizes:Fb,checkPadOnDimRoundingMode:Ia,combineLocations:h5,combineRaggedTensorToTensorShapes:V5,complexWithEvenIndex:z5,complexWithOddIndex:H5,computeConv2DInfo:$s,computeConv3DInfo:Cl,computeDefaultPad:ib,computeDilation2DInfo:rg,computeOptimalWindowSize:ay,computeOutAndReduceShapes:qs,computeOutShape:vc,computePool2DInfo:Ta,computePool3DInfo:au,convertConv2DDataFormat:cu,decodeEinsumEquation:Mb,eitherStridesOrDilationsAreOne:ho,expandShapeToKeepDim:Cs,exponent:X5,exponents:q5,fromStringArrayToUint8:uV,fromUint8ToStringArray:Dd,getAxesPermutation:ss,getBroadcastDims:Np,getComplexWithIndex:Lb,getEinsumComputePath:Ub,getEinsumPermutation:$b,getFusedBiasGradient:sy,getFusedDyActivation:ry,getImageCenter:Cb,getInnerMostAxes:os,getPermuted:ag,getRaggedRank:j5,getReductionAxes:G6,getReshaped:ig,getReshapedPermuted:cg,getRowPartitionTypesHelper:B5,getSliceBeginCoords:wb,getSliceSize:Rb,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Y5,getSparseFillEmptyRowsNegativeIndexErrorMessage:J5,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Q5,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:tV,getSparseReshapeInputOutputMismatchErrorMessage:rV,getSparseReshapeInputOutputMultipleErrorMessage:nV,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:Z5,getSparseReshapeNegativeOutputDimErrorMessage:eV,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:iV,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:G2,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:sV,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:oV,getUndoAxesPermutation:sg,isIdentityPermutation:Vb,log:SQ,mergeRealAndImagArrays:ru,prepareAndValidate:ZR,prepareSplitSize:Bb,segment_util:$ae,shouldFuse:iy,slice_util:tee,splitRealAndImagArrays:G5,tupleValuesAreOne:Um,upcastType:pi,validateDefaultValueShape:W5,validateInput:X6,validateUpdateShape:q6,warn:ha},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uae=De();Uae.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var aa;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(aa||(aa={}));var MM;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(MM||(MM={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vae={};function lV(t){return Vae[t]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j(t,e,n,s,i){const c=e.inputParams[t];if(c&&c.inputIndexStart!==void 0){const d=c.inputIndexStart,p=c.inputIndexEnd===0?void 0:c.inputIndexEnd===void 0?d+1:c.inputIndexEnd;if(c.type==="tensor")return ko(e.inputNames[c.inputIndexStart],n,s,i);if(c.type==="tensors")return e.inputNames.slice(d,p).map(y=>ko(y,n,s,i));const f=ko(e.inputNames.slice(d)[0],n,s,i),m=f.dataSync();return c.type==="number"?m[0]:ya(f.shape,m)}const l=e.attrParams[t];return l&&l.value}function ko(t,e,n,s){const[i,c]=oi(t);if(s!=null){const d=s.getHashTableHandleByName(i);if(d!=null)return d}const l=n.currentContextIds.find(d=>!!e[f1(i,d)]);return l!==void 0?e[f1(i,l)][c]:void 0}function Bae(t,e,n){return e[f1(t,n.currentContextId)]}function pc(t,e){const[n,s,i]=oi(t);return[f1(n,e&&e.currentContextId),s,i]}function f1(t,e){return e?`${t}-${e}`:t}function oi(t){const e=t.split(":");if(e.length===1)return[t,0,void 0];const n=e[0],s=e.length===3?e[1]:void 0,i=Number(e[e.length-1]);return[n,i,s]}function x0(t,e,n){let s=j("pad",t,e,n);if(s==="explicit"){s=j("explicitPaddings",t,e,n);const i=[[0,0],[0,0],[0,0],[0,0]];for(let c=0;c<4;c++)i[c][0]=s[c*2],i[c][1]=s[c*2+1];return i}return s}function Bc(t){return t.kept?t:ul(t)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jae=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Wae=Object.freeze(Object.defineProperty({__proto__:null,json:jae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gae=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],zae=Object.freeze(Object.defineProperty({__proto__:null,json:Gae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hae=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],Kae=Object.freeze(Object.defineProperty({__proto__:null,json:Hae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qae=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],Xae=Object.freeze(Object.defineProperty({__proto__:null,json:qae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yae=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],Jae=Object.freeze(Object.defineProperty({__proto__:null,json:Yae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qae=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Zae=Object.freeze(Object.defineProperty({__proto__:null,json:Qae},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ece=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],tce=Object.freeze(Object.defineProperty({__proto__:null,json:ece},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nce=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],rce=Object.freeze(Object.defineProperty({__proto__:null,json:nce},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sce=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}],oce=Object.freeze(Object.defineProperty({__proto__:null,json:sce},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ice=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],ace=Object.freeze(Object.defineProperty({__proto__:null,json:ice},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cce=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],uce=Object.freeze(Object.defineProperty({__proto__:null,json:cce},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lce=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],dce=Object.freeze(Object.defineProperty({__proto__:null,json:lce},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hce=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],pce=Object.freeze(Object.defineProperty({__proto__:null,json:hce},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fce=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],mce=Object.freeze(Object.defineProperty({__proto__:null,json:fce},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gce=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],Ece=Object.freeze(Object.defineProperty({__proto__:null,json:gce},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ce=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],yce=Object.freeze(Object.defineProperty({__proto__:null,json:_ce},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vce=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Sce=Object.freeze(Object.defineProperty({__proto__:null,json:vce},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tce=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Ice=Object.freeze(Object.defineProperty({__proto__:null,json:Tce},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cce=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],wce=Object.freeze(Object.defineProperty({__proto__:null,json:Cce},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $M{static get Instance(){return this._instance||(this._instance=new this)}constructor(){const e=[Wae,zae,Kae,Xae,Jae,Zae,tce,rce,oce,ace,uce,dce,pce,mce,Ece,yce,Sce,Ice,wce],n=[].concat(...e.map(s=>s.json));this.opMappers=n.reduce((s,i)=>(s[i.tfOpName]=i,s),{})}transformGraph(e,n={}){const s=e.node,i=[],c=[],l=[],d=s.reduce((b,A)=>(b[A.name]=this.mapNode(A),A.op.startsWith("Placeholder")?i.push(b[A.name]):A.op==="Const"?c.push(b[A.name]):(A.input==null||A.input.length===0)&&l.push(b[A.name]),b),{});let p=[];const f=[];let m={},_={};n!=null&&(m=this.mapSignatureEntries(n.inputs),_=this.mapSignatureEntries(n.outputs));const y=Object.keys(d);y.forEach(b=>{const A=d[b];A.inputNames.forEach((R,O)=>{const[L,,$]=pc(R),G=d[L];if(G.outputs!=null){const H=G.outputs.indexOf($);if(H!==-1){const Z=`${L}:${H}`;A.inputNames[O]=Z}}A.inputs.push(G),G.children.push(A)})}),Object.keys(_).length===0?y.forEach(b=>{const A=d[b];A.children.length===0&&f.push(A)}):Object.keys(_).forEach(b=>{const[A]=pc(b),R=d[A];R!=null&&(R.signatureKey=_[b],f.push(R))}),Object.keys(m).length>0?Object.keys(m).forEach(b=>{const[A]=pc(b),R=d[A];R&&(R.signatureKey=m[b],p.push(R))}):p=i;let v={};e.library!=null&&e.library.function!=null&&(v=e.library.function.reduce((b,A)=>(b[A.signature.name]=this.mapFunction(A),b),{}));const I={nodes:d,inputs:p,outputs:f,weights:c,placeholders:i,signature:n,functions:v};return l.length>0&&(I.initNodes=l),I}mapSignatureEntries(e){return Object.keys(e||{}).reduce((n,s)=>(n[e[s].name]=s,n),{})}mapNode(e){const n=lV(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});const s={name:e.name,op:e.op,category:n.category,inputNames:(e.input||[]).map(i=>i.startsWith("^")?i.slice(1):i),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:n.outputs};return n.inputs!=null&&(s.inputParams=n.inputs.reduce((i,c)=>(i[c.name]={type:c.type,inputIndexStart:c.start,inputIndexEnd:c.end},i),{})),n.attrs!=null&&(s.attrParams=n.attrs.reduce((i,c)=>{const l=c.type;let d;switch(c.type){case"string":d=z2(e.attr,c.tfName,c.defaultValue),d===void 0&&c.tfDeprecatedName&&(d=z2(e.attr,c.tfDeprecatedName,c.defaultValue));break;case"string[]":d=Q2(e.attr,c.tfName,c.defaultValue),d===void 0&&c.tfDeprecatedName&&(d=Q2(e.attr,c.tfDeprecatedName,c.defaultValue));break;case"number":d=K2(e.attr,c.tfName,c.defaultValue||0),d===void 0&&c.tfDeprecatedName&&(d=K2(e.attr,c.tfDeprecatedName,c.defaultValue));break;case"number[]":d=J2(e.attr,c.tfName,c.defaultValue),d===void 0&&c.tfDeprecatedName&&(d=J2(e.attr,c.tfDeprecatedName,c.defaultValue));break;case"bool":d=H2(e.attr,c.tfName,c.defaultValue),d===void 0&&c.tfDeprecatedName&&(d=H2(e.attr,c.tfDeprecatedName,c.defaultValue));break;case"bool[]":d=eC(e.attr,c.tfName,c.defaultValue),d===void 0&&c.tfDeprecatedName&&(d=eC(e.attr,c.tfDeprecatedName,c.defaultValue));break;case"shape":d=Y2(e.attr,c.tfName,c.defaultValue),d===void 0&&c.tfDeprecatedName&&(d=Y2(e.attr,c.tfDeprecatedName,c.defaultValue));break;case"shape[]":d=Z2(e.attr,c.tfName,c.defaultValue),d===void 0&&c.tfDeprecatedName&&(d=Z2(e.attr,c.tfDeprecatedName,c.defaultValue));break;case"dtype":d=q2(e.attr,c.tfName,c.defaultValue),d===void 0&&c.tfDeprecatedName&&(d=q2(e.attr,c.tfDeprecatedName,c.defaultValue));break;case"dtype[]":d=X2(e.attr,c.tfName,c.defaultValue),d===void 0&&c.tfDeprecatedName&&(d=X2(e.attr,c.tfDeprecatedName,c.defaultValue));break;case"func":d=FM(e.attr,c.tfName,c.defaultValue),d===void 0&&c.tfDeprecatedName&&(d=FM(e.attr,c.tfDeprecatedName,c.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error(`Unsupported param type: ${c.type} for op: ${e.op}`)}return i[c.name]={value:d,type:l},i},{})),s}mapFunction(e){const n=e.nodeDef,s=[],i=[];let c={};n!=null&&(c=n.reduce((_,y)=>(_[y.name]=this.mapNode(y),y.op==="Const"&&i.push(_[y.name]),_),{}));const l=[],d=[];e.signature.inputArg.forEach(_=>{const[y]=pc(_.name),v={name:y,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:Wb(_.type),type:"dtype"}},children:[]};v.signatureKey=_.name,l.push(v),c[y]=v}),Object.keys(c).forEach(_=>{const y=c[_];y.inputNames.forEach((v,I)=>{const[b,,A]=pc(v),R=c[b];if(R.outputs!=null){const O=R.outputs.indexOf(A);if(O!==-1){const L=`${b}:${O}`;y.inputNames[I]=L}}y.inputs.push(R),R.children.push(y)})});const f=e.ret;e.signature.outputArg.forEach(_=>{const[y,v]=pc(f[_.name]),I=c[y];I!=null&&(I.defaultOutput=v,d.push(I))});const m=this.mapArgsToSignature(e);return{nodes:c,inputs:l,outputs:d,weights:i,placeholders:s,signature:m}}mapArgsToSignature(e){return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s),n),{}),outputs:e.signature.outputArg.reduce((n,s)=>(n[s.name]=this.mapArgToTensorInfo(s,e.ret),n),{})}}mapArgToTensorInfo(e,n){let s=e.name;return n!=null&&(s=n[s]),{name:s,dtype:e.type}}}function Rce(t){const e=De().global;if(typeof e.atob<"u")return e.atob(t);if(typeof Buffer<"u")return new Buffer(t,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function dV(t,e){const n=Array.isArray(t)?String.fromCharCode.apply(null,t):Rce(t);return e?n:n.toLowerCase()}function z2(t,e,n,s=!1){const i=t[e];return i!=null?dV(i.s,s):n}function H2(t,e,n){const s=t[e];return s?s.b:n}function K2(t,e,n){const s=t[e]||{},i=s.i!=null?s.i:s.f!=null?s.f:n;return typeof i=="number"?i:parseInt(i,10)}function Wb(t){switch(typeof t=="string"&&(t=aa[t]),t){case aa.DT_FLOAT:case aa.DT_HALF:return"float32";case aa.DT_INT32:case aa.DT_INT64:case aa.DT_INT8:case aa.DT_UINT8:return"int32";case aa.DT_BOOL:return"bool";case aa.DT_DOUBLE:return"float32";case aa.DT_STRING:return"string";default:return null}}function FM(t,e,n){const s=t[e];return s&&s.func?s.func.name:n}function q2(t,e,n){const s=t[e];return s&&s.type?Wb(s.type):n}function X2(t,e,n){const s=t[e];return s&&s.list&&s.list.type?s.list.type.map(i=>Wb(i)):n}function hV(t){if(!t.unknownRank)return t.dim!=null?t.dim.map(e=>typeof e.size=="number"?e.size:parseInt(e.size,10)):[]}function Y2(t,e,n){const s=t[e];return s&&s.shape?hV(s.shape):n}function J2(t,e,n){const s=t[e];return s?((s.list.f&&s.list.f.length?s.list.f:s.list.i)||[]).map(i=>typeof i=="number"?i:parseInt(i,10)):n}function Q2(t,e,n,s=!1){const i=t[e];return i&&i.list&&i.list.s?i.list.s.map(c=>dV(c,s)):n}function Z2(t,e,n){const s=t[e];return s&&s.list&&s.list.shape?s.list.shape.map(i=>hV(i)):n}function eC(t,e,n){const s=t[e];return s&&s.list&&s.list.b?s.list.b:n}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bce{constructor(e,n,s){this.node=e,this.tensorMap=n,this.context=s,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(i=>this.getInput(i)),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce((i,c)=>(i[c]=this.getAttr(c),i),{}))}getInput(e){return ko(e,this.tensorMap,this.context)}getAttr(e,n){const s=this.node.rawAttrs[e];if(s.tensor!=null)return ko(e,this.tensorMap,this.context);if(s.i!=null||s.f!=null)return K2(this.node.rawAttrs,e,n);if(s.s!=null)return z2(this.node.rawAttrs,e,n);if(s.b!=null)return H2(this.node.rawAttrs,e,n);if(s.shape!=null)return Y2(this.node.rawAttrs,e,n);if(s.type!=null)return q2(this.node.rawAttrs,e,n);if(s.list!=null){if(s.list.i!=null||s.list.f!=null)return J2(this.node.rawAttrs,e,n);if(s.list.s!=null)return Q2(this.node.rawAttrs,e,n);if(s.list.shape!=null)return Z2(this.node.rawAttrs,e,n);if(s.list.b!=null)return eC(this.node.rawAttrs,e,n);if(s.list.type!=null)return X2(this.node.rawAttrs,e,n)}return n}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const po=Object.freeze(Object.defineProperty({__proto__:null,OP_SCOPE_SUFFIX:C6,abs:ca,acos:cee,acosh:lee,add:mr,addN:hee,all:fee,any:gee,argMax:_ee,argMin:vee,asin:Tee,asinh:Cee,atan:Ree,atan2:Nee,atanh:Oee,avgPool:o5,avgPool3d:Fee,basicLSTMCell:Gee,batchNorm:X_,batchNorm2d:Xee,batchNorm3d:Jee,batchNorm4d:Zee,batchToSpaceND:i5,bincount:a5,booleanMaskAsync:boe,broadcastArgs:nte,broadcastTo:_m,buffer:cn,cast:jr,ceil:ote,clipByValue:c5,clone:ul,complex:fl,concat:Ks,concat1d:cte,concat2d:lte,concat3d:hte,concat4d:fte,conv1d:Ete,conv2d:J_,conv2dTranspose:vte,conv3d:Tte,conv3dTranspose:Rte,cos:Nte,cosh:Ote,cosineWindow:Eb,cumprod:kte,cumsum:Pte,denseBincount:Mte,depthToSpace:Fte,depthwiseConv2d:ab,diag:Bte,dilation2d:Wte,div:ar,divNoNan:qte,dot:Yte,dropout:Uoe,einsum:Qte,elu:d5,enclosingPowerOfTwo:$5,equal:l5,erf:tne,euclideanNorm:lne,exp:eu,expandDims:Ba,expm1:fne,eye:f5,fft:fb,fill:Y_,floor:m5,floorDiv:s5,fused:eie,gather:g5,gatherND:Moe,greater:ey,greaterEqual:E5,ifft:p1,imag:q_,image:jp,inTopKAsync:Boe,irfft:D5,isFinite:Tne,isInf:Cne,isNaN:Rne,leakyRelu:_5,less:Ane,lessEqual:db,linalg:Aae,linspace:xne,localResponseNormalization:Dne,log:Vm,log1p:y5,logSigmoid:Fne,logSoftmax:Bne,logSumExp:S5,logicalAnd:d1,logicalNot:T5,logicalOr:I5,logicalXor:Kne,losses:Oae,lowerBound:Xne,matMul:nr,max:mp,maxPool:C5,maxPool3d:Qne,maxPoolWithArgmax:ere,maximum:nre,mean:h1,meshgrid:sre,min:L2,minimum:w5,mirrorPad:are,mod:ure,moments:dre,movingAverage:Aoe,mul:Vt,multiRNNCell:pre,multinomial:mre,neg:Xc,norm:Z_,notEqual:R5,oneHot:zZ,ones:md,onesLike:_re,op:pe,outerProduct:vre,pad:og,pad1d:Ire,pad2d:wre,pad3d:bre,pad4d:Are,pool:Pre,pow:lb,prelu:N5,print:M6,prod:$re,raggedGather:Ure,raggedTensorToTensor:Bre,rand:Wre,randomGamma:use,randomNormal:A5,randomStandardNormal:hse,randomUniform:O5,range:Bm,real:Fm,reciprocal:mse,relu:ny,relu6:x5,reshape:ze,reverse:kd,reverse1d:vse,reverse2d:Tse,reverse3d:Cse,reverse4d:Rse,rfft:mb,round:k5,rsqrt:Ase,scalar:Wn,scatterND:xoe,searchSorted:hb,selu:xse,separableConv2d:Dse,setdiff1dAsync:Lse,sigmoid:Sd,sign:$se,signal:Nae,sin:Use,sinh:Bse,slice:hn,slice1d:Wse,slice2d:zse,slice3d:Kse,slice4d:Xse,softmax:Jse,softplus:v5,spaceToBatchND:b5,sparse:xae,sparseToDense:Poe,spectral:bae,split:jm,sqrt:M2,square:Q_,squaredDifference:P5,squeeze:Os,stack:nu,step:L5,stridedSlice:coe,string:kae,sub:An,sum:Cr,tan:loe,tanh:P2,tensor:yc,tensor1d:Po,tensor2d:ll,tensor3d:z6,tensor4d:doe,tensor5d:hoe,tensor6d:poe,tile:ym,topk:moe,transpose:x2,truncatedNormal:Eoe,unique:yoe,unsortedSegmentSum:Soe,unstack:jd,upperBound:Ioe,variable:Coe,where:Ap,whereAsync:M5,zeros:xd,zerosLike:cb},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nce=(t,e,n,s=po)=>{switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[s.add(j("a",t,e,n),j("b",t,e,n))];case"AddN":return[s.addN(j("tensors",t,e,n))];case"FloorMod":case"Mod":return[s.mod(j("a",t,e,n),j("b",t,e,n))];case"Mul":return[s.mul(j("a",t,e,n),j("b",t,e,n))];case"RealDiv":case"Div":return[s.div(j("a",t,e,n),j("b",t,e,n))];case"DivNoNan":return[s.divNoNan(j("a",t,e,n),j("b",t,e,n))];case"FloorDiv":return[s.floorDiv(j("a",t,e,n),j("b",t,e,n))];case"Sub":return[s.sub(j("a",t,e,n),j("b",t,e,n))];case"Minimum":return[s.minimum(j("a",t,e,n),j("b",t,e,n))];case"Maximum":return[s.maximum(j("a",t,e,n),j("b",t,e,n))];case"Pow":return[s.pow(j("a",t,e,n),j("b",t,e,n))];case"SquaredDifference":return[s.squaredDifference(j("a",t,e,n),j("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ace=(t,e,n,s=po)=>{switch(t.op){case"Abs":case"ComplexAbs":return[s.abs(j("x",t,e,n))];case"Acos":return[s.acos(j("x",t,e,n))];case"Acosh":return[s.acosh(j("x",t,e,n))];case"Asin":return[s.asin(j("x",t,e,n))];case"Asinh":return[s.asinh(j("x",t,e,n))];case"Atan":return[s.atan(j("x",t,e,n))];case"Atan2":return[s.atan2(j("x",t,e,n),j("y",t,e,n))];case"Atanh":return[s.atanh(j("x",t,e,n))];case"Ceil":return[s.ceil(j("x",t,e,n))];case"Complex":return[s.complex(j("real",t,e,n),j("imag",t,e,n))];case"Cos":return[s.cos(j("x",t,e,n))];case"Cosh":return[s.cosh(j("x",t,e,n))];case"Elu":return[s.elu(j("x",t,e,n))];case"Erf":return[s.erf(j("x",t,e,n))];case"Exp":return[s.exp(j("x",t,e,n))];case"Expm1":return[s.expm1(j("x",t,e,n))];case"Floor":return[s.floor(j("x",t,e,n))];case"Log":return[s.log(j("x",t,e,n))];case"Log1p":return[s.log1p(j("x",t,e,n))];case"Imag":return[s.imag(j("x",t,e,n))];case"Neg":return[s.neg(j("x",t,e,n))];case"Reciprocal":return[s.reciprocal(j("x",t,e,n))];case"Real":return[s.real(j("x",t,e,n))];case"Relu":return[s.relu(j("x",t,e,n))];case"Round":return[s.round(j("x",t,e,n))];case"Selu":return[s.selu(j("x",t,e,n))];case"Sigmoid":return[s.sigmoid(j("x",t,e,n))];case"Sin":return[s.sin(j("x",t,e,n))];case"Sign":return[s.sign(j("x",t,e,n))];case"Sinh":return[s.sinh(j("x",t,e,n))];case"Softplus":return[s.softplus(j("x",t,e,n))];case"Sqrt":return[s.sqrt(j("x",t,e,n))];case"Square":return[s.square(j("x",t,e,n))];case"Tanh":return[s.tanh(j("x",t,e,n))];case"Tan":return[s.tan(j("x",t,e,n))];case"ClipByValue":return[s.clipByValue(j("x",t,e,n),j("clipValueMin",t,e,n),j("clipValueMax",t,e,n))];case"Relu6":return[s.relu6(j("x",t,e,n))];case"Rsqrt":return[s.rsqrt(ko(t.inputNames[0],e,n))];case"Prod":return[s.prod(j("x",t,e,n),j("axes",t,e,n))];case"LeakyRelu":return[s.leakyRelu(j("x",t,e,n),j("alpha",t,e,n))];case"Prelu":return[s.prelu(j("x",t,e,n),j("alpha",t,e,n))];case"IsNan":return[s.isNaN(ko(t.inputNames[0],e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ua(t,e,n=""){if(!(typeof t=="number"||typeof e=="number")){se(t.length===e.length,()=>n+` Shapes ${t} and ${e} must match`);for(let s=0;s<t.length;s++){const i=t[s],c=e[s];se(i<0||c<0||i===c,()=>n+` Shapes ${t} and ${e} must match`)}}}function UM(t){return!(typeof t=="number"||t.some(e=>e<0))}function Yf(t,e,n){let s=tC(t,n);const i=!UM(s);if(i&&e.length===0)throw new Error(`Tried to calculate elements of an empty list with non-fully-defined elementShape: ${s}`);if(i&&e.forEach(c=>{s=tC(c.shape,s)}),!UM(s))throw new Error(`Non-fully-defined elementShape: ${s}`);return s}function tC(t,e){if(typeof t=="number")return e;if(typeof e=="number")return t;if(t.length!==e.length)throw new Error(`Incompatible ranks during merge: ${t} vs. ${e}`);const n=[];for(let s=0;s<t.length;++s){const i=t[s],c=e[s];if(i>=0&&c>=0&&i!==c)throw new Error(`Incompatible shape during merge: ${t} vs. ${e}`);n[s]=i>=0?i:c}return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oce{constructor(e,n,s,i,c,l,d){this.name=e,this.dtype=n,this.maxSize=s,this.elementShape=i,this.identicalElementShapes=c,this.dynamicSize=l,this.clearAfterRead=d,this.tensors=[],this.closed_=!1,this.idTensor=Wn(0),Qu(this.idTensor)}get id(){return this.idTensor.id}get closed(){return this.closed_}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.tensor.id))&&n.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}size(){return this.tensors.length}read(e){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||e>=this.size())throw new Error(`Tried to read from index ${e}, but array size is: ${this.size()}`);const n=this.tensors[e];if(n.cleared)throw new Error(`TensorArray ${this.name}: Could not read index ${e} twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).`);return this.clearAfterRead&&(n.cleared=!0),n.read=!0,n.tensor}readMany(e){return e.map(n=>this.read(n))}write(e,n){if(this.closed_)throw new Error(`TensorArray ${this.name} has already been closed.`);if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error(`Tried to write to index ${e}, but array is not resizeable and size is: ${this.maxSize}`);const s=this.tensors[e]||{};if(n.dtype!==this.dtype)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e},
          because the value dtype is ${n.dtype}, but TensorArray dtype is ${this.dtype}.`);if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=n.shape),ua(this.elementShape,n.shape,`TensorArray ${this.name}: Could not write to TensorArray index ${e}.`),s.read)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been read.`);if(s.written)throw new Error(`TensorArray ${this.name}: Could not write to TensorArray index ${e}, because it has already been written.`);s.tensor=n,Qu(n),s.written=!0,this.tensors[e]=s}writeMany(e,n){if(e.length!==n.length)throw new Error(`TensorArray ${this.name}: could not write multiple tensors,because the index size: ${e.length} is not the same as tensors size: ${n.length}.`);e.forEach((s,i)=>this.write(s,n[i]))}gather(e,n){if(n&&n!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but gather requested dtype ${n}`);if(e)e=e.slice(0,this.size());else{e=[];for(let i=0;i<this.size();i++)e.push(i)}if(e.length===0)return yc([],[0].concat(this.elementShape));const s=this.readMany(e);return ua(this.elementShape,s[0].shape,"TensorArray shape mismatch: "),nu(s,0)}concat(e){if(e&&e!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but concat requested dtype ${e}`);if(this.size()===0)return yc([],[0].concat(this.elementShape));const n=[];for(let i=0;i<this.size();i++)n.push(i);const s=this.readMany(n);return ua(this.elementShape,s[0].shape,`TensorArray shape mismatch: tensor array shape (${this.elementShape}) vs first tensor shape (${s[0].shape})`),Ks(s,0)}scatter(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);if(e.length!==n.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${n.shape[0]}`);const s=Math.max(...e);if(!this.dynamicSize&&s>=this.maxSize)throw new Error(`Max index must be < array size (${s}  vs. ${this.maxSize})`);this.writeMany(e,jd(n,0))}split(e,n){if(n.dtype!==this.dtype)throw new Error(`TensorArray dtype is ${this.dtype} but tensor has dtype ${n.dtype}`);let s=0;const i=e.map(p=>(s+=p,s));if(s!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${n.shape}`);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error(`TensorArray's size is not equal to the size of lengths (${this.maxSize} vs. ${e.length}), and the TensorArray is not marked as dynamically resizeable`);const c=s===0?0:n.size/s,l=[];Xr(()=>{n=ze(n,[1,s,c]);for(let p=0;p<e.length;++p){const m=[0,p===0?0:i[p-1],0],_=[1,e[p],c];l[p]=ze(hn(n,m,_),this.elementShape)}return l});const d=[];for(let p=0;p<e.length;p++)d[p]=p;this.writeMany(d,l)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pd{constructor(e,n,s,i=-1){this.tensors=e,this.elementShape=n,this.elementDtype=s,e!=null&&e.forEach(c=>{if(s!==c.dtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${c.dtype}`);ua(n,c.shape,"TensorList shape mismatch: "),Qu(c)}),this.idTensor=Wn(0),this.maxNumElements=i,Qu(this.idTensor)}get id(){return this.idTensor.id}copy(){return new Pd([...this.tensors],this.elementShape,this.elementDtype)}clearAndClose(e){this.tensors.forEach(n=>{(e==null||!e.has(n.id))&&n.dispose()}),this.tensors.length=0,this.idTensor.dispose()}size(){return this.tensors.length}stack(e,n,s=-1){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(s!==-1&&this.tensors.length!==s)throw new Error(`Operation expected a list with ${s} elements but got a list with ${this.tensors.length} elements.`);ua(e,this.elementShape,"TensorList shape mismatch: ");const i=Yf(this.elementShape,this.tensors,e);return Xr(()=>{const c=this.tensors.map(l=>ze(l,i));return nu(c,0)})}popBack(e,n){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);if(this.size()===0)throw new Error("Trying to pop from an empty list.");const s=Yf(this.elementShape,this.tensors,e),i=this.tensors.pop();return i.kept=!1,ua(i.shape,e,"TensorList shape mismatch: "),ze(i,s)}pushBack(e){if(e.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${e.dtype}, but list elements ${this.elementDtype}`);if(ua(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Qu(e),this.tensors.push(e)}resize(e){if(e<0)throw new Error(`TensorListResize expects size to be non-negative. Got: ${e}`);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error(`TensorListResize input size ${e} is greater maxNumElement ${this.maxNumElements}.`);const n=new Pd([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=e;for(let s=0;s<Math.min(this.tensors.length,e);++s)n.tensors[s]=this.tensors[s];return n}getItem(e,n,s){if(s!==this.elementDtype)throw new Error(`Invalid data types; op elements ${s}, but list elements ${this.elementDtype}`);if(e<0||e>this.tensors.length)throw new Error(`Trying to access element ${e} in a list with ${this.tensors.length} elements.`);if(this.tensors[e]==null)throw new Error(`element at index ${e} is null.`);ua(this.tensors[e].shape,n,"TensorList shape mismatch: ");const i=Yf(this.elementShape,this.tensors,n);return ze(this.tensors[e],i)}setItem(e,n){if(n.dtype!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n.dtype}, but list elements ${this.elementDtype}`);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error(`Trying to set element ${e} in a list with max ${this.maxNumElements} elements.`);ua(this.elementShape,n.shape,"TensorList shape mismatch: "),Qu(n),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=n}gather(e,n,s){if(n!==this.elementDtype)throw new Error(`Invalid data types; op elements ${n}, but list elements ${this.elementDtype}`);ua(this.elementShape,s,"TensorList shape mismatch: "),e=e.slice(0,this.size());const i=Yf(this.elementShape,this.tensors,s);return e.length===0?yc([],[0].concat(i)):Xr(()=>{const c=e.map(l=>ze(this.tensors[l],i));return nu(c,0)})}concat(e,n){if(e&&e!==this.elementDtype)throw new Error(`TensorList dtype is ${this.elementDtype} but concat requested dtype ${e}`);ua(this.elementShape,n,"TensorList shape mismatch: ");const s=Yf(this.elementShape,this.tensors,n);return this.size()===0?yc([],[0].concat(s)):Xr(()=>{const i=this.tensors.map(c=>ze(c,s));return Ks(i,0)})}}function xce(t,e,n){const s=t.dtype;if(t.shape.length<1)throw new Error(`Tensor must be at least a vector, but saw shape: ${t.shape}`);if(t.dtype!==n)throw new Error(`Invalid data types; op elements ${t.dtype}, but list elements ${n}`);const i=t.shape.slice(1);ua(i,e,"TensorList shape mismatch: ");const c=jd(t);return new Pd(c,e,s)}function kce(t,e,n,s){return new Pd([],t,e,s)}function Dce(t,e,n,s){if(e.length!==t.shape[0])throw new Error(`Expected len(indices) == tensor.shape[0], but saw: ${e.length} vs. ${t.shape[0]}`);const i=Math.max(...e);if(s!=null&&s!==-1&&i>=s)throw new Error(`Max index must be < array size (${i}  vs. ${s})`);const c=new Pd([],n,t.dtype,s),l=jd(t,0);return e.forEach((d,p)=>{c.setItem(d,l[p])}),c}function Pce(t,e,n){let s=0;const i=e.map(m=>(s+=m,s));if(s!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        ${s}, and tensor's shape is: ${t.shape}`);const c=t.shape.slice(1),l=tC(c,n),d=s===0?0:t.size/s,p=Xr(()=>{const m=[];t=ze(t,[1,s,d]);for(let _=0;_<e.length;++_){const v=[0,_===0?0:i[_-1],0],I=[1,e[_],d];m[_]=ze(hn(t,v,I),l)}return t.dispose(),m}),f=new Pd([],n,t.dtype,e.length);for(let m=0;m<p.length;m++)f.setItem(m,p[m]);return f}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lce=async(t,e,n)=>{switch(t.op){case"If":case"StatelessIf":{const s=j("thenBranch",t,e,n),i=j("elseBranch",t,e,n),c=j("cond",t,e,n),l=j("args",t,e,n);return(await c.data())[0]?n.functionMap[s].executeFunctionAsync(l,n.tensorArrayMap,n.tensorListMap):n.functionMap[i].executeFunctionAsync(l,n.tensorArrayMap,n.tensorListMap)}case"While":case"StatelessWhile":{const s=j("body",t,e,n),i=j("cond",t,e,n),c=j("args",t,e,n),l=await n.functionMap[i].executeFunctionAsync(c,n.tensorArrayMap,n.tensorListMap),d=c.map(m=>m.id);let p=await l[0].data();l.forEach(m=>{!m.kept&&d.indexOf(m.id)===-1&&m.dispose()});let f=c;for(;p[0];){const m=f;f=await n.functionMap[s].executeFunctionAsync(f,n.tensorArrayMap,n.tensorListMap);const _=f.map(v=>v.id);m.forEach(v=>{!v.kept&&d.indexOf(v.id)===-1&&_.indexOf(v.id)===-1&&v.dispose()});const y=await n.functionMap[i].executeFunctionAsync(f,n.tensorArrayMap,n.tensorListMap);p=await y[0].data(),y.forEach(v=>{!v.kept&&d.indexOf(v.id)===-1&&_.indexOf(v.id)===-1&&v.dispose()})}return f}case"LoopCond":{const s=j("pred",t,e,n);return[Bc(s)]}case"Switch":{const s=j("pred",t,e,n);let i=j("data",t,e,n);return i.kept||(i=Bc(i)),(await s.data())[0]?[void 0,i]:[i,void 0]}case"Merge":{const s=t.inputNames.find(i=>ko(i,e,n)!==void 0);if(s){const i=ko(s,e,n);return[Bc(i)]}return}case"Enter":{const s=j("frameName",t,e,n),i=j("tensor",t,e,n);return n.enterFrame(s),[Bc(i)]}case"Exit":{const s=j("tensor",t,e,n);return n.exitFrame(),[Bc(s)]}case"NextIteration":{const s=j("tensor",t,e,n);return n.nextIteration(),[Bc(s)]}case"TensorArrayV3":{const s=j("size",t,e,n),i=j("dtype",t,e,n),c=j("elementShape",t,e,n),l=j("dynamicSize",t,e,n),d=j("clearAfterRead",t,e,n),p=j("identicalElementShapes",t,e,n),f=j("name",t,e,n),m=new Oce(f,i,s,c,p,l,d);return n.addTensorArray(m),[m.idTensor,Wn(1)]}case"TensorArrayWriteV3":{const s=j("tensorArrayId",t,e,n),i=j("index",t,e,n),c=j("tensor",t,e,n),l=n.getTensorArray(s.id);return l.write(i,c),[l.idTensor]}case"TensorArrayReadV3":{const s=j("tensorArrayId",t,e,n),i=j("index",t,e,n);return[n.getTensorArray(s.id).read(i)]}case"TensorArrayGatherV3":{const s=j("tensorArrayId",t,e,n),i=j("indices",t,e,n),c=j("dtype",t,e,n);return[n.getTensorArray(s.id).gather(i,c)]}case"TensorArrayScatterV3":{const s=j("tensorArrayId",t,e,n),i=j("indices",t,e,n),c=j("tensor",t,e,n),l=n.getTensorArray(s.id);return l.scatter(i,c),[l.idTensor]}case"TensorArrayConcatV3":{const s=j("tensorArrayId",t,e,n),i=n.getTensorArray(s.id),c=j("dtype",t,e,n);return[i.concat(c)]}case"TensorArraySplitV3":{const s=j("tensorArrayId",t,e,n),i=j("tensor",t,e,n),c=j("lengths",t,e,n),l=n.getTensorArray(s.id);return l.split(c,i),[l.idTensor]}case"TensorArraySizeV3":{const s=j("tensorArrayId",t,e,n),i=n.getTensorArray(s.id);return[Wn(i.size(),"int32")]}case"TensorArrayCloseV3":{const s=j("tensorArrayId",t,e,n),i=n.getTensorArray(s.id);return i.clearAndClose(),[i.idTensor]}case"TensorListSetItem":{const s=j("tensorListId",t,e,n),i=j("index",t,e,n),c=j("tensor",t,e,n),l=n.getTensorList(s.id);return l.setItem(i,c),[l.idTensor]}case"TensorListGetItem":{const s=j("tensorListId",t,e,n),i=j("index",t,e,n),c=j("elementShape",t,e,n),l=j("elementDType",t,e,n);return[n.getTensorList(s.id).getItem(i,c,l)]}case"TensorListScatterV2":case"TensorListScatter":{const s=j("indices",t,e,n),i=j("tensor",t,e,n),c=j("elementShape",t,e,n),l=j("numElements",t,e,n),d=Dce(i,s,c,l);return n.addTensorList(d),[d.idTensor]}case"TensorListReserve":case"EmptyTensorList":{const s=j("elementShape",t,e,n),i=j("elementDType",t,e,n);let c;t.op==="TensorListReserve"?c="numElements":c="maxNumElements";const l=j(c,t,e,n),d=t.op==="TensorListReserve"?-1:l,p=kce(s,i,l,d);return n.addTensorList(p),[p.idTensor]}case"TensorListGather":{const s=j("tensorListId",t,e,n),i=j("indices",t,e,n),c=j("elementShape",t,e,n),l=j("elementDType",t,e,n);return[n.getTensorList(s.id).gather(i,l,c)]}case"TensorListStack":{const s=j("tensorListId",t,e,n),i=j("elementShape",t,e,n),c=j("elementDType",t,e,n),l=j("numElements",t,e,n);return[n.getTensorList(s.id).stack(i,c,l)]}case"TensorListFromTensor":{const s=j("tensor",t,e,n),i=j("elementShape",t,e,n),c=j("elementDType",t,e,n),l=xce(s,i,c);return n.addTensorList(l),[l.idTensor]}case"TensorListConcat":case"TensorListConcatV2":{const s=j("tensorListId",t,e,n),i=n.getTensorList(s.id),c=j("dtype",t,e,n),l=j("elementShape",t,e,n);return[i.concat(c,l)]}case"TensorListPushBack":{const s=j("tensorListId",t,e,n),i=j("tensor",t,e,n),c=n.getTensorList(s.id);return c.pushBack(i),[c.idTensor]}case"TensorListPopBack":{const s=j("tensorListId",t,e,n),i=j("elementShape",t,e,n),c=j("elementDType",t,e,n);return[n.getTensorList(s.id).popBack(i,c)]}case"TensorListSplit":{const s=j("tensor",t,e,n),i=j("elementShape",t,e,n),c=j("lengths",t,e,n),l=Pce(s,c,i);return n.addTensorList(l),[l.idTensor]}case"TensorListLength":{const s=j("tensorListId",t,e,n),i=n.getTensorList(s.id);return[Wn(i.size(),"int32")]}case"TensorListResize":{const s=j("tensorListId",t,e,n),i=j("size",t,e,n),l=n.getTensorList(s.id).resize(i);return n.addTensorList(l),[l.idTensor]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VM(t,e,n){const[s,i]=j("fusedOps",t,e,n),c=s==="biasadd",l=!c,d=i==="prelu",p=s==="fusedbatchnorm",f=j("numArgs",t,e,n);if(c){if(d&&f!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!d&&c&&f!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(p)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");const m=j("strides",t,e,n),_=x0(t,e,n),y=j("dataFormat",t,e,n).toUpperCase(),v=j("dilations",t,e,n);let[I,b]=j("args",t,e,n);l&&(b=I,I=void 0);const A=j("leakyreluAlpha",t,e,n);return{stride:m,pad:_,dataFormat:y,dilations:v,biasArg:I,preluArg:b,activationFunc:i,leakyreluAlpha:A}}const Mce=(t,e,n,s=po)=>{switch(t.op){case"Conv1D":{const i=j("stride",t,e,n),c=j("pad",t,e,n),l=j("dataFormat",t,e,n).toUpperCase(),d=j("dilation",t,e,n);return[s.conv1d(j("x",t,e,n),j("filter",t,e,n),i,c,l,d)]}case"Conv2D":{const i=j("strides",t,e,n),c=x0(t,e,n),l=j("dataFormat",t,e,n).toUpperCase(),d=j("dilations",t,e,n);return[s.conv2d(j("x",t,e,n),j("filter",t,e,n),[i[1],i[2]],c,l,[d[1],d[2]])]}case"_FusedConv2D":{const{stride:i,pad:c,dataFormat:l,dilations:d,biasArg:p,preluArg:f,activationFunc:m,leakyreluAlpha:_}=VM(t,e,n);return[s.fused.conv2d({x:j("x",t,e,n),filter:j("filter",t,e,n),strides:[i[1],i[2]],pad:c,dataFormat:l,dilations:[d[1],d[2]],bias:p,activation:m,preluActivationWeights:f,leakyreluAlpha:_})]}case"FusedDepthwiseConv2dNative":{const{stride:i,pad:c,dataFormat:l,dilations:d,biasArg:p,preluArg:f,activationFunc:m,leakyreluAlpha:_}=VM(t,e,n);return[s.fused.depthwiseConv2d({x:j("x",t,e,n),filter:j("filter",t,e,n),strides:[i[1],i[2]],pad:c,dataFormat:l,dilations:[d[1],d[2]],bias:p,activation:m,preluActivationWeights:f,leakyreluAlpha:_})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{const i=j("outputShape",t,e,n),c=j("strides",t,e,n),l=x0(t,e,n);return[s.conv2dTranspose(j("x",t,e,n),j("filter",t,e,n),i,[c[1],c[2]],l)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{const i=j("strides",t,e,n),c=x0(t,e,n),l=j("dilations",t,e,n),d=j("dataFormat",t,e,n).toUpperCase();return[s.depthwiseConv2d(j("input",t,e,n),j("filter",t,e,n),[i[1],i[2]],c,d,[l[1],l[2]])]}case"Conv3D":{const i=j("strides",t,e,n),c=j("pad",t,e,n),l=j("dataFormat",t,e,n).toUpperCase(),d=j("dilations",t,e,n);return[s.conv3d(j("x",t,e,n),j("filter",t,e,n),[i[1],i[2],i[3]],c,l,[d[1],d[2],d[3]])]}case"AvgPool":{const i=j("strides",t,e,n),c=j("pad",t,e,n),l=j("kernelSize",t,e,n);return[s.avgPool(j("x",t,e,n),[l[1],l[2]],[i[1],i[2]],c)]}case"MaxPool":{const i=j("strides",t,e,n),c=j("pad",t,e,n),l=j("kernelSize",t,e,n);return[s.maxPool(j("x",t,e,n),[l[1],l[2]],[i[1],i[2]],c)]}case"MaxPoolWithArgmax":{const i=j("strides",t,e,n),c=j("pad",t,e,n),l=j("kernelSize",t,e,n),d=j("includeBatchInIndex",t,e,n),{result:p,indexes:f}=s.maxPoolWithArgmax(j("x",t,e,n),[l[1],l[2]],[i[1],i[2]],c,d);return[p,f]}case"AvgPool3D":{const i=j("strides",t,e,n),c=j("pad",t,e,n),l=j("kernelSize",t,e,n);return[s.avgPool3d(j("x",t,e,n),[l[1],l[2],l[3]],[i[1],i[2],i[3]],c)]}case"MaxPool3D":{const i=j("strides",t,e,n),c=j("pad",t,e,n),l=j("kernelSize",t,e,n);return[s.maxPool3d(j("x",t,e,n),[l[1],l[2],l[3]],[i[1],i[2],i[3]],c)]}case"Dilation2D":{const i=j("strides",t,e,n),c=j("pad",t,e,n),l=j("dilations",t,e,n),d=i[1],p=i[2],f=l[1],m=l[2];return[s.dilation2d(j("x",t,e,n),j("filter",t,e,n),[d,p],c,[f,m],"NHWC")]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ce=(t,e,n,s=po)=>{switch(t.op){case"Fill":{const i=j("shape",t,e,n),c=j("dtype",t,e,n),l=j("value",t,e,n);return[s.fill(i,l,c)]}case"LinSpace":{const i=j("start",t,e,n),c=j("stop",t,e,n),l=j("num",t,e,n);return[s.linspace(i,c,l)]}case"Multinomial":{const i=j("logits",t,e,n),c=j("numSamples",t,e,n),l=j("seed",t,e,n);return[s.multinomial(i,c,l)]}case"OneHot":{const i=j("indices",t,e,n),c=j("depth",t,e,n),l=j("onValue",t,e,n),d=j("offValue",t,e,n),p=j("dtype",t,e,n);return[s.oneHot(i,c,l,d,p)]}case"Ones":return[s.ones(j("shape",t,e,n),j("dtype",t,e,n))];case"OnesLike":return[s.onesLike(j("x",t,e,n))];case"RandomStandardNormal":return[s.randomStandardNormal(j("shape",t,e,n),j("dtype",t,e,n),j("seed",t,e,n))];case"RandomUniform":return[s.randomUniform(j("shape",t,e,n),j("minval",t,e,n),j("maxval",t,e,n),j("dtype",t,e,n))];case"Range":{const i=j("start",t,e,n),c=j("stop",t,e,n),l=j("step",t,e,n);return[s.range(i,c,l,j("dtype",t,e,n))]}case"TruncatedNormal":{const i=j("shape",t,e,n),c=j("mean",t,e,n),l=j("stdDev",t,e,n),d=j("seed",t,e,n);return[s.truncatedNormal(i,c,l,j("dtype",t,e,n),d)]}case"Zeros":return[s.zeros(j("shape",t,e,n),j("dtype",t,e,n))];case"ZerosLike":return[s.zerosLike(j("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eI(t,e,n){const s=j("boxes",t,e,n),i=j("scores",t,e,n),c=j("maxOutputSize",t,e,n),l=j("iouThreshold",t,e,n),d=j("scoreThreshold",t,e,n),p=j("softNmsSigma",t,e,n);return{boxes:s,scores:i,maxOutputSize:c,iouThreshold:l,scoreThreshold:d,softNmsSigma:p}}const Fce=async(t,e,n,s,i=po)=>{switch(t.op){case"NonMaxSuppressionV5":{const{boxes:c,scores:l,maxOutputSize:d,iouThreshold:p,scoreThreshold:f,softNmsSigma:m}=eI(t,e,n),_=await i.image.nonMaxSuppressionWithScoreAsync(c,l,d,p,f,m);return[_.selectedIndices,_.selectedScores]}case"NonMaxSuppressionV4":{const{boxes:c,scores:l,maxOutputSize:d,iouThreshold:p,scoreThreshold:f}=eI(t,e,n),m=j("padToMaxOutputSize",t,e,n),_=await i.image.nonMaxSuppressionPaddedAsync(c,l,d,p,f,m);return[_.selectedIndices,_.validOutputs]}case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":{const{boxes:c,scores:l,maxOutputSize:d,iouThreshold:p,scoreThreshold:f}=eI(t,e,n);return[await i.image.nonMaxSuppressionAsync(c,l,d,p,f)]}case"Where":{const c=i.cast(j("condition",t,e,n),"bool"),l=[await i.whereAsync(c)];return c.dispose(),l}case"ListDiff":return i.setdiff1dAsync(j("x",t,e,n),j("y",t,e,n));default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uce=(t,e,n,s=po)=>{switch(t.op){case"LowerBound":{const i=j("sortedSequence",t,e,n),c=j("values",t,e,n);return[s.lowerBound(i,c)]}case"TopKV2":{const i=j("x",t,e,n),c=j("k",t,e,n),l=j("sorted",t,e,n),d=s.topk(i,c,l);return[d.values,d.indices]}case"UpperBound":{const i=j("sortedSequence",t,e,n),c=j("values",t,e,n);return[s.upperBound(i,c)]}case"Unique":{const i=j("x",t,e,n),c=s.unique(i);return[c.values,c.indices]}case"UniqueV2":{const i=j("x",t,e,n),c=j("axis",t,e,n),l=s.unique(i,c);return[l.values,l.indices]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vce=(t,e,n,s=po)=>{switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":const i=j("default",t,e,n);return[ko(t.name,e,n)||i];case"Placeholder":return[ko(t.name,e,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{const m=j("x",t,e,n);return[Bc(m)]}case"IdentityN":return j("x",t,e,n).map(m=>Bc(m));case"Snapshot":const c=j("x",t,e,n);return[Bc(c)];case"Shape":return[s.tensor1d(j("x",t,e,n).shape,"int32")];case"ShapeN":return j("x",t,e,n).map(m=>s.tensor1d(m.shape));case"Size":return[s.scalar(j("x",t,e,n).size,"int32")];case"Rank":return[s.scalar(j("x",t,e,n).rank,"int32")];case"NoOp":return[s.scalar(1)];case"Print":const l=j("x",t,e,n),d=j("data",t,e,n),p=j("message",t,e,n),f=j("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(p);for(let m=0;m<d.length;m++)console.log(Array.prototype.slice.call(d[m].dataSync()).slice(0,f));return[l];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bce{constructor(e,n){this.keyDType=e,this.valueDType=n,this.handle=Wn(0),this.tensorMap=new Map,Qu(this.handle)}get id(){return this.handle.id}clearAndClose(){this.tensorMap.forEach(e=>e.dispose()),this.tensorMap.clear(),this.handle.dispose()}size(){return this.tensorMap.size}tensorSize(){return Wn(this.size(),"int32")}async import(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return this.tensorMap.forEach(i=>i.dispose()),this.tensorMap.clear(),Xr(()=>{const i=jd(n),c=s.length,l=i.length;se(c===l,()=>`The number of elements doesn't match, keys has ${c} elements, the values has ${l} elements.`);for(let d=0;d<c;d++){const p=s[d],f=i[d];Qu(f),this.tensorMap.set(p,f)}return this.handle})}async find(e,n){this.checkKeyAndValueTensor(e,n);const s=await e.data();return Xr(()=>{const i=[];for(let c=0;c<s.length;c++){const l=s[c],d=this.findWithDefault(l,n);i.push(d)}return nu(i)})}findWithDefault(e,n){const s=this.tensorMap.get(e);return s??n}checkKeyAndValueTensor(e,n){if(e.dtype!==this.keyDType)throw new Error(`Expect key dtype ${this.keyDType}, but got ${e.dtype}`);if(n.dtype!==this.valueDType)throw new Error(`Expect value dtype ${this.valueDType}, but got ${n.dtype}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jce=async(t,e,n,s)=>{switch(t.op){case"HashTable":case"HashTableV2":{const i=j("keyDType",t,e,n),c=j("valueDType",t,e,n),l=new Bce(i,c);return s.addHashTable(t.name,l),[l.handle]}case"LookupTableImport":case"LookupTableImportV2":{const i=j("tableHandle",t,e,n,s),c=j("keys",t,e,n),l=j("values",t,e,n);return[await s.getHashTableById(i.id).import(c,l)]}case"LookupTableFind":case"LookupTableFindV2":{const i=j("tableHandle",t,e,n,s),c=j("keys",t,e,n),l=j("defaultValue",t,e,n);return[await s.getHashTableById(i.id).find(c,l)]}case"LookupTableSize":case"LookupTableSizeV2":{const i=j("tableHandle",t,e,n,s);return[s.getHashTableById(i.id).tensorSize()]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wce=(t,e,n,s=po)=>{switch(t.op){case"ResizeBilinear":{const i=j("images",t,e,n),c=j("size",t,e,n),l=j("alignCorners",t,e,n),d=j("halfPixelCenters",t,e,n);return[s.image.resizeBilinear(i,[c[0],c[1]],l,d)]}case"ResizeNearestNeighbor":{const i=j("images",t,e,n),c=j("size",t,e,n),l=j("alignCorners",t,e,n),d=j("halfPixelCenters",t,e,n);return[s.image.resizeNearestNeighbor(i,[c[0],c[1]],l,d)]}case"CropAndResize":{const i=j("image",t,e,n),c=j("boxes",t,e,n),l=j("boxInd",t,e,n),d=j("cropSize",t,e,n),p=j("method",t,e,n),f=j("extrapolationValue",t,e,n);return[s.image.cropAndResize(i,c,l,d,p,f)]}case"ImageProjectiveTransformV3":{const i=j("images",t,e,n),c=j("transforms",t,e,n),l=j("outputShape",t,e,n),d=j("fillValue",t,e,n),p=j("interpolation",t,e,n),f=j("fillMode",t,e,n);return[s.image.transform(i,c,p.toLowerCase(),f.toLowerCase(),d,l)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gce=(t,e,n,s=po)=>{switch(t.op){case"Equal":return[s.equal(j("a",t,e,n),j("b",t,e,n))];case"NotEqual":return[s.notEqual(j("a",t,e,n),j("b",t,e,n))];case"Greater":return[s.greater(j("a",t,e,n),j("b",t,e,n))];case"GreaterEqual":return[s.greaterEqual(j("a",t,e,n),j("b",t,e,n))];case"Less":return[s.less(j("a",t,e,n),j("b",t,e,n))];case"LessEqual":return[s.lessEqual(j("a",t,e,n),j("b",t,e,n))];case"LogicalAnd":return[s.logicalAnd(j("a",t,e,n),j("b",t,e,n))];case"LogicalNot":return[s.logicalNot(j("a",t,e,n))];case"LogicalOr":return[s.logicalOr(j("a",t,e,n),j("b",t,e,n))];case"Select":case"SelectV2":return[s.where(j("condition",t,e,n),j("a",t,e,n),j("b",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zce=(t,e,n,s=po)=>{switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[s.matMul(j("a",t,e,n),j("b",t,e,n),j("transposeA",t,e,n),j("transposeB",t,e,n))];case"Einsum":return[s.einsum(j("equation",t,e,n),...j("tensors",t,e,n))];case"Transpose":return[s.transpose(j("x",t,e,n),j("perm",t,e,n))];case"_FusedMatMul":const[i,c]=j("fusedOps",t,e,n),l=i==="biasadd",d=c==="prelu",p=j("numArgs",t,e,n),f=j("leakyreluAlpha",t,e,n);if(l){if(d&&p!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!d&&p!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}const[m,_]=j("args",t,e,n);return[s.fused.matMul({a:j("a",t,e,n),b:j("b",t,e,n),transposeA:j("transposeA",t,e,n),transposeB:j("transposeB",t,e,n),bias:m,activation:c,preluActivationWeights:_,leakyreluAlpha:f})];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hce=(t,e,n,s=po)=>{switch(t.op){case"EuclideanNorm":return[s.euclideanNorm(j("x",t,e,n),j("axis",t,e,n),j("keepDims",t,e,n))];case"FusedBatchNorm":case"FusedBatchNormV2":return[s.batchNorm(j("x",t,e,n),j("mean",t,e,n),j("variance",t,e,n),j("offset",t,e,n),j("scale",t,e,n),j("epsilon",t,e,n))];case"FusedBatchNormV3":return[s.batchNorm(j("x",t,e,n),j("mean",t,e,n),j("variance",t,e,n),j("offset",t,e,n),j("scale",t,e,n),j("epsilon",t,e,n))];case"LRN":return[s.localResponseNormalization(j("x",t,e,n),j("radius",t,e,n),j("bias",t,e,n),j("alpha",t,e,n),j("beta",t,e,n))];case"Softmax":return[s.softmax(j("x",t,e,n))];case"LogSoftmax":return[s.logSoftmax(j("x",t,e,n))];case"SparseToDense":return[s.sparseToDense(j("sparseIndices",t,e,n),j("outputShape",t,e,n),j("sparseValues",t,e,n),j("defaultValue",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kce=(t,e,n,s=po)=>{switch(t.op){case"Max":{const d=j("axis",t,e,n),p=j("keepDims",t,e,n);return[s.max(j("x",t,e,n),d,p)]}case"Mean":{const d=j("axis",t,e,n),p=j("keepDims",t,e,n);return[s.mean(j("x",t,e,n),d,p)]}case"Min":{const d=j("axis",t,e,n),p=j("keepDims",t,e,n);return[s.min(j("x",t,e,n),d,p)]}case"Sum":{const d=j("axis",t,e,n),p=j("keepDims",t,e,n);return[s.sum(j("x",t,e,n),d,p)]}case"All":{const d=j("axis",t,e,n),p=j("keepDims",t,e,n);return[s.all(j("x",t,e,n),d,p)]}case"Any":{const d=j("axis",t,e,n),p=j("keepDims",t,e,n);return[s.any(j("x",t,e,n),d,p)]}case"ArgMax":{const d=j("axis",t,e,n);return[s.argMax(j("x",t,e,n),d)]}case"ArgMin":{const d=j("axis",t,e,n);return[s.argMin(j("x",t,e,n),d)]}case"Prod":{const d=j("axis",t,e,n),p=j("keepDims",t,e,n);return[s.prod(j("x",t,e,n),d,p)]}case"Cumprod":{const d=j("axis",t,e,n),p=j("exclusive",t,e,n),f=j("reverse",t,e,n);return[s.cumprod(j("x",t,e,n),d,p,f)]}case"Cumsum":{const d=j("axis",t,e,n),p=j("exclusive",t,e,n),f=j("reverse",t,e,n);return[s.cumsum(j("x",t,e,n),d,p,f)]}case"Bincount":const i=j("x",t,e,n),c=j("weights",t,e,n),l=j("size",t,e,n);return[s.bincount(i,c,l)];case"DenseBincount":{const d=j("x",t,e,n),p=j("weights",t,e,n),f=j("size",t,e,n),m=j("binaryOutput",t,e,n);return[s.denseBincount(d,p,f,m)]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qce=(t,e,n,s=po)=>{switch(t.op){case"ConcatV2":case"Concat":{const i=j("n",t,e,n),c=j("axis",t,e,n);let l=j("tensors",t,e,n);return l=l.slice(0,i),[s.concat(l,c)]}case"Gather":{const i=j("x",t,e,n),c=j("indices",t,e,n);return[s.gather(i,s.cast(c,"int32"),0)]}case"GatherV2":{const i=j("axis",t,e,n),c=j("batchDims",t,e,n),l=j("x",t,e,n),d=j("indices",t,e,n);return[s.gather(l,s.cast(d,"int32"),i,c)]}case"Reverse":{const i=j("dims",t,e,n),c=[];for(let d=0;d<i.length;d++)i[d]&&c.push(d);const l=j("x",t,e,n);return[s.reverse(l,c)]}case"ReverseV2":{const i=j("axis",t,e,n),c=j("x",t,e,n);return[s.reverse(c,i)]}case"Slice":{const i=j("begin",t,e,n),c=j("size",t,e,n);return[s.slice(j("x",t,e,n),i,c)]}case"StridedSlice":{const i=j("begin",t,e,n),c=j("end",t,e,n),l=j("strides",t,e,n),d=j("beginMask",t,e,n),p=j("endMask",t,e,n),f=j("ellipsisMask",t,e,n),m=j("newAxisMask",t,e,n),_=j("shrinkAxisMask",t,e,n),y=j("x",t,e,n);return[s.stridedSlice(y,i,c,l,d,p,f,m,_)]}case"Pack":return Xr(()=>{const i=j("axis",t,e,n),c=j("tensors",t,e,n),l=c[0].shape,d=s.squeeze(c[0]).shape,p=c.map(f=>{const m=Nr(f.shape,l);if(!m&&!Nr(s.squeeze(f).shape,d))throw new Error("the input tensors shape does not match");return m?f:s.reshape(f,l)});return[s.stack(p,i)]});case"Unpack":{const i=j("axis",t,e,n),c=j("tensor",t,e,n);return s.unstack(c,i)}case"Tile":{const i=j("reps",t,e,n);return[s.tile(j("x",t,e,n),i)]}case"Split":case"SplitV":{const i=j("axis",t,e,n),c=j("numOrSizeSplits",t,e,n),l=j("x",t,e,n);return s.split(l,c,i)}case"ScatterNd":{const i=j("indices",t,e,n),c=j("values",t,e,n),l=j("shape",t,e,n);return[s.scatterND(i,c,l)]}case"GatherNd":{const i=j("x",t,e,n),c=j("indices",t,e,n);return[s.gatherND(i,c)]}case"SparseToDense":{const i=j("sparseIndices",t,e,n),c=j("outputShape",t,e,n),l=j("sparseValues",t,e,n),d=j("defaultValue",t,e,n);return[s.sparseToDense(i,l,c,l.dtype===d.dtype?d:s.cast(d,l.dtype))]}default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xce=(t,e,n,s=po)=>{switch(t.op){case"SparseFillEmptyRows":{const{outputIndices:i,outputValues:c,emptyRowIndicator:l,reverseIndexMap:d}=s.sparse.sparseFillEmptyRows(j("indices",t,e,n),j("values",t,e,n),j("denseShape",t,e,n),j("defaultValue",t,e,n));return[i,c,l,d]}case"SparseReshape":{const{outputIndices:i,outputShape:c}=s.sparse.sparseReshape(j("inputIndices",t,e,n),j("inputShape",t,e,n),j("newShape",t,e,n));return[i,c]}case"SparseSegmentMean":return[s.sparse.sparseSegmentMean(j("data",t,e,n),j("indices",t,e,n),j("segmentIds",t,e,n))];case"SparseSegmentSum":return[s.sparse.sparseSegmentSum(j("data",t,e,n),j("indices",t,e,n),j("segmentIds",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yce=(t,e,n,s=po)=>{switch(t.op){case"FFT":return[s.fft(j("x",t,e,n))];case"IFFT":return[s.ifft(j("x",t,e,n))];case"RFFT":return[s.rfft(j("x",t,e,n))];case"IRFFT":return[s.irfft(j("x",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jce=(t,e,n,s=po)=>{switch(t.op){case"StringNGrams":{const{nGrams:i,nGramsSplits:c}=s.string.stringNGrams(j("data",t,e,n),j("dataSplits",t,e,n),j("separator",t,e,n),j("nGramWidths",t,e,n),j("leftPad",t,e,n),j("rightPad",t,e,n),j("padWidth",t,e,n),j("preserveShortSequences",t,e,n));return[i,c]}case"StringSplit":{const{indices:i,values:c,shape:l}=s.string.stringSplit(j("input",t,e,n),j("delimiter",t,e,n),j("skipEmpty",t,e,n));return[i,c,l]}case"StringToHashBucketFast":return[s.string.stringToHashBucketFast(j("input",t,e,n),j("numBuckets",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qce=(t,e,n,s=po)=>{switch(t.op){case"Cast":return[s.cast(j("x",t,e,n),j("dtype",t,e,n))];case"ExpandDims":{const i=j("axis",t,e,n);return[s.expandDims(j("x",t,e,n),i)]}case"Squeeze":{const i=j("axis",t,e,n);return[s.squeeze(j("x",t,e,n),i)]}case"Reshape":return[s.reshape(j("x",t,e,n),j("shape",t,e,n))];case"MirrorPad":return[s.mirrorPad(j("x",t,e,n),j("padding",t,e,n),j("mode",t,e,n))];case"PadV2":case"Pad":return[s.pad(j("x",t,e,n),j("padding",t,e,n),j("constantValue",t,e,n))];case"SpaceToBatchND":{const i=j("blockShape",t,e,n),c=j("paddings",t,e,n);return[s.spaceToBatchND(j("x",t,e,n),i,c)]}case"BatchToSpaceND":{const i=j("blockShape",t,e,n),c=j("crops",t,e,n);return[s.batchToSpaceND(j("x",t,e,n),i,c)]}case"DepthToSpace":{const i=j("blockSize",t,e,n),c=j("dataFormat",t,e,n).toUpperCase();return[s.depthToSpace(j("x",t,e,n),i,c)]}case"BroadcastTo":return[s.broadcastTo(j("x",t,e,n),j("shape",t,e,n))];case"BroadcastArgs":return[s.broadcastArgs(j("s0",t,e,n),j("s1",t,e,n))];default:throw TypeError(`Node type ${t.op} is not implemented`)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BM(t,e,n,s,i=Xr){const c=((l,d,p)=>{switch(l.category){case"arithmetic":return i(()=>Nce(l,d,p));case"basic_math":return i(()=>Ace(l,d,p));case"control":return Lce(l,d,p);case"convolution":return i(()=>Mce(l,d,p));case"creation":return i(()=>$ce(l,d,p));case"dynamic":return Fce(l,d,p);case"evaluation":return i(()=>Uce(l,d,p));case"image":return i(()=>Wce(l,d,p));case"graph":return i(()=>Vce(l,d,p));case"logical":return i(()=>Gce(l,d,p));case"matrices":return i(()=>zce(l,d,p));case"normalization":return i(()=>Hce(l,d,p));case"reduction":return i(()=>Kce(l,d,p));case"slice_join":return i(()=>qce(l,d,p));case"sparse":return i(()=>Xce(l,d,p));case"spectral":return i(()=>Yce(l,d,p));case"string":return i(()=>Jce(l,d,p));case"transformation":return i(()=>Qce(l,d,p));case"hash_table":return jce(l,d,p,s);case"custom":const f=lV(l.op);if(f&&f.customExecutor)return f.customExecutor(new bce(l,d,p));throw TypeError(`Custom op ${l.op} is not registered.`);default:throw TypeError(`Unknown op '${l.op}'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()`)}})(t,e,n);return wp(c)?c.then(l=>[].concat(l)):[].concat(c)}class jM{constructor(e={},n={},s={},i={}){this.weightMap=e,this.tensorArrayMap=n,this.tensorListMap=s,this.functionMap=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}newFrame(e,n){return{id:e,frameName:n,iterationId:0}}set currentContext(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}get currentContext(){return this.contexts}get currentContextId(){return this._currentContextIds[0]}get currentContextIds(){return this._currentContextIds}generateCurrentContextIds(){const e=[];for(let n=0;n<this.contexts.length-1;n++){const s=this.contexts.slice(0,this.contexts.length-n);e.push(this.contextIdforContexts(s))}e.push(""),this._currentContextIds=e}contextIdforContexts(e){return e?e.map(n=>n.id===0&&n.iterationId===0?"":`${n.frameName}-${n.iterationId}`).join("/"):""}enterFrame(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}exitFrame(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")}nextIteration(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;const e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")}getWeight(e){return this.weightMap[e]}addTensorArray(e){this.tensorArrayMap[e.id]=e}getTensorArray(e){return this.tensorArrayMap[e]}addTensorList(e){this.tensorListMap[e.id]=e}getTensorList(e){return this.tensorListMap[e]}dispose(e){for(const n in this.tensorArrayMap)this.tensorArrayMap[n].clearAndClose(e);for(const n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WM(t,e,n,s){const i=new Set,c=[];let l=null,d=null;const p=new Set,f=Object.keys(t).map(y=>oi(y)[0]);let m=[];s!=null&&(m=s.map(y=>oi(y.name)[0]));const _=[...e];for(;_.length>0;){const y=_.pop();if((pV(y)||rue(y)||sue(y))&&l==null&&(l=y,d=l.children.map(v=>v.name).filter(v=>i.has(v))),i.add(y.name),n[y.name]==null&&f.indexOf(y.name)===-1&&m.indexOf(y.name)===-1){if(y.inputs.length===0){c.push(y.name);continue}y.inputs.forEach(v=>{p.has(v.name)||(p.add(v.name),_.push(v))})}}return{inputs:t,outputs:e,usedNodes:i,missingInputs:c,dynamicNode:l,syncInputs:d}}function Zce(t,e,n){const{usedNodes:s,inputs:i}=n,c=[],l=Object.keys(i).map(m=>oi(m)[0]).map(m=>t.nodes[m]),d=t.initNodes;l.forEach(m=>{s.has(m.name)&&c.push(m)}),t.weights.forEach(m=>{s.has(m.name)&&c.push(m)}),d!=null&&d.forEach(m=>{s.has(m.name)&&c.push(m)});const p=new Set,f=[];for(;c.length>0;){const m=c.pop();p.add(m.name),e[m.name]||f.push(m),m.children.forEach(_=>{!p.has(_.name)&&s.has(_.name)&&_.inputs.every(y=>p.has(y.name))&&c.push(_)})}return f}const eue=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],tue=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],nue=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function pV(t){return eue.indexOf(t.op)>=0}function rue(t){return tue.indexOf(t.op)>=0}function sue(t){return nue.indexOf(t.op)>=0}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class m1{constructor(e,n){this.graph=e,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(s=>{this._functionExecutorMap[s]=new m1(e.functions[s],this)})}get weightIds(){return this.parent?this.parent.weightIds:this._weightIds}get functionExecutorMap(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}get weightMap(){return this.parent?this.parent.weightMap:this._weightMap}set weightMap(e){const n=Object.keys(e).map(s=>e[s].map(i=>i.id));this._weightIds=[].concat(...n),this._weightMap=e}set resourceManager(e){this._resourceManager=e}get inputs(){return this._inputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get outputs(){return this._outputs.map(e=>({name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}))}get inputNodes(){return this._inputs.map(e=>e.signatureKey||e.name)}get outputNodes(){return this._outputs.map(e=>{const n=e.signatureKey||e.name;return e.defaultOutput?`${n}:${e.defaultOutput}`:n})}get functions(){return Object.keys(this._functions).reduce((e,n)=>(e[n]=this._functions[n].signature,e),{})}getCompilationKey(e,n){const s=e.map(c=>c.name).sort(),i=n.map(c=>c.name).sort();return s.join(this.SEPERATOR)+"--"+i.join(this.SEPERATOR)}compile(e,n){const s=WM(e,n,this.weightMap,this._initNodes),{missingInputs:i,dynamicNode:c,syncInputs:l}=s;if(c!=null)throw new Error(`This execution contains the node '${c.name}', which has the dynamic op '${c.op}'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [${l}]`);if(i.length>0){const d=n.map(f=>f.name),p=Object.keys(e);throw new Error(`Cannot compute the outputs [${d}] from the provided inputs [${p}]. Missing the following inputs: [${i}]`)}return Zce(this.graph,this.weightMap,s)}execute(e,n){e=this.mapInputs(e);const s=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n);const i=s.map(_=>this.graph.nodes[oi(_)[0]]),c=n.map(_=>oi(_)[0]);let l=c.map(_=>this.graph.nodes[_]);this.resetIntermediateTensors(),l.length===0&&(l=this._outputs);const d=this.getCompilationKey(i,l);let p=this.compiledMap.get(d);p==null&&(p=this.compile(e,l),this.compiledMap.set(d,p));const f={},m={};return Xr(()=>{const _=new jM(this.weightMap,f,m,this.functionExecutorMap),y=Object.assign({},this.weightMap);Object.keys(e).forEach(b=>{const[A,R]=oi(b),O=[];O[R]=e[b],y[A]=O});const v=this.getFrozenTensorIds(y),I={};for(let b=0;b<p.length;b++){const A=p[b];if(!y[A.name]){const R=BM(A,y,_,this._resourceManager);if(wp(R))throw new Error(`The execution of the op '${A.op}' returned a promise. Please use model.executeAsync() instead.`);y[A.name]=R,this.checkTensorForDisposal(A.name,A,y,_,v,c,I)}}return this.parent==null&&_.dispose(v),n.map(b=>ko(b,y,_))})}getFrozenTensorIds(e){const n=[].concat.apply([],Object.keys(e).map(s=>e[s]).map(s=>s.map(i=>i.id)));return new Set(n)}checkTensorForDisposal(e,n,s,i,c,l,d){n.category==="control"||l.indexOf(e)!==-1||(s[e].forEach(p=>{p!=null&&(d[p.id]=(d[p.id]||0)+n.children.length)}),n.inputs.forEach(p=>{if(p.category!=="control"){const f=Bae(p.name,s,i);f!=null&&f.forEach(m=>{if(m&&!m.kept&&!c.has(m.id)){const _=d[m.id];if(_===1){if(!this.keepTensorForDebug)m.dispose();else{const[y,v]=pc(n.name,i);this.intermediateTensors[y]?this.intermediateTensors[y][v]=m:(this.intermediateTensors[y]=[],this.intermediateTensors[y][v]=m)}delete d[m.id]}else _!=null&&d[m.id]--}})}}))}async executeAsync(e,n){return this._executeAsync(e,n)}disposeIntermediateTensors(){this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach(e=>this.intermediateTensors[e].forEach(n=>n.dispose())),this.disposeTensorsMap())}disposeTensorsMap(){this.tensorsMap&&Object.keys(this.tensorsMap).forEach(e=>{this.tensorsMap[e].forEach(s=>{s&&!s.kept&&!s.isDisposed&&!this.keepIds.has(s.id)&&s.dispose()})})}getIntermediateTensors(){return this.tensorsMap}resetIntermediateTensors(){for(const e in this.intermediateTensors)this.intermediateTensors[e].forEach(n=>n.dispose()),delete this.intermediateTensors[e]}async _executeAsync(e,n,s=!1,i={},c={}){s||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepTensorForDebug=De().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(m){console.warn(m.message)}this.resetIntermediateTensors();const l=new jM(this.weightMap,i,c,this.functionExecutorMap);this.tensorsMap=await this.executeWithControlFlow(e,l,n,s);const d=n.map(m=>ko(m,this.tensorsMap,l)),p=d.map(m=>m.id),f=Object.keys(e).map(m=>e[m].id);return this.keepIds=new Set([...p,...f,...this.weightIds]),this.keepTensorForDebug||this.disposeTensorsMap(),this.parent==null&&l.dispose(this.keepIds),d}async executeFunctionAsync(e,n,s){const i=e.reduce((c,l,d)=>(c[this.inputs[d].name]=l,c),{});return this._executeAsync(i,this.outputNodes,!0,n,s)}async executeWithControlFlow(e,n,s,i){const c=Object.keys(e),l=c.map(L=>this.graph.nodes[oi(L)[0]]),d=s.map(L=>oi(L)[0]);let p=d.map(L=>this.graph.nodes[L]);p.length===0&&(p=this._outputs);const{usedNodes:f,missingInputs:m,dynamicNode:_,syncInputs:y}=WM(e,p,this.weightMap,this._initNodes),v=[...l,...this.graph.weights,...this._initNodes||[]].map(L=>({node:L,contexts:n.currentContext})),I=Object.assign({},this.weightMap);Object.keys(e).forEach(L=>{const[$,G]=oi(L),H=[];H[G]=e[L],I[$]=H});const b={},A=this.getFrozenTensorIds(I),R={};for(;v.length>0;){const L=this.processStack(l,v,n,I,R,A,d,b,f);await Promise.all(L)}_==null&&!i&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead.");const O=p.filter(L=>!pV(L)&&!ko(L.name,I,n)).map(L=>L.name);if(O.length>0){let L="";throw _!=null&&(L=`Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [${y}]`),new Error(`Cannot compute the outputs [${O}] from the provided inputs [${c}]. Consider providing the following inputs: [${m}]. ${L}`)}return I}processStack(e,n,s,i,c,l,d,p,f){const m=[];for(;n.length>0;){const _=n.pop();s.currentContext=_.contexts;let y="";if(_.node.op==="Enter"&&j("isConstant",_.node,i,s)&&([y]=pc(_.node.name,s)),i[_.node.name]==null){const v=BM(_.node,i,s,this._resourceManager);y||([y]=pc(_.node.name,s));const I=s.currentContext;wp(v)?m.push(v.then(b=>(i[y]=b,s.currentContext=I,this.checkTensorForDisposal(y,_.node,i,s,l,d,p),this.processChildNodes(_.node,n,s,i,c,f),b))):(i[y]=v,this.checkTensorForDisposal(y,_.node,i,s,l,d,p),this.processChildNodes(_.node,n,s,i,c,f))}else this.processChildNodes(_.node,n,s,i,c,f)}return m}processChildNodes(e,n,s,i,c,l){e.children.forEach(d=>{const[p]=pc(d.name,s);c[p]||!l.has(d.name)||(d.op==="Merge"?d.inputNames.some(f=>!!ko(f,i,s))&&(c[p]=!0,n.push({contexts:s.currentContext,node:d})):d.inputNames.every(f=>!!ko(f,i,s))&&(c[p]=!0,n.push({contexts:s.currentContext,node:d})))})}dispose(){Object.keys(this.weightMap).forEach(e=>this.weightMap[e].forEach(n=>n.dispose()))}checkInputShapeAndType(e){Object.keys(e).forEach(n=>{const s=e[n],[i]=oi(n),c=this.graph.nodes[i];if(c.attrParams.shape&&c.attrParams.shape.value){const l=c.attrParams.shape.value,d=l.length===s.shape.length&&s.shape.every((p,f)=>l[f]===-1||l[f]===p);se(d,()=>`The shape of dict['${c.name}'] provided in model.execute(dict) must be [${l}], but was [${s.shape}]`)}c.attrParams.dtype&&c.attrParams.dtype.value&&se(s.dtype===c.attrParams.dtype.value,()=>`The dtype of dict['${c.name}'] provided in model.execute(dict) must be ${c.attrParams.dtype.value}, but was ${s.dtype}`)})}mapInputs(e){const n={};for(const s in e)if(this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[s]!=null){const i=this._signature.inputs[s];n[i.name]=e[s]}else n[s]=e[s];return n}checkInputs(e){const n=Object.keys(e).filter(s=>{const[i]=oi(s);return this.graph.nodes[i]==null});if(n.length>0)throw new Error(`The dict provided in model.execute(dict) has keys: [${n}] that are not part of graph`)}mapOutputs(e){return e.map(n=>this._signature!=null&&this._signature.outputs!=null&&this._signature.outputs[n]!=null?this._signature.outputs[n].name:n,{})}checkOutputs(e){e.forEach(n=>{const[s]=oi(n);if(!this.graph.nodes[s])throw new Error(`The output '${n}' is not found in the graph`)})}}class oue{constructor(e={},n={}){this.hashTableNameToHandle=e,this.hashTableMap=n}addHashTable(e,n){this.hashTableNameToHandle[e]=n.handle,this.hashTableMap[n.id]=n}getHashTableHandleByName(e){return this.hashTableNameToHandle[e]}getHashTableById(e){return this.hashTableMap[e]}dispose(){for(const e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(const e in this.hashTableNameToHandle)this.hashTableNameToHandle[e].dispose(),delete this.hashTableNameToHandle[e]}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iue="?tfjs-format=file",aue="model.json";class cue{constructor(e,n={},s=j6){this.modelUrl=e,this.loadOptions=n,this.version="n/a",this.io=s,n==null&&(this.loadOptions={}),this.resourceManager=new oue}get modelVersion(){return this.version}get inputNodes(){return this.executor.inputNodes}get outputNodes(){return this.executor.outputNodes}get inputs(){return this.executor.inputs}get outputs(){return this.executor.outputs}get weights(){return this.executor.weightMap}get metadata(){return this.artifacts.userDefinedMetadata}get modelSignature(){return this.signature}get modelStructuredOutputKeys(){return this.structuredOutputKeys}findIOHandler(){const e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{const n=this.io.getLoadHandlers(e,this.loadOptions);if(n.length===0)n.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(n.length>1)throw new Error(`Found more than one (${n.length}) load handlers for URL '${[e]}'`);this.handler=n[0]}}load(){if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const e=this.handler.load();return wp(e)?e.then(n=>this.loadSync(n)):this.loadSync(e)}loadSync(e){this.artifacts=e;const n=this.artifacts.modelTopology;let s=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){const c=this.artifacts.userDefinedMetadata;c.signature!=null&&(s=c.signature),c.structuredOutputKeys!=null&&(this.structuredOutputKeys=c.structuredOutputKeys)}this.signature=s,this.version=`${n.versions.producer}.${n.versions.minConsumer}`;const i=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new m1($M.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(i),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){const c=$M.Instance.transformGraph(e.modelInitializer);this.initializer=new m1(c),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}async save(e,n){if(typeof e=="string"){const s=this.io.getSaveHandlers(e);if(s.length===0)throw new Error(`Cannot find any save handlers for URL '${e}'`);if(s.length>1)throw new Error(`Found more than one (${s.length}) save handlers for URL '${e}'`);e=s[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return e.save(this.artifacts)}predict(e,n){const s=this.execute(e,this.outputNodes);if(this.structuredOutputKeys){const i=s instanceof Br?[s]:s,c={};return i.forEach((l,d)=>c[this.structuredOutputKeys[d]]=l),c}return s}normalizeInputs(e){if(!(e instanceof Br)&&!Array.isArray(e))return e;if(e=Array.isArray(e)?e:[e],e.length!==this.inputNodes.length)throw new Error(`Input tensor count mismatch,the graph model has ${this.inputNodes.length} placeholders, while there are ${e.length} input tensors.`);return this.inputNodes.reduce((n,s,i)=>(n[s]=e[i],n),{})}normalizeOutputs(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}execute(e,n){e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=this.executor.execute(e,n);return s.length>1?s:s[0]}async executeAsync(e,n){e=this.normalizeInputs(e),n=this.normalizeOutputs(n);const s=await this.executor.executeAsync(e,n);return s.length>1?s:s[0]}getIntermediateTensors(){return this.executor.getIntermediateTensors()}disposeIntermediateTensors(){this.executor.disposeIntermediateTensors()}convertTensorMapToTensorsMap(e){return Object.keys(e).reduce((n,s)=>(n[s]=[e[s]],n),{})}dispose(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}async function fV(t,e={},n=j6){if(t==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");e==null&&(e={}),e.fromTFHub&&typeof t=="string"&&(t=uue(t));const s=new cue(t,e,n);return await s.load(),s}function uue(t){return t.endsWith("/")||(t=t+"/"),`${t}${aue}${iue}`}/**
    * @license
    * Copyright 2022 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */var za=function(){return za=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},za.apply(this,arguments)};function zc(t,e,n,s){return new(n||(n=Promise))(function(i,c){function l(f){try{p(s.next(f))}catch(m){c(m)}}function d(f){try{p(s.throw(f))}catch(m){c(m)}}function p(f){var m;f.done?i(f.value):(m=f.value,m instanceof n?m:new n(function(_){_(m)})).then(l,d)}p((s=s.apply(t,e||[])).next())})}function Hc(t,e){var n,s,i,c,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return c={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function d(p){return function(f){return function(m){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,s&&(i=2&m[0]?s.return:m[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,m[1])).done)return i;switch(s=0,i&&(m=[2&m[0],i.value]),m[0]){case 0:case 1:i=m;break;case 4:return l.label++,{value:m[1],done:!1};case 5:l.label++,s=m[1],m=[0];continue;case 7:m=l.ops.pop(),l.trys.pop();continue;default:if(i=l.trys,!((i=i.length>0&&i[i.length-1])||m[0]!==6&&m[0]!==2)){l=0;continue}if(m[0]===3&&(!i||m[1]>i[0]&&m[1]<i[3])){l.label=m[1];break}if(m[0]===6&&l.label<i[1]){l.label=i[1],i=m;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(m);break}i[2]&&l.ops.pop(),l.trys.pop();continue}m=e.call(t,l)}catch(_){m=[6,_],s=0}finally{n=i=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([p,f])}}}function Wu(t){var e=t.map(function(n){return n[0]});return e.push(t[t.length-1][1]),e}var lue={lips:Wu([[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]]),leftEye:Wu([[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]]),leftEyebrow:Wu([[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]]),leftIris:Wu([[474,475],[475,476],[476,477],[477,474]]),rightEye:Wu([[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]]),rightEyebrow:Wu([[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]]),rightIris:Wu([[469,470],[470,471],[471,472],[472,469]]),faceOval:Wu([[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]])},due=Object.entries(lue).map(function(t){var e=t[0];return t[1].map(function(n){return[n,e]})}).flat(),mV=new Map(due);function nC(t){for(var e={locationData:{relativeKeypoints:[]}},n=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,l=0;l<t.length;++l){var d=t[l];n=Math.min(n,d.x),s=Math.max(s,d.x),i=Math.min(i,d.y),c=Math.max(c,d.y),e.locationData.relativeKeypoints.push({x:d.x,y:d.y})}return e.locationData.relativeBoundingBox={xMin:n,yMin:i,xMax:s,yMax:c,width:s-n,height:c-i},e}var tI={runtime:"mediapipe",maxFaces:1,refineLandmarks:!1},hue=function(){function t(e){var n=this;this.width=0,this.height=0,this.selfieMode=!1,this.faceMeshSolution=new iQ.FaceMesh({locateFile:function(s,i){return e.solutionPath?e.solutionPath.replace(/\/+$/,"")+"/"+s:i+"/"+s}}),this.faceMeshSolution.setOptions({refineLandmarks:e.refineLandmarks,selfieMode:this.selfieMode,maxNumFaces:e.maxFaces}),this.faceMeshSolution.onResults(function(s){if(n.height=s.image.height,n.width=s.image.width,n.faces=[],s.multiFaceLandmarks!==null)for(var i=s.multiFaceLandmarks,c=0;c<i.length;c++){var l=n.translateOutput(i[c]);n.faces.push({keypoints:l,box:nC(l).locationData.relativeBoundingBox})}})}return t.prototype.translateOutput=function(e){var n=this;return e.map(function(s,i){var c={x:s.x*n.width,y:s.y*n.height,z:s.z*n.width},l=mV.get(i);return l!=null&&(c.name=l),c})},t.prototype.estimateFaces=function(e,n){return zc(this,void 0,void 0,function(){var s,i;return Hc(this,function(c){switch(c.label){case 0:return n&&n.flipHorizontal&&n.flipHorizontal!==this.selfieMode&&(this.selfieMode=n.flipHorizontal,this.faceMeshSolution.setOptions({selfieMode:this.selfieMode})),e instanceof Br?(i=ImageData.bind,[4,H6(e)]):[3,2];case 1:return s=new(i.apply(ImageData,[void 0,c.sent(),e.shape[1],e.shape[0]])),[3,3];case 2:s=e,c.label=3;case 3:return e=s,[4,this.faceMeshSolution.send({image:e})];case 4:return c.sent(),[2,this.faces]}})})},t.prototype.dispose=function(){this.faceMeshSolution.close()},t.prototype.reset=function(){this.faceMeshSolution.reset(),this.width=0,this.height=0,this.faces=null,this.selfieMode=!1},t.prototype.initialize=function(){return this.faceMeshSolution.initialize()},t}();function pue(t){return zc(this,void 0,void 0,function(){var e,n;return Hc(this,function(s){switch(s.label){case 0:return e=function(i){if(i==null)return za({},tI);var c=za({},i);return c.runtime="mediapipe",c.maxFaces==null&&(c.maxFaces=tI.maxFaces),c.refineLandmarks==null&&(c.refineLandmarks=tI.refineLandmarks),c}(t),[4,(n=new hue(e)).initialize()];case 1:return s.sent(),[2,n]}})})}var nI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},fue={};(function(){var t;function e(x){var B=0;return function(){return B<x.length?{done:!1,value:x[B++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(x,B,z){return x==Array.prototype||x==Object.prototype||(x[B]=z.value),x},s=function(x){x=[typeof globalThis=="object"&&globalThis,x,typeof window=="object"&&window,typeof self=="object"&&self,typeof nI=="object"&&nI];for(var B=0;B<x.length;++B){var z=x[B];if(z&&z.Math==Math)return z}throw Error("Cannot find global object")}(this);function i(x,B){if(B)e:{var z=s;x=x.split(".");for(var ee=0;ee<x.length-1;ee++){var ce=x[ee];if(!(ce in z))break e;z=z[ce]}(B=B(ee=z[x=x[x.length-1]]))!=ee&&B!=null&&n(z,x,{configurable:!0,writable:!0,value:B})}}function c(x){return(x={next:x})[Symbol.iterator]=function(){return this},x}function l(x){var B=typeof Symbol<"u"&&Symbol.iterator&&x[Symbol.iterator];return B?B.call(x):{next:e(x)}}function d(x){if(!(x instanceof Array)){x=l(x);for(var B,z=[];!(B=x.next()).done;)z.push(B.value);x=z}return x}i("Symbol",function(x){function B(ce,ie){this.g=ce,n(this,"description",{configurable:!0,writable:!0,value:ie})}if(x)return x;B.prototype.toString=function(){return this.g};var z="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",ee=0;return function ce(ie){if(this instanceof ce)throw new TypeError("Symbol is not a constructor");return new B(z+(ie||"")+"_"+ee++,ie)}}),i("Symbol.iterator",function(x){if(x)return x;x=Symbol("Symbol.iterator");for(var B="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),z=0;z<B.length;z++){var ee=s[B[z]];typeof ee=="function"&&typeof ee.prototype[x]!="function"&&n(ee.prototype,x,{configurable:!0,writable:!0,value:function(){return c(e(this))}})}return x});var p,f=typeof Object.create=="function"?Object.create:function(x){function B(){}return B.prototype=x,new B};if(typeof Object.setPrototypeOf=="function")p=Object.setPrototypeOf;else{var m;e:{var _={};try{_.__proto__={a:!0},m=_.a;break e}catch{}m=!1}p=m?function(x,B){if(x.__proto__=B,x.__proto__!==B)throw new TypeError(x+" is not extensible");return x}:null}var y=p;function v(x,B){if(x.prototype=f(B.prototype),x.prototype.constructor=x,y)y(x,B);else for(var z in B)if(z!="prototype")if(Object.defineProperties){var ee=Object.getOwnPropertyDescriptor(B,z);ee&&Object.defineProperty(x,z,ee)}else x[z]=B[z];x.na=B.prototype}function I(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.u=this.o=0,this.j=null}function b(x){if(x.l)throw new TypeError("Generator is already running");x.l=!0}function A(x,B){x.j={da:B,ea:!0},x.g=x.o||x.u}function R(x,B,z){return x.g=z,{value:B}}function O(x){this.g=new I,this.h=x}function L(x,B,z,ee){try{var ce=B.call(x.g.i,z);if(!(ce instanceof Object))throw new TypeError("Iterator result "+ce+" is not an object");if(!ce.done)return x.g.l=!1,ce;var ie=ce.value}catch(le){return x.g.i=null,A(x.g,le),$(x)}return x.g.i=null,ee.call(x.g,ie),$(x)}function $(x){for(;x.g.g;)try{var B=x.h(x.g);if(B)return x.g.l=!1,{value:B.value,done:!1}}catch(z){x.g.h=void 0,A(x.g,z)}if(x.g.l=!1,x.g.j){if(B=x.g.j,x.g.j=null,B.ea)throw B.da;return{value:B.return,done:!0}}return{value:void 0,done:!0}}function G(x){this.next=function(B){return b(x.g),x.g.i?B=L(x,x.g.i.next,B,x.g.s):(x.g.s(B),B=$(x)),B},this.throw=function(B){return b(x.g),x.g.i?B=L(x,x.g.i.throw,B,x.g.s):(A(x.g,B),B=$(x)),B},this.return=function(B){return function(z,ee){b(z.g);var ce=z.g.i;return ce?L(z,"return"in ce?ce.return:function(ie){return{value:ie,done:!0}},ee,z.g.return):(z.g.return(ee),$(z))}(x,B)},this[Symbol.iterator]=function(){return this}}function H(x){return function(B){function z(ce){return B.next(ce)}function ee(ce){return B.throw(ce)}return new Promise(function(ce,ie){(function le(he){he.done?ce(he.value):Promise.resolve(he.value).then(z,ee).then(le,ie)})(B.next())})}(new G(new O(x)))}I.prototype.s=function(x){this.h=x},I.prototype.return=function(x){this.j={return:x},this.g=this.u},i("Promise",function(x){function B(le){this.h=0,this.i=void 0,this.g=[],this.s=!1;var he=this.j();try{le(he.resolve,he.reject)}catch(be){he.reject(be)}}function z(){this.g=null}function ee(le){return le instanceof B?le:new B(function(he){he(le)})}if(x)return x;z.prototype.h=function(le){if(this.g==null){this.g=[];var he=this;this.i(function(){he.l()})}this.g.push(le)};var ce=s.setTimeout;z.prototype.i=function(le){ce(le,0)},z.prototype.l=function(){for(;this.g&&this.g.length;){var le=this.g;this.g=[];for(var he=0;he<le.length;++he){var be=le[he];le[he]=null;try{be()}catch(je){this.j(je)}}}this.g=null},z.prototype.j=function(le){this.i(function(){throw le})},B.prototype.j=function(){function le(je){return function(qe){be||(be=!0,je.call(he,qe))}}var he=this,be=!1;return{resolve:le(this.D),reject:le(this.l)}},B.prototype.D=function(le){if(le===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(le instanceof B)this.H(le);else{e:switch(typeof le){case"object":var he=le!=null;break e;case"function":he=!0;break e;default:he=!1}he?this.A(le):this.o(le)}},B.prototype.A=function(le){var he=void 0;try{he=le.then}catch(be){return void this.l(be)}typeof he=="function"?this.I(he,le):this.o(le)},B.prototype.l=function(le){this.u(2,le)},B.prototype.o=function(le){this.u(1,le)},B.prototype.u=function(le,he){if(this.h!=0)throw Error("Cannot settle("+le+", "+he+"): Promise already settled in state"+this.h);this.h=le,this.i=he,this.h===2&&this.G(),this.B()},B.prototype.G=function(){var le=this;ce(function(){if(le.C()){var he=s.console;he!==void 0&&he.error(le.i)}},1)},B.prototype.C=function(){if(this.s)return!1;var le=s.CustomEvent,he=s.Event,be=s.dispatchEvent;return be===void 0||(typeof le=="function"?le=new le("unhandledrejection",{cancelable:!0}):typeof he=="function"?le=new he("unhandledrejection",{cancelable:!0}):(le=s.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,le),le.promise=this,le.reason=this.i,be(le))},B.prototype.B=function(){if(this.g!=null){for(var le=0;le<this.g.length;++le)ie.h(this.g[le]);this.g=null}};var ie=new z;return B.prototype.H=function(le){var he=this.j();le.M(he.resolve,he.reject)},B.prototype.I=function(le,he){var be=this.j();try{le.call(he,be.resolve,be.reject)}catch(je){be.reject(je)}},B.prototype.then=function(le,he){function be(ut,ft){return typeof ut=="function"?function(Bt){try{je(ut(Bt))}catch(tn){qe(tn)}}:ft}var je,qe,st=new B(function(ut,ft){je=ut,qe=ft});return this.M(be(le,je),be(he,qe)),st},B.prototype.catch=function(le){return this.then(void 0,le)},B.prototype.M=function(le,he){function be(){switch(je.h){case 1:le(je.i);break;case 2:he(je.i);break;default:throw Error("Unexpected state: "+je.h)}}var je=this;this.g==null?ie.h(be):this.g.push(be),this.s=!0},B.resolve=ee,B.reject=function(le){return new B(function(he,be){be(le)})},B.race=function(le){return new B(function(he,be){for(var je=l(le),qe=je.next();!qe.done;qe=je.next())ee(qe.value).M(he,be)})},B.all=function(le){var he=l(le),be=he.next();return be.done?ee([]):new B(function(je,qe){function st(Bt){return function(tn){ut[Bt]=tn,--ft==0&&je(ut)}}var ut=[],ft=0;do ut.push(void 0),ft++,ee(be.value).M(st(ut.length-1),qe),be=he.next();while(!be.done)})},B});var Z=typeof Object.assign=="function"?Object.assign:function(x,B){for(var z=1;z<arguments.length;z++){var ee=arguments[z];if(ee)for(var ce in ee)Object.prototype.hasOwnProperty.call(ee,ce)&&(x[ce]=ee[ce])}return x};i("Object.assign",function(x){return x||Z}),i("Object.is",function(x){return x||function(B,z){return B===z?B!==0||1/B==1/z:B!=B&&z!=z}}),i("Array.prototype.includes",function(x){return x||function(B,z){var ee=this;ee instanceof String&&(ee=String(ee));var ce=ee.length;for(0>(z=z||0)&&(z=Math.max(z+ce,0));z<ce;z++){var ie=ee[z];if(ie===B||Object.is(ie,B))return!0}return!1}}),i("String.prototype.includes",function(x){return x||function(B,z){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(B instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(B,z||0)!==-1}}),i("Array.prototype.keys",function(x){return x||function(){return function(B,z){B instanceof String&&(B+="");var ee=0,ce=!1,ie={next:function(){if(!ce&&ee<B.length){var le=ee++;return{value:z(le,B[le]),done:!1}}return ce=!0,{done:!0,value:void 0}}};return ie[Symbol.iterator]=function(){return ie},ie}(this,function(B){return B})}});var re=this||self;function oe(x,B){x=x.split(".");var z,ee=re;for((x[0]in ee)||ee.execScript===void 0||ee.execScript("var "+x[0]);x.length&&(z=x.shift());)x.length||B===void 0?ee=ee[z]&&ee[z]!==Object.prototype[z]?ee[z]:ee[z]={}:ee[z]=B}function ae(){throw Error("Invalid UTF8")}function Ee(x,B){return B=String.fromCharCode.apply(null,B),x==null?B:x+B}var Ce,ye,we=typeof TextDecoder<"u",Ae=typeof TextEncoder<"u",Oe={},Me=null;function me(x){var B;B===void 0&&(B=0),ke(),B=Oe[B];for(var z=Array(Math.floor(x.length/3)),ee=B[64]||"",ce=0,ie=0;ce<x.length-2;ce+=3){var le=x[ce],he=x[ce+1],be=x[ce+2],je=B[le>>2];le=B[(3&le)<<4|he>>4],he=B[(15&he)<<2|be>>6],be=B[63&be],z[ie++]=je+le+he+be}switch(je=0,be=ee,x.length-ce){case 2:be=B[(15&(je=x[ce+1]))<<2]||ee;case 1:x=x[ce],z[ie]=B[x>>2]+B[(3&x)<<4|je>>4]+be+ee}return z.join("")}function Te(x){var B=x.length,z=3*B/4;z%3?z=Math.floor(z):"=.".indexOf(x[B-1])!=-1&&(z="=.".indexOf(x[B-2])!=-1?z-2:z-1);var ee=new Uint8Array(z),ce=0;return function(ie,le){function he(ft){for(;be<ie.length;){var Bt=ie.charAt(be++),tn=Me[Bt];if(tn!=null)return tn;if(!/^[\s\xa0]*$/.test(Bt))throw Error("Unknown base64 encoding at char: "+Bt)}return ft}ke();for(var be=0;;){var je=he(-1),qe=he(0),st=he(64),ut=he(64);if(ut===64&&je===-1)break;le(je<<2|qe>>4),st!=64&&(le(qe<<4&240|st>>2),ut!=64&&le(st<<6&192|ut))}}(x,function(ie){ee[ce++]=ie}),ce!==z?ee.subarray(0,ce):ee}function ke(){if(!Me){Me={};for(var x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),B=["+/=","+/","-_=","-_.","-_"],z=0;5>z;z++){var ee=x.concat(B[z].split(""));Oe[z]=ee;for(var ce=0;ce<ee.length;ce++){var ie=ee[ce];Me[ie]===void 0&&(Me[ie]=ce)}}}}var Fe,Xe=typeof Uint8Array=="function";function Ye(x){return Xe&&x!=null&&x instanceof Uint8Array}function tt(x){if(this.L=x,x!==null&&x.length===0)throw Error("ByteString should be constructed with non-empty values")}var et=typeof Uint8Array.prototype.slice=="function",nt=0;function gt(x,B){return Error("Invalid wire type: "+x+" (at position "+B+")")}function Ct(){return Error("Failed to read varint, encoding is invalid.")}function Tt(x,B){B=(B=B===void 0?{}:B).v!==void 0&&B.v,this.h=null,this.g=this.i=this.j=0,this.v=B,x&&Lt(this,x)}function Lt(x,B){x.h=function(z,ee){if(z.constructor===Uint8Array)return z;if(z.constructor===ArrayBuffer)return new Uint8Array(z);if(z.constructor===Array)return new Uint8Array(z);if(z.constructor===String)return Te(z);if(z.constructor===tt)return!ee&&(ee=z.L)&&ee.constructor===Uint8Array?ee:(ee=(ee=z.L)==null||Ye(ee)?ee:typeof ee=="string"?Te(ee):null,(z=z.L=ee)?new Uint8Array(z):Fe||(Fe=new Uint8Array(0)));if(z instanceof Uint8Array)return new Uint8Array(z.buffer,z.byteOffset,z.byteLength);throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, or Array of numbers")}(B,x.v),x.j=0,x.i=x.h.length,x.g=x.j}function St(x){if(x.g>x.i)throw Error("Tried to read past the end of the data "+x.g+" > "+x.i)}function un(x){var B=x.h,z=B[x.g],ee=127&z;if(128>z)return x.g+=1,St(x),ee;if(ee|=(127&(z=B[x.g+1]))<<7,128>z)return x.g+=2,St(x),ee;if(ee|=(127&(z=B[x.g+2]))<<14,128>z)return x.g+=3,St(x),ee;if(ee|=(127&(z=B[x.g+3]))<<21,128>z)return x.g+=4,St(x),ee;if(z=B[x.g+4],x.g+=5,ee|=(15&z)<<28,128>z)return St(x),ee;if(128<=B[x.g++]&&128<=B[x.g++]&&128<=B[x.g++]&&128<=B[x.g++]&&128<=B[x.g++])throw Ct();return St(x),ee}Tt.prototype.reset=function(){this.g=this.j};var Kt=[];function sn(){this.g=[]}function on(x,B){for(;127<B;)x.g.push(127&B|128),B>>>=7;x.g.push(B)}function Zt(x){var B={},z=B.W!==void 0&&B.W;this.l={v:B.v!==void 0&&B.v},this.W=z,B=this.l,Kt.length?(z=Kt.pop(),B&&(z.v=B.v),x&&Lt(z,x),x=z):x=new Tt(x,B),this.g=x,this.j=this.g.g,this.h=this.i=-1}function xn(x){var B=x.g;if(B.g==B.i)return!1;x.j=x.g.g;var z=un(x.g)>>>0;if(B=z>>>3,!(0<=(z&=7)&&5>=z))throw gt(z,x.j);if(1>B)throw Error("Invalid field number: "+B+" (at position "+x.j+")");return x.i=B,x.h=z,!0}function pn(x){switch(x.h){case 0:if(x.h!=0)pn(x);else e:{for(var B=(x=x.g).g,z=B+10;B<z;)if(!(128&x.h[B++])){x.g=B,St(x);break e}throw Ct()}break;case 1:(x=x.g).g+=8,St(x);break;case 2:x.h!=2?pn(x):(B=un(x.g)>>>0,(x=x.g).g+=B,St(x));break;case 5:(x=x.g).g+=4,St(x);break;case 3:for(B=x.i;;){if(!xn(x))throw Error("Unmatched start-group tag: stream EOF");if(x.h==4){if(x.i!=B)throw Error("Unmatched end-group tag");break}pn(x)}break;default:throw gt(x.h,x.j)}}sn.prototype.length=function(){return this.g.length},sn.prototype.end=function(){var x=this.g;return this.g=[],x},Zt.prototype.reset=function(){this.g.reset(),this.j=this.g.g,this.h=this.i=-1};var Fn=[];function Pn(){this.i=[],this.h=0,this.g=new sn}function Bn(x,B){B.length!==0&&(x.i.push(B),x.h+=B.length)}var Ar=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol(void 0):void 0;function fo(x,B){Object.isFrozen(x)||(Ar?x[Ar]|=B:x.N!==void 0?x.N|=B:Object.defineProperties(x,{N:{value:B,configurable:!0,writable:!0,enumerable:!1}}))}function ps(x){var B;return(B=Ar?x[Ar]:x.N)==null?0:B}function Qr(x){return fo(x,1),x}function Lr(x){return!!Array.isArray(x)&&!!(2&ps(x))}function Wr(x){if(!Array.isArray(x))throw Error("cannot mark non-array as immutable");fo(x,2)}function _r(x){return x!==null&&typeof x=="object"&&!Array.isArray(x)&&x.constructor===Object}var Uo=Object.freeze(Qr([]));function _i(x){if(Lr(x.m))throw Error("Cannot mutate an immutable Message")}var Hi,du=typeof Symbol<"u"&&Symbol.hasInstance!==void 0;function wa(x){return{value:x,configurable:!1,writable:!1,enumerable:!1}}function is(x,B,z){return B===-1?null:B>=x.i?x.g?x.g[B]:void 0:z!==void 0&&z&&x.g&&(z=x.g[B])!=null?z:x.m[B+x.h]}function yr(x,B,z,ee){ee=ee!==void 0&&ee,_i(x),B<x.i&&!ee?x.m[B+x.h]=z:(x.g||(x.g=x.m[x.i+x.h]={}))[B]=z}function Gr(x,B,z,ee){z=z===void 0||z;var ce=is(x,B,ee=ee!==void 0&&ee);return ce==null&&(ce=Uo),Lr(x.m)?z&&(Wr(ce),Object.freeze(ce)):(ce===Uo||Lr(ce))&&yr(x,B,ce=Qr(ce.slice()),ee),ce}function ws(x,B,z){return(x=(x=is(x,B))==null?x:+x)==null?z===void 0?0:z:x}function Ic(x,B,z,ee){x.j||(x.j={});var ce=Lr(x.m),ie=x.j[z];if(!ie){ee=Gr(x,z,!0,ee!==void 0&&ee),ie=[],ce=ce||Lr(ee);for(var le=0;le<ee.length;le++)ie[le]=new B(ee[le]),ce&&Wr(ie[le].m);ce&&(Wr(ie),Object.freeze(ie)),x.j[z]=ie}return ie}function Un(x,B,z,ee,ce){var ie=ie!==void 0&&ie;return _i(x),ie=Ic(x,z,B,ie),z=ee||new z,x=Gr(x,B),ce!=null?(ie.splice(ce,0,z),x.splice(ce,0,z.m)):(ie.push(z),x.push(z.m)),z}function Cc(x,B){return(x=is(x,B))==null?0:x}function bl(x,B){return(x=is(x,B))==null?"":x}function Ki(x){var B=hu;return ln(x,B=B===void 0?Xa:B)}function zr(x,B){if(x!=null){if(Array.isArray(x))x=ln(x,B);else if(_r(x)){var z,ee={};for(z in x)ee[z]=zr(x[z],B);x=ee}else x=B(x);return x}}function ln(x,B){for(var z=x.slice(),ee=0;ee<z.length;ee++)z[ee]=zr(z[ee],B);return Array.isArray(x)&&1&ps(x)&&Qr(z),z}function hu(x){return x&&typeof x=="object"&&x.toJSON?x.toJSON():(x=function(B){switch(typeof B){case"number":return isFinite(B)?B:String(B);case"object":if(B&&!Array.isArray(B)){if(Ye(B))return me(B);if(B instanceof tt){var z=B.L;return z=z==null||typeof z=="string"?z:Xe&&z instanceof Uint8Array?me(z):null,(B.L=z)||""}}}return B}(x),Array.isArray(x)?Ki(x):x)}function Xa(x){return Ye(x)?new Uint8Array(x):x}function Ra(x,B,z){x||(x=Hi),Hi=null;var ee=this.constructor.h;if(x||(x=ee?[ee]:[]),this.h=(ee?0:-1)-(this.constructor.g||0),this.j=void 0,this.m=x,x=(ee=this.m.length)-1,ee&&_r(ee=this.m[x])?(this.i=x-this.h,this.g=ee):B!==void 0&&-1<B?(this.i=Math.max(B,x+1-this.h),this.g=void 0):this.i=Number.MAX_VALUE,z)for(B=0;B<z.length;B++)if((x=z[B])<this.i)x+=this.h,(ee=this.m[x])?Array.isArray(ee)&&Qr(ee):this.m[x]=Uo;else{var ce=(ee=this.g||(this.g=this.m[this.i+this.h]={}))[x];ce?Array.isArray(ce)&&Qr(ce):ee[x]=Uo}}function ba(){Ra.apply(this,arguments)}if(Ra.prototype.toJSON=function(){return Ki(this.m)},Ra.prototype.toString=function(){return this.m.toString()},v(ba,Ra),du){var qi={};Object.defineProperties(ba,(qi[Symbol.hasInstance]=wa(function(){throw Error("Cannot perform instanceof checks for MutableMessage")}),qi))}function Na(x,B,z){if(z){var ee,ce={};for(ee in z){var ie=z[ee],le=ie.ha;le||(ce.F=ie.la||ie.fa.P,ie.aa?(ce.U=qd(ie.aa),le=function(he){return function(be,je,qe){return he.F(be,je,qe,he.U)}}(ce)):ie.ca?(ce.T=pu(ie.X.g,ie.ca),le=function(he){return function(be,je,qe){return he.F(be,je,qe,he.T)}}(ce)):le=ce.F,ie.ha=le),le(B,x,ie.X),ce={F:ce.F,U:ce.U,T:ce.T}}}(function(he,be){if(be=be.ba){Bn(he,he.g.end());for(var je=0;je<be.length;je++)Bn(he,be[je])}})(B,x)}var mo=Symbol();function Xi(x,B,z){return x[mo]||(x[mo]=function(ee,ce){return B(ee,ce,z)})}function Hd(x){var B=x[mo];if(!B){var z=Al(x);B=function(ee,ce){return Ol(ee,ce,z)},x[mo]=B}return B}function Kd(x){var B=function(ce){var ie=ce.aa;return ie?Hd(ie):(ie=ce.ka)?Xi(ce.X.g,ie,ce.ca):void 0}(x),z=x.X,ee=x.fa.O;return B?function(ce,ie){return ee(ce,ie,z,B)}:function(ce,ie){return ee(ce,ie,z)}}function Zr(x,B,z,ee,ce,ie){var le=0;for((x=x()).length&&typeof x[0]!="number"&&(z(B,x[0]),le++);le<x.length;){z=x[le++];for(var he=le+1;he<x.length&&typeof x[he]!="number";)he++;var be=x[le++];switch(he-=le){case 0:ee(B,z,be);break;case 1:ee(B,z,be,x[le++]);break;case 2:ce(B,z,be,x[le++],x[le++]);break;case 3:he=x[le++];var je=x[le++],qe=x[le++];Array.isArray(qe)?ce(B,z,be,he,je,qe):ie(B,z,be,he,je,qe);break;case 4:ie(B,z,be,x[le++],x[le++],x[le++],x[le++]);break;default:throw Error("unexpected number of binary field arguments: "+he)}}return B}var yi=Symbol();function qd(x){var B=x[yi];if(!B){var z=Yd(x);B=function(ee,ce){return Eu(ee,ce,z)},x[yi]=B}return B}function pu(x,B){var z=x[yi];return z||(z=function(ee,ce){return Na(ee,ce,B)},x[yi]=z),z}var vi=Symbol();function Ya(x,B){x.push(B)}function Jp(x,B,z){x.push(B,z.P)}function fs(x,B,z,ee,ce){var ie=qd(ce),le=z.P;x.push(B,function(he,be,je){return le(he,be,je,ee,ie)})}function Xd(x,B,z,ee,ce,ie){var le=pu(ee,ie),he=z.P;x.push(B,function(be,je,qe){return he(be,je,qe,ee,le)})}function Yd(x){var B=x[vi];return B||Zr(x,x[vi]=[],Ya,Jp,fs,Xd)}var fu=Symbol();function Aa(x,B){x[0]=B}function Nl(x,B,z,ee){var ce=z.O;x[B]=ee?function(ie,le,he){return ce(ie,le,he,ee)}:ce}function Qp(x,B,z,ee,ce,ie){var le=z.O,he=Hd(ce);x[B]=function(be,je,qe){return le(be,je,qe,ee,he,ie)}}function mu(x,B,z,ee,ce,ie,le){var he=z.O,be=Xi(ee,ce,ie);x[B]=function(je,qe,st){return he(je,qe,st,ee,be,le)}}function Al(x){var B=x[fu];return B||Zr(x,x[fu]={},Aa,Nl,Qp,mu)}function Ol(x,B,z){for(;xn(B)&&B.h!=4;){var ee=B.i,ce=z[ee];if(!ce){var ie=z[0];ie&&(ie=ie[ee])&&(ce=z[ee]=Kd(ie))}if(!(ce&&ce(B,x,ee)||(ce=B,ee=x,ie=ce.j,pn(ce),ce.W))){var le=ce.g.h;ce=ie===(ce=ce.g.g)?Fe||(Fe=new Uint8Array(0)):et?le.slice(ie,ce):new Uint8Array(le.subarray(ie,ce)),(ie=ee.ba)?ie.push(ce):ee.ba=[ce]}}return x}function gu(x,B,z){if(Fn.length){var ee=Fn.pop();x&&(Lt(ee.g,x),ee.i=-1,ee.h=-1),x=ee}else x=new Zt(x);try{return Ol(new B,x,Al(z))}finally{(B=x.g).h=null,B.j=0,B.i=0,B.g=0,B.v=!1,x.i=-1,x.h=-1,100>Fn.length&&Fn.push(x)}}function Eu(x,B,z){for(var ee=z.length,ce=ee%2==1,ie=ce?1:0;ie<ee;ie+=2)(0,z[ie+1])(B,x,z[ie]);Na(x,B,ce?z[0]:void 0)}function Si(x,B){var z=new Pn;Eu(x,z,Yd(B)),Bn(z,z.g.end()),x=new Uint8Array(z.h);for(var ee=(B=z.i).length,ce=0,ie=0;ie<ee;ie++){var le=B[ie];x.set(le,ce),ce+=le.length}return z.i=[x],x}function go(x,B){return{O:x,P:B}}var Eo=go(function(x,B,z){if(x.h!==5)return!1;var ee=(x=x.g).h[x.g],ce=x.h[x.g+1],ie=x.h[x.g+2],le=x.h[x.g+3];return x.g+=4,St(x),x=2*((ce=(ee<<0|ce<<8|ie<<16|le<<24)>>>0)>>31)+1,ee=ce>>>23&255,ce&=8388607,yr(B,z,ee==255?ce?NaN:1/0*x:ee==0?x*Math.pow(2,-149)*ce:x*Math.pow(2,ee-150)*(ce+Math.pow(2,23))),!0},function(x,B,z){if((B=is(B,z))!=null){on(x.g,8*z+5),x=x.g;var ee=B;(ee=(z=0>ee?1:0)?-ee:ee)===0?0<1/ee?nt=0:nt=2147483648:isNaN(ee)?nt=2147483647:34028234663852886e22<ee?nt=(z<<31|2139095040)>>>0:11754943508222875e-54>ee?(ee=Math.round(ee/Math.pow(2,-149)),nt=(z<<31|ee)>>>0):(B=Math.floor(Math.log(ee)/Math.LN2),ee*=Math.pow(2,-B),16777216<=(ee=Math.round(8388608*ee))&&++B,nt=(z<<31|B+127<<23|8388607&ee)>>>0),z=nt,x.g.push(z>>>0&255),x.g.push(z>>>8&255),x.g.push(z>>>16&255),x.g.push(z>>>24&255)}}),Zp=go(function(x,B,z){if(x.h!==0)return!1;for(var ee=x.g,ce=128,ie=0,le=x=0;4>le&&128<=ce;le++)ce=ee.h[ee.g++],St(ee),ie|=(127&ce)<<7*le;if(128<=ce&&(ce=ee.h[ee.g++],St(ee),ie|=(127&ce)<<28,x|=(127&ce)>>4),128<=ce)for(le=0;5>le&&128<=ce;le++)ce=ee.h[ee.g++],St(ee),x|=(127&ce)<<7*le+3;if(!(128>ce))throw Ct();return ee=ie>>>0,(x=2147483648&(ce=x>>>0))&&(ce=~ce>>>0,(ee=1+~ee>>>0)==0&&(ce=ce+1>>>0)),ee=4294967296*ce+(ee>>>0),yr(B,z,x?-ee:ee),!0},function(x,B,z){if((B=is(B,z))!=null&&B!=null){on(x.g,8*z),x=x.g;var ee=B;for(z=0>ee,B=(ee=Math.abs(ee))>>>0,ee=Math.floor((ee-B)/4294967296),ee>>>=0,z&&(ee=~ee>>>0,4294967295<(B=1+(~B>>>0))&&(B=0,4294967295<++ee&&(ee=0))),z=nt=B,B=ee;0<B||127<z;)x.g.push(127&z|128),z=(z>>>7|B<<25)>>>0,B>>>=7;x.g.push(z)}}),Mr=go(function(x,B,z){return x.h===0&&(yr(B,z,un(x.g)),!0)},function(x,B,z){if((B=is(B,z))!=null&&B!=null)if(on(x.g,8*z),x=x.g,0<=(z=B))on(x,z);else{for(B=0;9>B;B++)x.g.push(127&z|128),z>>=7;x.g.push(1)}}),Jd=go(function(x,B,z){if(x.h!==2)return!1;var ee,ce=un(x.g)>>>0,ie=(x=x.g).g;if(x.g+=ce,St(x),x=x.h,we)(ee=Ce)||(ee=Ce=new TextDecoder("utf-8",{fatal:!0})),ee=ee.decode(x.subarray(ie,ie+ce));else{ce=ie+ce;for(var le,he,be,je=[],qe=null;ie<ce;)128>(le=x[ie++])?je.push(le):224>le?ie>=ce?ae():(he=x[ie++],194>le||(192&he)!=128?(ie--,ae()):je.push((31&le)<<6|63&he)):240>le?ie>=ce-1?ae():(192&(he=x[ie++]))!=128||le===224&&160>he||le===237&&160<=he||(192&(ee=x[ie++]))!=128?(ie--,ae()):je.push((15&le)<<12|(63&he)<<6|63&ee):244>=le?ie>=ce-2?ae():(192&(he=x[ie++]))!=128||he-144+(le<<28)>>30||(192&(ee=x[ie++]))!=128||(192&(be=x[ie++]))!=128?(ie--,ae()):(le=(7&le)<<18|(63&he)<<12|(63&ee)<<6|63&be,le-=65536,je.push(55296+(le>>10&1023),56320+(1023&le))):ae(),8192<=je.length&&(qe=Ee(qe,je),je.length=0);ee=Ee(qe,je)}return yr(B,z,ee),!0},function(x,B,z){if((B=is(B,z))!=null){var ee=!1;if(ee=ee!==void 0&&ee,Ae){if(ee&&/(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])/.test(B))throw Error("Found an unpaired surrogate");B=(ye||(ye=new TextEncoder)).encode(B)}else{for(var ce=0,ie=new Uint8Array(3*B.length),le=0;le<B.length;le++){var he=B.charCodeAt(le);if(128>he)ie[ce++]=he;else{if(2048>he)ie[ce++]=he>>6|192;else{if(55296<=he&&57343>=he){if(56319>=he&&le<B.length){var be=B.charCodeAt(++le);if(56320<=be&&57343>=be){he=1024*(he-55296)+be-56320+65536,ie[ce++]=he>>18|240,ie[ce++]=he>>12&63|128,ie[ce++]=he>>6&63|128,ie[ce++]=63&he|128;continue}le--}if(ee)throw Error("Found an unpaired surrogate");he=65533}ie[ce++]=he>>12|224,ie[ce++]=he>>6&63|128}ie[ce++]=63&he|128}}B=ie.subarray(0,ce)}on(x.g,8*z+2),on(x.g,B.length),Bn(x,x.g.end()),Bn(x,B)}}),_u=go(function(x,B,z,ee,ce){if(x.h!==2)return!1;B=Un(B,z,ee),z=x.g.i,ee=un(x.g)>>>0;var ie=x.g.g+ee,le=ie-z;if(0>=le&&(x.g.i=ie,ce(B,x),le=ie-x.g.g),le)throw Error("Message parsing ended unexpectedly. Expected to read "+ee+" bytes, instead read "+(ee-le)+" bytes, either the data ended unexpectedly or the message misreported its own length");return x.g.g=ie,x.g.i=z,!0},function(x,B,z,ee,ce){if((B=Ic(B,ee,z))!=null)for(ee=0;ee<B.length;ee++){var ie=x;on(ie.g,8*z+2);var le=ie.g.end();Bn(ie,le),le.push(ie.h),ie=le,ce(B[ee],x),le=x;var he=ie.pop();for(he=le.h+le.g.length()-he;127<he;)ie.push(127&he|128),he>>>=7,le.h++;ie.push(he),le.h++}});function Js(){ba.apply(this,arguments)}if(v(Js,ba),du){var Qd={};Object.defineProperties(Js,(Qd[Symbol.hasInstance]=wa(Object[Symbol.hasInstance]),Qd))}function Oa(x){Js.call(this,x)}function Zd(){return[1,Mr,2,Eo,3,Jd,4,Jd]}function xl(x){Js.call(this,x,-1,tf)}function ef(){return[1,_u,Oa,Zd]}v(Oa,Js),v(xl,Js),xl.prototype.addClassification=function(x,B){return Un(this,1,Oa,x,B),this};var tf=[1];function Ja(x){Js.call(this,x)}function wc(){return[1,Eo,2,Eo,3,Eo,4,Eo,5,Eo]}function kl(x){Js.call(this,x,-1,nf)}function Dl(){return[1,_u,Ja,wc]}v(Ja,Js),v(kl,Js);var nf=[1];function Rc(x){Js.call(this,x)}function Pl(){return[1,Eo,2,Eo,3,Eo,4,Eo,5,Eo,6,Zp]}v(Rc,Js);var yu=[[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]],Ll=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],Ml=[[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]],$l=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],Fl=[[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]],eh=[[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]],th=[].concat(d(yu),d(Ll),d(Ml),d($l),d(Fl),d(eh));function P(x,B,z){if(z=x.createShader(z===0?x.VERTEX_SHADER:x.FRAGMENT_SHADER),x.shaderSource(z,B),x.compileShader(z),!x.getShaderParameter(z,x.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+x.getShaderInfoLog(z));return z}function V(x){return Ic(x,Oa,1).map(function(B){return{index:Cc(B,1),ga:ws(B,2),label:is(B,3)!=null?bl(B,3):void 0,displayName:is(B,4)!=null?bl(B,4):void 0}})}function W(x){return{x:ws(x,1),y:ws(x,2),z:ws(x,3),visibility:is(x,4)!=null?ws(x,4):void 0}}function ue(x,B){this.h=x,this.g=B,this.l=0}function Se(x,B,z){return function(ee,ce){var ie=ee.g;if(ee.o===void 0){var le=P(ie,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),he=P(ie,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),be=ie.createProgram();if(ie.attachShader(be,le),ie.attachShader(be,he),ie.linkProgram(be),!ie.getProgramParameter(be,ie.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+ie.getProgramInfoLog(be));le=ee.o=be,ie.useProgram(le),he=ie.getUniformLocation(le,"sampler0"),ee.j={K:ie.getAttribLocation(le,"aVertex"),J:ie.getAttribLocation(le,"aTex"),ma:he},ee.u=ie.createBuffer(),ie.bindBuffer(ie.ARRAY_BUFFER,ee.u),ie.enableVertexAttribArray(ee.j.K),ie.vertexAttribPointer(ee.j.K,2,ie.FLOAT,!1,0,0),ie.bufferData(ie.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),ie.STATIC_DRAW),ie.bindBuffer(ie.ARRAY_BUFFER,null),ee.s=ie.createBuffer(),ie.bindBuffer(ie.ARRAY_BUFFER,ee.s),ie.enableVertexAttribArray(ee.j.J),ie.vertexAttribPointer(ee.j.J,2,ie.FLOAT,!1,0,0),ie.bufferData(ie.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),ie.STATIC_DRAW),ie.bindBuffer(ie.ARRAY_BUFFER,null),ie.uniform1i(he,0)}le=ee.j,ie.useProgram(ee.o),ie.canvas.width=ce.width,ie.canvas.height=ce.height,ie.viewport(0,0,ce.width,ce.height),ie.activeTexture(ie.TEXTURE0),ee.h.bindTexture2d(ce.glName),ie.enableVertexAttribArray(le.K),ie.bindBuffer(ie.ARRAY_BUFFER,ee.u),ie.vertexAttribPointer(le.K,2,ie.FLOAT,!1,0,0),ie.enableVertexAttribArray(le.J),ie.bindBuffer(ie.ARRAY_BUFFER,ee.s),ie.vertexAttribPointer(le.J,2,ie.FLOAT,!1,0,0),ie.bindFramebuffer(ie.DRAW_FRAMEBUFFER?ie.DRAW_FRAMEBUFFER:ie.FRAMEBUFFER,null),ie.clearColor(0,0,0,0),ie.clear(ie.COLOR_BUFFER_BIT),ie.colorMask(!0,!0,!0,!0),ie.drawArrays(ie.TRIANGLE_FAN,0,4),ie.disableVertexAttribArray(le.K),ie.disableVertexAttribArray(le.J),ie.bindBuffer(ie.ARRAY_BUFFER,null),ee.h.bindTexture2d(0)}(x,B),typeof x.g.canvas.transferToImageBitmap=="function"?Promise.resolve(x.g.canvas.transferToImageBitmap()):z?Promise.resolve(x.g.canvas):typeof createImageBitmap=="function"?createImageBitmap(x.g.canvas):(x.i===void 0&&(x.i=document.createElement("canvas")),new Promise(function(ee){x.i.height=x.g.canvas.height,x.i.width=x.g.canvas.width,x.i.getContext("2d",{}).drawImage(x.g.canvas,0,0,x.g.canvas.width,x.g.canvas.height),ee(x.i)}))}function Be(x){this.g=x}var Re=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function We(x,B){return B+x}function rt(x,B){window[x]=B}function _t(x){if(this.g=x,this.listeners={},this.j={},this.H={},this.o={},this.u={},this.I=this.s=this.Z=!0,this.D=Promise.resolve(),this.Y="",this.C={},this.locateFile=x&&x.locateFile||We,typeof window=="object")var B=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if(typeof location>"u")throw Error("solutions can only be loaded on a web page or in a web worker");B=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.$=B,x.options)for(var z=(B=l(Object.keys(x.options))).next();!z.done;z=B.next()){z=z.value;var ee=x.options[z].default;ee!==void 0&&(this.j[z]=typeof ee=="function"?ee():ee)}}function zt(x){var B,z,ee,ce,ie,le,he,be,je,qe,st;return H(function(ut){switch(ut.g){case 1:return x.Z?(B=x.g.files===void 0?[]:typeof x.g.files=="function"?x.g.files(x.j):x.g.files,R(ut,H(function(ft){switch(ft.g){case 1:return ft.o=2,R(ft,WebAssembly.instantiate(Re),4);case 4:ft.g=3,ft.o=0;break;case 2:return ft.o=0,ft.j=null,ft.return(!1);case 3:return ft.return(!0)}}),2)):ut.return();case 2:if(z=ut.h,typeof window=="object")return rt("createMediapipeSolutionsWasm",{locateFile:x.locateFile}),rt("createMediapipeSolutionsPackedAssets",{locateFile:x.locateFile}),le=B.filter(function(ft){return ft.data!==void 0}),he=B.filter(function(ft){return ft.data===void 0}),be=Promise.all(le.map(function(ft){var Bt=vn(x,ft.url);if(ft.path!==void 0){var tn=ft.path;Bt=Bt.then(function(Gn){return x.overrideFile(tn,Gn),Promise.resolve(Gn)})}return Bt})),je=Promise.all(he.map(function(ft){return ft.simd===void 0||ft.simd&&z||!ft.simd&&!z?function(Bt){var tn=document.createElement("script");return tn.setAttribute("src",Bt),tn.setAttribute("crossorigin","anonymous"),new Promise(function(Gn){tn.addEventListener("load",function(){Gn()},!1),tn.addEventListener("error",function(){Gn()},!1),document.body.appendChild(tn)})}(x.locateFile(ft.url,x.$)):Promise.resolve()})).then(function(){var ft,Bt,tn;return H(function(Gn){if(Gn.g==1)return ft=window.createMediapipeSolutionsWasm,Bt=window.createMediapipeSolutionsPackedAssets,tn=x,R(Gn,ft(Bt),2);tn.h=Gn.h,Gn.g=0})}),qe=H(function(ft){return x.g.graph&&x.g.graph.url?ft=R(ft,vn(x,x.g.graph.url),0):(ft.g=0,ft=void 0),ft}),R(ut,Promise.all([je,be,qe]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return ee=B.filter(function(ft){return ft.simd===void 0||ft.simd&&z||!ft.simd&&!z}).map(function(ft){return x.locateFile(ft.url,x.$)}),importScripts.apply(null,d(ee)),ce=x,R(ut,createMediapipeSolutionsWasm(Module),6);case 6:ce.h=ut.h,x.l=new OffscreenCanvas(1,1),x.h.canvas=x.l,ie=x.h.GL.createContext(x.l,{antialias:!1,alpha:!1,ja:typeof WebGL2RenderingContext<"u"?2:1}),x.h.GL.makeContextCurrent(ie),ut.g=4;break;case 7:if(x.l=document.createElement("canvas"),!(st=x.l.getContext("webgl2",{}))&&!(st=x.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),ut.return();x.G=st,x.h.canvas=x.l,x.h.createContext(x.l,!0,!0,{});case 4:x.i=new x.h.SolutionWasm,x.Z=!1,ut.g=0}})}function vn(x,B){var z,ee;return H(function(ce){return B in x.H?ce.return(x.H[B]):(z=x.locateFile(B,""),ee=fetch(z).then(function(ie){return ie.arrayBuffer()}),x.H[B]=ee,ce.return(ee))})}function an(x,B,z){var ee,ce,ie,le,he,be,je,qe,st,ut,ft,Bt,tn,Gn;return H(function(sr){switch(sr.g){case 1:if(!z)return sr.return(B);for(ee={},ce=0,ie=l(Object.keys(z)),le=ie.next();!le.done;le=ie.next())he=le.value,typeof(be=z[he])!="string"&&be.type==="texture"&&B[be.stream]!==void 0&&++ce;1<ce&&(x.I=!1),je=l(Object.keys(z)),le=je.next();case 2:if(le.done){sr.g=4;break}if(qe=le.value,typeof(st=z[qe])=="string")return tn=ee,Gn=qe,R(sr,function(bc,Eg,vu){var nh;return H(function(Za){return typeof vu=="number"||vu instanceof Uint8Array||vu instanceof bc.h.Uint8BlobList?Za.return(vu):vu instanceof bc.h.Texture2dDataOut?((nh=bc.u[Eg])||(nh=new ue(bc.h,bc.G),bc.u[Eg]=nh),Za.return(Se(nh,vu,bc.I))):Za.return(void 0)})}(x,qe,B[st]),14);if(ut=B[st.stream],st.type==="detection_list"){if(ut){for(var Qs=ut.getRectList(),Xo=ut.getLandmarksList(),_o=ut.getClassificationsList(),gn=[],es=0;es<Qs.size();++es){var Qa=gu(Qs.get(es),Rc,Pl);Qa={boundingBox:{xCenter:ws(Qa,1),yCenter:ws(Qa,2),height:ws(Qa,3),width:ws(Qa,4),rotation:ws(Qa,5,0),rectId:Cc(Qa,6)},landmarks:Ic(gu(Xo.get(es),kl,Dl),Ja,1).map(W),V:V(gu(_o.get(es),xl,ef))},gn.push(Qa)}Qs=gn}else Qs=[];ee[qe]=Qs,sr.g=7;break}if(st.type==="proto_list"){if(ut){for(Qs=Array(ut.size()),Xo=0;Xo<ut.size();Xo++)Qs[Xo]=ut.get(Xo);ut.delete()}else Qs=[];ee[qe]=Qs,sr.g=7;break}if(ut===void 0){sr.g=3;break}if(st.type==="float_list"){ee[qe]=ut,sr.g=7;break}if(st.type==="proto"){ee[qe]=ut,sr.g=7;break}if(st.type!=="texture")throw Error("Unknown output config type: '"+st.type+"'");return(ft=x.u[qe])||(ft=new ue(x.h,x.G),x.u[qe]=ft),R(sr,Se(ft,ut,x.I),13);case 13:Bt=sr.h,ee[qe]=Bt;case 7:st.transform&&ee[qe]&&(ee[qe]=st.transform(ee[qe])),sr.g=3;break;case 14:tn[Gn]=sr.h;case 3:le=je.next(),sr.g=2;break;case 4:return sr.return(ee)}})}function Xt(x,B){for(var z=B.name||"$",ee=[].concat(d(B.wants)),ce=new x.h.StringList,ie=l(B.wants),le=ie.next();!le.done;le=ie.next())ce.push_back(le.value);ie=x.h.PacketListener.implement({onResults:function(he){for(var be={},je=0;je<B.wants.length;++je)be[ee[je]]=he.get(je);var qe=x.listeners[z];qe&&(x.D=an(x,be,B.outs).then(function(st){st=qe(st);for(var ut=0;ut<B.wants.length;++ut){var ft=be[ee[ut]];typeof ft=="object"&&ft.hasOwnProperty&&ft.hasOwnProperty("delete")&&ft.delete()}st&&(x.D=st)}))}}),x.i.attachMultiListener(ce,ie),ce.delete()}function Nt(x){var B=this;x=x||{};var z={url:"face_detection_short.binarypb"},ee={type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"facedetectionshortrangegpu__facedetectionshortrangecommon__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}};this.g=new _t({locateFile:x.locateFile,files:[{data:!0,url:"face_detection_short.binarypb"},{data:!0,url:"face_detection_short_range.tflite"},{simd:!0,url:"face_detection_solution_simd_wasm_bin.js"},{simd:!1,url:"face_detection_solution_wasm_bin.js"}],graph:z,listeners:[{wants:["detections","image_transformed"],outs:{image:"image_transformed",detections:{type:"detection_list",stream:"detections"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:typeof window=="object"&&window.navigator!==void 0&&("iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document)},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},model:{type:0,onChange:function(ce){var ie,le,he,be,je;return H(function(qe){switch(qe.g){case 1:ie=l(ce==="short"?["face_detection_short_range.tflite"]:["face_detection_full_range_sparse.tflite"]),le=ie.next();case 2:if(le.done){qe.g=4;break}return he=le.value,be="third_party/mediapipe/modules/face_detection/"+he,R(qe,vn(B.g,he),5);case 5:je=qe.h,B.g.overrideFile(be,je),le=ie.next(),qe.g=2;break;case 4:return z.url=ce==="short"?"face_detection_short.binarypb":"face_detection_full.binarypb",ee.graphOptionXref.calculatorName=ce==="short"?"facedetectionshortrangegpu__facedetectionshortrangecommon__TensorsToDetectionsCalculator":"facedetectionfullrangegpu__facedetectionfullrangecommon__TensorsToDetectionsCalculator",qe.return(!0)}})}},minDetectionConfidence:ee}})}(t=_t.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},t.reset=function(){var x=this;return H(function(B){x.i&&(x.i.reset(),x.o={},x.u={}),B.g=0})},t.setOptions=function(x,B){var z=this;if(B=B||this.g.options){for(var ee=[],ce=[],ie={},le=l(Object.keys(x)),he=le.next();!he.done;ie={R:ie.R,S:ie.S},he=le.next()){var be=he.value;be in this.j&&this.j[be]===x[be]||(this.j[be]=x[be],(he=B[be])!==void 0&&(he.onChange&&(ie.R=he.onChange,ie.S=x[be],ee.push(function(je){return function(){return H(function(qe){if(qe.g==1)return R(qe,je.R(je.S),2);qe.h===!0&&(z.s=!0),qe.g=0})}}(ie))),he.graphOptionXref&&(be={valueNumber:he.type===1?x[be]:0,valueBoolean:he.type===0&&x[be],valueString:he.type===2?x[be]:""},he=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),he.graphOptionXref),be),ce.push(he))))}ee.length===0&&ce.length===0||(this.s=!0,this.B=(this.B===void 0?[]:this.B).concat(ce),this.A=(this.A===void 0?[]:this.A).concat(ee))}},t.initialize=function(){var x=this;return H(function(B){return B.g==1?R(B,zt(x),2):B.g!=3?R(B,function(z){var ee,ce,ie,le,he,be,je,qe;return H(function(st){if(st.g==1)return z.g.graph&&z.g.graph.url&&z.Y===z.g.graph.url?st.return():(z.s=!0,z.g.graph&&z.g.graph.url?(z.Y=z.g.graph.url,R(st,vn(z,z.g.graph.url),3)):void(st.g=2));for(st.g!=2&&(ee=st.h,z.i.loadGraph(ee)),ce=l(Object.keys(z.C)),ie=ce.next();!ie.done;ie=ce.next())le=ie.value,z.i.overrideFile(le,z.C[le]);if(z.C={},z.g.listeners)for(he=l(z.g.listeners),be=he.next();!be.done;be=he.next())je=be.value,Xt(z,je);qe=z.j,z.j={},z.setOptions(qe),st.g=0})}(x),3):R(B,function(z){var ee,ce,ie,le,he,be;return H(function(je){switch(je.g){case 1:if(!z.s)return je.return();if(!z.A){je.g=2;break}ee=l(z.A),ce=ee.next();case 3:if(ce.done){je.g=5;break}return R(je,(0,ce.value)(),4);case 4:ce=ee.next(),je.g=3;break;case 5:z.A=void 0;case 2:if(z.B){for(ie=new z.h.GraphOptionChangeRequestList,le=l(z.B),he=le.next();!he.done;he=le.next())be=he.value,ie.push_back(be);z.i.changeOptions(ie),ie.delete(),z.B=void 0}z.s=!1,je.g=0}})}(x),0)})},t.overrideFile=function(x,B){this.i?this.i.overrideFile(x,B):this.C[x]=B},t.clearOverriddenFiles=function(){this.C={},this.i&&this.i.clearOverriddenFiles()},t.send=function(x,B){var z,ee,ce,ie,le,he,be,je,qe,st=this;return H(function(ut){switch(ut.g){case 1:return st.g.inputs?(z=1e3*(B??performance.now()),R(ut,st.D,2)):ut.return();case 2:return R(ut,st.initialize(),3);case 3:for(ee=new st.h.PacketDataList,ce=l(Object.keys(x)),ie=ce.next();!ie.done;ie=ce.next())if(le=ie.value,he=st.g.inputs[le]){e:{var ft=x[le];switch(he.type){case"video":var Bt=st.o[he.stream];if(Bt||(Bt=new ue(st.h,st.G),st.o[he.stream]=Bt),Bt.l===0&&(Bt.l=Bt.h.createTexture()),typeof HTMLVideoElement<"u"&&ft instanceof HTMLVideoElement)var tn=ft.videoWidth,Gn=ft.videoHeight;else typeof HTMLImageElement<"u"&&ft instanceof HTMLImageElement?(tn=ft.naturalWidth,Gn=ft.naturalHeight):(tn=ft.width,Gn=ft.height);Gn={glName:Bt.l,width:tn,height:Gn},(tn=Bt.g).canvas.width=Gn.width,tn.canvas.height=Gn.height,tn.activeTexture(tn.TEXTURE0),Bt.h.bindTexture2d(Bt.l),tn.texImage2D(tn.TEXTURE_2D,0,tn.RGBA,tn.RGBA,tn.UNSIGNED_BYTE,ft),Bt.h.bindTexture2d(0),Bt=Gn;break e;case"detections":for((Bt=st.o[he.stream])||(Bt=new Be(st.h),st.o[he.stream]=Bt),Bt.data||(Bt.data=new Bt.g.DetectionListData),Bt.data.reset(ft.length),Gn=0;Gn<ft.length;++Gn){tn=ft[Gn];var sr=Bt.data,Qs=sr.setBoundingBox,Xo=Gn,_o=tn.boundingBox,gn=new Rc;if(yr(gn,1,_o.xCenter),yr(gn,2,_o.yCenter),yr(gn,3,_o.height),yr(gn,4,_o.width),yr(gn,5,_o.rotation),yr(gn,6,_o.rectId),_o=Si(gn,Pl),Qs.call(sr,Xo,_o),tn.landmarks)for(sr=0;sr<tn.landmarks.length;++sr){var es=!!(gn=tn.landmarks[sr]).visibility;Xo=(Qs=Bt.data).addNormalizedLandmark,_o=Gn,gn=Object.assign(Object.assign({},gn),{visibility:es?gn.visibility:0}),yr(es=new Ja,1,gn.x),yr(es,2,gn.y),yr(es,3,gn.z),gn.visibility&&yr(es,4,gn.visibility),gn=Si(es,wc),Xo.call(Qs,_o,gn)}if(tn.V)for(sr=0;sr<tn.V.length;++sr)Xo=(Qs=Bt.data).addClassification,_o=Gn,gn=tn.V[sr],yr(es=new Oa,2,gn.ga),gn.index&&yr(es,1,gn.index),gn.label&&yr(es,3,gn.label),gn.displayName&&yr(es,4,gn.displayName),gn=Si(es,Zd),Xo.call(Qs,_o,gn)}Bt=Bt.data;break e;default:Bt={}}}switch(be=Bt,je=he.stream,he.type){case"video":ee.pushTexture2d(Object.assign(Object.assign({},be),{stream:je,timestamp:z}));break;case"detections":(qe=be).stream=je,qe.timestamp=z,ee.pushDetectionList(qe);break;default:throw Error("Unknown input config type: '"+he.type+"'")}}return st.i.send(ee),R(ut,st.D,4);case 4:ee.delete(),ut.g=0}})},t.onResults=function(x,B){this.listeners[B||"$"]=x},oe("Solution",_t),oe("OptionType",{BOOL:0,NUMBER:1,ia:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(t=Nt.prototype).close=function(){return this.g.close(),Promise.resolve()},t.onResults=function(x){this.g.onResults(x)},t.initialize=function(){var x=this;return H(function(B){return R(B,x.g.initialize(),0)})},t.reset=function(){this.g.reset()},t.send=function(x){var B=this;return H(function(z){return R(z,B.g.send(x),0)})},t.setOptions=function(x){this.g.setOptions(x)},oe("FaceDetection",Nt),oe("FACEDETECTION_LIPS",yu),oe("FACEDETECTION_LEFT_EYE",Ll),oe("FACEDETECTION_LEFT_EYEBROW",Ml),oe("FACEDETECTION_RIGHT_EYE",$l),oe("FACEDETECTION_RIGHT_EYEBROW",Fl),oe("FACEDETECTION_FACE_OVAL",eh),oe("FACEDETECTION_CONTOURS",th),oe("FACEDETECTION_TESSELATION",[[127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]]),oe("VERSION","0.4.1646425229")}).call(nI);var ml=function(){return ml=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},ml.apply(this,arguments)};function su(t,e,n,s){return new(n||(n=Promise))(function(i,c){function l(f){try{p(s.next(f))}catch(m){c(m)}}function d(f){try{p(s.throw(f))}catch(m){c(m)}}function p(f){var m;f.done?i(f.value):(m=f.value,m instanceof n?m:new n(function(_){_(m)})).then(l,d)}p((s=s.apply(t,e||[])).next())})}function ou(t,e){var n,s,i,c,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return c={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function d(p){return function(f){return function(m){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,s&&(i=2&m[0]?s.return:m[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,m[1])).done)return i;switch(s=0,i&&(m=[2&m[0],i.value]),m[0]){case 0:case 1:i=m;break;case 4:return l.label++,{value:m[1],done:!1};case 5:l.label++,s=m[1],m=[0];continue;case 7:m=l.ops.pop(),l.trys.pop();continue;default:if(!((i=(i=l.trys).length>0&&i[i.length-1])||m[0]!==6&&m[0]!==2)){l=0;continue}if(m[0]===3&&(!i||m[1]>i[0]&&m[1]<i[3])){l.label=m[1];break}if(m[0]===6&&l.label<i[1]){l.label=i[1],i=m;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(m);break}i[2]&&l.ops.pop(),l.trys.pop();continue}m=e.call(t,l)}catch(_){m=[6,_],s=0}finally{n=i=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([p,f])}}}var gV=["rightEye","leftEye","noseTip","mouthCenter","rightEarTragion","leftEarTragion"],rI={modelType:"short",runtime:"mediapipe",maxFaces:1},mue=function(){function t(e){var n=this;this.width=0,this.height=0,this.selfieMode=!1,this.faceDetectorSolution=new fue.FaceDetection({locateFile:function(s,i){return e.solutionPath?e.solutionPath.replace(/\/+$/,"")+"/"+s:i+"/"+s}}),this.faceDetectorSolution.setOptions({selfieMode:this.selfieMode,model:e.modelType}),this.faceDetectorSolution.onResults(function(s){if(n.height=s.image.height,n.width=s.image.width,n.faces=[],s.detections!==null)for(var i=0,c=s.detections;i<c.length;i++){var l=c[i];n.faces.push(n.normalizedToAbsolute(l.landmarks,{xMin:p=(d=l.boundingBox).xCenter-d.width/2,xMax:p+d.width,yMin:f=d.yCenter-d.height/2,yMax:f+d.height,width:d.width,height:d.height}))}var d,p,f})}return t.prototype.normalizedToAbsolute=function(e,n){var s=this;return{keypoints:e.map(function(i,c){return{x:i.x*s.width,y:i.y*s.height,name:gV[c]}}),box:{xMin:n.xMin*this.width,yMin:n.yMin*this.height,xMax:n.xMax*this.width,yMax:n.yMax*this.height,width:n.width*this.width,height:n.height*this.height}}},t.prototype.estimateFaces=function(e,n){return su(this,void 0,void 0,function(){var s,i;return ou(this,function(c){switch(c.label){case 0:return n&&n.flipHorizontal&&n.flipHorizontal!==this.selfieMode&&(this.selfieMode=n.flipHorizontal,this.faceDetectorSolution.setOptions({selfieMode:this.selfieMode})),e instanceof Br?(i=ImageData.bind,[4,H6(e)]):[3,2];case 1:return s=new(i.apply(ImageData,[void 0,c.sent(),e.shape[1],e.shape[0]])),[3,3];case 2:s=e,c.label=3;case 3:return e=s,[4,this.faceDetectorSolution.send({image:e})];case 4:return c.sent(),[2,this.faces]}})})},t.prototype.dispose=function(){this.faceDetectorSolution.close()},t.prototype.reset=function(){this.faceDetectorSolution.reset(),this.width=0,this.height=0,this.faces=null,this.selfieMode=!1},t.prototype.initialize=function(){return this.faceDetectorSolution.initialize()},t}();function gue(t){return su(this,void 0,void 0,function(){var e,n;return ou(this,function(s){switch(s.label){case 0:return e=function(i){if(i==null)return ml({},rI);var c=ml({},i);return c.runtime="mediapipe",c.modelType==null&&(c.modelType=rI.modelType),c.maxFaces==null&&(c.maxFaces=rI.maxFaces),c}(t),[4,(n=new mue(e)).initialize()];case 1:return s.sent(),[2,n]}})})}function EV(t){return t instanceof Br?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function _V(t){return t instanceof Br?t:K6(t)}function sI(t,e){se(t.width!==0,function(){return e+" width cannot be 0."}),se(t.height!==0,function(){return e+" height cannot be 0."})}function Eue(t,e,n){var s=e.outputTensorSize,i=e.keepAspectRatio,c=e.borderMode,l=e.outputTensorFloatRange,d=EV(t),p=function(y,v){return v?{xCenter:v.xCenter*y.width,yCenter:v.yCenter*y.height,width:v.width*y.width,height:v.height*y.height,rotation:v.rotation}:{xCenter:.5*y.width,yCenter:.5*y.height,width:y.width,height:y.height,rotation:0}}(d,n),f=function(y,v,I){if(I===void 0&&(I=!1),!I)return{top:0,left:0,right:0,bottom:0};var b=v.height,A=v.width;sI(v,"targetSize"),sI(y,"roi");var R,O,L=b/A,$=y.height/y.width,G=0,H=0;return L>$?(R=y.width,O=y.width*L,H=(1-$/L)/2):(R=y.height/L,O=y.height,G=(1-L/$)/2),y.width=R,y.height=O,{top:H,left:G,right:G,bottom:H}}(p,s,i),m=function(y,v,I,b){var A=y.width,R=y.height,O=b?-1:1,L=Math.cos(y.rotation),$=Math.sin(y.rotation),G=y.xCenter,H=y.yCenter,Z=1/v,re=1/I,oe=new Array(16);return oe[0]=A*L*O*Z,oe[1]=-R*$*Z,oe[2]=0,oe[3]=(-.5*A*L*O+.5*R*$+G)*Z,oe[4]=A*$*O*re,oe[5]=R*L*re,oe[6]=0,oe[7]=(-.5*R*L-.5*A*$*O+H)*re,oe[8]=0,oe[9]=0,oe[10]=A*Z,oe[11]=0,oe[12]=0,oe[13]=0,oe[14]=0,oe[15]=1,function(ae){if(ae.length!==16)throw new Error("Array length must be 16 but got "+ae.length);return[[ae[0],ae[1],ae[2],ae[3]],[ae[4],ae[5],ae[6],ae[7]],[ae[8],ae[9],ae[10],ae[11]],[ae[12],ae[13],ae[14],ae[15]]]}(oe)}(p,d.width,d.height,!1),_=Xr(function(){var y=_V(t),v=ll(function(A,R,O){return sI(O,"inputResolution"),[1/O.width*A[0][0]*R.width,1/O.height*A[0][1]*R.width,A[0][3]*R.width,1/O.width*A[1][0]*R.height,1/O.height*A[1][1]*R.height,A[1][3]*R.height,0,0]}(m,d,s),[1,8]),I=c==="zero"?"constant":"nearest",b=jp.transform(Ba(jr(y,"float32")),v,"bilinear",I,0,[s.height,s.width]);return l!=null?function(A,R){var O=function(L,$,G,H){var Z=(H-G)/255;return{scale:Z,offset:G-0*Z}}(0,0,R[0],R[1]);return Xr(function(){return mr(Vt(A,O.scale),O.offset)})}(b,l):b});return{imageTensor:_,padding:f,transformationMatrix:m}}function GM(t){t.reduceBoxesInLowestLayer==null&&(t.reduceBoxesInLowestLayer=!1),t.interpolatedScaleAspectRatio==null&&(t.interpolatedScaleAspectRatio=1),t.fixedAnchorSize==null&&(t.fixedAnchorSize=!1);for(var e=[],n=0;n<t.numLayers;){for(var s=[],i=[],c=[],l=[],d=n;d<t.strides.length&&t.strides[d]===t.strides[n];){var p=zM(t.minScale,t.maxScale,d,t.strides.length);if(d===0&&t.reduceBoxesInLowestLayer)c.push(1),c.push(2),c.push(.5),l.push(.1),l.push(p),l.push(p);else{for(var f=0;f<t.aspectRatios.length;++f)c.push(t.aspectRatios[f]),l.push(p);if(t.interpolatedScaleAspectRatio>0){var m=d===t.strides.length-1?1:zM(t.minScale,t.maxScale,d+1,t.strides.length);l.push(Math.sqrt(p*m)),c.push(t.interpolatedScaleAspectRatio)}}d++}for(var _=0;_<c.length;++_){var y=Math.sqrt(c[_]);s.push(l[_]/y),i.push(l[_]*y)}var v=0,I=0;if(t.featureMapHeight.length>0)v=t.featureMapHeight[n],I=t.featureMapWidth[n];else{var b=t.strides[n];v=Math.ceil(t.inputSizeHeight/b),I=Math.ceil(t.inputSizeWidth/b)}for(var A=0;A<v;++A)for(var R=0;R<I;++R)for(var O=0;O<s.length;++O){var L={xCenter:(R+t.anchorOffsetX)/I,yCenter:(A+t.anchorOffsetY)/v,width:0,height:0};t.fixedAnchorSize?(L.width=1,L.height=1):(L.width=i[O],L.height=s[O]),e.push(L)}n=d}return e}function zM(t,e,n,s){return s===1?.5*(t+e):t+(e-t)*n/(s-1)}function HM(t,e){var n=e[0],s=e[1];return[n*t[0]+s*t[1]+t[3],n*t[4]+s*t[5]+t[7]]}function _ue(t,e,n,s){return su(this,void 0,void 0,function(){var i,c,l,d,p;return ou(this,function(f){switch(f.label){case 0:return t.sort(function(m,_){return Math.max.apply(Math,_.score)-Math.max.apply(Math,m.score)}),i=ll(t.map(function(m){return[m.locationData.relativeBoundingBox.yMin,m.locationData.relativeBoundingBox.xMin,m.locationData.relativeBoundingBox.yMax,m.locationData.relativeBoundingBox.xMax]})),c=Po(t.map(function(m){return m.score[0]})),[4,jp.nonMaxSuppressionAsync(i,c,e,n)];case 1:return[4,(l=f.sent()).array()];case 2:return d=f.sent(),p=t.filter(function(m,_){return d.indexOf(_)>-1}),mc([i,c,l]),[2,p]}})})}function yue(t,e,n){return su(this,void 0,void 0,function(){var s,i,c,l,d;return ou(this,function(p){switch(p.label){case 0:return s=t[0],i=t[1],c=function(f,m,_){return Xr(function(){var y,v,I,b;_.reverseOutputOrder?(v=Os(hn(f,[0,_.boxCoordOffset+0],[-1,1])),y=Os(hn(f,[0,_.boxCoordOffset+1],[-1,1])),b=Os(hn(f,[0,_.boxCoordOffset+2],[-1,1])),I=Os(hn(f,[0,_.boxCoordOffset+3],[-1,1]))):(y=Os(hn(f,[0,_.boxCoordOffset+0],[-1,1])),v=Os(hn(f,[0,_.boxCoordOffset+1],[-1,1])),I=Os(hn(f,[0,_.boxCoordOffset+2],[-1,1])),b=Os(hn(f,[0,_.boxCoordOffset+3],[-1,1]))),v=mr(Vt(ar(v,_.xScale),m.w),m.x),y=mr(Vt(ar(y,_.yScale),m.h),m.y),_.applyExponentialOnBoxSize?(I=Vt(eu(ar(I,_.hScale)),m.h),b=Vt(eu(ar(b,_.wScale)),m.w)):(I=Vt(ar(I,_.hScale),m.h),b=Vt(ar(b,_.wScale),m.h));var A=An(y,ar(I,2)),R=An(v,ar(b,2)),O=mr(y,ar(I,2)),L=mr(v,ar(b,2)),$=Ks([ze(A,[_.numBoxes,1]),ze(R,[_.numBoxes,1]),ze(O,[_.numBoxes,1]),ze(L,[_.numBoxes,1])],1);if(_.numKeypoints)for(var G=0;G<_.numKeypoints;++G){var H=_.keypointCoordOffset+G*_.numValuesPerKeypoint,Z=void 0,re=void 0;_.reverseOutputOrder?(Z=Os(hn(f,[0,H],[-1,1])),re=Os(hn(f,[0,H+1],[-1,1]))):(re=Os(hn(f,[0,H],[-1,1])),Z=Os(hn(f,[0,H+1],[-1,1])));var oe=mr(Vt(ar(Z,_.xScale),m.w),m.x),ae=mr(Vt(ar(re,_.yScale),m.h),m.y);$=Ks([$,ze(oe,[_.numBoxes,1]),ze(ae,[_.numBoxes,1])],1)}return $})}(i,e,n),l=Xr(function(){var f=s;return n.sigmoidScore?(n.scoreClippingThresh!=null&&(f=c5(s,-n.scoreClippingThresh,n.scoreClippingThresh)),f=Sd(f)):f}),[4,vue(c,l,n)];case 1:return d=p.sent(),mc([c,l]),[2,d]}})})}function vue(t,e,n){return su(this,void 0,void 0,function(){var s,i,c,l,d,p,f,m,_,y,v,I;return ou(this,function(b){switch(b.label){case 0:return s=[],[4,t.data()];case 1:return i=b.sent(),[4,e.data()];case 2:for(c=b.sent(),l=0;l<n.numBoxes;++l)if(!(n.minScoreThresh!=null&&c[l]<n.minScoreThresh||(d=l*n.numCoords,p=Sue(i[d+0],i[d+1],i[d+2],i[d+3],c[l],n.flipVertically,l),(f=p.locationData.relativeBoundingBox).width<0||f.height<0))){if(n.numKeypoints>0)for((m=p.locationData).relativeKeypoints=[],_=n.numKeypoints*n.numValuesPerKeypoint,y=0;y<_;y+=n.numValuesPerKeypoint)v=d+n.keypointCoordOffset+y,I={x:i[v+0],y:n.flipVertically?1-i[v+1]:i[v+1]},m.relativeKeypoints.push(I);s.push(p)}return[2,s]}})})}function Sue(t,e,n,s,i,c,l){return{score:[i],ind:l,locationData:{relativeBoundingBox:{xMin:e,yMin:c?1-n:t,xMax:s,yMax:c?1-t:n,width:s-e,height:n-t}}}}var g1,Tue={reduceBoxesInLowestLayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:4,minScale:.1484375,maxScale:.75,inputSizeHeight:128,inputSizeWidth:128,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,16,16],aspectRatios:[1],fixedAnchorSize:!0},Iue={reduceBoxesInLowestLayer:!1,interpolatedScaleAspectRatio:0,featureMapHeight:[],featureMapWidth:[],numLayers:1,minScale:.1484375,maxScale:.75,inputSizeHeight:192,inputSizeWidth:192,anchorOffsetX:.5,anchorOffsetY:.5,strides:[4],aspectRatios:[1],fixedAnchorSize:!0},oI={runtime:"tfjs",modelType:"short",maxFaces:1,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/face_detection/short/1"},Cue={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:896,numCoords:16,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:6,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:128,yScale:128,hScale:128,wScale:128,minScoreThresh:.5},wue={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2304,numCoords:16,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:6,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:192,yScale:192,hScale:192,wScale:192,minScoreThresh:.6},Rue={outputTensorSize:{width:128,height:128},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},bue={outputTensorSize:{width:192,height:192},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},Nue=function(){function t(e,n,s){this.detectorModel=n,this.maxFaces=s,e==="full"?(this.imageToTensorConfig=bue,this.tensorsToDetectionConfig=wue,this.anchors=GM(Iue)):(this.imageToTensorConfig=Rue,this.tensorsToDetectionConfig=Cue,this.anchors=GM(Tue));var i=Po(this.anchors.map(function(p){return p.width})),c=Po(this.anchors.map(function(p){return p.height})),l=Po(this.anchors.map(function(p){return p.xCenter})),d=Po(this.anchors.map(function(p){return p.yCenter}));this.anchorTensor={x:l,y:d,w:i,h:c}}return t.prototype.dispose=function(){this.detectorModel.dispose(),mc([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h])},t.prototype.reset=function(){},t.prototype.detectFaces=function(e,n){return n===void 0&&(n=!1),su(this,void 0,void 0,function(){var s,i,c,l,d,p,f,m,_,y,v;return ou(this,function(I){switch(I.label){case 0:return e==null?(this.reset(),[2,[]]):(s=Xr(function(){var b=jr(_V(e),"float32");return n&&(b=Os(jp.flipLeftRight(Ba(b,0)),[0])),b}),i=Eue(s,this.imageToTensorConfig),c=i.imageTensor,l=i.transformationMatrix,d=this.detectorModel.execute(c,"Identity:0"),p=function(b){return Xr(function(){var A=function(L){return Xr(function(){return[hn(L,[0,0,0],[1,-1,1]),hn(L,[0,0,1],[1,-1,-1])]})}(b),R=A[0],O=A[1];return{boxes:Os(O),logits:Os(R)}})}(d),f=p.boxes,[4,yue([m=p.logits,f],this.anchorTensor,this.tensorsToDetectionConfig)]);case 1:return(_=I.sent()).length===0?(mc([s,c,d,m,f]),[2,_]):[4,_ue(_,this.maxFaces,.3)];case 2:return y=I.sent(),v=function(b,A){b===void 0&&(b=[]);var R,O=(R=A,[].concat.apply([],R));return b.forEach(function(L){var $=L.locationData;$.relativeKeypoints.forEach(function(ae){var Ee=HM(O,[ae.x,ae.y]),Ce=Ee[0],ye=Ee[1];ae.x=Ce,ae.y=ye});var G=$.relativeBoundingBox,H=Number.MAX_VALUE,Z=Number.MAX_VALUE,re=Number.MIN_VALUE,oe=Number.MIN_VALUE;[[G.xMin,G.yMin],[G.xMin+G.width,G.yMin],[G.xMin+G.width,G.yMin+G.height],[G.xMin,G.yMin+G.height]].forEach(function(ae){var Ee=HM(O,ae),Ce=Ee[0],ye=Ee[1];H=Math.min(H,Ce),re=Math.max(re,Ce),Z=Math.min(Z,ye),oe=Math.max(oe,ye)}),$.relativeBoundingBox={xMin:H,xMax:re,yMin:Z,yMax:oe,width:re-H,height:oe-Z}}),b}(y,l),mc([s,c,d,m,f]),[2,v]}})})},t.prototype.estimateFaces=function(e,n){return su(this,void 0,void 0,function(){var s,i;return ou(this,function(c){return s=EV(e),i=!!n&&n.flipHorizontal,[2,this.detectFaces(e,i).then(function(l){return l.map(function(d){for(var p=d.locationData.relativeKeypoints.map(function(I,b){return ml(ml({},I),{x:I.x*s.width,y:I.y*s.height,name:gV[b]})}),f=d.locationData.relativeBoundingBox,m=0,_=["width","xMax","xMin"];m<_.length;m++)f[_[m]]*=s.width;for(var y=0,v=["height","yMax","yMin"];y<v.length;y++)f[v[y]]*=s.height;return{keypoints:p,box:f}})})]})})},t}();function Aue(t){return su(this,void 0,void 0,function(){var e,n,s;return ou(this,function(i){switch(i.label){case 0:return e=function(c){if(c==null)return ml({},oI);var l=ml({},c);return l.modelType==null&&(l.modelType=oI.modelType),l.maxFaces==null&&(l.maxFaces=oI.maxFaces),l.detectorModelUrl==null&&(l.modelType==="full"?l.detectorModelUrl="https://tfhub.dev/mediapipe/tfjs-model/face_detection/full/1":l.detectorModelUrl="https://tfhub.dev/mediapipe/tfjs-model/face_detection/short/1"),l}(t),n=typeof e.detectorModelUrl=="string"&&e.detectorModelUrl.indexOf("https://tfhub.dev")>-1,[4,fV(e.detectorModelUrl,{fromTFHub:n})];case 1:return s=i.sent(),[2,new Nue(e.modelType,s,e.maxFaces)]}})})}function Oue(t,e){return su(this,void 0,void 0,function(){var n,s;return ou(this,function(i){if(t===g1.MediaPipeFaceDetector){if(s=void 0,(n=e)!=null){if(n.runtime==="tfjs")return[2,Aue(n)];if(n.runtime==="mediapipe")return[2,gue(n)];s=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+s)}throw new Error(t+" is not a supported model name.")})})}function iI(t){return t.width*t.height}function KM(t){var e=t.xCenter-t.width/2,n=e+t.width,s=t.yCenter-t.height/2;return{xMin:e,xMax:n,yMin:s,yMax:s+t.height,width:t.width,height:t.height}}function xue(t,e){var n=KM(t),s=KM(e);if(!function(l,d){return!(l.xMax<d.xMin||d.xMax<l.xMin||l.yMax<d.yMin||d.yMax<l.yMin)}(n,s))return 0;var i=iI(function(l,d){var p=Math.max(l.xMin,d.xMin),f=Math.min(l.xMax,d.xMax),m=Math.max(l.yMin,d.yMin),_=Math.min(l.yMax,d.yMax);return{xMin:p,xMax:f,yMin:m,yMax:_,width:Math.max(f-p,0),height:Math.max(_-m,0)}}(n,s)),c=iI(n)+iI(s)-i;return c>0?i/c:0}function kue(t,e,n,s){var i=t.width,c=t.height,l=s?-1:1,d=Math.cos(t.rotation),p=Math.sin(t.rotation),f=t.xCenter,m=t.yCenter,_=1/e,y=1/n,v=new Array(16);return v[0]=i*d*l*_,v[1]=-c*p*_,v[2]=0,v[3]=(-.5*i*d*l+.5*c*p+f)*_,v[4]=i*p*l*y,v[5]=c*d*y,v[6]=0,v[7]=(-.5*c*d-.5*i*p*l+m)*y,v[8]=0,v[9]=0,v[10]=i*_,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,function(I){if(I.length!==16)throw new Error("Array length must be 16 but got "+I.length);return[[I[0],I[1],I[2],I[3]],[I[4],I[5],I[6],I[7]],[I[8],I[9],I[10],I[11]],[I[12],I[13],I[14],I[15]]]}(v)}function yV(t){return t instanceof Br?{height:t.shape[0],width:t.shape[1]}:{height:t.height,width:t.width}}function vV(t){return t-2*Math.PI*Math.floor((t+Math.PI)/(2*Math.PI))}function SV(t){return t instanceof Br?t:K6(t)}function aI(t,e){se(t.width!==0,function(){return e+" width cannot be 0."}),se(t.height!==0,function(){return e+" height cannot be 0."})}function Due(t,e){var n=function(s,i,c,l){var d=i-s,p=l-c;if(d===0)throw new Error("Original min and max are both "+s+", range cannot be 0.");var f=p/d;return{scale:f,offset:c-s*f}}(0,255,e[0],e[1]);return Xr(function(){return mr(Vt(t,n.scale),n.offset)})}function Pue(t,e,n){var s=e.outputTensorSize,i=e.keepAspectRatio,c=e.borderMode,l=e.outputTensorFloatRange,d=yV(t),p=function(y,v){return v?{xCenter:v.xCenter*y.width,yCenter:v.yCenter*y.height,width:v.width*y.width,height:v.height*y.height,rotation:v.rotation}:{xCenter:.5*y.width,yCenter:.5*y.height,width:y.width,height:y.height,rotation:0}}(d,n),f=function(y,v,I){if(I===void 0&&(I=!1),!I)return{top:0,left:0,right:0,bottom:0};var b=v.height,A=v.width;aI(v,"targetSize"),aI(y,"roi");var R,O,L=b/A,$=y.height/y.width,G=0,H=0;return L>$?(R=y.width,O=y.width*L,H=(1-$/L)/2):(R=y.height/L,O=y.height,G=(1-L/$)/2),y.width=R,y.height=O,{top:H,left:G,right:G,bottom:H}}(p,s,i),m=kue(p,d.width,d.height,!1),_=Xr(function(){var y=SV(t),v=ll(function(A,R,O){return aI(O,"inputResolution"),[1/O.width*A[0][0]*R.width,1/O.height*A[0][1]*R.width,A[0][3]*R.width,1/O.width*A[1][0]*R.height,1/O.height*A[1][1]*R.height,A[1][3]*R.height,0,0]}(m,d,s),[1,8]),I=c==="zero"?"constant":"nearest",b=jp.transform(Ba(jr(y,"float32")),v,"bilinear",I,0,[s.height,s.width]);return l!=null?Due(b,l):b});return{imageTensor:_,padding:f,transformationMatrix:m}}function qM(t){return{xCenter:t.xMin+t.width/2,yCenter:t.yMin+t.height/2,width:t.width,height:t.height}}function XM(t){var e=t.relativeKeypoints;if(e.length<=1)throw new Error("2 or more keypoints required to calculate a rect.");var n=Number.MAX_VALUE,s=Number.MAX_VALUE,i=Number.MIN_VALUE,c=Number.MIN_VALUE;return e.forEach(function(l){n=Math.min(n,l.x),i=Math.max(i,l.x),s=Math.min(s,l.y),c=Math.max(c,l.y)}),{xCenter:(n+i)/2,yCenter:(s+c)/2,width:i-n,height:c-s}}function YM(t,e,n,s,i){var c=n==="rect"?function(l,d,p){var f,m=l.locationData;if(d==="boundingbox")f=qM(m.boundingBox);else{f=XM(m);var _=p.width,y=p.height;f.xCenter=Math.round(f.xCenter*_),f.yCenter=Math.round(f.yCenter*y),f.width=Math.round(f.width*_),f.height=Math.round(f.height*y)}return f}(t,e,s):function(l,d){var p=l.locationData;return d==="boundingbox"?qM(p.relativeBoundingBox):XM(p)}(t,e);return i&&(c.rotation=function(l,d,p){var f,m=l.locationData,_=p.rotationVectorStartKeypointIndex,y=p.rotationVectorEndKeypointIndex;f=p.rotationVectorTargetAngle?p.rotationVectorTargetAngle:Math.PI*p.rotationVectorTargetAngleDegree/180;var v=m.relativeKeypoints[_].x*d.width,I=m.relativeKeypoints[_].y*d.height,b=m.relativeKeypoints[y].x*d.width,A=m.relativeKeypoints[y].y*d.height;return vV(f-Math.atan2(-(A-I),b-v))}(t,s,i)),c}function Lue(t,e,n){for(var s=0;s<e.length;++s){var i=e[s],c=n[t[s]];c.x=i.x,c.y=i.y}}function Mue(t,e,n,s){if(typeof e=="string"){if(e==="copy")for(var i=0;i<n.length;++i)s[t[i]].z=n[i].z}else{var c=function(l,d){for(var p=0,f=0;f<d.length;++f)p+=l[d[f]].z;return p/d.length}(s,e);for(i=0;i<t.length;++i)s[t[i]].z=c}}function $ue(t,e){for(var n=function(d){var p=[].concat.apply([],d.map(function(v){return v.indexesMapping}));if(p.length===0)throw new Error("There should be at least one landmark in indexes mapping");var f=p[0],m=p[0],_=new Set(p);_.forEach(function(v){f=Math.min(f,v),m=Math.max(m,v)});var y=_.size;if(f!==0)throw new Error("Indexes are expected to start with 0 instead of "+f);if(m+1!==y)throw new Error("Indexes should have no gaps but "+(m-y+1)+" indexes are missing");return y}(e),s=new Array(n).fill(null).map(Object),i=0;i<t.length;++i){var c=t[i],l=e[i];if(c.length!==l.indexesMapping.length)throw new Error("There are "+c.length+" refinement landmarks while mapping has "+l.indexesMapping.length);Lue(l.indexesMapping,c,s),Mue(l.indexesMapping,l.zRefinement,c,s)}return s}function Fue(t,e){return t.map(function(n){var s=za(za({},n),{x:n.x*e.width,y:n.y*e.height});return n.z!=null&&(s.z=n.z*e.width),s})}function Uue(t,e){return t==="none"?e:function(n){return 1/(1+Math.exp(-n))}(e)}function rd(t,e,n,s){return zc(this,void 0,void 0,function(){var i,c,l,d,p,f,m,_;return Hc(this,function(y){switch(y.label){case 0:return n=n||e.flipHorizontally||!1,s=s||e.flipVertically||!1,i=t.size,c=i/e.numLandmarks,[4,t.data()];case 1:for(l=y.sent(),d=[],p=0;p<e.numLandmarks;++p)f=p*c,(_={x:0,y:0}).x=n?e.inputImageWidth-l[f]:l[f],c>1&&(_.y=s?e.inputImageHeight-l[f+1]:l[f+1]),c>2&&(_.z=l[f+2]),c>3&&(_.score=Uue(e.visibilityActivation,l[f+3])),d.push(_);for(m=0;m<d.length;++m)(_=d[m]).x=_.x/e.inputImageWidth,_.y=_.y/e.inputImageHeight,_.z=_.z/e.inputImageWidth/(e.normalizeZ||1);return[2,d]}})})}function JM(t,e,n){var s=t.width,i=t.height,c=t.rotation;if(n.rotation==null&&n.rotationDegree==null||(c=function(m,_){return _.rotation!=null?m+=_.rotation:_.rotationDegree!=null&&(m+=Math.PI*_.rotationDegree/180),vV(m)}(c,n)),c===0)t.xCenter=t.xCenter+s*n.shiftX,t.yCenter=t.yCenter+i*n.shiftY;else{var l=(e.width*s*n.shiftX*Math.cos(c)-e.height*i*n.shiftY*Math.sin(c))/e.width,d=(e.width*s*n.shiftX*Math.sin(c)+e.height*i*n.shiftY*Math.cos(c))/e.height;t.xCenter=t.xCenter+l,t.yCenter=t.yCenter+d}if(n.squareLong){var p=Math.max(s*e.width,i*e.height);s=p/e.width,i=p/e.height}else if(n.squareShort){var f=Math.min(s*e.width,i*e.height);s=f/e.width,i=f/e.height}return t.width=s*n.scaleX,t.height=i*n.scaleY,t}(g1||(g1={})).MediaPipeFaceDetector="MediaPipeFaceDetector";var cI={runtime:"tfjs",maxFaces:1,refineLandmarks:!1,landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/face_landmarks_detection/face_mesh/1"},uI={flipHorizontal:!1,staticImageMode:!1},QM={shiftX:0,shiftY:0,scaleX:1.5,scaleY:1.5,squareLong:!0},Vue={outputTensorSize:{width:192,height:192},outputTensorFloatRange:[0,1],borderMode:"replicate"},ZM={numLandmarks:468,inputImageWidth:192,inputImageHeight:192,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},Bue={numLandmarks:80,inputImageWidth:192,inputImageHeight:192,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},e$={numLandmarks:71,inputImageWidth:192,inputImageHeight:192,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},t$={numLandmarks:5,inputImageWidth:192,inputImageHeight:192,visibilityActivation:"none",flipHorizontally:!1,flipVertically:!1},jue={indexesMapping:Array.from(Array(468).keys()),zRefinement:"copy"},Wue={indexesMapping:[61,146,91,181,84,17,314,405,321,375,291,185,40,39,37,0,267,269,270,409,78,95,88,178,87,14,317,402,318,324,308,191,80,81,82,13,312,311,310,415,76,77,90,180,85,16,315,404,320,307,306,184,74,73,72,11,302,303,304,408,62,96,89,179,86,15,316,403,319,325,292,183,42,41,38,12,268,271,272,407],zRefinement:"none"},Gue={indexesMapping:[33,7,163,144,145,153,154,155,133,246,161,160,159,158,157,173,130,25,110,24,23,22,26,112,243,247,30,29,27,28,56,190,226,31,228,229,230,231,232,233,244,113,225,224,223,222,221,189,35,124,46,53,52,65,143,111,117,118,119,120,121,128,245,156,70,63,105,66,107,55,193],zRefinement:"none"},zue={indexesMapping:[263,249,390,373,374,380,381,382,362,466,388,387,386,385,384,398,359,255,339,254,253,252,256,341,463,467,260,259,257,258,286,414,446,261,448,449,450,451,452,453,464,342,445,444,443,442,441,413,265,353,276,283,282,295,372,340,346,347,348,349,350,357,465,383,300,293,334,296,336,285,417],zRefinement:"none"},Hue={indexesMapping:[468,469,470,471,472],zRefinement:[33,7,163,144,145,153,154,155,133,246,161,160,159,158,157,173]},Kue={indexesMapping:[473,474,475,476,477],zRefinement:[263,249,390,373,374,380,381,382,362,466,388,387,386,385,384,398]},E1,que=function(){function t(e,n,s,i){this.detector=e,this.landmarkModel=n,this.maxFaces=s,this.withAttention=i,this.prevFaceRectsFromLandmarks=null}return t.prototype.estimateFaces=function(e,n){return zc(this,void 0,void 0,function(){var s,i,c,l,d,p,f,m,_,y,v,I,b,A=this;return Hc(this,function(R){switch(R.label){case 0:return s=function($){if($==null)return za({},uI);var G=za({},$);return G.flipHorizontal==null&&(G.flipHorizontal=uI.flipHorizontal),G.staticImageMode==null&&(G.staticImageMode=uI.staticImageMode),G}(n),e==null?(this.reset(),[2,[]]):(i=yV(e),c=Xr(function(){var $=jr(SV(e),"float32");return s.flipHorizontal&&($=Os(jp.flipLeftRight(Ba($,0)),[0])),$}),l=this.prevFaceRectsFromLandmarks,s.staticImageMode||l==null||l.length<this.maxFaces?[4,this.detector.detectFaces(c,!1)]:[3,2]);case 1:return(p=R.sent()).length===0?(this.reset(),c.dispose(),[2,[]]):(d=p.map(function($){return A.faceDetectionFrontDetectionToRoi($,i)}),[3,3]);case 2:d=[],R.label=3;case 3:return O=.5,L=[],[d,l||[]].forEach(function($){return $.forEach(function(G){(L=L.filter(function(H){return xue(G,H)<=O})).push(G)})}),f=L,[4,Promise.all(f.map(function($){return A.faceLandmark($,c)}))];case 4:for(m=R.sent(),_=[],this.prevFaceRectsFromLandmarks=[],y=0;y<m.length;++y)(v=m[y])!=null&&(this.prevFaceRectsFromLandmarks.push(this.faceLandmarksToRoi(v,i)),(I=Fue(v,i))!=null&&I.forEach(function($,G){var H=mV.get(G);H!=null&&($.name=H)}),b=nC(I),_.push({keypoints:I,box:b.locationData.relativeBoundingBox}));return c.dispose(),[2,_]}var O,L})})},t.prototype.dispose=function(){this.detector.dispose(),this.landmarkModel.dispose()},t.prototype.reset=function(){this.detector.reset(),this.prevFaceRectsFromLandmarks=null},t.prototype.faceDetectionFrontDetectionToRoi=function(e,n){return JM(YM(e,"boundingbox","normRect",n,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:0}),n,QM)},t.prototype.faceLandmark=function(e,n){return zc(this,void 0,void 0,function(){var s,i,c,l,d,p,f;return Hc(this,function(m){switch(m.label){case 0:return s=Pue(n,Vue,e).imageTensor,i=["output_faceflag"].concat(this.withAttention?["output_mesh_identity","output_lips","Identity_6:0","Identity_1:0","Identity_2:0","Identity_5:0"]:["output_mesh"]),c=this.landmarkModel.execute(s,i),l=c[0],d=c.slice(1),[4,l.data()];case 1:return m.sent()[0]<.5?(mc(c),mc(s),[2,null]):this.withAttention?[4,this.tensorsToFaceLandmarksWithAttention(d)]:[3,3];case 2:return p=m.sent(),[3,5];case 3:return[4,this.tensorsToFaceLandmarks(d)];case 4:p=m.sent(),m.label=5;case 5:return f=function(_,y,v){v===void 0&&(v={ignoreRotation:!1});for(var I=[],b=0,A=_;b<A.length;b++){var R=A[b],O=R.x-.5,L=R.y-.5,$=v.ignoreRotation?0:y.rotation,G=Math.cos($)*O-Math.sin($)*L,H=Math.sin($)*O+Math.cos($)*L;G=G*y.width+y.xCenter,H=H*y.height+y.yCenter;var Z=R.z*y.width,re=za({},R);re.x=G,re.y=H,re.z=Z,I.push(re)}return I}(p,e),mc(c),mc(s),[2,f]}})})},t.prototype.tensorsToFaceLandmarks=function(e){return zc(this,void 0,void 0,function(){return Hc(this,function(n){return[2,rd(e[0],ZM)]})})},t.prototype.tensorsToFaceLandmarksWithAttention=function(e){return zc(this,void 0,void 0,function(){var n,s,i,c,l,d;return Hc(this,function(p){switch(p.label){case 0:return[4,rd(e[0],ZM)];case 1:return n=p.sent(),[4,rd(e[1],Bue)];case 2:return s=p.sent(),[4,rd(e[3],e$)];case 3:return i=p.sent(),[4,rd(e[5],e$)];case 4:return c=p.sent(),[4,rd(e[4],t$)];case 5:return l=p.sent(),[4,rd(e[2],t$)];case 6:return d=p.sent(),[2,$ue([n,s,i,c,l,d],[jue,Wue,Gue,zue,Hue,Kue])]}})})},t.prototype.faceLandmarksToRoi=function(e,n){return JM(YM(nC(e),"boundingbox","normRect",n,{rotationVectorStartKeypointIndex:33,rotationVectorEndKeypointIndex:263,rotationVectorTargetAngleDegree:0}),n,QM)},t}();function Xue(t){return zc(this,void 0,void 0,function(){var e,n,s,i;return Hc(this,function(c){switch(c.label){case 0:return e=function(l){if(l==null)return za({},cI);var d=za({},l);return d.runtime="tfjs",d.maxFaces==null&&(d.maxFaces=cI.maxFaces),d.refineLandmarks==null&&(d.refineLandmarks=cI.refineLandmarks),d.landmarkModelUrl==null&&(d.landmarkModelUrl=d.refineLandmarks?"https://tfhub.dev/mediapipe/tfjs-model/face_landmarks_detection/attention_mesh/1":"https://tfhub.dev/mediapipe/tfjs-model/face_landmarks_detection/face_mesh/1"),d}(t),n=typeof e.landmarkModelUrl=="string"&&e.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,fV(e.landmarkModelUrl,{fromTFHub:n})];case 1:return s=c.sent(),[4,Oue(g1.MediaPipeFaceDetector,{modelType:"short",maxFaces:e.maxFaces,detectorModelUrl:e.detectorModelUrl,runtime:e.runtime})];case 2:return i=c.sent(),[2,new que(i,s,e.maxFaces,e.refineLandmarks)]}})})}function Yue(t,e){return zc(this,void 0,void 0,function(){var n,s;return Hc(this,function(i){if(t===E1.MediaPipeFaceMesh){if(s=void 0,(n=e)!=null){if(n.runtime==="tfjs")return[2,Xue(n)];if(n.runtime==="mediapipe")return[2,pue(n)];s=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+s)}throw new Error(t+" is not a supported model name.")})})}(function(t){t.MediaPipeFaceMesh="MediaPipeFaceMesh"})(E1||(E1={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rt(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&se(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jue=gb;class cy extends rw{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new zU(this,Hu())}nextDataId(){return cy.nextDataId++}write(e,n,s){this.firstUse&&(this.firstUse=!1,De().get("IS_NODE")&&ha(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:s,refCount:1}),i}makeTensorInfo(e,n,s){let i;if(n==="string"&&s!=null&&s.length>0&&Qm(s[0])){const c=s.map(l=>cl(l));i=this.write(c,e,n)}else i=this.write(s,e,n);return{dataId:i,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,i,c){this.data.set(e,{values:n,dtype:i,refCount:c})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const i=this.readSync(s.real.dataId),c=this.readSync(s.imag.dataId);return ru(i,c)}return this.data.get(e).values}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(i=>pl(i));return cn(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return cn(e.shape,e.dtype,n)}makeOutput(e,n,s){return Hu().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=Fi();return e(),{kernelMs:Fi()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Rt([e],"where");const n=this.readSync(e.dataId);return Jue(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}cy.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TV(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const Que=t=>{const{x:e}=t.inputs,n=t.backend;Rt(e,"abs");let s=new Float32Array(Pe(e.shape));const i=n.data.get(e.dataId).values;return s=TV(i),n.makeOutput(s,e.shape,e.dtype)},Zue={kernelName:aw,backendName:"cpu",kernelFunc:Que};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hs(t){return(e,n,s,i,c)=>{const l=Rn(e,n),d=l.length,p=Pt(l),f=Pe(l),m=Ms(c,f),_=e.length,y=n.length,v=Pt(e),I=Pt(n),b=Np(e,l),A=Np(n,l);if(b.length+A.length===0)for(let R=0;R<m.length;++R)m[R]=t(s[R%s.length],i[R%i.length]);else for(let R=0;R<m.length;++R){const O=Vp(R,d,p),L=O.slice(-_);b.forEach(Z=>L[Z]=0);const $=_c(L,_,v),G=O.slice(-y);A.forEach(Z=>G[Z]=0);const H=_c(G,y,I);m[R]=t(s[$],i[H])}return[m,l]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ai(t){const{inputs:e,backend:n}=t,{real:s,imag:i}=e,c=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values,d=n.makeTensorInfo(s.shape,"complex64"),p=n.data.get(d.dataId);return p.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",c),imag:n.makeTensorInfo(i.shape,"float32",l)},d}const ele={kernelName:yw,backendName:"cpu",kernelFunc:ai};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _1(t,e,n="float32"){if(n==="complex64"){const i=_1(t,e,"float32"),c=_1(t,e,"float32");return ai({inputs:{real:i,imag:c},backend:t})}const s=lo(Pe(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tc(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const tle={kernelName:h_,backendName:"cpu",kernelFunc:Tc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ld(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.data.get(s.dataId).complexTensorInfos.real,c=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,c)}const nle={kernelName:ER,backendName:"cpu",kernelFunc:Ld};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IV(t,e,n,s){if(s==="int32"){const i=Int32Array.from(t);return[e,"int32",i]}if(s==="bool"){const i=Vd([0],n),[c,l]=hs((d,p)=>d!==p?1:0)(e,[],t,i,"bool");return[l,"bool",c]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function gl(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dtype:c}=s;if(c==="complex64"){if(i.dtype==="complex64")return Tc({inputs:{x:i},backend:n});const m=_1(n,i.shape,i.dtype),_=gl({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),y=ai({inputs:{real:_,imag:m},backend:n});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(_),y}if(i.dtype==="complex64"){const m=Ld({inputs:{input:i},backend:n}),_=gl({inputs:{x:m},backend:n,attrs:{dtype:c}});return n.disposeIntermediateTensorInfo(m),_}if(!KU(i.dtype,c)){const m=Tc({inputs:{x:i},backend:n});return{dataId:m.dataId,shape:m.shape,dtype:c}}const l=n.data.get(i.dataId).values,[d,p,f]=IV(l,i.shape,i.dtype,c);return n.makeTensorInfo(d,p,f)}const rle={kernelName:J1,backendName:"cpu",kernelFunc:gl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fs(t,e,n,s){return n==null?({inputs:i,backend:c})=>{const{a:l,b:d}=i,p=c;Rt([l,d],t);const f=p.data.get(l.dataId).values,m=p.data.get(d.dataId).values,_=l.dtype==="string"?Dd(f):f,y=l.dtype==="string"?Dd(m):m,v=s||l.dtype,[I,b]=e(l.shape,d.shape,_,y,v);return p.makeTensorInfo(b,v,I)}:({inputs:i,backend:c})=>{const{a:l,b:d}=i,p=c;if(l.dtype==="complex64"||d.dtype==="complex64"){const f=gl({inputs:{x:l},backend:p,attrs:{dtype:"complex64"}}),m=p.data.get(f.dataId),_=m.complexTensorInfos.real,y=m.complexTensorInfos.imag,v=p.data.get(_.dataId).values,I=p.data.get(y.dataId).values,b=gl({inputs:{x:d},backend:p,attrs:{dtype:"complex64"}}),A=p.data.get(b.dataId),R=A.complexTensorInfos.real,O=A.complexTensorInfos.imag,L=p.data.get(R.dataId).values,$=p.data.get(O.dataId).values,[G,H,Z]=n(l.shape,d.shape,v,I,L,$),re=p.makeTensorInfo(Z,"float32",G),oe=p.makeTensorInfo(Z,"float32",H),ae=ai({inputs:{real:re,imag:oe},backend:p});return p.disposeIntermediateTensorInfo(f),p.disposeIntermediateTensorInfo(b),p.disposeIntermediateTensorInfo(re),p.disposeIntermediateTensorInfo(oe),ae}else{const f=p.data.get(l.dataId).values,m=p.data.get(d.dataId).values,_=s||l.dtype,[y,v]=e(l.shape,d.shape,f,m,_);return p.makeTensorInfo(v,_,y)}}}function Gb(t){return(e,n,s,i,c,l)=>{const d=Rn(e,n),p=Pe(d),f=d.length,m=Pt(d),_=Ms("float32",p),y=Ms("float32",p),v=Np(e,d),I=Np(n,d),b=ru(s,i),A=ru(c,l),R=e.length,O=Pt(e),L=n.length,$=Pt(n);if(v.length+I.length===0)for(let G=0;G<_.length;G++){const H=G%b.length,Z=G%A.length,re=t(b[H*2],b[H*2+1],A[Z*2],A[Z*2+1]);_[G]=re.real,y[G]=re.imag}else for(let G=0;G<_.length;G++){const H=Vp(G,f,m),Z=H.slice(-R);v.forEach(Ce=>Z[Ce]=0);const re=_c(Z,R,O),oe=H.slice(-L);I.forEach(Ce=>oe[Ce]=0);const ae=_c(oe,L,$),Ee=t(b[re*2],b[re*2+1],A[ae*2],A[ae*2+1]);_[G]=Ee.real,y[G]=Ee.imag}return[_,y,d]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CV=hs((t,e)=>t+e),sle=Gb((t,e,n,s)=>({real:t+n,imag:e+s})),Op=Fs(eg,CV,sle),ole={kernelName:eg,backendName:"cpu",kernelFunc:Op};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zb(t,e,n,s,i){const c=Pe(s),l=lo(i,n);for(let d=0;d<t.length;d++){const p=t[d];if(p<0)throw new Error("Input x must be non-negative!");p>=i||(c>0?l[p]+=e[d]:l[p]+=1)}return l}function wV(t,e,n,s=!1){const i=t.shape[0],c=t.shape[1],l=cn([i,n],e.dtype);for(let d=0;d<i;d++)for(let p=0;p<c;p++){const f=t.get(d,p);if(f<0)throw new Error("Input x must be non-negative!");f>=n||(s?l.set(1,d,f):e.size>0?l.set(l.get(d,f)+e.get(d,p),d,f):l.set(l.get(d,f)+1,d,f))}return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wl(t){return(e,n,s)=>{const i=Ms(n,e.length);for(let c=0;c<e.length;++c)i[c]=t(e[c],s);return i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yn(t,e,n){return({inputs:s,attrs:i,backend:c})=>{const{x:l}=s;if(Rt(l,t),l.dtype==="string"||n==="string")throw new Error("unaryKernelFunc does not support string input/output");const d=c,p=d.data.get(l.dataId).values,f=Pe(l.shape),m=n||l.dtype,_=Ps(m,f);for(let y=0;y<f;++y)_[y]=e(p[y],i);return d.makeTensorInfo(l.shape,m,_)}}function Wp(t,e,n){return({inputs:s,attrs:i,backend:c})=>{const{x:l}=s;if(Rt(l,t),l.dtype==="string"||n==="string")throw new Error("unaryKernelFunc does not support string input/output");const d=c,p=d.data.get(l.dataId).values,f=n||l.dtype,m=e(p,f,i);return d.makeTensorInfo(l.shape,f,m)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RV=wl(t=>Math.ceil(t)),ile=Wp(Q1,RV),ale={kernelName:Q1,backendName:"cpu",kernelFunc:ile};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(t,e,n,s){const i=Ps(n,Pe(e));if(s&&n!=="string"){let c=0;t.forEach(l=>{const d=Pe(l.shape);i.set(l.vals,c),c+=d})}else{let c=0;t.forEach(l=>{const d=n==="string"?Dd(l.vals):l.vals;let p=0;for(let f=0;f<l.shape[0];++f){const m=f*e[1]+c;for(let _=0;_<l.shape[1];++_)i[m+_]=d[p++]}c+=l.shape[1]})}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NV=hs((t,e)=>t===e?1:0),AV=Fs(o_,NV,null,"bool"),cle={kernelName:o_,backendName:"cpu",kernelFunc:AV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OV=wl(t=>Math.exp(t)),xV=Wp(i_,OV,"float32"),ule={kernelName:i_,backendName:"cpu",kernelFunc:xV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kV=wl(t=>Math.expm1(t)),lle=Wp(a_,kV),dle={kernelName:a_,backendName:"cpu",kernelFunc:lle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DV=wl(t=>Math.floor(t)),hle=Wp(c_,DV),ple={kernelName:c_,backendName:"cpu",kernelFunc:hle};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PV(t,e,n,s,i,c,l,d,p){const f=cn([s,c],n);for(let m=0;m<s;m++){const _=[];let y=0;for(let v=0;v<i;v++){const I=t[m*i+v];y+=I*l[v],_.push(I)}if(y<0||y>=p/c)throw new Error(`Invalid indices: ${_} does not index into ${d}`);for(let v=0;v<c;v++)f.values[m*c+v]=e.get(...e.indexToLoc(y*c+v))}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(t,e,n){const s=cn(n,t.dtype);for(let i=0;i<s.size;++i){const l=s.indexToLoc(i).slice(),d=l[0],p=l[2],f=e.locToIndex([d,p]);l[2]=e.values[f];const m=t.locToIndex(l);0<=m&&m<t.values.length&&(s.values[i]=t.values[m])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MV=hs((t,e)=>t>e?1:0),fle=Fs(l_,MV,null,"bool"),mle={kernelName:l_,backendName:"cpu",kernelFunc:fle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $V=hs((t,e)=>t>=e?1:0),gle=Fs(d_,$V,null,"bool"),Ele={kernelName:d_,backendName:"cpu",kernelFunc:gle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FV=hs((t,e)=>t<e?1:0),_le=Fs(g_,FV,null,"bool"),yle={kernelName:g_,backendName:"cpu",kernelFunc:_le};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UV=hs((t,e)=>t<=e?1:0),vle=Fs(E_,UV,null,"bool"),Sle={kernelName:E_,backendName:"cpu",kernelFunc:vle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(t,e,n){const s=(e-t)/(n-1),i=lo(n,"float32");i[0]=t;for(let c=1;c<i.length;c++)i[c]=i[c-1]+s;return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BV=wl(t=>Math.log(t)),Tle=Wp(__,BV),Ile={kernelName:__,backendName:"cpu",kernelFunc:Tle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jV(t,e,n,s){const i=Ms(s,Pe(n));for(let c=0;c<i.length;++c){const l=c*e;let d=t[l];for(let p=0;p<e;++p){const f=t[l+p];(Number.isNaN(f)||f>d)&&(d=f)}i[c]=d}return i}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WV=hs((t,e)=>Math.max(t,e)),Cle=Fs(I_,WV),wle={kernelName:I_,backendName:"cpu",kernelFunc:Cle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GV=hs((t,e)=>Math.min(t,e)),Rle=Fs(C_,GV),ble={kernelName:C_,backendName:"cpu",kernelFunc:Rle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hb=hs((t,e)=>t*e),Nle=Gb((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n})),uy=Fs(R_,Hb,Nle),Ale={kernelName:R_,backendName:"cpu",kernelFunc:uy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zV(t,e,n){const s=Sl(-1,n);return Hb([],e,s,t,n)}function Ole(t){const{inputs:e,backend:n}=t,{x:s}=e;Rt(s,"neg");const i=n.data.get(s.dataId).values,[c,l]=zV(i,s.shape,s.dtype);return n.makeTensorInfo(l,s.dtype,c)}const xle={kernelName:sR,backendName:"cpu",kernelFunc:Ole};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HV=hs((t,e)=>t!==e?1:0),kle=Fs(b_,HV,null,"bool"),Dle={kernelName:b_,backendName:"cpu",kernelFunc:kle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kb(t,e,n,s,i){const c=e.length,l=Pe(e),d=Pt(e),p=Pt(i),f=Ms(n,Pe(i));for(let m=0;m<l;++m){const _=Vp(m,c,d),y=new Array(_.length);for(let I=0;I<y.length;I++)y[I]=_[s[I]];const v=_c(y,c,p);f[v]=t[m]}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ho(t){const{inputs:e,attrs:n,backend:s}=t,{x:i}=e,{perm:c}=n;Rt(i,"transpose");const l=i.shape.length,d=new Array(l);for(let _=0;_<d.length;_++)d[_]=i.shape[c[_]];const p=s.data.get(i.dataId).values,f=Kb(p,i.shape,i.dtype,c,d);return{dataId:s.write(f,d,i.dtype),shape:d,dtype:i.dtype}}const Ple={kernelName:Em,backendName:"cpu",kernelFunc:Ho};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KV(t,e,n,s){const[i,c]=qs(t,s),l=pi(e,"int32"),d=lo(Pe(i),l),p=Pe(c);for(let f=0;f<d.length;++f){const m=f*p;let _=1;for(let y=0;y<p;++y)_*=n[m+y];d[f]=_}return{outVals:d,outShape:i,outDtype:l}}function Lle(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,keepDims:l}=s;Rt(i,"prod");const d=i.shape.length,p=$n(c,i.shape),f=ss(p,d);let m=p,_=i;const y=[];f!=null&&(_=Ho({inputs:{x:i},backend:n,attrs:{perm:f}}),y.push(_),m=os(m.length,d));const v=n.data.get(_.dataId).values,{outVals:I,outShape:b,outDtype:A}=KV(_.shape,_.dtype,v,m);let R=b;return l&&(R=Cs(b,p)),y.forEach(O=>n.disposeIntermediateTensorInfo(O)),n.makeTensorInfo(R,A,I)}const Mle={kernelName:pR,backendName:"cpu",kernelFunc:Lle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $le(t,e,n){t.forEach((s,i)=>{if(s<0||s>=n){const c=Vp(i,e.length,Pt(e)).join(",");throw new Error(`indices[${c}] = ${s} is not in [0, ${n})`)}})}function Fle(t,e){for(let n=0;n<t.length;++n){const s=t[n],i=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>i)throw new Error("Ragged splits must not point past values");for(let c=1;c<s.length;++c)if(s[c-1]>s[c])throw new Error("Ragged splits must be sorted in ascending order")}}function Ule(t,e,n,s){const i=[];let c=0;const l=e.length-1+n.length,d=new Array(l).fill(null).map(()=>[0]);Fle(n,s);let p=1;for(let f=0;f<e.length-1;++f){p*=e[f];const m=e[f+1];for(let _=1;_<p+1;++_)d[f].push(_*m)}for(let f=0;f<t.length;++f){let m=t[f],_=t[f]+1;for(let y=0;y<n.length;++y){const v=n[y],I=y+e.length-1;if(I>=0){const b=d[I],A=b[b.length-1]-v[m];for(let R=m;R<_;++R)d[I].push(v[R+1]+A)}m=v[m],_=v[_]}_!==m&&(i.push([m,_]),c+=_-m)}return{outSplits:d,valueSlices:i,numValues:c}}function Vle(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,i=Ps("int32",s);e.push(i),t[n].forEach((c,l)=>i[l]=c)}return e}function n$(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function Ble(t,e,n,s,i,c){const l=n$(e,2)[1],d=n$(c,2)[1];let p=0;for(const f of n)for(let m=f[0];m<f[1];++m){for(let _=0;_<s;++_)i[p*d+_]=t[m*l+_];++p}}function jle(t,e,n,s,i){const c=e.slice();c[0]=i;const l=Ps(n,Pe(c)),d=t.length,p=d===0?0:d/e[0];return Ble(t,e,s,p,l,c),[l,c]}function qV(t,e,n,s,i,c,l,d){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const p=e[0][0]-1;if($le(c,l,p),s.length===0)throw new Error("params.rank must be nonzero");const f=s[0],{outSplits:m,valueSlices:_,numValues:y}=Ule(c,l,t,f),v=Vle(m),I=jle(n,s,i,_,y);return[v,I[0],I[1]]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ia=ja;class y1{constructor(e,n,s,i,c,l,d,p,f,m){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=i,this.valuesDType=c,this.defaultValue=l,this.defaultValueShape=d,this.rowPartitionValues=p,this.rowPartitionValuesShapes=f,this.rowPartitionTypes=B5(m),this.raggedRank=j5(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===ia.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===ia.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case ia.VALUE_ROWIDS:return y1.getMaxWidthValueRowID(n);case ia.ROW_SPLITS:return y1.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${ia[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let i=0;i<n-1;++i){const c=e[i+1]-e[i];c>s&&(s=c)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,i=e[0],c=0;for(let l=1;l<n;++l){const d=e[l];d!==i&&(i=d,c=Math.max(l-s,c),s=l)}return Math.max(n-s,c)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return s$(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;W5(s,n);const i=this.tensorShapeFromTensor(this.shape,this.shapeShape),l=V5(this.raggedRank,i,n);l[0]<0&&(l[0]=e);for(let d=1;d<=this.raggedRank;++d)l[d]<0&&(l[d]=this.getMaxWidth(d));return l}calculateFirstParentOutputIndex(e,n,s){const i=Math.min(e,s),c=[];let l=0;for(let d=0;d<i;++d,l+=n)c.push(l);for(let d=i;d<e;++d)c.push(-1);return se(c.length===e,()=>"Final length of result must be equal to firstDimension."),c}calculateOutputIndexRowSplit(e,n,s,i){const c=e.length,l=[];for(let d=0;d<c-1;++d){const p=e[d+1]-e[d];let f=Math.min(i,p),m=n[d];m===-1&&(f=0);for(let _=0;_<f;++_)l.push(m),m+=s;for(let _=0;_<p-f;++_)l.push(-1)}if(c>0&&l.length!==e[c-1])throw new Error("Invalid row split size.");return l}calculateOutputIndexValueRowID(e,n,s,i){const c=e.length,l=[];if(c===0)return[];let d=0,p=e[0];if(p>=n.length)throw new Error(`Got currentValueRowId=${p}, which is not less than ${n.length}`);let f=n[p];l.push(f);for(let m=1;m<c;++m){const _=e[m];if(_===p)f>=0&&(++d,d<i?f+=s:f=-1);else{if(d=0,p=_,_>=n.length)throw new Error(`Got nextValueRowId=${_} which is not less than ${n.length}`);f=n[_]}l.push(f)}if(l.length!==e.length)throw new Error("Invalid row ids.");return l}calculateOutputIndex(e,n,s,i){const c=this.getRowPartitionTensor(e),l=this.getRowPartitionTypeByDimension(e);switch(l){case ia.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(c,n,s,i);case ia.ROW_SPLITS:if(c.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${c.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(c,n,s,i);default:throw new Error(`Unsupported partition type: ${ia[l]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case ia.FIRST_DIM_SIZE:return e[0];case ia.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ia.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${ia[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),i=new Array(this.raggedRank+1);i[i.length-1]=1;for(let p=i.length-2;p>=0;--p)i[p]=i[p+1]*s[p+1];const c=s$(s,!1),l=Ps(this.valuesDType,Pe(c));if(i[0]*s[0]>0){let p=this.calculateFirstParentOutputIndex(n,i[0],s[0]);for(let f=1;f<=this.raggedRank;++f)p=this.calculateOutputIndex(f-1,p,i[f],s[f]);this.setOutput(this.raggedRank,p,l,c)}return[c,l]}setOutput(e,n,s,i){if(s.length===0)return;const c=this.values,l=s;let d=i.slice();d=d.slice(e+1);const p=Pe(d),f=n.length;let m=this.defaultValue;if(m.length!==p&&m.length!==1){const I=this.defaultValueShape;Xr(()=>{const b=ze(m,I);m=_m(b,d).dataSync()})}let _=0,y=0,v=0;for(let I=0;I<=f;++I){let b=I<f?n[I]:-1;if(b===v){++v;continue}if(y<v){const A=c.subarray(_*p),R=l.subarray(y*p),O=(v-y)*p;r$(R,A,O)}if(I>=f){const A=s.length;b=Math.floor(A/p)}if(b>v)if(this.defaultValue.length===1)l.subarray(v*p,b*p).fill(this.defaultValue[0]),v=b;else for(;b>v;){const A=l.slice(v*p);r$(A,m,p),++v}b<0?(_=I+1,y=v):(_=I,y=v,v=y+1)}}}function r$(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function s$(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function XV(t,e,n,s,i,c,l,d,p,f){return new y1(t,e,n,s,i,c,l,d,p,f).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YV(t,e,n,s){const i=t===e,c=t<e&&n<0,l=e<t&&n>1;if(i||c||l)return lo(0,s);const d=Math.abs(Math.ceil((e-t)/n)),p=lo(d,s);e<t&&n===1&&(n=-1),p[0]=t;for(let f=1;f<p.length;f++)p[f]=p[f-1]+n;return p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JV=wl(t=>1/Math.sqrt(t)),Wle=Wp(D_,JV),Gle={kernelName:D_,backendName:"cpu",kernelFunc:Wle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function op(t,e,n,s,i,c,l,d,p,f){const m=[s/i,i],_=t.values,y=e.values;if(s===0)return cn(n,e.dtype);const v=cn(m,e.dtype);typeof p=="string"||typeof p=="number"?v.values.fill(p):typeof p=="boolean"&&v.values.fill(+p);for(let I=0;I<c;I++){const b=[];let A=0;for(let R=0;R<l;R++){const O=_[I*l+R];b.push(O),A+=O*d[R]}if(A<0||A>=s/i)throw new Error(`Invalid indices: ${b} does not index into ${n}`);for(let R=0;R<i;R++)f?v.values[A*i+R]+=y[I*i+R]:v.values[A*i+R]=e.rank===0?y[0]:y[I*i+R]}return v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zle=wl(t=>1/(1+Math.exp(-t))),QV=Yn(F_,t=>1/(1+Math.exp(-t))),Hle={kernelName:F_,backendName:"cpu",kernelFunc:QV};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZV(t,e,n,s,i){const c=nb(s,e,n),l=Pe(n),d=Pt(s);if(c){const _=rb(e,d);return i==="string"?t.slice(_,_+l):t.subarray(_,_+l)}const p=i==="string"?Dd(t):t,f=cn(s,i,p),m=cn(n,i);for(let _=0;_<m.size;++_){const y=m.indexToLoc(_),v=y.map((I,b)=>I+e[b]);m.set(f.get(...v),...y)}return i==="string"?uV(m.values):m.values}function Md(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:c,size:l}=s;Rt(i,"slice");const[d,p]=sb(i,c,l);eb(i,d,p);const f=n.data.get(i.dataId).values,m=ZV(f,d,p,i.shape,i.dtype);return n.makeTensorInfo(p,i.dtype,m)}const Kle={kernelName:wR,backendName:"cpu",kernelFunc:Md};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8(t,e,n,s,i,c,l){const d=e[0],p=c[0],f=new Array(p),m=new Array(d),_=e[1];if(p===0){if(d!==0)throw new Error(Y5(d));const A=Ps(n,0),R=Ps(i,0);return[A,[0,_],R,f,m]}let y=!0,v=0;const I=new Array(p).fill(0);for(let A=0;A<d;++A){const R=t[A*_];if(R<0)throw new Error(J5(A,R));if(R>=p)throw new Error(Q5(A,R,p));++I[R],y=y&&R>=v,v=R}let b=!0;for(let A=0;A<p;++A){const R=I[A]===0;f[A]=R,b=b&&!R,I[A]=Math.max(I[A],1),A>0&&(I[A]+=I[A-1])}if(b&&y){const A=t,R=s;for(let O=0;O<d;++O)m[O]=O;return[A,[d,_],R,f,m]}else{const A=I[p-1],R=Ps(n,A*_),O=Ps(i,A),L=new Array(p).fill(0);for(let $=0;$<d;++$){const G=t[$*_],H=L[G],Z=(G===0?0:I[G-1])+H;L[G]++;for(let re=0;re<_;++re)R[Z*_+re]=t[$*_+re];O[Z]=s[$],m[$]=Z}for(let $=0;$<p;++$)if(L[$]===0){const H=$===0?0:I[$-1];R[H*_+0]=$;for(let Z=1;Z<_;++Z)R[H*_+Z]=0;O[H]=l}return[R,[A,_],O,f,m]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t8(t,e,n,s,i){const c=Pe(s),l=e[0],d=i.length,p=[];let f=1,m=-1;for(let A=0;A<d;++A){const R=i[A];if(R===-1){if(m!==-1)throw new Error(Z5(m,A));m=A,p.push(1)}else{if(R<0)throw new Error(eV(A,R));f*=R,p.push(R)}}if(m!==-1){if(f<=0)throw new Error(tV());const A=Math.trunc(c/f);if(f*A!==c)throw new Error(nV(s,p));p[m]=A}if(Pe(p)!==c)throw new Error(rV(s,p));const y=s.length,v=[];if(y>0){v[y-1]=1;for(let A=y-2;A>=0;--A)v[A]=v[A+1]*s[A+1]}const I=[];if(d>0){I[d-1]=1;for(let A=d-2;A>=0;--A)I[A]=I[A+1]*p[A+1]}const b=Ps(n,l*d);for(let A=0;A<l;++A){let R=0;for(let O=0;O<y;++O)R+=t[A*y+O]*v[O];for(let O=0;O<d;++O)b[A*d+O]=Math.trunc(R/I[O]),R%=I[O]}return[b,[l,d],p]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qb(t,e,n,s,i,c=!1,l=0){const d=s.length,p=[e[0],t.length/e[0]],f=p[1],_=d>0?i[d-1]+1:0;if(_<0)throw new Error(G2());const y=e.slice();y[0]=_;const v=y.reduce((L,$)=>L*$,1),I=Ps(n,v);if(d===0)return _>0&&I.fill(l),[I,y];if(_<=0)throw new Error(G2());let b=0,A=1,R=0,O=i[b];for(;;){let L=0;if(A<d){if(L=i[A],O===L){++A;continue}if(O>=L)throw new Error(sV())}if(O<0||O>=_)throw new Error(oV(O,_));O>R&&I.fill(l,R*f,O*f);for(let $=b;$<A;++$){const G=s[$];if(G<0||G>=p[0])throw new Error(iV($,s[$],p[0]));for(let H=0;H<f;H++)I[O*f+H]+=t[G*f+H]}if(c)for(let $=0;$<f;$++)I[O*f+$]/=A-b;if(b=A,++A,R=O+1,O=L,A>d)break}return R<_&&I.fill(l,R*f,_*f),[I,y]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qle=wl(t=>Math.sqrt(t)),Xle=Yn(V_,t=>Math.sqrt(t)),Yle={kernelName:V_,backendName:"cpu",kernelFunc:Xle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n8=hs((t,e)=>{const n=t-e;return n*n}),Jle=Fs(B_,n8),Qle={kernelName:B_,backendName:"cpu",kernelFunc:Jle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r8(t,e,n,s){const i=cn(t,e.dtype);for(let c=0;c<i.size;c++){const l=i.indexToLoc(c),d=new Array(l.length);for(let p=0;p<d.length;p++)d[p]=l[p]*n[p]+s[p];i.set(e.get(...d),...l)}return i}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zle{constructor(e,n,s,i,c,l){this.separator=cl(e),this.nGramWidths=n,this.leftPad=cl(s),this.rightPad=cl(i),this.padWidth=c,this.preserveShort=l}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,i,c,l){for(let d=0;d<c;++d){const p=this.getPadWidth(l),f=Math.max(0,p-d),m=Math.max(0,p-(c-(d+1))),_=l-(f+m),y=n+(f>0?0:d-p);let v=0;v+=f*this.leftPad.length;for(let O=0;O<_;++O)v+=e[y+O].length;v+=m*this.rightPad.length;const I=f+m+_-1;v+=I*this.separator.length,s[i+d]=new Uint8Array(v);const b=s[i+d];let A=0;const R=O=>O.forEach(L=>b[A++]=L);for(let O=0;O<f;++O)R(this.leftPad),R(this.separator);for(let O=0;O<_-1;++O)R(e[y+O]),R(this.separator);if(_>0){R(e[y+_-1]);for(let O=0;O<m;++O)R(this.separator),R(this.rightPad)}else{for(let O=0;O<m-1;++O)R(this.rightPad),R(this.separator);R(this.rightPad)}}}compute(e,n){const s=e.length,i=n.length;if(i>0){let p=n[0];if(p!==0)throw new Error(`First split value must be 0, got ${p}`);for(let f=1;f<i;++f){let m=n[f]>=p;if(m=m&&n[f]<=s,!m)throw new Error(`Invalid split value ${n[f]}, must be in [${p}, ${s}]`);p=n[f]}if(p!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${p}`)}const c=i-1,l=Ps("int32",i);if(s===0||i===0){const p=new Array(s);for(let f=0;f<=c;++f)l[f]=0;return[p,l]}l[0]=0;for(let p=1;p<=c;++p){const f=n[p]-n[p-1];let m=0;this.nGramWidths.forEach(_=>{m+=this.getNumNGrams(f,_)}),this.preserveShort&&f>0&&m===0&&(m=1),l[p]=l[p-1]+m}const d=new Array(l[c]);for(let p=0;p<c;++p){const f=n[p];let m=l[p];if(this.nGramWidths.forEach(_=>{const y=n[p+1]-n[p],v=this.getNumNGrams(y,_);this.createNGrams(e,f,d,m,v,_),m+=v}),this.preserveShort&&m===l[p]){const _=n[p+1]-n[p];if(_===0)continue;const y=_+2*this.padWidth,v=1;this.createNGrams(e,f,d,m,v,y)}}return[d,l]}}function s8(t,e,n,s,i,c,l,d){return new Zle(n,s,i,c,l,d).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ede(t,e,n,s){if(!t.length)return;if(e.length===0){for(let c=0;c<t.length;++c)s.push(t.subarray(c,c+1));return}if(e.length===1){const c=e[0];let l=t.indexOf(c);for(;l!==-1;){const d=t.subarray(0,l);(!n||d.length!==0)&&s.push(d),t=t.subarray(l+1),l=t.indexOf(c)}(!n||t.length!==0)&&s.push(t);return}let i=0;for(let c=0;c<t.length+1;c++)if(c===t.length||e.indexOf(t[c])!==-1){const l=t.subarray(i,c);(!n||l.length!==0)&&s.push(l),i=c+1}}function o8(t,e,n){const s=t.length,i=[];let c=0,l=0;const d=new Array(s);for(let y=0;y<s;++y){const v=i.length;ede(t[y],e,n,i);const I=i.length-v;d[y]=I,c+=I,l=Math.max(l,I)}const p=Ps("int32",c*2),f=new Array(c),m=[s,l];let _=0;for(let y=0;y<s;++y)for(let v=0;v<d[y];++v)p[_*2]=y,p[_*2+1]=v,f[_]=i[_],++_;return[p,f,m]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i8(t,e){const n=Ps("int32",t.length);for(let s=0;s<t.length;++s)n[s]=AQ(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a8=hs((t,e)=>t-e),tde=Gb((t,e,n,s)=>({real:t-n,imag:e-s})),Xb=Fs(j_,a8,tde),nde={kernelName:j_,backendName:"cpu",kernelFunc:Xb};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c8(t,e){const n=new Array(t.rank);for(let i=0;i<n.length;i++)n[i]=t.shape[i]*e[i];const s=cn(n,t.dtype);for(let i=0;i<s.values.length;++i){const c=s.indexToLoc(i),l=new Array(t.rank);for(let p=0;p<l.length;p++)l[p]=c[p]%t.shape[p];const d=t.locToIndex(l);s.values[i]=t.values[d]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const om=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function u8(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const d=s-n+1,p=e-n+1,f=Math.log(d),m=.5*Math.exp(2*f/3),_=.5*Math.sqrt(f*m*(d-m)/d)*Math.sign(p-d/2),y=Math.max(n,Math.floor(e-p*m/d+_)),v=Math.min(s,Math.floor(e+(d-p)*m/d+_));u8(t,e,y,v)}const i=t[e];let c=n,l=s;for(qf(t,n,e),om(t[s],i)>0&&qf(t,n,s);c<l;){for(qf(t,c,l),c++,l--;om(t[c],i)<0;)c=c+1;for(;om(t[l],i)>0;)l=l-1}om(t[n],i)===0?qf(t,n,l):(l=l+1,qf(t,l,s)),l<=e&&(n=l+1),e<=l&&(s=l-1)}}function l8(t,e,n,s,i){const c=e[e.length-1],[l,d]=[t.length/c,c],p=Ms(n,l*s),f=Ms("int32",l*s);for(let _=0;_<l;_++){const y=_*d,v=t.subarray(y,y+d);let I=new Array(v.length);v.forEach((O,L)=>I[L]={value:O,index:L}),s<I.length&&(u8(I,s),I=I.slice(0,s)),i&&I.sort(om);const b=_*s,A=p.subarray(b,b+s),R=f.subarray(b,b+s);for(let O=0;O<s;O++)A[O]=I[O].value,R[O]=I[O].index}const m=e.slice();return m[m.length-1]=s,[cn(m,n,p),cn(m,"int32",f)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d8(t,e,n,s){const i=$n(e,n)[0],c=[1,n[0],1];for(let I=0;I<i;I++)c[0]*=n[I];c[1]=n[i];for(let I=i+1;I<n.length;I++)c[2]*=n[I];const l={},d=new Int32Array(n[i]),p=new Ls(c,s,t),f=[],m=c[0]===1&&c[2]===1;for(let I=0;I<n[i];I++){let b;if(m)b=t[I].toString();else{const A=[];for(let R=0;R<c[0];R++)for(let O=0;O<c[2];O++)A.push(p.get(R,I,O));b=A.join(",")}if(l[b]!==void 0)d[I]=l[b];else{const A=Object.keys(l).length;l[b]=A,d[I]=A,f.push(I)}}const _=c.slice();_[1]=Object.keys(l).length;const y=new Ls(_,s);f.forEach((I,b)=>{for(let A=0;A<c[0];A++)for(let R=0;R<c[2];R++)y.set(p.get(A,I,R),A,b,R)});const v=n.slice();return v[i]=_[1],{outputValues:y.values,outputShape:v,indices:d}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rde=Object.freeze(Object.defineProperty({__proto__:null,addImpl:CV,bincountImpl:zb,bincountReduceImpl:wV,castImpl:IV,ceilImpl:RV,concatImpl:bV,equalImpl:NV,expImpl:OV,expm1Impl:kV,floorImpl:DV,gatherNdImpl:PV,gatherV2Impl:LV,greaterEqualImpl:$V,greaterImpl:MV,lessEqualImpl:UV,lessImpl:FV,linSpaceImpl:VV,logImpl:BV,maxImpl:jV,maximumImpl:WV,minimumImpl:GV,multiplyImpl:Hb,negImpl:zV,notEqualImpl:HV,prodImpl:KV,raggedGatherImpl:qV,raggedTensorToTensorImpl:XV,rangeImpl:YV,rsqrtImpl:JV,scatterImpl:op,sigmoidImpl:zle,simpleAbsImpl:TV,sliceImpl:ZV,sparseFillEmptyRowsImpl:e8,sparseReshapeImpl:t8,sparseSegmentReductionImpl:qb,sqrtImpl:qle,squaredDifferenceImpl:n8,stridedSliceImpl:r8,stringNGramsImpl:s8,stringSplitImpl:o8,stringToHashBucketFastImpl:i8,subImpl:a8,tileImpl:c8,topKImpl:l8,transposeImpl:Kb,uniqueImpl:d8},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */W6("cpu",()=>new cy,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h8=Yn(r_,t=>t>=0?t:Math.exp(t)-1),sde={kernelName:r_,backendName:"cpu",kernelFunc:h8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p8(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{alpha:c}=s;Rt([i],"leakyRelu");const l=Pe(i.shape),d=n.data.get(i.dataId).values,p=Ms("float32",l);for(let f=0;f<d.length;f++)p[f]=d[f]<0?c*d[f]:d[f];return n.makeTensorInfo(i.shape,"float32",p)}const ode={kernelName:Kw,backendName:"cpu",kernelFunc:p8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ide=hs((t,e)=>t<0?e*t:t);function f8(t){const{inputs:e,backend:n}=t,{x:s,alpha:i}=e;Rt([s,i],"prelu");const c=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values,[d,p]=ide(s.shape,i.shape,c,l,"float32");return n.makeTensorInfo(p,"float32",d)}const ade={kernelName:hR,backendName:"cpu",kernelFunc:f8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m8=Yn(O_,t=>Math.max(0,t)),cde={kernelName:O_,backendName:"cpu",kernelFunc:m8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g8=Yn(x_,t=>Math.min(Math.max(0,t),6)),ude={kernelName:x_,backendName:"cpu",kernelFunc:g8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v1(t,e,n,s,i){if(n==="linear")return Tc({inputs:{x:e},backend:t});if(n==="relu")return m8({inputs:{x:e},backend:t});if(n==="elu")return h8({inputs:{x:e},backend:t});if(n==="relu6")return g8({inputs:{x:e},backend:t});if(n==="prelu")return f8({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return p8({inputs:{x:e},backend:t,attrs:{alpha:i}});if(n==="sigmoid")return QV({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gr(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{shape:c}=s,l=Pe(i.shape),d=HU(c,l),p=Pe(d);se(l===p,()=>`The new shape (${d}) has ${p} elements and the old shape (${i.shape}) has ${l} elements. The new shape and old shape must have the same number of elements.`),n.incRef(i.dataId);const f=n.data.get(i.dataId);if(f.complexTensorInfos!=null){const m=f.complexTensorInfos.real,_=f.complexTensorInfos.imag;m.shape=d,_.shape=d}return{dataId:i.dataId,shape:d,dtype:i.dtype}}const lde={kernelName:_R,backendName:"cpu",kernelFunc:gr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E8(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:c}=e,{transposeA:l,transposeB:d}=s;Rt([i,c],"matMul");const p=i.shape.length,f=c.shape.length,m=l?i.shape[p-2]:i.shape[p-1],_=d?c.shape[f-1]:c.shape[f-2],y=l?i.shape[p-1]:i.shape[p-2],v=d?c.shape[f-2]:c.shape[f-1],I=i.shape.slice(0,-2),b=c.shape.slice(0,-2),A=Pe(I),R=Pe(b),L=Rn(i.shape.slice(0,-2),c.shape.slice(0,-2)).concat([y,v]);se(m===_,()=>`Error in matMul: inner shapes (${m}) and (${_}) of Tensors with shapes ${i.shape} and ${c.shape} and transposeA=${l} and transposeB=${d} must match.`);const $=l?[A,m,y]:[A,y,m],G=d?[R,v,_]:[R,_,v],H=gr({inputs:{x:i},backend:n,attrs:{shape:$}}),Z=gr({inputs:{x:c},backend:n,attrs:{shape:G}}),re=l?H.shape[1]:H.shape[2],oe=l?H.shape[2]:H.shape[1],ae=d?Z.shape[1]:Z.shape[2],Ee=Math.max(A,R),Ce=n.data.get(H.dataId).values,ye=n.data.get(Z.dataId).values,we=Pt(H.shape),Ae=Pt(Z.shape),[Oe,Me,me]=l?[we[0],1,we[1]]:[we[0],we[1],1],[Te,ke,Fe]=d?[1,Ae[1],Ae[0]]:[Ae[1],1,Ae[0]],Xe=oe*ae,Ye=cn([Ee,oe,ae],H.dtype),tt=Ye.values,et=n.blockSize;for(let nt=0;nt<Ee;nt++)for(let gt=0;gt<oe;gt+=et)for(let Ct=0;Ct<ae;Ct+=et)for(let Tt=0;Tt<re;Tt+=et){const Lt=Math.min(gt+et,oe),St=Math.min(Ct+et,ae),un=Math.min(Tt+et,re);for(let Kt=gt;Kt<Lt;Kt++)for(let sn=Ct;sn<St;sn++){let on=0;for(let Zt=Tt;Zt<un;Zt++){const xn=Math.min(nt,A-1)*Oe,pn=Math.min(nt,R-1)*Fe,Fn=Ce[xn+Kt*Me+Zt*me],Pn=ye[Zt*Te+sn*ke+pn];on+=Fn*Pn}tt[nt*Xe+(Kt*ae+sn)]+=on}}return n.disposeIntermediateTensorInfo(H),n.disposeIntermediateTensorInfo(Z),n.makeTensorInfo(L,Ye.dtype,Ye.values)}const dde={kernelName:mw,backendName:"cpu",kernelFunc:E8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hde(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:c,bias:l,preluActivationWeights:d}=e,{transposeA:p,transposeB:f,activation:m,leakyreluAlpha:_}=s;let y,v,I;const b=[];y=E8({inputs:{a:i,b:c},attrs:{transposeA:p,transposeB:f},backend:n}),l&&(v=Op({inputs:{a:y,b:l},backend:n}),b.push(y),y=v),m&&(I=v1(n,y,m,d,_),b.push(y),y=I);for(const R of b)n.disposeIntermediateTensorInfo(R);return y}const pde={kernelName:r1,backendName:"cpu",kernelFunc:hde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fde=Yn(G1,t=>Math.acos(t)),mde={kernelName:G1,backendName:"cpu",kernelFunc:fde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gde=Yn(z1,t=>Math.acosh(t)),Ede={kernelName:z1,backendName:"cpu",kernelFunc:gde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _de(t){const{inputs:e,backend:n}=t,s=e;Rt(e,"addN");const i=s.map(d=>n.data.get(d.dataId).values),c=cn(s[0].shape,s[0].dtype),l=c.values;for(let d=0;d<s.length;d++){const p=i[d];for(let f=0;f<l.length;f++)l[f]+=p[f]}return n.makeTensorInfo(c.shape,c.dtype,c.values)}const yde={kernelName:cw,backendName:"cpu",kernelFunc:_de};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vde(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,keepDims:l}=s;Rt(i,"all");const d=$n(c,i.shape);let p=d;const f=ss(p,i.shape.length);let m=i;f!=null&&(m=Ho({inputs:{x:i},backend:n,attrs:{perm:f}}),p=os(p.length,i.shape.length)),Xs("all",p,m.shape.length);const[_,y]=qs(m.shape,p),v=Pe(y),I=lo(Pe(_),m.dtype),b=n.data.get(m.dataId).values;for(let R=0;R<I.length;++R){const O=R*v;let L=b[O];for(let $=0;$<v;++$){const G=b[O+$];L=L&&G}I[R]=L}f!=null&&n.disposeIntermediateTensorInfo(m);const A=n.makeTensorInfo(_,m.dtype,I);if(l){const R=Cs(_,d),O=gr({inputs:{x:A},backend:n,attrs:{shape:R}});return n.disposeIntermediateTensorInfo(A),O}return A}const Sde={kernelName:uw,backendName:"cpu",kernelFunc:vde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tde(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,keepDims:l}=s;Rt(i,"any");const d=$n(c,i.shape);let p=d;const f=ss(p,i.shape.length);let m=i;f!=null&&(m=Ho({inputs:{x:i},backend:n,attrs:{perm:f}}),p=os(p.length,i.shape.length)),Xs("any",p,m.shape.length);const[_,y]=qs(m.shape,p),v=Pe(y),I=lo(Pe(_),m.dtype),b=n.data.get(m.dataId).values;for(let R=0;R<I.length;++R){const O=R*v;let L=b[O];for(let $=0;$<v;++$){const G=b[O+$];L=L||G}I[R]=L}f!=null&&n.disposeIntermediateTensorInfo(m);const A=n.makeTensorInfo(_,m.dtype,I);if(l){const R=Cs(_,d),O=gr({inputs:{x:A},backend:n,attrs:{shape:R}});return n.disposeIntermediateTensorInfo(A),O}return A}const Ide={kernelName:lw,backendName:"cpu",kernelFunc:Tde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cde(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c}=s;Rt(i,"argMax");let l=$n(c,i.shape);const d=ss(l,i.shape.length);let p=i;const f=[];d!=null&&(p=Ho({inputs:{x:i},backend:n,attrs:{perm:d}}),f.push(p),l=os(l.length,p.shape.length)),l=[l[0]],Xs("argMax",l,p.shape.length);const[m,_]=qs(p.shape,l),y=Pe(m),v=lo(y,"int32"),I=Pe(_),b=n.data.get(p.dataId).values;for(let A=0;A<v.length;++A){const R=A*I;let O=b[R],L=0;for(let $=0;$<I;++$){const G=b[R+$];G>O&&(O=G,L=$)}v[A]=L}return f.forEach(A=>n.disposeIntermediateTensorInfo(A)),n.makeTensorInfo(m,"int32",v)}const wde={kernelName:dw,backendName:"cpu",kernelFunc:Cde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rde(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c}=s;Rt(i,"argMin");let l=$n(c,i.shape);const d=ss(l,i.shape.length);let p=i;const f=[];d!=null&&(p=Ho({inputs:{x:i},backend:n,attrs:{perm:d}}),f.push(p),l=os(l.length,p.shape.length)),l=[l[0]],Xs("argMin",l,p.shape.length);const[m,_]=qs(p.shape,l),y=Pe(m),v=lo(y,"int32"),I=Pe(_),b=n.data.get(p.dataId).values;for(let A=0;A<v.length;++A){const R=A*I;let O=b[R],L=0;for(let $=0;$<I;++$){const G=b[R+$];G<O&&(O=G,L=$)}v[A]=L}return f.forEach(A=>n.disposeIntermediateTensorInfo(A)),n.makeTensorInfo(m,"int32",v)}const bde={kernelName:hw,backendName:"cpu",kernelFunc:Rde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nde=Yn(H1,t=>Math.asin(t)),Ade={kernelName:H1,backendName:"cpu",kernelFunc:Nde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ode=Yn(K1,t=>Math.asinh(t)),xde={kernelName:K1,backendName:"cpu",kernelFunc:Ode};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kde=Yn(q1,t=>Math.atan(t)),Dde={kernelName:q1,backendName:"cpu",kernelFunc:kde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pde=hs((t,e)=>Math.atan2(t,e)),Lde=Fs(Y1,Pde),Mde={kernelName:Y1,backendName:"cpu",kernelFunc:Lde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $de=Yn(X1,t=>Math.atanh(t)),Fde={kernelName:X1,backendName:"cpu",kernelFunc:$de};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yb(t,e,n,s,i,c){const l=i.strideHeight,d=i.strideWidth,p=i.dilationHeight,f=i.dilationWidth,m=i.effectiveFilterHeight,_=i.effectiveFilterWidth,y=i.padInfo.top,v=i.padInfo.left,I=c==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=cn(i.outShape,n),A=b.values,R=i.outShape[1]*i.outShape[2]*i.outShape[3],O=i.outShape[2]*i.outShape[3],L=i.outShape[3];for(let $=0;$<i.batchSize;++$){const G=$*R,H=$*s[0];for(let Z=0;Z<i.inChannels;++Z)for(let re=0;re<i.outHeight;++re){const oe=re*l-y,ae=Math.max(0,oe),Ee=Math.min(i.inHeight,m+oe),Ce=G+re*O;for(let ye=0;ye<i.outWidth;++ye){const we=ye*d-v,Ae=Math.max(0,we),Oe=Math.min(i.inWidth,_+we);let Me=I,me=0,Te=0;for(let Fe=ae;Fe<Ee;Fe+=p){const Xe=H+Fe*s[1];for(let Ye=Ae;Ye<Oe;Ye+=f){const tt=Xe+Ye*s[2],et=t[tt+Z];c==="max"&&et>Me?Me=et:c==="avg"&&(me+=et,Te++)}if(isNaN(Me))break}const ke=Ce+ye*L+Z;A[ke]=c==="avg"?me/Te:Me}}}return b}function _8(t,e,n,s,i=!1,c=!1){const l=cn(s.outShape,"int32"),d=s.strideHeight,p=s.strideWidth,f=s.dilationHeight,m=s.dilationWidth,_=s.effectiveFilterHeight,y=s.effectiveFilterWidth,v=s.padInfo.top,I=s.padInfo.left,b=cn(e,n,t);for(let A=0;A<s.batchSize;++A)for(let R=0;R<s.inChannels;++R)for(let O=0;O<s.outHeight;++O){const L=O*d-v;let $=L;for(;$<0;)$+=f;const G=Math.min(s.inHeight,_+L);for(let H=0;H<s.outWidth;++H){const Z=H*p-I;let re=Z;for(;re<0;)re+=m;const oe=Math.min(s.inWidth,y+Z);let ae=Number.NEGATIVE_INFINITY,Ee=-1;for(let Ce=$;Ce<G;Ce+=f){const ye=Ce-L;for(let we=re;we<oe;we+=m){const Ae=we-Z,Oe=b.get(A,Ce,we,R);Oe>ae&&(ae=Oe,i?Ee=c?((A*s.inHeight+Ce)*s.inWidth+we)*s.inChannels+R:(Ce*s.inWidth+we)*s.inChannels+R:Ee=ye*y+Ae)}}l.set(Ee,A,O,H,R)}}return l}function y8(t,e,n,s,i,c){const l=i.strideDepth,d=i.strideHeight,p=i.strideWidth,f=i.dilationDepth,m=i.dilationHeight,_=i.dilationWidth,y=i.effectiveFilterDepth,v=i.effectiveFilterHeight,I=i.effectiveFilterWidth,b=i.padInfo.front,A=i.padInfo.top,R=i.padInfo.left,O=c==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,L=cn(i.outShape,n),$=L.values,G=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],H=i.outShape[2]*i.outShape[3]*i.outShape[4],Z=i.outShape[3]*i.outShape[4],re=i.outShape[4];for(let oe=0;oe<i.batchSize;++oe){const ae=oe*G,Ee=oe*s[0];for(let Ce=0;Ce<i.inChannels;++Ce)for(let ye=0;ye<i.outDepth;++ye){const we=ye*l-b;let Ae=we;for(;Ae<0;)Ae+=f;const Oe=Math.min(i.inDepth,y+we),Me=ae+ye*H;for(let me=0;me<i.outHeight;++me){const Te=me*d-A;let ke=Te;for(;ke<0;)ke+=m;const Fe=Math.min(i.inHeight,v+Te),Xe=Me+me*Z;for(let Ye=0;Ye<i.outWidth;++Ye){const tt=Ye*p-R;let et=tt;for(;et<0;)et+=_;const nt=Math.min(i.inWidth,I+tt),gt=Xe+Ye*re;let Ct=O,Tt=0,Lt=0;for(let un=Ae;un<Oe;un+=f){const Kt=Ee+un*s[1];for(let sn=ke;sn<Fe;sn+=m){const on=Kt+sn*s[2];for(let Zt=et;Zt<nt;Zt+=_){const xn=on+Zt*s[3],pn=t[xn+Ce];if(c==="max"&&pn>Ct?Ct=pn:c==="avg"&&(Tt+=pn,Lt++),isNaN(Ct))break}if(isNaN(Ct))break}if(isNaN(Ct))break}const St=gt+Ce;$[St]=c==="avg"?Tt/Lt:Ct}}}}return L}function Ude(t,e){const n=cn(e.outShape,"int32"),s=e.strideDepth,i=e.strideHeight,c=e.strideWidth,l=e.dilationDepth,d=e.dilationHeight,p=e.dilationWidth,f=e.effectiveFilterDepth,m=e.effectiveFilterHeight,_=e.effectiveFilterWidth,y=e.padInfo.front,v=e.padInfo.top,I=e.padInfo.left;for(let b=0;b<e.batchSize;++b)for(let A=0;A<e.inChannels;++A)for(let R=0;R<e.outDepth;++R){const O=R*s-y;let L=O;for(;L<0;)L+=l;const $=Math.min(e.inDepth,f+O);for(let G=0;G<e.outHeight;++G){const H=G*i-v;let Z=H;for(;Z<0;)Z+=d;const re=Math.min(e.inHeight,m+H);for(let oe=0;oe<e.outWidth;++oe){const ae=oe*c-I;let Ee=ae;for(;Ee<0;)Ee+=p;const Ce=Math.min(e.inWidth,_+ae);let ye=Number.NEGATIVE_INFINITY,we=-1;for(let Ae=L;Ae<$;Ae+=l){const Oe=Ae-O;for(let Me=Z;Me<re;Me+=d){const me=Me-H;for(let Te=Ee;Te<Ce;Te+=p){const ke=Te-ae,Fe=t.get(b,Ae,Me,Te,A);Fe>=ye&&(ye=Fe,we=Oe*m*_+me*m+ke)}}}n.set(we,b,R,G,oe,A)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vde(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;Rt(i,"avgPool");const{filterSize:c,strides:l,pad:d,dimRoundingMode:p}=s,f=1;se(ho(l,f),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${f}'`);const m=Ta(i.shape,c,l,f,d,p);let _;if(m.filterWidth===1&&m.filterHeight===1&&Nr(m.inShape,m.outShape))_=Tc({inputs:{x:i},backend:n});else{const y=n.data.get(i.dataId).values,v=Pt(i.shape),I=Yb(y,i.shape,i.dtype,v,m,"avg");_=n.makeTensorInfo(m.outShape,i.dtype,I.values)}return _}const Bde={kernelName:pw,backendName:"cpu",kernelFunc:Vde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jde(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:c,strides:l,pad:d,dimRoundingMode:p,dataFormat:f}=s;Rt(i,"avgPool3d");const m=au(i.shape,c,l,1,d,p,f),_=n.data.get(i.dataId).values,y=y8(_,i.shape,i.dtype,Pt(i.shape),m,"avg");return n.makeTensorInfo(y.shape,"float32",y.values)}const Wde={kernelName:fw,backendName:"cpu",kernelFunc:jde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gde(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:c}=e,{filterSize:l,strides:d,pad:p,dimRoundingMode:f}=s;Rt([i,c],"avgPool3DGrad");const m=au(c.shape,l,d,1,p,f),_=m.strideDepth,y=m.strideHeight,v=m.strideWidth,I=m.filterDepth,b=m.filterHeight,A=m.filterWidth,R=m.dilationDepth,O=m.dilationHeight,L=m.dilationWidth,$=m.effectiveFilterDepth,G=m.effectiveFilterHeight,H=m.effectiveFilterWidth,Z=$-1-m.padInfo.front,re=H-1-m.padInfo.left,oe=G-1-m.padInfo.top,ae=cn(c.shape,"float32"),Ee=1/(I*b*A),Ce=n.bufferSync(i);for(let ye=0;ye<m.batchSize;++ye)for(let we=0;we<m.inChannels;++we)for(let Ae=0;Ae<m.inDepth;++Ae)for(let Oe=0;Oe<m.inHeight;++Oe)for(let Me=0;Me<m.inWidth;++Me){const me=Ae-Z,Te=Oe-oe,ke=Me-re;let Fe=0;for(let Xe=0;Xe<$;Xe+=R){const Ye=(me+Xe)/_;if(!(Ye<0||Ye>=m.outDepth||Math.floor(Ye)!==Ye))for(let tt=0;tt<G;tt+=O){const et=(Te+tt)/y;if(!(et<0||et>=m.outHeight||Math.floor(et)!==et))for(let nt=0;nt<H;nt+=L){const gt=(ke+nt)/v;if(gt<0||gt>=m.outWidth||Math.floor(gt)!==gt)continue;const Ct=Ce.get(ye,Ye,et,gt,we);Fe+=Ct}}}ae.set(Fe*Ee,ye,Ae,Oe,Me,we)}return n.makeTensorInfo(ae.shape,ae.dtype,ae.values)}const zde={kernelName:e6,backendName:"cpu",kernelFunc:Gde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hde(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:c}=e,l=c;Rt([i,c],"avgPoolGrad");const{filterSize:d,strides:p,pad:f}=s,m=Ta(l.shape,d,p,1,f),_=m.strideHeight,y=m.strideWidth,v=m.filterHeight,I=m.filterWidth,b=m.dilationHeight,A=m.dilationWidth,R=m.effectiveFilterHeight,O=m.effectiveFilterWidth,L=O-1-m.padInfo.left,$=R-1-m.padInfo.top,G=cn(l.shape,"float32"),H=1/(v*I),Z=n.data.get(i.dataId).values,re=cn(i.shape,"float32",Z);for(let oe=0;oe<m.batchSize;++oe)for(let ae=0;ae<m.inChannels;++ae)for(let Ee=0;Ee<m.inHeight;++Ee)for(let Ce=0;Ce<m.inWidth;++Ce){const ye=Ee-$,we=Ce-L;let Ae=0;for(let Oe=0;Oe<R;Oe+=b){const Me=(ye+Oe)/_;if(!(Me<0||Me>=m.outHeight||Math.floor(Me)!==Me))for(let me=0;me<O;me+=A){const Te=(we+me)/y;if(Te<0||Te>=m.outWidth||Math.floor(Te)!==Te)continue;const ke=re.get(oe,Me,Te,ae);Ae+=ke}}G.set(Ae*H,oe,Ee,Ce,ae)}return n.makeTensorInfo(G.shape,G.dtype,G.values)}const Kde={kernelName:ZU,backendName:"cpu",kernelFunc:Hde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qde(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,scale:c,offset:l,mean:d,variance:p}=e;se(d.shape.length===p.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),se(l==null||d.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),se(c==null||d.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Rt([i,d,p,c,l],"batchNorm");let{varianceEpsilon:f}=s;f==null&&(f=.001);const m=n.data.get(i.dataId).values,_=n.data.get(d.dataId).values,y=n.data.get(p.dataId).values,v=c?n.data.get(c.dataId).values:new Float32Array([1]),I=l?n.data.get(l.dataId).values:new Float32Array([0]),b=new Float32Array(m.length),A=I.length,R=v.length,O=y.length,L=_.length;let $=0,G=0,H=0,Z=0;for(let re=0;re<m.length;++re)b[re]=I[$++]+(m[re]-_[G++])*v[H++]/Math.sqrt(y[Z++]+f),$>=A&&($=0),G>=L&&(G=0),H>=R&&(H=0),Z>=O&&(Z=0);return n.makeTensorInfo(i.shape,i.dtype,b)}const Xde={kernelName:jw,backendName:"cpu",kernelFunc:qde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yde(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:c,crops:l}=s;Rt([i],"batchToSpaceND");const d=c.reduce((R,O)=>R*O),p=ig(i.shape,c,d),f=ag(p.length,c.length),m=cg(i.shape,c,d),_=wb(l,c.length),y=Rb(m,l,c.length),v=gr({inputs:{x:i},backend:n,attrs:{shape:p}}),I=Ho({inputs:{x:v},backend:n,attrs:{perm:f}}),b=gr({inputs:{x:I},backend:n,attrs:{shape:m}}),A=Md({inputs:{x:b},backend:n,attrs:{begin:_,size:y}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(I),n.disposeIntermediateTensorInfo(b),A}const Jde={kernelName:gw,backendName:"cpu",kernelFunc:Yde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qde(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:c}=e,{size:l}=s,d=n.data.get(i.dataId).values,p=n.data.get(c.dataId).values,f=zb(d,p,c.dtype,c.shape,l);return n.makeTensorInfo([l],c.dtype,f)}const Zde={kernelName:Ew,backendName:"cpu",kernelFunc:Qde};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ehe(t){const{inputs:e,backend:n}=t,{s0:s,s1:i}=e,c=n.data.get(s.dataId).values,l=n.data.get(i.dataId).values,d=Rn(Array.from(c),Array.from(l));return n.makeTensorInfo([d.length],"int32",Int32Array.from(d))}const the={kernelName:_w,backendName:"cpu",kernelFunc:ehe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nhe=Yn(Z1,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),rhe={kernelName:Z1,backendName:"cpu",kernelFunc:nhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const she=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(Pe(e.shape)),i=n.data.get(e.dataId),c=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,d=n.data.get(c.dataId).values,p=n.data.get(l.dataId).values;for(let f=0;f<d.length;f++){const m=d[f],_=p[f];s[f]=Math.hypot(m,_)}return n.makeOutput(s,e.shape,"float32")},ohe={kernelName:vw,backendName:"cpu",kernelFunc:she};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xp(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.data.get(s.dataId).complexTensorInfos.imag,c=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,c)}const ihe={kernelName:Hw,backendName:"cpu",kernelFunc:xp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kp(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s,c=$n(i,e[0].shape)[0],l=e.map(b=>b.shape);Tb(l,c);let d=vc(e.map(b=>b.shape),c);if(Pe(d)===0)return n.makeTensorInfo(d,e[0].dtype,[]);const p=e.filter(b=>Pe(b.shape)>0);if(p.length===1)return Tc({inputs:{x:p[0]},backend:n});if(p[0].dtype==="complex64"){const b=p.map($=>Ld({inputs:{input:$},backend:n})),A=p.map($=>xp({inputs:{input:$},backend:n})),R=kp({inputs:b,backend:n,attrs:{axis:c}}),O=kp({inputs:A,backend:n,attrs:{axis:c}}),L=ai({inputs:{real:R,imag:O},backend:n});return b.forEach($=>n.disposeIntermediateTensorInfo($)),A.forEach($=>n.disposeIntermediateTensorInfo($)),n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(O),L}const f=p.map(b=>{const R=[-1,Pe(b.shape.slice(c))];return gr({inputs:{x:b},backend:n,attrs:{shape:R}})}),m=f.map(b=>({vals:n.data.get(b.dataId).values,shape:b.shape}));d=vc(f.map(b=>b.shape),1);const _=f[0].shape[0]===1,y=bV(m,d,e[0].dtype,_),v=vc(p.map(b=>b.shape),c),I=n.makeTensorInfo(v,e[0].dtype,y);return f.forEach(b=>n.disposeIntermediateTensorInfo(b)),I}const ahe={kernelName:Sw,backendName:"cpu",kernelFunc:kp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v8(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:c}=e,{strides:l,pad:d,dataFormat:p,dilations:f,dimRoundingMode:m}=s;Rt([i,c],"conv2d");const _=cu(p),y=$s(i.shape,c.shape,l,f,d,m,!1,_),v=y.filterHeight,I=y.filterWidth,b=y.dilationHeight,A=y.dilationWidth,R=y.padInfo.left,O=y.padInfo.top,L=y.dataFormat==="channelsLast",$=new Ls(y.outShape,i.dtype),G=Pt(i.shape),H=Pt(c.shape),Z=G[0],re=L?G[1]:G[2],oe=L?G[2]:1,ae=L?1:G[1],Ee=$.strides[0],Ce=L?$.strides[1]:$.strides[2],ye=L?$.strides[2]:1,we=L?1:$.strides[1],Ae=n.data.get(i.dataId).values,Oe=n.data.get(c.dataId).values,Me=$.values;for(let me=0;me<y.batchSize;++me){const Te=me*Z,ke=me*Ee;for(let Fe=0;Fe<y.outHeight;++Fe){const Xe=ke+Fe*Ce,Ye=Fe*y.strideHeight-O;for(let tt=0;tt<v;++tt){const et=Ye+tt*b;if(et<0||et>=y.inHeight)continue;const nt=tt*H[0],gt=Te+et*re;for(let Ct=0;Ct<y.outWidth;++Ct){const Tt=Xe+Ct*ye,Lt=Ct*y.strideWidth-R;for(let St=0;St<I;++St){const un=Lt+St*A;if(un<0||un>=y.inWidth)continue;const Kt=nt+St*H[1],sn=gt+un*oe;let on=Kt;for(let Zt=0;Zt<y.inChannels;++Zt){const xn=Ae[sn+Zt*ae];for(let pn=0;pn<y.outChannels;++pn)Me[Tt+pn*we]+=xn*Oe[on+pn];on+=y.outChannels}}}}}}return n.makeTensorInfo($.shape,$.dtype,Me)}const che={kernelName:Tw,backendName:"cpu",kernelFunc:v8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uhe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:c}=e,{strides:l,pad:d,dataFormat:p,dimRoundingMode:f,filterShape:m}=s;Rt([i,c],"conv2dBackpropFilter");const _=cu(p),y=$s(i.shape,m,l,1,d,f,!1,_),{strideHeight:v,strideWidth:I,filterHeight:b,filterWidth:A}=y,R=y.dataFormat==="channelsLast",O=new Ls(y.filterShape,"float32"),L=y.padInfo.left,$=y.padInfo.top,G=n.data.get(i.dataId).values,H=n.data.get(c.dataId).values,Z=new Ls(i.shape,i.dtype,G),re=new Ls(c.shape,c.dtype,H);for(let oe=0;oe<b;++oe){const ae=Math.max(0,Math.ceil(($-oe)/v)),Ee=Math.min(y.outHeight,(y.inHeight+$-oe)/v);for(let Ce=0;Ce<A;++Ce){const ye=Math.max(0,Math.ceil((L-Ce)/I)),we=Math.min(y.outWidth,(y.inWidth+L-Ce)/I);for(let Ae=0;Ae<y.inChannels;++Ae)for(let Oe=0;Oe<y.outChannels;++Oe){let Me=0;for(let me=0;me<y.batchSize;++me)for(let Te=ae;Te<Ee;++Te){const ke=oe+Te*v-$;for(let Fe=ye;Fe<we;++Fe){const Xe=Ce+Fe*I-L;R?Me+=Z.get(me,ke,Xe,Ae)*re.get(me,Te,Fe,Oe):Me+=Z.get(me,Ae,ke,Xe)*re.get(me,Oe,Te,Fe)}}O.set(Me,oe,Ce,Ae,Oe)}}}return n.makeTensorInfo(O.shape,O.dtype,O.values)}const lhe={kernelName:Iw,backendName:"cpu",kernelFunc:uhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dhe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:c}=e,{inputShape:l,strides:d,pad:p,dataFormat:f,dimRoundingMode:m}=s;Rt([i,c],"conv2dBackpropInput");const _=Pt(c.shape),y=Pt(i.shape);let v=cu(f);const I=$s(l,c.shape,d,1,p,m,!1,v),b=new Ls(I.inShape,"float32"),A=b.values,R=n.data.get(i.dataId).values,O=n.data.get(c.dataId).values,[L,$,G]=_,{batchSize:H,filterHeight:Z,filterWidth:re,inChannels:oe,inHeight:ae,inWidth:Ee,outChannels:Ce,outHeight:ye,outWidth:we,strideHeight:Ae,strideWidth:Oe}=I;v=I.dataFormat;const Me=Z-1-I.padInfo.top,me=re-1-I.padInfo.left,Te=v==="channelsLast",ke=b.strides[0],Fe=Te?b.strides[1]:b.strides[2],Xe=Te?b.strides[2]:1,Ye=Te?1:b.strides[1],tt=y[0],et=Te?y[1]:y[2],nt=Te?y[2]:1,gt=Te?1:y[1];for(let Ct=0;Ct<H;++Ct)for(let Tt=0;Tt<oe;++Tt)for(let Lt=0;Lt<ae;++Lt){const St=Lt-Me,un=Math.max(0,Math.ceil(St/Ae)),Kt=Math.min(ye,(Z+St)/Ae);for(let sn=0;sn<Ee;++sn){const on=sn-me,Zt=Math.max(0,Math.ceil(on/Oe)),xn=Math.min(we,(re+on)/Oe);let pn=0;for(let Pn=un;Pn<Kt;++Pn){const Bn=Pn*Ae-St;for(let Ar=Zt;Ar<xn;++Ar){const fo=Ar*Oe-on,ps=tt*Ct+et*Pn+nt*Ar,Qr=L*(Z-1-Bn)+$*(re-1-fo)+G*Tt;for(let Lr=0;Lr<Ce;++Lr){const Wr=R[ps+gt*Lr],_r=O[Qr+Lr];pn+=Wr*_r}}}const Fn=ke*Ct+Fe*Lt+Xe*sn+Ye*Tt;A[Fn]=pn}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const hhe={kernelName:Cw,backendName:"cpu",kernelFunc:dhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function phe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:c}=e,{strides:l,pad:d,dilations:p}=s;Rt([i,c],"conv3d");const f=Cl(i.shape,c.shape,l,p,d),{filterDepth:m,filterHeight:_,filterWidth:y,dilationDepth:v,dilationHeight:I,dilationWidth:b,padInfo:A}=f,R=A.front,O=A.left,L=A.top,$=new Ls(f.outShape,i.dtype),G=n.data.get(i.dataId).values,H=n.data.get(c.dataId).values,Z=$.values,re=Pt(i.shape),oe=Pt(c.shape);for(let ae=0;ae<f.batchSize;++ae){const Ee=ae*re[0],Ce=ae*$.strides[0];for(let ye=0;ye<f.outDepth;++ye){const we=Ce+ye*$.strides[1],Ae=ye*f.strideDepth-R;for(let Oe=0;Oe<m;++Oe){const Me=Ae+Oe*v;if(Me<0||Me>=f.inDepth)continue;const me=Oe*oe[0],Te=Ee+Me*re[1];for(let ke=0;ke<f.outHeight;++ke){const Fe=we+ke*$.strides[2],Xe=ke*f.strideHeight-L;for(let Ye=0;Ye<_;++Ye){const tt=Xe+Ye*I;if(tt<0||tt>=f.inHeight)continue;const et=me+Ye*oe[1],nt=Te+tt*re[2];for(let gt=0;gt<f.outWidth;++gt){const Ct=Fe+gt*f.outChannels,Tt=gt*f.strideWidth-O;for(let Lt=0;Lt<y;++Lt){const St=Tt+Lt*b;if(St<0||St>=f.inWidth)continue;const un=et+Lt*oe[2],Kt=nt+St*f.inChannels;let sn=un;for(let on=0;on<f.inChannels;++on){const Zt=G[Kt+on];for(let xn=0;xn<f.outChannels;++xn)Z[Ct+xn]+=Zt*H[sn+xn];sn+=f.outChannels}}}}}}}}return n.makeTensorInfo($.shape,$.dtype,$.values)}const fhe={kernelName:ww,backendName:"cpu",kernelFunc:phe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mhe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:c}=e,{strides:l,pad:d,filterShape:p}=s;Rt([i,c],"conv3dBackpropFilterV2");const f=Pt(i.shape),m=Pt(c.shape),_=Cl(i.shape,p,l,1,d),y=_.strideDepth,v=_.strideHeight,I=_.strideWidth,b=_.filterDepth,A=_.filterHeight,R=_.filterWidth,O=new Ls(_.filterShape,"float32"),L=O.values,[$,G,H,Z]=O.strides,re=n.data.get(c.dataId).values,[oe,ae,Ee,Ce]=m,ye=n.data.get(i.dataId).values,[we,Ae,Oe,Me]=f,me=_.padInfo.front,Te=_.padInfo.left,ke=_.padInfo.top;for(let Fe=0;Fe<b;++Fe){const Xe=Math.max(0,Math.ceil((me-Fe)/y)),Ye=Math.min(_.outDepth,(_.inDepth+me-Fe)/y),tt=Fe*$;for(let et=0;et<A;++et){const nt=Math.max(0,Math.ceil((ke-et)/v)),gt=Math.min(_.outHeight,(_.inHeight+ke-et)/v),Ct=et*G+tt;for(let Tt=0;Tt<R;++Tt){const Lt=Math.max(0,Math.ceil((Te-Tt)/I)),St=Math.min(_.outWidth,(_.inWidth+Te-Tt)/I),un=Tt*H+Ct;for(let Kt=0;Kt<_.inChannels;++Kt){const sn=Kt*Z+un;for(let on=0;on<_.outChannels;++on){let Zt=0;for(let xn=0;xn<_.batchSize;++xn){const pn=xn*we,Fn=xn*oe;for(let Pn=Xe;Pn<Ye;++Pn){const Ar=(Fe+Pn*y-me)*Ae+pn,fo=Pn*ae+Fn;for(let ps=nt;ps<gt;++ps){const Lr=(et+ps*v-ke)*Oe+Ar,Wr=ps*Ee+fo;for(let _r=Lt;_r<St;++_r){const _i=(Tt+_r*I-Te)*Me+Lr,Hi=_r*Ce+Wr;Zt+=ye[_i+Kt]*re[Hi+on]}}}}L[sn+on]=Zt}}}}}return n.makeTensorInfo(O.shape,O.dtype,O.values)}const ghe={kernelName:t6,backendName:"cpu",kernelFunc:mhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ehe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:c}=e,{pad:l,strides:d,inputShape:p}=s;Rt([i],"conv3dBackpropInputV2");const f=Pt(i.shape),m=Pt(c.shape),_=Cl(p,c.shape,d,1,l),y=new Ls(_.inShape,"float32"),v=y.values,[I,b,A,R]=y.strides,O=n.data.get(i.dataId).values,[L,$,G,H]=f,Z=n.data.get(c.dataId).values,[re,oe,ae,Ee]=m,{batchSize:Ce,filterDepth:ye,filterHeight:we,filterWidth:Ae,inChannels:Oe,inDepth:Me,inHeight:me,inWidth:Te,outChannels:ke,outDepth:Fe,outHeight:Xe,outWidth:Ye,strideDepth:tt,strideHeight:et,strideWidth:nt}=_,gt=ye-1-_.padInfo.front,Ct=we-1-_.padInfo.top,Tt=Ae-1-_.padInfo.left;for(let Lt=0;Lt<Ce;++Lt)for(let St=0;St<Oe;++St)for(let un=0;un<Me;++un){const Kt=un-gt,sn=Math.max(0,Math.ceil(Kt/tt)),on=Math.min(Fe,(ye+Kt)/tt);for(let Zt=0;Zt<me;++Zt){const xn=Zt-Ct,pn=Math.max(0,Math.ceil(xn/et)),Fn=Math.min(Xe,(we+xn)/et);for(let Pn=0;Pn<Te;++Pn){const Bn=Pn-Tt,Ar=Math.max(0,Math.ceil(Bn/nt)),fo=Math.min(Ye,(Ae+Bn)/nt);let ps=0;for(let Qr=sn;Qr<on;++Qr){const Lr=Qr*tt-Kt;for(let Wr=pn;Wr<Fn;++Wr){const _r=Wr*et-xn;for(let Uo=Ar;Uo<fo;++Uo){const _i=Uo*nt-Bn,Hi=L*Lt+$*Qr+G*Wr+H*Uo,du=re*(ye-1-Lr)+oe*(we-1-_r)+ae*(Ae-1-_i)+Ee*St;for(let wa=0;wa<ke;++wa){const is=O[Hi+wa],yr=Z[du+wa];ps+=is*yr}}}}v[I*Lt+b*un+A*Zt+R*Pn+St]=ps}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const _he={kernelName:Rw,backendName:"cpu",kernelFunc:Ehe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yhe=Yn(e_,t=>Math.cos(t)),vhe={kernelName:e_,backendName:"cpu",kernelFunc:yhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const She=Yn(t_,t=>Math.cosh(t)),The={kernelName:t_,backendName:"cpu",kernelFunc:She};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ihe(t){const{inputs:e,backend:n,attrs:s}=t,{image:i,boxes:c,boxInd:l}=e,{cropSize:d,method:p,extrapolationValue:f}=s,[m,_,y,v]=i.shape,I=c.shape[0],[b,A]=d,R=cn([I,b,A,v],"float32"),O=n.data.get(c.dataId).values,L=n.data.get(l.dataId).values,$=n.data.get(i.dataId).values,G=Pt(i.shape),H=Pt(R.shape);for(let Z=0;Z<I;Z++){const re=Z*4,oe=O[re],ae=O[re+1],Ee=O[re+2],Ce=O[re+3],ye=L[Z];if(ye>=m)continue;const we=b>1?(Ee-oe)*(_-1)/(b-1):0,Ae=A>1?(Ce-ae)*(y-1)/(A-1):0;for(let Oe=0;Oe<b;Oe++){const Me=b>1?oe*(_-1)+Oe*we:.5*(oe+Ee)*(_-1);if(Me<0||Me>_-1){for(let me=0;me<A;me++)for(let Te=0;Te<v;Te++){const ke=Te+me*H[2]+Oe*H[1]+Z*H[0];R.values[ke]=f}continue}if(p==="bilinear"){const me=Math.floor(Me),Te=Math.ceil(Me),ke=Me-me;for(let Fe=0;Fe<A;Fe++){const Xe=A>1?ae*(y-1)+Fe*Ae:.5*(ae+Ce)*(y-1);if(Xe<0||Xe>y-1){for(let nt=0;nt<v;nt++){const gt=nt+Fe*H[2]+Oe*H[1]+Z*H[0];R.values[gt]=f}continue}const Ye=Math.floor(Xe),tt=Math.ceil(Xe),et=Xe-Ye;for(let nt=0;nt<v;nt++){let gt=nt+Ye*G[2]+me*G[1]+ye*G[0];const Ct=$[gt];gt=nt+tt*G[2]+me*G[1]+ye*G[0];const Tt=$[gt];gt=nt+Ye*G[2]+Te*G[1]+ye*G[0];const Lt=$[gt];gt=nt+tt*G[2]+Te*G[1]+ye*G[0];const St=$[gt],un=Ct+(Tt-Ct)*et,Kt=Lt+(St-Lt)*et;gt=nt+Fe*H[2]+Oe*H[1]+Z*H[0],R.values[gt]=un+(Kt-un)*ke}}}else for(let me=0;me<A;++me){const Te=A>1?ae*(y-1)+me*Ae:.5*(ae+Ce)*(y-1);if(Te<0||Te>y-1){for(let Xe=0;Xe<v;Xe++){const Ye=Xe+me*H[2]+Oe*H[1]+Z*H[0];R.values[Ye]=f}continue}const ke=Math.round(Te),Fe=Math.round(Me);for(let Xe=0;Xe<v;Xe++){const Ye=Xe+ke*G[2]+Fe*G[1]+ye*G[0],tt=Xe+me*H[2]+Oe*H[1]+Z*H[0];R.values[tt]=$[Ye]}}}}return n.makeTensorInfo(R.shape,R.dtype,R.values)}const Che={kernelName:Aw,backendName:"cpu",kernelFunc:Ihe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function whe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,exclusive:l,reverse:d}=s;Rt(i,"cumprod");const p=ss([c],i.shape.length);let f=i;p!=null&&(f=Ho({inputs:{x:i},backend:n,attrs:{perm:p}}));const m=os(1,i.shape.length)[0];if(m!==f.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${f.shape.length-1} but got axis=${m}`);const _=pi(f.dtype,"int32"),y=ow(Pe(f.shape),_),v=n.data.get(f.dataId).values,I=f.shape[f.shape.length-1],b=d?(R,O)=>R+I-O-1:(R,O)=>R+O;for(let R=0;R<v.length;R+=I)for(let O=0;O<I;O++){const L=b(R,O);if(O===0)y[L]=l?1:v[L];else{const $=b(R,O-1);y[L]=l?v[$]*y[$]:v[L]*y[$]}}const A=n.makeTensorInfo(f.shape,_,y);if(p!=null){const R=sg(p),O=Ho({inputs:{x:A},backend:n,attrs:{perm:R}});return n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(f),O}return A}const Rhe={kernelName:bw,backendName:"cpu",kernelFunc:whe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bhe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,exclusive:l,reverse:d}=s;Rt(i,"cumsum");const p=ss([c],i.shape.length);let f=i;p!=null&&(f=Ho({inputs:{x:i},backend:n,attrs:{perm:p}}));const m=os(1,i.shape.length)[0];if(m!==f.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${f.shape.length-1} but got axis=${m}`);const _=pi(f.dtype,"int32"),y=lo(Pe(f.shape),_),v=n.data.get(f.dataId).values,I=f.shape[f.shape.length-1],b=d?(R,O)=>R+I-O-1:(R,O)=>R+O;for(let R=0;R<v.length;R+=I)for(let O=0;O<I;O++){const L=b(R,O);if(O===0)y[L]=l?0:v[L];else{const $=b(R,O-1);y[L]=l?v[$]+y[$]:v[L]+y[$]}}const A=n.makeTensorInfo(f.shape,_,y);if(p!=null){const R=sg(p),O=Ho({inputs:{x:A},backend:n,attrs:{perm:R}});return n.disposeIntermediateTensorInfo(A),n.disposeIntermediateTensorInfo(f),O}return A}const Nhe={kernelName:Nw,backendName:"cpu",kernelFunc:bhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ahe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:c}=e,{size:l,binaryOutput:d}=s;if(i.shape.length===1){const p=n.data.get(i.dataId).values,f=n.data.get(c.dataId).values,m=zb(p,f,c.dtype,c.shape,l);return n.makeTensorInfo([l],c.dtype,m)}else if(i.shape.length===2){const p=n.bufferSync(i),f=n.bufferSync(c),m=wV(p,f,l,d);return n.makeTensorInfo(m.shape,c.dtype,m.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const Ohe={kernelName:Ow,backendName:"cpu",kernelFunc:Ahe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xhe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockSize:c,dataFormat:l}=s;se(l==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${l}`);const d=i.shape[0],p=i.shape[1],f=i.shape[2],m=i.shape[3],_=p*c,y=f*c,v=m/(c*c),I=n.data.get(i.dataId).values,b=new Float32Array(d*_*y*v);let A=0;for(let R=0;R<d;++R)for(let O=0;O<_;++O){const L=Math.floor(O/c),$=O%c;for(let G=0;G<y;++G){const H=Math.floor(G/c),Z=G%c,re=($*c+Z)*v;for(let oe=0;oe<v;++oe){const Ee=oe+re+m*(H+f*(L+p*R));b[A++]=I[Ee]}}}return n.makeTensorInfo([d,_,y,v],i.dtype,b)}const khe={kernelName:xw,backendName:"cpu",kernelFunc:xhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S8(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:c}=e,{strides:l,pad:d,dilations:p,dimRoundingMode:f}=s;Rt([i,c],"depthwiseConv2DNative");const m=Pt(i.shape),_=Pt(c.shape);let y=p;y==null&&(y=[1,1]),se(ho(l,y),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${y}'`);const v=$s(i.shape,c.shape,l,y,d,f,!0),{filterHeight:I,filterWidth:b,dilationHeight:A,dilationWidth:R,padInfo:O}=v,L=O.left,$=O.top,G=v.outChannels/v.inChannels,H=new Ls(v.outShape,i.dtype),Z=n.data.get(i.dataId).values,re=n.data.get(c.dataId).values,oe=H.values;for(let ae=0;ae<v.batchSize;++ae){const Ee=ae*m[0],Ce=ae*H.strides[0];for(let ye=0;ye<v.outHeight;++ye){const we=Ce+ye*H.strides[1],Ae=ye*v.strideHeight-$;for(let Oe=0;Oe<I;++Oe){const Me=Ae+Oe*A;if(Me<0||Me>=v.inHeight)continue;const me=Oe*_[0],Te=Ee+Me*m[1];for(let ke=0;ke<v.outWidth;++ke){const Fe=we+ke*H.strides[2],Xe=ke*v.strideWidth-L;for(let Ye=0;Ye<b;++Ye){const tt=Xe+Ye*R;if(tt<0||tt>=v.inWidth)continue;const et=me+Ye*_[1],nt=Te+tt*v.inChannels;let gt=Fe,Ct=et;for(let Tt=0;Tt<v.inChannels;++Tt){const Lt=Z[nt+Tt];for(let St=0;St<G;++St)oe[gt+St]+=Lt*re[Ct+St];gt+=G,Ct+=G}}}}}}return n.makeTensorInfo(H.shape,H.dtype,H.values)}const Dhe={kernelName:kw,backendName:"cpu",kernelFunc:S8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Phe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:c}=e,{strides:l,dilations:d,pad:p,dimRoundingMode:f,filterShape:m}=s;Rt([i,c],"depthwiseConv2dNativeBackpropFilter");const _=$s(i.shape,m,l,d,p,f,!0),{strideHeight:y,strideWidth:v,filterHeight:I,filterWidth:b}=_,A=new Ls(_.filterShape,"float32"),R=_.padInfo.left,O=_.padInfo.top,L=_.outChannels/_.inChannels,$=n.data.get(i.dataId).values,G=new Ls(i.shape,i.dtype,$),H=n.data.get(c.dataId).values,Z=new Ls(c.shape,c.dtype,H);for(let re=0;re<I;++re){const oe=Math.max(0,Math.ceil((O-re)/y)),ae=Math.min(_.outHeight,(_.inHeight+O-re)/y);for(let Ee=0;Ee<b;++Ee){const Ce=Math.max(0,Math.ceil((R-Ee)/v)),ye=Math.min(_.outWidth,(_.inWidth+R-Ee)/v);for(let we=0;we<_.outChannels;++we){const Ae=Math.trunc(we/L),Oe=we%L;let Me=0;for(let me=0;me<_.batchSize;++me)for(let Te=oe;Te<ae;++Te){const ke=re+Te*y-O;for(let Fe=Ce;Fe<ye;++Fe){const Xe=Ee+Fe*v-R;Me+=G.get(me,ke,Xe,Ae)*Z.get(me,Te,Fe,we)}}A.set(Me,re,Ee,Ae,Oe)}}}return n.makeTensorInfo(A.shape,A.dtype,A.values)}const Lhe={kernelName:Dw,backendName:"cpu",kernelFunc:Phe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mhe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:c}=e,{strides:l,dilations:d,pad:p,dimRoundingMode:f,inputShape:m}=s;Rt([i,c],"depthwiseConv2DNativeBackpropInput");const _=Pt(i.shape),y=Pt(c.shape),v=$s(m,c.shape,l,d,p,f,!0),I=new Ls(v.inShape,"float32"),b=I.values,[A,R,O]=I.strides,L=n.data.get(i.dataId).values,[$,G,H]=_,Z=n.data.get(c.dataId).values,[re,oe,ae]=y,{batchSize:Ee,filterHeight:Ce,filterWidth:ye,inChannels:we,inHeight:Ae,inWidth:Oe,outChannels:Me,outHeight:me,outWidth:Te,strideHeight:ke,strideWidth:Fe}=v,Xe=Ce-1-v.padInfo.top,Ye=ye-1-v.padInfo.left,tt=Me/we;for(let et=0;et<Ee;++et)for(let nt=0;nt<we;++nt)for(let gt=0;gt<Ae;++gt){const Ct=gt-Xe,Tt=Math.max(0,Math.ceil(Ct/ke)),Lt=Math.min(me,(Ce+Ct)/ke);for(let St=0;St<Oe;++St){const un=St-Ye,Kt=Math.max(0,Math.ceil(un/Fe)),sn=Math.min(Te,(ye+un)/Fe);let on=0;for(let Zt=Tt;Zt<Lt;++Zt){const xn=Zt*ke-Ct;for(let pn=Kt;pn<sn;++pn){const Fn=pn*Fe-un,Pn=$*et+G*Zt+H*pn,Bn=re*(Ce-1-xn)+oe*(ye-1-Fn)+ae*nt;for(let Ar=0;Ar<tt;++Ar){const fo=nt*tt+Ar,ps=L[Pn+fo],Qr=Z[Bn+Ar];on+=ps*Qr}}}b[A*et+R*gt+O*St+nt]=on}}return n.makeTensorInfo(I.shape,I.dtype,I.values)}const $he={kernelName:Pw,backendName:"cpu",kernelFunc:Mhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fhe(t){const{inputs:e,backend:n}=t,{x:s}=e,i=Pe(s.shape),c=n.data.get(s.dataId).values,l=cn([i,i],s.dtype),d=l.values;for(let f=0;f<c.length;f++)d[f*i+f]=c[f];const p=[...s.shape,...s.shape];return n.makeTensorInfo(p,l.dtype,l.values)}const Uhe={kernelName:Lw,backendName:"cpu",kernelFunc:Fhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vhe={kernelName:Mw,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:i}=t,{strides:c,pad:l,dilations:d}=n,p=e,f=p.data.get(s.dataId).values,m=s.shape.length,_=p.data.get(i.dataId).values,y=i.shape.length,{batchSize:v,inHeight:I,inWidth:b,inChannels:A,outHeight:R,outWidth:O,padInfo:L,strideHeight:$,strideWidth:G,filterHeight:H,filterWidth:Z,dilationHeight:re,dilationWidth:oe,outShape:ae}=rg(s.shape,i.shape,c,l,"NHWC",d),Ee=Pe(ae),Ce=ae.length,ye=Ps(s.dtype,Ee);for(let Ae=0;Ae<v;++Ae)for(let Oe=0;Oe<R;++Oe){const Me=Oe*$-L.top;for(let me=0;me<O;++me){const Te=me*G-L.left;for(let ke=0;ke<A;++ke){let Fe=Number.MIN_SAFE_INTEGER;for(let Ye=0;Ye<H;++Ye){const tt=Me+Ye*re;if(tt>=0&&tt<I)for(let et=0;et<Z;++et){const nt=Te+et*oe;if(nt>=0&&nt<b){const gt=_c([Ae,tt,nt,ke],m,Pt(s.shape)),Ct=_c([Ye,et,ke],y,Pt(i.shape)),Tt=f[gt]+_[Ct];Tt>Fe&&(Fe=Tt)}}}const Xe=_c([Ae,Oe,me,ke],Ce,Pt(ae));ye[Xe]=Fe}}}return{dataId:p.write(Vd(ye,s.dtype),ae,s.dtype),shape:ae,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bhe={kernelName:fM,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:i,dy:c}=t,{strides:l,pad:d,dilations:p}=n,f=e,m=ya(s.shape,f.data.get(s.dataId).values),_=ya(i.shape,f.data.get(i.dataId).values),{batchSize:y,inHeight:v,inWidth:I,inChannels:b,outHeight:A,outWidth:R,padInfo:O,strideHeight:L,strideWidth:$,filterHeight:G,filterWidth:H,dilationHeight:Z,dilationWidth:re,outShape:oe}=rg(s.shape,i.shape,l,d,"NHWC",p);se(c.rank===oe.length,()=>`Error in ${fM}, dy must have the same rank as output ${oe.length}, but got ${c.rank}`);const ae=ya(oe,f.data.get(c.dataId).values),Ee=XU(i.shape,i.dtype);for(let ye=0;ye<y;++ye)for(let we=0;we<A;++we){const Ae=we*L-O.top;for(let Oe=0;Oe<R;++Oe){const Me=Oe*$-O.left;for(let me=0;me<b;++me){let Te=Number.MIN_SAFE_INTEGER,ke=0,Fe=0;for(let Xe=0;Xe<G;++Xe){const Ye=Ae+Xe*Z;if(Ye>=0&&Ye<v)for(let tt=0;tt<H;++tt){const et=Me+tt*re;if(et>=0&&et<I){const nt=m[ye][Ye][et][me]+_[Xe][tt][me];nt>Te&&(Te=nt,ke=Xe,Fe=tt)}}}Ee[ke][Fe][me]+=ae[ye][we][Oe][me]}}}return{dataId:f.write(Vd(Ee,s.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jhe={kernelName:pM,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:i,dy:c}=t,{strides:l,pad:d,dilations:p}=n,f=e,m=ya(s.shape,f.data.get(s.dataId).values),_=ya(i.shape,f.data.get(i.dataId).values),{batchSize:y,inHeight:v,inWidth:I,inChannels:b,outHeight:A,outWidth:R,padInfo:O,strideHeight:L,strideWidth:$,filterHeight:G,filterWidth:H,dilationHeight:Z,dilationWidth:re,outShape:oe}=rg(s.shape,i.shape,l,d,"NHWC",p);se(c.rank===oe.length,()=>`Error in ${pM}, dy must have the same rank as output ${oe.length}, but got ${c.rank}`);const ae=ya(oe,f.data.get(c.dataId).values),Ee=XU(s.shape,s.dtype);for(let ye=0;ye<y;++ye)for(let we=0;we<A;++we){const Ae=we*L-O.top;for(let Oe=0;Oe<R;++Oe){const Me=Oe*$-O.left;for(let me=0;me<b;++me){let Te=Number.MIN_SAFE_INTEGER,ke=Ae<0?0:Ae,Fe=Me<0?0:Me;for(let Xe=0;Xe<G;++Xe){const Ye=Ae+Xe*Z;if(Ye>=0&&Ye<v)for(let tt=0;tt<H;++tt){const et=Me+tt*re;if(et>=0&&et<I){const nt=m[ye][Ye][et][me]+_[Xe][tt][me];nt>Te&&(Te=nt,ke=Ye,Fe=et)}}}Ee[ye][ke][Fe][me]+=ae[ye][we][Oe][me]}}}return{dataId:f.write(Vd(Ee,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ug(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,keepDims:l}=s;Rt(i,"sum");let d;i.dtype==="bool"?d=gl({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):d=Tc({inputs:{x:i},backend:n});const p=d.shape.length,f=$n(c,d.shape),m=ss(f,p);let _=f,y=d;m!=null&&(y=Ho({inputs:{x:d},backend:n,attrs:{perm:m}}),_=os(_.length,p)),Xs("sum",_,y.shape.length);const[v,I]=qs(y.shape,_),b=pi(y.dtype,"int32");let A=_1(n,v,b);const R=Pe(I),O=n.data.get(A.dataId).values,L=n.data.get(y.dataId).values;for(let $=0;$<O.length;++$){const G=$*R;let H=0;for(let Z=0;Z<R;++Z)H+=L[G+Z];O[$]=H}if(l){const $=Cs(A.shape,f),G=A;A=gr({inputs:{x:A},backend:n,attrs:{shape:$}}),n.disposeIntermediateTensorInfo(G)}return n.disposeIntermediateTensorInfo(d),m!=null&&n.disposeIntermediateTensorInfo(y),A}const Whe={kernelName:RR,backendName:"cpu",kernelFunc:ug};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ghe(t){const{inputs:e,backend:n,attrs:s}=t,{equation:i}=s,c=e,{allDims:l,summedDims:d,idDims:p}=Mb(i,c.length);Fb(l.length,p,c);const{path:f,steps:m}=Ub(d,p),_=m.length;let y=null,v=l.length;const I=[];for(let b=0;b<_;++b){for(const A of m[b]){const{permutationIndices:R,expandDims:O}=$b(v,p[A]);let L;Vb(R)?L=c[A]:(L=Ho({inputs:{x:c[A]},backend:n,attrs:{perm:R}}),I.push(L));const $=L.shape.slice();for(let G=0;G<O.length;++G)$.splice(O[G],0,1);Nr(L.shape,$)||(L=gr({inputs:{x:L},backend:n,attrs:{shape:$}}),I.push(L)),y===null?y=L:(y=uy({inputs:{a:L,b:y},backend:n}),I.push(y))}b<_-1&&(f[b]>=0&&(y=ug({inputs:{x:y},backend:n,attrs:{axis:f[b]-(l.length-v),keepDims:!1}}),I.push(y)),v--)}for(const b of I)b!==y&&n.disposeIntermediateTensorInfo(b);return y}const zhe={kernelName:$w,backendName:"cpu",kernelFunc:Ghe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hhe(t){const{inputs:e,backend:n}=t,{dy:s,y:i}=e;Rt([s,i],"eluGrad");const c=new Float32Array(Pe(i.shape)),l=n.data.get(i.dataId).values,d=n.data.get(s.dataId).values;for(let p=0;p<l.length;++p){const f=l[p];f>=1?c[p]=d[p]:c[p]=d[p]*(f+1)}return n.makeTensorInfo(i.shape,"float32",c)}const Khe={kernelName:n6,backendName:"cpu",kernelFunc:Hhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qhe=Ab,Xhe=Ob,Yhe=xb,Jhe=kb,Qhe=Db,Zhe=Pb,epe=Yn(s_,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+qhe*n);return e*(1-((((Zhe*s+Qhe)*s+Jhe)*s+Yhe)*s+Xhe)*s*Math.exp(-n*n))}),tpe={kernelName:s_,backendName:"cpu",kernelFunc:epe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S1(t){const{inputs:e,backend:n,attrs:s}=t,{input:i}=e,{dim:c}=s,l=i.shape.length,d=i.shape.slice();let p=c;return c<0&&(se(-(l+1)<=c,()=>`Axis must be in the interval [${-(l+1)}, ${l}]`),p=l+c+1),d.splice(p,0,1),gr({inputs:{x:i},backend:n,attrs:{shape:d}})}const npe={kernelName:Fw,backendName:"cpu",kernelFunc:S1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rpe=hs((t,e)=>t/e),Jb=Fs(n_,rpe),rC={kernelName:n_,backendName:"cpu",kernelFunc:Jb};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T8(t,e,n){const s=t.shape,i=s[0],c=s[1],l=n.data.get(t.dataId),d=l.complexTensorInfos.real,p=l.complexTensorInfos.imag,f=[i,c],m=Pe(f),_=Ms("float32",m),y=Ms("float32",m);for(let A=0;A<i;A++){const R=Md({inputs:{x:d},backend:n,attrs:{begin:[A,0],size:[1,c]}}),O=Md({inputs:{x:p},backend:n,attrs:{begin:[A,0],size:[1,c]}}),L=ai({inputs:{real:R,imag:O},backend:n}),{real:$,imag:G}=spe(L,e,n),H=ru($,G);for(let Z=0;Z<c;Z++){const re=Lb(H,Z);_[A*c+Z]=re.real,y[A*c+Z]=re.imag}n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(O),n.disposeIntermediateTensorInfo(L)}const v=n.makeTensorInfo(f,"float32",_),I=n.makeTensorInfo(f,"float32",y),b=ai({inputs:{real:v,imag:I},backend:n});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(I),b}function spe(t,e,n){const s=Pe(t.shape),i=n.data.get(t.dataId),c=n.data.get(i.complexTensorInfos.real.dataId).values,l=n.data.get(i.complexTensorInfos.imag.dataId).values;if(ope(s)){const d=sC(c,l,s,e,n),p=[t.shape[0],t.shape[1]];if(e){const f=n.makeTensorInfo(p,"float32",d.real),m=n.makeTensorInfo(p,"float32",d.imag),_=n.makeTensorInfo([],"float32",Sl(s,"float32")),y=Tc({inputs:{x:_},backend:n}),v=rC.kernelFunc({inputs:{a:f,b:_},backend:n}),I=rC.kernelFunc({inputs:{a:m,b:y},backend:n}),b=n.data.get(v.dataId).values,A=n.data.get(I.dataId).values;return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(I),{real:b,imag:A}}return d}else{const d=ru(c,l),p=ipe(d,s,e);return G5(p)}}function ope(t){return(t&t-1)===0}function sC(t,e,n,s,i){if(n===1)return{real:t,imag:e};const c=ru(t,e),l=n/2,d=z5(c),p=d.real,f=d.imag,m=[p.length],_=i.makeTensorInfo(m,"float32",p),y=i.makeTensorInfo(m,"float32",f),v=ai({inputs:{real:_,imag:y},backend:i}),I=H5(c),b=I.real,A=I.imag,R=[b.length],O=i.makeTensorInfo(R,"float32",b),L=i.makeTensorInfo(R,"float32",A),$=ai({inputs:{real:O,imag:L},backend:i}),G=sC(p,f,l,s,i),H=G.real,Z=G.imag,re=[H.length],oe=i.makeTensorInfo(re,"float32",H),ae=i.makeTensorInfo(re,"float32",Z),Ee=ai({inputs:{real:oe,imag:ae},backend:i}),Ce=sC(b,A,l,s,i),ye=Ce.real,we=Ce.imag,Ae=[ye.length],Oe=i.makeTensorInfo(Ae,"float32",ye),Me=i.makeTensorInfo(Ae,"float32",we),me=ai({inputs:{real:Oe,imag:Me},backend:i}),Te=q5(n,s),ke=[Te.real.length],Fe=i.makeTensorInfo(ke,"float32",Te.real),Xe=i.makeTensorInfo(ke,"float32",Te.imag),Ye=ai({inputs:{real:Fe,imag:Xe},backend:i}),tt=uy({inputs:{a:Ye,b:me},backend:i}),et=Op({inputs:{a:Ee,b:tt},backend:i}),nt=Xb({inputs:{a:Ee,b:tt},backend:i}),gt=Ld({inputs:{input:et},backend:i}),Ct=Ld({inputs:{input:nt},backend:i}),Tt=xp({inputs:{input:et},backend:i}),Lt=xp({inputs:{input:nt},backend:i}),St=kp({inputs:[gt,Ct],backend:i,attrs:{axis:0}}),un=kp({inputs:[Tt,Lt],backend:i,attrs:{axis:0}}),Kt=i.data.get(St.dataId).values,sn=i.data.get(un.dataId).values;return i.disposeIntermediateTensorInfo(_),i.disposeIntermediateTensorInfo(y),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(O),i.disposeIntermediateTensorInfo(L),i.disposeIntermediateTensorInfo($),i.disposeIntermediateTensorInfo(oe),i.disposeIntermediateTensorInfo(ae),i.disposeIntermediateTensorInfo(Ee),i.disposeIntermediateTensorInfo(Oe),i.disposeIntermediateTensorInfo(Me),i.disposeIntermediateTensorInfo(me),i.disposeIntermediateTensorInfo(Fe),i.disposeIntermediateTensorInfo(Xe),i.disposeIntermediateTensorInfo(Ye),i.disposeIntermediateTensorInfo(tt),i.disposeIntermediateTensorInfo(et),i.disposeIntermediateTensorInfo(nt),i.disposeIntermediateTensorInfo(gt),i.disposeIntermediateTensorInfo(Tt),i.disposeIntermediateTensorInfo(Ct),i.disposeIntermediateTensorInfo(Lt),i.disposeIntermediateTensorInfo(St),i.disposeIntermediateTensorInfo(un),{real:Kt,imag:sn}}function ipe(t,e,n){const s=new Float32Array(e*2);for(let i=0;i<e;i++){let c=0,l=0;for(let d=0;d<e;d++){const p=X5(i*d,e,n),f=Lb(t,d);c+=f.real*p.real-f.imag*p.imag,l+=f.real*p.imag+f.imag*p.real}n&&(c/=e,l/=e),K5(s,c,l,i)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ape(t){const{inputs:e,backend:n}=t,{input:s}=e,i=Pe(s.shape),c=s.shape[s.shape.length-1],l=i/c,d=gr({inputs:{x:s},backend:n,attrs:{shape:[l,c]}}),p=T8(d,!1,n),f=gr({inputs:{x:p},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const cpe={kernelName:Uw,backendName:"cpu",kernelFunc:ape};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qb(t){const{backend:e,attrs:n}=t,{shape:s,value:i,dtype:c}=n,l=c||Zm(i),d=Ps(l,Pe(s));return lpe(d,i,l),e.makeTensorInfo(s,l,d)}const upe={kernelName:Vw,backendName:"cpu",kernelFunc:Qb};function lpe(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dpe={kernelName:Bw,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,i=n,c=Ms(s.dtype,Pe(s.shape)),[l,d,p,f]=s.shape,m=i.data.get(s.dataId).values;for(let y=0;y<l;y++){const v=y*p*d*f;for(let I=0;I<d;I++){const b=I*(p*f);for(let A=0;A<p;A++){const R=A*f;for(let O=0;O<f;O++){const L=Math.round(p-A-1),$=v+b+R+O;let G=m[$];if(L>=0&&L<p){const H=L*f,Z=v+b+H+O;G=m[Z]}c[$]=G}}}}return{dataId:i.write(c,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hpe=hs((t,e)=>Math.floor(t/e)),ppe=Fs(u_,hpe,null,"int32"),fpe={kernelName:u_,backendName:"cpu",kernelFunc:ppe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:c,bias:l,preluActivationWeights:d}=e,{strides:p,pad:f,dataFormat:m,dilations:_,dimRoundingMode:y,activation:v,leakyreluAlpha:I}=s;let b=v8({inputs:{x:i,filter:c},backend:n,attrs:{strides:p,pad:f,dataFormat:m,dilations:_,dimRoundingMode:y}});if(l){const A=b;if(m==="NCHW"&&l.shape.length===1&&l.shape[0]!==1){const R=gr({inputs:{x:l},backend:n,attrs:{shape:[l.shape[0],1,1]}});b=Op({inputs:{a:b,b:R},backend:n}),n.disposeIntermediateTensorInfo(R)}else b=Op({inputs:{a:b,b:l},backend:n});n.disposeIntermediateTensorInfo(A)}if(v){const A=b;if(m==="NCHW"&&v==="prelu"&&d.shape.length===1&&d.shape[0]!==1){const R=gr({inputs:{x:d},backend:n,attrs:{shape:[d.shape[0],1,1]}});b=v1(n,b,v,R,I),n.disposeIntermediateTensorInfo(R)}else b=v1(n,b,v,d,I);n.disposeIntermediateTensorInfo(A)}return b}const gpe={kernelName:s1,backendName:"cpu",kernelFunc:mpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Epe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:c,bias:l,preluActivationWeights:d}=e,{strides:p,pad:f,dataFormat:m,dilations:_,dimRoundingMode:y,activation:v,leakyreluAlpha:I}=s;let b=S8({inputs:{x:i,filter:c},backend:n,attrs:{strides:p,pad:f,dataFormat:m,dilations:_,dimRoundingMode:y}});if(l){const A=b;b=Op({inputs:{a:b,b:l},backend:n}),n.disposeIntermediateTensorInfo(A)}if(v){const A=b;b=v1(n,b,v,d,I),n.disposeIntermediateTensorInfo(A)}return b}const _pe={kernelName:o1,backendName:"cpu",kernelFunc:Epe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ype(t){const{inputs:e,backend:n}=t,{params:s,indices:i}=e,c=Pe(s.shape),l=i.shape,d=l[l.length-1],[p,f,m,_]=ZR(s,i);if(f===0)return n.makeTensorInfo(p,s.dtype,[]);const y=n.data.get(i.dataId).values,v=n.bufferSync(s),I=PV(y,v,s.dtype,f,d,m,_,s.shape,c);return n.makeTensorInfo(p,s.dtype,I.values)}const vpe={kernelName:Gw,backendName:"cpu",kernelFunc:ype};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Spe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,indices:c}=e,{axis:l,batchDims:d}=s;Rt([i,c],"gatherV2");const p=$n(l,i.shape)[0],f=n.data.get(c.dataId).values,m=i.shape[p];for(let $=0;$<f.length;++$){const G=f[$];se(G<=m-1&&G>=0,()=>`GatherV2: the index value ${G} is not in [0, ${m-1}]`)}let _=d;d==null&&(_=0);const y=Pe(c.shape),v=jb(i,c,p,_),I=gr({inputs:{x:i},backend:n,attrs:{shape:[v.batchSize,v.outerSize,v.dimSize,v.sliceSize]}}),b=gr({inputs:{x:c},backend:n,attrs:{shape:[v.batchSize,y/v.batchSize]}}),A=[v.batchSize,v.outerSize,y/v.batchSize,v.sliceSize],R=n.bufferSync(b),O=n.bufferSync(I),L=LV(O,R,A);return n.disposeIntermediateTensorInfo(I),n.disposeIntermediateTensorInfo(b),n.makeTensorInfo(v.outputShape,L.dtype,L.values)}const Tpe={kernelName:Ww,backendName:"cpu",kernelFunc:Spe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ipe(t){const{inputs:e,backend:n}=t,{input:s}=e,i=Pe(s.shape),c=s.shape[s.shape.length-1],l=i/c,d=gr({inputs:{x:s},backend:n,attrs:{shape:[l,c]}}),p=T8(d,!0,n),f=gr({inputs:{x:p},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),f}const Cpe={kernelName:zw,backendName:"cpu",kernelFunc:Ipe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wpe=Yn(p_,t=>Number.isFinite(t)?1:0,"bool"),Rpe={kernelName:p_,backendName:"cpu",kernelFunc:wpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bpe=Yn(f_,t=>Math.abs(t)===1/0?1:0,"bool"),Npe={kernelName:f_,backendName:"cpu",kernelFunc:bpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ape=Yn(m_,t=>Number.isNaN(t)?1:0,"bool"),Ope={kernelName:m_,backendName:"cpu",kernelFunc:Ape};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xpe(t){const{backend:e,attrs:n}=t,{start:s,stop:i,num:c}=n,l=VV(s,i,c);return e.makeTensorInfo([l.length],"float32",l)}const kpe={kernelName:qw,backendName:"cpu",kernelFunc:xpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dpe=Yn(y_,t=>Math.log1p(t)),Ppe={kernelName:y_,backendName:"cpu",kernelFunc:Dpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lpe=hs((t,e)=>t&&e),Mpe=Fs(v_,Lpe,null,"bool"),$pe={kernelName:v_,backendName:"cpu",kernelFunc:Mpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fpe=Yn(S_,t=>t?0:1,"bool"),Upe={kernelName:S_,backendName:"cpu",kernelFunc:Fpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vpe=hs((t,e)=>t||e),Bpe=Fs(T_,Vpe,null,"bool"),jpe={kernelName:T_,backendName:"cpu",kernelFunc:Bpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{depthRadius:c,bias:l,alpha:d,beta:p}=s;Rt(i,"LRN");const f=i.shape[3],m=f-1,_=n.data.get(i.dataId).values,y=Pe(i.shape),v=new Float32Array(y);function I(b){const A=b%f;let R=b-A+Math.max(0,A-c);const O=b-A+Math.min(A+c,m);let L=0;for(;R<=O;R++){const $=_[R];L+=$*$}return L}for(let b=0;b<y;b++){const A=I(b),R=_[b]*Math.pow(l+d*A,-p);v[b]=R}return n.makeTensorInfo(i.shape,i.dtype,v)}const Gpe={kernelName:Xw,backendName:"cpu",kernelFunc:Wpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,y:c,dy:l}=e,{depthRadius:d,bias:p,alpha:f,beta:m}=s;Rt(l,"LRNGrad");const _=Pe(l.shape),y=l.shape[3],v=n.data.get(l.dataId).values,I=n.data.get(i.dataId).values,b=n.data.get(c.dataId).values,A=new Float32Array(_),R=_;for(let O=0;O<R;O++){const L=O%y,$=O-L+Math.max(0,L-d),G=O-L+Math.min(y,L+d+1);let H=0;for(let Z=$;Z<G;Z++)H+=Math.pow(I[Z],2);H=f*H+p;for(let Z=$;Z<G;Z++){let re=-2*f*m*I[Z]*b[O]/H;O===Z&&(re+=Math.pow(H,-m)),re*=v[O],A[Z]+=re}}return n.makeTensorInfo(l.shape,i.dtype,A)}const Hpe={kernelName:r6,backendName:"cpu",kernelFunc:zpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I8(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reductionIndices:c,keepDims:l}=s,d=n;let p=i.shape;const f=p.length,m=$n(c,p);let _=m;const y=ss(_,f);let v=d.data.get(i.dataId).values;if(y!=null){const $=new Array(f);for(let G=0;G<$.length;G++)$[G]=p[y[G]];v=Kb(v,p,i.dtype,y,$),_=os(_.length,f),p=$}Rt(i,"max"),Xs("max",_,f);const[I,b]=qs(p,_),A=Pe(b),R=jV(v,A,I,i.dtype),O=d.write(R,I,i.dtype);let L=I;return l&&(L=Cs(I,m)),{dataId:O,shape:L,dtype:i.dtype}}const Kpe={kernelName:Yw,backendName:"cpu",kernelFunc:I8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;Rt(i,"maxPool");const{filterSize:c,strides:l,pad:d,dimRoundingMode:p}=s,f=1;se(ho(l,f),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${f}'`);const m=Ta(i.shape,c,l,f,d,p);let _;if(m.filterWidth===1&&m.filterHeight===1&&Nr(m.inShape,m.outShape))_=Tc({inputs:{x:i},backend:n});else{const y=n.data.get(i.dataId).values,v=Pt(i.shape),I=Yb(y,i.shape,i.dtype,v,m,"max");_=n.makeTensorInfo(m.outShape,i.dtype,I.values)}return _}const Xpe={kernelName:Jw,backendName:"cpu",kernelFunc:qpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ype(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:c,strides:l,pad:d,dimRoundingMode:p,dataFormat:f}=s;Rt(i,"maxPool3d");const m=au(i.shape,c,l,1,d,p,f),_=n.data.get(i.dataId).values,y=y8(_,i.shape,i.dtype,Pt(i.shape),m,"max");return n.makeTensorInfo(y.shape,"float32",y.values)}const Jpe={kernelName:Qw,backendName:"cpu",kernelFunc:Ype};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qpe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:c}=e,{filterSize:l,strides:d,pad:p,dimRoundingMode:f}=s;Rt([i,c],"maxPool3DGrad");const m=au(c.shape,l,d,1,p,f),_=n.bufferSync(c),y=Ude(_,m),v=m.strideDepth,I=m.strideHeight,b=m.strideWidth,A=m.dilationDepth,R=m.dilationHeight,O=m.dilationWidth,L=m.effectiveFilterDepth,$=m.effectiveFilterHeight,G=m.effectiveFilterWidth,H=L-1-m.padInfo.front,Z=G-1-m.padInfo.left,re=$-1-m.padInfo.top,oe=cn(c.shape,"float32"),ae=n.bufferSync(i);for(let Ee=0;Ee<m.batchSize;++Ee)for(let Ce=0;Ce<m.inChannels;++Ce)for(let ye=0;ye<m.inDepth;++ye)for(let we=0;we<m.inHeight;++we)for(let Ae=0;Ae<m.inWidth;++Ae){const Oe=ye-H,Me=we-re,me=Ae-Z;let Te=0;for(let ke=0;ke<L;ke+=A){const Fe=(Oe+ke)/v;if(!(Fe<0||Fe>=m.outDepth||Math.floor(Fe)!==Fe))for(let Xe=0;Xe<$;Xe+=R){const Ye=(Me+Xe)/I;if(!(Ye<0||Ye>=m.outHeight||Math.floor(Ye)!==Ye))for(let tt=0;tt<G;tt+=O){const et=(me+tt)/b;if(et<0||et>=m.outWidth||Math.floor(et)!==et)continue;const nt=L*$*G-1-y.get(Ee,Fe,Ye,et,Ce),gt=ke*$*G+Xe*G+tt,Ct=nt===gt?1:0;if(Ct===0)continue;const Tt=ae.get(Ee,Fe,Ye,et,Ce);Te+=Tt*Ct}}}oe.set(Te,Ee,ye,we,Ae,Ce)}return n.makeTensorInfo(oe.shape,oe.dtype,oe.values)}const Zpe={kernelName:o6,backendName:"cpu",kernelFunc:Qpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function efe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:c,output:l}=e,d=c;Rt([c,l],"maxPoolGrad");const{filterSize:p,strides:f,pad:m,dimRoundingMode:_}=s,y=Ta(d.shape,p,f,1,m,_),v=n.data.get(d.dataId).values,I=cn(y.outShape,d.dtype,_8(v,d.shape,d.dtype,y).values),b=y.strideHeight,A=y.strideWidth,R=y.dilationHeight,O=y.dilationWidth,L=y.effectiveFilterHeight,$=y.effectiveFilterWidth,G=$-1-y.padInfo.left,H=L-1-y.padInfo.top,Z=cn(d.shape,"float32"),re=n.data.get(i.dataId).values,oe=cn(i.shape,"float32",re);for(let ae=0;ae<y.batchSize;++ae)for(let Ee=0;Ee<y.inChannels;++Ee)for(let Ce=0;Ce<y.inHeight;++Ce)for(let ye=0;ye<y.inWidth;++ye){const we=Ce-H,Ae=ye-G;let Oe=0;for(let Me=0;Me<L;Me+=R){const me=(we+Me)/b;if(!(me<0||me>=y.outHeight||Math.floor(me)!==me))for(let Te=0;Te<$;Te+=O){const ke=(Ae+Te)/A;if(ke<0||ke>=y.outWidth||Math.floor(ke)!==ke)continue;const Fe=L*$-1-I.get(ae,me,ke,Ee),Xe=Me*$+Te,Ye=Fe===Xe?1:0;if(Ye===0)continue;const tt=oe.get(ae,me,ke,Ee);Oe+=tt*Ye}}Z.set(Oe,ae,Ce,ye,Ee)}return n.makeTensorInfo(Z.shape,Z.dtype,Z.values)}const tfe={kernelName:s6,backendName:"cpu",kernelFunc:efe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nfe(t,e,n,s,i){const c=Pt(e),l=Yb(t,e,n,c,i,"max"),d=_8(t,e,n,i,!0,s);return[l.values,d.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rfe={kernelName:Zw,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:i,strides:c,pad:l,includeBatchInIndex:d}=e,p=n;Rt(s,"MaxPoolWithArgmax");const f=p.data.get(s.dataId).values,m=Ta(s.shape,i,c,[1,1],l),[_,y]=nfe(f,s.shape,s.dtype,d,m),v=p.write(_,m.outShape,s.dtype),I=p.write(y,m.outShape,s.dtype);return[{dataId:v,shape:m.outShape,dtype:s.dtype},{dataId:I,shape:m.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sfe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,keepDims:l}=s,d=$n(c,i.shape),f=qs(i.shape,d)[1],m=Pe(f),_=[],y=n.makeTensorInfo([],"float32",new Float32Array([m]));_.push(y);const v=gl({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});_.push(v);const I=Jb({inputs:{a:v,b:y},backend:n});_.push(I);const b=ug({inputs:{x:I},backend:n,attrs:{axis:c,keepDims:l}});return _.forEach(A=>n.disposeIntermediateTensorInfo(A)),b}const ofe={kernelName:eR,backendName:"cpu",kernelFunc:sfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ife(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,keepDims:l}=s;Rt(i,"min");const d=$n(c,i.shape);let p=d;const f=ss(p,i.shape.length);let m=i;f!=null&&(m=Ho({inputs:{x:i},backend:n,attrs:{perm:f}}),p=os(p.length,i.shape.length)),Xs("min",p,m.shape.length);const[_,y]=qs(m.shape,p),v=Pe(y),I=lo(Pe(_),m.dtype),b=n.data.get(m.dataId).values;for(let R=0;R<I.length;++R){const O=R*v;let L=b[O];for(let $=0;$<v;++$){const G=b[O+$];(Number.isNaN(G)||G<L)&&(L=G)}I[R]=L}f!=null&&n.disposeIntermediateTensorInfo(m);const A=n.makeTensorInfo(_,m.dtype,I);if(l){const R=Cs(_,d),O=gr({inputs:{x:A},backend:n,attrs:{shape:R}});return n.disposeIntermediateTensorInfo(A),O}return A}const afe={kernelName:tR,backendName:"cpu",kernelFunc:ife};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cfe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{paddings:c,mode:l}=s;Rt(i,"mirrorPad");const d=c.map((L,$)=>L[0]+i.shape[$]+L[1]),p=c.map(L=>L[0]),f=c.map((L,$)=>L[0]+i.shape[$]),m=l==="reflect"?0:1,_=n.data.get(i.dataId).values,y=i.shape.length,v=Pt(i.shape),I=Pe(d),b=d.length,A=Pt(d),R=Ms(i.dtype,I);for(let L=0;L<I;L++){let $=Vp(L,b,A);for(let H=0;H<b;H++)$[H]<p[H]?$[H]=p[H]*2-$[H]-m:$[H]>=f[H]&&($[H]=(f[H]-1)*2-$[H]+m);$=$.map((H,Z)=>H-p[Z]);const G=_c($,y,v);R[L]=_[G]}return{dataId:n.write(R,d,i.dtype),shape:d,dtype:i.dtype}}const ufe={kernelName:nR,backendName:"cpu",kernelFunc:cfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lfe=hs((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),dfe=Fs(w_,lfe),hfe={kernelName:w_,backendName:"cpu",kernelFunc:dfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C8(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{dim:c}=s,l=i.shape.length;let d=c;if(d===-1&&(d=l-1),d!==l-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${l} and dim was ${d}`);const p=$n([d],i.shape),f=I8({inputs:{x:i},backend:n,attrs:{reductionIndices:p,keepDims:!1}}),m=Cs(f.shape,p),_=gr({inputs:{x:f},backend:n,attrs:{shape:m}}),y=Xb({inputs:{a:i,b:_},backend:n}),v=xV({inputs:{x:y},backend:n}),I=ug({inputs:{x:v},backend:n,attrs:{axis:p,keepDims:!1}}),b=gr({inputs:{x:I},backend:n,attrs:{shape:m}}),A=Jb({inputs:{a:v,b},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(I),n.disposeIntermediateTensorInfo(b),A}const pfe={kernelName:AR,backendName:"cpu",kernelFunc:C8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ffe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{numSamples:c,seed:l,normalized:d}=s;Rt(i,"multinomial");const p=d?i:C8({inputs:{logits:i},backend:n,attrs:{dim:-1}}),f=p.shape[0],m=p.shape[1],_=n.data.get(p.dataId).values,y=[f,c],v=lo(Pe(y),"int32");for(let I=0;I<f;++I){const b=I*m,A=new Float32Array(m-1);A[0]=_[b];for(let L=1;L<A.length;++L)A[L]=A[L-1]+_[b+L];const R=ty.alea(l.toString()),O=I*c;for(let L=0;L<c;++L){const $=R();v[O+L]=A.length;for(let G=0;G<A.length;G++)if($<A[G]){v[O+L]=G;break}}}return d||n.disposeIntermediateTensorInfo(p),n.makeTensorInfo(y,"int32",v)}const mfe={kernelName:rR,backendName:"cpu",kernelFunc:ffe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gfe=_b;function Efe(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:c}=e,{maxOutputSize:l,iouThreshold:d,scoreThreshold:p}=s;Rt(i,"NonMaxSuppression");const f=n.data.get(i.dataId).values,m=n.data.get(c.dataId).values,{selectedIndices:_}=gfe(f,m,l,d,p);return n.makeTensorInfo([_.length],"int32",new Int32Array(_))}const _fe={kernelName:oR,backendName:"cpu",kernelFunc:Efe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yfe=yb;function vfe(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:c}=e,{maxOutputSize:l,iouThreshold:d,scoreThreshold:p,padToMaxOutputSize:f}=s;Rt(i,"NonMaxSuppressionPadded");const m=n.data.get(i.dataId).values,_=n.data.get(c.dataId).values,{selectedIndices:y,validOutputs:v}=yfe(m,_,l,d,p,f);return[n.makeTensorInfo([y.length],"int32",new Int32Array(y)),n.makeTensorInfo([],"int32",new Int32Array([v]))]}const Sfe={kernelName:iR,backendName:"cpu",kernelFunc:vfe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tfe=vb;function Ife(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:c}=e,{maxOutputSize:l,iouThreshold:d,scoreThreshold:p,softNmsSigma:f}=s;Rt(i,"NonMaxSuppressionWithScore");const m=n.data.get(i.dataId).values,_=n.data.get(c.dataId).values,y=l,v=d,I=p,b=f,{selectedIndices:A,selectedScores:R}=Tfe(m,_,y,v,I,b);return[n.makeTensorInfo([A.length],"int32",new Int32Array(A)),n.makeTensorInfo([R.length],"float32",new Float32Array(R))]}const Cfe={kernelName:aR,backendName:"cpu",kernelFunc:Ife};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wfe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:i}=e,{dtype:c,depth:l,onValue:d,offValue:p}=s;Rt(i,"oneHot");const f=Pe(i.shape),m=new Float32Array(f*l);m.fill(p);const _=n.data.get(i.dataId).values;for(let y=0;y<f;++y)_[y]>=0&&_[y]<l&&(m[y*l+_[y]]=d);return n.makeTensorInfo([...i.shape,l],c,m)}const Rfe={kernelName:uR,backendName:"cpu",kernelFunc:wfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T1(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const i=Ld({inputs:{input:s},backend:n}),c=T1({inputs:{x:i},backend:n}),l=xp({inputs:{input:s},backend:n}),d=T1({inputs:{x:l},backend:n}),p=ai({inputs:{real:c,imag:d},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),p}else return Qb({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const bfe={kernelName:GR,backendName:"cpu",kernelFunc:T1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w8(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const i=Ld({inputs:{input:s},backend:n}),c=w8({inputs:{x:i},backend:n}),l=xp({inputs:{input:s},backend:n}),d=T1({inputs:{x:l},backend:n}),p=ai({inputs:{real:c,imag:d},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),p}else return Qb({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const Nfe={kernelName:cR,backendName:"cpu",kernelFunc:w8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R8(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s;if(e.length===1)return S1({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const c=e[0].shape,l=e[0].dtype;e.forEach(m=>{gi(c,m.shape,"All tensors passed to stack must have matching shapes"),se(l===m.dtype,()=>"All tensors passed to stack must have matching dtypes")});const d=[],p=e.map(m=>{const _=S1({inputs:{input:m},backend:n,attrs:{dim:i}});return d.push(_),_}),f=kp({inputs:p,backend:n,attrs:{axis:i}});return d.forEach(m=>n.disposeIntermediateTensorInfo(m)),f}const Afe={kernelName:lR,backendName:"cpu",kernelFunc:R8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ofe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{paddings:c,constantValue:l}=s;Rt(i,"pad");const d=c.map((O,L)=>O[0]+i.shape[L]+O[1]),p=c.map(O=>O[0]),f=n.data.get(i.dataId).values,m=Pe(i.shape),_=i.shape.length,y=Pt(i.shape),v=Pe(d),I=d.length,b=Pt(d),A=Ms(i.dtype,v);l!==0&&A.fill(l);for(let O=0;O<m;O++){const $=Vp(O,_,y).map((H,Z)=>H+p[Z]),G=_c($,I,b);A[G]=f[O]}return{dataId:n.write(A,d,i.dtype),shape:d,dtype:i.dtype}}const b8={kernelName:dR,backendName:"cpu",kernelFunc:Ofe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xfe=hs((t,e)=>Math.pow(t,e)),kfe=Fs(N_,xfe),Dfe={kernelName:N_,backendName:"cpu",kernelFunc:kfe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pfe(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:i,paramsDenseValues:c,indices:l}=e,d=i.map(A=>n.data.get(A.dataId).values),p=i.map(A=>A.shape),f=n.data.get(c.dataId).values,m=n.data.get(l.dataId).values,[_,y,v]=qV(d,p,f,c.shape,c.dtype,m,l.shape),I=_.map(A=>n.makeTensorInfo([A.length],"int32",A)),b=n.makeTensorInfo(v,c.dtype,y);return I.concat([b])}const Lfe={kernelName:fR,backendName:"cpu",kernelFunc:Pfe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mfe(t){const{inputs:e,backend:n,attrs:s}=t,{shape:i,values:c,defaultValue:l,rowPartitionTensors:d}=e,{rowPartitionTypes:p}=s,f=n.data.get(i.dataId).values,m=n.data.get(c.dataId).values,_=n.data.get(l.dataId).values,y=d.map(A=>n.data.get(A.dataId).values),v=d.map(A=>A.shape),[I,b]=XV(f,i.shape,m,c.shape,c.dtype,_,l.shape,y,v,p);return n.makeTensorInfo(I,c.dtype,b)}const $fe={kernelName:mR,backendName:"cpu",kernelFunc:Mfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ffe(t){const{backend:e,attrs:n}=t,{start:s,stop:i,dtype:c,step:l}=n,d=YV(s,i,l,c);return e.makeTensorInfo([d.length],c,d)}const Ufe={kernelName:gR,backendName:"cpu",kernelFunc:Ffe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vfe=Yn(A_,t=>1/t),Bfe={kernelName:A_,backendName:"cpu",kernelFunc:Vfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jfe(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:c,halfPixelCenters:l,size:d}=s;Rt(i,"resizeBilinear");const p=Pt(i.shape),[f,m]=d,[_,y,v,I]=i.shape,b=n.data.get(i.dataId).values,A=new Float32Array(Pe([_,f,m,I])),R=[c&&f>1?y-1:y,c&&m>1?v-1:v],O=[c&&f>1?f-1:f,c&&m>1?m-1:m];let L=0;const $=R[0]/O[0],G=R[1]/O[1];for(let H=0;H<_;H++)for(let Z=0;Z<f;Z++){let re;l?re=$*(Z+.5)-.5:re=$*Z;const oe=Math.max(0,Math.floor(re)),ae=re-oe,Ee=Math.min(y-1,Math.ceil(re)),Ce=H*p[0]+oe*p[1],ye=H*p[0]+Ee*p[1];for(let we=0;we<m;we++){let Ae;l?Ae=G*(we+.5)-.5:Ae=G*we;const Oe=Math.max(0,Math.floor(Ae)),Me=Ae-Oe,me=Math.min(v-1,Math.ceil(Ae)),Te=Ce+Oe*p[2],ke=ye+Oe*p[2],Fe=Ce+me*p[2],Xe=ye+me*p[2];for(let Ye=0;Ye<I;Ye++){const tt=b[Te+Ye],et=b[ke+Ye],nt=b[Fe+Ye],gt=b[Xe+Ye],Ct=tt+(nt-tt)*Me,Tt=et+(gt-et)*Me,Lt=Ct+(Tt-Ct)*ae;A[L++]=Lt}}}return n.makeTensorInfo([_,f,m,I],"float32",A)}const Wfe={kernelName:vR,backendName:"cpu",kernelFunc:jfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gfe(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:c}=e,{alignCorners:l}=s;Rt([c,i],"resizeBilinearGrad");const d=Pt(i.shape),[p,f,m,_]=i.shape,[,y,v]=c.shape,I=new Float32Array(p*f*m*_),b=[l&&y>1?f-1:f,l&&v>1?m-1:m],A=[l&&y>1?y-1:y,l&&v>1?v-1:v],R=b[0]/A[0],O=b[1]/A[1],L=n.data.get(c.dataId).values;let $=0;for(let G=0;G<p;G++){const H=G*d[0];for(let Z=0;Z<y;Z++){const re=Z*R,oe=Math.floor(re),ae=Math.min(Math.ceil(re),f-1),Ee=H+oe*d[1],Ce=H+ae*d[1],ye=re-oe,we=1-ye;for(let Ae=0;Ae<v;Ae++){const Oe=Ae*O,Me=Math.floor(Oe),me=Math.min(Math.ceil(Oe),m-1),Te=Oe-Me,ke=1-Te,Fe=Ee+Me*d[2],Xe=Ee+me*d[2],Ye=Ce+Me*d[2],tt=Ce+me*d[2],et=we*ke,nt=we*Te,gt=ye*ke,Ct=ye*Te;for(let Tt=0;Tt<_;Tt++){const Lt=L[$++];I[Fe+Tt]+=Lt*et,I[Xe+Tt]+=Lt*nt,I[Ye+Tt]+=Lt*gt,I[tt+Tt]+=Lt*Ct}}}}return n.makeTensorInfo([p,m,f,_],"float32",I)}const zfe={kernelName:a6,backendName:"cpu",kernelFunc:Gfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hfe(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:c,halfPixelCenters:l,size:d}=s;Rt(i,"resizeNearestNeighbor");const p=Pt(i.shape),[f,m]=d,[_,y,v,I]=i.shape,b=n.data.get(i.dataId).values,A=new Float32Array(_*f*m*I),R=[c&&f>1?y-1:y,c&&m>1?v-1:v],O=[c&&f>1?f-1:f,c&&m>1?m-1:m],L=R[0]/O[0],$=R[1]/O[1];let G=0;for(let H=0;H<_;H++){const Z=H*p[0];for(let re=0;re<f;re++){const oe=l?L*(re+.5):L*re;let ae=Math.min(y-1,c?Math.round(oe):Math.floor(oe));l&&(ae=Math.max(0,ae));const Ee=Z+ae*p[1];for(let Ce=0;Ce<m;Ce++){const ye=l?$*(Ce+.5):$*Ce;let we=Math.min(v-1,c?Math.round(ye):Math.floor(ye));l&&(we=Math.max(0,we));const Ae=Ee+we*p[2];for(let Oe=0;Oe<I;Oe++){const Me=b[Ae+Oe];A[G++]=Me}}}}return n.makeTensorInfo([_,f,m,I],i.dtype,A)}const Kfe={kernelName:yR,backendName:"cpu",kernelFunc:Hfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qfe(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:c}=e,{alignCorners:l}=s;Rt([c,i],"resizeNearestNeighborGrad");const d=Pt(i.shape),p=Pt(c.shape),[f,m,_,y]=i.shape,[,v,I]=c.shape,b=new Float32Array(f*m*_*y),A=n.data.get(c.dataId).values,R=[l&&v>1?m-1:m,l&&I>1?_-1:_],O=[l&&v>1?v-1:v,l&&I>1?I-1:I],L=R[0]/O[0],$=R[1]/O[1],G=1/L,H=1/$,Z=Math.ceil(G)*2+2,re=Math.ceil(H)*2+2;for(let oe=0;oe<f;oe++){const ae=oe*d[0];for(let Ee=0;Ee<m;Ee++){const Ce=ae+Ee*d[1],ye=Math.floor(Ee*G),we=Math.floor(ye-Z/2);for(let Ae=0;Ae<_;Ae++){const Oe=Ce+Ae*d[2],Me=Math.floor(Ae*H),me=Math.floor(Me-re/2);for(let Te=0;Te<y;Te++){let ke=0;for(let Fe=0;Fe<Z;Fe++){const Xe=Fe+we;if(Xe<0||Xe>=v)continue;const Ye=ae+Xe*p[1],tt=Xe*L,et=Math.min(m-1,l?Math.round(tt):Math.floor(tt));if(Ee===et)for(let nt=0;nt<re;nt++){const gt=nt+me;if(gt<0||gt>=I)continue;const Ct=Ye+gt*p[2],Tt=gt*$,Lt=Math.min(_-1,l?Math.round(Tt):Math.floor(Tt));Ae===Lt&&(ke+=A[Ct+Te])}}b[Oe+Te]=ke}}}}return n.makeTensorInfo(i.shape,i.dtype,b)}const Xfe={kernelName:i6,backendName:"cpu",kernelFunc:qfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yfe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dims:c}=s;Rt(i,"reverse");const l=i.shape.length,d=$n(c,i.shape);if(l===0)return Tc({inputs:{x:i},backend:n});const p=new Ls(i.shape,i.dtype),f=n.bufferSync(i);for(let m=0;m<p.size;m++){const _=p.indexToLoc(m),y=_.slice();d.forEach(v=>y[v]=i.shape[v]-1-y[v]),p.set(f.get(...y),..._)}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const Jfe={kernelName:SR,backendName:"cpu",kernelFunc:Yfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qfe={kernelName:zR,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:i,fillValue:c,center:l}=e,d=n,p=Ms(s.dtype,Pe(s.shape)),[f,m,_,y]=s.shape,[v,I]=Cb(l,m,_),b=255,A=Math.sin(i),R=Math.cos(i),O=d.data.get(s.dataId).values;for(let $=0;$<f;$++){const G=$*_*m*y;for(let H=0;H<m;H++){const Z=H*(_*y);for(let re=0;re<_;re++){const oe=re*y;for(let ae=0;ae<y;ae++){const Ee=[f,H,re,ae],Ce=Ee[2],ye=Ee[1];let we=(Ce-v)*R-(ye-I)*A,Ae=(Ce-v)*A+(ye-I)*R;we=Math.round(we+v),Ae=Math.round(Ae+I);let Oe=c;if(typeof c!="number"&&(ae===3?Oe=b:Oe=c[ae]),we>=0&&we<_&&Ae>=0&&Ae<m){const me=Ae*(_*y),Te=we*y,ke=G+me+Te+ae;Oe=O[ke]}const Me=G+Z+oe+ae;p[Me]=Oe}}}}return{dataId:d.write(p,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zfe=Yn(k_,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),eme={kernelName:k_,backendName:"cpu",kernelFunc:Zfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tme(t){const{inputs:e,backend:n,attrs:s}=t,{indices:i,updates:c}=e,{shape:l}=s,{sliceRank:d,numUpdates:p,sliceSize:f,strides:m,outputSize:_}=ng(c,i,l),y=!0,v=n.bufferSync(i),I=n.bufferSync(c),b=op(v,I,l,_,f,p,d,m,0,y);return n.makeTensorInfo(l,b.dtype,b.values)}const nme={kernelName:TR,backendName:"cpu",kernelFunc:tme};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rme(t,e){let n=0,s=t.length,i=0;for(;n<s;)i=Math.floor((n+s)/2),t[i]<e?n=i+1:s=i;return s}function sme(t,e){let n=0,s=t.length,i=0;for(;n<s;)i=Math.floor((n+s)/2),t[i]<=e?n=i+1:s=i;return s}function ome(t,e,n,s,i,c){const l=Ps("int32",n*i);for(let d=0;d<n;++d){const p=t.slice(d*s,(d+1)*s),f=d*i;for(let m=0;m<i;++m)l[f+m]=c==="left"?rme(p,e[m+f]):sme(p,e[m+f])}return l}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ime(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:i,values:c}=e,{side:l}=s,d=n.data.get(i.dataId).values,p=n.data.get(c.dataId).values,f=ome(d,p,i.shape[0],i.shape[1],c.shape[1],l);return n.makeTensorInfo(c.shape,"int32",f)}const ame={kernelName:IR,backendName:"cpu",kernelFunc:ime};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cme(t){const{inputs:e,backend:n}=t,{condition:s,t:i,e:c}=e;Rt([s,i,c],"select");const l=s.shape.length,d=n.data.get(s.dataId).values,p=n.data.get(i.dataId).values,f=n.data.get(c.dataId).values,m=pi(i.dtype,c.dtype),_=lo(Pe(i.shape),m);let y=0;const v=l===0||l>1||i.shape.length===1?1:Pe(i.shape.slice(1));for(let I=0;I<d.length;I++)for(let b=0;b<v;b++)d[I]===1?_[y++]=p[I]:_[y++]=f[I];return n.makeTensorInfo(i.shape,m,_)}const ume={kernelName:CR,backendName:"cpu",kernelFunc:cme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lme=bb,dme=Nb,hme=Yn(P_,t=>t>=0?dme*t:lme*(Math.exp(t)-1)),pme={kernelName:P_,backendName:"cpu",kernelFunc:hme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fme=Yn($_,t=>t<0?-1:t>0?1:0),mme={kernelName:$_,backendName:"cpu",kernelFunc:fme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gme=Yn(L_,t=>Math.sin(t)),Eme={kernelName:L_,backendName:"cpu",kernelFunc:gme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _me=Yn(M_,t=>Math.sinh(t)),yme={kernelName:M_,backendName:"cpu",kernelFunc:_me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vme=11920928955078125e-23,o$=Math.log(vme)+2,Sme=Yn(U_,t=>{const e=t>-o$,n=t<o$,s=Math.exp(t);let i;return n?i=s:e?i=t:i=Math.log(1+s),i}),Tme={kernelName:U_,backendName:"cpu",kernelFunc:Sme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ime(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:c,paddings:l}=s;Rt([i],"spaceToBatchND");const d=Pe(c),p=[[0,0]];p.push(...l);for(let H=1+c.length;H<i.shape.length;++H)p.push([0,0]);const f=b8.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:p,constantValue:0}}),m=ig(f.shape,c,d,!1),_=ag(m.length,c.length,!1),y=cg(f.shape,c,d,!1),b=gr({inputs:{x:f},backend:n,attrs:{shape:m}}),O=Ho({inputs:{x:b},backend:n,attrs:{perm:_}}),G=gr({inputs:{x:O},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(O),G}const Cme={kernelName:bR,backendName:"cpu",kernelFunc:Ime};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wme(t){const{inputs:e,backend:n}=t,{indices:s,values:i,denseShape:c,defaultValue:l}=e;if(c.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${c.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${i.shape}`);if(l.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${l.shape}`);const d=n.data.get(s.dataId).values,p=n.data.get(i.dataId).values,f=n.data.get(c.dataId).values,m=n.data.get(l.dataId).values[0],[_,y,v,I,b]=e8(d,s.shape,s.dtype,p,i.dtype,f,m);return[n.makeTensorInfo(y,s.dtype,_),n.makeTensorInfo([y[0]],i.dtype,v),n.makeTensorInfo([I.length],"bool",new Uint8Array(I.map(A=>Number(A)))),n.makeTensorInfo([b.length],s.dtype,new Int32Array(b))]}const Rme={kernelName:OR,backendName:"cpu",kernelFunc:wme};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bme(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:i,newShape:c}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${i.shape}`);if(c.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${c.shape}`);const l=Array.from(n.data.get(i.dataId).values),d=n.data.get(s.dataId).values,p=Array.from(n.data.get(c.dataId).values),[f,m,_]=t8(d,s.shape,s.dtype,l,p);return[n.makeTensorInfo(m,s.dtype,f),n.makeTensorInfo([_.length],c.dtype,new Int32Array(_))]}const Nme={kernelName:xR,backendName:"cpu",kernelFunc:bme};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ame(t){const{inputs:e,backend:n}=t,{data:s,indices:i,segmentIds:c}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${i.shape}`);if(c.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${c.shape}`);if(i.shape[0]!==c.shape[0])throw new Error("segmentIds and indices should have same size.");const l=n.data.get(s.dataId).values,d=n.data.get(i.dataId).values,p=n.data.get(c.dataId).values,[f,m]=qb(l,s.shape,s.dtype,d,p,!0);return n.makeTensorInfo(m,s.dtype,f)}const Ome={kernelName:kR,backendName:"cpu",kernelFunc:Ame};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xme(t){const{inputs:e,backend:n}=t,{data:s,indices:i,segmentIds:c}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${i.shape}`);if(c.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${c.shape}`);if(i.shape[0]!==c.shape[0])throw new Error("segmentIds and indices should have same size.");const l=n.data.get(s.dataId).values,d=n.data.get(i.dataId).values,p=n.data.get(c.dataId).values,[f,m]=qb(l,s.shape,s.dtype,d,p);return n.makeTensorInfo(m,s.dtype,f)}const kme={kernelName:DR,backendName:"cpu",kernelFunc:xme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dme(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:i,sparseValues:c,defaultValue:l}=e,{outputShape:d}=s,{sliceRank:p,numUpdates:f,sliceSize:m,strides:_,outputSize:y}=ng(c,i,d),v=!1,I=n.bufferSync(i);let b;switch(c.dtype){case"bool":{const A=n.bufferSync(c),R=!!n.data.get(l.dataId).values[0];b=op(I,A,d,y,m,f,p,_,R,v);break}case"float32":{const A=n.bufferSync(c),R=n.data.get(l.dataId).values[0];b=op(I,A,d,y,m,f,p,_,R,v);break}case"int32":{const A=n.bufferSync(c),R=n.data.get(l.dataId).values[0];b=op(I,A,d,y,m,f,p,_,R,v);break}case"string":{const A=n.bufferSync(c),R=pl(n.data.get(l.dataId).values[0]);b=op(I,A,d,y,m,f,p,_,R,v);break}default:throw new Error(`Unsupported type ${c.dtype}`)}return n.makeTensorInfo(d,b.dtype,b.values)}const Pme={kernelName:PR,backendName:"cpu",kernelFunc:Dme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{numOrSizeSplits:c,axis:l}=s,d=$n(l,i.shape)[0],p=Bb(i,c,d),f=new Array(i.shape.length).fill(0),m=i.shape.slice();return p.map(_=>{const y=[...m];y[d]=_;const v=Md({inputs:{x:i},backend:n,attrs:{begin:f,size:y}});return f[d]+=_,v})}const Mme={kernelName:NR,backendName:"cpu",kernelFunc:Lme};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $me={kernelName:c6,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;Rt(n,"square");const i=s.data.get(n.dataId).values,c=new Float32Array(i.length);for(let d=0;d<i.length;++d){const p=i[d];c[d]=p*p}return{dataId:s.write(c,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fme=Yn(H_,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),Ume={kernelName:H_,backendName:"cpu",kernelFunc:Fme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:c,end:l,strides:d,beginMask:p,endMask:f,ellipsisMask:m,newAxisMask:_,shrinkAxisMask:y}=s;Rt(i,"stridedSlice");const{finalShapeSparse:v,finalShape:I,isIdentity:b,sliceDim0:A,isSimpleSlice:R,begin:O,end:L,strides:$}=ob(i.shape,c,l,d,p,f,m,_,y);let G;if(b)G=gr({inputs:{x:i},backend:n,attrs:{shape:I}});else if(A||R){se(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const H=tb(O,L,$),Z=Md({inputs:{x:i},backend:n,attrs:{begin:O,size:H}});G=gr({inputs:{x:Z},backend:n,attrs:{shape:I}}),n.disposeIntermediateTensorInfo(Z)}else{const H=n.bufferSync(i),Z=r8(v,H,$,O);G=n.makeTensorInfo(I,Z.dtype,Z.values)}return G}const Bme={kernelName:LR,backendName:"cpu",kernelFunc:Vme};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jme(t){const{inputs:e,backend:n,attrs:s}=t,{separator:i,nGramWidths:c,leftPad:l,rightPad:d,padWidth:p,preserveShortSequences:f}=s,{data:m,dataSplits:_}=e,y=n.data.get(m.dataId).values,v=n.data.get(_.dataId).values,[I,b]=s8(y,v,i,c,l,d,p,f);return[n.makeTensorInfo([I.length],"string",I),n.makeTensorInfo(_.shape,"int32",b)]}const Wme={kernelName:MR,backendName:"cpu",kernelFunc:jme};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gme(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:i}=s,{input:c,delimiter:l}=e;if(c.dtype!=="string")throw new Error("Input must be of datatype string");if(c.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${c.shape}`);if(l.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${l.shape}`);const d=n.data.get(c.dataId).values,p=n.data.get(l.dataId).values[0],[f,m,_]=o8(d,p,i),y=m.length;return[n.makeTensorInfo([y,2],"int32",f),n.makeTensorInfo([y],"string",m),n.makeTensorInfo([2],"int32",new Int32Array(_))]}const zme={kernelName:$R,backendName:"cpu",kernelFunc:Gme};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hme(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:i}=s,{input:c}=e;if(c.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const l=n.data.get(c.dataId).values,d=i8(l,i);return n.makeTensorInfo(c.shape,"int32",d)}const Kme={kernelName:FR,backendName:"cpu",kernelFunc:Hme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qme=Yn(W_,t=>Math.tan(t)),Xme={kernelName:W_,backendName:"cpu",kernelFunc:qme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yme=Yn(G_,t=>Math.tanh(t)),Jme={kernelName:G_,backendName:"cpu",kernelFunc:Yme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qme(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reps:c}=s;Rt(i,"tile");const l=c8(n.bufferSync(i),c);return n.makeTensorInfo(l.shape,l.dtype,l.values)}const Zme={kernelName:z_,backendName:"cpu",kernelFunc:Qme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ege(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{k:c,sorted:l}=s;Rt(i,"topk");const d=n.data.get(i.dataId).values,[p,f]=l8(d,i.shape,i.dtype,c,l);return[n.makeTensorInfo(p.shape,p.dtype,p.values),n.makeTensorInfo(f.shape,f.dtype,f.values)]}const tge={kernelName:UR,backendName:"cpu",kernelFunc:ege};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nge(t){const{inputs:e,attrs:n,backend:s}=t,{image:i,transforms:c}=e,{interpolation:l,fillMode:d,fillValue:p,outputShape:f}=n,[m,_,y,v]=i.shape,[I,b]=f??[_,y],A=[m,I,b,v],R=Pt(i.shape),O=R[0],L=R[1],$=R[2],G=Pt(A),H=G[0],Z=G[1],re=G[2],oe=Ms(i.dtype,Pe(A));oe.fill(p);const ae=s.data.get(i.dataId).values,Ee=s.data.get(c.dataId).values;for(let ye=0;ye<m;++ye){const we=c.shape[0]===1?Ee:Ee.subarray(ye*8,ye*8+8);for(let Ae=0;Ae<I;++Ae)for(let Oe=0;Oe<b;++Oe)for(let Me=0;Me<v;++Me){let me;const Te=we[6]*Oe+we[7]*Ae+1;if(Te===0)continue;const ke=(we[0]*Oe+we[1]*Ae+we[2])/Te,Fe=(we[3]*Oe+we[4]*Ae+we[5])/Te,Xe=i$(ke,y,d),Ye=i$(Fe,_,d);switch(l){case"nearest":me=cge(ae,_,y,O,L,$,ye,Ye,Xe,Me,p);break;case"bilinear":me=uge(ae,_,y,O,L,$,ye,Ye,Xe,Me,p);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${l}`)}const tt=ye*H+Ae*Z+Oe*re+Me;oe[tt]=me}return s.makeTensorInfo(A,i.dtype,oe)}return{dataId:s.write(oe,A,i.dtype),shape:i.shape,dtype:i.dtype}}const rge={kernelName:VR,backendName:"cpu",kernelFunc:nge};function i$(t,e,n){switch(n){case"reflect":return sge(t,e);case"wrap":return oge(t,e);case"nearest":return age(t,e);case"constant":default:return ige(t)}}function sge(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return bd(0,n,e-1)}function oge(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return bd(0,n,e-1)}function ige(t,e){return t}function age(t,e){return bd(0,t,e-1)}function im(t,e,n,s,i,c,l,d,p,f,m){const _=l*s+d*i+p*c+f;return 0<=d&&d<e&&0<=p&&p<n?t[_]:m}function cge(t,e,n,s,i,c,l,d,p,f,m){const _=Math.round(d),y=Math.round(p);return im(t,e,n,s,i,c,l,_,y,f,m)}function uge(t,e,n,s,i,c,l,d,p,f,m){const _=Math.floor(d),y=Math.floor(p),v=_+1,I=y+1,b=(I-p)*im(t,e,n,s,i,c,l,_,y,f,m)+(p-y)*im(t,e,n,s,i,c,l,_,I,f,m),A=(I-p)*im(t,e,n,s,i,c,l,v,y,f,m)+(p-y)*im(t,e,n,s,i,c,l,v,I,f,m);return(v-d)*b+(d-_)*A}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lge(t){const{inputs:e,attrs:n,backend:s}=t,{axis:i}=n,{x:c}=e;Rt(c,"unique");const l=s.data.get(c.dataId).values,{outputValues:d,outputShape:p,indices:f}=d8(l,i,c.shape,c.dtype);return[s.makeTensorInfo(p,c.dtype,d),s.makeTensorInfo([f.length],"int32",f)]}const dge={kernelName:BR,backendName:"cpu",kernelFunc:lge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hge(t){const{inputs:e,backend:n,attrs:s}=t,{value:i}=e;let{axis:c}=s;c<0&&(c+=i.shape.length);const l=i.shape.length,d=i.shape[c],p=new Array(l-1);let f=0;for(let v=0;v<l;v++)v!==c&&(p[f++]=i.shape[v]);const m=new Array(l).fill(0),_=i.shape.slice();_[c]=1;const y=new Array(d);for(let v=0;v<y.length;v++){m[c]=v;const I=Md({inputs:{x:i},backend:n,attrs:{begin:m,size:_}});y[v]=gr({inputs:{x:I},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(I)}return y}const pge={kernelName:jR,backendName:"cpu",kernelFunc:hge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fge(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,segmentIds:c}=e,{numSegments:l}=s;Rt(i,"unsortedSegmentSum");const d=i.shape.length,p=c.shape.length,f=[],m=[],_=d-p;let y=c;for(let I=0;I<_;++I){const b=S1({inputs:{input:y},backend:n,attrs:{dim:I+1}});y=b,m.push(b)}for(let I=0;I<l;++I){const b=Sl(I,"int32"),A=n.makeTensorInfo([],"int32",b),R=AV({inputs:{a:A,b:y},backend:n}),O=gl({inputs:{x:R},backend:n,attrs:{dtype:"float32"}}),L=uy({inputs:{a:O,b:i},backend:n}),$=ug({inputs:{x:L},backend:n,attrs:{axis:0,keepDims:!1}});f.push($),m.push(A),m.push(R),m.push(O),m.push(L),m.push($)}const v=R8({inputs:f,backend:n,attrs:{axis:0}});return m.forEach(I=>n.disposeIntermediateTensorInfo(I)),v}const mge={kernelName:WR,backendName:"cpu",kernelFunc:fge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gge=[pde,Zue,mde,Ede,ole,yde,Sde,Ide,wde,bde,Ade,xde,Dde,Mde,Fde,Bde,Wde,zde,Kde,dde,Xde,Jde,Zde,the,rle,ale,rhe,ele,ohe,ahe,che,lhe,hhe,fhe,ghe,_he,vhe,The,Che,Rhe,Nhe,Ohe,khe,Dhe,Lhe,$he,Uhe,Vhe,Bhe,jhe,zhe,sde,Khe,cle,tpe,ule,npe,dle,cpe,upe,dpe,ple,fpe,gpe,_pe,vpe,Tpe,mle,Ele,tle,Cpe,ihe,Rpe,Npe,Ope,ode,yle,Sle,kpe,Ile,Ppe,$pe,Upe,jpe,Gpe,Hpe,Kpe,wle,Xpe,Jpe,Zpe,tfe,rfe,ofe,afe,ble,ufe,hfe,mfe,Ale,xle,_fe,Sfe,Cfe,Dle,Rfe,Nfe,Afe,b8,Dfe,ade,Mle,Lfe,$fe,Ufe,nle,rC,Bfe,cde,ude,lde,Wfe,zfe,Kfe,Xfe,Jfe,Qfe,eme,Gle,nme,ame,ume,pme,Hle,mme,Eme,yme,Kle,pfe,Tme,Cme,Rme,Nme,Ome,kme,Pme,Mme,Yle,$me,Qle,Ume,Bme,Wme,zme,Kme,nde,Whe,Xme,Jme,Zme,tge,rge,Ple,dge,pge,mge,bfe];for(const t of gge)u6(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ud={},c0={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Ege(t,e){ud[t]=e}function Ka(t,e){if(!(t in ud)||e!=null){const s=yge(t,e);if(s!==null)ud[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=ud[t];return n==null||n.isContextLost()?(delete ud[t],Ka(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),ud[t])}function _ge(t){if(typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function yge(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??_ge(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete ud[t]},!1),De().getBool("SOFTWARE_WEBGL_ENABLED")&&(c0.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",c0)||n.getContext("experimental-webgl",c0):n.getContext("webgl2",c0)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Wm;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(Wm||(Wm={}));var Vi;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(Vi||(Vi={}));var Gs;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Gs||(Gs={}));function lg(t,e){return[e,t]}function vge(t,e){return t*e}function u0(t){const e=Pe(t),n=Math.ceil(e/4);return p2(n)}function Gp(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Sge(t,e){const[n,s]=Gp(t,e);return n*s*4}function Zb(t,e){const n=t;let s,i,c,l,d,p,f,m,_,y;return De().getNumber("WEBGL_VERSION")===2?(s=n.R32F,i=n.R16F,c=n.RGBA16F,l=n.RGBA32F,d=n.RED,f=4,m=1,_=n.HALF_FLOAT,y=n.FLOAT,p=n.RGBA8):(s=t.RGBA,i=t.RGBA,c=t.RGBA,l=n.RGBA,d=t.RGBA,f=4,m=4,_=e!=null?e.HALF_FLOAT_OES:null,y=t.FLOAT,p=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:c,internalFormatPackedFloat:l,textureFormatFloat:d,downloadTextureFormat:p,downloadUnpackNumChannels:f,defaultNumChannels:m,textureTypeHalfFloat:_,textureTypeFloat:y}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bt(t,e){const n=e();return De().getBool("DEBUG")&&Tge(t),n}function Tge(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Rge(t,e))}const Ige=596e-10,Cge=65504;function wge(t){return!!(De().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||Ige<Math.abs(t)&&Math.abs(t)<Cge)}function Rge(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function l0(t,e){return lu(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function bge(t,e){const n=lu(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(bt(t,()=>t.shaderSource(n,e)),bt(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function Nge(t,e){const n=lu(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(bt(t,()=>t.shaderSource(n,e)),bt(t,()=>t.compileShader(n)),De().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw N8(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const Age=/ERROR: [0-9]+:([0-9]+):/g;function N8(t,e){const n=Age.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],i=t.split(`
`),c=i.length.toString().length+2,l=i.map((_,y)=>hp((y+1).toString(),c)+_);let d=0;for(let _=0;_<l.length;_++)d=Math.max(l[_].length,d);const p=l.slice(0,s-1),f=l.slice(s-1,s),m=l.slice(s);console.log(p.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${hp(f[0],d)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(m.join(`
`))}function Oge(t){return lu(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function xge(t,e){if(bt(t,()=>t.linkProgram(e)),!De().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function lI(t,e){if(bt(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function kge(t,e){const n=lu(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return bt(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),bt(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function Dge(t,e){const n=lu(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return bt(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),bt(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function Pge(t){return lu(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function Lge(t,e){const n=De().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,i=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+i+".")}}function Mge(t){return lu(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function a$(t,e,n,s,i,c,l){const d=t.getAttribLocation(e,n);return d===-1?!1:(bt(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),bt(t,()=>t.vertexAttribPointer(d,i,t.FLOAT,!1,c,l)),bt(t,()=>t.enableVertexAttribArray(d)),!0)}function $ge(t,e,n){jge(t,n),bt(t,()=>t.activeTexture(t.TEXTURE0+n)),bt(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function Fge(t,e,n){return lu(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function Uge(t,e,n){return t.getUniformLocation(e,n)}function Vge(t,e,n,s){bt(t,()=>$ge(t,e,s)),bt(t,()=>t.uniform1i(n,s))}function dI(t,e,n){bt(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),bt(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function c$(t,e){bt(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),bt(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function d0(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Bge(t,e))}function Bge(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function lu(t,e,n){const s=bt(t,()=>e());if(s==null)throw new Error(n);return s}function jge(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const i=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${i}.`)}}function Dp(t,e=2){return Pe(t.slice(0,t.length-e))}function Pp(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function hI(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Dp(t),...Pp(t)]),e}function Wge(t,e=!1){let n=De().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=De().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&De().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((d,p)=>p>=t.length-2?sw(t[p]):t[p]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=vl(t).newShape);let i=Pe(t),c=null;t.length<=1&&i<=n?c=[1,i]:t.length===2&&t[0]<=n&&t[1]<=n?c=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?c=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?c=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?c=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(c=[t[0],t[1]*t[2]*t[3]]);const l=c!=null&&Math.max(...c)>s&&Math.min(...c)<=(e?2:1)&&Math.min(...c)>0;if(c==null||l)if(e){const d=Dp(t);let p=2,f=2;t.length&&([p,f]=Pp(t)),i=d*(p/2)*(f/2),c=p2(i).map(m=>m*2)}else c=p2(i);return c}function h0(t){return t%2===0}function I1(t,e){if(t=t.slice(-2),e=e.slice(-2),Nr(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t.slice(-1)[0],s=e.slice(-1)[0];if(n===s||h0(n)&&h0(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&h0(t[0])&&h0(e[0])}let pI,fI;function Gge(t){if(pI==null){const e=Ka(t);pI=e.getParameter(e.MAX_TEXTURE_SIZE)}return pI}function zge(t){if(fI==null){const e=Ka(t);fI=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,fI)}function Hge(t){if(t===0)return 0;let e;const n=Ka(t);return Ea(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:Ea(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function Ea(t,e){return t.getExtension(e)!=null}function u$(t){try{if(Ka(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function Kge(t){if(t===0)return!1;const e=Ka(t);if(t===1){if(!Ea(e,"OES_texture_float"))return!1}else if(!Ea(e,"EXT_color_buffer_float"))return!1;return oC(e)}function qge(t){if(t===0)return!1;const e=Ka(t);if(t===1){if(!Ea(e,"OES_texture_float")||!Ea(e,"WEBGL_color_buffer_float"))return!1}else{if(Ea(e,"EXT_color_buffer_float"))return oC(e);const s="EXT_color_buffer_half_float";if(Ea(e,s)){const i=e.getExtension(s);return Xge(e,i)}return!1}return oC(e)}function oC(t){const e=Zb(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);const s=1,i=1;t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,s,i,0,e.textureFormatFloat,e.textureTypeFloat,null);const c=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,c),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const l=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(c),l}function Xge(t,e){const n=Zb(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s);const i=1,c=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,i,c,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const l=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,l),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const d=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(l),d}function Yge(t){return t!==2?!1:Ka(t).fenceSync!=null}function dg(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&se(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xt=De();xt.registerFlag("HAS_WEBGL",()=>xt.getNumber("WEBGL_VERSION")>0);xt.registerFlag("WEBGL_VERSION",()=>u$(2)?2:u$(1)?1:0);xt.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);xt.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>xt.get("WEBGL_VERSION")===2);xt.registerFlag("WEBGL_CPU_FORWARD",()=>!0);xt.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);xt.registerFlag("WEBGL_PACK",()=>xt.getBool("HAS_WEBGL"));xt.registerFlag("WEBGL_PACK_NORMALIZATION",()=>xt.getBool("WEBGL_PACK"));xt.registerFlag("WEBGL_PACK_CLIP",()=>xt.getBool("WEBGL_PACK"));xt.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>xt.getBool("WEBGL_PACK"));xt.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>xt.getBool("WEBGL_PACK"));xt.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>xt.getBool("WEBGL_PACK"));xt.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>xt.getBool("WEBGL_PACK"));xt.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>xt.getBool("WEBGL_PACK"));xt.registerFlag("WEBGL_PACK_REDUCE",()=>xt.getBool("WEBGL_PACK"));xt.registerFlag("WEBGL_LAZILY_UNPACK",()=>xt.getBool("WEBGL_PACK"));xt.registerFlag("WEBGL_CONV_IM2COL",()=>xt.getBool("WEBGL_PACK"));xt.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>Gge(xt.getNumber("WEBGL_VERSION")));xt.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>zge(xt.getNumber("WEBGL_VERSION")));xt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=xt.getNumber("WEBGL_VERSION");return t===0?0:Hge(t)});xt.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>xt.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!S6());xt.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>Kge(xt.getNumber("WEBGL_VERSION")));xt.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>xt.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:xt.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));xt.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>qge(xt.getNumber("WEBGL_VERSION")));xt.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Yge(xt.getNumber("WEBGL_VERSION")));xt.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>xt.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);xt.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});xt.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>S6()?1:-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});xt.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);xt.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);xt.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);xt.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);xt.registerFlag("WEBGL_EXP_CONV",()=>!1);xt.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>xt.getBool("IS_TEST"));xt.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);xt.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);xt.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $o(){let t,e,n,s,i,c,l,d,p,f;return De().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",i="texture",c="outputColor",l="out vec4 outputColor;",d=De().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",p="",f=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",i="texture2D",c="gl_FragColor",l="",d=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,p=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,f=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:i,output:c,defineOutput:l,defineSpecialNaN:d,defineSpecialInf:p,defineRound:f}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wd(t,e,n="index"){const s=Pt(e);return s.map((i,c)=>{const l=`int ${t[c]} = ${n} / ${i}`,d=c===s.length-1?`int ${t[c+1]} = ${n} - ${t[c]} * ${i}`:`index -= ${t[c]} * ${i}`;return`${l}; ${d};`}).join("")}function ly(t,e,n="index"){const s=Pt(e);return s.map((i,c)=>{const l=`int ${t[c]} = ${n} / outShapeStrides[${c}]`,d=c===s.length-1?`int ${t[c+1]} = ${n} - ${t[c]} * outShapeStrides[${c}]`:`index -= ${t[c]} * outShapeStrides[${c}]`;return`${l}; ${d};`}).join("")}function Jge(t,e){const n=t.length,s=t.map(c=>`${e}[${c}]`),i=new Array(n-1);i[n-2]=s[n-1];for(let c=n-3;c>=0;--c)i[c]=`(${i[c+1]} * ${s[c+1]})`;return i}function Qge(t,e,n="index"){const s=t.map((c,l)=>l),i=Jge(s,e);return i.map((c,l)=>{const d=`int ${t[l]} = ${n} / ${i[l]}`,p=l===i.length-1?`int ${t[l+1]} = ${n} - ${t[l]} * ${i[l]}`:`index -= ${t[l]} * ${i[l]}`;return`${d}; ${p};`}).join("")}function eN(t){const e=Pt(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function tN(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const A8=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:O8}=Fae;function Zge(t,e,n){const s=[];if(t.forEach(v=>{const I=Pe(v.shapeInfo.logicalShape);if(v.shapeInfo.isUniform?s.push(`uniform float ${v.name}${I>1?`[${I}]`:""};`):(s.push(`uniform sampler2D ${v.name};`),s.push(`uniform int offset${v.name};`)),n.enableShapeUniforms){const{uniformShape:b}=nN(n.packedInputs,v.shapeInfo.logicalShape,v.shapeInfo.texShape);switch(b.length){case 1:s.push(`uniform int ${v.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${v.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${v.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${v.name}Shape;`);break}s.push(`uniform ivec2 ${v.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(v=>{s.push(`uniform ${v.type} ${v.name}${v.arrayIndex?`[${v.arrayIndex}]`:""};`)});const i=s.join(`
`),c=t.map(v=>eEe(v,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),l=e.texShape,d=$o(),p=rEe(d);let f,m,_=iEe(d);return e.isPacked?(f=tEe(e.logicalShape,l,n.enableShapeUniforms),m=oEe(d)):(f=nEe(e.logicalShape,l,n.enableShapeUniforms),m=sEe(d)),n.packedInputs&&(_+=lEe),[_,p,m,i,f,c,n.userCode].join(`
`)}function zp(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return TEe(t,e);case 1:return CEe(t,e);case 2:return REe(t,e);case 3:return NEe(t,e);case 4:return OEe(t,e);case 5:return xEe(t);case 6:return kEe(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function x8(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return SEe(t);case 1:return IEe(t,e);case 2:return wEe(t,e);case 3:return bEe(t,e);default:return AEe(t,e)}}function eEe(t,e,n=!1,s){let i="";n?i+=x8(t,s):i+=zp(t,s);const c=t.shapeInfo.logicalShape,l=e.logicalShape;return c.length<=l.length&&(n?i+=DEe(t,e):i+=PEe(t,e)),i}function tEe(t,e,n){switch(t.length){case 0:return k8();case 1:return dEe(t,e,n);case 2:return yEe(t,e,n);case 3:return pEe(t,e,n);default:return mEe(t,e,n)}}function nEe(t,e,n){switch(t.length){case 0:return k8();case 1:return hEe(t,e,n);case 2:return vEe(t,e,n);case 3:return fEe(t,e,n);case 4:return gEe(t,e,n);case 5:return EEe(t,e);case 6:return _Ee(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function rEe(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function sEe(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function oEe(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function iEe(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${aEe}
    ${cEe}
    ${uEe}
  `}const aEe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,cEe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,uEe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,lEe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function k8(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function dEe(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function hEe(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function pEe(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[2]/2),c=i*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${c};
      index -= b * ${c};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec3(b, r, c);
    }
  `}function fEe(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${ly(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=Wd(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function mEe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],i=Math.ceil(t[t.length-1]/2),c=i*Math.ceil(t[t.length-2]/2);let l=c,d="",p="b, r, c";for(let f=2;f<t.length-1;f++)l*=t[t.length-f-1],d=`
      int b${f} = index / ${l};
      index -= b${f} * ${l};
    `+d,p=`b${f}, `+p;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${d}

      int b = index / ${c};
      index -= b * ${c};

      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec${t.length}(${p});
    }
  `}function gEe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${ly(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=Wd(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function EEe(t,e){const n=Wd(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function _Ee(t,e){const n=Wd(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function yEe(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Nr(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const i=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${i});
      int c = imod(index, ${i}) * 2;

      return ivec2(r, c);
    }
  `}function vEe(t,e,n){return Nr(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Gd(t){return`offset${t}`}function SEe(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=$o();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function TEe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[i,c]=t.shapeInfo.texShape;if(i===1&&c===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const l=Gd(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${l});
      return sampleTexture(${n}, uv);
    }
  `;const[d,p]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${d}, ${p}, ${l});
      return sampleTexture(${n}, uv);
    }
  `}function IEe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,c=$o();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${c.texture2D}(${n}, uv);
    }
  `;const l=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${l[0]}, ${l[1]}, index);
      return ${c.texture2D}(${n}, uv);
    }
  `}function CEe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Hp(t)}
      }
    `;const i=t.shapeInfo.texShape,c=i[0],l=i[1];if(l===1&&c===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const d=Gd(n);return l===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${d}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${d}) + 0.5) / ${c}.0);
        return sampleTexture(${n}, uv);
      }
    `:c===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${d}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${d}) + 0.5) / ${l}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${d});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${c}, ${l}, index + ${d});
      return sampleTexture(${n}, uv);
    }
  `}function wEe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),c=t.shapeInfo.texShape,l=c[0],d=c[1],p=$o();if(c!=null&&Nr(n,c))return e?`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${p.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${d}.0, ${l}.0);

        return ${p.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${i}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${p.texture2D}(${s}, uv);
    }
  `;const f=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],m=Math.ceil(n[1]/2);return`
    vec4 ${i}(int row, int col) {
      vec2 uv = packedUVfrom2D(${m}, ${f[0]}, ${f[1]}, row, col);
      return ${p.texture2D}(${s}, uv);
    }
  `}function REe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),c=t.shapeInfo.texShape;if(c!=null&&Nr(n,c)){if(e)return`
      float ${i}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const y=c[0],v=c[1];return`
    float ${i}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${v}.0, ${y}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:l,keptDims:d}=vl(n),p=l;if(p.length<n.length){const y=Kp(t,p),v=["row","col"];return`
      ${zp(y,e)}
      float ${i}(int row, int col) {
        return ${i}(${qp(v,d)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Hp(t)}
      }
    `;const f=c[0],m=c[1],_=Gd(s);return m===1?e?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${_}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${_}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `:f===1?e?`
      float ${i}(int row, int col) {
        float index = dot(vec3(row, col, ${_}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col) {
      float index = dot(vec3(row, col, ${_}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${m}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${i}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${_};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${i}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${_};
    vec2 uv = uvFromFlat(${f}, ${m}, index);
    return sampleTexture(${s}, uv);
  }
`}function bEe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),c=t.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(n[0]===1){const y=n.slice(1),v=[1,2],I=Kp(t,y),b=["b","row","col"];return`
        ${x8(I,e)}
        vec4 ${i}(int b, int row, int col) {
          return ${i}(${qp(b,v)});
        }
      `}const d=$o();if(e)return`
    vec4 ${i}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${d.texture2D}(${s}, uv);
    }
  `;const p=l[0],f=l[1],m=Math.ceil(n[2]/2),_=m*Math.ceil(n[1]/2);return`
    vec4 ${i}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${p}, ${f}, ${_}, ${m}, b, row, col);
      return ${d.texture2D}(${s}, uv);
    }
  `}function NEe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),c=n[1]*n[2],l=n[2],{newShape:d,keptDims:p}=vl(n),f=d;if(f.length<n.length){const b=Kp(t,f),A=["row","col","depth"];return`
        ${zp(b,e)}
        float ${i}(int row, int col, int depth) {
          return ${i}(${qp(A,p)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${c}, ${l}, 1)));
        ${Hp(t)}
      }
    `;const m=t.shapeInfo.texShape,_=m[0],y=m[1],v=t.shapeInfo.flatOffset;if(y===c&&v==null)return e?`
      float ${i}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${i}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${l}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${y}.0, ${_}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(y===l&&v==null)return e?`
      float ${i}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${i}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${y}.0, ${_}.0);
      return sampleTexture(${s}, uv);
    }
  `;const I=Gd(s);return e?`
    float ${i}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${I};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${i}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${c} + col * ${l} + depth + ${I};
        vec2 uv = uvFromFlat(${_}, ${y}, index);
        return sampleTexture(${s}, uv);
      }
  `}function AEe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=$o();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${i.texture2D}(${n}, uv);
    }
  `;const c=t.shapeInfo.logicalShape,l=c.length,d=t.shapeInfo.texShape,p=[Math.ceil(d[0]/2),Math.ceil(d[1]/2)],f=p[0],m=p[1],_=Math.ceil(c[l-1]/2);let y=_*Math.ceil(c[l-2]/2),v="int b, int row, int col",I=`b * ${y} + (row / 2) * ${_} + (col / 2)`;for(let b=2;b<l-1;b++)v=`int b${b}, `+v,y*=c[l-b-1],I=`b${b} * ${y} + `+I;return`
    vec4 ${s}(${v}) {
      int index = ${I};
      int texR = index / ${m};
      int texC = index - texR * ${m};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${m}, ${f});
      return ${i.texture2D}(${n}, uv);
    }
  `}function OEe(t,e){const n=t.shapeInfo.logicalShape,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),c=n[3],l=n[2]*c,d=n[1]*l,{newShape:p,keptDims:f}=vl(n);if(p.length<n.length){const O=Kp(t,p),L=["row","col","depth","depth2"];return`
      ${zp(O,e)}
      float ${i}(int row, int col, int depth, int depth2) {
        return ${i}(${qp(L,f)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${i}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${d}, ${l}, ${c}, 1)));
        ${Hp(t)}
      }
    `;const m=t.shapeInfo.flatOffset,_=t.shapeInfo.texShape,y=_[0],v=_[1],I=`int stride2 = ${s}Shape[3];`,b=`int stride1 = ${s}Shape[2] * stride2;`,A=`int stride0 = ${s}Shape[1] * stride1;`;if(v===d&&m==null)return e?`
      float ${i}(int row, int col, int depth, int depth2) {
        ${I}
        ${b}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${l}, ${c}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${v}.0, ${y}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(v===c&&m==null)return e?`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${i}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${v}.0, ${y}.0);
        return sampleTexture(${s}, uv);
      }
    `;const R=Gd(s);return e?`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${I}
      ${b}
      ${A}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${R});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${i}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${l} +
          depth * ${c} + depth2;
      vec2 uv = uvFromFlat(${y}, ${v}, index + ${R});
      return sampleTexture(${s}, uv);
    }
  `}function xEe(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[4],c=e[3]*i,l=e[2]*c,d=e[1]*l,{newShape:p,keptDims:f}=vl(e);if(p.length<e.length){const b=Kp(t,p),A=["row","col","depth","depth2","depth3"];return`
      ${zp(b)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${qp(A,f)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${l}, ${c}, ${i})) +
          depth3;
        ${Hp(t)}
      }
    `;const m=t.shapeInfo.flatOffset,_=t.shapeInfo.texShape,y=_[0],v=_[1];if(v===d&&m==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${l}, ${c}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${v}.0, ${y}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(v===i&&m==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${v}.0, ${y}.0);
        return sampleTexture(${n}, uv);
      }
    `;const I=Gd(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${l} + depth * ${c} +
          depth2 * ${i} + depth3 + ${I};
      vec2 uv = uvFromFlat(${y}, ${v}, index);
      return sampleTexture(${n}, uv);
    }
  `}function kEe(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:c}=vl(e);if(i.length<e.length){const A=Kp(t,i),R=["row","col","depth","depth2","depth3","depth4"];return`
      ${zp(A)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${qp(R,c)});
      }
    `}const l=e[5],d=e[4]*l,p=e[3]*d,f=e[2]*p,m=e[1]*f;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${m}, ${f}, ${p}, ${d})) +
          dot(
            vec2(depth3, depth4),
            vec2(${l}, 1)));
        ${Hp(t)}
      }
    `;const _=t.shapeInfo.flatOffset,y=t.shapeInfo.texShape,v=y[0],I=y[1];if(I===m&&_==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${f}, ${p}, ${d}, ${l})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${I}.0, ${v}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(I===l&&_==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${I}.0, ${v}.0);
        return sampleTexture(${n}, uv);
      }
    `;const b=Gd(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${m} + col * ${f} + depth * ${p} +
          depth2 * ${d} + depth3 * ${l} + depth4 + ${b};
      vec2 uv = uvFromFlat(${v}, ${I}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Hp(t){const e=t.name,n=Pe(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function DEe(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),i="get"+s+"AtOutCoords",c=t.shapeInfo.logicalShape.length,l=e.logicalShape.length,d=O8(t.shapeInfo.logicalShape,e.logicalShape),p=Er(l),f=l-c;let m;const _=["x","y","z","w","u","v"];c===0?m="":l<2&&d.length>=1?m="coords = 0;":m=d.map(O=>`coords.${_[O+f]} = 0;`).join(`
`);let y="";l<2&&c>0?y="coords":y=t.shapeInfo.logicalShape.map((O,L)=>`coords.${_[L+f]}`).join(", ");let v="return outputValue;";const b=Pe(t.shapeInfo.logicalShape)===1,R=Pe(e.logicalShape)===1;if(c===1&&!b&&!R)v=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(b&&!R)l===1?v=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:v=`
        return vec4(outputValue.x);
      `;else if(d.length){const O=c-2,L=c-1;d.indexOf(O)>-1&&d.indexOf(L)>-1?v="return vec4(outputValue.x);":d.indexOf(O)>-1?v="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":d.indexOf(L)>-1&&(v="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${i}() {
      ${p} coords = getOutputCoords();
      ${m}
      vec4 outputValue = get${s}(${y});
      ${v}
    }
  `}function PEe(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),i="get"+s+"AtOutCoords",c=e.texShape,l=t.shapeInfo.texShape,d=t.shapeInfo.logicalShape.length,p=e.logicalShape.length;if(!t.shapeInfo.isUniform&&d===p&&t.shapeInfo.flatOffset==null&&Nr(l,c))return`
      float ${i}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const f=Er(p),m=O8(t.shapeInfo.logicalShape,e.logicalShape),_=p-d;let y;const v=["x","y","z","w","u","v"];d===0?y="":p<2&&m.length>=1?y="coords = 0;":y=m.map(b=>`coords.${v[b+_]} = 0;`).join(`
`);let I="";return p<2&&d>0?I="coords":I=t.shapeInfo.logicalShape.map((b,A)=>`coords.${v[A+_]}`).join(", "),`
    float ${i}() {
      ${f} coords = getOutputCoords();
      ${y}
      return get${s}(${I});
    }
  `}function Er(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function nN(t,e,n){const{newShape:s,keptDims:i}=vl(e),c=e.length,l=t&&c===3&&e[0]===1,d=l?e.slice(1):s,p=!t&&c>1&&!Nr(e,n)&&s.length<c||l;return{useSqueezeShape:p,uniformShape:p?d:e,keptDims:i}}function Kp(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function qp(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LEe(t,e,n,s){const i=n.map((m,_)=>{const y={logicalShape:m.shape,texShape:m.isUniform?null:m.texData.texShape,isUniform:m.isUniform,isPacked:m.isUniform?!1:m.texData.isPacked,flatOffset:null};return m.texData!=null&&m.texData.slice!=null&&m.texData.slice.flatOffset>0&&(y.flatOffset=m.texData.slice.flatOffset),{name:e.variableNames[_],shapeInfo:y}}),c=i.map(m=>m.shapeInfo),l={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},d=Zge(i,l,e),p=Nge(t.gl,d),f=t.createProgram(p);return De().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:p,source:d,webGLProgram:f,inShapeInfos:c,outShapeInfo:l,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:p,source:d,webGLProgram:f,inShapeInfos:c,outShapeInfo:l},D8(t,e,f))}function D8(t,e,n){const s={},i={},c={},l=[];let d,p,f,m=null,_=null;_=t.getUniformLocation(n,"NAN",!1),De().getNumber("WEBGL_VERSION")===1&&(m=t.getUniformLocation(n,"INFINITY",!1));const y=!1;for(let v=0;v<e.variableNames.length;v++){const I=e.variableNames[v];s[I]=t.getUniformLocation(n,I,y),s[`offset${I}`]=t.getUniformLocation(n,`offset${I}`,y),e.enableShapeUniforms&&(i[`${I}Shape`]=t.getUniformLocation(n,`${I}Shape`,y),c[`${I}TexShape`]=t.getUniformLocation(n,`${I}TexShape`,y))}return e.enableShapeUniforms&&(d=t.getUniformLocation(n,"outShape",y),f=t.getUniformLocation(n,"outShapeStrides",y),p=t.getUniformLocation(n,"outTexShape",y)),e.customUniforms&&e.customUniforms.forEach((v,I)=>{l[I]=t.getUniformLocation(n,v.name,y)}),{uniformLocations:s,customUniformLocations:l,infLoc:m,nanLoc:_,inShapesLocations:i,inTexShapesLocations:c,outShapeLocation:d,outShapeStridesLocation:f,outTexShapeLocation:p}}function l$(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const i=n.logicalShape,c=e[s],l=c.shape;if(!Nr(i,l))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${i} and ${l} must match`);if(n.isUniform&&c.isUniform)return;const d=n.texShape,p=c.isUniform?null:c.texData.texShape;if(!Nr(d,p))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${d} and ${p} must match`)})}function MEe(t,e,n,s,i){e.program.enableShapeUniforms||(l$(e.inShapeInfos,n),l$([e.outShapeInfo],[s]));const c=s.texData.texture,l=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(c.texture,l[0],l[1]):t.setOutputMatrixTexture(c.texture,l[0],l[1]),t.setProgram(e.webGLProgram),De().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach((p,f)=>{const m=e.program.variableNames[f],_=e.uniformLocations[m],y=e.uniformLocations[`offset${m}`],v=e.inShapesLocations[`${m}Shape`],I=e.inTexShapesLocations[`${m}TexShape`];if(v){const{uniformShape:b}=nN(e.program.packedInputs,p.shape,p.texData.texShape);switch(b.length){case 1:t.gl.uniform1iv(v,new Int32Array(b));break;case 2:t.gl.uniform2iv(v,new Int32Array(b));break;case 3:t.gl.uniform3iv(v,new Int32Array(b));break;case 4:t.gl.uniform4iv(v,new Int32Array(b));break}}if(I&&t.gl.uniform2i(I,p.texData.texShape[0],p.texData.texShape[1]),_!=null){if(p.isUniform){if(Pe(p.shape)<2)t.gl.uniform1f(_,p.uniformValues[0]);else{let b=p.uniformValues;b instanceof Float32Array||(b=new Float32Array(b)),t.gl.uniform1fv(_,b)}return}p.texData.slice!=null&&y!=null&&t.gl.uniform1i(y,p.texData.slice.flatOffset),t.setInputMatrixTexture(p.texData.texture.texture,_,f)}});const d=e.outShapeLocation;if(d)switch(s.shape.length){case 1:t.gl.uniform1iv(d,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(d,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(d,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(d,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const p=Pt(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(p));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(p));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(p));break}}e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&i&&e.program.customUniforms.forEach((p,f)=>{const m=e.customUniformLocations[f],_=i[f];if(p.type==="float")t.gl.uniform1fv(m,_);else if(p.type==="vec2")t.gl.uniform2fv(m,_);else if(p.type==="vec3")t.gl.uniform3fv(m,_);else if(p.type==="vec4")t.gl.uniform4fv(m,_);else if(p.type==="int")t.gl.uniform1iv(m,_);else if(p.type==="ivec2")t.gl.uniform2iv(m,_);else if(p.type==="ivec3")t.gl.uniform3iv(m,_);else if(p.type==="ivec4")t.gl.uniform4iv(m,_);else throw Error(`uniform type ${p.type} is not supported yet.`)}),t.executeProgram()}function $Ee(t,e,n){let s="";e.concat(n).forEach(l=>{const d=l.texData!=null&&l.texData.slice!=null&&l.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!l.isUniform){const p=l.texData.texShape,{useSqueezeShape:f,uniformShape:m,keptDims:_}=nN(t.packedInputs,l.shape,p);let y="",v="",I="";if(m.length===1&&t.packedInputs){const G=[Math.ceil(p[0]/2),Math.ceil(p[1]/2)];y=`${G[0]>1}_${G[1]>1}`}else if(m.length===2&&!t.packedInputs)v=`${m[0]>1}_${m[1]>1}`;else if(m.length>2&&!t.packedInputs){const G=Pt(m);I=`${G[0]===p[1]}_${G[G.length-1]===p[1]}`}const b=l.shape.length,A=m.length===2&&Nr(l.shape,p),R=Pe(l.shape)===1,O=Np(l.shape,n.shape),L=!t.packedInputs&&b===n.shape.length&&Nr(p,n.texData.texShape),$=t.packedInputs||m.length>2?"":`${p[0]>1}_${p[1]>1}`;s+=`${b}_${L}_${f?_:""}_${m.length}_${R}_${O}_${A}_${y}_${v}_${I}_${$}_${d}`}else{const p=l.isUniform?"uniform":l.texData.texShape;s+=`${l.shape}_${p}_${d}`}});const i=t.userCode;let c=t.constructor.name;return c+="_"+s+"_"+i+`${De().getNumber("WEBGL_VERSION")}`,c}function Fo(t){return De().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FEe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Wm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=$o();this.outputShape=e,this.enableShapeUniforms=Fo(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?ly(["r","c","d"],e):Wd(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UEe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Wm.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=$o();this.outputShape=e,this.enableShapeUniforms=Fo(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?ly(["r","c","d"],e):Wd(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VEe{constructor(e){this.variableNames=["A"],this.outTexUsage=Vi.DOWNLOAD;const n=$o();this.outputShape=e,this.userCode=`
      ${A8}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BEe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Vi.DOWNLOAD;const n=$o();this.outputShape=e,this.userCode=`
      ${A8}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jEe{constructor(e,n=!1){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=$o();this.outputShape=e,this.enableShapeUniforms=Fo(this.outputShape.length);let i="result";n&&(i="floor(result * 255. + 0.5)"),this.userCode=`
      ${this.enableShapeUniforms?tN():eN(e)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / texShape[1];
        int c = imod(flatIndex, texShape[1]);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
        vec4 values = ${s.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${s.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WEe{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=$o();this.outputShape=e,this.enableShapeUniforms=Fo(this.outputShape.length);let i="",c="result";n&&(c="floor(result * 255. + 0.5)");for(let l=0;l<=1;l++)for(let d=0;d<=1;d++){const p=l*2+d;i+=`
          localCoords = coords;
          if(localCoords[2] + ${d} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${d};
          if (localCoords[1] + ${l} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${l};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${p}] = values[0];
            } else if (offset == 1) {
              result[${p}] = values[1];
            } else if (offset == 2) {
              result[${p}] = values[2];
            } else {
              result[${p}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?tN():eN(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${i}

          ${s.output} = ${c};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GEe(t){const e=$o(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return bge(t,n)}function zEe(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return kge(t,e)}function HEe(t){const e=new Uint16Array([0,1,2,2,1,3]);return Dge(t,e)}function hg(t,e,n,s,i,c){Lge(e,n);const l=Pge(t),d=t.TEXTURE_2D;return bt(t,()=>t.bindTexture(d,l)),bt(t,()=>t.texParameteri(d,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),bt(t,()=>t.texParameteri(d,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),bt(t,()=>t.texParameteri(d,t.TEXTURE_MIN_FILTER,t.NEAREST)),bt(t,()=>t.texParameteri(d,t.TEXTURE_MAG_FILTER,t.NEAREST)),De().getNumber("WEBGL_VERSION")===1?bt(t,()=>t.texImage2D(d,0,s,e,n,0,i,c,null)):bt(t,()=>t.texStorage2D(d,1,s,e,n)),bt(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:l,texShape:[n,e]}}function P8(t){return t.internalFormatFloat}function KEe(t,e,n,s){const[i,c]=lg(e,n);return hg(t,i,c,P8(s),s.textureFormatFloat,t.FLOAT)}function L8(t){return t.internalFormatHalfFloat}function qEe(t,e,n,s){const[i,c]=lg(e,n);return hg(t,i,c,L8(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function M8(t){return t.downloadTextureFormat}function XEe(t,e,n,s){const[i,c]=lg(e,n);return hg(t,i,c,M8(s),t.RGBA,t.UNSIGNED_BYTE)}function $8(t){return t.internalFormatPackedFloat}function YEe(t,e,n,s){const[i,c]=Gp(e,n);return hg(t,i,c,$8(s),t.RGBA,t.FLOAT)}function F8(t){return t.internalFormatPackedHalfFloat}function JEe(t,e,n,s){const[i,c]=Gp(e,n);return hg(t,i,c,F8(s),t.RGBA,s.textureTypeHalfFloat)}function QEe(t,e,n){return bt(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),a$(t,e,"clipSpacePos",n,3,20,0)&&a$(t,e,"uv",n,2,20,12)}function ZEe(t,e,n,s,i,c){bt(t,()=>t.bindTexture(t.TEXTURE_2D,e));let l,d,p;i instanceof Uint8Array?(l=new Uint8Array(n*s*4),d=t.UNSIGNED_BYTE,p=t.RGBA):(l=new Float32Array(n*s*4),d=t.FLOAT,p=c.internalFormatPackedFloat),l.set(i),De().getNumber("WEBGL_VERSION")===2?bt(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,d,l)):bt(t,()=>t.texImage2D(t.TEXTURE_2D,0,p,n,s,0,t.RGBA,d,l)),bt(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function e0e(t,e,n){bt(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?De().getNumber("WEBGL_VERSION")===2?bt(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):bt(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):De().getNumber("WEBGL_VERSION")===2?bt(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):bt(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),bt(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function t0e(t,e,n,s){const i=t.createBuffer();bt(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,i));const d=4*4*e*n;return bt(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,d,t.STREAM_READ)),bt(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),bt(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),i}function n0e(t,e,n){const s=t,i=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,i),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),i}function r0e(t,e,n,s){const[i,c]=lg(e,n),l=4,d=new Uint8Array(vge(e*n,l));return bt(t,()=>t.readPixels(0,0,i,c,s.downloadTextureFormat,t.UNSIGNED_BYTE,d)),new Float32Array(d.buffer)}function s0e(t,e,n,s,i,c,l,d){const p=t,f=new Float32Array(Sge(c,l));return p.bindBuffer(p.PIXEL_PACK_BUFFER,e),p.getBufferSubData(p.PIXEL_PACK_BUFFER,0,f),p.bindBuffer(p.PIXEL_PACK_BUFFER,null),f}function o0e(t,e,n){const s=new Float32Array(e*n*4);return bt(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mI{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const n=De().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,Ege(n,e)):this.gl=Ka(n);let s="WEBGL_color_buffer_float";const i="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),De().getNumber("WEBGL_VERSION")===1){const c="OES_texture_float",l="OES_texture_half_float";if(this.textureFloatExtension=l0(this.gl,c),Ea(this.gl,l))this.textureHalfFloatExtension=l0(this.gl,l);else if(De().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Ea(this.gl,i))this.colorBufferHalfFloatExtension=l0(this.gl,i);else if(De().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Ea(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Ea(this.gl,i))this.colorBufferHalfFloatExtension=this.gl.getExtension(i);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=zEe(this.gl),this.indexBuffer=HEe(this.gl),this.framebuffer=Mge(this.gl),this.textureConfig=Zb(this.gl,this.textureHalfFloatExtension)}get debug(){return De().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;bt(e,()=>e.finish()),bt(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),bt(e,()=>e.deleteFramebuffer(this.framebuffer)),bt(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),bt(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),bt(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),KEe(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),qEe(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),XEe(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),e0e(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,i){this.throwIfDisposed(),ZEe(this.gl,e,n,s,i,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),JEe(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),YEe(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(c$(this.gl,this.framebuffer),this.outputTexture=null),bt(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>r0e(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,i,c,l){return s0e(this.gl,e,n,s,i,c,l,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return n0e(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const i=t0e(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),i}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(De().getBool("WEBGL_FENCE_API_ENABLED")){const i=e,c=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const l=i.clientWaitSync(c,0,0);return l===i.ALREADY_SIGNALED||l===i.CONDITION_SATISFIED},n=c}else De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>o0e(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=GEe(n));const s=Oge(n);return bt(n,()=>n.attachShader(s,this.vertexShader)),bt(n,()=>n.attachShader(s,e)),xge(n,s),this.debug&&lI(n,s),this.vertexAttrsAreBound||(this.setProgram(s),this.vertexAttrsAreBound=QEe(n,this.program,this.vertexBuffer)),s}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&bt(this.gl,()=>this.gl.deleteProgram(e))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&lI(this.gl,this.program),bt(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?Fge(this.gl,e,n):Uge(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),bt(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),Vge(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[i,c]=Gp(n,s);this.setOutputMatrixTextureDriver(e,i,c)}setOutputMatrixWriteRegion(e,n,s,i){this.setOutputMatrixWriteRegionDriver(s,e,i,n)}setOutputPackedMatrixWriteRegion(e,n,s,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&lI(this.gl,this.program),d0(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;this.debug&&this.debugValidate(),bt(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),bt(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=l0(this.gl,De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,i=this.getQueryTimerExtensionWebGL2(),c=s.createQuery();return s.beginQuery(i.TIME_ELAPSED_EXT,c),c}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await lM(()=>this.disposed||this.isQueryAvailable(e,De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,i=this.getQueryTimerExtensionWebGL2(),c=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),c&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),i=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),i&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=i0e(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in De().platform&&(s=De().platform.setTimeoutCustom.bind(De().platform)),lM(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),dI(this.gl,e,this.framebuffer),this.debug&&d0(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(dI(this.gl,this.outputTexture,this.framebuffer),this.debug&&d0(this.gl)):c$(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const i=this.gl;dI(i,e,this.framebuffer),this.debug&&d0(i),this.outputTexture=e,bt(i,()=>i.viewport(0,0,n,s)),bt(i,()=>i.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,i){this.throwIfDisposed(),bt(this.gl,()=>this.gl.scissor(e,n,s,i))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function i0e(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:a0e,bincountImpl:U8,bincountReduceImpl:c0e,castImpl:u0e,ceilImpl:l0e,concatImpl:d0e,equalImpl:h0e,expImpl:p0e,expm1Impl:f0e,floorImpl:m0e,gatherNdImpl:g0e,gatherV2Impl:E0e,greaterImpl:_0e,greaterEqualImpl:y0e,lessImpl:v0e,lessEqualImpl:S0e,linSpaceImpl:T0e,logImpl:I0e,maxImpl:C0e,maximumImpl:w0e,minimumImpl:R0e,multiplyImpl:b0e,negImpl:N0e,notEqualImpl:A0e,prodImpl:O0e,raggedGatherImpl:x0e,raggedTensorToTensorImpl:k0e,rangeImpl:D0e,rsqrtImpl:P0e,scatterImpl:L0e,sigmoidImpl:M0e,simpleAbsImpl:V8,sliceImpl:$0e,sparseFillEmptyRowsImpl:F0e,sparseReshapeImpl:U0e,sparseSegmentReductionImpl:B8,sqrtImpl:V0e,stridedSliceImpl:B0e,stringNGramsImpl:j0e,stringSplitImpl:W0e,stringToHashBucketFastImpl:G0e,subImpl:z0e,tileImpl:H0e,topKImpl:K0e,transposeImpl:rN,uniqueImpl:q0e}=rde;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j8(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function Do(t,e){return e===1?[t]:j8(t,e)}function X0e(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y0e{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Fo(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=Do("rc",this.rank),s=Er(this.rank),i=this.getOutOfBoundsCondition(n),c=this.getSetup(n),l=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${c}

            setOutput(vec4(${l}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let i=0;i<=1;i++){let c=`${s===0?"r":"rp1"}, ${i===0?"c":"cp1"}`;for(let l=2;l<this.rank;l++)c=`${e[e.length-1-l]},`+c;n.push(c)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],i=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${i};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W8{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Fo(this.outputShape.length);let s="";for(let i=0;i<4;i++){let c="thisRC = rc;";i%2===1&&(c+="thisRC.z += 1;"),i>1&&(c+="thisRC.y += 1;"),s+=`
        ${c}
        ${i>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${i}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${i>0?"}":""}
      `}this.userCode=`
      ${J0e(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?tN():eN(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function J0e(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?Qge(["r","c","d"],"inputShape"):Wd(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Q0e{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,n,s){const i=h$(n,s),c=p$(e,i,s);c in this.freeTextures||(this.freeTextures[c]=[]),c in this.usedTextures||(this.usedTextures[c]=[]);const l=d$(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[c].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=l,this.log();const p=this.freeTextures[c].shift();return this.usedTextures[c].push(p),p}let d;return i===Gs.PACKED_2X2_FLOAT32?d=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===Gs.PACKED_2X2_FLOAT16?d=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===Gs.UNPACKED_FLOAT32?d=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===Gs.UNPACKED_FLOAT16?d=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===Gs.PACKED_4X1_UNSIGNED_BYTE&&(d=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[c].push(d),this.numUsedTextures++,this._numBytesAllocated+=l,this.log(),d}releaseTexture(e,n,s,i){if(this.freeTextures==null)return;const c=h$(s,i),l=p$(n,c,i);l in this.freeTextures||(this.freeTextures[l]=[]);const d=d$(n,c,this.gpgpu.gl,this.gpgpu.textureConfig,i),p=De().get("WEBGL_DELETE_TEXTURE_THRESHOLD");p!==-1&&this._numBytesAllocated>p?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=d):(this.freeTextures[l].push(e),this.numFreeTextures++,this._numBytesFree+=d),this.numUsedTextures--;const f=this.usedTextures[l],m=f.indexOf(e);if(m<0)throw new Error("Cannot release a texture that was never provided by this texture manager");f.splice(m,1),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function Z0e(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function d$(t,e,n,s,i){const c=e1e(e,s);let l;if(i){const[p,f]=Gp(t[0],t[1]);l=p*f}else{const[p,f]=lg(t[0],t[1]);l=p*f}const d=Z0e(n,c);return l*d}function e1e(t,e){switch(t){case Gs.PACKED_2X2_FLOAT32:return $8(e);case Gs.PACKED_2X2_FLOAT16:return F8(e);case Gs.UNPACKED_FLOAT32:return P8(e);case Gs.UNPACKED_FLOAT16:return L8(e);case Gs.PACKED_4X1_UNSIGNED_BYTE:return M8(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function t1e(t){return De().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Gs.PACKED_2X2_FLOAT32:Gs.UNPACKED_FLOAT32:t?Gs.PACKED_2X2_FLOAT16:Gs.UNPACKED_FLOAT16}function h$(t,e){if(t===Vi.UPLOAD)return Gs.PACKED_2X2_FLOAT32;if(t===Vi.RENDER||t==null)return t1e(e);if(t===Vi.DOWNLOAD||t===Vi.PIXELS)return Gs.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function p$(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kc{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Fo(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Ca="if (isnan(x)) return x;",n1e="return x;",f$="return abs(x);",r1e="return (x >= 0.0) ? x : (exp(x) - 1.0);",s1e=Ca+`
  return (x < 0.0) ? 0.0 : x;
`,o1e=Ca+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,jh="return x;",i1e="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a1e="return x;",c1e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,u1e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,l1e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,d1e="return 1.0 / (1.0 + exp(-1.0 * x));";class gd{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Fo(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h1e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Fo(this.outputShape.length);const n=e.length,s=Do("rc",n),i=Er(n),c=X0e(n,s),l=s.slice(-2),d=n<=1?"rc":`vec2(${l.join(",")})`;this.userCode=`
      void main() {
        ${i} rc = getOutputCoords();
        vec4 packedInput = getA(${c});

        setOutput(getChannel(packedInput, ${d}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p1e=gb,f1e=1e-7,m1e=1e-4,p0={};function g1e(t){return t in p0||(p0[t]={}),p0[t]}const E1e=De().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),_1e=600;function y1e(){return De().global.screen==null?1024:De().global.screen.height*De().global.screen.width*window.devicePixelRatio*_1e/1024/1024}class dy extends rw{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!De().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof mI)n=e;else{const s=Ka(De().getNumber("WEBGL_VERSION"),e);n=new mI(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Ka(De().getNumber("WEBGL_VERSION"));n=new mI(s),this.binaryCache=g1e(De().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new Q0e(this.gpgpu),this.numMBBeforeWarning=y1e(),this.texData=new zU(this,Hu())}nextDataId(){return dy.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,n,s){if((De().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||De().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:s,values:e,usage:Vi.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,i,c){if(De().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:i,values:n,usage:Vi.UPLOAD,refCount:c})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:i,complexTensorInfos:c,slice:l,shape:d,isPacked:p}=n;if(l!=null){let y;p?y=new gd(d,jh):y=new Kc(d,jh);const v=this.runWebGLProgram(y,[{dataId:e,shape:d,dtype:i}],i),I=this.readSync(v.dataId);return this.disposeIntermediateTensorInfo(v),I}if(s!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return s;const f=this.activeTimers!=null;let m;f&&(m=Fi());let _;if(i==="complex64"){const y=this.readSync(c.real.dataId),v=this.readSync(c.imag.dataId);_=ru(y,v)}else _=this.getValuesFromTexture(e);return f&&(this.downloadWaitMs+=Fi()-m),this.convertAndCacheOnCPU(e,_)}async read(e){if(this.pendingRead.has(e)){const I=this.pendingRead.get(e);return new Promise(b=>I.push(b))}const n=this.texData.get(e),{values:s,shape:i,slice:c,dtype:l,complexTensorInfos:d,isPacked:p}=n;if(c!=null){let I;p?I=new gd(i,jh):I=new Kc(i,jh);const b=this.runWebGLProgram(I,[{dataId:e,shape:i,dtype:l}],l),A=this.read(b.dataId);return this.disposeIntermediateTensorInfo(b),A}if(s!=null)return this.convertAndCacheOnCPU(e);if(De().getBool("DEBUG")&&!De().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&De().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let f=null,m;if(l!=="complex64"&&De().get("WEBGL_BUFFER_SUPPORTED")){m=this.decode(e);const I=this.texData.get(m.dataId);f=this.gpgpu.createBufferFromTexture(I.texture.texture,...u0(i))}this.pendingRead.set(e,[]),l!=="complex64"&&await this.gpgpu.createAndWaitForFence();let _;if(l==="complex64"){const I=await Promise.all([this.read(d.real.dataId),this.read(d.imag.dataId)]),b=I[0],A=I[1];_=ru(b,A)}else if(f==null)_=this.getValuesFromTexture(e);else{const I=Pe(i);_=this.gpgpu.downloadFloat32MatrixFromBuffer(f,I)}if(m!=null&&this.disposeIntermediateTensorInfo(m),f!=null){const I=this.gpgpu.gl;bt(I,()=>I.deleteBuffer(f))}const y=this.convertAndCacheOnCPU(e,_),v=this.pendingRead.get(e);return this.pendingRead.delete(e),v.forEach(I=>I(y)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Hu().removeDataId(e,this),this.pendingDeletes--),y}readToGPU(e,n={}){const s=this.texData.get(e),{values:i,shape:c,slice:l,dtype:d,isPacked:p,texture:f}=s;if(d==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(l!=null){let v;p?v=new gd(c,jh):v=new Kc(c,jh);const I=this.runWebGLProgram(v,[{dataId:e,shape:c,dtype:d}],d),b=this.readToGPU(I,n);return this.disposeIntermediateTensorInfo(I),b}if(f==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const m=this.decode(e,n.customTexShape),_=Hu().makeTensorFromTensorInfo(m),y=this.texData.get(m.dataId);return Object.assign({tensorRef:_},y.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(i=>pl(i));return cn(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return cn(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!wge(s))throw De().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:i}=this.texData.get(e),c=Pe(n);if(De().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const y=this.decode(e),v=this.texData.get(y.dataId),I=this.gpgpu.downloadMatrixFromPackedTexture(v.texture.texture,...u0(n)).subarray(0,c);return this.disposeIntermediateTensorInfo(y),I}const l=De().getBool("WEBGL_PACK")&&i===!0,d=l?hI(n):n,p=l?new BEe(d):new VEe(d),f=this.runWebGLProgram(p,[{shape:d,dtype:s,dataId:e}],"float32"),m=this.texData.get(f.dataId),_=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture.texture,m.texShape[0],m.texShape[1]).subarray(0,c);return this.disposeIntermediateTensorInfo(f),_}timerAvailable(){return De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let i=!1;this.programTimersStack==null?(this.programTimersStack=s,i=!0):this.activeTimers.push(s),this.activeTimers=s,e();const c=Ip(this.activeTimers.map(p=>p.query)).filter(p=>p!=null),l=Ip(this.activeTimers.map(p=>p.name)).filter(p=>p!=null);this.activeTimers=n,i&&(this.programTimersStack=null);const d={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const p=await Promise.all(c);d.kernelMs=uQ(p),d.getExtraProfileInfo=()=>p.map((f,m)=>({name:l[m],ms:f})).map(f=>`${f.name}: ${f.ms}`).join(", ")}else d.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,d})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Fi(),endMs:null}}endTimer(e){return De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Fi(),e)}async getQueryTime(e){if(De().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:i,usage:c,isPacked:l,slice:d}=this.texData.get(e),p=d&&d.origDataId||e,f=this.dataRefCount.get(p);f>1?this.dataRefCount.set(p,f-1):(this.dataRefCount.delete(p),n!=null&&(this.numBytesInGPU-=this.computeBytes(i,s),this.textureManager.releaseTexture(n,i,c,l)));const m=this.texData.get(e);m.texture=null,m.texShape=null,m.isPacked=!1,m.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=E1e){return De().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&Pe(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){ha("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return p1e(e.shape,n)}packedUnaryOp(e,n,s){const i=new gd(e.shape,n),c=this.compileAndRun(i,[e],s);return Hu().makeTensorFromTensorInfo(c)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const i=V8(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(De().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,f$,e.dtype);const n=new Kc(e.shape,f$),s=this.compileAndRun(n,[e]);return Hu().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let i;if(n==="string"&&s!=null&&s.length>0&&Qm(s[0])){const c=s.map(l=>cl(l));i=this.write(c,e,n)}else i=this.write(s,e,n);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:n}}makeOutput(e,n,s){return Hu().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new h1e(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new Y0e(e.shape),s=!0;return this.runWebGLProgram(n,[e],e.dtype,null,s)}packedReshape(e,n){const s=[Dp(e.shape),...Pp(e.shape)],i={dtype:e.dtype,shape:s,dataId:e.dataId},c=[Dp(n),...Pp(n)],l=new W8(c,s),d=!0,p=[s],f=this.runWebGLProgram(l,[i],e.dtype,p,d);return{dataId:f.dataId,shape:n,dtype:f.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:i,shape:c,dtype:l}=s;if(n!=null){const y=Pe(c),v=n[0]*n[1]*4;se(y<=v,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const d=hI(c);let p;i?p=new UEe(d):p=new FEe(d);const f=!0,m=[n??u0(d)],_=this.runWebGLProgram(p,[{shape:d,dtype:l,dataId:e}],l,m,f,n);return{dtype:l,shape:c,dataId:_.dataId}}runWebGLProgram(e,n,s,i,c=!1,l){const d=this.makeTensorInfo(e.outputShape,s),p=this.texData.get(d.dataId);if(e.packedOutput&&(p.isPacked=!0),e.outPackingScheme===Wm.DENSE){const R=l??u0(e.outputShape);p.texShape=R.map(O=>O*2)}if(e.outTexUsage!=null&&(p.usage=e.outTexUsage),Pe(d.shape)===0)return p.values=Ms(d.dtype,0),d;const f=[],m=n.map(R=>{if(R.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let O=this.texData.get(R.dataId);if(O.texture==null){if(!e.packedInputs&&Pe(R.shape)<=De().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:R.shape,texData:null,isUniform:!0,uniformValues:O.values};e.packedInputs&&(O.isPacked=!0,O.shape=R.shape)}if(this.uploadToGPU(R.dataId),!!O.isPacked!=!!e.packedInputs)R=O.isPacked?this.unpackTensor(R):this.packTensor(R),f.push(R),O=this.texData.get(R.dataId);else if(O.isPacked&&!I1(O.shape,R.shape)){const L=R,$=R.shape;R.shape=O.shape,R=this.packedReshape(R,$),f.push(R),O=this.texData.get(R.dataId),L.shape=$}return{shape:R.shape,texData:O,isUniform:!1}});this.uploadToGPU(d.dataId);const _={shape:d.shape,texData:p,isUniform:!1},y=$Ee(e,m,_),v=this.getAndSaveBinary(y,()=>LEe(this.gpgpu,e,m,_)),I=this.activeTimers!=null;let b;I&&(b=this.startTimer()),De().get("ENGINE_COMPILE_ONLY")||MEe(this.gpgpu,v,m,_,i),f.forEach(R=>this.disposeIntermediateTensorInfo(R)),I&&(b=this.endTimer(b),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(b)}));const A=De().get("WEBGL_FLUSH_THRESHOLD");if(A>0){const R=Fi();R-this.lastGlFlushTime>A&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=R)}if(!De().getBool("WEBGL_LAZILY_UNPACK")&&p.isPacked&&c===!1){const R=this.unpackTensor(d);return this.disposeIntermediateTensorInfo(d),R}return d}compileAndRun(e,n,s,i,c=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,i,c)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(De().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Xr(()=>{if(!De().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=De().getBool("DEBUG");De().set("DEBUG",!1);const n=this.abs(Wn(1e-8)).dataSync()[0];if(De().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?f1e:m1e}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:i,values:c,texture:l,usage:d,isPacked:p}=n;if(l!=null)return;const f=this.activeTimers!=null;let m;f&&(m=Fi());let _=n.texShape;if(_==null&&(_=Wge(s,p),n.texShape=_),c!=null){const y=hI(s);let v,I=_[1],b=_[0];const A=c instanceof Uint8Array||c instanceof Uint8ClampedArray;(p||!A)&&([I,b]=Gp(_[0],_[1])),p?v=new WEe(y,A):v=new jEe(y,A);const R=A?[b,I]:_,O=this.makeTensorInfo(R,i),L=this.texData.get(O.dataId);A?L.usage=Vi.PIXELS:L.usage=Vi.UPLOAD,L.texShape=R,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(O.dataId),I,b,c);const $=[[b,I]],G=!0,H=this.runWebGLProgram(v,[O],i,$,G),Z=this.texData.get(H.dataId);n.texShape=Z.texShape,n.isPacked=Z.isPacked,n.usage=Z.usage,De().get("ENGINE_COMPILE_ONLY")?this.disposeData(H.dataId):(n.texture=Z.texture,n.values=null,this.texData.delete(H.dataId)),this.disposeIntermediateTensorInfo(O),f&&(this.uploadWaitMs+=Fi()-m)}else{const y=this.acquireTexture(_,d,i,p);n.texture=y}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:i}=s;return this.releaseGPUData(e),n!=null&&(s.values=v1e(n,i)),s.values}acquireTexture(e,n,s,i){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const c=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${c} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,i)}computeBytes(e,n){return e[0]*e[1]*f2(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(i=>{try{this.checkCompletion_(n),i(!0)}catch(c){throw c}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Pae(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(N8(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const[,e]of Object.entries(this.binaryCache)){const{uniformLocations:n,customUniformLocations:s,infLoc:i,nanLoc:c,inShapesLocations:l,inTexShapesLocations:d,outShapeLocation:p,outShapeStridesLocation:f,outTexShapeLocation:m}=D8(this.gpgpu,e.program,e.webGLProgram);e.uniformLocations=n,e.customUniformLocations=s,e.infLoc=i,e.nanLoc=c,e.inShapesLocations=l,e.inTexShapesLocations=d,e.outShapeLocation=p,e.outShapeStridesLocation=f,e.outTexShapeLocation=m}}}dy.nextDataId=0;function v1e(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */T6()&&W6("webgl",()=>new dy,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sN=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Lp{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=Rn(n,s),this.enableShapeUniforms=Fo(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pg=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class fg{constructor(e,n,s,i=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Rn(n,s);const c=this.outputShape.length;this.enableShapeUniforms=Fo(c);let l="";if(i)if(c===0||Pe(this.outputShape)===1)l=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(l=`
          ${Er(c)} coords = getOutputCoords();
        `,c===1)this.enableShapeUniforms?l+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:l+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const p=Do("coords",c);this.enableShapeUniforms?l+=`
            bool nextRowOutOfBounds =
              (${p[c-2]} + 1) >= outShape[${c} - 2];
            bool nextColOutOfBounds =
              (${p[c-1]} + 1) >= outShape[${c} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:l+=`
            bool nextRowOutOfBounds =
              (${p[c-2]} + 1) >= ${this.outputShape[c-2]};
            bool nextColOutOfBounds =
              (${p[c-1]} + 1) >= ${this.outputShape[c-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${l}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mi(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const S1e={kernelName:h_,backendName:"webgl",kernelFunc:mi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rl(t){const{inputs:e,backend:n}=t,{real:s,imag:i}=e,c=n.makeTensorInfo(s.shape,"complex64"),l=n.texData.get(c.dataId),d=mi({inputs:{x:s},backend:n}),p=mi({inputs:{x:i},backend:n});return l.complexTensorInfos={real:d,imag:p},c}const T1e={kernelName:yw,backendName:"webgl",kernelFunc:Rl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G8="return (a < 0.) ? b * a : a;",z8=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function I1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{alpha:c}=s,l=n.makeTensorInfo([],"float32",Sl(c,"float32")),d=De().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new fg(z8,i.shape,l.shape):new Lp(G8,i.shape,l.shape),p=n.runWebGLProgram(d,[i,l],"float32");return n.disposeIntermediateTensorInfo(l),p}const C1e={kernelName:Kw,backendName:"webgl",kernelFunc:I1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8="return (a < 0.) ? b * a : a;",K8=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function w1e(t){const{inputs:e,backend:n}=t,{x:s,alpha:i}=e,c=De().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new fg(K8,s.shape,i.shape):new Lp(H8,s.shape,i.shape);return n.runWebGLProgram(c,[s,i],"float32")}const R1e={kernelName:hR,backendName:"webgl",kernelFunc:w1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xp="if (isnan(x)) return x;";function On({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:i,backend:c})=>{const{x:l}=i,d=c,p=s||l.dtype;if(d.shouldExecuteOnCPU([l])&&n!=null){const _=d.texData.get(l.dataId),y=n(_.values,p);return d.makeTensorInfo(l.shape,p,y)}const f=De().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let m;return f?m=new gd(l.shape,e):m=new Kc(l.shape,t),d.runWebGLProgram(m,[l],p)}}function Ys({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:i,dtype:c}){return({inputs:l,backend:d})=>{const{a:p,b:f}=l,m=d;if(s&&p.dtype==="complex64"){const I=m.texData.get(p.dataId),b=m.texData.get(f.dataId),[A,R]=[[I.complexTensorInfos.real,b.complexTensorInfos.real],[I.complexTensorInfos.imag,b.complexTensorInfos.imag]].map(L=>{const[$,G]=L,H={dataId:$.dataId,dtype:$.dtype,shape:p.shape},Z={dataId:G.dataId,dtype:G.dtype,shape:f.shape},re=new Lp(t,p.shape,f.shape);return m.runWebGLProgram(re,[H,Z],pi($.dtype,G.dtype))}),O=Rl({inputs:{real:A,imag:R},backend:m});return m.disposeIntermediateTensorInfo(A),m.disposeIntermediateTensorInfo(R),O}const _=c||pi(p.dtype,f.dtype);if((p.dtype==="string"||f.dtype==="string"||m.shouldExecuteOnCPU([p,f]))&&i!=null){const I=m.texData.get(p.dataId).values,b=m.texData.get(f.dataId).values,A=p.dtype==="string"?Dd(I):I,R=p.dtype==="string"?Dd(b):b,[O,L]=i(p.shape,f.shape,A,R,_),$=m.makeTensorInfo(L,_),G=m.texData.get($.dataId);return G.values=O,$}const y=De().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let v;return y?v=new fg(e,p.shape,f.shape,n):v=new Lp(t,p.shape,f.shape),m.runWebGLProgram(v,[p,f],_)}}function Gm(t,e=!1){if(t==="linear")return e?a1e:n1e;if(t==="relu")return e?u1e:s1e;if(t==="elu")return e?c1e:r1e;if(t==="relu6")return e?l1e:o1e;if(t==="prelu")return e?K8:H8;if(t==="leakyrelu")return e?z8:G8;if(t==="sigmoid")return e?d1e:i1e;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q8{constructor(e,n,s,i=!1,c=!1,l=!1,d=null,p=!1,f=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Fo(this.outputShape.length);const m=i?e[1]:e[2],_=Math.ceil(m/2),y=i?"i * 2, rc.y":"rc.y, i * 2",v=c?"rc.z, i * 2":"i * 2, rc.z",I=i?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],b=c?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let A="",R="";d&&(p?A=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${d}
        }`:f?A=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${d}
        }`:A=`vec4 activation(vec4 x) {
          ${d}
        }`,R="result = activation(result);");const O=l?"result += getBiasAtOutCoords();":"";l&&this.variableNames.push("bias"),p&&this.variableNames.push("preluActivationWeights"),f&&this.variableNames.push("leakyreluAlpha");let L="rc.x",$="rc.x";e[0]<n[0]?L=`int(min(float(rc.x), ${e[0]-1}.))`:n[0]<e[0]&&($=`int(min(float(rc.x), ${n[0]-1}.))`),this.userCode=`
      ${A}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${_}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${_}; i++) {
          int batchA = ${L};
          int batchB = ${$};
          vec4 a = getMatrixA(batchA, ${y});
          vec4 b = getMatrixB(batchB, ${v});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${I[0]} * ${b[0]});
          result += (${I[1]} * ${b[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${O}

        ${R}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m$={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class g${constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Rn(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E$="return a * b;";function oN(t){const{inputs:e,backend:n}=t,{a:s,b:i}=e,c=pi(s.dtype,i.dtype);if(s.dtype==="complex64"){const d=n.texData.get(s.dataId),p=n.texData.get(i.dataId),f=new g$(m$.REAL,s.shape,i.shape),m=new g$(m$.IMAG,s.shape,i.shape),_=[{dataId:d.complexTensorInfos.real.dataId,dtype:d.complexTensorInfos.real.dtype,shape:s.shape},{dataId:d.complexTensorInfos.imag.dataId,dtype:d.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:p.complexTensorInfos.real.dataId,dtype:p.complexTensorInfos.real.dtype,shape:i.shape},{dataId:p.complexTensorInfos.imag.dataId,dtype:p.complexTensorInfos.imag.dtype,shape:i.shape}],y=n.runWebGLProgram(f,_,"float32"),v=n.runWebGLProgram(m,_,"float32"),I=Rl({inputs:{real:y,imag:v},backend:n});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),I}if(n.shouldExecuteOnCPU([s,i])){const d=n.texData.get(s.dataId),p=n.texData.get(i.dataId),[f,m]=b0e(s.shape,i.shape,d.values,p.values,c),_=n.makeTensorInfo(m,c),y=n.texData.get(_.dataId);return y.values=f,_}let l;return De().getBool("WEBGL_PACK_BINARY_OPERATIONS")?l=new fg(E$,s.shape,i.shape):l=new Lp(E$,s.shape,i.shape),n.runWebGLProgram(l,[s,i],c)}const b1e={kernelName:R_,backendName:"webgl",kernelFunc:oN};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N1e(t,e,n){const s=[Dp(t.shape),...Pp(t.shape)],i={dtype:t.dtype,shape:s,dataId:t.dataId},c=[Dp(e),...Pp(e)],l=new W8(c,s),d=!0,p=[s],f=n.runWebGLProgram(l,[i],t.dtype,p,d);return{dataId:f.dataId,shape:e,dtype:f.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mt(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{shape:c}=s,l=n,d=Pe(i.shape),p=HU(c,d),f=Pe(p);se(d===f,()=>`The new shape (${p}) has ${f} elements and the old shape (${i.shape}) has ${d} elements. The new shape and old shape must have the same number of elements.`);const m=l.texData.get(i.dataId);return m.isPacked&&!I1(i.shape,p)&&!(m.texture!==null&&I1(m.shape,p))?N1e(i,p,l):(l.incRef(i.dataId),{dataId:i.dataId,shape:p,dtype:i.dtype})}const A1e={kernelName:_R,backendName:"webgl",kernelFunc:mt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _${constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:i,inSize:c,outSize:l}=e;this.outputShape=[i,l];const d=Math.floor(s/4)*4,p=s%4;let f="sumValue += dot(values, ones);";if(n!=null){const _=1/n;f=`sumValue += dot(values * ${Cp(_)?_.toPrecision(2):_}, ones);`}let m="";c%s>0&&(m=`
        if (inIdx < 0 || inIdx >= ${c}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${d};
        if (${p===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${f}
        } else if (${p===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${f}
        } else if (${p===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${f}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O1e{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:i,inSize:c,outSize:l}=e;this.outputShape=[i,l];let d="0.0",p="";n==="prod"?d="1.0":n==="min"?(d="1.0 / 1e-20",p="min"):n==="max"&&(d="-1.0 / 1e-20",p="max");let f=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?f="sumValue":n==="prod"?f="prodValue":n==="all"?f="allValue":n==="any"&&(f="anyValue");const m=Math.floor(s/4)*4,_=s%4;let y=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${p}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${p}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,v="vec4";n==="all"?(d="1.0",y=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,v="bvec4"):n==="any"&&(d="0.0",y=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,v="bvec4");let I="";c%s>0&&(I=`
        if (inIdx < 0 || inIdx >= ${c}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${d};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${I}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${d});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${m}; i += 4) {
          int inIdx = inOffset + i;
          ${v} values = ${v}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${y}
        }

        int inIdx = inOffset + ${m};
        if (${_===1}) {
          ${v} values = ${v}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${y}
        } else if (${_===2}) {
          ${v} values = ${v}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${y}
        } else if (${_===3}) {
          ${v} values = ${v}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${y}
        }
        setOutput(${f});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x1e(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=ay(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function zd(t,e,n,s){const i=x1e(t.shape);let c=t;for(let l=0;l<i.length;l++){const{inSize:d,windowSize:p,outSize:f}=i[l];let m,_;n==="mean"?m=l===0?new _$({windowSize:p,inSize:d,batchSize:t.shape[0],outSize:f},d):new _$({windowSize:p,inSize:d,batchSize:t.shape[0],outSize:f}):m=new O1e({windowSize:p,inSize:d,batchSize:t.shape[0],outSize:f},n),_=c,c=s.runWebGLProgram(m,[c],e),_.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(_)}return c}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class k1e{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let l=0;l<s.length;l++)s[l]=e[n[l]];this.outputShape=s,this.rank=s.length;const i=Er(this.rank),c=D1e(n);this.userCode=`
    void main() {
      ${i} resRC = getOutputCoords();
      setOutput(getA(${c}));
    }
    `}}function D1e(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let i=0;i<t.length;i++)s[t[i]]=n[i];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P1e{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let m=0;m<s.length;m++)s[m]=e[n[m]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const i=Er(this.rank),c=j8("rc",this.rank),l=new Array(this.rank);for(let m=0;m<n.length;m++)l[n[m]]=c[m];const d=`vec2(${l.slice(-2).join()})`,p=`++${c[this.rank-1]} < ${s[this.rank-1]}`,f=`getChannel(getA(${l.join()}), ${d})`;this.userCode=`
    void main() {
      ${i} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${f};
      if(${p}) {
        result[1] = ${f};
      }
      --${c[this.rank-1]};
      if(++${c[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${f};
        if(${p}) {
          result[3] = ${f};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hy(t,e,n){const s=De().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new P1e(t.shape,e):new k1e(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L1e(t,e,n,s){const i=e,c=t.shape.length,l=$n(i,t.shape);let d=l;const p=ss(d,c),f=p!=null;let m=t;f&&(m=hy(t,p,s),d=os(d.length,c)),Xs("sum",d,c);const[_,y]=qs(m.shape,d);let v=_;n&&(v=Cs(_,l));const I=Pe(y),A=Pe(t.shape)/I,R=mt({inputs:{x:m},attrs:{shape:[A,I]},backend:s}),O=KR(t.dtype),L=zd(R,O,"sum",s),$=mt({inputs:{x:L},attrs:{shape:v},backend:s});return s.disposeIntermediateTensorInfo(R),s.disposeIntermediateTensorInfo(L),f&&s.disposeIntermediateTensorInfo(m),$}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function py(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,keepDims:l}=s;return L1e(i,c,l,n)}const M1e={kernelName:RR,backendName:"webgl",kernelFunc:py};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mo(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{perm:c}=s,l=n,d=i.shape.length,p=new Array(d);for(let m=0;m<p.length;m++)p[m]=i.shape[c[m]];let f;if(l.shouldExecuteOnCPU([i])){const _=l.texData.get(i.dataId).values,y=rN(_,i.shape,i.dtype,c,p);f=l.makeTensorInfo(p,i.dtype);const v=l.texData.get(f.dataId);v.values=y}else f=hy(i,c,l);return f}const $1e={kernelName:Em,backendName:"webgl",kernelFunc:Mo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X8=1e3;function C1({a:t,b:e,transposeA:n,transposeB:s,backend:i,bias:c=null,preluActivationWeights:l=null,leakyreluAlpha:d=0,activation:p=null}){const f=t.shape.length,m=e.shape.length,_=n?t.shape[f-2]:t.shape[f-1],y=s?e.shape[m-1]:e.shape[m-2],v=n?t.shape[f-1]:t.shape[f-2],I=s?e.shape[m-2]:e.shape[m-1],b=t.shape.slice(0,-2),A=e.shape.slice(0,-2),R=Pe(b),O=Pe(A),$=Rn(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([v,I]);se(_===y,()=>`Error in matMul: inner shapes (${_}) and (${y}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const G=n?[R,_,v]:[R,v,_],H=s?[O,I,y]:[O,y,I],Z=mt({inputs:{x:t},backend:i,attrs:{shape:G}}),re=mt({inputs:{x:e},backend:i,attrs:{shape:H}}),oe=[Z,re],ae=Math.max(R,O),Ee=n?Z.shape[1]:Z.shape[2],Ce=c!=null,ye=l!=null,we=p==="leakyrelu",Ae=p!=null?Gm(p,!0):null,Oe=Ce||ye||we||Ae!=null;let Me;if((v===1||I===1)&&Ee>X8&&Oe===!1){let Te=Z,ke=re;n&&(Te=Mo({inputs:{x:Z},backend:i,attrs:{perm:[0,2,1]}}),oe.push(Te)),s&&(ke=Mo({inputs:{x:re},backend:i,attrs:{perm:[0,2,1]}}),oe.push(ke));const Fe=I!==1,Xe=I===1;let Ye=Te;Fe&&(Ye=mt({inputs:{x:Te},backend:i,attrs:{shape:[ae,Ee,1]}}),oe.push(Ye));const tt=I===1?2:1;let et=ke;Xe&&(et=mt({inputs:{x:ke},backend:i,attrs:{shape:[ae,1,Ee]}}),oe.push(et));const nt=oN({inputs:{a:Ye,b:et},backend:i});Me=py({inputs:{x:nt},backend:i,attrs:{axis:tt,keepDims:!0}}),oe.push(nt)}else{const Te=pi(t.dtype,e.dtype),ke=new q8(G,H,[ae,v,I],n,s,Ce,Ae,ye,we),Fe=[Z,re];if(c!=null&&Fe.push(c),ye&&Fe.push(l),we){const Xe=i.makeTensorInfo([],"float32",Sl(d,"float32"));Fe.push(Xe),oe.push(Xe)}Me=i.runWebGLProgram(ke,Fe,Te)}const me=mt({inputs:{x:Me},backend:i,attrs:{shape:$}});oe.push(Me);for(const Te of oe)i.disposeIntermediateTensorInfo(Te);return me}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F1e(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:c,bias:l,preluActivationWeights:d}=e,{transposeA:p,transposeB:f,activation:m,leakyreluAlpha:_}=s;return C1({a:i,b:c,transposeA:p,transposeB:f,backend:n,bias:l,preluActivationWeights:d,leakyreluAlpha:_,activation:m})}const U1e={kernelName:r1,backendName:"webgl",kernelFunc:F1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y$="return abs(x);";function V1e(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const c=n.texData.get(s.dataId),l=V8(c.values);return n.makeTensorInfo(s.shape,s.dtype,l)}let i;return De().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new gd(s.shape,y$):i=new Kc(s.shape,y$),n.runWebGLProgram(i,[s],s.dtype)}const B1e={kernelName:aw,backendName:"webgl",kernelFunc:V1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j1e=Ca+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,W1e=On({opSnippet:j1e}),G1e={kernelName:G1,backendName:"webgl",kernelFunc:W1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z1e=Ca+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,H1e=On({opSnippet:z1e}),K1e={kernelName:z1,backendName:"webgl",kernelFunc:H1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v$="return a + b;",q1e=Ys({opSnippet:v$,packedOpSnippet:v$,supportsComplex:!0,cpuKernelImpl:a0e}),X1e={kernelName:eg,backendName:"webgl",kernelFunc:q1e};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Y1e{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((c,l)=>`T${l}`);const s=[];this.variableNames.forEach(c=>{s.push(`float v${c} = get${c}AtOutCoords();`)});const i=this.variableNames.map(c=>`v${c}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class J1e{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((c,l)=>`T${l}`);const s=[];this.variableNames.forEach(c=>{s.push(`vec4 v${c} = get${c}AtOutCoords();`)});const i=this.variableNames.map(c=>`v${c}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${i};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k0(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return mi({inputs:{x:s[0]},backend:n});if(s.length>De().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const p=Math.floor(s.length/2),f=k0({inputs:s.slice(0,p),backend:n}),m=k0({inputs:s.slice(p),backend:n});return k0({inputs:[f,m],backend:n})}const i=s.map(p=>p.dtype).reduce((p,f)=>pi(p,f)),c=s.map(p=>p.shape),d=De().getBool("WEBGL_PACK")?new J1e(s[0].shape,c):new Y1e(s[0].shape,c);return n.runWebGLProgram(d,s,i)}const Q1e={kernelName:cw,backendName:"webgl",kernelFunc:k0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z1e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,keepDims:l}=s,d=i.shape.length,p=$n(c,i.shape);let f=p;const m=ss(f,d);let _=i;m!=null&&(_=Mo({inputs:{x:i},backend:n,attrs:{perm:m}}),f=os(f.length,d)),Xs("all",f,d);const[y,v]=qs(_.shape,f),I=Pe(v),b=mt({inputs:{x:_},backend:n,attrs:{shape:[-1,I]}}),A=zd(b,b.dtype,"all",n);let R;if(l){const O=Cs(y,p);R=mt({inputs:{x:A},backend:n,attrs:{shape:O}})}else R=mt({inputs:{x:A},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(A),m!=null&&n.disposeIntermediateTensorInfo(_),R}const e_e={kernelName:uw,backendName:"webgl",kernelFunc:Z1e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,keepDims:l}=s,d=i.shape.length,p=$n(c,i.shape);let f=p;const m=ss(f,d);let _=i;m!=null&&(_=Mo({inputs:{x:i},backend:n,attrs:{perm:m}}),f=os(f.length,d)),Xs("any",f,d);const[y,v]=qs(_.shape,f),I=Pe(v),b=mt({inputs:{x:_},backend:n,attrs:{shape:[-1,I]}}),A=zd(b,b.dtype,"any",n);let R;if(l){const O=Cs(y,p);R=mt({inputs:{x:A},backend:n,attrs:{shape:O}})}else R=mt({inputs:{x:A},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(A),m!=null&&n.disposeIntermediateTensorInfo(_),R}const n_e={kernelName:lw,backendName:"webgl",kernelFunc:t_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r_e{constructor(e,n,s){this.variableNames=["A"];const{windowSize:i,batchSize:c,outSize:l}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[c,l];const d=n==="max"?">":"<",p=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${i};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${i}; i++) {
          int inIdx = ${p};
          float candidate = getA(batch, inIdx);
          if (candidate ${d} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class s_e{constructor(e,n,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,se(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const c=e[e.length-1],l=Math.ceil(c/n);this.outputShape=e.slice(0,-1),l>1&&this.outputShape.push(l),i||this.variableNames.push("bestIndicesA");const d=this.outputShape,p=d.length,f=Er(p),m=Do("coords",p);let _,y;if(l===1){y=p+1;const re=Er(y);_=`
        ${re} sourceLocR = ${re}(${m.join()}, 0);
        ++${m[p-1]};
        ${re} sourceLocG = ${re}(${m.join()}, 0);
        ++${m[p-2]};
        ${re} sourceLocA = ${re}(${m.join()}, 0);
        --${m[p-1]};
        ${re} sourceLocB = ${re}(${m.join()}, 0);
        --${m[p-2]};`}else y=p,_=`
        ${f} sourceLocR = coords;
        ++${m[p-1]};
        ${f} sourceLocG = coords;
        ++${m[p-2]};
        ${f} sourceLocA = coords;
        --${m[p-1]};
        ${f} sourceLocB = coords;
        --${m[p-2]};`;const v=["x","y","z","w","u","v"].slice(0,y),I="."+v[y-1],b=v.map(re=>"int "+re),A=Do("sourceLocR",y-1).concat("inIdx.r"),R=Do("sourceLocG",y-1).concat("inIdx.g"),O=Do("sourceLocB",y-1).concat("inIdx.b"),L=Do("sourceLocA",y-1).concat("inIdx.a"),$=s==="max"?"greaterThan":"lessThan",G=i?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${A.join()}),
                             getBestIndicesAChannel(${R.join()}),
                             getBestIndicesAChannel(${O.join()}),
                             getBestIndicesAChannel(${L.join()})));`,H=`vec4(
            getAChannel(${A.join()}),
            hasNextCol ? getAChannel(${R.join()}) : 0.,
            hasNextRow ? getAChannel(${O.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${L.join()}) : 0.)`,Z=i?"":`
      float getBestIndicesAChannel(${b.join()}) {
        return getChannel(getBestIndicesA(${v.join()}),
                                          vec2(${v.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${b.join()}) {
        return getChannel(getA(${v.join()}),
                               vec2(${v.slice(-2).join()}));
      }
      ${Z}
      void main() {
        ${f} coords = getOutputCoords();
        bool hasNextCol = ${m[p-1]} < ${d[p-1]-1};
        bool hasNextRow = ${m[p-2]} < ${d[p-2]-1};
        ${_}
        ivec4 srcIdx = ivec4(sourceLocR${I}, sourceLocG${I},
          sourceLocB${I}, sourceLocA${I}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${H};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${G}
          vec4 candidate = ${H};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${$}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y8(t,e,n,s=null){let i=e.shape[0],c=e.shape[1];s!=null&&(i=s.shape[0],c=s.shape[1]);const l=ay(c),d={windowSize:l,inSize:c,batchSize:i,outSize:Math.ceil(c/l)},p=new r_e(d,n,s==null),f=[e];s!=null&&f.push(s);const m=t.runWebGLProgram(p,f,"int32");if(m.shape[1]===1)return m;const _=Y8(t,e,n,m);return t.disposeIntermediateTensorInfo(m),_}function J8(t,e,n,s=null){const i=s!=null?s.shape:e.shape,c=i[i.length-1],l=ay(c),d=new s_e(i,l,n,s==null),p=s==null?[e]:[e,s],f=t.runWebGLProgram(d,p,"int32");if(f.shape.length===e.shape.length){const m=J8(t,e,n,f);return t.disposeIntermediateTensorInfo(f),m}return f}function Q8(t,e,n,s){const i=[n];if(Xs("arg"+s.charAt(0).toUpperCase()+s.slice(1),i,e.shape.length),!De().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const c=[],l=t.texData.get(e.dataId),d=l!==null&&l.isPacked;let p=e;d&&(p=t.unpackTensor(e),c.push(p));const[f,m]=qs(p.shape,i),_=Pe(m),y=mt({inputs:{x:p},backend:t,attrs:{shape:[-1,_]}});c.push(y);const v=Y8(t,y,s);c.push(v);const I=mt({inputs:{x:v},backend:t,attrs:{shape:f}});return c.forEach(b=>t.disposeIntermediateTensorInfo(b)),I}return J8(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c}=s;let l=$n(c,i.shape);const d=ss(l,i.shape.length);let p=i;const f=[];d!=null&&(p=Mo({inputs:{x:i},backend:n,attrs:{perm:d}}),f.push(p),l=os(l.length,p.shape.length)),Xs("argMax",[l[0]],p.shape.length);const m=Q8(n,p,l[0],"max");return f.forEach(_=>n.disposeIntermediateTensorInfo(_)),m}const i_e={kernelName:dw,backendName:"webgl",kernelFunc:o_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c}=s;let l=$n(c,i.shape);const d=ss(l,i.shape.length);let p=i;const f=[];d!=null&&(p=Mo({inputs:{x:i},backend:n,attrs:{perm:d}}),f.push(p),l=os(l.length,p.shape.length)),Xs("argMin",[l[0]],p.shape.length);const m=Q8(n,p,l[0],"min");return f.forEach(_=>n.disposeIntermediateTensorInfo(_)),m}const c_e={kernelName:hw,backendName:"webgl",kernelFunc:a_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u_e=Ca+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,l_e=On({opSnippet:u_e}),d_e={kernelName:H1,backendName:"webgl",kernelFunc:l_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h_e=Ca+"return log(x + sqrt(x * x + 1.0));",p_e=On({opSnippet:h_e}),f_e={kernelName:K1,backendName:"webgl",kernelFunc:p_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m_e=Ca+`
  return atan(x);
`,g_e=On({opSnippet:m_e}),E_e={kernelName:q1,backendName:"webgl",kernelFunc:g_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const __e=sN+`
  return atan(a, b);
`,y_e=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+pg+`
  return result;
`,v_e=Ys({opSnippet:__e,packedOpSnippet:y_e}),S_e={kernelName:Y1,backendName:"webgl",kernelFunc:v_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T_e=Ca+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,I_e=On({opSnippet:T_e}),C_e={kernelName:X1,backendName:"webgl",kernelFunc:I_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zm{constructor(e,n,s,i=!1,c=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const l=e.filterWidth,d=e.strideHeight,p=e.strideWidth,f=e.dilationHeight,m=e.dilationWidth,_=e.effectiveFilterHeight,y=e.effectiveFilterWidth,v=e.padInfo.top,I=e.padInfo.left;this.outputShape=e.outShape;const b=n==="avg",A=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,R=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let O="0.0";if(b||(O="-1.0 / 1e-20"),s){const re=">=";this.userCode=`
        const ivec2 strides = ivec2(${d}, ${p});
        const ivec2 pads = ivec2(${v}, ${I});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${_};
              wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${y};
                wC += ${m}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${re} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${i?c?A:R:`wR * ${y} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const L="max";let $=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&($="avgValue / count");const G=Math.floor(l/4)*4,H=l%4,Z=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${L}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${d}, ${p});
      const ivec2 pads = ivec2(${v}, ${I});
      const float initializationValue = ${O};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${O});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${_};
            wR += ${f}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${G}; wC += 4) {
            int xC = xCCorner + wC * ${m};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${m}, d),
              getValue(batch, xR, xC + 2 * ${m}, d),
              getValue(batch, xR, xC + 3 * ${m}, d)
            );

            ${Z}
          }

          int xC = xCCorner + ${G};
          if (${H===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${Z}
          } else if (${H===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${m}, d),
              initializationValue,
              initializationValue
            );

            ${Z}
          } else if (${H===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${m}, d),
              getValue(batch, xR, xC + 2 * ${m}, d),
              initializationValue
            );

            ${Z}
          }
        }
        setOutput(${$});
      }
    `}}class iN{constructor(e,n,s,i=!1,c=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const l=e.filterWidth,d=e.strideDepth,p=e.strideHeight,f=e.strideWidth,m=e.dilationDepth,_=e.dilationHeight,y=e.dilationWidth,v=e.effectiveFilterDepth,I=e.effectiveFilterHeight,b=e.effectiveFilterWidth,A=e.padInfo.front,R=e.padInfo.top,O=e.padInfo.left;this.outputShape=e.outShape;const L=n==="avg";let $="0.0";if(L||($="-1.0 / 1e-20"),s){const ae=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${d}, ${p}, ${f});
        const ivec3 pads = ivec3(${A}, ${R}, ${O});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${v};
              wD += ${m}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${I};
                wR += ${_}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${b};
                  wC += ${y}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${ae} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${i?c?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${I} * ${b} +
                      wR * ${b} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const G="max";let H=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(H="avgValue / count");const Z=Math.floor(l/4)*4,re=l%4,oe=`
      if (${L}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${G}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${d}, ${p}, ${f});
      const ivec3 pads = ivec3(${A}, ${R}, ${O});
      const float initializationValue = ${$};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${$});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${v};
            wD += ${m}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${I};
            wR += ${_}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${Z}; wC += 4) {
              int xC = xCCorner + wC * ${y};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${y}, ch),
                getValue(batch, xD, xR, xC + 2 * ${y}, ch),
                getValue(batch, xD, xR, xC + 3 * ${y}, ch)
              );

              ${oe}
            }

            int xC = xCCorner + ${Z};
            if (${re===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${oe}
            } else if (${re===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${y}, ch),
                initializationValue,
                initializationValue
              );

              ${oe}
            } else if (${re===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${y}, ch),
                getValue(batch, xD, xR, xC + 2 * ${y}, ch),
                initializationValue
              );

              ${oe}
            }
          }
          setOutput(${H});
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;dg(i,"avgPool");const{filterSize:c,strides:l,pad:d,dimRoundingMode:p}=s,f=1;se(ho(l,f),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${f}'`);const m=Ta(i.shape,c,l,f,d,p);if(m.filterWidth===1&&m.filterHeight===1&&Nr(m.inShape,m.outShape))return mi({inputs:{x:i},backend:n});const _=new zm(m,"avg",!1);return n.runWebGLProgram(_,[i],"float32")}const R_e={kernelName:pw,backendName:"webgl",kernelFunc:w_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:c,strides:l,pad:d,dimRoundingMode:p,dataFormat:f}=s,m=[1,1,1],_=au(i.shape,c,l,m,d,p,f),y=new iN(_,"avg",!1);return n.runWebGLProgram(y,[i],"float32")}const N_e={kernelName:fw,backendName:"webgl",kernelFunc:b_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A_e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,i=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,d=e.dilationWidth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=p-1-e.padInfo.top,_=f-1-e.padInfo.left,y=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${m}, ${_});
      const float avgMultiplier = float(${y});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p};
            wR += ${l}) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${f};
            wC+= ${d}) {
            float dyC = float(dyCCorner + wC) / ${c}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class O_e{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,i=e.filterWidth,c=e.strideDepth,l=e.strideHeight,d=e.strideWidth,p=e.dilationDepth,f=e.dilationHeight,m=e.dilationWidth,_=e.effectiveFilterDepth,y=e.effectiveFilterHeight,v=e.effectiveFilterWidth,I=_-1-e.padInfo.front,b=y-1-e.padInfo.top,A=v-1-e.padInfo.left,R=1/(n*s*i);this.userCode=`
      const ivec3 pads = ivec3(${I}, ${b}, ${A});
      const float avgMultiplier = float(${R});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${_};
            wD += ${p}) {
          float dyD = float(dyDCorner + wD) / ${c}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${y};
              wR += ${f}) {
            float dyR = float(dyRCorner + wR) / ${l}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${v};
                wC += ${m}) {
              float dyC = float(dyCCorner + wC) / ${d}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x_e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:c}=e,l=c,{filterSize:d,strides:p,pad:f,dimRoundingMode:m}=s,_=[1,1,1],y=au(l.shape,d,p,_,f,m),v=new O_e(y);return n.runWebGLProgram(v,[i],l.dtype)}const k_e={kernelName:e6,backendName:"webgl",kernelFunc:x_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D_e(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:c}=e,l=c;dg([i,c],"avgPoolGrad");const{filterSize:d,strides:p,pad:f}=s,m=Ta(l.shape,d,p,1,f),_=new A_e(m);return n.runWebGLProgram(_,[i],l.dtype)}const P_e={kernelName:ZU,backendName:"webgl",kernelFunc:D_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L_e(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:c}=e,{transposeA:l,transposeB:d}=s;return C1({a:i,b:c,transposeA:l,transposeB:d,backend:n})}const M_e={kernelName:mw,backendName:"webgl",kernelFunc:L_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $_e{constructor(e,n,s,i,c,l){this.outputShape=[],this.variableNames=["x","mean","variance"],Rn(e,n),Rn(e,s);let d="0.0";i!=null&&(Rn(e,i),this.variableNames.push("offset"),d="getOffsetAtOutCoords()");let p="1.0";c!=null&&(Rn(e,c),this.variableNames.push("scale"),p="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${d};
        float scale = ${p};
        float inv = scale * inversesqrt(variance + float(${l}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F_e{constructor(e,n,s,i,c,l){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Rn(e,n),Rn(e,s);let d="vec4(0.0)";i!=null&&(Rn(e,i),this.variableNames.push("offset"),d="getOffsetAtOutCoords()");let p="vec4(1.0)";c!=null&&(Rn(e,c),this.variableNames.push("scale"),p="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${d};
        vec4 scale = ${p};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${l}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U_e=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:i,variance:c,offset:l,scale:d}=t;se(i.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),se(l==null||i.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),se(d==null||i.shape.length===d.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:p}=n;p==null&&(p=.001);const f=[s,i,c];let m=null;l!=null&&(m=l.shape,f.push(l));let _=null;d!=null&&(_=d.shape,f.push(d));const y=De().getBool("WEBGL_PACK_NORMALIZATION")?new F_e(s.shape,i.shape,c.shape,m,_,p):new $_e(s.shape,i.shape,c.shape,m,_,p);return e.runWebGLProgram(y,f,f[0].dtype)},V_e={kernelName:jw,backendName:"webgl",kernelFunc:U_e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B_e{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=Er(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=j_e(this.rank);let i;const c=e.map((l,d)=>`sourceLoc.${iC[d]} = start[${d}] + coords.${iC[d]};`);i=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${c.join(`
`)}
      `,this.userCode=`
      void main() {
        ${i}
        setOutput(getSource(${s}));
      }
    `}}const iC=["x","y","z","w","u","v"];function j_e(t){if(t===1)return"sourceLoc";if(t<=6)return iC.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class W_e{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=Er(this.rank),s=Do("coords",this.rank),i=Do("sourceLoc",this.rank),c=this.rank===1?"sourceLoc":`vec2(${i.slice(-2).join()})`,l=`getChannel(getSource(${i.join()}), ${c})`,d=`
      result.x = ${l};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${i[this.rank-1]};
        result.y = ${l};
        --${i[this.rank-1]};
      }
    `,p=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${i[this.rank-2]};
        result.z = ${l};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${i[this.rank-1]};
          result.w = ${l};
        }
      }
    `,f=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((m,_)=>`start[${_}]`).join()});`:e.map((m,_)=>`${i[_]} = ${s[_]} + start[${_}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${f}
        vec4 result = vec4(0.);
        ${d}
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G_e(t,e,n,s){const i=s.texData.get(t.dataId),c=s.makeTensorInfo(n,t.dtype),l=s.texData.get(c.dataId);Object.assign(l,i),l.refCount=1,l.shape=n,l.dtype=t.dtype;let d=rb(e,Pt(t.shape));i.slice&&(d+=i.slice.flatOffset),l.slice={flatOffset:d,origDataId:i.slice&&i.slice.origDataId||t.dataId};const p=s.dataRefCount.get(l.slice.origDataId)||1;return s.dataRefCount.set(l.slice.origDataId,p+1),c}function Yp(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:c,size:l}=s,[d,p]=sb(i,c,l);if(eb(i,d,p),Pe(p)===0)return n.makeTensorInfo(p,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||i.dtype==="string"){const _=n.texData.get(i.dataId),y=$0e(_.values,d,p,i.shape,i.dtype);return n.makeTensorInfo(p,i.dtype,y)}const{isPacked:f}=n.texData.get(i.dataId),m=nb(i.shape,d,p);if(f||!m){const _=De().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new W_e(p):new B_e(p),y=[d];return n.runWebGLProgram(_,[i],i.dtype,y)}return n.uploadToGPU(i.dataId),G_e(i,d,p,n)}const z_e={kernelName:wR,backendName:"webgl",kernelFunc:Yp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H_e=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:c,crops:l}=s;se(i.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const d=c.reduce((O,L)=>O*L),p=ig(i.shape,c,d),f=ag(p.length,c.length),m=cg(i.shape,c,d),_=wb(l,c.length),y=Rb(m,l,c.length),v=[],I=mt({inputs:{x:i},backend:n,attrs:{shape:p}}),b=Mo({inputs:{x:I},backend:n,attrs:{perm:f}}),A=mt({inputs:{x:b},backend:n,attrs:{shape:m}}),R=Yp({inputs:{x:A},backend:n,attrs:{begin:_,size:y}});return v.push(I),v.push(b),v.push(A),v.forEach(O=>n.disposeIntermediateTensorInfo(O)),R},K_e={kernelName:gw,backendName:"webgl",kernelFunc:H_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q_e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:c}=e,{size:l}=s,d=n.readSync(i.dataId),p=n.readSync(c.dataId),f=U8(d,p,c.dtype,c.shape,l);return n.makeTensorInfo([l],c.dtype,f)}const X_e={kernelName:Ew,backendName:"webgl",kernelFunc:q_e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y_e(t){const{inputs:e,backend:n}=t,{s0:s,s1:i}=e,c=n.readSync(s.dataId),l=n.readSync(i.dataId),d=Rn(Array.from(c),Array.from(l));return n.makeTensorInfo([d.length],"int32",Int32Array.from(d))}const J_e={kernelName:_w,backendName:"webgl",kernelFunc:Y_e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q_e="return float(a != b);",Z8=Ys({opSnippet:Q_e,cpuKernelImpl:A0e,dtype:"bool"}),Z_e={kernelName:b_,backendName:"webgl",kernelFunc:Z8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mg(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.texData.get(s.dataId);return mi({inputs:{x:i.complexTensorInfos.real},backend:n})}const eye={kernelName:ER,backendName:"webgl",kernelFunc:mg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tye="return float(int(x));";function nye(t,e){const n=new Kc(t.shape,tye),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aC(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dtype:c}=s;if(c==="complex64"){if(i.dtype==="complex64")return mi({inputs:{x:i},backend:n});const l=xd(i.shape),d=aC({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),p=Rl({inputs:{real:d,imag:l},backend:n});return l.dispose(),n.disposeIntermediateTensorInfo(d),p}if(i.dtype==="complex64"){const l=mg({inputs:{input:i},backend:n}),d=aC({inputs:{x:l},backend:n,attrs:{dtype:c}});return n.disposeIntermediateTensorInfo(l),d}if(!KU(i.dtype,c)){const l=mi({inputs:{x:i},backend:n});return{dataId:l.dataId,shape:l.shape,dtype:c}}if(n.shouldExecuteOnCPU([i])){const l=n.texData.get(i.dataId).values,[d,p,f]=u0e(l,i.shape,i.dtype,c);return n.makeTensorInfo(d,p,f)}if(c==="int32")return nye(i,n);if(c==="bool"){const l=n.makeTensorInfo([],"bool",Ms("bool",1)),p=Z8({inputs:{a:i,b:l},backend:n});return n.disposeIntermediateTensorInfo(l),p}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${c}`)}const rye={kernelName:J1,backendName:"webgl",kernelFunc:aC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S$="return ceil(x);",sye=On({opSnippet:S$,packedOpSnippet:S$,cpuKernelImpl:l0e}),oye={kernelName:Q1,backendName:"webgl",kernelFunc:sye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iye{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aye{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{clipValueMin:c,clipValueMax:l}=s;let d;De().getBool("WEBGL_PACK_CLIP")?d=new aye(i.shape):d=new iye(i.shape);const p=[[c],[l]];return n.runWebGLProgram(d,[i],i.dtype,p)}const uye={kernelName:Z1,backendName:"webgl",kernelFunc:cye};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lye{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T$(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function dye(t){const{inputs:e,backend:n}=t,{x:s}=e,i=n.texData.get(s.dataId),c=new lye(s.shape),l=[T$(s,i.complexTensorInfos.real),T$(s,i.complexTensorInfos.imag)];return n.runWebGLProgram(c,l,l[0].dtype)}const hye={kernelName:vw,backendName:"webgl",kernelFunc:dye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pye{constructor(e){this.outputShape=[],this.outputShape=vc(e,1),this.variableNames=e.map((l,d)=>`T${d}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let l=1;l<n.length;l++)n[l]=n[l-1]+e[l][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let l=1;l<n.length;l++){const d=n[l-1];s.push(`else if (yC < ${n[l]}) setOutput(getT${l}(yR, yC-${d}));`)}const i=n.length,c=n[n.length-1];s.push(`else setOutput(getT${i}(yR, yC-${c}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fye{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=vc(e,n);const s=this.outputShape,i=s.length,c=Er(i),l=Do("coords",i),d=["x","y","z","w","u","v"].slice(0,i);this.variableNames=e.map((b,A)=>`T${A}`);const p=new Array(e.length-1);p[0]=e[0][n];for(let b=1;b<p.length;b++)p[b]=p[b-1]+e[b][n];const f=d[n],m=d.slice(-2),_=d.join();let y=`if (${f} < ${p[0]}) {
        return getChannel(
            getT0(${_}), vec2(${m.join()}));
        }`;for(let b=1;b<p.length;b++){const A=p[b-1];y+=`
        if (${f} < ${p[b]}  && ${f} >= ${p[b-1]}) {
          return getChannel(
            getT${b}(${f0(d,f,A)}),
            vec2(${f0(m,f,A)}));
        }`}const v=p.length,I=p[p.length-1];y+=`
        return getChannel(
          getT${v}(${f0(d,f,I)}),
          vec2(${f0(m,f,I)}));`,this.userCode=`
      float getValue(${d.map(b=>"int "+b)}) {
        ${y}
      }

      void main() {
        ${c} coords = getOutputCoords();
        vec4 result = vec4(getValue(${l}), 0., 0., 0.);

        ${l[i-1]} = ${l[i-1]} + 1;
        if (${l[i-1]} < ${s[i-1]}) {
          result.g = getValue(${l});
        }

        ${l[i-2]} = ${l[i-2]} + 1;
        if (${l[i-2]} < ${s[i-2]}) {
          result.a = getValue(${l});
        }

        ${l[i-1]} = ${l[i-1]} - 1;
        if (${l[i-2]} < ${s[i-2]} &&
            ${l[i-1]} < ${s[i-1]}) {
          result.b = getValue(${l});
        }
        setOutput(result);
      }
    `}}function f0(t,e,n){const s=t.indexOf(e);return t.map((c,l)=>l===s?`${c} - ${n}`:c).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fy(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.texData.get(s.dataId);return mi({inputs:{x:i.complexTensorInfos.imag},backend:n})}const mye={kernelName:Hw,backendName:"webgl",kernelFunc:fy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function am(t,e,n){const s=t[0].dtype;if(s==="complex64"){const _=t.map(A=>mg({inputs:{input:A},backend:n})),y=t.map(A=>fy({inputs:{input:A},backend:n})),v=am(_,e,n),I=am(y,e,n),b=Rl({inputs:{real:v,imag:I},backend:n});return _.forEach(A=>n.disposeIntermediateTensorInfo(A)),y.forEach(A=>n.disposeIntermediateTensorInfo(A)),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(I),b}let i=n.shouldExecuteOnCPU(t);if(s==="string"&&(i=!0),i){const _=t.map(O=>{const $=[-1,Pe(O.shape.slice(e))];return mt({inputs:{x:O},backend:n,attrs:{shape:$}})}),y=_.map(O=>({vals:n.readSync(O.dataId),shape:O.shape})),v=vc(_.map(O=>O.shape),1),I=_[0].shape[0]===1,b=d0e(y,v,s,I),A=vc(t.map(O=>O.shape),e),R=n.makeTensorInfo(A,s,b);return _.forEach(O=>n.disposeIntermediateTensorInfo(O)),R}const c=De().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(t.length>c){const _=[];for(let v=0;v<t.length;v+=c){const I=t.slice(v,v+c);_.push(am(I,e,n))}const y=am(_,e,n);for(const v of _)n.disposeIntermediateTensorInfo(v);return y}if(De().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){const _=new fye(t.map(y=>y.shape),e);return n.runWebGLProgram(_,t,s)}const{tensors2D:l,outShape:d}=gye(t,e,n),p=new pye(l.map(_=>_.shape)),f=n.runWebGLProgram(p,l,s);l.forEach(_=>n.disposeIntermediateTensorInfo(_));const m=mt({inputs:{x:f},attrs:{shape:d},backend:n});return n.disposeIntermediateTensorInfo(f),m}function gye(t,e,n){const s=vc(t.map(c=>c.shape),e);return{tensors2D:t.map(c=>mt({inputs:{x:c},attrs:{shape:[-1,Pe(c.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s,c=$n(i,e[0].shape)[0],l=e.map(f=>f.shape);Tb(l,c);const d=vc(e.map(f=>f.shape),c);if(Pe(d)===0)return n.makeTensorInfo(d,e[0].dtype,[]);const p=e.filter(f=>Pe(f.shape)>0);return p.length===1?mi({inputs:{x:p[0]},backend:n}):am(p,c,n)}const Eye={kernelName:Sw,backendName:"webgl",kernelFunc:eB};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tB{constructor(e,n=!1,s=null,i=!1,c=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const l=e.padInfo.top,d=e.padInfo.left,p=e.strideHeight,f=e.strideWidth,m=e.dilationHeight,_=e.dilationWidth,y=e.filterHeight,v=e.filterWidth,I=Math.floor(e.inChannels/4)*4,b=e.inChannels%4,A=e.dataFormat==="channelsLast",R=A?1:2,O=A?2:3,L=A?3:1;let $="",G="";s&&(i?$=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:c?$=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:$=`
          float activation(float x) {
            ${s}
          }
        `,G="result = activation(result);");const H=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${$}

      const ivec2 strides = ivec2(${p}, ${f});
      const ivec2 pads = ivec2(${l}, ${d});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${L}];

        ivec2 xRCCorner =
            ivec2(coords[${R}], coords[${O}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${y}; wR++) {
          int xR = xRCorner + wR * ${m};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${v}; wC++) {
            int xC = xCCorner + wC * ${_};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${I}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${A}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${b===1}) {

              if (${A}) {
                dotProd +=
                    getX(batch, xR, xC, ${I}) *
                    getW(wR, wC, ${I}, d2);
              } else {
                dotProd +=
                    getX(batch, ${I}, xR, xC) *
                    getW(wR, wC, ${I}, d2);
              }

            } else if (${b===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${I}, d2),
                getW(wR, wC, ${I} + 1, d2)
              );

              if (${A}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${I}),
                  getX(batch, xR, xC, ${I} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${I}, xR, xC),
                  getX(batch, ${I} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${b===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${I}, d2),
                getW(wR, wC, ${I} + 1, d2),
                getW(wR, wC, ${I} + 2, d2)
              );

              if (${A}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${I}),
                  getX(batch, xR, xC, ${I} + 1),
                  getX(batch, xR, xC, ${I} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${I}, xR, xC),
                  getX(batch, ${I} + 1, xR, xC),
                  getX(batch, ${I} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${H}
        ${G}
        setOutput(result);
      }
    `}}class _ye{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,i=e.padInfo.left,c=e.strideDepth,l=e.strideHeight,d=e.strideWidth,p=e.dilationDepth,f=e.dilationHeight,m=e.dilationWidth,_=e.filterDepth,y=e.filterHeight,v=e.filterWidth,I=Math.floor(e.inChannels/4)*4,b=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${c}, ${l}, ${d});
      const ivec3 pads = ivec3(${n}, ${s}, ${i});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${_}; wF++) {
          int xF = xFCorner + wF * ${p};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${y}; wR++) {
            int xR = xRCorner + wR * ${f};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${v}; wC++) {
              int xC = xCCorner + wC * ${m};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${I}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${b===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${I}) *
                  getW(wF, wR, wC, ${I}, d2);
              } else if (${b===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${I}),
                  getX(batch, xF, xR, xC, ${I} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${I}, d2),
                  getW(wF, wR, wC, ${I} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${b===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${I}),
                  getX(batch, xF, xR, xC, ${I} + 1),
                  getX(batch, xF, xR, xC, ${I} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${I}, d2),
                  getW(wF, wR, wC, ${I} + 1, d2),
                  getW(wF, wR, wC, ${I} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nB{constructor(e,n=!1,s=null,i=!1,c=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Fo(this.outputShape.length);const l=e.padInfo.left,d=e.strideWidth,p=e.dilationWidth,f=e.filterHeight,m=e.filterWidth,_=m;let y=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let A=0;A<m;A++)y+=`
           vec4 xTexelC${A*2};
           int xTexelC${A*2}Ready;
           vec4 xTexelC${A*2+1};
           int xTexelC${A*2+1}Ready;
           vec4 xC${A};`;y+=`
     for (int r = 0; r < ${f}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let A=0;A<m;A++)y+=`
           xTexelC${A*2} = vec4(0.0);
           xTexelC${A*2}Ready = 0;
           xTexelC${A*2+1} = vec4(0.0);
           xTexelC${A*2+1}Ready = 0;
           xC${A} = vec4(0.0);`;y+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let A=0;A<(_+1)/2;A++){const R=A*2;if(y+=`
           xC = xCCorner + ${R*p};
           `,d===1){if(R<m&&(l%2===1?(y+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${R}Ready == 0) {
                   xTexelC${R} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${R}.zw = vec2(0.0);
                   }
                   xTexelC${R}Ready = 1;
                 }
               `,p===1&&R>0?y+=`
                 xC${R} = vec4(xTexelC${R-2}.zw, xTexelC${R}.xy);
                 `:y+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${R} = vec4(previous.zw, xTexelC${R}.xy);
                   } else {
                     xC${R} = vec4(0.0, 0.0, xTexelC${R}.xy);
                   }
                   `):y+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${R}Ready == 0) {
                   xTexelC${R} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${R}.zw = vec2(0.0);
                   }
                   xTexelC${R}Ready = 1;
                 }

                 xC${R} = xTexelC${R};
                 `,R+1<m)){const O=l%2===0?sw(p):p;p%2===0&&l%2===1||p%2!==0&&l%2!==1?(y+=`
                   xCOffset = xC + imod(pads[1], 2) + ${O};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${R+1}Ready == 0) {
                     xTexelC${R+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${R+1}.zw = vec2(0.0);
                     }
                     xTexelC${R+1}Ready = 1;
                   }
                   `,p>1?y+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${R+1} = vec4(previous.zw, xTexelC${R+1}.xy);
                     } else {
                      xC${R+1} = vec4(0.0, 0.0, xTexelC${R+1}.xy);
                     }
                     `:y+=`
                     xC${R+1} = vec4(xTexelC${R}.zw, xTexelC${R+1}.xy);
                     `):O===1?y+=`
                     xC${R+1} = xTexelC${R};
                     `:y+=`
                     xCOffset = xC + ${O};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${R+1}Ready == 0) {
                       xTexelC${R+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${R+1}.zw = vec2(0.0);
                       }
                       xTexelC${R+1}Ready = 1;
                     }

                     xC${R+1} = xTexelC${R+1};
                     `}}else R<m&&(l%2===1?(y+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${R}Ready == 0) {
                   xTexelC${R} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${R}.zw = vec2(0.0);
                   }
                   xTexelC${R}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${R+1}Ready == 0) {
                   xTexelC${R+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${R+1}.zw = vec2(0.0);
                   }
                   xTexelC${R+1}Ready = 1;
                 }

                 xC${R} = vec4(xTexelC${R}.zw, xTexelC${R+1}.zw);
               `,R+1<m&&(y+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${R+1} = vec4(xTexelC${R+1}.xy, final.xy);
                 `)):(y+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${R}Ready == 0) {
                   xTexelC${R} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${R}.zw = vec2(0.0);
                   }
                   xTexelC${R}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${R+1}Ready == 0) {
                   xTexelC${R+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${R+1}.zw = vec2(0.);
                   }
                   xTexelC${R+1}Ready = 1;
                 }

                 xC${R} = vec4(
                   xTexelC${R}.xy, xTexelC${R+1}.xy);
               `,R+1<m&&(y+=`
                   xC${R+1} = vec4(xTexelC${R}.zw, xTexelC${R+1}.zw);
                 `)));R<m&&(y+=`
             wTexel = getW(r, ${R}, d1, d2);
             dotProd += xC${R}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${R}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,R+1<m&&(y+=`
               wTexel = getW(r, ${R+1}, d1, d2);
               dotProd += xC${R+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${R+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}y+=`
     }
   `,y+=`
     }
   `,y+=`
     }
   `;let v="",I="";s&&(i?v=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:c?v=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:v=`vec4 activation(vec4 x) {
           ${s}
         }`,I="result = activation(result);");const b=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${v}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${y}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${b}
         ${I}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yye{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Fo(this.outputShape.length);const{dataFormat:s}=n,i=$o(),c=s==="channelsLast",l=c?1:2,d=c?2:3,p=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let f="";for(let m=0;m<=1;m++)for(let _=0;_<=1;_++)f+=`
          blockIndex = rc.z + ${_};
          pos = rc.y + ${m};

          ${p}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${l}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${d}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${c}) {
                  innerDims = vec2(d1, ch);
                  result[${m*2+_}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${m*2+_}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${f}

        ${i.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w1(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function rB({x:t,filter:e,convInfo:n,backend:s,bias:i=null,preluActivationWeights:c=null,leakyreluAlpha:l=0,activation:d=null}){const p=t.shape,f=s.texData.get(t.dataId),m=n.inChannels,_=p[0]*p[1]*p[2],y=n.outChannels,v=n.dataFormat==="channelsLast",I=!1,b=!1;let A;const R=[];if(c!=null){const $=w1(c.shape,v);$!=null&&(c=mt({inputs:{x:c},backend:s,attrs:{shape:$}}),R.push(c))}if(i!=null){const $=w1(i.shape,v);$!=null&&(i=mt({inputs:{x:i},backend:s,attrs:{shape:$}}),R.push(i))}if(!((_===1||y===1)&&m>X8)&&f.isPacked&&v&&f.texture!=null&&p[2]%2!==0&&Nr(f.shape.slice(-3),p.slice(-3))){const $=p[0]*p[1]*(p[2]+1),G={dataId:t.dataId,shape:[1,$,n.inChannels],dtype:t.dtype},H=f.shape;f.shape=f.shape.slice(),f.shape[f.shape.length-2]++,se(I1(f.shape,G.shape),()=>`packed reshape ${f.shape} to ${G.shape} isn't free`);const Z=mt({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});R.push(Z);const re=C1({a:G,b:Z,backend:s,transposeA:I,transposeB:b,bias:i,activation:d,preluActivationWeights:c,leakyreluAlpha:l}),oe=s.texData.get(re.dataId);se(oe.isPacked,()=>"batchMatMul result is expected to be packed"),f.shape=H,oe.shape=n.outShape,A=mi({inputs:{x:re},backend:s}),A.shape=n.outShape,R.push(re)}else{const $=n.outHeight*n.outWidth,G=mt({inputs:{x:t},backend:s,attrs:{shape:v?[n.batchSize,$,n.inChannels]:[n.batchSize,n.inChannels,$]}}),H=mt({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),Z=C1({a:v?G:H,b:v?H:G,transposeA:!v,transposeB:b,backend:s,bias:i,activation:d,preluActivationWeights:c,leakyreluAlpha:l});A=mt({inputs:{x:Z},backend:s,attrs:{shape:n.outShape}}),R.push(G),R.push(H),R.push(Z)}for(const $ of R)s.disposeIntermediateTensorInfo($);return A}function sB({x:t,filter:e,convInfo:n,backend:s,bias:i=null,preluActivationWeights:c=null,leakyreluAlpha:l=0,activation:d=null}){const{filterWidth:p,filterHeight:f,inChannels:m,outWidth:_,outHeight:y,dataFormat:v}=n,I=v==="channelsLast",b=p*f*m,A=y*_,R=[n.batchSize,b,A],O=!0,L=!1,$=[];if(c!=null){const me=w1(c.shape,I);me!=null&&(c=mt({inputs:{x:c},backend:s,attrs:{shape:me}}),$.push(c))}if(i!=null){const me=w1(i.shape,I);me!=null&&(i=mt({inputs:{x:i},backend:s,attrs:{shape:me}}),$.push(i))}const G=mt({inputs:{x:e},backend:s,attrs:{shape:[1,b,Pe(e.shape)/b]}});$.push(G);const H=new yye(R,n),Z=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],re=s.runWebGLProgram(H,[t],"float32",Z),oe=mt({inputs:{x:re},backend:s,attrs:{shape:R}});$.push(re),$.push(oe);const ae=i!=null,Ee=c!=null,Ce=d==="leakyrelu",ye=d?Gm(d,!0):null,we=new q8(I?oe.shape:G.shape,I?G.shape:oe.shape,I?[n.batchSize,A,n.outChannels]:[n.batchSize,n.outChannels,A],O,L,ae,ye,Ee,Ce),Ae=I?[oe,G]:[G,oe];if(i&&Ae.push(i),Ee&&Ae.push(c),Ce){const me=s.makeTensorInfo([],"float32",Sl(l,"float32"));Ae.push(me),$.push(me)}const Oe=s.runWebGLProgram(we,Ae,"float32"),Me=mt({inputs:{x:Oe},backend:s,attrs:{shape:n.outShape}});$.push(Oe);for(const me of $)s.disposeIntermediateTensorInfo(me);return Me}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:c}=e,{strides:l,pad:d,dataFormat:p,dilations:f,dimRoundingMode:m}=s,_=cu(p),y=$s(i.shape,c.shape,l,f,d,m,!1,_);let v;if(y.filterHeight===1&&y.filterWidth===1&&y.dilationHeight===1&&y.dilationWidth===1&&y.strideHeight===1&&y.strideWidth===1&&(y.padInfo.type==="SAME"||y.padInfo.type==="VALID"))v=rB({x:i,filter:c,convInfo:y,backend:n});else if(y.strideWidth<=2&&_==="channelsLast"&&De().getBool("WEBGL_EXP_CONV")){const b=new nB(y),A=[[y.padInfo.top,y.padInfo.left],[y.strideHeight,y.strideWidth],[y.dilationHeight,y.dilationWidth],[y.inHeight,y.inWidth]];v=n.runWebGLProgram(b,[i,c],"float32",A)}else if(De().getBool("WEBGL_CONV_IM2COL"))v=sB({x:i,filter:c,convInfo:y,backend:n});else{const b=new tB(y);v=n.runWebGLProgram(b,[i,c],"float32")}const I=mt({inputs:{x:v},backend:n,attrs:{shape:y.outShape}});return n.disposeIntermediateTensorInfo(v),I}const Sye={kernelName:Tw,backendName:"webgl",kernelFunc:vye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tye{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,i=e.padInfo.top,c=e.padInfo.left,l=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${c};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              if (${l}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Iye{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,i=e.strideHeight,c=e.strideWidth,l=e.dataFormat==="channelsLast",d=n-1-e.padInfo.top,p=s-1-e.padInfo.left,f=l?1:2,m=l?2:3,_=l?3:1;this.userCode=`
      const ivec2 pads = ivec2(${d}, ${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${_}];

        ivec2 dyCorner = ivec2(coords[${f}], coords[${m}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${c}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${l}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Cye{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,i=e.strideWidth,c=e.padInfo.front,l=e.padInfo.top,d=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${c};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${l};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${i} - ${d};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class wye{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,i=e.filterWidth,c=e.strideDepth,l=e.strideHeight,d=e.strideWidth,p=n-1-e.padInfo.front,f=s-1-e.padInfo.top,m=i-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${p}, ${f}, ${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${c}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${l}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${i}; wC++) {
              float dyC = float(dyCCorner + wC) / ${d}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${i} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:c}=e,{strides:l,pad:d,dataFormat:p,dimRoundingMode:f,filterShape:m}=s,_=cu(p),y=$s(i.shape,m,l,1,d,f,!1,_),v=new Tye(y);return n.runWebGLProgram(v,[i,c],"float32")}const bye={kernelName:Iw,backendName:"webgl",kernelFunc:Rye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nye(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:c}=e,{inputShape:l,strides:d,pad:p,dataFormat:f,dimRoundingMode:m}=s,_=cu(f),y=$s(l,c.shape,d,1,p,m,!1,_),v=new Iye(y);return n.runWebGLProgram(v,[i,c],"float32")}const Aye={kernelName:Cw,backendName:"webgl",kernelFunc:Nye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:c}=e,{strides:l,pad:d,dilations:p}=s,f=Cl(i.shape,c.shape,l,p,d),m=new _ye(f);return n.runWebGLProgram(m,[i,c],"float32")}const xye={kernelName:ww,backendName:"webgl",kernelFunc:Oye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:c}=e,{strides:l,pad:d,filterShape:p}=s,f=Cl(i.shape,p,l,1,d),m=new Cye(f);return n.runWebGLProgram(m,[i,c],"float32")}const Dye={kernelName:t6,backendName:"webgl",kernelFunc:kye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pye(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:c}=e,{pad:l,strides:d,inputShape:p}=s,f=Cl(p,c.shape,d,1,l),m=new wye(f);return n.runWebGLProgram(m,[i,c],"float32")}const Lye={kernelName:Rw,backendName:"webgl",kernelFunc:Pye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mye=Xp+`
  return cos(x);
`,$ye=On({opSnippet:Mye}),Fye={kernelName:e_,backendName:"webgl",kernelFunc:$ye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uye=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Vye=On({opSnippet:Uye}),Bye={kernelName:t_,backendName:"webgl",kernelFunc:Vye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jye{constructor(e,n,s,i,c){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[l,d,p,f]=e,[m]=n,[_,y]=s;this.outputShape=[m,_,y,f];const v=i==="bilinear"?1:0,[I,b]=[`${d-1}.0`,`${p-1}.0`],[A,R,O]=_>1?[`${(d-1)/(_-1)}`,"(y2-y1) * height_ratio",`y1*${I} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${I}`],[L,$,G]=y>1?[`${(p-1)/(y-1)}`,"(x2-x1) * width_ratio",`x1*${b} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${b}`];this.userCode=`
      const float height_ratio = float(${A});
      const float width_ratio = float(${L});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${l}) {
          return;
        }

        float height_scale = ${R};
        float width_scale = ${$};

        float in_y = ${O};
        if( in_y < 0.0 || in_y > ${I} ) {
          setOutput(float(${c}));
          return;
        }
        float in_x = ${G};
        if( in_x < 0.0 || in_x > ${b} ) {
          setOutput(float(${c}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${v} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wye=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:i,boxes:c,boxInd:l}=e,{cropSize:d,method:p,extrapolationValue:f}=s,m=new jye(i.shape,c.shape,d,p,f);return n.runWebGLProgram(m,[i,c,l],"float32")},Gye={kernelName:Aw,backendName:"webgl",kernelFunc:Wye};var Hm;(function(t){t.Prod="*",t.Sum="+"})(Hm||(Hm={}));class I${constructor(e,n,s,i){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const c=this.outputShape.length,l=this.op===Hm.Prod?"1.0":"0.0",d=s?l:`getX(${C$(c,"coords",this.op)})`,p=this.outputShape[this.outputShape.length-1];let f="",m="";s?(f=i?`end != ${p-1}`:"end != 0",m=i?"end + 1":"end - 1"):(f=i?`end + pow2 < ${p}`:"end >= pow2",m=i?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Er(c)} coords = getOutputCoords();
        int end = ${w$(c,"coords",this.op)};
        float val = ${d};
        int pow2 = int(pow(2.0, index));
        if (${f}) {
          int idx = ${m};
          ${w$(c,"coords",this.op)} = idx;
          val ${this.op}= getX(${C$(c,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function C$(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function w$(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oB(t,e,n,s,i,c){const l=e.shape.length,d=ss([s],l);let p=e;d!=null&&(p=Mo({inputs:{x:e},backend:n,attrs:{perm:d}}));const f=os(1,l)[0];if(f!==l-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const m=p.shape[f];let _=mi({inputs:{x:p},backend:n});for(let y=0;y<=Math.ceil(Math.log2(m))-1;y++){const v=new I$(t,p.shape,!1,c),I=[[y]],b=_;_=n.runWebGLProgram(v,[_],_.dtype,I),n.disposeIntermediateTensorInfo(b)}if(i){const y=new I$(t,p.shape,i,c),v=_;_=n.runWebGLProgram(y,[_],_.dtype),n.disposeIntermediateTensorInfo(v)}if(d!=null){const y=sg(d),v=Mo({inputs:{x:_},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(p),v}return _}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,exclusive:l,reverse:d}=s;return oB(Hm.Prod,i,n,c,l,d)}const Hye={kernelName:bw,backendName:"webgl",kernelFunc:zye};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,exclusive:l,reverse:d}=s;return oB(Hm.Sum,i,n,c,l,d)}const qye={kernelName:Nw,backendName:"webgl",kernelFunc:Kye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:c}=e,{size:l,binaryOutput:d}=s;if(i.shape.length===1){const p=n.readSync(i.dataId),f=n.readSync(c.dataId),m=U8(p,f,c.dtype,c.shape,l);return n.makeTensorInfo([l],c.dtype,m)}else if(i.shape.length===2){const p=n.bufferSync(i),f=n.bufferSync(c),m=c0e(p,f,l,d);return n.makeTensorInfo(m.shape,c.dtype,m.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const Yye={kernelName:Ow,backendName:"webgl",kernelFunc:Xye};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jye{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qye(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockSize:c,dataFormat:l}=s,d=i.shape[0],p=l==="NHWC"?i.shape[1]:i.shape[2],f=l==="NHWC"?i.shape[2]:i.shape[3],m=l==="NHWC"?i.shape[3]:i.shape[1],_=p*c,y=f*c,v=m/(c*c),I=l==="NHWC"?[d,_,y,v]:[d,v,_,y],b=new Jye(I,c,l);return n.runWebGLProgram(b,[i],i.dtype)}const Zye={kernelName:xw,backendName:"webgl",kernelFunc:Qye};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iB{constructor(e,n=!1,s=null,i=!1,c=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Fo(this.outputShape.length);const l=e.filterHeight,d=e.filterWidth,p=e.outChannels/e.inChannels;let f="",m="";s&&(i?f=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:c?f=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:f=`
          float activation(float x) {
            ${s}
          }
        `,m="result = activation(result);");const _=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${f}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${p};
        int q = d2 - d1 * ${p};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${l}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${_}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aB{constructor(e,n=!1,s=null,i=!1,c=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Fo(this.outputShape.length);const l=e.outChannels/e.inChannels,d=e.padInfo.left,p=e.strideWidth,f=e.dilationWidth,m=e.filterHeight,_=e.filterWidth,y=_;let v=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let R=0;R<_;R++)v+=`
          vec4 xTexelC${R*2};
          int xTexelC${R*2}Ready;
          vec4 xTexelC${R*2+1};
          int xTexelC${R*2+1}Ready;
          vec4 xC${R};`;v+=`
    for (int r = 0; r < ${m}; r++) {
      `;for(let R=0;R<_;R++)v+=`
          xTexelC${R*2} = vec4(0.0);
          xTexelC${R*2}Ready = 0;
          xTexelC${R*2+1} = vec4(0.0);
          xTexelC${R*2+1}Ready = 0;
          xC${R} = vec4(0.0);`;v+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let R=0;R<(y+1)/2;R++){const O=R*2;if(v+=`
          xC = xCCorner + ${O*f};
          `,p===1){if(O<_&&(d%2===1?(v+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${O}Ready == 0) {
                  xTexelC${O} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${O}.zw = vec2(0.0);
                  }
                  xTexelC${O}Ready = 1;
                }
              `,f===1&&O>0?v+=`
                xC${O} = vec4(xTexelC${O-2}.zw, xTexelC${O}.xy);
                `:v+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${O} = vec4(previous.zw, xTexelC${O}.xy);
                  } else {
                    xC${O} = vec4(0.0, 0.0, xTexelC${O}.xy);
                  }
                  `):v+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${O}Ready == 0) {
                  xTexelC${O} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${O}.zw = vec2(0.0);
                  }
                  xTexelC${O}Ready = 1;
                }

                xC${O} = xTexelC${O};
                `,O+1<_)){const L=d%2===0?sw(f):f;f%2===0&&d%2===1||f%2!==0&&d%2!==1?(v+=`
                  xCOffset = xC + imod(pads[1], 2) + ${L};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${O+1}Ready == 0) {
                    xTexelC${O+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${O+1}.zw = vec2(0.0);
                    }
                    xTexelC${O+1}Ready = 1;
                  }
                  `,f>1?v+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${O+1} = vec4(previous.zw, xTexelC${O+1}.xy);
                    } else {
                     xC${O+1} = vec4(0.0, 0.0, xTexelC${O+1}.xy);
                    }
                    `:v+=`
                    xC${O+1} = vec4(xTexelC${O}.zw, xTexelC${O+1}.xy);
                    `):L===1?v+=`
                    xC${O+1} = xTexelC${O};
                    `:v+=`
                    xCOffset = xC + ${L};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${O+1}Ready == 0) {
                      xTexelC${O+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${O+1}.zw = vec2(0.0);
                      }
                      xTexelC${O+1}Ready = 1;
                    }

                    xC${O+1} = xTexelC${O+1};
                    `}}else O<_&&(d%2===1?(v+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${O}Ready == 0) {
                  xTexelC${O} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${O}.zw = vec2(0.0);
                  }
                  xTexelC${O}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${O+1}Ready == 0) {
                  xTexelC${O+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${O+1}.zw = vec2(0.0);
                  }
                  xTexelC${O+1}Ready = 1;
                }

                xC${O} = vec4(xTexelC${O}.zw, xTexelC${O+1}.zw);
              `,O+1<_&&(v+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${O+1} = vec4(xTexelC${O+1}.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${O}Ready == 0) {
                  xTexelC${O} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${O}.zw = vec2(0.0);
                  }
                  xTexelC${O}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${O+1}Ready == 0) {
                  xTexelC${O+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${O+1}.zw = vec2(0.);
                  }
                  xTexelC${O+1}Ready = 1;
                }

                xC${O} = vec4(
                  xTexelC${O}.xy, xTexelC${O+1}.xy);
              `,O+1<_&&(v+=`
                  xC${O+1} = vec4(xTexelC${O}.zw, xTexelC${O+1}.zw);
                `)));O<_&&(v+=`
            wTexel = getW(r, ${O}, d1, q);
            dotProd += xC${O} * vec4(wTexel.xz, wTexel.xz);
          `,O+1<_&&(v+=`
              wTexel = getW(r, ${O+1}, d1, q);
              dotProd += xC${O+1} * vec4(wTexel.xz, wTexel.xz);
            `))}v+=`
    }
  `,v+=`
      }
    `;let I="",b="";s&&(i?I=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:c?I=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:I=`vec4 activation(vec4 x) {
          ${s}
        }`,b="result = activation(result);");const A=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${I}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${v}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${A}
        ${b}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eve(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:c}=e,{strides:l,pad:d,dilations:p,dimRoundingMode:f}=s;let m=p;m==null&&(m=[1,1]),se(ho(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const _=$s(i.shape,c.shape,l,m,d,f,!0);let y;De().getBool("WEBGL_PACK_DEPTHWISECONV")&&_.strideWidth<=2&&_.outChannels/_.inChannels===1?y=new aB(_):y=new iB(_);const v=[[_.padInfo.top,_.padInfo.left],[_.strideHeight,_.strideWidth],[_.dilationHeight,_.dilationWidth],[_.inHeight,_.inWidth]];return n.runWebGLProgram(y,[i,c],"float32",v)}const tve={kernelName:kw,backendName:"webgl",kernelFunc:eve};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nve{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,i=e.padInfo.top,c=e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${l} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${i};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${c};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class rve{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,i=e.strideHeight,c=e.strideWidth,l=n-1-e.padInfo.top,d=s-1-e.padInfo.left,p=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${l}, ${d});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${i}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${c}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${p}; dm++) {
              int d2 = d1 * ${p} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sve(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:c}=e,{strides:l,dilations:d,pad:p,dimRoundingMode:f,filterShape:m}=s,_=$s(i.shape,m,l,d,p,f,!0),y=new nve(_);return n.runWebGLProgram(y,[i,c],"float32")}const ove={kernelName:Dw,backendName:"webgl",kernelFunc:sve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ive(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:c}=e,{strides:l,dilations:d,pad:p,dimRoundingMode:f,inputShape:m}=s,_=$s(m,c.shape,l,d,p,f,!0),y=new rve(_);return n.runWebGLProgram(y,[i,c],"float32")}const ave={kernelName:Pw,backendName:"webgl",kernelFunc:ive};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cve{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uve(t){const{inputs:e,backend:n}=t,{x:s}=e,i=[...s.shape,...s.shape],c=Pe(s.shape),l=mt({inputs:{x:s},backend:n,attrs:{shape:[c]}}),d=new cve(c),p=n.runWebGLProgram(d,[l],l.dtype),f=mt({inputs:{x:p},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),f}const lve={kernelName:Lw,backendName:"webgl",kernelFunc:uve};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dve{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:i,strideHeight:c,strideWidth:l,filterHeight:d,filterWidth:p,dilationHeight:f,dilationWidth:m}=e,{top:_,left:y}=i;this.userCode=`
      const ivec2 strides = ivec2(${c}, ${l});
      const ivec2 pads = ivec2(${_}, ${y});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${d}; h++) {
          int hIn = hBeg + h * ${f};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${p}; w++) {
              int wIn = wBeg + w * ${m};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hve(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:c}=e,{strides:l,pad:d,dilations:p}=s,f=rg(i.shape,c.shape,l,d,"NHWC",p);let m;const _=new dve(f);m=n.runWebGLProgram(_,[i,c],"float32");const y=mt({inputs:{x:m},backend:n,attrs:{shape:f.outShape}});return n.disposeIntermediateTensorInfo(m),y}const pve={kernelName:Mw,backendName:"webgl",kernelFunc:hve};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fve(t){const{inputs:e,backend:n,attrs:s}=t,{equation:i}=s,c=e,{allDims:l,summedDims:d,idDims:p}=Mb(i,c.length);Fb(l.length,p,c);const{path:f,steps:m}=Ub(d,p),_=m.length;let y=null,v=l.length;const I=[];for(let b=0;b<_;++b){for(const A of m[b]){const{permutationIndices:R,expandDims:O}=$b(v,p[A]);let L;Vb(R)?L=c[A]:(L=Mo({inputs:{x:c[A]},backend:n,attrs:{perm:R}}),I.push(L));const $=L.shape.slice();for(let G=0;G<O.length;++G)$.splice(O[G],0,1);Nr(L.shape,$)||(L=mt({inputs:{x:L},backend:n,attrs:{shape:$}}),I.push(L)),y===null?y=L:(y=oN({inputs:{a:L,b:y},backend:n}),I.push(y))}b<_-1&&(f[b]>=0&&(y=py({inputs:{x:y},backend:n,attrs:{axis:f[b]-(l.length-v),keepDims:!1}}),I.push(y)),v--)}for(const b of I)b!==y&&n.disposeIntermediateTensorInfo(b);return y}const mve={kernelName:$w,backendName:"webgl",kernelFunc:fve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gve="return (x >= 0.0) ? x : (exp(x) - 1.0);",Eve=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,_ve=On({opSnippet:gve,packedOpSnippet:Eve}),yve={kernelName:r_,backendName:"webgl",kernelFunc:_ve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vve="return (b >= 1.0) ? a : a * (b + 1.0);",Sve=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Tve=t=>{const{inputs:e,backend:n}=t,{dy:s,y:i}=e,c=De().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new fg(Sve,s.shape,i.shape):new Lp(vve,s.shape,i.shape);return n.runWebGLProgram(c,[s,i],s.dtype)},Ive={kernelName:n6,backendName:"webgl",kernelFunc:Tve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cve=`
  return vec4(equal(a, b));
`,wve="return float(a == b);",Rve=Ys({opSnippet:wve,packedOpSnippet:Cve,dtype:"bool",cpuKernelImpl:h0e}),bve={kernelName:o_,backendName:"webgl",kernelFunc:Rve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nve=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${Ab};
  float a1 = ${Ob};
  float a2 = ${xb};
  float a3 = ${kb};
  float a4 = ${Db};
  float a5 = ${Pb};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Ave=On({opSnippet:Nve}),Ove={kernelName:s_,backendName:"webgl",kernelFunc:Ave};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xve=Xp+`
  return exp(x);
`,kve=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cB=On({opSnippet:xve,packedOpSnippet:kve,cpuKernelImpl:p0e,dtype:"float32"}),Dve={kernelName:i_,backendName:"webgl",kernelFunc:cB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cC(t){const{inputs:e,attrs:n,backend:s}=t,{dim:i}=n,{input:c}=e,l=c.shape.length,d=c.shape.slice();let p=i;return i<0&&(se(-(l+1)<=i,()=>`Axis must be in the interval [${-(l+1)}, ${l}]`),p=l+i+1),d.splice(p,0,1),mt({inputs:{x:c},backend:s,attrs:{shape:d}})}const Pve={kernelName:Fw,backendName:"webgl",kernelFunc:cC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const R$="return exp(x) - 1.0;",Lve=On({opSnippet:R$,packedOpSnippet:R$,cpuKernelImpl:f0e}),Mve={kernelName:a_,backendName:"webgl",kernelFunc:Lve};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class b${constructor(e,n,s){this.variableNames=["real","imag"];const i=n[1];this.outputShape=n;const c=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,l=s?`${i}.0`:"1.0";let d;if(e==="real")d="return real * expR - imag * expI;";else if(e==="imag")d="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${c};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${d}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${i});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${i}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${l};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uB(t,e,n){const s=n.texData.get(t.dataId),i=Pe(t.shape),c=t.shape[t.shape.length-1],l=i/c,d=mt({inputs:{x:t},backend:n,attrs:{shape:[l,c]}}),p=d.shape,f=new b$("real",p,e),m=new b$("imag",p,e),_=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:p},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:p}],y=n.runWebGLProgram(f,_,"float32"),v=n.runWebGLProgram(m,_,"float32"),I=Rl({inputs:{real:y,imag:v},backend:n});n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v);const b=mt({inputs:{x:I},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(I),b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ve(t){const{inputs:e,backend:n}=t,{input:s}=e;return uB(s,!1,n)}const Fve={kernelName:Uw,backendName:"webgl",kernelFunc:$ve};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uve{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gg(t){const{backend:e,attrs:n}=t,{shape:s,value:i}=n;let{dtype:c}=n;if(c=c||Zm(i),c==="string"){const l=Ps(c,Pe(s));return l.fill(i),e.makeTensorInfo(s,c,l)}else{const l=new Uve(s,i),d=[[i]];return e.runWebGLProgram(l,[],c,d)}}const Vve={kernelName:Vw,backendName:"webgl",kernelFunc:gg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Bve{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jve={kernelName:Bw,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,i=new Bve(n.shape);return s.runWebGLProgram(i,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N$="return floor(x);",Wve=On({opSnippet:N$,packedOpSnippet:N$,cpuKernelImpl:m0e}),Gve={kernelName:c_,backendName:"webgl",kernelFunc:Wve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zve=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Hve=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Kve=Ys({opSnippet:zve,packedOpSnippet:Hve,dtype:"int32"}),qve={kernelName:u_,backendName:"webgl",kernelFunc:Kve};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xve{constructor(e){this.variableNames=["A"];const n=$o(),[s,i]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${i}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yve{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=$o(),[s,i]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${i}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jve={kernelName:g2,backendName:"webgl",kernelFunc:Qve};let Wh,gI=De().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function Qve(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:i}=e;const{numChannels:c}=s,l=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,d=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,[p,f]=l?[i.videoWidth,i.videoHeight]:[i.width,i.height],m=[f,p],_=[f,p,c];if(d||l){const b=De().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Wh==null||b!==gI)&&(gI=b,Wh=document.createElement("canvas").getContext("2d",{willReadFrequently:gI})),Wh.canvas.width=p,Wh.canvas.height=f,Wh.drawImage(i,0,0,p,f),i=Wh.canvas}const y=n.makeTensorInfo(m,"int32");n.texData.get(y.dataId).usage=Vi.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(y.dataId),i);const v=De().getBool("WEBGL_PACK")?new Yve(_):new Xve(_),I=n.runWebGLProgram(v,[y],"int32");return n.disposeData(y.dataId),I}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zve(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:c,bias:l,preluActivationWeights:d}=e,{strides:p,pad:f,dataFormat:m,dilations:_,dimRoundingMode:y,activation:v,leakyreluAlpha:I}=s,b=cu(m),A=$s(i.shape,c.shape,p,_,f,y,!1,b);let R;const O=[],L=l!=null,$=d!=null,G=v==="leakyrelu",H=()=>{const re=[i,c],oe=(ae,Ee)=>{if(Ee==="NCHW"&&ae.shape.length===1&&ae.shape[0]!==1){const Ce=mt({inputs:{x:ae},backend:n,attrs:{shape:[ae.shape[0],1,1]}});return O.push(Ce),Ce}return ae};if(L&&re.push(oe(l,m)),$&&re.push(oe(d,m)),G){const ae=n.makeTensorInfo([],"float32",Sl(I,"float32"));re.push(ae),O.push(ae)}return re};if(A.filterHeight===1&&A.filterWidth===1&&A.dilationHeight===1&&A.dilationWidth===1&&A.strideHeight===1&&A.strideWidth===1&&(A.padInfo.type==="SAME"||A.padInfo.type==="VALID"))R=rB({x:i,filter:c,convInfo:A,backend:n,bias:l,activation:v,preluActivationWeights:d,leakyreluAlpha:I});else if(A.strideWidth<=2&&b==="channelsLast"&&De().getBool("WEBGL_EXP_CONV")){const re=v?Gm(v,!0):null,oe=new nB(A,L,re,$,G),ae=[[A.padInfo.top,A.padInfo.left],[A.strideHeight,A.strideWidth],[A.dilationHeight,A.dilationWidth],[A.inHeight,A.inWidth]],Ee=H();R=n.runWebGLProgram(oe,Ee,"float32",ae)}else if(De().getBool("WEBGL_CONV_IM2COL"))R=sB({x:i,filter:c,convInfo:A,backend:n,bias:l,activation:v,preluActivationWeights:d,leakyreluAlpha:I});else{const re=v?Gm(v,!1):null,oe=new tB(A,L,re,$,G),ae=H();R=n.runWebGLProgram(oe,ae,"float32")}const Z=mt({inputs:{x:R},backend:n,attrs:{shape:A.outShape}});return O.push(R),O.forEach(re=>n.disposeIntermediateTensorInfo(re)),Z}const eSe={kernelName:s1,backendName:"webgl",kernelFunc:Zve};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:c,bias:l,preluActivationWeights:d}=e,{strides:p,pad:f,dilations:m,dimRoundingMode:_,activation:y,leakyreluAlpha:v}=s,I=[];let b=m;b==null&&(b=[1,1]),se(ho(p,b),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${p} and dilations '${b}'`);const A=$s(i.shape,c.shape,p,b,f,_,!0),R=De().getBool("WEBGL_PACK_DEPTHWISECONV")&&A.strideWidth<=2&&A.outChannels/A.inChannels===1,O=y?Gm(y,R):null,L=[i,c],$=l!=null,G=d!=null,H=y==="leakyrelu";if($&&L.push(l),G&&L.push(d),H){const ae=n.makeTensorInfo([],"float32",Sl(v,"float32"));L.push(ae),I.push(ae)}let Z;R?Z=new aB(A,$,O,G,H):Z=new iB(A,$,O,G,H);const re=[[A.padInfo.top,A.padInfo.left],[A.strideHeight,A.strideWidth],[A.dilationHeight,A.dilationWidth],[A.inHeight,A.inWidth]],oe=n.runWebGLProgram(Z,L,"float32",re);return I.forEach(ae=>n.disposeIntermediateTensorInfo(ae)),oe}const nSe={kernelName:o1,backendName:"webgl",kernelFunc:tSe};class rSe{constructor(e,n,s,i){this.sliceDim=e,this.strides=n,this.paramsShape=i,this.variableNames=["x","indices"],this.outputShape=s;const c=Er(s.length);let l=`
    int index;`;for(let d=0;d<this.sliceDim;d++)l+=`
          index = round(getIndices(coords[0], ${d}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[d]};
          flattenIndex += index * ${this.strides[d]};`;this.userCode=`
         void main() {
          ${c} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${l}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sSe(t){const{inputs:e,backend:n}=t,{params:s,indices:i}=e,c=i.shape,l=c[c.length-1],d=Pe(s.shape),[p,f,m,_]=ZR(s,i),y=mt({inputs:{x:i},backend:n,attrs:{shape:[f,l]}}),v=mt({inputs:{x:s},backend:n,attrs:{shape:[Pe(s.shape)/m,m]}});if(n.shouldExecuteOnCPU([s,i])||s.dtype==="string"){const R=n.readSync(i.dataId),O=n.bufferSync(s),L=g0e(R,O,s.dtype,f,l,m,_,s.shape,d);return n.makeTensorInfo(p,s.dtype,L.values)}const I=new rSe(l,_,[f,m],s.shape),b=n.runWebGLProgram(I,[v,y],v.dtype),A=mt({inputs:{x:b},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(b),A}const oSe={kernelName:Gw,backendName:"webgl",kernelFunc:sSe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iSe{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=Er(this.rank),i=aSe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${i}));
      }
    `}}function aSe(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let i=0;i<t.length;i++)i===2?s.push("index"):s.push(`${n[i]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lB(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,indices:c}=e,{axis:l,batchDims:d}=s,p=$n(l,i.shape)[0];if(De().get("DEBUG")){const O=n.readSync(c.dataId),L=i.shape[p];for(let $=0;$<O.length;++$){const G=O[$];se(G<=L-1&&G>=0,()=>`GatherV2: the index value ${G} is not in [0, ${L-1}]`)}}const f=jb(i,c,p,d),m=Pe(c.shape),_=[],y=mt({inputs:{x:i},backend:n,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),v=mt({inputs:{x:c},backend:n,attrs:{shape:[f.batchSize,m/f.batchSize]}});_.push(y),_.push(v);const I=[f.batchSize,f.outerSize,m/f.batchSize,f.sliceSize];if(n.shouldExecuteOnCPU([i,c])||i.dtype==="string"){const O=n.bufferSync(v),L=n.bufferSync(y),$=E0e(L,O,I);return _.forEach(G=>n.disposeIntermediateTensorInfo(G)),n.makeTensorInfo(f.outputShape,$.dtype,$.values)}const b=new iSe(y.shape,I),A=n.runWebGLProgram(b,[y,v],y.dtype);_.push(A);const R=mt({inputs:{x:A},backend:n,attrs:{shape:f.outputShape}});return _.forEach(O=>n.disposeIntermediateTensorInfo(O)),R}const cSe={kernelName:Ww,backendName:"webgl",kernelFunc:lB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uSe="return float(a > b);",lSe=`
  return vec4(greaterThan(a, b));
`,dSe=Ys({opSnippet:uSe,packedOpSnippet:lSe,cpuKernelImpl:_0e,dtype:"bool"}),hSe={kernelName:l_,backendName:"webgl",kernelFunc:dSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pSe="return float(a >= b);",fSe=`
  return vec4(greaterThanEqual(a, b));
`,mSe=Ys({opSnippet:pSe,packedOpSnippet:fSe,dtype:"bool",cpuKernelImpl:y0e}),gSe={kernelName:d_,backendName:"webgl",kernelFunc:mSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ESe(t){const{inputs:e,backend:n}=t,{input:s}=e;return uB(s,!0,n)}const _Se={kernelName:zw,backendName:"webgl",kernelFunc:ESe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ySe="return float(!isnan(x) && !isinf(x));",vSe=On({opSnippet:ySe,dtype:"bool"}),SSe={kernelName:p_,backendName:"webgl",kernelFunc:vSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TSe="return float(isinf(x));",ISe=On({opSnippet:TSe,dtype:"bool"}),CSe={kernelName:f_,backendName:"webgl",kernelFunc:ISe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wSe="return float(isnan(x));",RSe=On({opSnippet:wSe,dtype:"bool"}),bSe={kernelName:m_,backendName:"webgl",kernelFunc:RSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NSe="return float(a < b);",ASe=`
  return vec4(lessThan(a, b));
`,OSe=Ys({opSnippet:NSe,packedOpSnippet:ASe,cpuKernelImpl:v0e,dtype:"bool"}),xSe={kernelName:g_,backendName:"webgl",kernelFunc:OSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kSe="return float(a <= b);",DSe=`
  return vec4(lessThanEqual(a, b));
`,PSe=Ys({opSnippet:kSe,packedOpSnippet:DSe,cpuKernelImpl:S0e,dtype:"bool"}),LSe={kernelName:E_,backendName:"webgl",kernelFunc:PSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MSe(t){const{backend:e,attrs:n}=t,{start:s,stop:i,num:c}=n,l=T0e(s,i,c);return e.makeTensorInfo([l.length],"float32",l)}const $Se={kernelName:qw,backendName:"webgl",kernelFunc:MSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FSe=Xp+`
  return x < 0.0 ? 0./0. : log(x);
`,USe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,VSe=On({opSnippet:FSe,packedOpSnippet:USe,cpuKernelImpl:I0e}),BSe={kernelName:__,backendName:"webgl",kernelFunc:VSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jSe=Xp+`
  return log(1.0 + x);
`,WSe=On({opSnippet:jSe}),GSe={kernelName:y_,backendName:"webgl",kernelFunc:WSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zSe="return float(a >= 1.0 && b >= 1.0);",HSe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,KSe=Ys({opSnippet:zSe,packedOpSnippet:HSe,dtype:"bool"}),qSe={kernelName:v_,backendName:"webgl",kernelFunc:KSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XSe="return float(!(x >= 1.0));",YSe=On({opSnippet:XSe}),JSe={kernelName:S_,backendName:"webgl",kernelFunc:YSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QSe="return float(a >= 1.0 || b >= 1.0);",ZSe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,eTe=Ys({opSnippet:QSe,packedOpSnippet:ZSe,dtype:"bool"}),tTe={kernelName:T_,backendName:"webgl",kernelFunc:eTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nTe{constructor(e,n,s,i,c){this.variableNames=["x"],this.outputShape=[];const l=n,d=e[3]-1;this.outputShape=e;let p;const f=`float(${s}) + float(${i}) * sum`;c===.5?p=`inversesqrt(${f})`:c===1?p=`1.0/(${f})`:p=`exp(log(${f}) * float(-${c}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${l}; j <= ${l}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${d}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${p};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rTe{constructor(e,n,s,i,c){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const l=n,d=e[3]-1;this.outputShape=e;let p;const f=`float(${s}) + float(${i}) * sum`;c===.5?p=`inversesqrt(${f})`:c===1?p=`1.0/(${f})`:p=`exp(log(${f}) * float(-${c}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${l};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${l}; j <= ${l}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${d}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${p};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sTe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{depthRadius:c,bias:l,alpha:d,beta:p}=s,f=De().getBool("WEBGL_PACK_NORMALIZATION")?new rTe(i.shape,c,l,d,p):new nTe(i.shape,c,l,d,p);return n.runWebGLProgram(f,[i],i.dtype)},oTe={kernelName:Xw,backendName:"webgl",kernelFunc:sTe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iTe{constructor(e,n,s,i,c){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=i,this.beta=c,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${i}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${i})
                * float(${c})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${c});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aTe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i,y:c,dy:l}=e,{depthRadius:d,bias:p,alpha:f,beta:m}=s,_=new iTe(i.shape,d,p,f,m);return n.runWebGLProgram(_,[i,c,l],i.dtype)},cTe={kernelName:r6,backendName:"webgl",kernelFunc:aTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uTe(t,e,n,s){const i=Pe(e),l=Pe(t.shape)/i,d=mt({inputs:{x:t},attrs:{shape:[l,i]},backend:s}),p=zd(d,t.dtype,"max",s),f=mt({inputs:{x:p},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(d),s.disposeIntermediateTensorInfo(p),f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dB(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reductionIndices:c,keepDims:l}=s,d=i.shape.length,p=$n(c,i.shape);let f=p;const m=ss(f,d),_=m!=null,y=n.shouldExecuteOnCPU([i]);let v=i;if(_){if(y){const L=n.texData.get(v.dataId).values,$=new Array(d);for(let Z=0;Z<$.length;Z++)$[Z]=i.shape[m[Z]];const G=rN(L,i.shape,i.dtype,m,$);v=n.makeTensorInfo($,i.dtype);const H=n.texData.get(v.dataId);H.values=G}else v=hy(i,m,n);f=os(f.length,d)}Xs("max",f,d);const[I,b]=qs(v.shape,f);let A=I;l&&(A=Cs(I,p));let R;if(y){const L=n.texData.get(v.dataId).values,$=C0e(L,Pe(b),A,i.dtype);R=n.makeTensorInfo(A,i.dtype);const G=n.texData.get(R.dataId);G.values=$}else R=uTe(v,b,A,n);return _&&n.disposeIntermediateTensorInfo(v),R}const lTe={kernelName:Yw,backendName:"webgl",kernelFunc:dB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dTe=sN+`
  return max(a, b);
`,hTe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+pg+`
  return result;
`,pTe=Ys({opSnippet:dTe,packedOpSnippet:hTe,cpuKernelImpl:w0e}),fTe={kernelName:I_,backendName:"webgl",kernelFunc:pTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;dg(i,"maxPool");const{filterSize:c,strides:l,pad:d,dimRoundingMode:p}=s,f=1;se(ho(l,f),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${l} and dilations '${f}'`);const m=Ta(i.shape,c,l,f,d,p);if(m.filterWidth===1&&m.filterHeight===1&&Nr(m.inShape,m.outShape))return mi({inputs:{x:i},backend:n});const _=new zm(m,"max",!1);return n.runWebGLProgram(_,[i],i.dtype)}const gTe={kernelName:Jw,backendName:"webgl",kernelFunc:mTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ETe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:c,strides:l,pad:d,dataFormat:p,dimRoundingMode:f}=s,m=[1,1,1],_=au(i.shape,c,l,m,d,f,p),y=new iN(_,"max",!1);return n.runWebGLProgram(y,[i],i.dtype)}const _Te={kernelName:Qw,backendName:"webgl",kernelFunc:ETe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yTe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,i=e.dilationHeight,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,d=c-1-e.padInfo.top,p=l-1-e.padInfo.left,f=c*l-1;this.userCode=`
      const ivec2 pads = ivec2(${d}, ${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${c};
          wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${l}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${f} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${l} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class vTe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,i=e.strideWidth,c=e.dilationDepth,l=e.dilationHeight,d=e.dilationWidth,p=e.effectiveFilterDepth,f=e.effectiveFilterHeight,m=e.effectiveFilterWidth,_=p-1-e.padInfo.front,y=f-1-e.padInfo.top,v=m-1-e.padInfo.left,I=p*f*m-1;this.userCode=`
      const ivec3 pads = ivec3(${_}, ${y}, ${v});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${p};
           wD += ${c}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${l}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${m};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${i}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${I} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${f} * ${m} +
                  wR * ${m} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function STe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:c}=e,l=c,{filterSize:d,strides:p,pad:f,dimRoundingMode:m}=s,_=[1,1,1],y=au(l.shape,d,p,_,f,m),v=new iN(y,"max",!0),I=n.runWebGLProgram(v,[l],l.dtype),b=new vTe(y),A=n.runWebGLProgram(b,[i,I],l.dtype);return n.disposeIntermediateTensorInfo(I),A}const TTe={kernelName:o6,backendName:"webgl",kernelFunc:STe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ITe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:c,output:l}=e,d=c;dg([c,l],"maxPoolGrad");const{filterSize:p,strides:f,pad:m,dimRoundingMode:_}=s,y=Ta(d.shape,p,f,1,m,_),v=!0,I=new zm(y,"max",v),b=n.runWebGLProgram(I,[d],d.dtype),A=new yTe(y),R=n.runWebGLProgram(A,[i,b],d.dtype);return n.disposeIntermediateTensorInfo(b),R}const CTe={kernelName:s6,backendName:"webgl",kernelFunc:ITe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wTe(t,e,n,s){let i=new zm(n,"max",!1);const c=s.runWebGLProgram(i,[t],"float32");i=new zm(n,"max",!0,!0,e);const l=s.runWebGLProgram(i,[t],"float32");return[c,l]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RTe={kernelName:Zw,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:i,strides:c,pad:l,includeBatchInIndex:d}=e,p=n;se(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const f=[1,1];se(ho(c,f),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${c} and dilations '${f}'`);const m=Ta(s.shape,i,c,f,l),[_,y]=wTe(s,d,m,p);return[_,y]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bTe(t,e,n,s){const i=Pe(e),l=Pe(t.shape)/i,d=mt({inputs:{x:t},attrs:{shape:[l,i]},backend:s}),p=zd(d,"float32","mean",s),f=mt({inputs:{x:p},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(d),s.disposeIntermediateTensorInfo(p),f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NTe={kernelName:eR,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:i,axis:c}=e,l=n,d=s.shape.length,p=$n(c,s.shape);let f=p;const m=ss(f,d),_=m!=null,y=l.shouldExecuteOnCPU([s]),v=[];let I=s;if(_){if(y){const $=l.texData.get(I.dataId).values,G=new Array(d);for(let re=0;re<G.length;re++)G[re]=s.shape[m[re]];const H=rN($,s.shape,s.dtype,m,G);I=l.makeTensorInfo(G,s.dtype);const Z=l.texData.get(I.dataId);Z.values=H}else I=hy(s,m,l);v.push(I),f=os(f.length,d)}Xs("sum",f,d);const[b,A]=qs(I.shape,f);let R=b;i&&(R=Cs(b,p));const O=bTe(I,A,R,l);for(const L of v)l.disposeIntermediateTensorInfo(L);return O}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ATe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,keepDims:l}=s,d=i.shape.length,p=$n(c,i.shape);let f=p;const m=ss(f,d);let _=i;m!=null&&(_=Mo({inputs:{x:i},backend:n,attrs:{perm:m}}),f=os(f.length,i.shape.length)),Xs("min",f,d);const[y,v]=qs(_.shape,f),I=Pe(v),b=mt({inputs:{x:_},backend:n,attrs:{shape:[-1,I]}}),A=zd(b,b.dtype,"min",n);let R;if(l){const O=Cs(y,p);R=mt({inputs:{x:A},backend:n,attrs:{shape:O}})}else R=mt({inputs:{x:A},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(b),n.disposeIntermediateTensorInfo(A),m!=null&&n.disposeIntermediateTensorInfo(_),R}const OTe={kernelName:tR,backendName:"webgl",kernelFunc:ATe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xTe=sN+`
  return min(a, b);
`,kTe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+pg+`
  return result;
`,DTe=Ys({opSnippet:xTe,packedOpSnippet:kTe,cpuKernelImpl:R0e}),PTe={kernelName:C_,backendName:"webgl",kernelFunc:DTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LTe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((m,_)=>m[0]+e[_]+m[1]);const i=e.length,c=Er(i),l=n.map(m=>m[0]).join(","),d=n.map((m,_)=>m[0]+e[_]).join(","),p=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i),f=s==="reflect"?0:1;if(i===1){this.userCode=`
        int start = ${l};
        int end = ${d};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${f};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${f};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${c} start = ${c}(${l});
      ${c} end = ${c}(${d});

      void main() {
        ${c} outC = getOutputCoords();
        for (int i = 0; i < ${i}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${f};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${f};
          }
        }
        ${c} coords = outC - start;
        setOutput(getX(${p}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MTe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((I,b)=>I[0]+e[b]+I[1]);const i=e.length,c=Er(i),l=n.map(I=>I[0]).join(","),d=n.map((I,b)=>I[0]+e[b]).join(","),p=Do("rc",i),f=Do("source",i),m=`${p[i-1]} < ${this.outputShape[i-1]}`,_=i===1?"source":`vec2(${f.slice(-2).join()})`,y=s==="reflect"?0:1;let v="";if(i===1){const I=`
        ${c} source = rc;
        if (source < start) {
          source = start * 2 - source - ${y};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${y};
        }
        source -= start;
      `;v=`
        ${c} rc = outputLoc;
        ${I}
        result[0] = getChannel(getX(${f.join()}), ${_});
        ${p[i-1]} += 1;
        if(${m}) {
          ${I}
          result[1] = getChannel(getX(${f.join()}), ${_});
        }
      `}else{const I=`
        ${c} source = rc;
        ${c} lt = ${c}(lessThan(source, start));
        ${c} gte = ${c}(greaterThanEqual(source, end));
        ${c} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${y}) +
                gte * ((end - 1) * 2 - source + ${y});
        source -= start;
      `;v=`
        ${c} rc = outputLoc;
        ${I}
        result[0] = getChannel(getX(${f.join()}), ${_});
        ${p[i-1]} += 1;
        if(${m}) {
          ${I}
          result[1] = getChannel(getX(${f.join()}), ${_});
        }
        rc = outputLoc;
        ${p[i-2]} += 1;
        if(${p[i-2]} < ${this.outputShape[i-2]}) {
          ${I}
          result[2] = getChannel(getX(${f.join()}), ${_});
          ${p[i-1]} += 1;
          if(${m}) {
            ${I}
            result[3] = getChannel(getX(${f.join()}), ${_});
          }
        }
      `}this.userCode=`
      const ${c} start = ${c}(${l});
      const ${c} end = ${c}(${d});

      void main() {
        ${c} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${v}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Te=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:i,mode:c}=n,l=De().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new MTe(s.shape,i,c):new LTe(s.shape,i,c);return e.runWebGLProgram(l,[s],s.dtype)},FTe={kernelName:nR,backendName:"webgl",kernelFunc:$Te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UTe=`if (b == 0.0) return NAN;
  return mod(a, b);`,VTe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+pg+`
  return result;
`,BTe=Ys({opSnippet:UTe,packedOpSnippet:VTe}),jTe={kernelName:w_,backendName:"webgl",kernelFunc:BTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WTe{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GTe=`
if (a == b) {
  return 1.0;
};
return a / b;`,zTe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,hB=Ys({opSnippet:GTe,packedOpSnippet:zTe,checkOutOfBounds:!0}),HTe={kernelName:n_,backendName:"webgl",kernelFunc:hB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A$="return a - b;",pB=Ys({opSnippet:A$,packedOpSnippet:A$,supportsComplex:!0,cpuKernelImpl:z0e}),KTe={kernelName:j_,backendName:"webgl",kernelFunc:pB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fB(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{dim:c}=s,l=$n([c],i.shape),d=dB({inputs:{x:i},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),p=Cs(d.shape,l),f=mt({inputs:{x:d},backend:n,attrs:{shape:p}}),m=pB({inputs:{a:i,b:f},backend:n}),_=cB({inputs:{x:m},backend:n}),y=py({inputs:{x:_},backend:n,attrs:{axis:l,keepDims:!1}}),v=mt({inputs:{x:y},backend:n,attrs:{shape:p}}),I=hB({inputs:{a:_,b:v},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(_),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),I}const qTe={kernelName:AR,backendName:"webgl",kernelFunc:fB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XTe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{numSamples:c,seed:l,normalized:d}=s,p=d?i:fB({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),f=p.shape[0],m=p.shape[1],_=new WTe(f,m,c),y=[[l]],v=n.runWebGLProgram(_,[p],"int32",y);return d||n.disposeIntermediateTensorInfo(p),v}const YTe={kernelName:rR,backendName:"webgl",kernelFunc:XTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JTe=Ca+`
  return -x;
`,QTe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function ZTe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const c=n.texData.get(s.dataId),[l,d]=N0e(c.values,s.shape,s.dtype);return n.makeTensorInfo(d,s.dtype,l)}let i;return De().getBool("WEBGL_PACK_UNARY_OPERATIONS")?i=new gd(s.shape,QTe):i=new Kc(s.shape,JTe),n.runWebGLProgram(i,[s],s.dtype)}const eIe={kernelName:sR,backendName:"webgl",kernelFunc:ZTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tIe=_b;function nIe(t){ha("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:c}=e,{maxOutputSize:l,iouThreshold:d,scoreThreshold:p}=s,f=n.readSync(i.dataId),m=n.readSync(c.dataId),{selectedIndices:_}=tIe(f,m,l,d,p);return n.makeTensorInfo([_.length],"int32",new Int32Array(_))}const rIe={kernelName:oR,backendName:"webgl",kernelFunc:nIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sIe=yb;function oIe(t){ha("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:c}=e,{maxOutputSize:l,iouThreshold:d,scoreThreshold:p,padToMaxOutputSize:f}=s,m=n.readSync(i.dataId),_=n.readSync(c.dataId),{selectedIndices:y,validOutputs:v}=sIe(m,_,l,d,p,f);return[n.makeTensorInfo([y.length],"int32",new Int32Array(y)),n.makeTensorInfo([],"int32",new Int32Array([v]))]}const iIe={kernelName:iR,backendName:"webgl",kernelFunc:oIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aIe=vb;function cIe(t){ha("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:c}=e,{maxOutputSize:l,iouThreshold:d,scoreThreshold:p,softNmsSigma:f}=s,m=n.readSync(i.dataId),_=n.readSync(c.dataId),y=l,v=d,I=p,b=f,{selectedIndices:A,selectedScores:R}=aIe(m,_,y,v,I,b);return[n.makeTensorInfo([A.length],"int32",new Int32Array(A)),n.makeTensorInfo([R.length],"float32",new Float32Array(R))]}const uIe={kernelName:aR,backendName:"webgl",kernelFunc:cIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lIe{constructor(e,n,s,i){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${i}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dIe=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:i}=e,{dtype:c,depth:l,onValue:d,offValue:p}=s,f=Pe(i.shape),m=new lIe(f,l,d,p),_=mt({inputs:{x:i},backend:n,attrs:{shape:[f]}}),y=n.runWebGLProgram(m,[_],c);n.disposeIntermediateTensorInfo(_);const v=[...i.shape,l],I=mt({inputs:{x:y},backend:n,attrs:{shape:v}});return n.disposeIntermediateTensorInfo(y),I},hIe={kernelName:uR,backendName:"webgl",kernelFunc:dIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R1(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const i=mg({inputs:{input:s},backend:n}),c=R1({inputs:{x:i},backend:n}),l=fy({inputs:{input:s},backend:n}),d=R1({inputs:{x:l},backend:n}),p=Rl({inputs:{real:c,imag:d},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),p}else return gg({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const pIe={kernelName:GR,backendName:"webgl",kernelFunc:R1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mB(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const i=mg({inputs:{input:s},backend:n}),c=mB({inputs:{x:i},backend:n}),l=fy({inputs:{input:s},backend:n}),d=R1({inputs:{x:l},backend:n}),p=Rl({inputs:{real:c,imag:d},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(d),p}else return gg({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const fIe={kernelName:cR,backendName:"webgl",kernelFunc:mB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mIe(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s;if(e.length===1)return cC({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const c=e[0].shape,l=e[0].dtype;e.forEach(m=>{gi(c,m.shape,"All tensors passed to stack must have matching shapes"),se(l===m.dtype,()=>"All tensors passed to stack must have matching dtypes")});const d=[],p=e.map(m=>{const _=cC({inputs:{input:m},backend:n,attrs:{dim:i}});return d.push(_),_}),f=eB({inputs:p,backend:n,attrs:{axis:i}});return d.forEach(m=>n.disposeIntermediateTensorInfo(m)),f}const gIe={kernelName:lR,backendName:"webgl",kernelFunc:mIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EIe{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((f,m)=>f[0]+e[m]+f[1]);const i=e.length,c=Er(i),l=n.map(f=>f[0]).join(","),d=n.map((f,m)=>f[0]+e[m]).join(","),p=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);if(i===1){this.userCode=`
        int start = ${l};
        int end = ${d};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${c} start = ${c}(${l});
      ${c} end = ${c}(${d});

      void main() {
        ${c} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${c} coords = outC - start;
          setOutput(getX(${p}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Ie{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((b,A)=>b[0]+e[A]+b[1]);const i=e.length,c=Er(i),l=n.map(b=>b[0]).join(","),d=n.map((b,A)=>b[0]+e[A]).join(","),p=Do("rc",i),f=Do("source",i),m=`${p[i-1]} < ${this.outputShape[i-1]}`,_=i===1?"source":`vec2(${f.slice(-2).join()})`,y=[`${c} rc = outputLoc;`,`${p[i-1]} += 1;
       if(${m}) {
      `,i===1?"":`}
       rc = outputLoc;
       ${p[i-2]} += 1;
       if(${p[i-2]} < ${this.outputShape[i-2]}) {`,i===1?"":`  ${p[i-1]} += 1;
         if(${m}) {`],v=i===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let I="";for(let b=0,A=i===1?2:4;b<A;b++)I+=`
        ${y[b]}
        if (${v}) {
          result[${b}] = float(value);
        } else {
          ${c} source = rc - start;
          result[${b}] = getChannel(getX(${f.join()}), ${_});
        }
      `;I+=i===1?"} ":"}}",this.userCode=`
      const ${c} start = ${c}(${l});
      const ${c} end = ${c}(${d});

      void main() {
        ${c} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${I}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gB=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{paddings:c,constantValue:l}=s;if(Pe(i.shape)===0){const f=c.map((m,_)=>m[0]+i.shape[_]+m[1]);return gg({backend:n,attrs:{shape:f,value:l,dtype:i.dtype}})}const d=De().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _Ie(i.shape,c,l):new EIe(i.shape,c,l),p=[[l]];return n.runWebGLProgram(d,[i],i.dtype,p)},yIe={kernelName:dR,backendName:"webgl",kernelFunc:gB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vIe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,SIe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+pg+`
  return result;
`,TIe=Ys({opSnippet:vIe,packedOpSnippet:SIe}),IIe={kernelName:N_,backendName:"webgl",kernelFunc:TIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:c,keepDims:l}=s,d=i.shape.length,p=[],f=$n(c,i.shape);let m=f;const _=ss(m,d);let y=i;_!=null&&(y=Mo({inputs:{x:i},backend:n,attrs:{perm:_}}),m=os(m.length,d),p.push(y)),Xs("prod",m,d);let v;if(n.shouldExecuteOnCPU([y])){const I=n.texData.get(y.dataId).values,{outVals:b,outShape:A,outDtype:R}=O0e(y.shape,y.dtype,I,m);v=n.makeTensorInfo(A,R,b)}else{const[I,b]=qs(y.shape,m),A=Pe(b),R=mt({inputs:{x:y},backend:n,attrs:{shape:[-1,A]}}),O=KR(i.dtype),L=zd(R,O,"prod",n);v=mt({inputs:{x:L},backend:n,attrs:{shape:I}}),p.push(R),p.push(L)}if(l){p.push(v);const I=Cs(v.shape,f);v=mt({inputs:{x:v},backend:n,attrs:{shape:I}})}return p.forEach(I=>n.disposeIntermediateTensorInfo(I)),v}const wIe={kernelName:pR,backendName:"webgl",kernelFunc:CIe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RIe(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:i,paramsDenseValues:c,indices:l}=e,{outputRaggedRank:d}=s,p=i.map(R=>n.readSync(R.dataId)),f=i.map(R=>R.shape),m=n.readSync(c.dataId),_=n.readSync(l.dataId),[y,v,I]=x0e(p,f,m,c.shape,c.dtype,_,l.shape,d),b=y.map(R=>n.makeTensorInfo([R.length],"int32",R)),A=n.makeTensorInfo(I,c.dtype,v);return b.concat([A])}const bIe={kernelName:fR,backendName:"webgl",kernelFunc:RIe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NIe(t){const{inputs:e,backend:n,attrs:s}=t,{shape:i,values:c,defaultValue:l,rowPartitionTensors:d}=e,{rowPartitionTypes:p}=s,f=n.readSync(i.dataId),m=n.readSync(c.dataId),_=n.readSync(l.dataId),y=d.map(A=>n.readSync(A.dataId)),v=d.map(A=>A.shape),[I,b]=k0e(f,i.shape,m,c.shape,c.dtype,_,l.shape,y,v,p);return n.makeTensorInfo(I,c.dtype,b)}const AIe={kernelName:mR,backendName:"webgl",kernelFunc:NIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EB=t=>{const{backend:e,attrs:n}=t,{start:s,stop:i,step:c,dtype:l}=n,d=D0e(s,i,c,l);return e.makeTensorInfo([d.length],l,d)},OIe={kernelName:gR,backendName:"webgl",kernelFunc:EB};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xIe="return 1.0 / x;",kIe=On({opSnippet:xIe}),DIe={kernelName:A_,backendName:"webgl",kernelFunc:kIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PIe=Ca+`
  return (x < 0.0) ? 0.0 : x;
`,LIe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,MIe=On({opSnippet:PIe,packedOpSnippet:LIe}),$Ie={kernelName:O_,backendName:"webgl",kernelFunc:MIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FIe=Ca+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,UIe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,VIe=On({opSnippet:FIe,packedOpSnippet:UIe}),BIe={kernelName:x_,backendName:"webgl",kernelFunc:VIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jIe{constructor(e,n,s,i,c){this.variableNames=["A"],this.outputShape=[];const[l,d,p,f]=e;this.outputShape=[l,n,s,f];const m=[i&&n>1?d-1:d,i&&s>1?p-1:p],_=[i&&n>1?n-1:n,i&&s>1?s-1:s];let y;c?y="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":y="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${m[0]/_[0]},
          ${m[1]/_[1]});
      const vec2 inputShapeRC = vec2(${d}.0, ${p}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${y};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WIe{constructor(e,n,s,i,c){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[l,d,p,f]=e;this.outputShape=[l,n,s,f];const m=[i&&n>1?d-1:d,i&&s>1?p-1:p],_=[i&&n>1?n-1:n,i&&s>1?s-1:s];let y;c?y="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":y="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${m[0]/_[0]},
          ${m[1]/_[1]},
          ${m[1]/_[1]});
      const vec3 inputShapeRC = vec3(${d}.0, ${p}.0,
                                     ${p}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${y};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${f-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GIe(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:c,halfPixelCenters:l,size:d}=s,[p,f]=d,m=De().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new WIe(i.shape,p,f,c,l):new jIe(i.shape,p,f,c,l);return n.runWebGLProgram(m,[i],"float32")}const zIe={kernelName:vR,backendName:"webgl",kernelFunc:GIe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HIe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,c]=n,[,l,d]=e,p=[s&&l>1?i-1:i,s&&d>1?c-1:c],f=[s&&l>1?l-1:l,s&&d>1?d-1:d],m=p[0]/f[0],_=p[1]/f[1],y=1/m,v=1/_,I=Math.ceil(y)*2+2,b=Math.ceil(v)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${m});
        const float widthScale = float(${_});

        const float invHeightScale = float(${y});
        const float invWidthScale = float(${v});

        const int winHeight = int(${I});
        const int winWidth = int(${b});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${l}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${d}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${i-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${c-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KIe(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:c}=e,{alignCorners:l}=s,d=new HIe(c.shape,i.shape,l);return n.runWebGLProgram(d,[c],c.dtype)}const qIe={kernelName:a6,backendName:"webgl",kernelFunc:KIe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XIe{constructor(e,n,s,i,c){this.variableNames=["A"],this.outputShape=[];const[l,d,p,f]=e;this.outputShape=[l,n,s,f];const m=[i&&n>1?d-1:d,i&&s>1?p-1:p],_=[i&&n>1?n-1:n,i&&s>1?s-1:s],y=i?"0.5":"0.0";let v;c?v="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":v="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${m[0]/_[0]},
          ${m[1]/_[1]});
      const vec2 inputShapeRC = vec2(${d}.0, ${p}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${v};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${y})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YIe{constructor(e,n,s,i,c){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[l,d,p,f]=e;this.outputShape=[l,n,s,f];const m=[i&&n>1?d-1:d,i&&s>1?p-1:p],_=[i&&n>1?n-1:n,i&&s>1?s-1:s],y=i?"0.5":"0.0";let v;c?v="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":v="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${m[0]/_[0]},
          ${m[1]/_[1]},
          ${m[1]/_[1]});
      const vec3 inputShapeRC = vec3(${d}.0, ${p}.0,
                                     ${p}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${v};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${y})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${f-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JIe(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:c,halfPixelCenters:l,size:d}=s,[p,f]=d,m=De().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new YIe(i.shape,p,f,c,l):new XIe(i.shape,p,f,c,l);return n.runWebGLProgram(m,[i],i.dtype)}const QIe={kernelName:yR,backendName:"webgl",kernelFunc:JIe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZIe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,i,c]=n,[,l,d]=e,p=[s&&l>1?i-1:i,s&&d>1?c-1:c],f=[s&&l>1?l-1:l,s&&d>1?d-1:d],m=p[0]/f[0],_=p[1]/f[1],y=1/m,v=1/_,I=Math.ceil(y)*2+2,b=Math.ceil(v)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${m});
        const float widthScale = float(${_});

        const float invHeightScale = float(${y});
        const float invWidthScale = float(${v});

        const int winHeight = int(${I});
        const int winWidth = int(${b});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${l}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${d}) {
              continue;
            }

            float sourceFracRow =
              float(${p[0]}) *
                (float(dyR) / float(${f[0]}));

            float sourceFracCol =
                float(${p[1]}) *
                  (float(dyC) / float(${f[1]}));

            int sourceNearestRow = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${c}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e2e(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:c}=e,{alignCorners:l}=s,d=new ZIe(c.shape,i.shape,l);return n.runWebGLProgram(d,[c],c.dtype)}const t2e={kernelName:i6,backendName:"webgl",kernelFunc:e2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class n2e{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const i=d=>n.indexOf(d)!==-1&&e[d]!==1?`${e[d]} - coords[${d}] - 1`:`coords[${d}]`,c=e.map((d,p)=>i(p)).join(","),l=Er(s);this.userCode=`
      void main() {
        ${l} coords = getOutputCoords();
        setOutput(getX(${c}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class r2e{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const i=Do("rc",s),c=`${i[s-1]} + 1 < ${this.outputShape[s-1]}`,l=`${i[s-2]} + 1 < ${this.outputShape[s-2]}`,d=Er(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${c}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${d} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${p(i.slice())};
          if(${c}){
            result.g = ${f(i.slice())};
          }
          if(${l}) {
            result.b = ${m(i.slice())};
            if(${c}) {
              result.a = ${_(i.slice())};
            }
          }
          setOutput(result);
        }
    `;function p(I){return y(I)}function f(I){return I[s-1]="("+I[s-1]+" + 1)",y(I)}function m(I){return I[s-2]="("+I[s-2]+" + 1)",y(I)}function _(I){return I[s-1]="("+I[s-1]+" + 1)",I[s-2]="("+I[s-2]+" + 1)",y(I)}function y(I){const b=e.map((O,L)=>v(L,I)),A=b.join(","),R=b.slice(-2).join(",");return`getChannel(getX(${A}), vec2(${R}))`}function v(I,b){return n.indexOf(I)!==-1&&e[I]!==1?`${e[I]} - ${b[I]} - 1`:`${b[I]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dims:c}=s,l=i.shape.length,d=$n(c,i.shape);if(l===0)return mi({inputs:{x:i},backend:n});const p=De().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new r2e(i.shape,d):new n2e(i.shape,d);return n.runWebGLProgram(p,[i],i.dtype)}const o2e={kernelName:SR,backendName:"webgl",kernelFunc:s2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i2e{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],i=e[2];this.outputShape=e;let c="";typeof n=="number"?c=`float outputValue = ${n.toFixed(2)};`:c=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${c}
          if(coordX >= 0 && coordX < ${i} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a2e={kernelName:zR,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:i,fillValue:c,center:l}=e,d=n,p=new i2e(s.shape,c),[f,m]=Cb(l,s.shape[1],s.shape[2]),_=[[f,m,Math.sin(i),Math.cos(i)]];return d.runWebGLProgram(p,[s],s.dtype,_)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c2e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,u2e=On({opSnippet:c2e}),l2e={kernelName:k_,backendName:"webgl",kernelFunc:u2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d2e="return inversesqrt(x);",h2e=On({opSnippet:d2e,cpuKernelImpl:P0e}),p2e={kernelName:D_,backendName:"webgl",kernelFunc:h2e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _B{constructor(e,n,s,i,c,l,d=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=l;const p=Er(c.length),f=Er(l.length);let m="";s===1?m="i":s===2&&(m="i, j");const _=`getIndices(${m})`;let y="";i===1?y="i":i===2&&(y="i, coords[1]");const v=`getUpdates(${y})`,I=n>1?"strides[j]":"strides";this.userCode=`
        ${p} strides = ${p}(${c});

        void main() {
          ${f} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${_});
              flattenedIndex += index * ${I};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${v};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f2e(t){const{inputs:e,backend:n,attrs:s}=t,{indices:i,updates:c}=e,{shape:l}=s,{sliceRank:d,numUpdates:p,sliceSize:f,strides:m,outputSize:_}=ng(c,i,l),y=[_/f,f];if(_===0)return n.makeTensorInfo(l,i.dtype);const v=mt({inputs:{x:i},backend:n,attrs:{shape:[p,d]}}),I=mt({inputs:{x:c},backend:n,attrs:{shape:[p,f]}}),b=n.makeTensorInfo([],"float32",new Float32Array([0])),A=new _B(p,d,v.shape.length,I.shape.length,m,y),R=n.runWebGLProgram(A,[I,v,b],I.dtype),O=mt({inputs:{x:R},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(I),n.disposeIntermediateTensorInfo(R),n.disposeIntermediateTensorInfo(b),O}const m2e={kernelName:TR,backendName:"webgl",kernelFunc:f2e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g2e{constructor(e,n,s,i){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const c="while (left < right) {",l=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,d=De().getNumber("WEBGL_VERSION")===2?c:l,p=i==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${d}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${p} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E2e(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:i,values:c}=e,{side:l}=s,d=new g2e(i.shape[0],i.shape[1],c.shape[1],l),p=[[i.shape[1]]];return n.runWebGLProgram(d,[i,c],"int32",p)}const _2e={kernelName:IR,backendName:"webgl",kernelFunc:E2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y2e{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let i,c;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)c="resRC",i="resRC";else{const d=["resRC.x","resRC.y","resRC.z","resRC.w"],p=[],f=[];for(let m=0;m<n.length;m++)f.push(`${d[m]}`),m<e&&p.push(`${d[m]}`);i=p.join(),c=f.join()}const l=Er(s);this.userCode=`
      void main() {
        ${l} resRC = getOutputCoords();
        float cVal = getC(${i});
        if (cVal >= 1.0) {
          setOutput(getA(${c}));
        } else {
          setOutput(getB(${c}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v2e(t){const{inputs:e,backend:n}=t,{condition:s,t:i,e:c}=e,l=new y2e(s.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(l,[s,i,c],pi(i.dtype,c.dtype))}const S2e={kernelName:CR,backendName:"webgl",kernelFunc:v2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T2e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${bb};
  float scale = ${Nb};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,I2e=On({opSnippet:T2e}),C2e={kernelName:P_,backendName:"webgl",kernelFunc:I2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w2e=Xp+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,R2e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,b2e=On({opSnippet:w2e,packedOpSnippet:R2e,cpuKernelImpl:M0e}),N2e={kernelName:F_,backendName:"webgl",kernelFunc:b2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A2e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,O2e=On({opSnippet:A2e}),x2e={kernelName:$_,backendName:"webgl",kernelFunc:O2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k2e=Xp+`
  return sin(x);
`,D2e=On({opSnippet:k2e}),P2e={kernelName:L_,backendName:"webgl",kernelFunc:D2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L2e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,M2e=On({opSnippet:L2e}),$2e={kernelName:M_,backendName:"webgl",kernelFunc:M2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F2e=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,U2e=On({opSnippet:F2e}),V2e={kernelName:U_,backendName:"webgl",kernelFunc:U2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B2e=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:c,paddings:l}=s;se(i.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const d=c.reduce((R,O)=>R*O),p=[[0,0]];p.push(...l);for(let R=1+c.length;R<i.shape.length;++R)p.push([0,0]);const f=[],m=gB({inputs:{x:i},backend:n,attrs:{paddings:p,constantValue:0}}),_=ig(m.shape,c,d,!1),y=ag(_.length,c.length,!1),v=cg(m.shape,c,d,!1),I=mt({inputs:{x:m},backend:n,attrs:{shape:_}}),b=Mo({inputs:{x:I},backend:n,attrs:{perm:y}}),A=mt({inputs:{x:b},backend:n,attrs:{shape:v}});return f.push(m),f.push(I),f.push(b),f.forEach(R=>n.disposeIntermediateTensorInfo(R)),A},j2e={kernelName:bR,backendName:"webgl",kernelFunc:B2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W2e(t){const{inputs:e,backend:n}=t,{indices:s,values:i,denseShape:c,defaultValue:l}=e;if(c.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${c.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(i.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${i.shape}`);if(l.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${l.shape}`);const d=n.readSync(s.dataId),p=n.readSync(i.dataId),f=n.readSync(c.dataId),m=n.readSync(l.dataId)[0],[_,y,v,I,b]=F0e(d,s.shape,s.dtype,p,i.dtype,f,m);return[n.makeTensorInfo(y,s.dtype,_),n.makeTensorInfo([y[0]],i.dtype,v),n.makeTensorInfo([I.length],"bool",new Uint8Array(I.map(A=>Number(A)))),n.makeTensorInfo([b.length],s.dtype,new Int32Array(b))]}const G2e={kernelName:OR,backendName:"webgl",kernelFunc:W2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z2e(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:i,newShape:c}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(i.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${i.shape}`);if(c.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${c.shape}`);const l=Array.from(n.readSync(i.dataId)),d=n.readSync(s.dataId),p=Array.from(n.readSync(c.dataId)),[f,m,_]=U0e(d,s.shape,s.dtype,l,p);return[n.makeTensorInfo(m,s.dtype,f),n.makeTensorInfo([_.length],c.dtype,new Int32Array(_))]}const H2e={kernelName:xR,backendName:"webgl",kernelFunc:z2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K2e(t){const{inputs:e,backend:n}=t,{data:s,indices:i,segmentIds:c}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${i.shape}`);if(c.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${c.shape}`);const l=n.readSync(s.dataId),d=n.readSync(i.dataId),p=n.readSync(c.dataId),[f,m]=B8(l,s.shape,s.dtype,d,p,!0);return n.makeTensorInfo(m,s.dtype,f)}const q2e={kernelName:kR,backendName:"webgl",kernelFunc:K2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X2e(t){const{inputs:e,backend:n}=t,{data:s,indices:i,segmentIds:c}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(i.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${i.shape}`);if(c.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${c.shape}`);const l=n.readSync(s.dataId),d=n.readSync(i.dataId),p=n.readSync(c.dataId),[f,m]=B8(l,s.shape,s.dtype,d,p);return n.makeTensorInfo(m,s.dtype,f)}const Y2e={kernelName:DR,backendName:"webgl",kernelFunc:X2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J2e(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:i,sparseValues:c,defaultValue:l}=e,{outputShape:d}=s,{sliceRank:p,numUpdates:f,sliceSize:m,strides:_,outputSize:y}=ng(c,i,d),v=!1;if(c.dtype==="string"){const R=n.bufferSync(i),O=n.bufferSync(c),L=pl(n.readSync(l.dataId)[0]),$=L0e(R,O,d,y,m,f,p,_,L,v);return n.makeTensorInfo(d,$.dtype,$.values)}const I=new _B(f,p,i.shape.length,c.shape.length,_,[y,1],v),b=n.runWebGLProgram(I,[c,i,l],c.dtype),A=mt({inputs:{x:b},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(b),A}const Q2e={kernelName:PR,backendName:"webgl",kernelFunc:J2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{numOrSizeSplits:c,axis:l}=s,d=$n(l,i.shape)[0],p=Bb(i,c,d),f=i.shape.length,m=new Array(f).fill(0),_=i.shape.slice();return p.map(y=>{const v=[..._];v[d]=y;const I=Yp({inputs:{x:i},backend:n,attrs:{begin:m,size:v}});return m[d]+=y,I})}const eCe={kernelName:NR,backendName:"webgl",kernelFunc:Z2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O$="return sqrt(x);",tCe=On({opSnippet:O$,packedOpSnippet:O$,cpuKernelImpl:V0e}),nCe={kernelName:V_,backendName:"webgl",kernelFunc:tCe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rCe="return x * x;",sCe=On({opSnippet:rCe}),oCe={kernelName:c6,backendName:"webgl",kernelFunc:sCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x$="return (a - b) * (a - b);",iCe=Ys({opSnippet:x$,packedOpSnippet:x$}),aCe={kernelName:B_,backendName:"webgl",kernelFunc:iCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cCe({inputs:t,attrs:e,backend:n}){const{x:s}=t,i=Ca+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,c=new Kc(s.shape,i);return n.runWebGLProgram(c,[s],s.dtype)}const uCe={kernelName:H_,backendName:"webgl",kernelFunc:cCe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lCe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const i=s.length,c=Er(s.length),l=Er(s.length);let d="";if(i===1)d="coords * strides + begin";else{let p=0;d=s.map((f,m)=>(p++,s.length===1?`coords * strides[${m}] + begin[${m}]`:`coords[${p-1}] * strides[${m}] + begin[${m}]`)).join(",")}this.userCode=`
      ${c} begin = ${c}(${e});
      ${c} strides = ${c}(${n});

      void main() {
        ${l} coords = getOutputCoords();
        setOutput(getX(${d}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:c,end:l,strides:d,beginMask:p,endMask:f,ellipsisMask:m,newAxisMask:_,shrinkAxisMask:y}=s,{finalShapeSparse:v,finalShape:I,isIdentity:b,sliceDim0:A,isSimpleSlice:R,begin:O,end:L,strides:$}=ob(i.shape,c,l,d,p,f,m,_,y);let G;if(b)G=mt({inputs:{x:i},backend:n,attrs:{shape:I}});else if(A||R){se(i.shape.length>=1,()=>`Input must have rank at least 1, got: ${i.shape.length}`);const Z=tb(O,L,$),re=Yp({inputs:{x:i},backend:n,attrs:{begin:O,size:Z}});G=mt({inputs:{x:re},backend:n,attrs:{shape:I}}),n.disposeIntermediateTensorInfo(re)}else if(n.shouldExecuteOnCPU([i])){const re=n.readSync(i.dataId),oe=cn(i.shape,i.dtype,re),ae=B0e(v,oe,$,O);G=n.makeTensorInfo(I,i.dtype,ae.values)}else{const re=new lCe(O,$,v);G=n.runWebGLProgram(re,[i],i.dtype)}const H=mt({inputs:{x:G},backend:n,attrs:{shape:I}});return n.disposeIntermediateTensorInfo(G),H}const hCe={kernelName:LR,backendName:"webgl",kernelFunc:dCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pCe(t){const{inputs:e,backend:n,attrs:s}=t,{separator:i,nGramWidths:c,leftPad:l,rightPad:d,padWidth:p,preserveShortSequences:f}=s,{data:m,dataSplits:_}=e,y=n.readSync(m.dataId),v=n.readSync(_.dataId),[I,b]=j0e(y,v,i,c,l,d,p,f);return[n.makeTensorInfo([I.length],"string",I),n.makeTensorInfo(_.shape,"int32",b)]}const fCe={kernelName:MR,backendName:"webgl",kernelFunc:pCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mCe(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:i}=s,{input:c,delimiter:l}=e;if(c.dtype!=="string")throw new Error("Input must be of datatype string");if(c.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${c.shape}`);if(l.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${l.shape}`);const d=n.readSync(c.dataId),p=n.readSync(l.dataId)[0],[f,m,_]=W0e(d,p,i),y=m.length;return[n.makeTensorInfo([y,2],"int32",f),n.makeTensorInfo([y],"string",m),n.makeTensorInfo([2],"int32",new Int32Array(_))]}const gCe={kernelName:$R,backendName:"webgl",kernelFunc:mCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ECe(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:i}=s,{input:c}=e;if(c.dtype!=="string")throw new Error("Input must be of datatype string");if(i<=0)throw new Error("Number of buckets must be at least 1");const l=n.readSync(c.dataId),d=G0e(l,i);return n.makeTensorInfo(c.shape,"int32",d)}const _Ce={kernelName:FR,backendName:"webgl",kernelFunc:ECe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yCe="return tan(x);",vCe=On({opSnippet:yCe}),SCe={kernelName:W_,backendName:"webgl",kernelFunc:vCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TCe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,ICe=On({opSnippet:TCe}),CCe={kernelName:G_,backendName:"webgl",kernelFunc:ICe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wCe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let l=0;l<s.length;l++)s[l]=e[l]*n[l];this.outputShape=s,this.rank=s.length;const i=Er(this.rank),c=RCe(e);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        setOutput(getA(${c}));
      }
    `}}function RCe(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let i=0;i<t.length;i++)s.push(`imod(${n[i]}, ${t[i]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reps:c}=s;if(i.dtype==="string"||i.shape.length>5){const p=n.readSync(i.dataId),f=i.dtype==="string"?p.map(y=>pl(y)):p,m=cn(i.shape,i.dtype,f),_=H0e(m,c);return n.makeTensorInfo(_.shape,_.dtype,_.values)}const l=new wCe(i.shape,c);return n.runWebGLProgram(l,[i],i.dtype)}const bCe={kernelName:z_,backendName:"webgl",kernelFunc:yB};class NCe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class ACe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sd(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function k$(t){let e=1;for(;e<t;)e*=2;return e}function OCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{k:c,sorted:l}=s,d=De().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),p=De().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),f=i.shape,m=f[f.length-1];if(n.shouldExecuteOnCPU([i])||m<d||c>p){const ae=n.readSync(i.dataId),[Ee,Ce]=K0e(ae,f,i.dtype,c,l);return[n.makeTensorInfo(Ee.shape,Ee.dtype,Ee.values),n.makeTensorInfo(Ce.shape,Ce.dtype,Ce.values)]}if(c===0)return f[f.length-1]=0,[n.makeTensorInfo(f,i.dtype,[]),n.makeTensorInfo(f,"int32",[])];if(m===1)return[i,gg({attrs:{shape:f,dtype:"int32",value:0},backend:n})];const _=n.texData.get(i.dataId),y=_!==null&&_.isPacked,v=y?n.unpackTensor(i):i,b=Pe(f)/m,A=mt({inputs:{x:v},attrs:{shape:[b,m]},backend:n});y&&sd(n,v);const R=k$(c),O=k$(m);let L=null;const $=()=>L===null?[A,A]:[A,L],G=(ae,Ee,Ce)=>{const ye=$(),we=new NCe(Ce),Oe=[[m],[L===null?1:0],[Number.NEGATIVE_INFINITY],[ae],[Ee]],Me=L;L=n.runWebGLProgram(we,ye,"int32",Oe),sd(n,Me)};for(let ae=1;ae<R;ae*=2){const Ee=ae*2;for(let Ce=ae;Ce>=1;Ce/=2)G(Ee,Ce,[b,O])}for(let ae=O;ae>R;ae/=2){const Ee=$(),Ce=new ACe([b,ae/2]),we=[[m],[L===null?1:0],[R]],Ae=L;L=n.runWebGLProgram(Ce,Ee,"int32",we),sd(n,Ae);const Oe=R/2,Me=Oe*2;for(let me=Oe;me>=1;me/=2)G(Me,me,L.shape)}let H=L;L=Yp({inputs:{x:L},backend:n,attrs:{begin:0,size:[b,c]}}),sd(n,H);let Z=lB({inputs:{x:A,indices:L},backend:n,attrs:{axis:1,batchDims:1}});sd(n,A);const re=f.slice(0,-1);re.push(c),H=L,L=mt({inputs:{x:L},attrs:{shape:re},backend:n}),sd(n,H);const oe=Z;return Z=mt({inputs:{x:Z},attrs:{shape:re},backend:n}),sd(n,oe),[Z,L]}const xCe={kernelName:UR,backendName:"webgl",kernelFunc:OCe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kCe{constructor(e,n,s,i,c,l){this.variableNames=["Image","Transforms"],this.outputShape=l;const d=s==="nearest"?1:2;let p;switch(i){case"constant":p=1;break;case"reflect":p=2;break;case"wrap":p=3;break;case"nearest":p=4;break;default:p=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${p} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${p} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${p} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${c});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${c});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${d} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DCe(t){const{inputs:e,backend:n,attrs:s}=t,{image:i,transforms:c}=e,{interpolation:l,fillMode:d,fillValue:p,outputShape:f}=s,[m,_,y,v]=i.shape,[I,b]=f??[_,y],A=[m,I,b,v],R=new kCe(_,y,l,d,p,A);return n.runWebGLProgram(R,[i,c],"float32")}const PCe={kernelName:VR,backendName:"webgl",kernelFunc:DCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LCe(t){const{inputs:e,attrs:n,backend:s}=t,{axis:i}=n,{x:c}=e;dg(c,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const l=s.readSync(c.dataId),{outputValues:d,outputShape:p,indices:f}=q0e(l,i,c.shape,c.dtype);return[s.makeTensorInfo(p,c.dtype,d),s.makeTensorInfo([f.length],"int32",f)]}const MCe={kernelName:BR,backendName:"webgl",kernelFunc:LCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Ce(t){const{inputs:e,backend:n,attrs:s}=t,{value:i}=e;let{axis:c}=s;c<0&&(c+=i.shape.length);const l=i,d=l.shape.length,p=i.shape[c],f=new Array(d-1);let m=0;for(let b=0;b<d;b++)b!==c&&(f[m++]=l.shape[b]);const _=[],y=new Array(d).fill(0),v=l.shape.slice();v[c]=1;const I=new Array(p);for(let b=0;b<I.length;b++){y[c]=b;const A=Yp({inputs:{x:l},backend:n,attrs:{begin:y,size:v}}),R=mt({inputs:{x:A},backend:n,attrs:{shape:f}});I[b]=R,_.push(A)}return _.forEach(b=>n.disposeIntermediateTensorInfo(b)),I}const FCe={kernelName:jR,backendName:"webgl",kernelFunc:$Ce};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UCe{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,i=e.batchSize,c=e.inSize,l=e.numSegments,d=l*Math.ceil(c/s);this.outputShape=[i,d];const p="0.0",f="sumValue",m=Math.floor(s/4)*4,_=s%4,y=`
        sumValue += dot(values, segFilter);
    `;let v="";c%s>0&&(v=`
        if (inIdx < 0 || inIdx >= ${c}) {
          return initializationValue;
        }
      `);let I="";c%s>0&&(I=`
        if (inIdx < 0 || inIdx >= ${c}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${p};

      float getValue(int batch, int inIdx) {
        ${v}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${I}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${l})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${l})));

        float sumValue = 0.0;

        for (int i = 0; i < ${m}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${y}
        }

        int inIdx = inOffset + ${m};
        if (${_===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${y}
        } else if (${_===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${y}
        } else if (${_===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${y}
        }
        setOutput(${f});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,segmentIds:c}=e,{numSegments:l}=s,d=i.shape.length,p=[];let f=0;const m=ss([f],d);let _=i;m!=null&&(_=Mo({inputs:{x:i},backend:n,attrs:{perm:m}}),p.push(_),f=os(1,d)[0]);const y=cV(_.shape,f,l),v=Pe([_.shape[f]]),I=mt({inputs:{x:_},backend:n,attrs:{shape:[-1,v]}});p.push(I);const b=KR(i.dtype),A=($,G,H,Z,re)=>{const oe=$.shape[0],ae=$.shape[1],Ee=aV(ae,re),Ce={windowSize:Ee,inSize:ae,batchSize:oe,numSegments:re},ye=new UCe(Ce,G),we=n.compileAndRun(ye,[$,H],Z);if(p.push(we),we.shape[1]===re)return we;const Ae=EB({backend:n,attrs:{start:0,stop:re,step:1,dtype:"float32"}}),Oe=yB({inputs:{x:Ae},backend:n,attrs:{reps:[ae/Ee]}});return p.push(Ae),p.push(Oe),A(we,G,Oe,Z,re)},R=A(I,"unsortedSegmentSum",c,b,l),O=mt({inputs:{x:R},backend:n,attrs:{shape:y}});let L=O;if(m!=null){p.push(O);const $=sg(m);L=Mo({inputs:{x:L},backend:n,attrs:{perm:$}})}return p.forEach($=>n.disposeIntermediateTensorInfo($)),L}const BCe={kernelName:WR,backendName:"webgl",kernelFunc:VCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jCe=[U1e,B1e,G1e,K1e,X1e,Q1e,e_e,n_e,i_e,c_e,d_e,f_e,E_e,S_e,C_e,R_e,N_e,k_e,P_e,M_e,V_e,K_e,X_e,J_e,rye,oye,uye,T1e,hye,Eye,Sye,bye,Aye,xye,Dye,Lye,Fye,Bye,Gye,Hye,qye,Yye,Zye,tve,ove,ave,lve,pve,mve,yve,Ive,bve,Ove,Dve,Pve,Mve,Fve,Vve,jve,Gve,qve,Jve,eSe,nSe,oSe,cSe,hSe,gSe,S1e,_Se,mye,SSe,CSe,bSe,C1e,xSe,LSe,$Se,BSe,GSe,qSe,JSe,tTe,oTe,cTe,lTe,fTe,gTe,_Te,TTe,CTe,RTe,NTe,OTe,PTe,FTe,jTe,YTe,b1e,eIe,rIe,iIe,uIe,Z_e,hIe,fIe,gIe,yIe,IIe,R1e,wIe,bIe,AIe,OIe,eye,HTe,DIe,$Ie,BIe,A1e,zIe,qIe,QIe,t2e,o2e,a2e,l2e,p2e,m2e,_2e,S2e,C2e,N2e,x2e,P2e,$2e,z_e,qTe,V2e,j2e,G2e,H2e,q2e,Y2e,Q2e,eCe,nCe,oCe,aCe,uCe,hCe,fCe,gCe,_Ce,KTe,M1e,SCe,CCe,bCe,xCe,PCe,$1e,MCe,FCe,BCe,pIe];for(const t of jCe)u6(t);const WCe=E1.MediaPipeFaceMesh,GCe={runtime:"tfjs",maxFaces:1,refineLandmarks:!0},zCe=({track:t})=>{const e=Dr.useRef(null),n=Dr.useRef(null),s=Dr.useRef(null);return Dr.useEffect(()=>{async function i(l){if(!e.current||!n.current||!s.current)return;const d=n.current.getContext("2d"),p=s.current.getContext("2d");if(!d||!p)return;d.drawImage(e.current,0,0,n.current.width,n.current.height);const f=await l.estimateFaces(n.current);if(p.clearRect(0,0,n.current.width,n.current.height),f[0]){const{box:m}=f[0],{xMin:_,xMax:y,yMin:v,yMax:I,width:b,height:A}=m;p.beginPath(),p.rect(_,v,b,A),p.stroke()}requestAnimationFrame(()=>i(l))}async function c(){await W1.createCameraVideoTrack();const l=new MediaStream([t.getMediaStreamTrack()]);if(console.log(l),!e.current||!n.current||!s.current)return;e.current.srcObject=l;const d=await Yue(WCe,GCe);e.current.onloadedmetadata=()=>{!e.current||!n.current||!s.current||(n.current.width=e.current.videoWidth,n.current.height=e.current.videoHeight,s.current.width=e.current.videoWidth,s.current.height=e.current.videoHeight,i(d))}}c()},[e.current,n.current,t,s.current]),Ed("div",{className:"relative",children:[zs(QJ,{style:{height:"500px",width:"600px"},className:"z-10 invisible absolute",videoTrack:t}),zs("video",{className:"absolute object-cover invisible",muted:!0,autoPlay:!0,playsInline:!0,controls:!0,ref:e,width:"500px",height:"600px",style:{height:"500px",width:"600px"}}),zs("canvas",{className:"absolute z-20 scale-x-[-1]",width:"500px",height:"600px",ref:n,style:{border:"1px solid",height:"500px",width:"600px"}}),zs("canvas",{className:"absolute z-30 scale-x-[-1]",width:"500px",height:"600px",ref:s,style:{border:"1px solid",height:"500px",width:"600px"}})]})},D$=Dr.memo(zCe),HCe=({users:t,tracks:e})=>Ed("div",{children:[zs(D$,{track:e[1]}),t==null?void 0:t.filter(n=>!!n.videoTrack).map(n=>Ed("div",{children:[Ed("div",{children:["user id: ",n.uid]}),zs(D$,{track:n.videoTrack},n.uid)]}))]}),KCe=Dr.memo(HCe),qCe=JJ(),XCe=({setInCall:t,channelName:e})=>{const[n,s]=Dr.useState([]),[i,c]=Dr.useState(!1),{client:l,clientConfig:d}=GU(),{appId:p,token:f}=d,{ready:m,tracks:_}=qCe();return Dr.useEffect(()=>{let y=async v=>{l.on("user-published",async(I,b)=>{var A;await l.subscribe(I,b),console.log("subscribe success"),b==="video"&&s(R=>[...R,I]),b==="audio"&&((A=I.audioTrack)==null||A.play())}),l.on("user-unpublished",(I,b)=>{var A;console.log("unpublished",I,b),b==="audio"&&((A=I.audioTrack)==null||A.stop()),b==="video"&&s(R=>R.filter(O=>O.uid!==I.uid))}),l.on("user-left",I=>{console.log("leaving",I),s(b=>b.filter(A=>A.uid!==I.uid))}),await l.join(p,v,f,null),_&&await l.publish([_[0],_[1]]),c(!0)};m&&_&&(console.log("init ready"),y(e))},[e,l,m,_]),Ed("div",{children:[m&&_&&zs(oQ,{tracks:_,setStart:c,setInCall:t}),i&&_&&zs(KCe,{users:n,tracks:_})]})},YCe=Dr.memo(XCe);const JCe=()=>{const[t,e]=Dr.useState(!1),[n,s]=Dr.useState("va_dev");return zs("div",{children:t?zs(YCe,{setInCall:e,channelName:n}):zs(QCe,{setInCall:e,setChannelName:s})})},QCe=t=>{const{setInCall:e,setChannelName:n}=t;return Ed("form",{className:"join",children:[zs("input",{type:"text",placeholder:"Enter Channel Name (va_dev)",onChange:s=>n(s.target.value)}),zs("button",{onClick:s=>{s.preventDefault(),e(!0)},children:"Join"})]})};EI.createRoot(document.getElementById("root")).render(zs(WX,{children:zs(JCe,{})}));
